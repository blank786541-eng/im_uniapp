/**
 * 
 *   Version: 10.9.41
 * 
 *   Git Hash: 5b4fa64fd28f6f2c4dc5e957f39887f24696a2ae
 * 
 *   Created At: 8/14/2025, 7:17:57 AM
 * 
 *   Target: NIM_BROWSER_SDK.js
 *   
 */

!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(t="undefined"!=typeof globalThis?globalThis:t||self).NIM=a()}(this,(function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t){var a={exports:{}};return t(a,a.exports),a.exports}var a,u,check=function(t){return t&&t.Math==Math&&t},m=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof t&&t)||function(){return this}()||Function("return this")(),fails=function(t){try{return!!t()}catch(t){return!0}},g=!fails((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),h=Function.prototype,_=h.apply,E=h.call,T="object"==typeof Reflect&&Reflect.apply||(g?E.bind(_):function(){return E.apply(_,arguments)}),S=Function.prototype,M=S.bind,I=S.call,A=g&&M.bind(I,I),b=g?function(t){return t&&A(t)}:function(t){return t&&function(){return I.apply(t,arguments)}},isCallable=function(t){return"function"==typeof t},N=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),C=Function.prototype.call,R=g?C.bind(C):function(){return C.apply(C,arguments)},O={}.propertyIsEnumerable,w=Object.getOwnPropertyDescriptor,k={f:w&&!O.call({1:2},1)?function propertyIsEnumerable(t){var a=w(this,t);return!!a&&a.enumerable}:O},createPropertyDescriptor=function(t,a){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:a}},x=b({}.toString),P=b("".slice),classofRaw=function(t){return P(x(t),8,-1)},L=Object,D=b("".split),V=fails((function(){return!L("z").propertyIsEnumerable(0)}))?function(t){return"String"==classofRaw(t)?D(t,""):L(t)}:L,isNullOrUndefined=function(t){return null==t},U=TypeError,requireObjectCoercible=function(t){if(isNullOrUndefined(t))throw U("Can't call method on "+t);return t},toIndexedObject=function(t){return V(requireObjectCoercible(t))},B="object"==typeof document&&document.all,G=void 0===B&&void 0!==B?function(t){return"object"==typeof t?null!==t:isCallable(t)||t===B}:function(t){return"object"==typeof t?null!==t:isCallable(t)},H={},aFunction=function(t){return isCallable(t)?t:void 0},getBuiltIn=function(t,a){return arguments.length<2?aFunction(H[t])||aFunction(m[t]):H[t]&&H[t][a]||m[t]&&m[t][a]},j=b({}.isPrototypeOf),q=getBuiltIn("navigator","userAgent")||"",Y=m.process,K=m.Deno,W=Y&&Y.versions||K&&K.version,$=W&&W.v8;$&&(u=(a=$.split("."))[0]>0&&a[0]<4?1:+(a[0]+a[1])),!u&&q&&(!(a=q.match(/Edge\/(\d+)/))||a[1]>=74)&&(a=q.match(/Chrome\/(\d+)/))&&(u=+a[1]);var z=u,J=!!Object.getOwnPropertySymbols&&!fails((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&z&&z<41})),X=J&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Q=Object,Z=X?function(t){return"symbol"==typeof t}:function(t){var a=getBuiltIn("Symbol");return isCallable(a)&&j(a.prototype,Q(t))},ee=String,tryToString=function(t){try{return ee(t)}catch(t){return"Object"}},te=TypeError,aCallable=function(t){if(isCallable(t))return t;throw te(tryToString(t)+" is not a function")},getMethod=function(t,a){var u=t[a];return isNullOrUndefined(u)?void 0:aCallable(u)},re=TypeError,ne=Object.defineProperty,ie="__core-js_shared__",oe=m[ie]||function(t,a){try{ne(m,t,{value:a,configurable:!0,writable:!0})}catch(u){m[t]=a}return a}(ie,{}),ae=createCommonjsModule((function(t){(t.exports=function(t,a){return oe[t]||(oe[t]=void 0!==a?a:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),se=Object,toObject=function(t){return se(requireObjectCoercible(t))},ce=b({}.hasOwnProperty),le=Object.hasOwn||function hasOwn(t,a){return ce(toObject(t),a)},ue=0,de=Math.random(),pe=b(1..toString),uid=function(t){return"Symbol("+(void 0===t?"":t)+")_"+pe(++ue+de,36)},me=ae("wks"),ge=m.Symbol,fe=ge&&ge.for,he=X?ge:ge&&ge.withoutSetter||uid,wellKnownSymbol=function(t){if(!le(me,t)||!J&&"string"!=typeof me[t]){var a="Symbol."+t;J&&le(ge,t)?me[t]=ge[t]:me[t]=X&&fe?fe(a):he(a)}return me[t]},_e=TypeError,ve=wellKnownSymbol("toPrimitive"),toPrimitive=function(t,a){if(!G(t)||Z(t))return t;var u,m=getMethod(t,ve);if(m){if(void 0===a&&(a="default"),u=R(m,t,a),!G(u)||Z(u))return u;throw _e("Can't convert object to primitive value")}return void 0===a&&(a="number"),function(t,a){var u,m;if("string"===a&&isCallable(u=t.toString)&&!G(m=R(u,t)))return m;if(isCallable(u=t.valueOf)&&!G(m=R(u,t)))return m;if("string"!==a&&isCallable(u=t.toString)&&!G(m=R(u,t)))return m;throw re("Can't convert object to primitive value")}(t,a)},toPropertyKey=function(t){var a=toPrimitive(t,"string");return Z(a)?a:a+""},ye=m.document,Ee=G(ye)&&G(ye.createElement),documentCreateElement=function(t){return Ee?ye.createElement(t):{}},Te=!N&&!fails((function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a})),Se=Object.getOwnPropertyDescriptor,Me={f:N?Se:function getOwnPropertyDescriptor(t,a){if(t=toIndexedObject(t),a=toPropertyKey(a),Te)try{return Se(t,a)}catch(t){}if(le(t,a))return createPropertyDescriptor(!R(k.f,t,a),t[a])}},Ie=/#|\.prototype\./,isForced=function(t,a){var u=be[Ae(t)];return u==Ce||u!=Ne&&(isCallable(a)?fails(a):!!a)},Ae=isForced.normalize=function(t){return String(t).replace(Ie,".").toLowerCase()},be=isForced.data={},Ne=isForced.NATIVE="N",Ce=isForced.POLYFILL="P",Re=isForced,Oe=b(b.bind),functionBindContext=function(t,a){return aCallable(t),void 0===a?t:g?Oe(t,a):function(){return t.apply(a,arguments)}},we=N&&fails((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),ke=String,xe=TypeError,anObject=function(t){if(G(t))return t;throw xe(ke(t)+" is not an object")},Pe=TypeError,Le=Object.defineProperty,De=Object.getOwnPropertyDescriptor,Ve="enumerable",Ue="configurable",Fe="writable",Be={f:N?we?function defineProperty(t,a,u){if(anObject(t),a=toPropertyKey(a),anObject(u),"function"==typeof t&&"prototype"===a&&"value"in u&&Fe in u&&!u.writable){var m=De(t,a);m&&m.writable&&(t[a]=u.value,u={configurable:Ue in u?u.configurable:m.configurable,enumerable:Ve in u?u.enumerable:m.enumerable,writable:!1})}return Le(t,a,u)}:Le:function defineProperty(t,a,u){if(anObject(t),a=toPropertyKey(a),anObject(u),Te)try{return Le(t,a,u)}catch(t){}if("get"in u||"set"in u)throw Pe("Accessors not supported");return"value"in u&&(t[a]=u.value),t}},Ge=N?function(t,a,u){return Be.f(t,a,createPropertyDescriptor(1,u))}:function(t,a,u){return t[a]=u,t},He=Me.f,wrapConstructor=function(t){var Wrapper=function(a,u,m){if(this instanceof Wrapper){switch(arguments.length){case 0:return new t;case 1:return new t(a);case 2:return new t(a,u)}return new t(a,u,m)}return T(t,this,arguments)};return Wrapper.prototype=t.prototype,Wrapper},_export=function(t,a){var u,g,h,_,E,T,S,M,I=t.target,A=t.global,N=t.stat,C=t.proto,R=A?m:N?m[I]:(m[I]||{}).prototype,O=A?H:H[I]||Ge(H,I,{})[I],w=O.prototype;for(h in a)u=!Re(A?h:I+(N?".":"#")+h,t.forced)&&R&&le(R,h),E=O[h],u&&(T=t.dontCallGetSet?(M=He(R,h))&&M.value:R[h]),_=u&&T?T:a[h],u&&typeof E==typeof _||(S=t.bind&&u?functionBindContext(_,m):t.wrap&&u?wrapConstructor(_):C&&isCallable(_)?b(_):_,(t.sham||_&&_.sham||E&&E.sham)&&Ge(S,"sham",!0),Ge(O,h,S),C&&(le(H,g=I+"Prototype")||Ge(H,g,{}),Ge(H[g],h,_),t.real&&w&&!w[h]&&Ge(w,h,_)))},je=Be.f;_export({target:"Object",stat:!0,forced:Object.defineProperty!==je,sham:!N},{defineProperty:je});var qe,Ye=createCommonjsModule((function(t){var a=H.Object,u=t.exports=function defineProperty(t,u,m){return a.defineProperty(t,u,m)};a.defineProperty.sham&&(u.sham=!0)})),Ke=Ye,We=getDefaultExportFromCjs(createCommonjsModule((function(t){function _defineProperties(t,a){for(var u=0;u<a.length;u++){var m=a[u];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Ke(t,m.key,m)}}t.exports=function _createClass(t,a,u){return a&&_defineProperties(t.prototype,a),u&&_defineProperties(t,u),Ke(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports}))),$e=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports}))),ze=Math.ceil,Je=Math.floor,Xe=Math.trunc||function trunc(t){var a=+t;return(a>0?Je:ze)(a)},toIntegerOrInfinity=function(t){var a=+t;return a!=a||0===a?0:Xe(a)},Qe=Math.max,Ze=Math.min,toAbsoluteIndex=function(t,a){var u=toIntegerOrInfinity(t);return u<0?Qe(u+a,0):Ze(u,a)},et=Math.min,lengthOfArrayLike=function(t){return(a=t.length)>0?et(toIntegerOrInfinity(a),9007199254740991):0;var a},createMethod$5=function(t){return function(a,u,m){var g,h=toIndexedObject(a),_=lengthOfArrayLike(h),E=toAbsoluteIndex(m,_);if(t&&u!=u){for(;_>E;)if((g=h[E++])!=g)return!0}else for(;_>E;E++)if((t||E in h)&&h[E]===u)return t||E||0;return!t&&-1}},tt={includes:createMethod$5(!0),indexOf:createMethod$5(!1)},rt={},nt=tt.indexOf,it=b([].push),objectKeysInternal=function(t,a){var u,m=toIndexedObject(t),g=0,h=[];for(u in m)!le(rt,u)&&le(m,u)&&it(h,u);for(;a.length>g;)le(m,u=a[g++])&&(~nt(h,u)||it(h,u));return h},ot=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],at=Object.keys||function keys(t){return objectKeysInternal(t,ot)},st=N&&!we?Object.defineProperties:function defineProperties(t,a){anObject(t);for(var u,m=toIndexedObject(a),g=at(a),h=g.length,_=0;h>_;)Be.f(t,u=g[_++],m[u]);return t},ct={f:st},lt=getBuiltIn("document","documentElement"),ut=ae("keys"),sharedKey=function(t){return ut[t]||(ut[t]=uid(t))},dt=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<script>"+t+"</"+"script>"},NullProtoObjectViaActiveX=function(t){t.write(scriptTag("")),t.close();var a=t.parentWindow.Object;return t=null,a},NullProtoObject=function(){try{qe=new ActiveXObject("htmlfile")}catch(t){}var t,a;NullProtoObject="undefined"!=typeof document?document.domain&&qe?NullProtoObjectViaActiveX(qe):((a=documentCreateElement("iframe")).style.display="none",lt.appendChild(a),a.src=String("javascript:"),(t=a.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F):NullProtoObjectViaActiveX(qe);for(var u=ot.length;u--;)delete NullProtoObject.prototype[ot[u]];return NullProtoObject()};rt[dt]=!0;var pt=Object.create||function create(t,a){var u;return null!==t?(EmptyConstructor.prototype=anObject(t),u=new EmptyConstructor,EmptyConstructor.prototype=null,u[dt]=t):u=NullProtoObject(),void 0===a?u:ct.f(u,a)};_export({target:"Object",stat:!0,sham:!N},{create:pt});var mt=H.Object,gt=function create(t,a){return mt.create(t,a)},ft=String,ht=TypeError,_t=Object.setPrototypeOf||("__proto__"in{}?function(){var t,a=!1,u={};try{(t=b(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(u,[]),a=u instanceof Array}catch(t){}return function setPrototypeOf(u,m){return anObject(u),function(t){if("object"==typeof t||isCallable(t))return t;throw ht("Can't set "+ft(t)+" as a prototype")}(m),a?t(u,m):u.__proto__=m,u}}():void 0);_export({target:"Object",stat:!0},{setPrototypeOf:_t});var vt=H.Object.setPrototypeOf,yt=b([].slice),Et=Function,Tt=b([].concat),St=b([].join),Mt={},construct$8=function(t,a,u){if(!le(Mt,a)){for(var m=[],g=0;g<a;g++)m[g]="a["+g+"]";Mt[a]=Et("C,a","return new C("+St(m,",")+")")}return Mt[a](t,u)},It=g?Et.bind:function bind(t){var a=aCallable(this),u=a.prototype,m=yt(arguments,1),g=function bound(){var u=Tt(m,yt(arguments));return this instanceof g?construct$8(a,u.length,u):a.apply(t,u)};return G(u)&&(g.prototype=u),g};_export({target:"Function",proto:!0,forced:Function.bind!==It},{bind:It});var entryVirtual=function(t){return H[t+"Prototype"]},At=entryVirtual("Function").bind,bt=Function.prototype,bind$1=function(t){var a=t.bind;return t===bt||j(bt,t)&&a===bt.bind?At:a},Nt=createCommonjsModule((function(t){function _setPrototypeOf(a,u){var m;return t.exports=_setPrototypeOf=vt?bind$1(m=vt).call(m):function _setPrototypeOf(t,a){return t.__proto__=a,t},t.exports.__esModule=!0,t.exports.default=t.exports,_setPrototypeOf(a,u)}t.exports=_setPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),Ct=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _inheritsLoose(t,a){t.prototype=gt(a.prototype),t.prototype.constructor=t,Nt(t,a)},t.exports.__esModule=!0,t.exports.default=t.exports})));_export({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var Rt=9007199254740991,Ot={f:Object.getOwnPropertySymbols},wt=Object.assign,kt=Object.defineProperty,xt=b([].concat),Pt=!wt||fails((function(){if(N&&1!==wt({b:1},wt(kt({},"a",{enumerable:!0,get:function(){kt(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},a={},u=Symbol(),m="abcdefghijklmnopqrst";return t[u]=7,m.split("").forEach((function(t){a[t]=t})),7!=wt({},t)[u]||at(wt({},a)).join("")!=m}))?function assign(t,a){for(var u=toObject(t),m=arguments.length,g=1,h=Ot.f,_=k.f;m>g;)for(var E,T=V(arguments[g++]),S=h?xt(at(T),h(T)):at(T),M=S.length,I=0;M>I;)E=S[I++],N&&!R(_,T,E)||(u[E]=T[E]);return u}:wt;_export({target:"Object",stat:!0,arity:2,forced:Object.assign!==Pt},{assign:Pt});var Lt=H.Object.assign,Dt=fails((function(){at(1)}));_export({target:"Object",stat:!0,forced:Dt},{keys:function keys(t){return at(toObject(t))}});var Vt,Ut,Ft,Bt=H.Object.keys,Gt={},Ht=m.WeakMap,jt=isCallable(Ht)&&/native code/.test(String(Ht)),qt="Object already initialized",Yt=m.TypeError,Kt=m.WeakMap;if(jt||oe.state){var Wt=oe.state||(oe.state=new Kt),$t=b(Wt.get),zt=b(Wt.has),Jt=b(Wt.set);Vt=function(t,a){if(zt(Wt,t))throw Yt(qt);return a.facade=t,Jt(Wt,t,a),a},Ut=function(t){return $t(Wt,t)||{}},Ft=function(t){return zt(Wt,t)}}else{var Xt=sharedKey("state");rt[Xt]=!0,Vt=function(t,a){if(le(t,Xt))throw Yt(qt);return a.facade=t,Ge(t,Xt,a),a},Ut=function(t){return le(t,Xt)?t[Xt]:{}},Ft=function(t){return le(t,Xt)}}var Qt,Zt,er,tr={set:Vt,get:Ut,has:Ft,enforce:function(t){return Ft(t)?Ut(t):Vt(t,{})},getterFor:function(t){return function(a){var u;if(!G(a)||(u=Ut(a)).type!==t)throw Yt("Incompatible receiver, "+t+" required");return u}}},rr=Function.prototype,nr=N&&Object.getOwnPropertyDescriptor,ir=le(rr,"name"),or={EXISTS:ir,PROPER:ir&&"something"===function something(){}.name,CONFIGURABLE:ir&&(!N||N&&nr(rr,"name").configurable)},ar=!fails((function(){function F(){}return F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})),sr=sharedKey("IE_PROTO"),cr=Object,lr=cr.prototype,ur=ar?cr.getPrototypeOf:function(t){var a=toObject(t);if(le(a,sr))return a[sr];var u=a.constructor;return isCallable(u)&&a instanceof u?u.prototype:a instanceof cr?lr:null},defineBuiltIn=function(t,a,u,m){return m&&m.enumerable?t[a]=u:Ge(t,a,u),t},dr=wellKnownSymbol("iterator"),pr=!1;[].keys&&("next"in(er=[].keys())?(Zt=ur(ur(er)))!==Object.prototype&&(Qt=Zt):pr=!0);var mr=!G(Qt)||fails((function(){var t={};return Qt[dr].call(t)!==t}));Qt=mr?{}:pt(Qt),isCallable(Qt[dr])||defineBuiltIn(Qt,dr,(function(){return this}));var gr={IteratorPrototype:Qt,BUGGY_SAFARI_ITERATORS:pr},fr={};fr[wellKnownSymbol("toStringTag")]="z";var hr="[object z]"===String(fr),_r=wellKnownSymbol("toStringTag"),vr=Object,yr="Arguments"==classofRaw(function(){return arguments}()),Er=hr?classofRaw:function(t){var a,u,m;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(u=function(t,a){try{return t[a]}catch(t){}}(a=vr(t),_r))?u:yr?classofRaw(a):"Object"==(m=classofRaw(a))&&isCallable(a.callee)?"Arguments":m},Tr=hr?{}.toString:function toString(){return"[object "+Er(this)+"]"},Sr=Be.f,Mr=wellKnownSymbol("toStringTag"),setToStringTag=function(t,a,u,m){if(t){var g=u?t:t.prototype;le(g,Mr)||Sr(g,Mr,{configurable:!0,value:a}),m&&!hr&&Ge(g,"toString",Tr)}},Ir=gr.IteratorPrototype,returnThis$1=function(){return this},Ar=or.PROPER,br=gr.BUGGY_SAFARI_ITERATORS,Nr=wellKnownSymbol("iterator"),Cr="keys",Rr="values",Or="entries",returnThis=function(){return this},iteratorDefine=function(t,a,u,m,g,h,_){!function(t,a,u,m){var g=a+" Iterator";t.prototype=pt(Ir,{next:createPropertyDescriptor(+!m,u)}),setToStringTag(t,g,!1,!0),Gt[g]=returnThis$1}(u,a,m);var E,T,S,getIterationMethod=function(t){if(t===g&&N)return N;if(!br&&t in A)return A[t];switch(t){case Cr:return function keys(){return new u(this,t)};case Rr:return function values(){return new u(this,t)};case Or:return function entries(){return new u(this,t)}}return function(){return new u(this)}},M=a+" Iterator",I=!1,A=t.prototype,b=A[Nr]||A["@@iterator"]||g&&A[g],N=!br&&b||getIterationMethod(g),C="Array"==a&&A.entries||b;if(C&&(E=ur(C.call(new t)))!==Object.prototype&&E.next&&(setToStringTag(E,M,!0,!0),Gt[M]=returnThis),Ar&&g==Rr&&b&&b.name!==Rr&&(I=!0,N=function values(){return R(b,this)}),g)if(T={values:getIterationMethod(Rr),keys:h?N:getIterationMethod(Cr),entries:getIterationMethod(Or)},_)for(S in T)(br||I||!(S in A))&&defineBuiltIn(A,S,T[S]);else _export({target:a,proto:!0,forced:br||I},T);return _&&A[Nr]!==N&&defineBuiltIn(A,Nr,N,{name:g}),Gt[a]=N,T};Be.f;var wr="Array Iterator",kr=tr.set,xr=tr.getterFor(wr);iteratorDefine(Array,"Array",(function(t,a){kr(this,{type:wr,target:toIndexedObject(t),index:0,kind:a})}),(function(){var t=xr(this),a=t.target,u=t.kind,m=t.index++;return!a||m>=a.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==u?{value:m,done:!1}:"values"==u?{value:a[m],done:!1}:{value:[m,a[m]],done:!1}}),"values"),Gt.Arguments=Gt.Array;var Pr=wellKnownSymbol("toStringTag");for(var Lr in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Dr=m[Lr],Vr=Dr&&Dr.prototype;Vr&&Er(Vr)!==Pr&&Ge(Vr,Pr,Lr),Gt[Lr]=Gt.Array}var Ur=Array.isArray||function isArray(t){return"Array"==classofRaw(t)},Fr=b(Function.toString);isCallable(oe.inspectSource)||(oe.inspectSource=function(t){return Fr(t)});var Br=oe.inspectSource,noop=function(){},Gr=[],Hr=getBuiltIn("Reflect","construct"),jr=/^\s*(?:class|function)\b/,qr=b(jr.exec),Yr=!jr.exec(noop),Kr=function isConstructor(t){if(!isCallable(t))return!1;try{return Hr(noop,Gr,t),!0}catch(t){return!1}},Wr=function isConstructor(t){if(!isCallable(t))return!1;switch(Er(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Yr||!!qr(jr,Br(t))}catch(t){return!0}};Wr.sham=!0;var $r=!Hr||fails((function(){var t;return Kr(Kr.call)||!Kr(Object)||!Kr((function(){t=!0}))||t}))?Wr:Kr,zr=wellKnownSymbol("species"),Jr=Array,arraySpeciesCreate=function(t,a){return new(function(t){var a;return Ur(t)&&(a=t.constructor,($r(a)&&(a===Jr||Ur(a.prototype))||G(a)&&null===(a=a[zr]))&&(a=void 0)),void 0===a?Jr:a}(t))(0===a?0:a)},Xr=b([].push),createMethod$4=function(t){var a=1==t,u=2==t,m=3==t,g=4==t,h=6==t,_=7==t,E=5==t||h;return function(T,S,M,I){for(var A,b,N=toObject(T),C=V(N),R=functionBindContext(S,M),O=lengthOfArrayLike(C),w=0,k=I||arraySpeciesCreate,x=a?k(T,O):u||_?k(T,0):void 0;O>w;w++)if((E||w in C)&&(b=R(A=C[w],w,N),t))if(a)x[w]=b;else if(b)switch(t){case 3:return!0;case 5:return A;case 6:return w;case 2:Xr(x,A)}else switch(t){case 4:return!1;case 7:Xr(x,A)}return h?-1:m||g?g:x}},Qr={forEach:createMethod$4(0),map:createMethod$4(1),filter:createMethod$4(2),some:createMethod$4(3),every:createMethod$4(4),find:createMethod$4(5),findIndex:createMethod$4(6),filterReject:createMethod$4(7)},arrayMethodIsStrict=function(t,a){var u=[][t];return!!u&&fails((function(){u.call(null,a||function(){return 1},1)}))},Zr=Qr.forEach,en=arrayMethodIsStrict("forEach")?[].forEach:function forEach(t){return Zr(this,t,arguments.length>1?arguments[1]:void 0)};_export({target:"Array",proto:!0,forced:[].forEach!=en},{forEach:en});var tn=entryVirtual("Array").forEach,rn=Array.prototype,nn={DOMTokenList:!0,NodeList:!0},forEach$1=function(t){var a=t.forEach;return t===rn||j(rn,t)&&a===rn.forEach||le(nn,Er(t))?tn:a},an=Qr.findIndex,sn="findIndex",cn=!0;sn in[]&&Array(1).findIndex((function(){cn=!1})),_export({target:"Array",proto:!0,forced:cn},{findIndex:function findIndex(t){return an(this,t,arguments.length>1?arguments[1]:void 0)}});var ln=entryVirtual("Array").findIndex,un=Array.prototype,findIndex$1=function(t){var a=t.findIndex;return t===un||j(un,t)&&a===un.findIndex?ln:a},dn=TypeError,pn=Object.getOwnPropertyDescriptor,mn=N&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,a){if(Ur(t)&&!pn(t,"length").writable)throw dn("Cannot set read only .length");return t.length=a}:function(t,a){return t.length=a},gn=TypeError,doesNotExceedSafeInteger=function(t){if(t>9007199254740991)throw gn("Maximum allowed index exceeded");return t},createProperty=function(t,a,u){var m=toPropertyKey(a);m in t?Be.f(t,m,createPropertyDescriptor(0,u)):t[m]=u},fn=TypeError,deletePropertyOrThrow=function(t,a){if(!delete t[a])throw fn("Cannot delete property "+tryToString(a)+" of "+tryToString(t))},hn=wellKnownSymbol("species"),arrayMethodHasSpeciesSupport=function(t){return z>=51||!fails((function(){var a=[];return(a.constructor={})[hn]=function(){return{foo:1}},1!==a[t](Boolean).foo}))},_n=arrayMethodHasSpeciesSupport("splice"),vn=Math.max,yn=Math.min;_export({target:"Array",proto:!0,forced:!_n},{splice:function splice(t,a){var u,m,g,h,_,E,T=toObject(this),S=lengthOfArrayLike(T),M=toAbsoluteIndex(t,S),I=arguments.length;for(0===I?u=m=0:1===I?(u=0,m=S-M):(u=I-2,m=yn(vn(toIntegerOrInfinity(a),0),S-M)),doesNotExceedSafeInteger(S+u-m),g=arraySpeciesCreate(T,m),h=0;h<m;h++)(_=M+h)in T&&createProperty(g,h,T[_]);if(g.length=m,u<m){for(h=M;h<S-m;h++)E=h+u,(_=h+m)in T?T[E]=T[_]:deletePropertyOrThrow(T,E);for(h=S;h>S-m+u;h--)deletePropertyOrThrow(T,h-1)}else if(u>m)for(h=S-m;h>M;h--)E=h+u-1,(_=h+m-1)in T?T[E]=T[_]:deletePropertyOrThrow(T,E);for(h=0;h<u;h++)T[h+M]=arguments[h+2];return mn(T,S-m+u),g}});var En=entryVirtual("Array").splice,Tn=Array.prototype,splice=function(t){var a=t.splice;return t===Tn||j(Tn,t)&&a===Tn.splice?En:a},Sn=getBuiltIn("JSON","stringify"),Mn=b(/./.exec),In=b("".charAt),An=b("".charCodeAt),bn=b("".replace),Nn=b(1..toString),Cn=/[\uD800-\uDFFF]/g,Rn=/^[\uD800-\uDBFF]$/,On=/^[\uDC00-\uDFFF]$/,wn=!J||fails((function(){var t=getBuiltIn("Symbol")();return"[null]"!=Sn([t])||"{}"!=Sn({a:t})||"{}"!=Sn(Object(t))})),kn=fails((function(){return'"\\udf06\\ud834"'!==Sn("\udf06\ud834")||'"\\udead"'!==Sn("\udead")})),stringifyWithSymbolsFix=function(t,a){var u=yt(arguments),m=a;if((G(a)||void 0!==t)&&!Z(t))return Ur(a)||(a=function(t,a){if(isCallable(m)&&(a=R(m,this,t,a)),!Z(a))return a}),u[1]=a,T(Sn,null,u)},fixIllFormed=function(t,a,u){var m=In(u,a-1),g=In(u,a+1);return Mn(Rn,t)&&!Mn(On,g)||Mn(On,t)&&!Mn(Rn,m)?"\\u"+Nn(An(t,0),16):t};Sn&&_export({target:"JSON",stat:!0,arity:3,forced:wn||kn},{stringify:function stringify(t,a,u){var m=yt(arguments),g=T(wn?stringifyWithSymbolsFix:Sn,null,m);return kn&&"string"==typeof g?bn(g,Cn,fixIllFormed):g}}),H.JSON||(H.JSON={stringify:JSON.stringify});var xn=function stringify(t,a,u){return T(H.JSON.stringify,null,arguments)},Pn=xn;_export({target:"Array",stat:!0},{isArray:Ur});var Ln=H.Array.isArray,Dn=ot.concat("length","prototype"),Vn={f:Object.getOwnPropertyNames||function getOwnPropertyNames(t){return objectKeysInternal(t,Dn)}},Un=b([].concat),Fn=getBuiltIn("Reflect","ownKeys")||function ownKeys(t){var a=Vn.f(anObject(t)),u=Ot.f;return u?Un(a,u(t)):a},Bn=Error,Gn=b("".replace),Hn=String(Bn("zxcasd").stack),jn=/\n\s*at [^:]*:[^\n]*/,qn=jn.test(Hn),errorStackClear=function(t,a){if(qn&&"string"==typeof t&&!Bn.prepareStackTrace)for(;a--;)t=Gn(t,jn,"");return t},installErrorCause=function(t,a){G(a)&&"cause"in a&&Ge(t,"cause",a.cause)},Yn=wellKnownSymbol("iterator"),Kn=Array.prototype,isArrayIteratorMethod=function(t){return void 0!==t&&(Gt.Array===t||Kn[Yn]===t)},Wn=wellKnownSymbol("iterator"),getIteratorMethod$5=function(t){if(!isNullOrUndefined(t))return getMethod(t,Wn)||getMethod(t,"@@iterator")||Gt[Er(t)]},$n=TypeError,getIterator=function(t,a){var u=arguments.length<2?getIteratorMethod$5(t):a;if(aCallable(u))return anObject(R(u,t));throw $n(tryToString(t)+" is not iterable")},iteratorClose=function(t,a,u){var m,g;anObject(t);try{if(!(m=getMethod(t,"return"))){if("throw"===a)throw u;return u}m=R(m,t)}catch(t){g=!0,m=t}if("throw"===a)throw u;if(g)throw m;return anObject(m),u},zn=TypeError,Result=function(t,a){this.stopped=t,this.result=a},Jn=Result.prototype,iterate=function(t,a,u){var m,g,h,_,E,T,S,M=u&&u.that,I=!(!u||!u.AS_ENTRIES),A=!(!u||!u.IS_RECORD),b=!(!u||!u.IS_ITERATOR),N=!(!u||!u.INTERRUPTED),C=functionBindContext(a,M),stop=function(t){return m&&iteratorClose(m,"normal",t),new Result(!0,t)},callFn=function(t){return I?(anObject(t),N?C(t[0],t[1],stop):C(t[0],t[1])):N?C(t,stop):C(t)};if(A)m=t.iterator;else if(b)m=t;else{if(!(g=getIteratorMethod$5(t)))throw zn(tryToString(t)+" is not iterable");if(isArrayIteratorMethod(g)){for(h=0,_=lengthOfArrayLike(t);_>h;h++)if((E=callFn(t[h]))&&j(Jn,E))return E;return new Result(!1)}m=getIterator(t,g)}for(T=A?t.next:m.next;!(S=R(T,m)).done;){try{E=callFn(S.value)}catch(t){iteratorClose(m,"throw",t)}if("object"==typeof E&&E&&j(Jn,E))return E}return new Result(!1)},Xn=String,toString=function(t){if("Symbol"===Er(t))throw TypeError("Cannot convert a Symbol value to a string");return Xn(t)},normalizeStringArgument=function(t,a){return void 0===t?arguments.length<2?"":a:toString(t)},Qn=!fails((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",createPropertyDescriptor(1,7)),7!==t.stack)})),Zn=wellKnownSymbol("toStringTag"),ei=Error,ti=[].push,ri=function AggregateError(t,a){var u,m=arguments.length>2?arguments[2]:void 0,g=j(ni,this);_t?u=_t(ei(),g?ur(this):ni):(u=g?this:pt(ni),Ge(u,Zn,"Error")),void 0!==a&&Ge(u,"message",normalizeStringArgument(a)),Qn&&Ge(u,"stack",errorStackClear(u.stack,1)),installErrorCause(u,m);var h=[];return iterate(t,ti,{that:h}),Ge(u,"errors",h),u};_t?_t(ri,ei):function(t,a,u){for(var m=Fn(a),g=Be.f,h=Me.f,_=0;_<m.length;_++){var E=m[_];le(t,E)||u&&le(u,E)||g(t,E,h(a,E))}}(ri,ei,{name:!0});var ni=ri.prototype=pt(ei.prototype,{constructor:createPropertyDescriptor(1,ri),message:createPropertyDescriptor(1,""),name:createPropertyDescriptor(1,"AggregateError")});_export({global:!0,constructor:!0,arity:2},{AggregateError:ri});var ii,oi,ai,si,ci="process"==classofRaw(m.process),li=wellKnownSymbol("species"),setSpecies=function(t){var a=getBuiltIn(t),u=Be.f;N&&a&&!a[li]&&u(a,li,{configurable:!0,get:function(){return this}})},ui=TypeError,anInstance=function(t,a){if(j(a,t))return t;throw ui("Incorrect invocation")},di=TypeError,aConstructor=function(t){if($r(t))return t;throw di(tryToString(t)+" is not a constructor")},pi=wellKnownSymbol("species"),speciesConstructor=function(t,a){var u,m=anObject(t).constructor;return void 0===m||isNullOrUndefined(u=anObject(m)[pi])?a:aConstructor(u)},mi=TypeError,validateArgumentsLength=function(t,a){if(t<a)throw mi("Not enough arguments");return t},gi=/(?:ipad|iphone|ipod).*applewebkit/i.test(q),fi=m.setImmediate,hi=m.clearImmediate,_i=m.process,vi=m.Dispatch,yi=m.Function,Ei=m.MessageChannel,Ti=m.String,Si=0,Mi={},Ii="onreadystatechange";try{ii=m.location}catch(t){}var run=function(t){if(le(Mi,t)){var a=Mi[t];delete Mi[t],a()}},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){m.postMessage(Ti(t),ii.protocol+"//"+ii.host)};fi&&hi||(fi=function setImmediate(t){validateArgumentsLength(arguments.length,1);var a=isCallable(t)?t:yi(t),u=yt(arguments,1);return Mi[++Si]=function(){T(a,void 0,u)},oi(Si),Si},hi=function clearImmediate(t){delete Mi[t]},ci?oi=function(t){_i.nextTick(runner(t))}:vi&&vi.now?oi=function(t){vi.now(runner(t))}:Ei&&!gi?(si=(ai=new Ei).port2,ai.port1.onmessage=listener,oi=functionBindContext(si.postMessage,si)):m.addEventListener&&isCallable(m.postMessage)&&!m.importScripts&&ii&&"file:"!==ii.protocol&&!fails(post)?(oi=post,m.addEventListener("message",listener,!1)):oi=Ii in documentCreateElement("script")?function(t){lt.appendChild(documentCreateElement("script")).onreadystatechange=function(){lt.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)});var Ai,bi,Ni,Ci,Ri,Oi,wi,ki,xi={set:fi,clear:hi},Pi=/ipad|iphone|ipod/i.test(q)&&void 0!==m.Pebble,Li=/web0s(?!.*chrome)/i.test(q),Di=Me.f,Vi=xi.set,Ui=m.MutationObserver||m.WebKitMutationObserver,Fi=m.document,Bi=m.process,Gi=m.Promise,Hi=Di(m,"queueMicrotask"),ji=Hi&&Hi.value;ji||(Ai=function(){var t,a;for(ci&&(t=Bi.domain)&&t.exit();bi;){a=bi.fn,bi=bi.next;try{a()}catch(t){throw bi?Ci():Ni=void 0,t}}Ni=void 0,t&&t.enter()},gi||ci||Li||!Ui||!Fi?!Pi&&Gi&&Gi.resolve?((wi=Gi.resolve(void 0)).constructor=Gi,ki=functionBindContext(wi.then,wi),Ci=function(){ki(Ai)}):ci?Ci=function(){Bi.nextTick(Ai)}:(Vi=functionBindContext(Vi,m),Ci=function(){Vi(Ai)}):(Ri=!0,Oi=Fi.createTextNode(""),new Ui(Ai).observe(Oi,{characterData:!0}),Ci=function(){Oi.data=Ri=!Ri}));var qi=ji||function(t){var a={fn:t,next:void 0};Ni&&(Ni.next=a),bi||(bi=a,Ci()),Ni=a},perform=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Queue=function(){this.head=null,this.tail=null};Queue.prototype={add:function(t){var a={item:t,next:null};this.head?this.tail.next=a:this.head=a,this.tail=a},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Yi,Ki,Wi=Queue,$i=m.Promise,zi="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Ji=!zi&&!ci&&"object"==typeof window&&"object"==typeof document,Xi=$i&&$i.prototype,Qi=wellKnownSymbol("species"),Zi=!1,eo=isCallable(m.PromiseRejectionEvent),to=Re("Promise",(function(){var t=Br($i),a=t!==String($i);if(!a&&66===z)return!0;if(!Xi.catch||!Xi.finally)return!0;if(!z||z<51||!/native code/.test(t)){var u=new $i((function(t){t(1)})),FakePromise=function(t){t((function(){}),(function(){}))};if((u.constructor={})[Qi]=FakePromise,!(Zi=u.then((function(){}))instanceof FakePromise))return!0}return!a&&(Ji||zi)&&!eo})),ro={CONSTRUCTOR:to,REJECTION_EVENT:eo,SUBCLASSING:Zi},no=TypeError,PromiseCapability=function(t){var a,u;this.promise=new t((function(t,m){if(void 0!==a||void 0!==u)throw no("Bad Promise constructor");a=t,u=m})),this.resolve=aCallable(a),this.reject=aCallable(u)},io={f:function(t){return new PromiseCapability(t)}},oo=xi.set,ao="Promise",so=ro.CONSTRUCTOR,co=ro.REJECTION_EVENT,lo=tr.getterFor(ao),uo=tr.set,po=$i&&$i.prototype,mo=$i,go=po,fo=m.TypeError,ho=m.document,_o=m.process,vo=io.f,yo=vo,Eo=!!(ho&&ho.createEvent&&m.dispatchEvent),To="unhandledrejection",isThenable=function(t){var a;return!(!G(t)||!isCallable(a=t.then))&&a},callReaction=function(t,a){var u,m,g,h=a.value,_=1==a.state,E=_?t.ok:t.fail,T=t.resolve,S=t.reject,M=t.domain;try{E?(_||(2===a.rejection&&onHandleUnhandled(a),a.rejection=1),!0===E?u=h:(M&&M.enter(),u=E(h),M&&(M.exit(),g=!0)),u===t.promise?S(fo("Promise-chain cycle")):(m=isThenable(u))?R(m,u,T,S):T(u)):S(h)}catch(t){M&&!g&&M.exit(),S(t)}},notify=function(t,a){t.notified||(t.notified=!0,qi((function(){for(var u,m=t.reactions;u=m.get();)callReaction(u,t);t.notified=!1,a&&!t.rejection&&onUnhandled(t)})))},dispatchEvent=function(t,a,u){var g,h;Eo?((g=ho.createEvent("Event")).promise=a,g.reason=u,g.initEvent(t,!1,!0),m.dispatchEvent(g)):g={promise:a,reason:u},!co&&(h=m["on"+t])?h(g):t===To&&function(t,a){var u=m.console;u&&u.error&&(1==arguments.length?u.error(t):u.error(t,a))}("Unhandled promise rejection",u)},onUnhandled=function(t){R(oo,m,(function(){var a,u=t.facade,m=t.value;if(isUnhandled(t)&&(a=perform((function(){ci?_o.emit("unhandledRejection",m,u):dispatchEvent(To,u,m)})),t.rejection=ci||isUnhandled(t)?2:1,a.error))throw a.value}))},isUnhandled=function(t){return 1!==t.rejection&&!t.parent},onHandleUnhandled=function(t){R(oo,m,(function(){var a=t.facade;ci?_o.emit("rejectionHandled",a):dispatchEvent("rejectionhandled",a,t.value)}))},bind=function(t,a,u){return function(m){t(a,m,u)}},internalReject=function(t,a,u){t.done||(t.done=!0,u&&(t=u),t.value=a,t.state=2,notify(t,!0))},internalResolve=function(t,a,u){if(!t.done){t.done=!0,u&&(t=u);try{if(t.facade===a)throw fo("Promise can't be resolved itself");var m=isThenable(a);m?qi((function(){var u={done:!1};try{R(m,a,bind(internalResolve,u,t),bind(internalReject,u,t))}catch(a){internalReject(u,a,t)}})):(t.value=a,t.state=1,notify(t,!1))}catch(a){internalReject({done:!1},a,t)}}};so&&(go=(mo=function Promise(t){anInstance(this,go),aCallable(t),R(Yi,this);var a=lo(this);try{t(bind(internalResolve,a),bind(internalReject,a))}catch(t){internalReject(a,t)}}).prototype,(Yi=function Promise(t){uo(this,{type:ao,done:!1,notified:!1,parent:!1,reactions:new Wi,rejection:!1,state:0,value:void 0})}).prototype=defineBuiltIn(go,"then",(function then(t,a){var u=lo(this),m=vo(speciesConstructor(this,mo));return u.parent=!0,m.ok=!isCallable(t)||t,m.fail=isCallable(a)&&a,m.domain=ci?_o.domain:void 0,0==u.state?u.reactions.add(m):qi((function(){callReaction(m,u)})),m.promise})),Ki=function(){var t=new Yi,a=lo(t);this.promise=t,this.resolve=bind(internalResolve,a),this.reject=bind(internalReject,a)},io.f=vo=function(t){return t===mo||undefined===t?new Ki(t):yo(t)}),_export({global:!0,constructor:!0,wrap:!0,forced:so},{Promise:mo}),setToStringTag(mo,ao,!1,!0),setSpecies(ao);var So=wellKnownSymbol("iterator"),Mo=!1;try{var Io=0,Ao={next:function(){return{done:!!Io++}},return:function(){Mo=!0}};Ao[So]=function(){return this},Array.from(Ao,(function(){throw 2}))}catch(t){}var checkCorrectnessOfIteration=function(t,a){if(!a&&!Mo)return!1;var u=!1;try{var m={};m[So]=function(){return{next:function(){return{done:u=!0}}}},t(m)}catch(t){}return u},bo=ro.CONSTRUCTOR||!checkCorrectnessOfIteration((function(t){$i.all(t).then(void 0,(function(){}))}));_export({target:"Promise",stat:!0,forced:bo},{all:function all(t){var a=this,u=io.f(a),m=u.resolve,g=u.reject,h=perform((function(){var u=aCallable(a.resolve),h=[],_=0,E=1;iterate(t,(function(t){var T=_++,S=!1;E++,R(u,a,t).then((function(t){S||(S=!0,h[T]=t,--E||m(h))}),g)})),--E||m(h)}));return h.error&&g(h.value),u.promise}});var No=ro.CONSTRUCTOR;$i&&$i.prototype,_export({target:"Promise",proto:!0,forced:No,real:!0},{catch:function(t){return this.then(void 0,t)}}),_export({target:"Promise",stat:!0,forced:bo},{race:function race(t){var a=this,u=io.f(a),m=u.reject,g=perform((function(){var g=aCallable(a.resolve);iterate(t,(function(t){R(g,a,t).then(u.resolve,m)}))}));return g.error&&m(g.value),u.promise}}),_export({target:"Promise",stat:!0,forced:ro.CONSTRUCTOR},{reject:function reject(t){var a=io.f(this);return R(a.reject,void 0,t),a.promise}});var promiseResolve=function(t,a){if(anObject(t),G(a)&&a.constructor===t)return a;var u=io.f(t);return(0,u.resolve)(a),u.promise},Co=ro.CONSTRUCTOR,Ro=getBuiltIn("Promise"),Oo=!Co;_export({target:"Promise",stat:!0,forced:!0},{resolve:function resolve(t){return promiseResolve(Oo&&this===Ro?$i:this,t)}}),_export({target:"Promise",stat:!0},{allSettled:function allSettled(t){var a=this,u=io.f(a),m=u.resolve,g=u.reject,h=perform((function(){var u=aCallable(a.resolve),g=[],h=0,_=1;iterate(t,(function(t){var E=h++,T=!1;_++,R(u,a,t).then((function(t){T||(T=!0,g[E]={status:"fulfilled",value:t},--_||m(g))}),(function(t){T||(T=!0,g[E]={status:"rejected",reason:t},--_||m(g))}))})),--_||m(g)}));return h.error&&g(h.value),u.promise}});var wo="No one promise resolved";_export({target:"Promise",stat:!0},{any:function any(t){var a=this,u=getBuiltIn("AggregateError"),m=io.f(a),g=m.resolve,h=m.reject,_=perform((function(){var m=aCallable(a.resolve),_=[],E=0,T=1,S=!1;iterate(t,(function(t){var M=E++,I=!1;T++,R(m,a,t).then((function(t){I||S||(S=!0,g(t))}),(function(t){I||S||(I=!0,_[M]=t,--T||h(new u(_,wo)))}))})),--T||h(new u(_,wo))}));return _.error&&h(_.value),m.promise}});var ko=$i&&$i.prototype,xo=!!$i&&fails((function(){ko.finally.call({then:function(){}},(function(){}))}));_export({target:"Promise",proto:!0,real:!0,forced:xo},{finally:function(t){var a=speciesConstructor(this,getBuiltIn("Promise")),u=isCallable(t);return this.then(u?function(u){return promiseResolve(a,t()).then((function(){return u}))}:t,u?function(u){return promiseResolve(a,t()).then((function(){throw u}))}:t)}});var Po=b("".charAt),Lo=b("".charCodeAt),Do=b("".slice),createMethod$3=function(t){return function(a,u){var m,g,h=toString(requireObjectCoercible(a)),_=toIntegerOrInfinity(u),E=h.length;return _<0||_>=E?t?"":void 0:(m=Lo(h,_))<55296||m>56319||_+1===E||(g=Lo(h,_+1))<56320||g>57343?t?Po(h,_):m:t?Do(h,_,_+2):g-56320+(m-55296<<10)+65536}},Vo={codeAt:createMethod$3(!1),charAt:createMethod$3(!0)}.charAt,Uo="String Iterator",Fo=tr.set,Bo=tr.getterFor(Uo);iteratorDefine(String,"String",(function(t){Fo(this,{type:Uo,string:toString(t),index:0})}),(function next(){var t,a=Bo(this),u=a.string,m=a.index;return m>=u.length?{value:void 0,done:!0}:(t=Vo(u,m),a.index+=t.length,{value:t,done:!1})}));var Go=H.Promise;_export({target:"Promise",stat:!0,forced:!0},{try:function(t){var a=io.f(this),u=perform(t);return(u.error?a.reject:a.resolve)(u.value),a.promise}});var Ho=Go,jo=k.f,qo=b(jo),Yo=b([].push),createMethod$2=function(t){return function(a){for(var u,m=toIndexedObject(a),g=at(m),h=g.length,_=0,E=[];h>_;)u=g[_++],N&&!qo(m,u)||Yo(E,t?[u,m[u]]:m[u]);return E}},Ko={entries:createMethod$2(!0),values:createMethod$2(!1)}.values;_export({target:"Object",stat:!0},{values:function values(t){return Ko(t)}});var Wo=H.Object.values,$o=Date,zo=b($o.prototype.getTime);_export({target:"Date",stat:!0},{now:function now(){return zo(new $o)}});var Jo=H.Date.now,Xo=wellKnownSymbol("isConcatSpreadable"),Qo=z>=51||!fails((function(){var t=[];return t[Xo]=!1,t.concat()[0]!==t})),Zo=arrayMethodHasSpeciesSupport("concat"),isConcatSpreadable=function(t){if(!G(t))return!1;var a=t[Xo];return void 0!==a?!!a:Ur(t)};_export({target:"Array",proto:!0,arity:1,forced:!Qo||!Zo},{concat:function concat(t){var a,u,m,g,h,_=toObject(this),E=arraySpeciesCreate(_,0),T=0;for(a=-1,m=arguments.length;a<m;a++)if(isConcatSpreadable(h=-1===a?_:arguments[a]))for(g=lengthOfArrayLike(h),doesNotExceedSafeInteger(T+g),u=0;u<g;u++,T++)u in h&&createProperty(E,T,h[u]);else doesNotExceedSafeInteger(T+1),createProperty(E,T++,h);return E.length=T,E}});var ea=entryVirtual("Array").concat,ta=Array.prototype,concat=function(t){var a=t.concat;return t===ta||j(ta,t)&&a===ta.concat?ea:a},ra=/MSIE .\./.test(q),na=m.Function,wrap$1=function(t){return ra?function(a,u){var m=validateArgumentsLength(arguments.length,1)>2,g=isCallable(a)?a:na(a),h=m?yt(arguments,2):void 0;return t(m?function(){T(g,this,h)}:g,u)}:t},ia={setTimeout:wrap$1(m.setTimeout),setInterval:wrap$1(m.setInterval)},oa=ia.setInterval;_export({global:!0,bind:!0,forced:m.setInterval!==oa},{setInterval:oa});var aa=ia.setTimeout;_export({global:!0,bind:!0,forced:m.setTimeout!==aa},{setTimeout:aa});var sa=H.setTimeout,ca=createCommonjsModule((function(t){var a=Object.prototype.hasOwnProperty,u="~";function Events(){}function EE(t,a,u){this.fn=t,this.context=a,this.once=u||!1}function addListener(t,a,m,g,h){if("function"!=typeof m)throw new TypeError("The listener must be a function");var _=new EE(m,g||t,h),E=u?u+a:a;return t._events[E]?t._events[E].fn?t._events[E]=[t._events[E],_]:t._events[E].push(_):(t._events[E]=_,t._eventsCount++),t}function clearEvent(t,a){0==--t._eventsCount?t._events=new Events:delete t._events[a]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(u=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,m,g=[];if(0===this._eventsCount)return g;for(m in t=this._events)a.call(t,m)&&g.push(u?m.slice(1):m);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(t)):g},EventEmitter.prototype.listeners=function listeners(t){var a=u?u+t:t,m=this._events[a];if(!m)return[];if(m.fn)return[m.fn];for(var g=0,h=m.length,_=new Array(h);g<h;g++)_[g]=m[g].fn;return _},EventEmitter.prototype.listenerCount=function listenerCount(t){var a=u?u+t:t,m=this._events[a];return m?m.fn?1:m.length:0},EventEmitter.prototype.emit=function emit(t,a,m,g,h,_){var E=u?u+t:t;if(!this._events[E])return!1;var T,S,M=this._events[E],I=arguments.length;if(M.fn){switch(M.once&&this.removeListener(t,M.fn,void 0,!0),I){case 1:return M.fn.call(M.context),!0;case 2:return M.fn.call(M.context,a),!0;case 3:return M.fn.call(M.context,a,m),!0;case 4:return M.fn.call(M.context,a,m,g),!0;case 5:return M.fn.call(M.context,a,m,g,h),!0;case 6:return M.fn.call(M.context,a,m,g,h,_),!0}for(S=1,T=new Array(I-1);S<I;S++)T[S-1]=arguments[S];M.fn.apply(M.context,T)}else{var A,b=M.length;for(S=0;S<b;S++)switch(M[S].once&&this.removeListener(t,M[S].fn,void 0,!0),I){case 1:M[S].fn.call(M[S].context);break;case 2:M[S].fn.call(M[S].context,a);break;case 3:M[S].fn.call(M[S].context,a,m);break;case 4:M[S].fn.call(M[S].context,a,m,g);break;default:if(!T)for(A=1,T=new Array(I-1);A<I;A++)T[A-1]=arguments[A];M[S].fn.apply(M[S].context,T)}}return!0},EventEmitter.prototype.on=function on(t,a,u){return addListener(this,t,a,u,!1)},EventEmitter.prototype.once=function once(t,a,u){return addListener(this,t,a,u,!0)},EventEmitter.prototype.removeListener=function removeListener(t,a,m,g){var h=u?u+t:t;if(!this._events[h])return this;if(!a)return clearEvent(this,h),this;var _=this._events[h];if(_.fn)_.fn!==a||g&&!_.once||m&&_.context!==m||clearEvent(this,h);else{for(var E=0,T=[],S=_.length;E<S;E++)(_[E].fn!==a||g&&!_[E].once||m&&_[E].context!==m)&&T.push(_[E]);T.length?this._events[h]=1===T.length?T[0]:T:clearEvent(this,h)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var a;return t?(a=u?u+t:t,this._events[a]&&clearEvent(this,a)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=u,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter}));_export({global:!0},{globalThis:m});var la=Array,ua=Math.max,arraySliceSimple=function(t,a,u){for(var m=lengthOfArrayLike(t),g=toAbsoluteIndex(a,m),h=toAbsoluteIndex(void 0===u?m:u,m),_=la(ua(h-g,0)),E=0;g<h;g++,E++)createProperty(_,E,t[g]);return _.length=E,_},da=Vn.f,pa="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ma={f:function getOwnPropertyNames(t){return pa&&"Window"==classofRaw(t)?function(t){try{return da(t)}catch(t){return arraySliceSimple(pa)}}(t):da(toIndexedObject(t))}},ga={f:wellKnownSymbol},fa=Be.f,wellKnownSymbolDefine=function(t){var a=H.Symbol||(H.Symbol={});le(a,t)||fa(a,t,{value:ga.f(t)})},symbolDefineToPrimitive=function(){var t=getBuiltIn("Symbol"),a=t&&t.prototype,u=a&&a.valueOf,m=wellKnownSymbol("toPrimitive");a&&!a[m]&&defineBuiltIn(a,m,(function(t){return R(u,this)}),{arity:1})},ha=Qr.forEach,_a=sharedKey("hidden"),va="Symbol",ya=tr.set,Ea=tr.getterFor(va),Ta=Object.prototype,Sa=m.Symbol,Ma=Sa&&Sa.prototype,Ia=m.TypeError,Aa=m.QObject,ba=Me.f,Na=Be.f,Ca=ma.f,Ra=k.f,Oa=b([].push),wa=ae("symbols"),ka=ae("op-symbols"),xa=ae("wks"),Pa=!Aa||!Aa.prototype||!Aa.prototype.findChild,La=N&&fails((function(){return 7!=pt(Na({},"a",{get:function(){return Na(this,"a",{value:7}).a}})).a}))?function(t,a,u){var m=ba(Ta,a);m&&delete Ta[a],Na(t,a,u),m&&t!==Ta&&Na(Ta,a,m)}:Na,wrap=function(t,a){var u=wa[t]=pt(Ma);return ya(u,{type:va,tag:t,description:a}),N||(u.description=a),u},Da=function defineProperty(t,a,u){t===Ta&&Da(ka,a,u),anObject(t);var m=toPropertyKey(a);return anObject(u),le(wa,m)?(u.enumerable?(le(t,_a)&&t[_a][m]&&(t[_a][m]=!1),u=pt(u,{enumerable:createPropertyDescriptor(0,!1)})):(le(t,_a)||Na(t,_a,createPropertyDescriptor(1,{})),t[_a][m]=!0),La(t,m,u)):Na(t,m,u)},Va=function defineProperties(t,a){anObject(t);var u=toIndexedObject(a),m=at(u).concat($getOwnPropertySymbols(u));return ha(m,(function(a){N&&!R(Ua,u,a)||Da(t,a,u[a])})),t},Ua=function propertyIsEnumerable(t){var a=toPropertyKey(t),u=R(Ra,this,a);return!(this===Ta&&le(wa,a)&&!le(ka,a))&&(!(u||!le(this,a)||!le(wa,a)||le(this,_a)&&this[_a][a])||u)},Fa=function getOwnPropertyDescriptor(t,a){var u=toIndexedObject(t),m=toPropertyKey(a);if(u!==Ta||!le(wa,m)||le(ka,m)){var g=ba(u,m);return!g||!le(wa,m)||le(u,_a)&&u[_a][m]||(g.enumerable=!0),g}},Ba=function getOwnPropertyNames(t){var a=Ca(toIndexedObject(t)),u=[];return ha(a,(function(t){le(wa,t)||le(rt,t)||Oa(u,t)})),u},$getOwnPropertySymbols=function(t){var a=t===Ta,u=Ca(a?ka:toIndexedObject(t)),m=[];return ha(u,(function(t){!le(wa,t)||a&&!le(Ta,t)||Oa(m,wa[t])})),m};J||(Sa=function Symbol(){if(j(Ma,this))throw Ia("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?toString(arguments[0]):void 0,a=uid(t),setter=function(t){this===Ta&&R(setter,ka,t),le(this,_a)&&le(this[_a],a)&&(this[_a][a]=!1),La(this,a,createPropertyDescriptor(1,t))};return N&&Pa&&La(Ta,a,{configurable:!0,set:setter}),wrap(a,t)},Ma=Sa.prototype,defineBuiltIn(Ma,"toString",(function toString(){return Ea(this).tag})),defineBuiltIn(Sa,"withoutSetter",(function(t){return wrap(uid(t),t)})),k.f=Ua,Be.f=Da,ct.f=Va,Me.f=Fa,Vn.f=ma.f=Ba,Ot.f=$getOwnPropertySymbols,ga.f=function(t){return wrap(wellKnownSymbol(t),t)},N&&Na(Ma,"description",{configurable:!0,get:function description(){return Ea(this).description}})),_export({global:!0,constructor:!0,wrap:!0,forced:!J,sham:!J},{Symbol:Sa}),ha(at(xa),(function(t){wellKnownSymbolDefine(t)})),_export({target:va,stat:!0,forced:!J},{useSetter:function(){Pa=!0},useSimple:function(){Pa=!1}}),_export({target:"Object",stat:!0,forced:!J,sham:!N},{create:function create(t,a){return void 0===a?pt(t):Va(pt(t),a)},defineProperty:Da,defineProperties:Va,getOwnPropertyDescriptor:Fa}),_export({target:"Object",stat:!0,forced:!J},{getOwnPropertyNames:Ba}),symbolDefineToPrimitive(),setToStringTag(Sa,va),rt[_a]=!0;var Ga=J&&!!Symbol.for&&!!Symbol.keyFor,Ha=ae("string-to-symbol-registry"),ja=ae("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!Ga},{for:function(t){var a=toString(t);if(le(Ha,a))return Ha[a];var u=getBuiltIn("Symbol")(a);return Ha[a]=u,ja[u]=a,u}});var qa=ae("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!Ga},{keyFor:function keyFor(t){if(!Z(t))throw TypeError(tryToString(t)+" is not a symbol");if(le(qa,t))return qa[t]}});var Ya=!J||fails((function(){Ot.f(1)}));_export({target:"Object",stat:!0,forced:Ya},{getOwnPropertySymbols:function getOwnPropertySymbols(t){var a=Ot.f;return a?a(toObject(t)):[]}}),wellKnownSymbolDefine("asyncIterator"),wellKnownSymbolDefine("hasInstance"),wellKnownSymbolDefine("isConcatSpreadable"),wellKnownSymbolDefine("iterator"),wellKnownSymbolDefine("match"),wellKnownSymbolDefine("matchAll"),wellKnownSymbolDefine("replace"),wellKnownSymbolDefine("search"),wellKnownSymbolDefine("species"),wellKnownSymbolDefine("split"),wellKnownSymbolDefine("toPrimitive"),symbolDefineToPrimitive(),wellKnownSymbolDefine("toStringTag"),setToStringTag(getBuiltIn("Symbol"),"Symbol"),wellKnownSymbolDefine("unscopables"),setToStringTag(m.JSON,"JSON",!0);var Ka=H.Symbol;wellKnownSymbolDefine("asyncDispose"),wellKnownSymbolDefine("dispose"),wellKnownSymbolDefine("matcher"),wellKnownSymbolDefine("metadataKey"),wellKnownSymbolDefine("observable"),wellKnownSymbolDefine("metadata"),wellKnownSymbolDefine("patternMatch"),wellKnownSymbolDefine("replaceAll");var Wa=Ka,$a=fails((function(){ur(1)}));_export({target:"Object",stat:!0,forced:$a,sham:!ar},{getPrototypeOf:function getPrototypeOf(t){return ur(toObject(t))}});var za=H.Object.getPrototypeOf,Ja=b([].reverse),Xa=[1,2];_export({target:"Array",proto:!0,forced:String(Xa)===String(Xa.reverse())},{reverse:function reverse(){return Ur(this)&&(this.length=this.length),Ja(this)}});var Qa=entryVirtual("Array").reverse,Za=Array.prototype,reverse$1=function(t){var a=t.reverse;return t===Za||j(Za,t)&&a===Za.reverse?Qa:a},es=arrayMethodHasSpeciesSupport("slice"),ts=wellKnownSymbol("species"),rs=Array,ns=Math.max;_export({target:"Array",proto:!0,forced:!es},{slice:function slice(t,a){var u,m,g,h=toIndexedObject(this),_=lengthOfArrayLike(h),E=toAbsoluteIndex(t,_),T=toAbsoluteIndex(void 0===a?_:a,_);if(Ur(h)&&(u=h.constructor,($r(u)&&(u===rs||Ur(u.prototype))||G(u)&&null===(u=u[ts]))&&(u=void 0),u===rs||void 0===u))return yt(h,E,T);for(m=new(void 0===u?rs:u)(ns(T-E,0)),g=0;E<T;E++,g++)E in h&&createProperty(m,g,h[E]);return m.length=g,m}});var is=entryVirtual("Array").slice,os=Array.prototype,slice=function(t){var a=t.slice;return t===os||j(os,t)&&a===os.slice?is:a},as=ga.f("iterator"),ss=Qr.find,cs="find",ls=!0;cs in[]&&Array(1).find((function(){ls=!1})),_export({target:"Array",proto:!0,forced:ls},{find:function find(t){return ss(this,t,arguments.length>1?arguments[1]:void 0)}});var us=entryVirtual("Array").find,ds=Array.prototype,find=function(t){var a=t.find;return t===ds||j(ds,t)&&a===ds.find?us:a},ps=tt.includes,ms=fails((function(){return!Array(1).includes()}));_export({target:"Array",proto:!0,forced:ms},{includes:function includes(t){return ps(this,t,arguments.length>1?arguments[1]:void 0)}});var gs=entryVirtual("Array").includes,fs=wellKnownSymbol("match"),hs=TypeError,notARegexp=function(t){if(function(t){var a;return G(t)&&(void 0!==(a=t[fs])?!!a:"RegExp"==classofRaw(t))}(t))throw hs("The method doesn't accept regular expressions");return t},_s=wellKnownSymbol("match"),vs=b("".indexOf);_export({target:"String",proto:!0,forced:!function(t){var a=/./;try{"/./"[t](a)}catch(u){try{return a[_s]=!1,"/./"[t](a)}catch(t){}}return!1}("includes")},{includes:function includes(t){return!!~vs(toString(requireObjectCoercible(this)),toString(notARegexp(t)),arguments.length>1?arguments[1]:void 0)}});var ys=entryVirtual("String").includes,Es=Array.prototype,Ts=String.prototype,includes=function(t){var a=t.includes;return t===Es||j(Es,t)&&a===Es.includes?gs:"string"==typeof t||t===Ts||j(Ts,t)&&a===Ts.includes?ys:a},Ss=Qr.map,Ms=arrayMethodHasSpeciesSupport("map");_export({target:"Array",proto:!0,forced:!Ms},{map:function map(t){return Ss(this,t,arguments.length>1?arguments[1]:void 0)}});var Is=entryVirtual("Array").map,As=Array.prototype,map$6=function(t){var a=t.map;return t===As||j(As,t)&&a===As.map?Is:a},bs=Qr.filter,Ns=arrayMethodHasSpeciesSupport("filter");_export({target:"Array",proto:!0,forced:!Ns},{filter:function filter(t){return bs(this,t,arguments.length>1?arguments[1]:void 0)}});var Cs=entryVirtual("Array").filter,Rs=Array.prototype,filter=function(t){var a=t.filter;return t===Rs||j(Rs,t)&&a===Rs.filter?Cs:a},Os=createCommonjsModule((function(t,a){t.exports=function(){function _regeneratorRuntime(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},a=Object.prototype,u=a.hasOwnProperty,m="function"==typeof Wa?Wa:{},g=m.iterator||"@@iterator",h=m.asyncIterator||"@@asyncIterator",_=m.toStringTag||"@@toStringTag";function define(t,a,u){return Ke(t,a,{value:u,enumerable:!0,configurable:!0,writable:!0}),t[a]}try{define({},"")}catch(t){define=function define(t,a,u){return t[a]=u}}function wrap(t,a,u,m){var g=a&&a.prototype instanceof Generator?a:Generator,h=gt(g.prototype),_=new Context(m||[]);return h._invoke=function(t,a,u){var m="suspendedStart";return function(g,h){if("executing"===m)throw new Error("Generator is already running");if("completed"===m){if("throw"===g)throw h;return doneResult()}for(u.method=g,u.arg=h;;){var _=u.delegate;if(_){var T=maybeInvokeDelegate(_,u);if(T){if(T===E)continue;return T}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if("suspendedStart"===m)throw m="completed",u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);m="executing";var S=tryCatch(t,a,u);if("normal"===S.type){if(m=u.done?"completed":"suspendedYield",S.arg===E)continue;return{value:S.arg,done:u.done}}"throw"===S.type&&(m="completed",u.method="throw",u.arg=S.arg)}}}(t,u,_),h}function tryCatch(t,a,u){try{return{type:"normal",arg:t.call(a,u)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var E={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var T={};define(T,g,(function(){return this}));var S=za&&za(za(values([])));S&&S!==a&&u.call(S,g)&&(T=S);var M=GeneratorFunctionPrototype.prototype=Generator.prototype=gt(T);function defineIteratorMethods(t){var a;forEach$1(a=["next","throw","return"]).call(a,(function(a){define(t,a,(function(t){return this._invoke(a,t)}))}))}function AsyncIterator(t,a){function invoke(m,g,h,_){var E=tryCatch(t[m],t,g);if("throw"!==E.type){var T=E.arg,S=T.value;return S&&"object"==typeof S&&u.call(S,"__await")?a.resolve(S.__await).then((function(t){invoke("next",t,h,_)}),(function(t){invoke("throw",t,h,_)})):a.resolve(S).then((function(t){T.value=t,h(T)}),(function(t){return invoke("throw",t,h,_)}))}_(E.arg)}var m;this._invoke=function(t,u){function callInvokeWithMethodAndArg(){return new a((function(a,m){invoke(t,u,a,m)}))}return m=m?m.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,a){var u=t.iterator[a.method];if(void 0===u){if(a.delegate=null,"throw"===a.method){if(t.iterator.return&&(a.method="return",a.arg=void 0,maybeInvokeDelegate(t,a),"throw"===a.method))return E;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return E}var m=tryCatch(u,t.iterator,a.arg);if("throw"===m.type)return a.method="throw",a.arg=m.arg,a.delegate=null,E;var g=m.arg;return g?g.done?(a[t.resultName]=g.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=void 0),a.delegate=null,E):g:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,E)}function pushTryEntry(t){var a={tryLoc:t[0]};1 in t&&(a.catchLoc=t[1]),2 in t&&(a.finallyLoc=t[2],a.afterLoc=t[3]),this.tryEntries.push(a)}function resetTryEntry(t){var a=t.completion||{};a.type="normal",delete a.arg,t.completion=a}function Context(t){this.tryEntries=[{tryLoc:"root"}],forEach$1(t).call(t,pushTryEntry,this),this.reset(!0)}function values(t){if(t){var a=t[g];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var m=-1,h=function next(){for(;++m<t.length;)if(u.call(t,m))return next.value=t[m],next.done=!1,next;return next.value=void 0,next.done=!0,next};return h.next=h}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(M,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,_,"GeneratorFunction"),t.isGeneratorFunction=function(t){var a="function"==typeof t&&t.constructor;return!!a&&(a===GeneratorFunction||"GeneratorFunction"===(a.displayName||a.name))},t.mark=function(t){return vt?vt(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,_,"GeneratorFunction")),t.prototype=gt(M),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,h,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(a,u,m,g,h){void 0===h&&(h=Ho);var _=new AsyncIterator(wrap(a,u,m,g),h);return t.isGeneratorFunction(u)?_:_.next().then((function(t){return t.done?t.value:_.next()}))},defineIteratorMethods(M),define(M,_,"Generator"),define(M,g,(function(){return this})),define(M,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var a=[];for(var u in t)a.push(u);return reverse$1(a).call(a),function next(){for(;a.length;){var u=a.pop();if(u in t)return next.value=u,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){var a;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,forEach$1(a=this.tryEntries).call(a,resetTryEntry),!t)for(var m in this)"t"===m.charAt(0)&&u.call(this,m)&&!isNaN(+slice(m).call(m,1))&&(this[m]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var a=this;function handle(u,m){return h.type="throw",h.arg=t,a.next=u,m&&(a.method="next",a.arg=void 0),!!m}for(var m=this.tryEntries.length-1;m>=0;--m){var g=this.tryEntries[m],h=g.completion;if("root"===g.tryLoc)return handle("end");if(g.tryLoc<=this.prev){var _=u.call(g,"catchLoc"),E=u.call(g,"finallyLoc");if(_&&E){if(this.prev<g.catchLoc)return handle(g.catchLoc,!0);if(this.prev<g.finallyLoc)return handle(g.finallyLoc)}else if(_){if(this.prev<g.catchLoc)return handle(g.catchLoc,!0)}else{if(!E)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return handle(g.finallyLoc)}}}},abrupt:function abrupt(t,a){for(var m=this.tryEntries.length-1;m>=0;--m){var g=this.tryEntries[m];if(g.tryLoc<=this.prev&&u.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var h=g;break}}h&&("break"===t||"continue"===t)&&h.tryLoc<=a&&a<=h.finallyLoc&&(h=null);var _=h?h.completion:{};return _.type=t,_.arg=a,h?(this.method="next",this.next=h.finallyLoc,E):this.complete(_)},complete:function complete(t,a){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&a&&(this.next=a),E},finish:function finish(t){for(var a=this.tryEntries.length-1;a>=0;--a){var u=this.tryEntries[a];if(u.finallyLoc===t)return this.complete(u.completion,u.afterLoc),resetTryEntry(u),E}},catch:function _catch(t){for(var a=this.tryEntries.length-1;a>=0;--a){var u=this.tryEntries[a];if(u.tryLoc===t){var m=u.completion;if("throw"===m.type){var g=m.arg;resetTryEntry(u)}return g}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,a,u){return this.delegate={iterator:values(t),resultName:a,nextLoc:u},"next"===this.method&&(this.arg=void 0),E}},t}function _typeof(t){return _typeof="function"==typeof Wa&&"symbol"==typeof as?function(t){return typeof t}:function(t){return t&&"function"==typeof Wa&&t.constructor===Wa&&t!==Wa.prototype?"symbol":typeof t},_typeof(t)}function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,a){for(var u=0;u<a.length;u++){var m=a[u];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Ke(t,m.key,m)}}function _createClass(t,a,u){return a&&_defineProperties(t.prototype,a),u&&_defineProperties(t,u),Ke(t,"prototype",{writable:!1}),t}function __awaiter(t,a,u,m){function adopt(t){return t instanceof u?t:new u((function(a){a(t)}))}return new(u||(u=Ho))((function(u,g){function fulfilled(t){try{step(m.next(t))}catch(t){g(t)}}function rejected(t){try{step(m.throw(t))}catch(t){g(t)}}function step(t){t.done?u(t.value):adopt(t.value).then(fulfilled,rejected)}step((m=m.apply(t,a||[])).next())}))}var t={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:72e5},a=12,u=8e3,m=function emptyFn(){},g=function(){function Reporter(a){_classCallCheck(this,Reporter),this.isUploadEnable=!0,this.serverAllowUpload=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=t,this.configPath="dispatcher/req",this.dataReportPath="statics/report/common/form",this.traceMsgCache={},this.reqRetryCount=0,this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Jo(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(a),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return _createClass(Reporter,[{key:"setConfig",value:function setConfig(t){var a=Lt({},this.reportConfig.common,t.common);this.reportConfig=Lt({},this.reportConfig,t),this.reportConfig.common=a,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function reportImmediately(t,a){var u=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(t,Lt({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},a)).catch((function(t){var a,m;null===(m=null===(a=u.reportConfig)||void 0===a?void 0:a.logger)||void 0===m||m.warn("Reporter immediately upload failed",t)}))}},{key:"report",value:function report(a,u){var m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(m.priority||(m.priority=this.getEventPriority(a,u)),this.reportConfig.isDataReportEnable&&a){if("login"===a&&!1===u.succeed&&u.process_id){var g,h=u.extension&&find(g=u.extension).call(g,(function(t){return"TCP"===t.operation_type})),_=h&&h.target||"",E=u.process_id+_,T=this.lastFailLogin[E]||0;if(u.start_time-T<t.loginFailIgnoreInterval)return;this.lastFailLogin[E]=u.start_time}var S=Jo();"HIGH"===m.priority?this.highPriorityMsgList.push({module:a,msg:u,createTime:S}):"NORMAL"===m.priority?this.msgList.push({module:a,msg:u,createTime:S}):"LOW"===m.priority&&this.lowPriorityMsgList.push({module:a,msg:u,createTime:S}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function reportTraceStart(t,a){if(this.reportConfig.isDataReportEnable&&t&&!this.traceMsgCache[t]){var u=Lt(Lt({start_time:Jo()},a),{extension:[]});this.traceMsgCache[t]=u}}},{key:"reportTraceUpdate",value:function reportTraceUpdate(t){}},{key:"reportTraceUpdateV2",value:function reportTraceUpdateV2(t,a,u){var m,g=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[t]){var h=this.traceMsgCache[t].extension,_=h.length,E=(new Date).getTime();0===_?a.duration=E-this.traceMsgCache[t].start_time:h[_-1].end_time?a.duration=E-h[_-1].end_time:a.duration=E-this.traceMsgCache[t].start_time,h.push(Lt({end_time:E},a));var T=h.length-1;(null==u?void 0:u.asyncParams)&&((m=this.traceMsgCache[t]).asyncPromiseArray||(m.asyncPromiseArray=[]),this.traceMsgCache[t].asyncPromiseArray.push(u.asyncParams.then((function(a){g.traceMsgCache[t]&&g.traceMsgCache[t].extension[T]&&Lt(g.traceMsgCache[t].extension[T],a)}))))}}},{key:"reportTraceEnd",value:function reportTraceEnd(t){var a,u,m=this,g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[t])if("nos"!==t||!1===g){"boolean"==typeof g?this.traceMsgCache[t].succeed=!!g:this.traceMsgCache[t].state=g,this.traceMsgCache[t].duration=Jo()-this.traceMsgCache[t].start_time,forEach$1(a=this.traceMsgCache[t].extension).call(a,(function(t){delete t.end_time}));var h=this.traceMsgCache[t];if(this.traceMsgCache[t]=null,h.asyncPromiseArray){(u=this.endedAsyncMsgByModule)[t]||(u[t]=[]),this.endedAsyncMsgByModule[t].push(h);var _=function asyncCallback(){var a;m.endedAsyncMsgByModule[t]&&includes(a=m.endedAsyncMsgByModule[t]).call(a,h)&&(delete h.asyncPromiseArray,m.report(t,h,{priority:m.getEventPriority(t,h)}))};Ho.all(h.asyncPromiseArray).then(_).catch(_)}else this.report(t,h,{priority:this.getEventPriority(t,h)})}else this.traceMsgCache[t]=null}},{key:"getEventPriority",value:function getEventPriority(t,a){if("exceptions"===t){if(0===a.action)return"HIGH";if(2===a.action)return"HIGH";if(1===a.action&&0!==a.exception_service)return"HIGH"}else{if("msgReceive"===t)return"LOW";if("nim_api_trace"===t)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function reportTraceCancel(t){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[t]=[],this.traceMsgCache[t]=null)}},{key:"pause",value:function pause(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function restore(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function destroy(){var t,a=this;this.reportConfig.isDataReportEnable&&(forEach$1(t=Bt(this.traceMsgCache)).call(t,(function(t){a.reportTraceEnd(t,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=m,this.report=m,this.reportTraceStart=m,this.reportTraceUpdate=m,this.reportTraceEnd=m,this.pause=m,this.restore=m,this.destroy=m,this.reqRetryCount=0,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function initUploadConfig(){var t,m;return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function _callee(){var g,h,_,E,T,S=this;return _regeneratorRuntime().wrap((function _callee$(M){for(var I;;)switch(M.prev=M.next){case 0:if(!this.loading){M.next=2;break}return M.abrupt("return");case 2:this.loading=!0,g=this.reportConfig.common||{},h=map$6(I=this.reportConfig.compassDataEndpoint.split(",")).call(I,(function(t){var a;return concat(a="".concat(t,"/")).call(a,S.configPath)})),_=_regeneratorRuntime().mark((function _loop(_){return _regeneratorRuntime().wrap((function _loop$(E){for(;;)switch(E.prev=E.next){case 0:if(!S.initConfigLoaded&&!S.isDestroyed){E.next=2;break}return E.abrupt("return","break");case 2:return E.prev=2,E.next=5,S.reportConfig.request(h[_],{method:"GET",dataType:"json",params:{deviceId:g.dev_id,sdkVer:g.sdk_ver,platform:g.platform,hostEnv:g.host_env,appkey:g.app_key},timeout:S.reportConfig.timeout}).then((function(t){var a,u;if(!S.isDestroyed){if(200===t.status&&t.data&&200===t.data.code){S.initConfigLoaded=!0;var m=t.data.data||{};S.reportConfig.maxSize=m.maxSize>1e3?1e3:m.maxSize,S.reportConfig.maxInterval=m.maxInterval>1e4?1e4:m.maxInterval,S.reportConfig.maxInterval=m.maxInterval<10?10:m.maxInterval,S.reportConfig.minInterval=m.minInterval<2?2:m.minInterval,S.reportConfig.maxDelay=m.maxDelay||300,S.reportConfig.maxInterval=1e3*S.reportConfig.maxInterval,S.reportConfig.minInterval=1e3*S.reportConfig.minInterval,S.reportConfig.maxDelay=1e3*S.reportConfig.maxDelay,m.endpoint?S.dataReportEndpoint=m.endpoint:S.dataReportEndpoint=h[_],S.serverAllowUpload=!0,S.loading=!1,S.reportHeartBeat()}else 200===t.status&&(S.initConfigLoaded=!0);null===(u=null===(a=S.reportConfig)||void 0===a?void 0:a.logger)||void 0===u||u.log("Get reporter upload config success")}})).catch((function(t){var m,g;S.isDestroyed||(S.loading=!1,null===(g=null===(m=S.reportConfig)||void 0===m?void 0:m.logger)||void 0===g||g.error("Get reporter upload config failed",t),S.reqRetryCount<a&&(S.reqRetryCount++,sa((function(){S.isDestroyed||S.initUploadConfig()}),u)))}));case 5:E.next=14;break;case 7:if(E.prev=7,E.t0=E.catch(2),!S.isDestroyed){E.next=11;break}return E.abrupt("return",{v:void 0});case 11:S.loading=!1,null===(m=null===(t=S.reportConfig)||void 0===t?void 0:t.logger)||void 0===m||m.error("Exec reporter request failed",E.t0),S.reqRetryCount<a&&(S.reqRetryCount++,sa((function(){S.isDestroyed||S.initUploadConfig()}),u));case 14:case"end":return E.stop()}}),_loop,null,[[2,7]])})),E=0;case 7:if(!(E<h.length)){M.next=17;break}return M.delegateYield(_(E),"t0",9);case 9:if("break"!==(T=M.t0)){M.next=12;break}return M.abrupt("break",17);case 12:if("object"!==_typeof(T)){M.next=14;break}return M.abrupt("return",T.v);case 14:E++,M.next=7;break;case 17:case"end":return M.stop()}}),_callee,this)})))}},{key:"reportHeartBeat",value:function reportHeartBeat(){var t=this;this.isDestroyed||(this.timer=sa((function(){t.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function doReport(){if(!this.isDestroyed){var t=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Jo()-this.lastReportTime>=t&&this.upload()}}},{key:"getUploadMsg",value:function getUploadMsg(){var t,a,u,m,g,h,_=this,E={},T=Jo();this.highPriorityMsgList=filter(t=this.highPriorityMsgList).call(t,(function(t){return T-t.createTime<_.reportConfig.maxDelay})),this.msgList=filter(a=this.msgList).call(a,(function(t){return T-t.createTime<_.reportConfig.maxDelay})),this.lowPriorityMsgList=filter(u=this.lowPriorityMsgList).call(u,(function(t){return T-t.createTime<_.reportConfig.maxDelay})),this.cacheMsgList=filter(m=this.cacheMsgList).call(m,(function(t){return T-t.createTime<_.reportConfig.maxDelay}));var S=slice(g=this.highPriorityMsgList).call(g,0,this.reportConfig.maxSize);if(this.highPriorityMsgList=slice(h=this.highPriorityMsgList).call(h,S.length),S.length<this.reportConfig.maxSize){var M,I,A=this.reportConfig.maxSize-S.length;S=concat(S).call(S,slice(M=this.msgList).call(M,0,A)),this.msgList=slice(I=this.msgList).call(I,A)}if(S.length<this.reportConfig.maxSize){var b,N,C=this.reportConfig.maxSize-S.length;S=concat(S).call(S,slice(b=this.lowPriorityMsgList).call(b,0,C)),this.lowPriorityMsgList=slice(N=this.lowPriorityMsgList).call(N,C)}if(S.length<this.reportConfig.maxSize){var R,O,w=this.reportConfig.maxSize-S.length;S=concat(S).call(S,slice(R=this.cacheMsgList).call(R,0,w)),this.cacheMsgList=slice(O=this.cacheMsgList).call(O,w)}return forEach$1(S).call(S,(function(t){E[t.module]?E[t.module].push(t.msg):E[t.module]=[t.msg]})),{uploadMsgArr:S,uploadMsg:E}}},{key:"upload",value:function upload(){var t,a,u=this;if(this.isUploadEnable&&this.serverAllowUpload&&!(this.lastReportTime&&Jo()-this.lastReportTime<this.reportConfig.minInterval)){var m=this.getUploadMsg(),g=m.uploadMsgArr,h=m.uploadMsg;if(g.length){this.lastReportTime=Jo();try{var _,E=concat(_="".concat(this.dataReportEndpoint,"/")).call(_,this.dataReportPath);this.reportConfig.request(E,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:h},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(t){var a,m,h,_;u.cacheMsgList=slice(a=concat(m=u.cacheMsgList).call(m,g)).call(a,0,u.reportConfig.cacheMaxSize),null===(_=null===(h=u.reportConfig)||void 0===h?void 0:h.logger)||void 0===_||_.warn("Reporter upload failed",t)}))}catch(u){null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.warn("Exec reporter request failed",u)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),Reporter}();return g}()})),ws=entryVirtual("Array").values,ks=Array.prototype,xs={DOMTokenList:!0,NodeList:!0},values=function(t){var a=t.values;return t===ks||j(ks,t)&&a===ks.values||le(xs,Er(t))?ws:a},Ps=tt.indexOf,Ls=b([].indexOf),Ds=!!Ls&&1/Ls([1],1,-0)<0,Vs=arrayMethodIsStrict("indexOf");_export({target:"Array",proto:!0,forced:Ds||!Vs},{indexOf:function indexOf(t){var a=arguments.length>1?arguments[1]:void 0;return Ds?Ls(this,t,a)||0:Ps(this,t,a)}});var Us=entryVirtual("Array").indexOf,Fs=Array.prototype,indexOf=function(t){var a=t.indexOf;return t===Fs||j(Fs,t)&&a===Fs.indexOf?Us:a},Bs=Qr.every,Gs=arrayMethodIsStrict("every");_export({target:"Array",proto:!0,forced:!Gs},{every:function every(t){return Bs(this,t,arguments.length>1?arguments[1]:void 0)}});var Hs=entryVirtual("Array").every,js=Array.prototype,every=function(t){var a=t.every;return t===js||j(js,t)&&a===js.every?Hs:a};var qs=fails((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Ys=Object.isExtensible,Ks=fails((function(){Ys(1)}))||qs?function isExtensible(t){return!!G(t)&&((!qs||"ArrayBuffer"!=classofRaw(t))&&(!Ys||Ys(t)))}:Ys,Ws=!fails((function(){return Object.isExtensible(Object.preventExtensions({}))})),$s=createCommonjsModule((function(t){var a=Be.f,u=!1,m=uid("meta"),g=0,setMetadata=function(t){a(t,m,{value:{objectID:"O"+g++,weakData:{}}})},h=t.exports={enable:function(){h.enable=function(){},u=!0;var t=Vn.f,a=b([].splice),g={};g[m]=1,t(g).length&&(Vn.f=function(u){for(var g=t(u),h=0,_=g.length;h<_;h++)if(g[h]===m){a(g,h,1);break}return g},_export({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:ma.f}))},fastKey:function(t,a){if(!G(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!le(t,m)){if(!Ks(t))return"F";if(!a)return"E";setMetadata(t)}return t[m].objectID},getWeakData:function(t,a){if(!le(t,m)){if(!Ks(t))return!0;if(!a)return!1;setMetadata(t)}return t[m].weakData},onFreeze:function(t){return Ws&&u&&Ks(t)&&!le(t,m)&&setMetadata(t),t}};rt[m]=!0})),zs=Be.f,Js=Qr.forEach,Xs=tr.set,Qs=tr.getterFor,defineBuiltIns=function(t,a,u){for(var m in a)u&&u.unsafe&&t[m]?t[m]=a[m]:defineBuiltIn(t,m,a[m],u);return t},Zs=Be.f,ec=$s.fastKey,tc=tr.set,rc=tr.getterFor,nc={getConstructor:function(t,a,u,m){var g=t((function(t,g){anInstance(t,h),tc(t,{type:a,index:pt(null),first:void 0,last:void 0,size:0}),N||(t.size=0),isNullOrUndefined(g)||iterate(g,t[m],{that:t,AS_ENTRIES:u})})),h=g.prototype,_=rc(a),define=function(t,a,u){var m,g,h=_(t),E=getEntry(t,a);return E?E.value=u:(h.last=E={index:g=ec(a,!0),key:a,value:u,previous:m=h.last,next:void 0,removed:!1},h.first||(h.first=E),m&&(m.next=E),N?h.size++:t.size++,"F"!==g&&(h.index[g]=E)),t},getEntry=function(t,a){var u,m=_(t),g=ec(a);if("F"!==g)return m.index[g];for(u=m.first;u;u=u.next)if(u.key==a)return u};return defineBuiltIns(h,{clear:function clear(){for(var t=_(this),a=t.index,u=t.first;u;)u.removed=!0,u.previous&&(u.previous=u.previous.next=void 0),delete a[u.index],u=u.next;t.first=t.last=void 0,N?t.size=0:this.size=0},delete:function(t){var a=this,u=_(a),m=getEntry(a,t);if(m){var g=m.next,h=m.previous;delete u.index[m.index],m.removed=!0,h&&(h.next=g),g&&(g.previous=h),u.first==m&&(u.first=g),u.last==m&&(u.last=h),N?u.size--:a.size--}return!!m},forEach:function forEach(t){for(var a,u=_(this),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);a=a?a.next:u.first;)for(m(a.value,a.key,this);a&&a.removed;)a=a.previous},has:function has(t){return!!getEntry(this,t)}}),defineBuiltIns(h,u?{get:function get(t){var a=getEntry(this,t);return a&&a.value},set:function set(t,a){return define(this,0===t?0:t,a)}}:{add:function add(t){return define(this,t=0===t?0:t,t)}}),N&&Zs(h,"size",{get:function(){return _(this).size}}),g},setStrong:function(t,a,u){var m=a+" Iterator",g=rc(a),h=rc(m);iteratorDefine(t,a,(function(t,a){tc(this,{type:m,target:t,state:g(t),kind:a,last:void 0})}),(function(){for(var t=h(this),a=t.kind,u=t.last;u&&u.removed;)u=u.previous;return t.target&&(t.last=u=u?u.next:t.state.first)?"keys"==a?{value:u.key,done:!1}:"values"==a?{value:u.value,done:!1}:{value:[u.key,u.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),u?"entries":"values",!u,!0),setSpecies(a)}};!function(t,a,u){var g,h=-1!==t.indexOf("Map"),_=-1!==t.indexOf("Weak"),E=h?"set":"add",T=m[t],S=T&&T.prototype,M={};if(N&&isCallable(T)&&(_||S.forEach&&!fails((function(){(new T).entries().next()})))){var I=(g=a((function(a,u){Xs(anInstance(a,I),{type:t,collection:new T}),null!=u&&iterate(u,a[E],{that:a,AS_ENTRIES:h})}))).prototype,A=Qs(t);Js(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(t){var a="add"==t||"set"==t;!(t in S)||_&&"clear"==t||Ge(I,t,(function(u,m){var g=A(this).collection;if(!a&&_&&!G(u))return"get"==t&&void 0;var h=g[t](0===u?0:u,m);return a?this:h}))})),_||zs(I,"size",{configurable:!0,get:function(){return A(this).collection.size}})}else g=u.getConstructor(a,t,h,E),$s.enable();setToStringTag(g,t,!1,!0),M[t]=g,_export({global:!0,forced:!0},M),_||u.setStrong(g,t,h)}("Map",(function(t){return function Map(){return t(this,arguments.length?arguments[0]:void 0)}}),nc);var ic=H.Map,oc=[].push;_export({target:"Map",stat:!0,forced:!0},{from:function from(t){var a,u,m,g,h=arguments.length,_=h>1?arguments[1]:void 0;return aConstructor(this),(a=void 0!==_)&&aCallable(_),isNullOrUndefined(t)?new this:(u=[],a?(m=0,g=functionBindContext(_,h>2?arguments[2]:void 0),iterate(t,(function(t){R(oc,u,g(t,m++))}))):iterate(t,oc,{that:u}),new this(u))}});_export({target:"Map",stat:!0,forced:!0},{of:function of(){return new this(yt(arguments))}});_export({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function deleteAll(){for(var t,a=anObject(this),u=aCallable(a.delete),m=!0,g=0,h=arguments.length;g<h;g++)t=R(u,a,arguments[g]),m=m&&t;return!!m}});_export({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function emplace(t,a){var u,m,g=anObject(this),h=aCallable(g.get),_=aCallable(g.has),E=aCallable(g.set);return R(_,g,t)?(u=R(h,g,t),"update"in a&&(u=a.update(u,t,g),R(E,g,t,u)),u):(m=a.insert(t,g),R(E,g,t,m),m)}});var ac=getIterator;_export({target:"Map",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),u=ac(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(u,(function(t,u,g){if(!m(u,t,a))return g()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),u=ac(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),g=new(speciesConstructor(a,getBuiltIn("Map"))),h=aCallable(g.set);return iterate(u,(function(t,u){m(u,t,a)&&R(h,g,t,u)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),g}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),u=ac(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(u,(function(t,u,g){if(m(u,t,a))return g(u)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function findKey(t){var a=anObject(this),u=ac(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(u,(function(t,u,g){if(m(u,t,a))return g(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var sc=b([].push);_export({target:"Map",stat:!0,forced:!0},{groupBy:function groupBy(t,a){aCallable(a);var u=getIterator(t),m=new this,g=aCallable(m.has),h=aCallable(m.get),_=aCallable(m.set);return iterate(u,(function(t){var u=a(t);R(g,m,u)?sc(R(h,m,u),t):R(_,m,u,[t])}),{IS_ITERATOR:!0}),m}});_export({target:"Map",proto:!0,real:!0,forced:!0},{includes:function includes(t){return iterate(ac(anObject(this)),(function(a,u,m){if((g=u)===(h=t)||g!=g&&h!=h)return m();var g,h}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",stat:!0,forced:!0},{keyBy:function keyBy(t,a){var u=new this;aCallable(a);var m=aCallable(u.set);return iterate(t,(function(t){R(m,u,a(t),t)})),u}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function keyOf(t){return iterate(ac(anObject(this)),(function(a,u,m){if(u===t)return m(a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function mapKeys(t){var a=anObject(this),u=ac(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),g=new(speciesConstructor(a,getBuiltIn("Map"))),h=aCallable(g.set);return iterate(u,(function(t,u){R(h,g,m(u,t,a),u)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),g}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function mapValues(t){var a=anObject(this),u=ac(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),g=new(speciesConstructor(a,getBuiltIn("Map"))),h=aCallable(g.set);return iterate(u,(function(t,u){R(h,g,t,m(u,t,a))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),g}}),_export({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function merge(t){for(var a=anObject(this),u=aCallable(a.set),m=arguments.length,g=0;g<m;)iterate(arguments[g++],u,{that:a,AS_ENTRIES:!0});return a}});var cc=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),u=ac(a),m=arguments.length<2,g=m?void 0:arguments[1];if(aCallable(t),iterate(u,(function(u,h){m?(m=!1,g=h):g=t(g,h,u,a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),m)throw cc("Reduce of empty map with no initial value");return g}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),u=ac(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(u,(function(t,u,g){if(m(u,t,a))return g()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var lc=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{update:function update(t,a){var u=anObject(this),m=aCallable(u.get),g=aCallable(u.has),h=aCallable(u.set),_=arguments.length;aCallable(a);var E=R(g,u,t);if(!E&&_<3)throw lc("Updating absent value");var T=E?R(m,u,t):aCallable(_>2?arguments[2]:void 0)(t,u);return R(h,u,t,a(T,t,u)),u}});var uc=TypeError,dc=function upsert(t,a){var u,m=anObject(this),g=aCallable(m.get),h=aCallable(m.has),_=aCallable(m.set),E=arguments.length>2?arguments[2]:void 0;if(!isCallable(a)&&!isCallable(E))throw uc("At least one callback required");return R(h,m,t)?(u=R(g,m,t),isCallable(a)&&(u=a(u),R(_,m,t,u))):isCallable(E)&&(u=E(),R(_,m,t,u)),u};_export({target:"Map",proto:!0,real:!0,forced:!0},{upsert:dc}),_export({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:dc});var pc=ic,mc=createCommonjsModule((function(t){function _getPrototypeOf(a){var u;return t.exports=_getPrototypeOf=vt?bind$1(u=za).call(u):function _getPrototypeOf(t){return t.__proto__||za(t)},t.exports.__esModule=!0,t.exports.default=t.exports,_getPrototypeOf(a)}t.exports=_getPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),gc=createCommonjsModule((function(t){t.exports=function _isNativeFunction(t){var a;return-1!==indexOf(a=Function.toString.call(t)).call(a,"[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports})),fc=getBuiltIn("Reflect","construct"),hc=Object.prototype,_c=[].push,vc=fails((function(){function F(){}return!(fc((function(){}),[],F)instanceof F)})),yc=!fails((function(){fc((function(){}))})),Ec=vc||yc;_export({target:"Reflect",stat:!0,forced:Ec,sham:Ec},{construct:function construct(t,a){aConstructor(t),anObject(a);var u=arguments.length<3?t:aConstructor(arguments[2]);if(yc&&!vc)return fc(t,a,u);if(t==u){switch(a.length){case 0:return new t;case 1:return new t(a[0]);case 2:return new t(a[0],a[1]);case 3:return new t(a[0],a[1],a[2]);case 4:return new t(a[0],a[1],a[2],a[3])}var m=[null];return T(_c,m,a),new(T(It,t,m))}var g=u.prototype,h=pt(G(g)?g:hc),_=T(t,h,a);return G(_)?_:h}});var Tc=H.Reflect.construct,Sc=createCommonjsModule((function(t){t.exports=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Tc)return!1;if(Tc.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Tc(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports})),Mc=createCommonjsModule((function(t){function _construct(a,u,m){var g;Sc()?(t.exports=_construct=bind$1(g=Tc).call(g),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=_construct=function _construct(t,a,u){var m=[null];m.push.apply(m,a);var g=new(bind$1(Function).apply(t,m));return u&&Nt(g,u.prototype),g},t.exports.__esModule=!0,t.exports.default=t.exports);return _construct.apply(null,arguments)}t.exports=_construct,t.exports.__esModule=!0,t.exports.default=t.exports})),Ic=createCommonjsModule((function(t){function _wrapNativeSuper(a){var u="function"==typeof pc?new pc:void 0;return t.exports=_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!gc(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==u){if(u.has(t))return u.get(t);u.set(t,Wrapper)}function Wrapper(){return Mc(t,arguments,mc(this).constructor)}return Wrapper.prototype=gt(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),Nt(Wrapper,t)},t.exports.__esModule=!0,t.exports.default=t.exports,_wrapNativeSuper(a)}t.exports=_wrapNativeSuper,t.exports.__esModule=!0,t.exports.default=t.exports})),Ac=getDefaultExportFromCjs(Ic),bc=TypeError,createMethod$1=function(t){return function(a,u,m,g){aCallable(u);var h=toObject(a),_=V(h),E=lengthOfArrayLike(h),T=t?E-1:0,S=t?-1:1;if(m<2)for(;;){if(T in _){g=_[T],T+=S;break}if(T+=S,t?T<0:E<=T)throw bc("Reduce of empty array with no initial value")}for(;t?T>=0:E>T;T+=S)T in _&&(g=u(g,_[T],T,h));return g}},Nc={left:createMethod$1(!1),right:createMethod$1(!0)}.left,Cc=arrayMethodIsStrict("reduce");_export({target:"Array",proto:!0,forced:!Cc||!ci&&z>79&&z<83},{reduce:function reduce(t){var a=arguments.length;return Nc(this,t,a,a>1?arguments[1]:void 0)}});var Rc,Oc,wc,kc,xc,Pc,Lc,Dc,Vc,Uc,Fc,Bc,Gc,Hc,jc,qc,Yc,Kc,Wc,$c,zc,Jc,Xc,Qc,Zc,el,tl,rl,nl,il,ol,al,sl,cl,ll,ul,dl,pl,ml,gl,fl,hl,_l,vl,yl,El,Tl,Sl,Ml,Il,Al,bl,Nl,Cl,Rl,Ol,wl=entryVirtual("Array").reduce,kl=Array.prototype,reduce=function(t){var a=t.reduce;return t===kl||j(kl,t)&&a===kl.reduce?wl:a};!function(t){t[t.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",t[t.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC"}(Rc||(Rc={})),function(t){t[t.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",t[t.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",t[t.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(Oc||(Oc={})),function(t){t[t.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",t[t.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",t[t.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(wc||(wc={})),function(t){t[t.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",t[t.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",t[t.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",t[t.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(kc||(kc={})),function(t){t[t.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",t[t.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",t[t.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(xc||(xc={})),function(t){t[t.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",t[t.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(Pc||(Pc={})),function(t){t[t.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",t[t.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(Lc||(Lc={})),function(t){t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(Dc||(Dc={})),function(t){t[t.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",t[t.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(Vc||(Vc={})),function(t){t[t.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",t[t.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",t[t.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",t[t.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(Uc||(Uc={})),function(t){t[t.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",t[t.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",t[t.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(Fc||(Fc={})),function(t){t[t.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",t[t.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",t[t.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",t[t.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(Bc||(Bc={})),function(t){t[t.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",t[t.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",t[t.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",t[t.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",t[t.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",t[t.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",t[t.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",t[t.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",t[t.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(Gc||(Gc={})),function(t){t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",t[t.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(Hc||(Hc={})),function(t){t[t.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(jc||(jc={})),function(t){t[t.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",t[t.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(qc||(qc={})),function(t){t[t.NIM_MESSAGE_AI_STREAM_STATUS_STREAMING=-1]="NIM_MESSAGE_AI_STREAM_STATUS_STREAMING",t[t.NIM_MESSAGE_AI_STREAM_STATUS_NONE=0]="NIM_MESSAGE_AI_STREAM_STATUS_NONE",t[t.NIM_MESSAGE_AI_STREAM_STATUS_PLACEHOLDER=1]="NIM_MESSAGE_AI_STREAM_STATUS_PLACEHOLDER",t[t.NIM_MESSAGE_AI_STREAM_STATUS_CANCEL=2]="NIM_MESSAGE_AI_STREAM_STATUS_CANCEL",t[t.NIM_MESSAGE_AI_STREAM_STATUS_UPDATE=3]="NIM_MESSAGE_AI_STREAM_STATUS_UPDATE",t[t.NIM_MESSAGE_AI_STREAM_STATUS_COMPLETE=4]="NIM_MESSAGE_AI_STREAM_STATUS_COMPLETE",t[t.NIM_MESSAGE_AI_STREAM_STATUS_EXCEPTION=5]="NIM_MESSAGE_AI_STREAM_STATUS_EXCEPTION"}(Yc||(Yc={})),function(t){t[t.V2NIM_MESSAGE_AI_STREAM_STOP_OP_DEFAULT=0]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_DEFAULT",t[t.V2NIM_MESSAGE_AI_STREAM_STOP_OP_REVOKE=1]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_REVOKE",t[t.V2NIM_MESSAGE_AI_STREAM_STOP_OP_UPDATE=2]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_UPDATE"}(Kc||(Kc={})),function(t){t[t.V2NIM_MESSAGE_AI_REGEN_OP_UPDATE=1]="V2NIM_MESSAGE_AI_REGEN_OP_UPDATE",t[t.V2NIM_MESSAGE_AI_REGEN_OP_NEW=2]="V2NIM_MESSAGE_AI_REGEN_OP_NEW"}(Wc||(Wc={})),function(t){t[t.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",t[t.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",t[t.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}($c||($c={})),function(t){t[t.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",t[t.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",t[t.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",t[t.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",t[t.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",t[t.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",t[t.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",t[t.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",t[t.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",t[t.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",t[t.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",t[t.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",t[t.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(zc||(zc={})),function(t){t[t.V2NIM_SEARCH_KEYWORD_MATCH_TYPE_OR=0]="V2NIM_SEARCH_KEYWORD_MATCH_TYPE_OR",t[t.V2NIM_SEARCH_KEYWORD_MATCH_TYPE_AND=1]="V2NIM_SEARCH_KEYWORD_MATCH_TYPE_AND"}(Jc||(Jc={})),function(t){t[t.V2NIM_SEARCH_DIRECTION_BACKWARD=0]="V2NIM_SEARCH_DIRECTION_BACKWARD",t[t.V2NIM_SEARCH_DIRECTION_FORWARD=1]="V2NIM_SEARCH_DIRECTION_FORWARD"}(Xc||(Xc={})),function(t){t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(Qc||(Qc={})),function(t){t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(Zc||(Zc={})),function(t){t[t.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",t[t.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",t[t.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(el||(el={})),function(t){t[t.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",t[t.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(tl||(tl={})),function(t){t[t.V2NIM_CLEAR_HISTORY_MODE_ALL=0]="V2NIM_CLEAR_HISTORY_MODE_ALL",t[t.V2NIM_CLEAR_HISTORY_MODE_LOCAL=1]="V2NIM_CLEAR_HISTORY_MODE_LOCAL",t[t.V2NIM_CLEAR_HISTORY_MODE_LOCAL_IRREPARABLY=2]="V2NIM_CLEAR_HISTORY_MODE_LOCAL_IRREPARABLY"}(rl||(rl={})),function(t){t[t.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",t[t.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(nl||(nl={})),function(t){t[t.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",t[t.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",t[t.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(il||(il={})),function(t){t[t.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",t[t.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(ol||(ol={})),function(t){t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(al||(al={})),function(t){t[t.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",t[t.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(sl||(sl={})),function(t){t[t.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",t[t.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",t[t.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",t[t.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",t[t.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",t[t.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",t[t.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",t[t.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(cl||(cl={})),function(t){t[t.NIM_MESSAGE_STREAM_STATUS_STREAMING=-1]="NIM_MESSAGE_STREAM_STATUS_STREAMING",t[t.NIM_MESSAGE_STREAM_STATUS_NONE=0]="NIM_MESSAGE_STREAM_STATUS_NONE",t[t.NIM_MESSAGE_STREAM_STATUS_PLACEHOLDER=1]="NIM_MESSAGE_STREAM_STATUS_PLACEHOLDER",t[t.NIM_MESSAGE_STREAM_STATUS_CANCEL=2]="NIM_MESSAGE_STREAM_STATUS_CANCEL",t[t.NIM_MESSAGE_AI_STREAM_STATUS_UPDATE=3]="NIM_MESSAGE_AI_STREAM_STATUS_UPDATE",t[t.NIM_MESSAGE_STREAM_STATUS_COMPLETE=4]="NIM_MESSAGE_STREAM_STATUS_COMPLETE",t[t.NIM_MESSAGE_STREAM_STATUS_EXCEPTION=5]="NIM_MESSAGE_STREAM_STATUS_EXCEPTION"}(ll||(ll={})),function(t){t[t.V2NIM_MESSAGE_SOURCE_UNKNOWN=0]="V2NIM_MESSAGE_SOURCE_UNKNOWN",t[t.V2NIM_MESSAGE_SOURCE_ONLINE=1]="V2NIM_MESSAGE_SOURCE_ONLINE",t[t.V2NIM_MESSAGE_SOURCE_OFFLINE=2]="V2NIM_MESSAGE_SOURCE_OFFLINE",t[t.V2NIM_MESSAGE_SOURCE_ROAMING=3]="V2NIM_MESSAGE_SOURCE_ROAMING"}(ul||(ul={})),function(t){t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(dl||(dl={})),function(t){t[t.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",t[t.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(pl||(pl={})),function(t){t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(ml||(ml={})),function(t){t[t.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",t[t.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",t[t.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(gl||(gl={})),function(t){t[t.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",t[t.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",t[t.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(fl||(fl={})),function(t){t[t.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",t[t.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(hl||(hl={})),function(t){t[t.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",t[t.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(_l||(_l={})),function(t){t[t.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",t[t.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(vl||(vl={})),function(t){t[t.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",t[t.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",t[t.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=3]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(yl||(yl={})),function(t){t[t.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",t[t.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(El||(El={})),function(t){t[t.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",t[t.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",t[t.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(Tl||(Tl={})),function(t){t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(Sl||(Sl={})),function(t){t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(Ml||(Ml={})),function(t){t[t.teamApply=0]="teamApply",t[t.teamApplyReject=1]="teamApplyReject",t[t.teamInvite=2]="teamInvite",t[t.teamInviteReject=3]="teamInviteReject",t[t.tlistUpdate=4]="tlistUpdate",t[t.superTeamApply=15]="superTeamApply",t[t.superTeamApplyReject=16]="superTeamApplyReject",t[t.superTeamInvite=17]="superTeamInvite",t[t.superTeamInviteReject=18]="superTeamInviteReject"}(Il||(Il={})),function(t){t[t.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",t[t.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",t[t.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",t[t.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}(Al||(Al={})),function(t){t[t.V2NIM_AI_MODEL_STREAM_CALL_STATUS_NONE=0]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_NONE",t[t.V2NIM_AI_MODEL_STREAM_CALL_STATUS_CANCEL=2]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_CANCEL",t[t.V2NIM_AI_MODEL_STREAM_CALL_STATUS_COMPLETE=4]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_COMPLETE",t[t.V2NIM_AI_MODEL_STREAM_CALL_STATUS_EXCEPTION=5]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_EXCEPTION"}(bl||(bl={})),function(t){t.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",t.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",t.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}(Nl||(Nl={})),function(t){t[t.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",t[t.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",t[t.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",t[t.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",t[t.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",t[t.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL",t[t.V2NIM_SIGNALLING_EVENT_TYPE_KICK=9]="V2NIM_SIGNALLING_EVENT_TYPE_KICK"}(Cl||(Cl={})),function(t){t[t.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",t[t.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",t[t.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(Rl||(Rl={})),function(t){t[t.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",t[t.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",t[t.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",t[t.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(Ol||(Ol={}));var xl={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failedï¼use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_IS_NOT_STICK_TOP:{code:110305,message:"conversation is not stick top"},V2NIM_ERROR_CODE_STICK_TOP_DISABLED:{code:110306,message:"conversation stick top disabled"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"},V2NIM_ERROR_CODE_STREAM_OUTPUT_STOPPED:{code:189318,message:"Streaming text response stopped"},V2NIM_ERROR_CODE_STREAM_OUTPUT_GENERATED:{code:189319,message:"Streaming text response generated"},V2NIM_ERROR_CODE_STREAM_OUTPUT_ABORTED:{code:189320,message:"Streaming text response aborted due to exception"},V2NIM_ERROR_CODE_INTERRUPTION_REJECTED:{code:189321,message:"Non-streaming messages cannot be interrupted"}},Pl=Bt(xl),Ll=reduce(Pl).call(Pl,(function(t,a){var u=xl[a];return t[a]=u.code,t}),{}),Dl=reduce(Pl).call(Pl,(function(t,a){var u=xl[a];return t[u.code]=u.message,t}),{}),Vl=function(t){function V2NIMErrorImpl(a){var u;return(u=t.call(this,a.desc)||this).name="V2NIMError",u.code=a.code||0,u.desc=a.desc||Dl[u.code]||jl[u.code]||"",u.message=u.desc,u.detail=a.detail||{},u}return Ct(V2NIMErrorImpl,t),V2NIMErrorImpl.prototype.toString=function toString(){var t,a=this.name+"\n code: "+this.code+'\n message: "'+this.message+'"\n detail: '+(this.detail?Pn(this.detail):"");return(null===(t=null==this?void 0:this.detail)||void 0===t?void 0:t.rawError)&&(a+="\n rawError: "+this.detail.rawError.message),a},V2NIMErrorImpl}(Ac(Error));var Ul=function(t){function ValidateError(a,u,m){var g;return void 0===u&&(u={}),(g=t.call(this,{code:Ll.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:a,rules:m,data:u}})||this).name="validateError",g.message=g.message+"\n"+Pn(g.detail,null,2),g.data=u,g.rules=m,g}return Ct(ValidateError,t),ValidateError}(Vl),Fl=function(t){function ValidateErrorV2(a){var u,m,g,h;return(u=t.call(this,{code:Ll.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(m=a.detail)||void 0===m?void 0:m.reason,rules:null===(g=a.detail)||void 0===g?void 0:g.rules,data:null===(h=a.detail)||void 0===h?void 0:h.data}})||this).name="ValidateErrorV2",u}return Ct(ValidateErrorV2,t),ValidateErrorV2}(Vl),Bl=function(t){function FormatError(a,u,m){var g;return(g=t.call(this,{code:Ll.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:a,key:u,rules:m}})||this).name="formatError",g}return Ct(FormatError,t),FormatError}(Vl),Gl=function(t){function UploadError(a){var u;return(u=t.call(this,Lt({code:400},a))||this).desc=u.desc||"upload file error",u.message=u.desc,u.name="uploadError",u}return Ct(UploadError,t),UploadError}(Vl),Hl=function(t){function CustomError(a,u,m){var g;return void 0===u&&(u={}),void 0===m&&(m=400),(g=t.call(this,{code:m,desc:a,detail:u})||this).name="customError",g.data=u,g}return Ct(CustomError,t),CustomError}(Vl),jl={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"};function replacer(t,a){return a instanceof RegExp?"__REGEXP "+a.toString():a}function validate(t,a,u,m){var g;void 0===a&&(a={}),void 0===m&&(m=!1);var h={};return forEach$1(g=Bt(t)).call(g,(function(g){var _=t[g].type,E=u?"In "+u+", ":"";if(null==a){var T=E+"param is null or undefined";throw m?new Fl({detail:{reason:T,data:{key:g},rules:"required"}}):new Ul(T,{key:g},"required")}if(void 0===a[g]){if(!1===t[g].required)return void(h[g]=a[g]);var S=E+"param '"+g+"' is required";throw m?new Fl({detail:{reason:S,data:{key:g},rules:"required"}}):new Ul(S,{key:g},"required")}var M=ql[_];if(M&&!M(a,g,t[g],m)){var I=E+"param '"+g+"' unexpected",A={key:g,value:a[g]};throw m?new Fl({detail:{reason:I,data:A,rules:Pn(t[g],replacer)}}):new Ul(I,A,Pn(t[g],replacer))}h[g]=a[g]})),h}var ql={string:function string(t,a,u){var m=u.allowEmpty,g=u.max,h=u.min,_=u.regExp,E=t[a];return"string"==typeof E&&((!1!==m||""!==E)&&(!("number"==typeof g&&E.length>g)&&(!("number"==typeof h&&E.length<h)&&!(function isRegExp(t){return"[object RegExp]"===Object.prototype.toString.call(t)}(_)&&!_.test(E)))))},number:function number(t,a,u){var m=u.min,g=u.max,h=t[a];return"number"==typeof h&&(!("number"==typeof m&&h<m)&&!("number"==typeof g&&h>g))},boolean:function boolean(t,a){return"boolean"==typeof t[a]},file:function file(t,a){return!0},enum:function _enum(t,a,u){var m=values(u),g=t[a];return!m||indexOf(m).call(m,g)>-1},jsonstr:function jsonstr(t,a){try{var u=JSON.parse(t[a]);return"object"==typeof u&&null!==u}catch(t){return!1}},func:function func(t,a){return"function"==typeof t[a]},array:function array(t,a,u,m){void 0===m&&(m=!1);var g=u.itemType,h=u.itemRules,_=u.rules,E=u.min,T=u.max,S=values(u),M=t[a];if(!Ln(M))return!1;if("number"==typeof T&&M.length>T)return!1;if("number"==typeof E&&M.length<E)return!1;if(h)forEach$1(M).call(M,(function(t,u){var g,_;validate(((g={})[u]=h,g),((_={})[u]=t,_),a+"["+u+"]",m)}));else if(_)forEach$1(M).call(M,(function(t,u){return validate(_,t,a+"["+u+"]",m)}));else if("enum"===g){if(S&&function difference(t,a){return a=a||[],filter(t=t||[]).call(t,(function(t){return-1===indexOf(a).call(a,t)}))}(M,S).length)return!1}else if(g&&!every(M).call(M,(function(t){return typeof t===g})))return!1;return!0},object:function object(t,a,u,m){void 0===m&&(m=!1);var g=u.rules,h=u.allowEmpty,_=t[a];if("object"!=typeof _||null===_)return!1;if(g){var E=Bt(g),T=Bt(_),S=filter(T).call(T,(function(t){return indexOf(E).call(E,t)>-1}));if(!1===h&&0===S.length)return!1;validate(g,_,a,m)}return!0}},callWithSafeIterationClosing=function(t,a,u,m){try{return m?a(anObject(u)[0],u[1]):a(u)}catch(a){iteratorClose(t,"throw",a)}},Yl=Array,Kl=!checkCorrectnessOfIteration((function(t){Array.from(t)}));_export({target:"Array",stat:!0,forced:Kl},{from:function from(t){var a=toObject(t),u=$r(this),m=arguments.length,g=m>1?arguments[1]:void 0,h=void 0!==g;h&&(g=functionBindContext(g,m>2?arguments[2]:void 0));var _,E,T,S,M,I,A=getIteratorMethod$5(a),b=0;if(!A||this===Yl&&isArrayIteratorMethod(A))for(_=lengthOfArrayLike(a),E=u?new this(_):Yl(_);_>b;b++)I=h?g(a[b],b):a[b],createProperty(E,b,I);else for(M=(S=getIterator(a,A)).next,E=u?new this:[];!(T=R(M,S)).done;b++)I=h?callWithSafeIterationClosing(S,g,[T.value,b],!0):T.value,createProperty(E,b,I);return E.length=b,E}});var Wl=H.Array.from,$l=getIteratorMethod$5;function _createForOfIteratorHelperLoose$5(t,a){var u,m=void 0!==Wa&&$l(t)||t["@@iterator"];if(m)return bind$1(u=(m=m.call(t)).next).call(u,m);if(Ln(t)||(m=function _unsupportedIterableToArray$5(t,a){if(t){var u;if("string"==typeof t)return _arrayLikeToArray$5(t,a);var m=slice(u={}.toString.call(t)).call(u,8,-1);return"Object"===m&&t.constructor&&(m=t.constructor.name),"Map"===m||"Set"===m?Wl(t):"Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?_arrayLikeToArray$5(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var g=0;return function(){return g>=t.length?{done:!0}:{done:!1,value:t[g++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$5(t,a){(null==a||a>t.length)&&(a=t.length);for(var u=0,m=Array(a);u<a;u++)m[u]=t[u];return m}var zl=function(){function TimerManager(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}var t=TimerManager.prototype;return t.addTimer=function addTimer(t,a,u){void 0===a&&(a=0),void 0===u&&(u=1);var m=(new Date).getTime(),g=this.id;return this.timerList.push({id:g,loop:u,count:0,timeout:m+a,interval:a,callback:t}),this.id++,this.checkTimer(m),g},t.checkTimer=function checkTimer(t){if(void 0===t&&(t=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var a,u,m=0,g=_createForOfIteratorHelperLoose$5(this.timerList);!(a=g()).done;){var h=a.value;(0===m||m>h.timeout)&&(m=h.timeout)}if(0!==this.timerList.length)if(null===this.timer||m<this.timeout||this.timeout<t)this.timer=sa(bind$1(u=this.nowTime).call(u,this),m-t),this.timeout=m}},t.nowTime=function nowTime(){for(var t,nowTime=(new Date).getTime(),a=_createForOfIteratorHelperLoose$5(this.timerList);!(t=a()).done;){var u=t.value;nowTime>=u.timeout&&(u.callback(),u.count++,u.timeout=nowTime+u.interval)}this.clerTime(),this.checkTimer(nowTime)},t.clerTime=function clerTime(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function deleteTimer(t){for(var a=this.timerList.length-1;a>=0;a--){var u;if(this.timerList[a].id===t)splice(u=this.timerList).call(u,a,1)}},t.removeFinished=function removeFinished(){for(var t=this.timerList.length-1;t>=0;t--){var a,u=this.timerList[t];if(u.loop>=0&&u.count>=u.loop)splice(a=this.timerList).call(a,t,1)}},t.destroy=function destroy(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null},TimerManager}(),Jl=createCommonjsModule((function(t){function _typeof(a){return t.exports=_typeof="function"==typeof Wa&&"symbol"==typeof as?function(t){return typeof t}:function(t){return t&&"function"==typeof Wa&&t.constructor===Wa&&t!==Wa.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,_typeof(a)}t.exports=_typeof,t.exports.__esModule=!0,t.exports.default=t.exports})),Xl=createCommonjsModule((function(t){var a=Jl.default;function _regeneratorRuntime(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t.exports=_regeneratorRuntime=function _regeneratorRuntime(){return u},t.exports.__esModule=!0,t.exports.default=t.exports;var u={},m=Object.prototype,g=m.hasOwnProperty,h="function"==typeof Wa?Wa:{},_=h.iterator||"@@iterator",E=h.asyncIterator||"@@asyncIterator",T=h.toStringTag||"@@toStringTag";function define(t,a,u){return Ke(t,a,{value:u,enumerable:!0,configurable:!0,writable:!0}),t[a]}try{define({},"")}catch(t){define=function define(t,a,u){return t[a]=u}}function wrap(t,a,u,m){var g=a&&a.prototype instanceof Generator?a:Generator,h=gt(g.prototype),_=new Context(m||[]);return h._invoke=function(t,a,u){var m="suspendedStart";return function(g,h){if("executing"===m)throw new Error("Generator is already running");if("completed"===m){if("throw"===g)throw h;return doneResult()}for(u.method=g,u.arg=h;;){var _=u.delegate;if(_){var E=maybeInvokeDelegate(_,u);if(E){if(E===S)continue;return E}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if("suspendedStart"===m)throw m="completed",u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);m="executing";var T=tryCatch(t,a,u);if("normal"===T.type){if(m=u.done?"completed":"suspendedYield",T.arg===S)continue;return{value:T.arg,done:u.done}}"throw"===T.type&&(m="completed",u.method="throw",u.arg=T.arg)}}}(t,u,_),h}function tryCatch(t,a,u){try{return{type:"normal",arg:t.call(a,u)}}catch(t){return{type:"throw",arg:t}}}u.wrap=wrap;var S={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var M={};define(M,_,(function(){return this}));var I=za&&za(za(values([])));I&&I!==m&&g.call(I,_)&&(M=I);var A=GeneratorFunctionPrototype.prototype=Generator.prototype=gt(M);function defineIteratorMethods(t){var a;forEach$1(a=["next","throw","return"]).call(a,(function(a){define(t,a,(function(t){return this._invoke(a,t)}))}))}function AsyncIterator(t,u){function invoke(m,h,_,E){var T=tryCatch(t[m],t,h);if("throw"!==T.type){var S=T.arg,M=S.value;return M&&"object"==a(M)&&g.call(M,"__await")?u.resolve(M.__await).then((function(t){invoke("next",t,_,E)}),(function(t){invoke("throw",t,_,E)})):u.resolve(M).then((function(t){S.value=t,_(S)}),(function(t){return invoke("throw",t,_,E)}))}E(T.arg)}var m;this._invoke=function(t,a){function callInvokeWithMethodAndArg(){return new u((function(u,m){invoke(t,a,u,m)}))}return m=m?m.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,a){var u=t.iterator[a.method];if(void 0===u){if(a.delegate=null,"throw"===a.method){if(t.iterator.return&&(a.method="return",a.arg=void 0,maybeInvokeDelegate(t,a),"throw"===a.method))return S;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var m=tryCatch(u,t.iterator,a.arg);if("throw"===m.type)return a.method="throw",a.arg=m.arg,a.delegate=null,S;var g=m.arg;return g?g.done?(a[t.resultName]=g.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=void 0),a.delegate=null,S):g:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,S)}function pushTryEntry(t){var a={tryLoc:t[0]};1 in t&&(a.catchLoc=t[1]),2 in t&&(a.finallyLoc=t[2],a.afterLoc=t[3]),this.tryEntries.push(a)}function resetTryEntry(t){var a=t.completion||{};a.type="normal",delete a.arg,t.completion=a}function Context(t){this.tryEntries=[{tryLoc:"root"}],forEach$1(t).call(t,pushTryEntry,this),this.reset(!0)}function values(t){if(t){var a=t[_];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var u=-1,m=function next(){for(;++u<t.length;)if(g.call(t,u))return next.value=t[u],next.done=!1,next;return next.value=void 0,next.done=!0,next};return m.next=m}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(A,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,T,"GeneratorFunction"),u.isGeneratorFunction=function(t){var a="function"==typeof t&&t.constructor;return!!a&&(a===GeneratorFunction||"GeneratorFunction"===(a.displayName||a.name))},u.mark=function(t){return vt?vt(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,T,"GeneratorFunction")),t.prototype=gt(A),t},u.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,E,(function(){return this})),u.AsyncIterator=AsyncIterator,u.async=function(t,a,m,g,h){void 0===h&&(h=Ho);var _=new AsyncIterator(wrap(t,a,m,g),h);return u.isGeneratorFunction(a)?_:_.next().then((function(t){return t.done?t.value:_.next()}))},defineIteratorMethods(A),define(A,T,"Generator"),define(A,_,(function(){return this})),define(A,"toString",(function(){return"[object Generator]"})),u.keys=function(t){var a=[];for(var u in t)a.push(u);return reverse$1(a).call(a),function next(){for(;a.length;){var u=a.pop();if(u in t)return next.value=u,next.done=!1,next}return next.done=!0,next}},u.values=values,Context.prototype={constructor:Context,reset:function reset(t){var a;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,forEach$1(a=this.tryEntries).call(a,resetTryEntry),!t)for(var u in this)"t"===u.charAt(0)&&g.call(this,u)&&!isNaN(+slice(u).call(u,1))&&(this[u]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var a=this;function handle(u,m){return h.type="throw",h.arg=t,a.next=u,m&&(a.method="next",a.arg=void 0),!!m}for(var u=this.tryEntries.length-1;u>=0;--u){var m=this.tryEntries[u],h=m.completion;if("root"===m.tryLoc)return handle("end");if(m.tryLoc<=this.prev){var _=g.call(m,"catchLoc"),E=g.call(m,"finallyLoc");if(_&&E){if(this.prev<m.catchLoc)return handle(m.catchLoc,!0);if(this.prev<m.finallyLoc)return handle(m.finallyLoc)}else if(_){if(this.prev<m.catchLoc)return handle(m.catchLoc,!0)}else{if(!E)throw new Error("try statement without catch or finally");if(this.prev<m.finallyLoc)return handle(m.finallyLoc)}}}},abrupt:function abrupt(t,a){for(var u=this.tryEntries.length-1;u>=0;--u){var m=this.tryEntries[u];if(m.tryLoc<=this.prev&&g.call(m,"finallyLoc")&&this.prev<m.finallyLoc){var h=m;break}}h&&("break"===t||"continue"===t)&&h.tryLoc<=a&&a<=h.finallyLoc&&(h=null);var _=h?h.completion:{};return _.type=t,_.arg=a,h?(this.method="next",this.next=h.finallyLoc,S):this.complete(_)},complete:function complete(t,a){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&a&&(this.next=a),S},finish:function finish(t){for(var a=this.tryEntries.length-1;a>=0;--a){var u=this.tryEntries[a];if(u.finallyLoc===t)return this.complete(u.completion,u.afterLoc),resetTryEntry(u),S}},catch:function _catch(t){for(var a=this.tryEntries.length-1;a>=0;--a){var u=this.tryEntries[a];if(u.tryLoc===t){var m=u.completion;if("throw"===m.type){var g=m.arg;resetTryEntry(u)}return g}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,a,u){return this.delegate={iterator:values(t),resultName:a,nextLoc:u},"next"===this.method&&(this.arg=void 0),S}},u}t.exports=_regeneratorRuntime,t.exports.__esModule=!0,t.exports.default=t.exports})),Ql=Xl(),Zl=Ql;try{regeneratorRuntime=Ql}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=Ql:Function("r","regeneratorRuntime = r")(Ql)}function __rest(t,a){var u={};for(var m in t)Object.prototype.hasOwnProperty.call(t,m)&&a.indexOf(m)<0&&(u[m]=t[m]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var g=0;for(m=Object.getOwnPropertySymbols(t);g<m.length;g++)a.indexOf(m[g])<0&&Object.prototype.propertyIsEnumerable.call(t,m[g])&&(u[m[g]]=t[m[g]])}return u}function __awaiter(t,a,u,m){return new(u||(u=Promise))((function(g,h){function fulfilled(t){try{step(m.next(t))}catch(t){h(t)}}function rejected(t){try{step(m.throw(t))}catch(t){h(t)}}function step(t){t.done?g(t.value):function adopt(t){return t instanceof u?t:new u((function(a){a(t)}))}(t.value).then(fulfilled,rejected)}step((m=m.apply(t,a||[])).next())}))}function isPlainObject(t){return null!=t&&"object"==typeof t&&za(t)==Object.prototype}function merge$1(t,a){var u=isPlainObject(t)||Ln(t),m=isPlainObject(a)||Ln(a);if(u&&m){for(var g in a){var h=merge$1(t[g],a[g]);void 0!==h&&(t[g]=h)}return t}return a}var eu={setLogger:function setLogger(t){throw new Error("setLogger not implemented.")},platform:"",WebSocket:function(){function AdapterSocket(t,a){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}var t=AdapterSocket.prototype;return t.close=function close(t,a){throw new Error("Method not implemented.")},t.send=function send(t){throw new Error("Method not implemented.")},t.onclose=function onclose(t){throw new Error("Method not implemented.")},t.onerror=function onerror(t){throw new Error("Method not implemented.")},t.onmessage=function onmessage(t){throw new Error("Method not implemented.")},t.onopen=function onopen(t){throw new Error("Method not implemented.")},AdapterSocket}(),localStorage:{},request:function request(t,a){throw new Error("request not implemented.")},uploadFile:function uploadFile(t){throw new Error("uploadFile not implemented.")},getSystemInfo:function getSystemInfo(){throw new Error("getSystemInfo not implemented.")},getFileUploadInformation:function getFileUploadInformation(t){throw new Error("getFileUploadInformation not implemented.")},envPayload:{},net:{getNetworkStatus:function getNetworkStatus(){return Ho.resolve({net_type:0,net_connect:!0})},onNetworkStatusChange:function onNetworkStatusChange(t){},offNetworkStatusChange:function offNetworkStatusChange(){}},powerMonitor:{isActive:function isActive(){return!0},getStatus:function getStatus(){return 0},setStatus:function setStatus(t){},destroy:function destroy(){}},logStorage:function(){function AdapterLogStorageImpl(t){}var t=AdapterLogStorageImpl.prototype;return t.open=function open(){return Ho.resolve()},t.close=function close(){},t.addLogs=function addLogs(t){return Ho.resolve()},t.extractLogs=function extractLogs(){return Ho.resolve()},t.afterUpload=function afterUpload(){return Ho.resolve()},AdapterLogStorageImpl}()};var tu=["error","warn","log","debug"],ru=function emptyFunc(){},nu=["off","error","warn","log","debug"],iu=function(){function Logger(t,a){void 0===a&&(a={}),this.storageArr=[],this.debugLevel="off",this.timer=0,this.strategies={debug:{name:"debg",func:console.log},log:{name:"info",func:console.log},warn:{name:"warn",func:console.warn},error:{name:"erro",func:console.error}},this.debug=ru,this.log=ru,this.warn=ru,this.error=ru,this.iid=Math.round(1e3*Math.random()),this.debugLevel=includes(nu).call(nu,t)?t:"off",a.debugLevel&&(this.debugLevel=includes(nu).call(nu,a.debugLevel)?a.debugLevel:this.debugLevel),this.logStorage=!1===a.storageEnable?null:new eu.logStorage(null==a?void 0:a.storageName),this.setOptions(a),this.setLogFunc(this.debugLevel),this.setTimer(),eu.setLogger(this),this.open()}var t=Logger.prototype;return t.getDebugMode=function getDebugMode(){return"debug"===this.debugLevel},t.open=function open(){var t=this;this.logStorage&&this.logStorage.open().then((function(){t.log("Logger::open success")})).catch((function(a){t.warn("Logger::open failed",a)}))},t.setOptions=function setOptions(t){if(t&&t.logFunc){var a=t.logFunc;for(var u in a){var m=u,g=a[m];g&&(this.strategies[m].func=g)}}},t.setLogFunc=function setLogFunc(t,a){var u=this;void 0===a&&(a="log");var m=findIndex$1(tu).call(tu,(function(a){return a===t})),g=findIndex$1(tu).call(tu,(function(t){return t===a}));forEach$1(tu).call(tu,(function(t,a){u[t]=function(){if(!(a>m&&a>g)){var u=slice(Array.prototype).call(arguments),h=this.strategies[t],_=this.formatArgs(u,h.name);a<=g&&this.logStorage&&this.prepareSaveLog(_,t),a<=m&&h.func(_)}}}))},t.extractLogs=function extractLogs(){var t;return this.logStorage?null===(t=this.logStorage)||void 0===t?void 0:t.extractLogs():Ho.resolve("")},t.afterUpload=function afterUpload(){var t;return this.logStorage?null===(t=this.logStorage)||void 0===t?void 0:t.afterUpload():Ho.resolve("")},t.prepareSaveLog=function prepareSaveLog(t,a){this.storageArr.push({text:t,level:a,time:Jo(),iid:this.iid}),this.timer||this.setTimer(),this.storageArr.length>=100&&(this.triggerTimer(),this.storageArr=[])},t.saveLogs=function saveLogs(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var t;return Zl.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(this.logStorage){a.next=2;break}return a.abrupt("return");case 2:return t=this.storageArr,this.storageArr=[],a.prev=4,a.next=7,this.logStorage.addLogs(t);case 7:a.next=11;break;case 9:a.prev=9,a.t0=a.catch(4);case 11:case"end":return a.stop()}}),_callee,this,[[4,9]])})))},t.clearTimer=function clearTimer(){this.timer&&clearTimeout(this.timer),this.timer=0},t.setTimer=function setTimer(){var t;this.clearTimer(),this.timer=sa(bind$1(t=this.triggerTimer).call(t,this),5e3)},t.triggerTimer=function triggerTimer(){this.clearTimer(),this.saveLogs()},t.formatArgs=function formatArgs(t,a){var u=new Date;return"[NIM "+this.iid+" "+a+" "+(u.getMonth()+1+"-"+u.getDate()+" "+u.getHours()+":"+u.getMinutes()+":"+u.getSeconds()+":"+u.getMilliseconds())+"] "+map$6(t).call(t,(function(t){return t instanceof Vl?t.toString():t instanceof Error?t&&t.message?t.message:t:"object"==typeof t?Pn(t):t})).join(" ")},t.destroy=function destroy(){this.debug=ru,this.log=ru,this.warn=ru,this.error=ru,this.saveLogs(),this.clearTimer(),this.storageArr=[],this.logStorage&&this.logStorage.close()},Logger}(),ou=Math.min,au=[].lastIndexOf,su=!!au&&1/[1].lastIndexOf(1,-0)<0,cu=arrayMethodIsStrict("lastIndexOf"),lu=su||!cu?function lastIndexOf(t){if(su)return T(au,this,arguments)||0;var a=toIndexedObject(this),u=lengthOfArrayLike(a),m=u-1;for(arguments.length>1&&(m=ou(m,toIntegerOrInfinity(arguments[1]))),m<0&&(m=u+m);m>=0;m--)if(m in a&&a[m]===t)return m||0;return-1}:au;_export({target:"Array",proto:!0,forced:lu!==[].lastIndexOf},{lastIndexOf:lu});var uu,du=entryVirtual("Array").lastIndexOf,pu=Array.prototype,lastIndexOf=function(t){var a=t.lastIndexOf;return t===pu||j(pu,t)&&a===pu.lastIndexOf?du:a},mu="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",gu=b("".replace),fu="["+mu+"]",hu=RegExp("^"+fu+fu+"*"),_u=RegExp(fu+fu+"*$"),createMethod=function(t){return function(a){var u=toString(requireObjectCoercible(a));return 1&t&&(u=gu(u,hu,"")),2&t&&(u=gu(u,_u,"")),u}},vu={start:createMethod(1),end:createMethod(2),trim:createMethod(3)},yu=or.PROPER,Eu=vu.trim;_export({target:"String",proto:!0,forced:(uu="trim",fails((function(){return!!mu[uu]()||"âÂá "!=="âÂá "[uu]()||yu&&mu[uu].name!==uu})))},{trim:function trim(){return Eu(this)}}),entryVirtual("String").trim;var Tu=vu.trim,Su=m.parseInt,Mu=m.Symbol,Iu=Mu&&Mu.iterator,Au=/^[+-]?0x/i,bu=b(Au.exec),Nu=8!==Su(mu+"08")||22!==Su(mu+"0x16")||Iu&&!fails((function(){Su(Object(Iu))}))?function parseInt(t,a){var u=Tu(toString(t));return Su(u,a>>>0||(bu(Au,u)?16:10))}:Su;_export({global:!0,forced:parseInt!=Nu},{parseInt:Nu});var Cu=H.parseInt;function get(t,a){if("object"!=typeof t||null===t)return t;for(var u=(a=a||"").split("."),m=0;m<u.length;m++){var g=u[m],h=t[g],_=indexOf(g).call(g,"["),E=indexOf(g).call(g,"]");if(-1!==_&&-1!==E&&_<E){var T=slice(g).call(g,0,_),S=Cu(slice(g).call(g,_+1,E));h=t[T],h=Ln(h)?h[S]:void 0}if(null==h)return h;t=h}return t}var Ru,Ou=(Ru=function _s4(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return Ru()+Ru()+Ru()+Ru()+Ru()+Ru()+Ru()+Ru()});function getEnumKeys(t){var a;return filter(a=Bt(t)).call(a,(function(t){return!(+t>=0)}))}function getEnumKeyByEnumValue(t,a){var u,m=filter(u=Bt(t)).call(u,(function(u){return t[u]==a}));return m.length>0?m[0]:void 0}function getAccountFromSessionId(t,a){if(void 0===a&&(a="-"),!t)throw new Hl("No sessionId",{},400);var u=indexOf(t).call(t,a);if(-1===u)throw new Hl("Can not find conjunctions",{},400);var m=slice(t).call(t,0,u);return{accid:slice(t).call(t,u+1),scene:"super_team"===m?"superTeam":m}}function pendingIsMiniappEnv(){var t=eu.getSystemInfo().hostEnvEnum;return 6===t||102===t||103===t||104===t}function assignOptions(t,a){return function assignWith(t,a,u,m){for(var g in t=t||{},u=u||{},m=m||function(){},a=a||{}){var h=m(t[g],a[g]);t[g]=void 0===h?a[g]:h}for(var _ in u){var E=m(t[_],u[_]);t[_]=void 0===E?u[_]:E}return t}({},t,a,(function(t,a){return void 0===a?t:a}))}function emptyFuncWithPromise(){return Ho.resolve()}function fillIdServer(t,a,u,m){var g="number"==typeof get(t,"raw.r[0]")?""+t.raw.r[0]:void 0;return a[u]=a[u]||g||m,a}var wu=function(){function CoreAdapters(t){this.lastSuccUploadHost="",this.core=t}var t=CoreAdapters.prototype;return t.getFileUploadInformation=function getFileUploadInformation(t){return eu.getFileUploadInformation(t)},t.request=function request(t,a,u){var m=this,g=(new Date).getTime(),h=(null==u?void 0:u.exception_service)||0;return eu.request(t,a).catch((function(u){var _,E,T,S,M=u;throw m.core.reporter.reportTraceStart("exceptions",{user_id:m.core.options.account||(null===(E=null===(_=m.core)||void 0===_?void 0:_.auth)||void 0===E?void 0:E.account),trace_id:null===(S=null===(T=m.core.clientSocket)||void 0===T?void 0:T.socket)||void 0===S?void 0:S.sessionId,start_time:g,action:1,exception_service:h}),m.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof M.code?M.code:0,description:M.message||""+M.code,operation_type:0,target:t,context:a?Pn(a):""},{asyncParams:eu.net.getNetworkStatus()}),m.core.reporter.reportTraceEnd("exceptions",1),u}))},t.uploadFile=function uploadFile(t){var a,u,m,g;return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var h,_,E,T,S,M,I,A,b,N,C,R,O,w;return Zl.wrap((function _callee$(k){for(;;)switch(k.prev=k.next){case 0:E="BROWSER"===eu.platform,T=E?t.chunkUploadHostBackupList:t.commonUploadHostBackupList,S=E?t.chunkUploadHost:t.commonUploadHost,M=indexOf(T).call(T,S),I=-1===M?concat(h=[S]).call(h,T):concat(_=[S]).call(_,slice(T).call(T,0,M),slice(T).call(T,M+1)),A=Math.max(indexOf(I).call(I,this.lastSuccUploadHost),0),b=null,N=0;case 8:if(!(N<I.length)){k.next=35;break}return C=(new Date).getTime(),R=I[(N+A)%I.length],k.prev=11,k.next=14,eu.uploadFile(Lt(Lt({},t),E?{chunkUploadHost:R}:{commonUploadHost:R}));case 14:return O=k.sent,this.lastSuccUploadHost=R,"string"==typeof O.size&&(O.size=Cu(O.size)),"string"==typeof O.dur&&(O.dur=Cu(O.dur)),"string"==typeof O.w&&(O.w=Cu(O.w)),"string"==typeof O.h&&(O.h=Cu(O.h)),k.abrupt("return",O);case 23:k.prev=23,k.t0=k.catch(11),this.core.cloudStorage.nos.nosErrorCount--,b=k.t0,w=k.t0,this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(u=null===(a=this.core)||void 0===a?void 0:a.auth)||void 0===u?void 0:u.account),trace_id:null===(g=null===(m=this.core.clientSocket)||void 0===m?void 0:m.socket)||void 0===g?void 0:g.sessionId,start_time:C,action:1,exception_service:3}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof w.code?w.code:0,description:w.message||""+w.code,operation_type:1,target:R},{asyncParams:eu.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),this._uploadFileErrHanler(k.t0);case 32:N++,k.next=8;break;case 35:throw b;case 36:case"end":return k.stop()}}),_callee,this,[[11,23]])})))},t._uploadFileErrHanler=function _uploadFileErrHanler(t){if(t&&(t.code>200||t.errCode>200))throw t},CoreAdapters}(),ku="weblink.netease.im:443",xu=["https://lbs.netease.im/lbs/webconf.jsp"],Pu="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",Lu="imElite_sdk_abtest_web",Du=function(){function ABTest(t,a){this.abtInfo={},this.core=t,this.config=assignOptions({isAbtestEnable:!0,abtestUrl:Pu,abtestProjectKey:Lu},a)}var t=ABTest.prototype;return t.setOptions=function setOptions(t){this.config=assignOptions(this.config,t)},t.abtRequest=function abtRequest(){var t,a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var u;return Zl.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if(this.config.isAbtestEnable){m.next=2;break}return m.abrupt("return");case 2:if(!this.abtInfo.experiments){m.next=4;break}return m.abrupt("return");case 4:if(this.config.abtestUrl){m.next=6;break}return m.abrupt("return");case 6:return m.prev=6,m.next=9,this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.9.41",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7});case 9:u=m.sent,m.next=15;break;case 12:m.prev=12,m.t0=m.catch(6),this.core.logger.warn("ABTest request failed");case 15:this.abtInfo=(null===(a=null===(t=null==u?void 0:u.data)||void 0===t?void 0:t.data)||void 0===a?void 0:a.abtInfo)||{};case 16:case"end":return m.stop()}}),_callee,this,[[6,12]])})))},ABTest}();function getPromiseWithAbort(t){var a={},u=new Ho((function(t,u){a.abort=u}));return a.promise=Ho.race([t,u]),a}Ho.reject;var Vu=function(){function PromiseManager(){this.abortFns=[]}var t=PromiseManager.prototype;return t.add=function add(t){var a=getPromiseWithAbort(t);return this.abortFns.push(a.abort),a.promise},t.clear=function clear(t){var a;forEach$1(a=this.abortFns).call(a,(function(a){return a(t||new Vl({code:Ll.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))})),this.abortFns=[]},t.destroy=function destroy(){this.clear()},PromiseManager}(),Uu={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},Fu={timestamp:0,rtt:0,baseClock:0,baseTime:0},Bu=function(){function TimeOrigin(t,a,u){void 0===u&&(u="getServerTime"),this.serverOrigin=Fu,this.config=Uu,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=t,this.logger=t.logger,this.promiseManager=new Vu,this.cmdName=u,a&&this.setOptions(a)}var t=TimeOrigin.prototype;return t.setOptions=function setOptions(t){this.config=Lt({},Uu,this.config,t)},t.reset=function reset(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=Fu,this.currentChance=0},t.setOriginTimetick=function setOriginTimetick(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var t,a,u,m,g,h,_,E,T,S;return Zl.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:if(this.config.enable){M.next=2;break}return M.abrupt("return");case 2:if(!this.isSettingNTP){M.next=4;break}return M.abrupt("return");case 4:if(!(this.currentChance>=this.config.maxChances)){M.next=6;break}return M.abrupt("return");case 6:if(t=get(this.core,"auth.status"),a=get(this.core,"status"),u=get(this.core,"V2NIMLoginService.lifeCycle.loginStatus"),"logined"===t||"logined"===a||1===u){M.next=11;break}return M.abrupt("return");case 11:return this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0,m="TimeOrigin::setOriginTimetick:",g=Jo(),this.core.logger.debug(m+" getServerTime start, times "+this.currentChance),M.prev=18,M.next=21,this.promiseManager.add(this.core.sendCmd(this.cmdName));case 21:_=M.sent,h=get(_,"content.time"),this.isSettingNTP=!1,M.next=33;break;case 26:return M.prev=26,M.t0=M.catch(18),E=M.t0,this.isSettingNTP=!1,this.logger.warn(m+" Calculate Delay time, getServerTime error",E),E.code!==Ll.V2NIM_ERROR_CODE_CANCELLED&&(clearTimeout(this.timer),this.timer=sa(bind$1(T=this.setOriginTimetick).call(T,this),this.failedDelay)),M.abrupt("return");case 33:if(h){M.next=37;break}return this.core.logger.warn(m+" Calculate Delay time incorrect format"),this.config.enable=!1,M.abrupt("return");case 37:S=Jo()-g,this.doSet(h,S);case 39:case"end":return M.stop()}}),_callee,this,[[18,26]])})))},t.doSet=function doSet(t,a){var u,m="TimeOrigin::setOriginTimetick:";if(a>this.config.tolerantRTT)this.logger.warn(m+" denied RTT:"+a),clearTimeout(this.timer),this.timer=sa(bind$1(u=this.setOriginTimetick).call(u,this),this.failedDelay);else if(a>this.config.bestRTT){var g;this.serverOrigin.rtt&&a>=this.serverOrigin.rtt?this.logger.warn(m+" ignore RTT:"+a):(this.setServerOrigin(a,t),this.logger.log(m+" accept reluctantly RTT:"+a)),clearTimeout(this.timer),this.timer=sa(bind$1(g=this.setOriginTimetick).call(g,this),this.failedDelay)}else{var h;this.setServerOrigin(a,t),this.logger.debug(m+" accept best RTT:"+a),this.currentChance=0,clearTimeout(this.timer),this.timer=sa(bind$1(h=this.setOriginTimetick).call(h,this),this.successDelay)}},t.getNTPTime=function getNTPTime(t){if(void 0===t&&(t=this.getTimeNode()),this.checkNodeReliable(t)){var a=Math.floor(t.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+a}return Jo()},t.checkNodeReliable=function checkNodeReliable(t){if(void 0===t&&(t=this.getTimeNode()),this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var a=t.clock-this.serverOrigin.baseClock,u=t.time-this.serverOrigin.baseTime;return Math.abs(u-a)<500}return!1},t.checkPerformance=function checkPerformance(){return"BROWSER"===eu.platform&&!("undefined"==typeof performance||!performance.now)},TimeOrigin.checkPerformance=function checkPerformance(){return"BROWSER"===eu.platform&&!("undefined"==typeof performance||!performance.now)},t.getTimeNode=function getTimeNode(){return{clock:this.checkPerformance()?performance.now():0,time:Jo()}},TimeOrigin.getTimeNode=function getTimeNode(){return{clock:TimeOrigin.checkPerformance()?performance.now():0,time:Jo()}},t.setServerOrigin=function setServerOrigin(t,a){this.serverOrigin={timestamp:a+Math.floor(t/2),rtt:t,baseClock:this.checkPerformance()?performance.now():0,baseTime:Jo()}},TimeOrigin}(),Gu={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]},Hu=function(){function ReporterHookLinkKeep(t,a){this.traceData=Gu,this.core=t,this.traceData=Lt({},Gu,a),this.traceData.extension=[]}var t=ReporterHookLinkKeep.prototype;return t.reset=function reset(){this.traceData=Lt({},Gu),this.traceData.extension=[]},t.start=function start(){var t,a;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(a=null===(t=this.core.clientSocket)||void 0===t?void 0:t.socket)||void 0===a?void 0:a.sessionId)||"",this.traceData.start_time=(new Date).getTime()},t.update=function update(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u,m;return Zl.wrap((function _callee$(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,eu.net.getNetworkStatus();case 2:a=g.sent,u=a.net_type,m=a.net_connect,this.traceData.extension.push(Lt({code:0,foreground:!0,foreg_backg_switch:!1,net_type:u,net_connect:m},t));case 6:case"end":return g.stop()}}),_callee,this)})))},t.end=function end(t){var a=this.traceData.extension[0],u=this.traceData.extension[1];if(a&&0===a.operation_type&&u&&1===u.operation_type){var m=a.net_type!==u.net_type||a.net_connect!==u.net_connect;if(t||!m)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()},ReporterHookLinkKeep}(),ju={user_id:"",trace_id:"",net_connect:!0,net_type:0,duration:0,start_time:0,history:[],succeed:!1},qu=function(){function ReporterHookLBS(t){this.traceData=ju,this.core=t,this.reset()}var t=ReporterHookLBS.prototype;return t.reset=function reset(){this.traceData=Lt({},ju),this.traceData.history=[]},t.start=function start(t){this.reset(),this.traceData.user_id=t,this.traceData.start_time=Jo()},t.updateBegin=function updateBegin(t){this.traceData.history.push(Lt({head:"",body:"",start_time:Jo(),httpdns:!1,index:0},t))},t.updateComplete=function updateComplete(t){var a;forEach$1(a=this.traceData.history).call(a,(function(a){a.target===t.target&&(Lt(a,t),a.duration=Jo()-a.start_time)}))},t.end=function end(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u,m,g;return Zl.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(this.traceData.succeed=t,this.traceData.history=filter(a=this.traceData.history).call(a,(function(t){return void 0!==t.code})),0!==this.traceData.history.length){h.next=5;break}return this.reset(),h.abrupt("return");case 5:return this.traceData.duration=Jo()-this.traceData.start_time,h.next=8,eu.net.getNetworkStatus();case 8:u=h.sent,m=u.net_type,g=u.net_connect,this.traceData.net_type=m,this.traceData.net_connect=g,this.core.reporter.report("nim_sdk_lbs_records",this.traceData),this.reset();case 15:case"end":return h.stop()}}),_callee,this)})))},ReporterHookLBS}();function getIsDataReportEnable(t){var a,u,m=!0;return"boolean"==typeof(null===(a=null==t?void 0:t.reporterConfig)||void 0===a?void 0:a.enableCompass)?m=t.reporterConfig.enableCompass:"boolean"==typeof(null===(u=null==t?void 0:t.reporterConfig)||void 0===u?void 0:u.isDataReportEnable)&&(m=t.reporterConfig.isDataReportEnable),m}var Yu={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},Ku="ReporterHook::setMonitorForResources:",Wu=function(){function ReporterHookCloudStorage(t,a){this.traceData=Yu,this.core=t,this.traceData=Lt({},Yu,a)}var t=ReporterHookCloudStorage.prototype;return t.reset=function reset(){this.traceData=Lt({},Yu)},t.start=function start(){var t,a;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(a=null===(t=this.core.clientSocket)||void 0===t?void 0:t.socket)||void 0===a?void 0:a.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Jo()},t.update=function update(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){return Zl.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(this.traceData.user_id){a.next=2;break}return a.abrupt("return");case 2:this.core.logger.log(Ku+" upload update",t),Lt(this.traceData,t);case 4:case"end":return a.stop()}}),_callee,this)})))},t.end=function end(t){this.traceData.user_id&&(this.core.logger.log(Ku+" upload end cause of "+t),this.traceData.state=t,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Jo())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=Yu)},ReporterHookCloudStorage}(),$u={},zu={},Ju={},Xu={apiVersion:"v1",debugLevel:"off",needReconnect:!0,reconnectionAttempts:Rt,lbsUrls:xu,linkUrl:ku,abtestUrl:Pu,isAbtestEnable:!0},Qu=function(t){function NIM(a,u){var m,g,h;if(void 0===u&&(u={}),(h=t.call(this)||this).instanceName="NIM",h.pluginMap={},h.eventBus=new ca,h.options={},h.V2NIMConversationIdUtil={},h.V2NIMMessageCreator={},h.V2NIMMessageAttachmentCreator={},h.V2NIMClientAntispamUtil={},h.DataStructureConverter={},h.V2NIMMessageConverter={},h.V2NIMMessageLogUtil={},h.V2NIMMessageExtendUtil={},h.V2NIMStorageUtil={},h.V2NIMNotificationService={},h.V2NIMStorageService={},h.auth={},h.V1NIMLoginService={},h.V2NIMLoginService={},h.clientSocket={},h.V2NIMSyncService={},h.V2NIMLocalConversationService={},h.V2NIMConversationService={},h.V2NIMConversationGroupService={},h.V2NIMMessageService={},h.V2NIMTeamService={},h.V2NIMUserService={},h.V2NIMFriendService={},h.V2NIMSettingService={},h.V2NIMAIService={},h.V2NIMSignallingService={},h.V2NIMSubscriptionService={},h.V2NIMPassthroughService={},h.YSFService={},h.offlinePush={},h.sync={},h.msg={},h.msgLog={},h.session={},h.cloudSession={},h.misc={},h.user={},h.friend={},h.systemMessage={},h.team={},h.event={},h.msgExtend={},h.cloudStorage={},h.passThrough={},h.superTeam={},h.plugin={},h.signaling={},h.qchatChannel={},h.qchatMedia={},h.qchatMsg={},h.qchatRole={},h.qchatServer={},h.pluginMap=Ju,h.logger=new iu(a.debugLevel,u.loggerConfig),u.privateConf){var _=h.getConfigFromPrivate(u.privateConf),E=_.authConfig,T=_.cloudStorageConfig,S=_.reporterConfig;Lt(a,E),h.setInitOptions(a),h.otherOptions=Lt(Lt({},u),{cloudStorageConfig:Lt(Lt({storageKeyPrefix:"NIM"},u.cloudStorageConfig),T),reporterConfig:Lt(Lt({},u.reporterConfig),S),V1NIMLoginServiceConfig:Lt(Lt(Lt({},a),u.V1NIMLoginServiceConfig),E),V2NIMLoginServiceConfig:Lt(Lt({},u.V2NIMLoginServiceConfig),E)})}else h.setInitOptions(a),h.otherOptions=Lt(Lt({},u),{V1NIMLoginServiceConfig:Lt(Lt({},a),u.V1NIMLoginServiceConfig),cloudStorageConfig:Lt({storageKeyPrefix:"NIM"},u.cloudStorageConfig)});h.timerManager=new zl,h.timeOrigin=new Bu($e(h)),h.adapters=new wu($e(h)),h.abtest=new Du($e(h),Lt(Lt({isAbtestEnable:h.options.isAbtestEnable,abtestUrl:h.options.abtestUrl},h.otherOptions.abtestConfig),{abtestProjectKey:Lu}));var M=eu.getSystemInfo(),I=function getCompassDataEndpoint(t,a){var u,m,g=null===(u=null==a?void 0:a.reporterConfig)||void 0===u?void 0:u.compassDataEndpoint,h=null===(m=null==a?void 0:a.reporterConfig)||void 0===m?void 0:m.reportConfigUrl;if(g)return g;if(h){var _=h.match(/^https:\/\/([^/]+)\/*/);if(Ln(_)&&_.length>=1)return"https://"+_[1];t.error("Invalid reportConfigUrl: "+h)}return pendingIsMiniappEnv()?"https://statistic.live.126.net":"https://statistic.live.126.net,https://statistic-overseas.yunxinfw.com"}(h.logger,h.otherOptions);h.reporter=new Os(Lt(Lt({},I?{compassDataEndpoint:I}:{}),{isDataReportEnable:getIsDataReportEnable(h.otherOptions),common:{app_key:a.appkey,dev_id:"",platform:"Web",sdk_ver:"10.9.41",env:"online",os_name:M.os,os_ver:M.osVer,lib_env:M.libEnv,host_env:M.hostEnv,host_env_ver:M.hostEnvVer,manufactor:M.manufactor,model:M.model,v2:"v1"!==h.options.apiVersion},request:eu.request,logger:h.logger,autoStart:!0})),h.reporterHookLinkKeep=new Hu($e(h)),h.reporterHookCloudStorage=new Wu($e(h)),h.reporterHookLBS=new qu($e(h));var A=h.getServiceKeys(Bt($u));return forEach$1(A).call(A,(function(t){if(!h[t]||!h[t].name){var a=$u[t];h[t]=new a($e(h))}})),forEach$1(m=Bt($u)).call(m,(function(t){h.callSetOptions(t)})),forEach$1(g=Bt(zu)).call(g,(function(t){var a=zu[t];void 0!==a&&(h[t]=new a($e(h)))})),NIM.instance=$e(h),h.logger.log("NIM init, version:10.9.41, sdk version:100941, appkey:"+a.appkey),h}Ct(NIM,t);var a=NIM.prototype;return a.getServiceKeys=function getServiceKeys(t){var a=findIndex$1(t).call(t,(function(t){return"V1NIMLoginService"===t}));if(a>-1){var u=t[a];splice(t).call(t,a,1),"v1"===this.options.apiVersion&&t.unshift(u)}var m=findIndex$1(t).call(t,(function(t){return"V2NIMLoginService"===t}));if(m>-1){var g=t[m];splice(t).call(t,m,1),"v2"===this.options.apiVersion&&t.unshift(g)}var h=findIndex$1(t).call(t,(function(t){return"sync"===t}));if(h>-1){var _=t[h];splice(t).call(t,h,1),"v1"===this.options.apiVersion&&t.push(_)}var E=findIndex$1(t).call(t,(function(t){return"V2NIMSyncService"===t}));if(E>-1){var T=t[E];splice(t).call(t,E,1),"v2"===this.options.apiVersion&&t.push(T)}return t},NIM.getInstance=function getInstance(t,a){if(!NIM.instance){if(t)return new NIM(t,a);throw new Error("Instance not exist, please input options")}if(t){if(NIM.instance.options.account===t.account&&NIM.instance.options.appkey===t.appkey)return NIM.instance.setOptions(t),NIM.instance;throw new Error("Unexpected login")}return NIM.instance},a.setInitOptions=function setInitOptions(t){validate({appkey:{type:"string"},apiVersion:{type:"enum",values:["v1","v2"],required:!1},binaryWebsocket:{type:"boolean",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},t),this.options=Lt(Lt({},Xu),t)},a.getConfigFromPrivate=function getConfigFromPrivate(t){var a;return t?{authConfig:JSON.parse(Pn({appkey:t.appkey||void 0,lbsUrls:t.weblbsUrl?[t.weblbsUrl]:void 0,linkUrl:t.link_web||void 0,linkSSL:null!==(a=t.websdkSsl)&&void 0!==a?a:void 0})),cloudStorageConfig:JSON.parse(Pn({chunkUploadHost:t.nos_uploader||void 0,commonUploadHost:t.nos_uploader||void 0,commonUploadHostBackupList:t.nos_uploader?[t.nos_uploader]:void 0,chunkUploadHostBackupList:t.nos_uploader?[t.nos_uploader]:void 0,uploadReplaceFormat:t.nos_downloader_v2?(t.nosSsl?"https://":"http://")+t.nos_downloader_v2:void 0,downloadUrl:void 0!==t.nos_accelerate?t.nos_accelerate:void 0,downloadHostList:""===t.nos_accelerate_host?[]:"string"==typeof t.nos_accelerate_host?[t.nos_accelerate_host]:Ln(t.nos_accelerate_host)?t.nos_accelerate_host:void 0})),reporterConfig:JSON.parse(Pn({enableCompass:"boolean"==typeof t.enableCompass?t.enableCompass:void 0,compassDataEndpoint:t.compassDataEndpoint||void 0}))}:{authConfig:{},cloudStorageConfig:{},reporterConfig:{}}},a.connect=function connect(t){return void 0===t&&(t={}),this.V1NIMLoginService.login(t)},a.setOptions=function setOptions(t){if("object"==typeof t&&null!==t){if(Object.prototype.hasOwnProperty.call(t,"account")&&t.account!==this.options.account||Object.prototype.hasOwnProperty.call(t,"appkey")&&t.appkey!==this.options.appkey)throw new Vl({code:Ll.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions account and appkey is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(t,"apiVersion")&&t.apiVersion!==this.options.apiVersion)throw new Vl({code:Ll.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions apiVersion is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(t,"binaryWebsocket")&&t.binaryWebsocket!==this.options.binaryWebsocket)throw new Vl({code:Ll.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions binaryWebsocket is not allowed to reset"}});validate({token:{type:"string",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},t),this.logger.log("NIM::setOptions options is",t),this.options=Lt(Lt({},this.options),t),this.V1NIMLoginService.setOptions&&this.V1NIMLoginService.setOptions(this.options)}},a.getOptions=function getOptions(){return this.options},a.disconnect=function disconnect(){return this.V1NIMLoginService.logout()},a._disconnect=function _disconnect(){return"v1"===this.options.apiVersion?this.V1NIMLoginService.logout():"v2"===this.options.apiVersion?0===get(this.V2NIMLoginService,"lifeCycle.connectStatus")&&0===get(this.V2NIMLoginService,"lifeCycle.loginStatus")?Ho.resolve():this.V2NIMLoginService.logout():Ho.resolve()},a.destroy=function destroy(){var t=this;return NIM.instance=void 0,this._disconnect().then((function(){t.status="destroyed",t.removeAllListeners(),t.eventBus.removeAllListeners(),t.logger.destroy(),t.reporter.destroy(),t.timerManager.destroy(),t._clearModuleData("destroy"),t._removeAllModuleListeners(),t.connect=emptyFuncWithPromise,t.disconnect=emptyFuncWithPromise,t._disconnect=emptyFuncWithPromise,t.destroy=emptyFuncWithPromise}))},a._clearModuleData=function _clearModuleData(t){void 0===t&&(t="logout");var a=Wo(this);forEach$1(a).call(a,(function(a){a&&"function"==typeof a.reset&&a.reset(t)}))},a._removeAllModuleListeners=function _removeAllModuleListeners(){var t=Wo(this);forEach$1(t).call(t,(function(t){t&&"function"==typeof t.removeAllListeners&&t.removeAllListeners()}))},a.kick=function kick(t){return this.V1NIMLoginService.kick(t)},a.sendCmd=function sendCmd(t,a,u){return this.clientSocket.sendCmd(t,a,u)},a.emit=function emit(a){var u=this;try{for(var m,g,h=Jo(),_=arguments.length,E=new Array(_>1?_-1:0),T=1;T<_;T++)E[T-1]=arguments[T];var S=(m=t.prototype.emit).call.apply(m,concat(g=[this,a]).call(g,E)),M=Jo()-h;return M>=10&&this.logger.warn("Core::emit event: "+a+" process takes: "+M+"ms"),S}catch(t){return this.logger.error("Core::emit event: "+a+". Error: "+t),sa((function(){throw u.logger.error("Core::emit throw error in setTimeout. event: "+a+". Error: "+t),t}),0),!1}},a._registerDep=function _registerDep(t,a){this[a]&&this[a].name||(this[a]=new t(this),this.callSetOptions(a))},a.callSetOptions=function callSetOptions(t){var a=t+"Config",u=t+"Options",m=this.otherOptions[a]||this.otherOptions[u]||{},g=get(this,t+".setOptions");"function"==typeof g&&("cloudStorage"===t&&(m=this.otherOptions[a]||this.otherOptions.serverConfig||{}),g.call(this[t],m))},NIM.registerService=function registerService(t,a){$u[a]=t},NIM.registerPrivateService=function registerPrivateService(t,a){zu[a]=t},NIM.registerPlugin=function registerPlugin(t,a){Ju[a]=t},We(NIM,[{key:"account",get:function get(){return this.auth.account}},{key:"status",get:function get(){return this.V1NIMLoginService.status},set:function set(t){this.V1NIMLoginService.status=t}},{key:"config",get:function get(){return{timeout:8e3,deviceId:this.auth.deviceId}}}]),NIM}(ca);Qu.sdkVersion=100941,Qu.sdkVersionFormat="10.9.41";var Zu=createCommonjsModule((function(t,a){t.exports=function(){function object2String(t){if(t){var a,u="";return forEach$1(a=Bt(t)).call(a,(function(a,m){u+=0===m?"?":"&",u+=a+"="+t[a]})),u}return""}var t=function(t){function V2NIMError(a,u,m,g){var h;return(h=t.call(this,m)||this).source=a,h.code=u,h.desc=m,h.detail=g||{},h}return Ct(V2NIMError,t),V2NIMError}(Ac(Error));function request(a,u){void 0===u&&(u={dataType:"json",method:"GET",timeout:5e3});var m="text"===u.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",g="GET"===u.method?object2String(u.params):"";return new Ho((function(h,_){if(window.XMLHttpRequest){var E,T=new XMLHttpRequest;if(T.onreadystatechange=function(){if(4===T.readyState)if(200===T.status){try{E=JSON.parse(T.response||"{}")}catch(t){E=T.response}h({status:T.status,data:E})}else sa((function(){_(new t(1,T.status,"readyState: "+T.readyState+"; statusText: "+T.statusText))}),0)},T.open(u.method,""+a+g),T.timeout=u.timeout||5e3,T.setRequestHeader("Content-Type",m),u.headers)for(var S in u.headers)T.setRequestHeader(S,u.headers[S]);T.ontimeout=function(a){_(new t(1,408,a&&a.message?a.message:"request timeout"))},T.send(Pn(u.data))}else _(new t(2,10400,"request no suppout"))}))}return request}()})),ed=Math.floor,mergeSort=function(t,a){var u=t.length,m=ed(u/2);return u<8?insertionSort(t,a):merge(t,mergeSort(arraySliceSimple(t,0,m),a),mergeSort(arraySliceSimple(t,m),a),a)},insertionSort=function(t,a){for(var u,m,g=t.length,h=1;h<g;){for(m=h,u=t[h];m&&a(t[m-1],u)>0;)t[m]=t[--m];m!==h++&&(t[m]=u)}return t},merge=function(t,a,u,m){for(var g=a.length,h=u.length,_=0,E=0;_<g||E<h;)t[_+E]=_<g&&E<h?m(a[_],u[E])<=0?a[_++]:u[E++]:_<g?a[_++]:u[E++];return t},td=mergeSort,rd=q.match(/firefox\/(\d+)/i),nd=!!rd&&+rd[1],id=/MSIE|Trident/.test(q),od=q.match(/AppleWebKit\/(\d+)\./),ad=!!od&&+od[1],sd=[],cd=b(sd.sort),ld=b(sd.push),ud=fails((function(){sd.sort(void 0)})),dd=fails((function(){sd.sort(null)})),pd=arrayMethodIsStrict("sort"),md=!fails((function(){if(z)return z<70;if(!(nd&&nd>3)){if(id)return!0;if(ad)return ad<603;var t,a,u,m,g="";for(t=65;t<76;t++){switch(a=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:u=3;break;case 68:case 71:u=4;break;default:u=2}for(m=0;m<47;m++)sd.push({k:a+m,v:u})}for(sd.sort((function(t,a){return a.v-t.v})),m=0;m<sd.length;m++)a=sd[m].k.charAt(0),g.charAt(g.length-1)!==a&&(g+=a);return"DGBEFHACIJK"!==g}}));_export({target:"Array",proto:!0,forced:ud||!dd||!pd||!md},{sort:function sort(t){void 0!==t&&aCallable(t);var a=toObject(this);if(md)return void 0===t?cd(a):cd(a,t);var u,m,g=[],h=lengthOfArrayLike(a);for(m=0;m<h;m++)m in a&&ld(g,a[m]);for(td(g,function(t){return function(a,u){return void 0===u?-1:void 0===a?1:void 0!==t?+t(a,u)||0:toString(a)>toString(u)?1:-1}}(t)),u=lengthOfArrayLike(g),m=0;m<u;)a[m]=g[m++];for(;m<h;)deletePropertyOrThrow(a,m++);return a}});var gd=entryVirtual("Array").sort,fd=Array.prototype,sort=function(t){var a=t.sort;return t===fd||j(fd,t)&&a===fd.sort?gd:a},hd=createCommonjsModule((function(t,a){self,t.exports=function(){var t={d:function d(a,u){for(var m in u)t.o(u,m)&&!t.o(a,m)&&Ke(a,m,{enumerable:!0,get:u[m]})},o:function o(t,a){return Object.prototype.hasOwnProperty.call(t,a)}},a={};t.d(a,{default:function _default(){return I}});var u=function e(t){for(var a in function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(t){},this.onProgress=function(t){},this.onUploadProgress=function(t){},this.onComplete=function(t){},t)this[a]=t[a]};function n(t,a){var u=void 0!==Wa&&$l(t)||t["@@iterator"];if(!u){if(Ln(t)||(u=function(t,a){if(t){var u;if("string"==typeof t)return r(t,a);var m=slice(u=Object.prototype.toString.call(t)).call(u,8,-1);return"Object"===m&&t.constructor&&(m=t.constructor.name),"Map"===m||"Set"===m?Wl(t):"Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?r(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){u&&(t=u);var m=0,g=function i(){};return{s:g,n:function n(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}},e:function e(t){throw t},f:g}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,_=!0,E=!1;return{s:function s(){u=u.call(t)},n:function n(){var t=u.next();return _=t.done,t},e:function e(t){E=!0,h=t},f:function f(){try{_||null==u.return||u.return()}finally{if(E)throw h}}}}function r(t,a){(null==a||a>t.length)&&(a=t.length);for(var u=0,m=new Array(a);u<a;u++)m[u]=t[u];return m}var m={privateObj:{},setItem:function setItem(t,a){m.privateObj[t]=a},getItem:function getItem(t){return m.privateObj[t]},removeItem:function removeItem(t){delete m.privateObj[t]},getKeys:function getKeys(){return Bt(m.privateObj)}},g={getFileKey:function getFileKey(t){var a=t.size.toString(),u=t.lastModified.toString();return"_NosUploader_"+t.name+slice(a).call(a,a.length-5)+slice(u).call(u,u.length-5)},getFileInfo:function getFileInfo(t){var a=m.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(t){return null}},initFile:function initFile(t,a,u){g.clearExpiredInfo();var h=this.getFileKey(a),_={ctx:void 0!==t.ctx?t.ctx:"",bucket:t.bucketName,obj:t.objectName,token:t.token,modifyAt:Jo(),end:!1};return t.payload&&(_.payload=t.payload),u&&m.setItem(h,Pn(_)),h},setUploadContext:function setUploadContext(t,a,u){var g=this.getFileInfo(t);g&&(g.ctx=a,u&&m.setItem(t,Pn(g)))},setComplete:function setComplete(t,a){var u=this.getFileInfo(t);u&&(u.modifyAt=Jo(),u.end=!0,a&&m.setItem(t,Pn(u)))},getUploadContext:function getUploadContext(t){var a=this.getFileInfo(t);return a?a.ctx:""},removeFileInfo:function removeFileInfo(t){0===indexOf(t).call(t,"_NosUploader_")&&m.removeItem(t)},clearExpiredInfo:function clearExpiredInfo(){var t,a="function"==typeof m.getKeys?m.getKeys():Bt(m),u=Jo(),h=[],_=n(a);try{for(_.s();!(t=_.n()).done;){var E=t.value;if(0===indexOf(E).call(E,"_NosUploader_")){var T=g.getFileInfo(E);null===T||u-T.modifyAt>I.expireTime?m.removeItem(E):h.push({fileInfo:T,key:E})}}}catch(t){_.e(t)}finally{_.f()}if(h.length>I.maxFileCache){var S,M,A=n(slice(S=sort(h).call(h,(function(t,a){return a.fileInfo.modifyAt-t.fileInfo.modifyAt}))).call(S,I.maxFileCache));try{for(A.s();!(M=A.n()).done;){var b,N=M.value;0===indexOf(b=N.key).call(b,"_NosUploader_")&&m.removeItem(N.key)}}catch(t){A.e(t)}finally{A.f()}}}},h=g;function c(t){return(c="function"==typeof Wa&&"symbol"==typeof as?function(t){return typeof t}:function(t){return t&&"function"==typeof Wa&&t.constructor===Wa&&t!==Wa.prototype?"symbol":typeof t})(t)}function s(t,a){return!a||"object"!==c(a)&&"function"!=typeof a?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):a}function f(t){var a="function"==typeof pc?new pc:void 0;return(f=function f(t){var u,m;if(null===t||(m=t,-1===indexOf(u=Function.toString.call(m)).call(u,"[native code]")))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(t))return a.get(t);a.set(t,n)}function n(){return l(t,arguments,y(this).constructor)}return n.prototype=gt(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,t)})(t)}function l(t,a,u){return(l=p()?Tc:function(t,a,u){var m=[null];m.push.apply(m,a);var g=new(bind$1(Function).apply(t,m));return u&&d(g,u.prototype),g}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Tc)return!1;if(Tc.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Tc(Boolean,[],(function(){}))),!0}catch(t){return!1}}function d(t,a){return(d=vt||function(t,a){return t.__proto__=a,t})(t,a)}function y(t){return(y=vt?za:function(t){return t.__proto__||za(t)})(t)}var _=function(t){!function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");t.prototype=gt(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),a&&d(t,a)}(r,t);var a,u,m=(a=r,u=p(),function(){var t,m=y(a);if(u){var g=y(this).constructor;t=Tc(m,arguments,g)}else t=m.apply(this,arguments);return s(this,t)});function r(t,a){var u;return function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,r),(u=m.call(this,"NosUploadError:"+t)).errCode=a,u.errMsg=t,u}return r}(f(Error)),E=function e(t,a,u){if("uploading"===t.uploadState){var m=t.config,g=t.param,E=h.getUploadContext(t.fileKey);if(!E)return u(0);var T=new XMLHttpRequest,S=m.directUploadAddr+"/".concat(g.bucketName)+"/".concat(encodeURIComponent(g.objectName))+"?uploadContext"+"&context=".concat(E)+"&version=".concat(m.version);T.onreadystatechange=function(){var g;if("abort"!==t.uploadState&&4===T.readyState){var E,M,I,A;try{A=JSON.parse(T.responseText)}catch(t){A={errMsg:"JsonParseError in getOffset. xhr.status = "+T.status+". xhr.responseText: "+T.responseText,errCode:500}}200===T.status?A.errCode?t.config.onError(new _(A.errMsg,A.errCode)):u(A.offset):T.status.toString().match(/^5/)?e(t,a-1,u):a>0?("function"==typeof(null===(g=m.logger)||void 0===g?void 0:g.error)&&m.logger.error(concat(E="getOffset(".concat(S,") error. retry after 3 seconds. ")).call(E,(new Date).toTimeString())),sa((function(){e(t,a-1,u)}),3500)):T.status?(h.removeFileInfo(t.fileKey),m.onError(new _(concat(M=concat(I="getOffset(".concat(S,") error: ")).call(I,T.status," ")).call(M,T.statusText)))):m.onError(new _("getOffset(".concat(S,") error. no Error Code")))}},T.open("get",S),T.setRequestHeader("x-nos-token",g.token),T.timeout=m.getOffsetTimeout,T.send()}},T=function e(t,a,u,m){if("uploading"===t.uploadState){var g=t.param,E=t.config,T=slice(File.prototype),S=void 0!==g.ctx?g.ctx:"",M=a+E.trunkSize>=t.file.size,I=M?t.file.size:a+E.trunkSize,A=new XMLHttpRequest,b=E.directUploadAddr+"/".concat(g.bucketName)+"/".concat(encodeURIComponent(g.objectName));if(A.upload.onprogress=function(u){if("abort"!==t.uploadState){var m=0;u.lengthComputable?(m=(a+u.loaded)/t.file.size,E.onProgress(m),E.onUploadProgress({loaded:u.loaded,total:t.file.size,percentage:m,percentageText:(100*m).toFixed(2)+"%"})):E.onError(new _("browser does not support query upload progress"))}},A.onreadystatechange=function(){var g,T;if("abort"!==t.uploadState&&4===A.readyState){var S,I,N,C;try{C=JSON.parse(A.responseText)}catch(t){"function"==typeof(null===(g=E.logger)||void 0===g?void 0:g.error)&&E.logger.error("JsonParseError in uploadTrunk. xhr.status = "+A.status+". xhr.responseText: "+A.responseText,t),C={errMsg:"JsonParseError in uploadTrunk. xhr.status = "+A.status+". xhr.responseText: "+A.responseText}}200===A.status?(t.setContext(C.context),M?(m(),t.setComplete()):e(t,C.offset,E.retryCount,m)):A.status.toString().match(/^5/)?u>0?e(t,a,u-1,m):(h.removeFileInfo(t.fileKey),E.onError(new _(C.errMsg,C.errCode))):u>0?("function"==typeof(null===(T=E.logger)||void 0===T?void 0:T.error)&&E.logger.error(concat(S="uploadTrunk(".concat(b,") error. retry after 3 seconds. ")).call(S,(new Date).toTimeString())),sa((function(){e(t,a,u-1,m)}),3500)):A.status?(h.removeFileInfo(t.fileKey),E.onError(new _(concat(I=concat(N="uploadTrunk(".concat(b,") error: ")).call(N,A.status," ")).call(I,A.statusText)))):E.onError(new _("uploadTrunk(".concat(b,") error. no Error Code. Please check your network")))}},A.open("post",b+"?offset=".concat(a)+"&complete=".concat(M)+"&context=".concat(S)+"&version=".concat(E.version)),A.setRequestHeader("x-nos-token",g.token),g.md5&&A.setRequestHeader("content-md5",g.md5),t.file.type&&A.setRequestHeader("content-type",t.file.type),A.timeout=E.trunkUploadTimeout,"undefined"!=typeof FileReader){var N=new FileReader;N.addEventListener("load",(function(t){var a;(null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.result)instanceof ArrayBuffer&&t.target.result.byteLength>0?A.send(t.target.result):E.onError(new _("Read ArrayBuffer failed",194003))})),N.addEventListener("error",(function(t){var a=t.target.error;E.onError(new _("Read ArrayBuffer error. ".concat(a.toString()),194003))})),N.readAsArrayBuffer(T.call(t.file,a,I))}else A.send(T.call(t.file,a,I))}};function v(t,a){for(var u=0;u<a.length;u++){var m=a[u];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Ke(t,m.key,m)}}var S=function(){function e(t,a,u){!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=u,this.file=t,this.param=a,this.fileKey=h.initFile(a,t,this.config.enableCache),this.resume()}var t;return(t=[{key:"resume",value:function value(){var t=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var a=this.config;E(this,a.retryCount,(function(u){T(t,u,a.retryCount,(function(){t.setUploadState("ended"),"function"==typeof a.onComplete&&a.onComplete(t.param)}))}))}}},{key:"pause",value:function value(){this.setUploadState("paused")}},{key:"abort",value:function value(){"ended"!==this.uploadState&&"abort"!==this.uploadState&&(this.setUploadState("abort"),this.config.onError(new _("Upload Aborted",10499)))}},{key:"setUploadState",value:function value(t){t!==this.uploadState&&(this.uploadState=t)}},{key:"setContext",value:function value(t){h.setUploadContext(this.fileKey,t,this.config.enableCache),this.param.ctx=t}},{key:"setComplete",value:function value(){h.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&v(e.prototype,t),e}(),M={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function getFileUploadInformation(t){var a=h.getFileKey(t),u=h.getFileInfo(a);return null===u?null:Jo()-u.modifyAt>M.expireTime?(h.removeFileInfo(a),null):{uploadInfo:Lt({bucketName:u.bucket,objectName:u.obj,token:u.token,ctx:u.ctx},u.payload?{payload:u.payload}:{}),complete:u.end}},setMaxFileCache:function setMaxFileCache(t){M.maxFileCache=t},setExpireTime:function setExpireTime(t){M.expireTime=t},printCaches:function printCaches(){if("undefined"!=typeof localStorage)for(var t=0,a=Bt(localStorage);t<a.length;t++){var u=a[t],m=h.getFileInfo(u);m&&console.log(m,"modifiedAt",new Date(m.modifyAt).toTimeString())}},createConfig:function createConfig(t){return new u(t)},createTask:function createTask(t,a,u){return new S(t,a,u)}},I=M;return a.default}()})),_d=Qr.some,vd=arrayMethodIsStrict("some");_export({target:"Array",proto:!0,forced:!vd},{some:function some(t){return _d(this,t,arguments.length>1?arguments[1]:void 0)}});var yd=entryVirtual("Array").some,Ed=Array.prototype,some=function(t){var a=t.some;return t===Ed||j(Ed,t)&&a===Ed.some?yd:a},Td={debug:function debug(){},log:function log(){},warn:function warn(){},error:function error(){}};function setLogger(t){Td=t}function getLogger(){return Td}function isMobile(){if(!navigator||!navigator.userAgent)return!1;var t=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i];return some(t).call(t,(function(t){return navigator.userAgent.match(t)}))}function isElectron(){var t;return!(!navigator||!navigator.userAgent)&&("object"==typeof navigator&&"string"==typeof navigator.userAgent&&indexOf(t=navigator.userAgent).call(t,"Electron")>=0)}function isBrowser(){return navigator&&navigator.userAgent}function uploadFileFn(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u,m,g,h,_,E;return Zl.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(g=getLogger(),t.fileInput||t.file){T.next=3;break}throw new Error("File not exist");case 3:if(!t.file){T.next=7;break}h=t.file,T.next=21;break;case 7:if("string"!=typeof t.fileInput){T.next=16;break}if(!((_=document.getElementById(t.fileInput))&&_.files&&_.files[0])){T.next=13;break}h=_.files[0],T.next=14;break;case 13:throw new Error("Can not get file from fileInput");case 14:T.next=21;break;case 16:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){T.next=20;break}h=t.fileInput.files[0],T.next=21;break;case 20:throw new Error("Can not get file from fileInput "+t.fileInput);case 21:if(!(t.maxSize&&h.size>t.maxSize)){T.next=23;break}throw new Error("The file exceeds maxSize limit. maxSize: "+t.maxSize+", get "+h.size);case 23:return T.next=25,new Ho((function(a,u){var m,_=hd.getFileUploadInformation(h),E=hd.createConfig({enableCache:!0,retryCount:0,directUploadAddr:t.chunkUploadHost,onError:function onError(t){u(t)},onUploadProgress:t.onUploadProgress||function(){},onComplete:function onComplete(t){a(t)}});if(_)if(_.complete)t.onUploadProgress&&t.onUploadProgress({total:h.size,loaded:h.size,percentage:1,percentageText:"100%"}),a(_.uploadInfo);else{m=hd.createTask(h,_.uploadInfo,E);try{t.onUploadStart&&t.onUploadStart(m)}catch(t){g.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),m.abort(),u(t)}}else{m=hd.createTask(h,Lt(Lt({bucketName:t.nosToken.bucket,objectName:decodeURIComponent(t.nosToken.objectName),token:t.nosToken.token},t.md5?{md5:t.md5}:{}),t.payload?{payload:t.payload}:{}),E);try{t.onUploadStart&&t.onUploadStart(m)}catch(t){g.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),m.abort(),u(t)}}}));case 25:return(E=T.sent).name=h.name,E.size=h.size,E.type=h.type,E.ext=lastIndexOf(a=E.name).call(a,".")>-1?slice(u=E.name).call(u,lastIndexOf(m=E.name).call(m,".")+1).toLowerCase():"",T.abrupt("return",E);case 31:case"end":return T.stop()}}),_callee)})))}function getFileUploadInformationFn(t){var a;if(t.file)a=t.file;else if("string"==typeof t.fileInput){var u=document.getElementById(t.fileInput);if(!(u&&u.files&&u.files[0]))throw new Error("Can not get file from fileInput");a=u.files[0]}else{if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0]))throw new Error("Can not get file from fileInput "+t.fileInput);a=t.fileInput.files[0]}return hd.getFileUploadInformation(a)}
/*!
	 * Platform.js v1.3.6
	 * Copyright 2014-2020 Benjamin Tan
	 * Copyright 2011-2013 John-David Dalton
	 * Available under MIT license
	 */var Sd=createCommonjsModule((function(a,u){(function(){var m={function:!0,object:!0}[typeof window]&&window||this,g=u,h=a&&!a.nodeType&&a,_=g&&h&&"object"==typeof t&&t;!_||_.global!==_&&_.window!==_&&_.self!==_||(m=_);var E=Math.pow(2,53)-1,T=/\bOpera/,S=Object.prototype,M=S.hasOwnProperty,I=S.toString;function capitalize(t){return(t=String(t)).charAt(0).toUpperCase()+t.slice(1)}function format(t){return t=trim(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:capitalize(t)}function forOwn(t,a){for(var u in t)M.call(t,u)&&a(t[u],u,t)}function getClassOf(t){return null==t?capitalize(t):I.call(t).slice(8,-1)}function qualify(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function reduce(t,a){var u=null;return function each(t,a){var u=-1,m=t?t.length:0;if("number"==typeof m&&m>-1&&m<=E)for(;++u<m;)a(t[u],u,t);else forOwn(t,a)}(t,(function(m,g){u=a(u,m,g,t)})),u}function trim(t){return String(t).replace(/^ +| +$/g,"")}var A=function parse(t){var a=m,u=t&&"object"==typeof t&&"String"!=getClassOf(t);u&&(a=t,t=null);var g=a.navigator||{},h=g.userAgent||"";t||(t=h);var _,E,S=u?!!g.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(I.toString()),M="Object",A=u?M:"ScriptBridgingProxyObject",b=u?M:"Environment",N=u&&a.java?"JavaPackage":getClassOf(a.java),C=u?M:"RuntimeObject",R=/\bJava/.test(N)&&a.java,O=R&&getClassOf(a.environment)==b,w=R?"a":"Î±",k=R?"b":"Î²",x=a.document||{},P=a.operamini||a.opera,L=T.test(L=u&&P?P["[[Class]]"]:getClassOf(P))?L:P=null,D=t,V=[],U=null,B=t==h,G=B&&P&&"function"==typeof P.version&&P.version(),H=function getLayout(a){return reduce(a,(function(a,u){return a||RegExp("\\b"+(u.pattern||qualify(u))+"\\b","i").exec(t)&&(u.label||u)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),j=function getName(a){return reduce(a,(function(a,u){return a||RegExp("\\b"+(u.pattern||qualify(u))+"\\b","i").exec(t)&&(u.label||u)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),q=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),Y=function getManufacturer(a){return reduce(a,(function(a,u,m){return a||(u[q]||u[/^[a-z]+(?: +[a-z]+\b)*/i.exec(q)]||RegExp("\\b"+qualify(m)+"(?:\\b|\\w*\\d)","i").exec(t))&&m}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),K=function getOS(a){return reduce(a,(function(a,u){var m=u.pattern||qualify(u);return!a&&(a=RegExp("\\b"+m+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(a=function cleanupOS(t,a,u){var m={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return a&&u&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(m=m[/[\d.]+$/.exec(t)])&&(t="Windows "+m),t=String(t),a&&u&&(t=t.replace(RegExp(a,"i"),u)),format(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(a,m,u.label||u)),a}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getProduct(a){return reduce(a,(function(a,u){var m=u.pattern||qualify(u);return!a&&(a=RegExp("\\b"+m+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+m+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+m+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((a=String(u.label&&!RegExp(m,"i").test(u.label)?u.label:a).split("/"))[1]&&!/[\d.]+/.test(a[0])&&(a[0]+=" "+a[1]),u=u.label||u,a=format(a[0].replace(RegExp(m,"i"),u).replace(RegExp("; *(?:"+u+"[_-])?","i")," ").replace(RegExp("("+u+")[-_.]?(\\w)","i"),"$1 $2"))),a}))}function getVersion(a){return reduce(a,(function(a,u){return a||(RegExp(u+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(H&&(H=[H]),/\bAndroid\b/.test(K)&&!q&&(_=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(q=trim(_[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),Y&&!q?q=getProduct([Y]):Y&&q&&(q=q.replace(RegExp("^("+qualify(Y)+")[-_.\\s]","i"),Y+" ").replace(RegExp("^("+qualify(Y)+")[-_.]?(\\w)","i"),Y+" $2")),(_=/\bGoogle TV\b/.exec(q))&&(q=_[0]),/\bSimulator\b/i.test(t)&&(q=(q?q+" ":"")+"Simulator"),"Opera Mini"==j&&/\bOPiOS\b/.test(t)&&V.push("running in Turbo/Uncompressed mode"),"IE"==j&&/\blike iPhone OS\b/.test(t)?(Y=(_=parse(t.replace(/like iPhone OS/,""))).manufacturer,q=_.product):/^iP/.test(q)?(j||(j="Safari"),K="iOS"+((_=/ OS ([\d_]+)/i.exec(t))?" "+_[1].replace(/_/g,"."):"")):"Konqueror"==j&&/^Linux\b/i.test(K)?K="Kubuntu":Y&&"Google"!=Y&&(/Chrome/.test(j)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(q))||/\bAndroid\b/.test(K)&&/^Chrome/.test(j)&&/\bVersion\//i.test(t)?(j="Android Browser",K=/\bAndroid\b/.test(K)?K:"Android"):"Silk"==j?(/\bMobi/i.test(t)||(K="Android",V.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&V.unshift("accelerated")):"UC Browser"==j&&/\bUCWEB\b/.test(t)?V.push("speed mode"):"PaleMoon"==j&&(_=/\bFirefox\/([\d.]+)\b/.exec(t))?V.push("identifying as Firefox "+_[1]):"Firefox"==j&&(_=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(K||(K="Firefox OS"),q||(q=_[1])):!j||(_=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(j))?(j&&!q&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(_+"/")+8))&&(j=null),(_=q||Y||K)&&(q||Y||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(K))&&(j=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(K)?K:_)+" Browser")):"Electron"==j&&(_=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&V.push("Chromium "+_),G||(G=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(j),"(?:Firefox|Minefield|NetFront)"])),(_=("iCab"==H&&parseFloat(G)>3?"WebKit":/\bOpera\b/.test(j)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(H)&&"WebKit"||!H&&/\bMSIE\b/i.test(t)&&("Mac OS"==K?"Tasman":"Trident")||"WebKit"==H&&/\bPlayStation\b(?! Vita\b)/i.test(j)&&"NetFront")&&(H=[_]),"IE"==j&&(_=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(j+=" Mobile",K="Windows Phone "+(/\+$/.test(_)?_:_+".x"),V.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(j="IE Mobile",K="Windows Phone 8.x",V.unshift("desktop mode"),G||(G=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=j&&"Trident"==H&&(_=/\brv:([\d.]+)/.exec(t))&&(j&&V.push("identifying as "+j+(G?" "+G:"")),j="IE",G=_[1]),B){if(function isHostType(t,a){var u=null!=t?typeof t[a]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(u)||"object"==u&&!t[a])}(a,"global"))if(R&&(D=(_=R.lang.System).getProperty("os.arch"),K=K||_.getProperty("os.name")+" "+_.getProperty("os.version")),O){try{G=a.require("ringo/engine").version.join("."),j="RingoJS"}catch(t){(_=a.system)&&_.global.system==a.system&&(j="Narwhal",K||(K=_[0].os||null))}j||(j="Rhino")}else"object"==typeof a.process&&!a.process.browser&&(_=a.process)&&("object"==typeof _.versions&&("string"==typeof _.versions.electron?(V.push("Node "+_.versions.node),j="Electron",G=_.versions.electron):"string"==typeof _.versions.nw&&(V.push("Chromium "+G,"Node "+_.versions.node),j="NW.js",G=_.versions.nw)),j||(j="Node.js",D=_.arch,K=_.platform,G=(G=/[\d.]+/.exec(_.version))?G[0]:null));else getClassOf(_=a.runtime)==A?(j="Adobe AIR",K=_.flash.system.Capabilities.os):getClassOf(_=a.phantom)==C?(j="PhantomJS",G=(_=_.version||null)&&_.major+"."+_.minor+"."+_.patch):"number"==typeof x.documentMode&&(_=/\bTrident\/(\d+)/i.exec(t))?(G=[G,x.documentMode],(_=+_[1]+4)!=G[1]&&(V.push("IE "+G[1]+" mode"),H&&(H[1]=""),G[1]=_),G="IE"==j?String(G[1].toFixed(1)):G[0]):"number"==typeof x.documentMode&&/^(?:Chrome|Firefox)\b/.test(j)&&(V.push("masking as "+j+" "+G),j="IE",G="11.0",H=["Trident"],K="Windows");K=K&&format(K)}if(G&&(_=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(G)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(B&&g.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(U=/b/i.test(_)?"beta":"alpha",G=G.replace(RegExp(_+"\\+?$"),"")+("beta"==U?k:w)+(/\d+\+?/.exec(_)||"")),"Fennec"==j||"Firefox"==j&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(K))j="Firefox Mobile";else if("Maxthon"==j&&G)G=G.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(q))"Xbox 360"==q&&(K=null),"Xbox 360"==q&&/\bIEMobile\b/.test(t)&&V.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(j)&&(!j||q||/Browser|Mobi/.test(j))||"Windows CE"!=K&&!/Mobi/i.test(t))if("IE"==j&&B)try{null===a.external&&V.unshift("platform preview")}catch(t){V.unshift("embedded")}else(/\bBlackBerry\b/.test(q)||/\bBB10\b/.test(t))&&(_=(RegExp(q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||G)?(K=((_=[_,/BB10/.test(t)])[1]?(q=null,Y="BlackBerry"):"Device Software")+" "+_[0],G=null):this!=forOwn&&"Wii"!=q&&(B&&P||/Opera/.test(j)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==j&&/\bOS X (?:\d+\.){2,}/.test(K)||"IE"==j&&(K&&!/^Win/.test(K)&&G>5.5||/\bWindows XP\b/.test(K)&&G>8||8==G&&!/\bTrident\b/.test(t)))&&!T.test(_=parse.call(forOwn,t.replace(T,"")+";"))&&_.name&&(_="ing as "+_.name+((_=_.version)?" "+_:""),T.test(j)?(/\bIE\b/.test(_)&&"Mac OS"==K&&(K=null),_="identify"+_):(_="mask"+_,j=L?format(L.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(_)&&(K=null),B||(G=null)),H=["Presto"],V.push(_));else j+=" Mobile";(_=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(_=[parseFloat(_.replace(/\.(\d)$/,".0$1")),_],"Safari"==j&&"+"==_[1].slice(-1)?(j="WebKit Nightly",U="alpha",G=_[1].slice(0,-1)):G!=_[1]&&G!=(_[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(G=null),_[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==_[0]&&537.36==_[2]&&parseFloat(_[1])>=28&&"WebKit"==H&&(H=["Blink"]),B&&(S||_[1])?(H&&(H[1]="like Chrome"),_=_[1]||((_=_[0])<530?1:_<532?2:_<532.05?3:_<533?4:_<534.03?5:_<534.07?6:_<534.1?7:_<534.13?8:_<534.16?9:_<534.24?10:_<534.3?11:_<535.01?12:_<535.02?"13+":_<535.07?15:_<535.11?16:_<535.19?17:_<536.05?18:_<536.1?19:_<537.01?20:_<537.11?"21+":_<537.13?23:_<537.18?24:_<537.24?25:_<537.36?26:"Blink"!=H?"27":"28")):(H&&(H[1]="like Safari"),_=(_=_[0])<400?1:_<500?2:_<526?3:_<533?4:_<534?"4+":_<535?5:_<537?6:_<538?7:_<601?8:_<602?9:_<604?10:_<606?11:_<608?12:"12"),H&&(H[1]+=" "+(_+="number"==typeof _?".x":/[.+]/.test(_)?"":"+")),"Safari"==j&&(!G||parseInt(G)>45)?G=_:"Chrome"==j&&/\bHeadlessChrome/i.test(t)&&V.unshift("headless")),"Opera"==j&&(_=/\bzbov|zvav$/.exec(K))?(j+=" ",V.unshift("desktop mode"),"zvav"==_?(j+="Mini",G=null):j+="Mobile",K=K.replace(RegExp(" *"+_+"$"),"")):"Safari"==j&&/\bChrome\b/.exec(H&&H[1])?(V.unshift("desktop mode"),j="Chrome Mobile",G=null,/\bOS X\b/.test(K)?(Y="Apple",K="iOS 4.3+"):K=null):/\bSRWare Iron\b/.test(j)&&!G&&(G=getVersion("Chrome")),G&&0==G.indexOf(_=/[\d.]+$/.exec(K))&&t.indexOf("/"+_+"-")>-1&&(K=trim(K.replace(_,""))),K&&-1!=K.indexOf(j)&&!RegExp(j+" OS").test(K)&&(K=K.replace(RegExp(" *"+qualify(j)+" *"),"")),H&&!/\b(?:Avant|Nook)\b/.test(j)&&(/Browser|Lunascape|Maxthon/.test(j)||"Safari"!=j&&/^iOS/.test(K)&&/\bSafari\b/.test(H[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(j)&&H[1])&&(_=H[H.length-1])&&V.push(_),V.length&&(V=["("+V.join("; ")+")"]),Y&&q&&q.indexOf(Y)<0&&V.push("on "+Y),q&&V.push((/^on /.test(V[V.length-1])?"":"on ")+q),K&&(_=/ ([\d.+]+)$/.exec(K),E=_&&"/"==K.charAt(K.length-_[0].length-1),K={architecture:32,family:_&&!E?K.replace(_[0],""):K,version:_?_[1]:null,toString:function(){var t=this.version;return this.family+(t&&!E?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(_=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(D))&&!/\bi686\b/i.test(D)?(K&&(K.architecture=64,K.family=K.family.replace(RegExp(" *"+_),"")),j&&(/\bWOW64\b/i.test(t)||B&&/\w(?:86|32)$/.test(g.cpuClass||g.platform)&&!/\bWin64; x64\b/i.test(t))&&V.unshift("32-bit")):K&&/^OS X/.test(K.family)&&"Chrome"==j&&parseFloat(G)>=39&&(K.architecture=64),t||(t=null);var W={};return W.description=t,W.layout=H&&H[0],W.manufacturer=Y,W.name=j,W.prerelease=U,W.product=q,W.ua=t,W.version=j&&G,W.os=K||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=parse,W.toString=function toStringPlatform(){return this.description||""},W.version&&V.unshift(G),W.name&&V.unshift(j),K&&j&&(K!=String(K).split(" ")[0]||K!=j.split(" ")[0]&&!q)&&V.push(q?"("+K+")":"on "+K),V.length&&(W.description=V.join(" ")),W}();g&&h?forOwn(A,(function(t,a){g[a]=t})):m.platform=A}).call(t)}));function getSystemInfoFn(){var t,a,u=Sd.version||"";if(isElectron())try{var m=navigator.userAgent.match(/Electron\/([\d.]+\d+)/);m&&m[1]&&"string"==typeof m[1]&&(u=m[1])}catch(t){}return{os:(null===(t=Sd.os)||void 0===t?void 0:t.family)||"",osVer:(null===(a=Sd.os)||void 0===a?void 0:a.version)||"",browser:Sd.name||"",browserVer:Sd.version||"",libEnv:"BROWSER",hostEnv:isElectron()?"Electron":isMobile()?"H5":isBrowser()?"BROWSER":"Unset",hostEnvEnum:isElectron()?5:isMobile()?101:isBrowser()?100:0,hostEnvVer:u,userAgent:navigator&&navigator.userAgent,model:u,manufactor:Sd.name||""}}var Md=null,Id=null,Ad={getNetworkStatus:function getNetworkStatus(){return Ho.resolve({net_type:0,net_connect:"undefined"==typeof navigator||"boolean"!=typeof navigator.onLine||navigator.onLine})},onNetworkStatusChange:function onNetworkStatusChange(t){Md=function onlineListener(){t({isConnected:!0,networkType:0})},Id=function offlineListener(){t({isConnected:!1,networkType:0})},window.addEventListener("online",Md),window.addEventListener("offline",Id)},offNetworkStatusChange:function offNetworkStatusChange(){Md&&window.removeEventListener("online",Md),Id&&window.removeEventListener("offline",Id),Md=null,Id=null}},bd=getLogger(),Nd=function getVisibilityEvent(){var t="hidden",a="visibilitychange";return"undefined"==typeof document||void 0!==document.hidden||(void 0!==document.webkitHidden?(t="webkitHidden",a="webkitvisibilitychange"):void 0!==document.msHidden?(t="msHidden",a="msvisibilitychange"):void 0!==document.mozHidden&&(t="mozHidden",a="mozvisibilitychange")),{hidden:t,visibilityChange:a}},Cd=function(t){function PowerMonitor(){var a;return(a=t.call(this)||this).status=0,a.visibilityListener=null,a.flag=!1,a._initVisibilityListener(),a}Ct(PowerMonitor,t);var a=PowerMonitor.prototype;return a.isActive=function isActive(){return 0===this.status},a.getStatus=function getStatus(){return this.status},a.setStatus=function setStatus(t){var a=this.status;t!==a&&(this.status=t,0===t&&1===a&&this.emit("onPowerMonitorTurnActive"),bd.log("Adapter powerMonitor::setStatus: ",t))},a.destroy=function destroy(){if(this.status=0,this.flag=!1,this._canIUse()&&this.visibilityListener){var t=Nd().visibilityChange;document.removeEventListener(t,this.visibilityListener),this.visibilityListener=null}},a._initVisibilityListener=function _initVisibilityListener(){if(!this.flag)if(!1!==this._canIUse()){var t=Nd(),a=t.hidden,u=t.visibilityChange;a&&void 0!==document[a]&&(this.visibilityListener=function genVisibilityListener(t){return function(){var a=t.status,u=Nd().hidden;u&&document[u]?t.status=1:(t.status=0,1===a&&t.emit("onPowerMonitorTurnActive")),bd.log("Adapter powerMonitor::visibility change status:",t.status)}}(this),document.addEventListener(u,this.visibilityListener),this.flag=!0,bd.log("Adapter powerMonitor::_initVisibilityListener success, isHidden:",null===document||void 0===document?void 0:document[a]))}else bd.warn("Adapter powerMonitor::_initVisibilityListener no document.addEventListener")},a._canIUse=function _canIUse(){return"undefined"!=typeof document&&void 0!==document.addEventListener},PowerMonitor}(ca),Rd="log",Od=function(){function IDB(t,a){this.db=null,this.stores=[],this.name=t,this.version=a}var t=IDB.prototype;return t.getDB=function getDB(){if(!this.db)throw new Error("DB not ready");return this.db},t.getStore=function getStore(t){var a,u=find(a=this.stores).call(a,(function(a){return a.storeName===t}));if(!u)throw new Error("LogStorage: store not found. "+t);return u},t.open=function open(){var t=this,a=window.indexedDB.open(this.name,this.version);return new Ho((function(u,m){a.onerror=function(t){var a=t.target;m(a.error)},a.onsuccess=function(a){var m,g,h=a.target;t.db=h.result,t.db.removeEventListener("close",bind$1(m=t.triggerDBCloseEvt).call(m,t)),t.db.addEventListener("close",bind$1(g=t.triggerDBCloseEvt).call(g,t)),t.stores.push(new wd(Rd,t)),u()},a.onupgradeneeded=function(a){var u=a.target;t.upgradeDBBySchema(u)}}))},t.triggerDBCloseEvt=function triggerDBCloseEvt(){try{this.db&&this.db.close(),this.db=null}catch(t){}this.open()},t.upgradeDBBySchema=function upgradeDBBySchema(t){var a=t.result,u=t.transaction&&a.objectStoreNames.contains(Rd)?t.transaction.objectStore(Rd):a.createObjectStore(Rd,{keyPath:"id",autoIncrement:!0});try{u.index("time")}catch(t){u.createIndex("time","time",{unique:!1})}},t.close=function close(){var t;this.db&&(this.db.removeEventListener("close",bind$1(t=this.triggerDBCloseEvt).call(t,this)),this.db.close(),this.stores=[],this.db=null)},IDB}(),wd=function(){function IDBStore(t,a){this.idb=null,this.storeName=t,this.idb=a}var t=IDBStore.prototype;return t.getDB=function getDB(){if(!this.idb)throw new Error("DB not ready");return this.idb.getDB()},t.getStoreName=function getStoreName(){return this.storeName},t.bulkCreate=function bulkCreate(t){var a=this.getDB(),u=this.getStoreName(),m=a.transaction(u,"readwrite"),g=m.objectStore(u);return forEach$1(t).call(t,(function(t){g.add(t)})),new Ho((function(t,a){m.oncomplete=function(){t()},m.onerror=function(t){var u=t.target;a(u.error)},m.onabort=function(t){var u=t.target;u.error instanceof Error?a(u.error):a(new Error("TransactionAborted"))}}))},t.bulkDelete=function bulkDelete(t){var a=t.keyName,u=t.lower,m=t.upper,g=t.lowerOpen,h=void 0!==g&&g,_=t.upperOpen,E=void 0!==_&&_,T=IDBKeyRange.bound(u,m,h,E),S=this.getDB(),M=this.getStoreName(),I=S.transaction(M,"readwrite"),A=I.objectStore(M).index(a).openCursor(T),b=0;return A.onsuccess=function(t){var a=t.target.result;a&&(a.delete(),b++,a.continue())},new Ho((function(t,a){I.oncomplete=function(){t(b)},I.onerror=function(t){var u=t.target;a(u.error)},I.onabort=function(t){var u=t.target;u.error instanceof Error?a(u.error):a(new Error("TransactionAborted"))}}))},t.readAll=function readAll(){var t=this.getDB(),a=this.getStoreName(),u=t.transaction(a,"readonly").objectStore(a);if(!u.getAll)throw new Error("IDBExtract not support");var m=u.getAll();return new Ho((function(t,a){m.onsuccess=function(a){var u=a.target;t(u.result)},m.onerror=function(t){var u=t.target;a(u.error)}}))},IDBStore}(),kd=function(){function LogStorageImpl(t){void 0===t&&(t="nim_logs"),this.idb=new Od(t,1)}var t=LogStorageImpl.prototype;return t.open=function open(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var t;return Zl.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.idb.open();case 2:return t=this.idb.getStore(Rd),a.prev=3,a.next=6,t.bulkDelete({keyName:"time",lower:0,upper:Jo()-2592e5});case 6:a.next=10;break;case 8:a.prev=8,a.t0=a.catch(3);case 10:case"end":return a.stop()}}),_callee,this,[[3,8]])})))},t.close=function close(){this.idb.close()},t.addLogs=function addLogs(t){return this.idb.getStore(Rd).bulkCreate(t)},t.extractLogs=function extractLogs(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var t,a,u,m,g;return Zl.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return a=this.idb.getStore(Rd),h.next=3,a.readAll();case 3:if(0!==(u=h.sent).length){h.next=6;break}return h.abrupt("return",void 0);case 6:return m=reduce(u).call(u,(function(t,a){var u=a.iid;return t[u]||(t[u]=[]),t[u].push(a),t}),{}),g=map$6(t=Bt(m)).call(t,(function(t){var a=m[t];return"==========iid:"+t+"==========\n "+map$6(a).call(a,(function(t){return t.text})).join("\n")})).join("\n"),h.abrupt("return",new File([g],"nim-logs.txt",{type:"text/plain"}));case 9:case"end":return h.stop()}}),_callee2,this)})))},t.afterUpload=function afterUpload(){return Ho.resolve()},LogStorageImpl}();function _createForOfIteratorHelperLoose$4(t,a){var u,m=void 0!==Wa&&$l(t)||t["@@iterator"];if(m)return bind$1(u=(m=m.call(t)).next).call(u,m);if(Ln(t)||(m=function _unsupportedIterableToArray$4(t,a){if(t){var u;if("string"==typeof t)return _arrayLikeToArray$4(t,a);var m=slice(u={}.toString.call(t)).call(u,8,-1);return"Object"===m&&t.constructor&&(m=t.constructor.name),"Map"===m||"Set"===m?Wl(t):"Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?_arrayLikeToArray$4(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var g=0;return function(){return g>=t.length?{done:!0}:{done:!1,value:t[g++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$4(t,a){(null==a||a>t.length)&&(a=t.length);for(var u=0,m=Array(a);u<a;u++)m[u]=t[u];return m}var xd={},Pd={};function parseEachCmd(t,a,u,m,g){var h,_={cmd:u,raw:t,error:null,service:null==a?void 0:a.service,content:{},__receiveTimeNode:Bu.getTimeNode()};(18===a.sid||a.sid>=26&&a.sid<100)&&(t.code=function toReadableCode(t){if("number"!=typeof t||t!=t)throw new Vl({code:Ll.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:""+t}});if(t<0||t>=0&&t<1e3||t>=2e4&&t<=20099)return t;var a=(65535&t)>>9;a-=a<=38?1:2;return 1e5+1e3*a+(511&t)}(t.code));var E,T=function genCmdError(t,a){var u=Dl[t],m=jl[t];return null===m?null:new Vl({code:t,desc:u||m||t,detail:{cmd:a,timetag:Jo()}})}(t.code,u);if(_.error=T,_.error){if(_.error.detail.cmd=u,!(null===(h=null==a?void 0:a.ignoreErrCodes)||void 0===h?void 0:includes(h).call(h,t.code)))return _;g.warn("parseCmd:: ignore error ",_.error),_.error.detail.ignore=!0}a.response&&forEach$1(E=a.response).call(E,(function(t,a){var u=m[a],g=t.type,h=t.name,E=t.reflectMapper;if(void 0!==u)switch(g){case"Property":_.content[h]=E?deserialize(u,E):u;break;case"PropertyArray":_.content[h]=map$6(u).call(u,(function(t){return E?deserialize(t,E):t}));break;case"Int":case"Long":case"Byte":_.content[h]=+u;break;case"Bool":_.content[h]="true"===u||!0===u||1===u;break;default:_.content[h]=u}}));return _}function serialize(t,a,u){var m={};for(var g in t=function flattenObjByMapper(t,a){var u={};for(var m in a){for(var g,h=a[m],_="number"==typeof h?m:h.access?h.access:m,E=t,T=_createForOfIteratorHelperLoose$4(_.split("."));!(g=T()).done;){var S=g.value;if(void 0===E[S]||null===E[S]){E=void 0;break}E=E[S]}void 0!==E&&(u[_]=E)}return u}(t,a),a){var h=a[g],_="number"==typeof h?g:h.access?h.access:g;if(!u||includes(u).call(u,g))if(_ in t){if("number"==typeof h)m[h]=t[_];else if("object"==typeof h)if(h.converter){var E=h.converter(t[_],t);void 0!==E&&(m[h.id]=E)}else m[h.id]=t[_]}else"object"==typeof h&&h.def&&("function"==typeof h.def?m[h.id]=h.def(t):m[h.id]=h.def)}return m}function deserialize(t,a){var u={};for(var m in t){var g=a[m];if("string"==typeof g)u[g]=t[m];else if("object"==typeof g&&"prop"in g){var h=g.access?g.access:g.prop;if(g.converter){var _=g.converter(t[m],t);void 0!==_&&(u[h]=_)}else g.type&&"number"===g.type?u[h]=+t[m]:g.type&&"boolean"===g.type?u[h]=!("0"===t[m]||!t[m]):u[h]=t[m]}}for(var E in a){var T=a[E];if(T&&void 0!==T.def){var S=T.access?T.access:T.prop;S in u||("function"==typeof T.def?u[S]=T.def(t):u[S]=T.def)}}return u=function unflattenObj(t){var a={},u=function _loop(u){var m=u.split(".");reduce(m).call(m,(function(a,g,h){return a[g]||(a[g]=isNaN(Number(m[h+1]))?m.length-1==h?t[u]:{}:[])}),a)};for(var m in t)u(m);return a}(u),u}function registerParser(t){for(var a in Lt(xd,t.cmdConfig),t.cmdMap){var u=t.cmdMap[a],m=t.cmdConfig[u];if(m)if(Ln(Pd[a])){for(var g,h=!1,_=_createForOfIteratorHelperLoose$4(Pd[a]);!(g=_()).done;){var E=g.value;if(E.cmd===u&&E.config.service===m.service){h=!0;break}}h||Pd[a].push({config:m,cmd:u})}else Pd[a]=[{config:m,cmd:u}]}}function invertSerializeMap(t){var a,u={};return forEach$1(a=Bt(t)).call(a,(function(a){u[a]=invertSerializeItem(t[a])})),u}function invertSerializeItem(t){var a={};for(var u in t){var m=t[u];"number"==typeof m?a[m]=u:"object"==typeof m&&(a[m.id]={prop:u,type:m.retType,access:m.retAccess?m.retAccess:m.access?m.access:u,def:m.retDef,converter:m.retConverter})}return a}var Ld,Dd,Vd,Ud,Fd,Bd={"1_2":"heartbeat","2_3":"login","2_5":"kicked","2_6":"logout","2_7":"nimLoginClientChange","2_8":"kick"},Gd={login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,loginTime:109,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,connectionId:102,ip:103,port:104,time:109,pushType:110,hasTokenPreviously:111},aosPushInfo:{pushType:110,hasTokenPreviously:111}},Hd=invertSerializeMap(Gd),jd={login:{sid:2,cid:3,service:"auth",params:[{type:"Property",name:"login",reflectMapper:Gd.login}],response:[{type:"Property",name:"loginRes",reflectMapper:Hd.loginRes},{type:"PropertyArray",name:"loginPorts",reflectMapper:Hd.loginPort},{type:"Property",name:"aosPushInfo",reflectMapper:Hd.aosPushInfo}]},logout:{sid:2,cid:6,service:"auth"},heartbeat:{sid:1,cid:2,service:"auth"},kicked:{sid:2,cid:5,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"ext"},{type:"Int",name:"customClientType"}]},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Hd.loginPort}]},kick:{sid:2,cid:8,service:"auth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]}};function format(t,a){if(!isPlainObject(a))return{};var u=JSON.parse(Pn(a)),m=doFormat(t,u);return JSON.parse(Pn(Lt(Lt({},u),m)))}function doFormat(t,a){if(!isPlainObject(a))return{};var u={},m=Bt(t);return forEach$1(m).call(m,(function(m){var g=t[m].type;if("string"!=typeof g){var h=doFormat(t[m],a);Bt(h).length>0&&(u[m]=h)}else{var _=t[m],E=_.rawKey||m,T=qd[g](a,E,_);void 0!==T&&(a[E]=void 0,u[m]=T)}})),u}!function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(Ld||(Ld={})),function(t){t[t.p2p=0]="p2p",t[t.team=1]="team",t[t.superTeam=5]="superTeam"}(Dd||(Dd={})),function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac",t[t.HarmonyOS=65]="HarmonyOS"}(Vd||(Vd={})),function(t){t[t.unread=1]="unread",t[t.read=2]="read",t[t.deleted=3]="deleted",t[t.sending=4]="sending",t[t.sendFailed=5]="sendFailed",t[t.sent=6]="sent",t[t.receipt=7]="receipt",t[t.refused=10]="refused"}(Ud||(Ud={})),function(t){t[t.default=0]="default",t[t.leave=1]="leave",t[t.roam=2]="roam"}(Fd||(Fd={}));var qd={number:function number(t,a){if(void 0!==t[a])return+t[a]},string:function string(t,a){if(void 0!==t[a])return t[a]},boolean:function boolean(t,a){return+t[a]>0||0!=+t[a]&&void 0},enum:function _enum(t,a,u){return values(u)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return JSON.parse(t[a])}catch(t){return{}}}};function formatReverse(t,a){if(!isPlainObject(a))return{};var u=JSON.parse(Pn(a)),m=doFormatReverse(t,u);return JSON.parse(Pn(Lt(Lt({},u),m)))}function doFormatReverse(t,a){var u;if(!isPlainObject(a))return reduce(u=Bt(t)).call(u,(function(a,u){return a[t[u].rawKey||u]=void 0,a}),{});var m={},g=Bt(t);return forEach$1(g).call(g,(function(u){var g=t[u].type;if("string"!=typeof g){var h=doFormatReverse(t[u],a[u]);return Lt(m,h),void(a[u]=void 0)}var _=t[u],E=_.rawKey||u,T=Yd[g](a,u,_);a[E]=void 0,m[E]=T})),m}var Yd={number:function number(t,a){return t[a]},string:function string(t,a){return t[a]},boolean:function boolean(t,a){return!0===t[a]?1:!1===t[a]?0:void 0},enum:function _enum(t,a,u){return values(u)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return Pn(t[a])}catch(t){return""}}},Kd=Yd;function formatMultiPortLoginInfo(t,a){return t&&t.length>0?map$6(t).call(t,(function(t){return Lt(Lt({},t),{account:t.account,connectionId:t.connectionId,deviceId:t.deviceId,ip:t.ip,mac:t.mac,os:t.os,type:getEnumKeyByEnumValue(Vd,t.type)||t.type,time:Cu(t.time),online:3!==a})})):[]}var Wd={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}};var $d=Backoff;function Backoff(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),u=Math.floor(a*this.jitter*t);t=0==(1&Math.floor(10*a))?t-u:t+u}return 0|Math.min(t,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(t){this.ms=t},Backoff.prototype.setMax=function(t){this.max=t},Backoff.prototype.setJitter=function(t){this.jitter=t};var zd,Jd=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],Xd=["transport not supported","client not handshaken","unauthorized"],Qd=["reconnect"],Zd=function(t){function BaseWebsocket(a,u,m){var g;return(g=t.call(this)||this).websocket=null,g.socketConnectTimer=0,g.url="",g.linkSSL=!0,g.core=a,g.url=u,g.linkSSL=m,g.status="disconnected",g.logger=a.logger,g.connect(),g}Ct(BaseWebsocket,t);var a=BaseWebsocket.prototype;return a.connect=function connect(){var t=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request((this.linkSSL?"https":"http")+"://"+this.url+"/socket.io/1/?t="+Jo(),{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then((function(a){if("connecting"===t.status){var u=a.data.split(":"),m=u[0];return u[1],t.sessionId=m,t.logger.log("imsocket::XHR success. status "+t.status+", "+("connecting"===t.status?"continue websocket connection":"stop websocket connection")),t._createWebsocket((t.linkSSL?"wss":"ws")+"://"+t.url+"/socket.io/1/websocket/"+m)}})).catch((function(a){if("connecting"===t.status){var u='imsocket::XHR fail. raw message: "'+(a=a||{}).message+'", code: "'+a.code+'"',m=a.code;m="v2"===get(t.core,"options.apiVersion")?a.code===Ll.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?Ll.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:Ll.V2NIM_ERROR_CODE_CONNECT_FAILED:408===a.code?408:415;var g=new Vl({code:m,detail:{reason:u,rawError:a}});t.logger.error(u),t.status="disconnected",t.emit("handshakeFailed",g)}}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},a.close=function close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(t){this.logger.warn("imsocket::attempt to send encodePacket error",t)}try{this.websocket.close()}catch(t){this.logger.warn("imsocket::attempt to close websocket error",t)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}},a.clean=function clean(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},a.onConnect=function onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},a._createWebsocket=function _createWebsocket(t){var a,u=this;this.socketConnectTimer=sa((function(){u.logger.error("imsocket::Websocket connect timeout. url: ",u.socketUrl),u.emit("handshakeFailed",new Vl({code:"v2"===get(u.core,"options.apiVersion")?Ll.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+u.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=t,this.websocket=new eu.WebSocket(t),this.websocket.onmessage=bind$1(a=this.onMessage).call(a,this),this.websocket.onclose=function(t){t=t||{},u.logger.log("imsocket::Websocket onclose done "+t.wasClean+"/"+t.code+"/"+t.reason),u.clean(),u.emit("disconnect",{code:t.code||0,reason:t.reason})},this.websocket.onerror=function(t){u.logger.error("imsocket::Websocket onerror",t),"logined"===u.core.status&&u.core.clientSocket.ping()}},a.onMessage=function onMessage(t){var a,u=this.decodePacket(t.data);if(u)switch(u.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",u.data);break;case"event":u.name&&this.emit(u.name,u.args);break;case"error":"unauthorized"===u.reason?this.emit("connect_failed",u.reason):this.emit("error",u.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new Vl({code:"v2"===get(this.core,"options.apiVersion")?Ll.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:"imsocket::Websocket connect failed, onMessage socket error. url: "+this.socketUrl}}));break;case"heartbeat":null===(a=this.websocket)||void 0===a||a.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",u.type)}},a.encodePacket=function encodePacket(t){var a,u,m=t.type,g=t.id,h=void 0===g?"":g,_=t.endpoint,E=void 0===_?"":_,T=t.ack,S=null;if(!m)return"";switch(m){case"error":a=t.reason?indexOf(Xd).call(Xd,t.reason):"",u=t.advice?indexOf(Qd).call(Qd,t.advice):"",""===a&&""===u||(S=a+(""!==u?"+"+u:""));break;case"message":""!==t.data&&(S=t.data);break;case"event":a={name:t.name},a=t.args&&t.args.length?{name:t.name,args:t.args}:{name:t.name},S=Pn(a);break;case"json":S=Pn(t.data);break;case"connect":t.qs&&(S=t.qs);break;case"ack":S=t.ackId+(t.args&&t.args.length?"+"+Pn(t.args):"")}var M=[indexOf(Jd).call(Jd,m),h+("data"===T?"+":""),E];return null!=S&&M.push(S),M.join(":")},a.decodePacket=function decodePacket(t){if(t)if("ï¿½"!=t.charAt(0)){var a=t.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(a){var u,m=a[1],g=a[2],h=a[3],_=a[4],E=a[5],T={type:Jd[+m],endpoint:_};switch(g&&(T.id=g,T.ack=!h||"data"),T.type){case"error":u=E.split("+"),T.reason=Xd[+u[0]]||"";break;case"message":T.data=E||"";break;case"connect":T.qs=E||"";break;case"event":try{var S=JSON.parse(E);T.name=S.name,T.args=S.args}catch(t){this.logger.error("imsocket::parseData::type::event error",t)}T.args=T.args||[];break;case"json":try{T.data=JSON.parse(E)}catch(t){this.logger.error("imsocket::parseData::type::json error",t)}break;case"ack":if((u=E.match(/^([0-9]+)(\+)?(.*)/))&&(T.ackId=u[1],T.args=[],u[3]))try{T.args=u[3]?JSON.parse(u[3]):[]}catch(t){this.logger.error("imsocket::parseData::type::ack error",t)}}return T}}else this.logger.error("imsocket::unrecognize dataStr",slice(t).call(t,0,20))},a.send=function send(t){var a,u={data:t,type:"message",endpoint:""};null===(a=this.websocket)||void 0===a||a.send(this.encodePacket(u))},BaseWebsocket}(ca);function uniq(t){t=t||[];for(var a=[],u=0;u<t.length;u++)-1===indexOf(a).call(a,t[u])&&a.push(t[u]);return a}function _createForOfIteratorHelperLoose$3(t,a){var u,m=void 0!==Wa&&$l(t)||t["@@iterator"];if(m)return bind$1(u=(m=m.call(t)).next).call(u,m);if(Ln(t)||(m=function _unsupportedIterableToArray$3(t,a){if(t){var u;if("string"==typeof t)return _arrayLikeToArray$3(t,a);var m=slice(u={}.toString.call(t)).call(u,8,-1);return"Object"===m&&t.constructor&&(m=t.constructor.name),"Map"===m||"Set"===m?Wl(t):"Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?_arrayLikeToArray$3(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var g=0;return function(){return g>=t.length?{done:!0}:{done:!1,value:t[g++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$3(t,a){(null==a||a>t.length)&&(a=t.length);for(var u=0,m=Array(a);u<a;u++)m[u]=t[u];return m}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(zd||(zd={}));var ep=function(){function V1ClientSocket(t,a){this.linkUrls=[],this.isAutoReconnect=!1,this.packetTimeout=3e4,this.linkSSL=!0,this.packetSer=1,this.retryCount=0,this.reconnectTimer=0,this.backoff=new $d({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new pc,this.pingTimer=0,this.hasNetworkListener=!1,this.core=t,a&&(this.auth=a),this.logger=t.logger,this.reporter=t.reporter,this.timerManager=t.timerManager}var t=V1ClientSocket.prototype;return t.setSessionId=function setSessionId(t){},t.setLinkSSL=function setLinkSSL(t){this.linkSSL=t},t.connect=function connect(t,a){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,Zl.mark((function _callee(){var u,m,g,h,_,E;return Zl.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(validate({linkUrls:{type:"array",itemType:"string",required:!1}},t),/^(unconnected|waitReconnect)$/.test(this.core.status)){T.next=5;break}return u="Core socket status is "+this.core.status+", and would not connect",this.logger.warn(u),T.abrupt("return",Ho.reject(u));case 5:this.core.status="connecting",t.linkUrls&&t.linkUrls.length>0&&(this.linkUrls=concat(m=t.linkUrls).call(m,this.linkUrls),this.linkUrls=uniq(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push(ku),g=0;case 9:if(!(g<this.linkUrls.length)){T.next=31;break}return h=this.linkUrls[g],_=(new Date).getTime(),T.prev=12,T.next=15,this.doConnect(h);case 15:return this.core.status="connected",this.logger.log("clientsocketV1::connect success with url: "+h),T.abrupt("return",h);case 20:T.prev=20,T.t0=T.catch(12),E=T.t0,a&&a(E,h),this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,start_time:_,action:0,exception_service:6}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof E.code?E.code:0,description:E.message||""+E.code,operation_type:0,target:h},{asyncParams:eu.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn("clientsocketV1::connect failed with url: "+h,T.t0);case 28:g++,T.next=9;break;case 31:throw 0===this.retryCount?this.doDisconnect(zd.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(zd.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("clientSocketV1::socket xhr or socket connect failed");case 33:case"end":return T.stop()}}),_callee,this,[[12,20]])})))},t.doConnect=function doConnect(t){var a=this,u=!1;return new Ho((function(m,g){var h;a.socket=new Zd(a.core,t,a.linkSSL),a.socket.on("connect",(function(){a.logger.log("clientSocketV1::on connect",t),a.core.reporterHookLinkKeep&&(a.core.reporterHookLinkKeep.start(),a.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:t})),u=!0,m()})),a.socket.on("message",bind$1(h=a.onMessage).call(h,a)),a.socket.on("disconnect",(function(m){return __awaiter(a,void 0,void 0,Zl.mark((function _callee2(){return Zl.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(this.logger.log("clientSocketV1::socket on disconnect",m),!this.core.reporterHookLinkKeep){a.next=5;break}return a.next=4,this.core.reporterHookLinkKeep.update({code:(null==m?void 0:m.code)||0,description:(null==m?void 0:m.reason)||"socket on disconnect",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1);case 5:u=!0,this.doDisconnect(zd.OFFLINE,"SocketOnDisconnect");case 7:case"end":return a.stop()}}),_callee2,this)})))})),a.socket.on("handshakeFailed",(function(t){u?a.ping():(a.logger.error('clientsocketV1::handshake failed: "'+(t&&t.message)+'"'),a.cleanSocket()),u=!0,g(t)}))}))},t.cleanSocket=function cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.beforeConnect=function beforeConnect(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.resetConnectStatus=function resetConnectStatus(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},t.doDisconnect=function doDisconnect(t,a,u){var m,g,h,_,E;if(this.logger.log("doDisconnect:type:"+t+",description:"+a),"unconnected"!==this.core.status){var T={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new Vl({code:415,desc:"Packet timeout due to instance disconnect",detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:T}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket();var S=!this.core.options.needReconnect||this.retryCount>=this.core.options.reconnectionAttempts;if(t===zd.ACTIVE||S)this.logger.log("doDisconnect: emit disconnect, type "+t,S),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(m=this.auth)||void 0===m||m.emit("disconnect"),this.destroyOnlineListener();else if(t===zd.KICKED){this.logger.log("doDisconnect: kicked"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var M="string"==typeof a?{reason:"unknow",message:a}:a;this.core.eventBus.emit("kicked",M),this.core.emit("kicked",M),null===(g=this.auth)||void 0===g||g.emit("kicked",M),this.destroyOnlineListener()}else t===zd.OFFLINE&&this.core.V1NIMLoginService.isManualLoginAttempt?(this.logger.log("doDisconnect: offline in manual login phase. no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener()):t===zd.OFFLINE&&(null===(_=null===(h=this.auth)||void 0===h?void 0:h.authenticator)||void 0===_?void 0:_.checkLoginTerminalCode(null==u?void 0:u.code))?(this.logger.log("doDisconnect: login terminal code "+(null==u?void 0:u.code)+", no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener(),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(E=this.auth)||void 0===E||E.emit("disconnect")):t===zd.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect:already unconnected")},t.attempToReconnect=function attempToReconnect(){var t,a,u=this;if("waitReconnect"!==this.core.status){0===this.retryCount&&(this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(t=this.auth)||void 0===t||t.emit("disconnect"));var m=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+m),this.core.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:m}),this.core.emit("willReconnect",{retryCount:this.retryCount,duration:m}),null===(a=this.auth)||void 0===a||a.emit("willReconnect",{retryCount:this.retryCount,duration:m}),this.core.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=sa((function(){return __awaiter(u,void 0,void 0,Zl.mark((function _callee3(){var t=this;return Zl.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if("waitReconnect"===this.core.status){a.next=3;break}return this.logger.warn("doDisconnect: reconnectTimer status is "+this.core.status+", would not go on reconnecting"),a.abrupt("return");case 3:return a.next=5,eu.net.getNetworkStatus();case 5:!1===a.sent.net_connect?(this.logger.log("doDisconnect: skip this reconnection attempt because network is offline"),this.core.status="connecting",this.retryCount>=this.core.options.reconnectionAttempts?this.doDisconnect(zd.OFFLINE,"MaxReconnectionAttemptExceed"):this.attempToReconnect()):this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}));case 7:case"end":return a.stop()}}),_callee3,this)})))}),m)}else this.logger.warn("doDisconnect: already is waiting reconnect")},t.sendCmd=function sendCmd(t,a,u){var m=this;if("logined"!==this.core.status&&"login"!==t&&"chatroomLogin"!==t&&"qchatLogin"!==t)return this.logger.warn("instance status is "+this.core.status+", so can not sendCmd "+t),Ho.reject({cmd:t,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return Ho.reject("No_socket");var g="heartbeat"!==t,h=g?this.packetSer++:0,_=function createCmd(t,a,u,m){var g=xd[t];if(!g)return u.error("createCmd:: can not find cmd config: ",t),null;var h,_={SER:a,SID:g.sid,CID:g.cid,Q:[]};return g.params&&m&&forEach$1(h=g.params).call(h,(function(t){var a=m[t.name];if(null!=a){var u=t.type,g=t.reflectMapper,h=t.select;switch(t.type){case"PropertyArray":u="ArrayMable",a=map$6(a).call(a,(function(t){return{t:"Property",v:g?serialize(t,g,h):t}}));break;case"Property":a=g?serialize(a,g,h):a;break;case"Bool":a=a?"true":"false"}_.Q.push({t:u,v:a})}})),{packet:_,hasPacketResponse:"boolean"!=typeof g.hasPacketResponse||g.hasPacketResponse,hasPacketTimer:"boolean"!=typeof g.hasPacketTimer||g.hasPacketTimer}}(t,h,this.logger,a);if(!_){var E="SendCmd "+h+" "+t+" error";return this.logger.error(E),Ho.reject(new Error(E))}var T=_.packet,S=_.hasPacketResponse,M=_.hasPacketTimer,I=Pn(T);g&&(this.logger.getDebugMode()?this.logger.debug("clientsocketV1::sendCmd",t,"ser:"+h,I):this.logger.log("clientsocketV1::sendCmd",t,"ser:"+h));var A=(new Date).getTime();return new Ho((function(g,_){S&&m.sendingCmdMap.set(h,{cmd:t,params:a,callback:[g,_],timer:M?sa((function(){var a=new Vl({code:408,desc:"Packet Timeout",detail:{reason:"Packet Timeout",cmd:t,ser:h,timetag:Jo()}});m.markCmdInvalid(h,a,t)}),u&&u.timeout?u.timeout:m.core.config.timeout):null});try{m.socket.send(I),S||g(T)}catch(a){var E=new Vl({code:415,detail:{reason:a&&a.message||"Unable to send packet",cmd:t,ser:h,timetag:Jo(),rawError:a}});m.markCmdInvalid(h,E,t),_(a)}})).catch((function(t){var a,u=[408,415];if(!includes(u).call(u,t.code))return Ho.reject(t);m.reporter.reportTraceStart("exceptions",{user_id:m.core.options.account,trace_id:null===(a=m.socket)||void 0===a?void 0:a.sessionId,start_time:A,action:2,exception_service:6});var g=get(t,"data.disconnect_reason")||"",h=408===t.code?"Send failed due to timeout":"Send failed. Reason unknown";return h=415===t.code?Pn({disconnect_reason:g}):h,m.reporter.reportTraceUpdateV2("exceptions",{code:t.code||415,description:h,operation_type:1,target:T.SID+"-"+T.CID,context:""+T.SER},{asyncParams:eu.net.getNetworkStatus()}),m.reporter.reportTraceEnd("exceptions",1),Ho.reject(t)}))},t.onMessage=function onMessage(t){var a=function parseCmd(t,a){var u,m;try{m=JSON.parse(t)}catch(u){return void a.error('Parse command error:"'+t+'"')}var g=m.sid+"_"+m.cid,h=m.r;if(includes(u=["4_1","4_2","4_10","4_11"]).call(u,g)){var _=m.r[1].headerPacket;g=_.sid+"_"+_.cid,m.sid=_.sid,m.cid=_.cid,h=m.r[1].body}var E=Pd[g],T=[];if(E&&E.length>0){for(var S,M=_createForOfIteratorHelperLoose$4(E);!(S=M()).done;){var I=S.value;T.push(parseEachCmd(m,I.config,I.cmd,h,a))}return T}a.error("parseCmd:: mapper not exist",g,m.code)}(t,this.logger);if(a&&a.length>0){var u=a[0],m=u.raw.ser;u.error&&this.logger.error("core:onMessage packet error",u.raw.sid+"_"+u.raw.cid+", ser:"+m+",",u.error),"heartbeat"!==u.cmd&&(this.logger.getDebugMode()?this.logger.debug("imsocket::recvCmd ser:"+m,u.cmd,u.content):this.logger.log("imsocket::recvCmd ser:"+m,u.cmd));for(var g,h=_createForOfIteratorHelperLoose$3(a);!(g=h()).done;){var _=g.value;this.packetHandler(_)}}},t.packetHandler=function packetHandler(t){var a,u,m,g,h=this;if(t){var _=t.raw.ser,E=this.sendingCmdMap.get(_);if(E&&E.cmd===t.cmd){var T=E.callback,S=E.timer,M=E.params;if(clearTimeout(S),t.params=M,this.sendingCmdMap.delete(_),"heartbeat"===t.cmd)return void T[0]();var I=null===(u=null===(a=this.core[t.service])||void 0===a?void 0:a.process)||void 0===u?void 0:u.call(a,t);I&&"function"==typeof I.then?I.then((function(t){T[0](t)})).catch((function(t){T[1](t)})):(this.logger.log("imsocket:: handlerFn without promise",t.service,t.cmd),T[0]())}else{var A=null===(g=null===(m=this.core[t.service])||void 0===m?void 0:m.process)||void 0===g?void 0:g.call(m,t);A&&"function"==typeof A.then&&A.catch((function(t){h.logger.error("imsocket::no obj cache, no process handler",t)}))}}},t.markCmdInvalid=function markCmdInvalid(t,a,u){var m=this.sendingCmdMap.get(t);if(m){var g=m.callback,h=m.timer;h&&clearTimeout(h),this.sendingCmdMap.delete(t),this.logger.warn("packet "+t+", "+u+" is invalid:",a),g[1](a)}},t.markAllCmdInvaild=function markAllCmdInvaild(t){var a,u=this;this.logger.log("markAllCmdInvaild",t),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var m=a.callback,g=a.timer,h=a.cmd;u.logger.log('markAllCmdInvaild:: cmd "'+h+'"'),g&&clearTimeout(g),m[1](t)})),this.sendingCmdMap.clear()},t.ping=function ping(){var t;return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){var a=this;return Zl.wrap((function _callee4$(u){for(;;)switch(u.prev=u.next){case 0:return clearTimeout(this.pingTimer),u.prev=1,u.next=4,this.sendCmd("heartbeat");case 4:u.next=18;break;case 6:return u.prev=6,u.t0=u.catch(1),u.next=10,this.testHeartBeat5Timeout();case 10:if(!u.sent){u.next=18;break}if(!this.core.reporterHookLinkKeep){u.next=16;break}return u.next=15,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(t=this.socket)||void 0===t?void 0:t.url});case 15:this.core.reporterHookLinkKeep.end(!0);case 16:return this.doDisconnect(zd.OFFLINE,"PingError"),u.abrupt("return");case 18:this.pingTimer=sa((function(){a.ping()}),3e4);case 19:case"end":return u.stop()}}),_callee4,this,[[1,6]])})))},t.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){var t;return Zl.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.log("clientsocketV1:: test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee5,this,[[3,9]])})))},t.initOnlineListener=function initOnlineListener(){var t=this;this.hasNetworkListener||(this.logger.log("clientsocketV1::onlineListener:init"),this.hasNetworkListener=!0,eu.net.onNetworkStatusChange((function(a){t.logger.log("clientsocketV1::onlineListener:network change",a),a.isConnected&&"logined"===t.core.status?t.ping():a.isConnected&&"waitReconnect"===t.core.status?(t.reconnectTimer&&clearTimeout(t.reconnectTimer),t.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}))):a.isConnected||t.doDisconnect(zd.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function destroyOnlineListener(){this.logger.log("clientsocketV1::onlineListener:destroy"),eu.net.offNetworkStatusChange(),this.hasNetworkListener=!1},t.disconnect=function disconnect(){switch(this.core.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(zd.ACTIVE,"UserActiveDisconnect"),Ho.resolve();default:return Ho.resolve()}},V1ClientSocket}(),tp=function(){function V1NIMLoginLbs(t){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=t,this.auth=t.V1NIMLoginService,this.logger=this.core.logger}var t=V1NIMLoginLbs.prototype;return t.getLbsInfos=function getLbsInfos(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var t,a,u,m;return Zl.wrap((function _callee$(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.socketLinkUrls.length>0)){g.next=5;break}return t=this.socketLinkUrls,this.socketLinkUrls=[],this.core.logger.log("V1NIMLoginService::getLbsInfos:use cache link",t),g.abrupt("return",Ho.resolve(t));case 5:return this.core.reporterHookLBS.start(this.core.account),a=uniq(this.auth.config.lbsUrls),g.prev=7,g.next=10,this.ladderLoad(a);case 10:if(200===(u=g.sent).status&&u.data){g.next=14;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",u.status,u),new Vl({code:Ll.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V1NIMLoginService::getLbsInfos failed, status "+u.status}});case 14:this.success(u),g.next=25;break;case 17:if(g.prev=17,g.t0=g.catch(7),m=g.t0,this.core.logger.error("V1NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",g.t0),this.reportForFail(a[0],m.code,m.message),!this.checkTerminator(m.code)){g.next=24;break}throw g.t0;case 24:this.socketLinkUrls=[this.auth.config.linkUrl];case 25:return g.abrupt("return",this.socketLinkUrls);case 26:case"end":return g.stop()}}),_callee,this,[[7,17]])})))},t.checkTerminator=function checkTerminator(t){return t===Ll.V2NIM_ERROR_CODE_CANCELLED||t===Ll.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function generateUrl(t){return(t=this.processLbsUrl(t))+(indexOf(t).call(t,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.processLbsUrl=function processLbsUrl(t){return pendingIsMiniappEnv()?t.replace("/webconf","/wxwebconf"):t},t.requstLbs=function requstLbs(t){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(t),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function setLadderTimer(t,a,u,m){var g=this;this.timer&&clearTimeout(this.timer);var h=t[a];this.timer=sa((function(){h&&(g.setLadderTimer(t,a+1,u,m),g.core.logger.log("V1NIMLoginService::getLbsInfos "+a+":",g.processLbsUrl(h)),g.reportForLbsStart(h,a),g.requstLbs(h).then((function(t){g.reset(),u(Lt(Lt({},t),{url:h}))})).catch((function(u){var _;if(g.core.logger.warn("V1NIMLoginService::getLbsInfos "+a+" failed:",u),g.failedCount+=1,g.reportForFailOnce(h,u.code,(null===(_=u.detail)||void 0===_?void 0:_.reason)||u.message),g.failedCount>=t.length||g.checkTerminator(u.code))return g.reset(),void m(u)})))}),2e3)},t.ladderLoad=function ladderLoad(t){var a=this;return new Ho((function(u,m){t.length>1&&a.setLadderTimer(t,1,u,m);var g=t[0];a.core.logger.log("V1NIMLoginService::getLbsInfos 0:",g),a.reportForLbsStart(g,0),a.requstLbs(g).then((function(t){a.reset(),u(Lt(Lt({},t),{url:g}))})).catch((function(u){var h;a.failedCount+=1,a.core.logger.warn("V1NIMLoginService::getLbsInfos 0 failed:",u),a.reportForFailOnce(g,u.code,(null===(h=u.detail)||void 0===h?void 0:h.reason)||u.message),(a.failedCount>=t.length||a.checkTerminator(u.code))&&(a.reset(),m(u))}))}))},t.success=function success(t){var a,u,m,g,h=t.data,_=[this.auth.config.linkUrl];get(h,"common.link")&&(_=concat(g=get(h,"common.link")).call(g,_));get(h,'common["link.default"]')&&(_=concat(_).call(_,get(h,'common["link.default"]'))),this.socketLinkUrls=_,h["nos-chunk"]&&(this.logger.log("getLbsInfos success. lbs.nos-chunk",h["nos-chunk"]),null===(u=this.core.cloudStorage)||void 0===u||u.setOptions({chunkUploadHost:h["nos-chunk"]})),Ln(h.nosup)&&h.nosup.length>0&&(this.logger.log("getLbsInfos success. lbs.nosup",h.nosup),null===(m=this.core.cloudStorage)||void 0===m||m.setOptions({commonUploadHostBackupList:h.nosup,commonUploadHost:h.nosup[0]})),this.core.logger.log("V1NIMLoginService::getLbsInfos success, socket link:",slice(a=this.socketLinkUrls).call(a,0),"chunkUploadHost: ",t.data["nos-chunk"]),this.reportForLbsSuccess(t.url,t.data)},t.reportForLbsStart=function reportForLbsStart(t,a){this.core.reporterHookLBS.updateBegin({target:t,index:a})},t.reportForLbsSuccess=function reportForLbsSuccess(t,a){this.core.reporterHookLBS.updateComplete({target:t,code:200,body:Pn(a)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,code:200,succeed:!0},{asyncParams:eu.net.getNetworkStatus()})},t.reportForFailOnce=function reportForFailOnce(t,a,u){this.core.reporterHookLBS.updateComplete({target:t,code:a,body:u})},t.reportForFail=function reportForFail(t,a,u){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,description:u,code:a,succeed:!1},{asyncParams:eu.net.getNetworkStatus()})},t.reset=function reset(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},V1NIMLoginLbs}(),rp=function(){function V1NIMLoginAuthenticator(t){this.core=t}var t=V1NIMLoginAuthenticator.prototype;return t.verifyAuthentication=function verifyAuthentication(t){var a,u,m;return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,Zl.mark((function _callee(){var g,h,_,E,T,S,M,I,A,b,N,C;return Zl.wrap((function _callee$(R){for(;;)switch(R.prev=R.next){case 0:return h=this.core.options,_=eu.getSystemInfo(),E=Lt(Lt({},h),{appLogin:t?0:1,appkey:h.appkey,account:h.account,token:h.token,deviceId:this.core.auth.deviceId,clientSession:this.core.auth.clientSession,clientType:16,protocolVersion:1,sdkVersion:100941,sdkHumanVersion:"10.9.41",os:_.os,browser:_.browser,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.9.41":slice(g=_.userAgent.replace("{{appkey}}",h.appkey)).call(g,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:_.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:_.hostEnvEnum}),T=_.os.toLowerCase(),"UNIAPP"!==eu.platform||"ios"!==T&&"android"!==T||(E.isReactNative=1,E.clientType="ios"===T?2:1,S=!!(null===(a=this.core.offlinePush.authConfig)||void 0===a?void 0:a.honorCertificateName),_.pushDeviceInfo&&_.pushDeviceInfo.MANUFACTURER&&(E.deviceInfo=Pn(Lt({IS_SUPPORT_HONOR:S},_.pushDeviceInfo)))),this.core.logger.log("clientSocketV1::do login,accid:"+h.account+";clientSession:"+(null===(m=null===(u=this.core.clientSocket)||void 0===u?void 0:u.socket)||void 0===m?void 0:m.sessionId)),R.next=8,this.core.clientSocket.sendCmd("login",{login:E});case 8:if(!(M=R.sent).error){R.next=11;break}throw M.error;case 11:return I=M.content,A=I.loginRes,b=I.loginPorts,N=I.aosPushInfo,C=formatMultiPortLoginInfo(b,2),(C=filter(C).call(C,(function(t){return t.connectionId!==A.connectionId}))).length>0&&this.core.emit("multiPortLogin",C),R.abrupt("return",Lt(Lt({},A),{aosPushInfo:N}));case 16:case"end":return R.stop()}}),_callee,this)})))},t.checkLoginTerminalCode=function checkLoginTerminalCode(t){if(void 0===t)return!1;var a=[201,302,317,403,404,417,422];return includes(a).call(a,t)},V1NIMLoginAuthenticator}(),np=function(t){function V2Service(a,u){var m;return(m=t.call(this)||this).name=a,m.logger=u.logger,m.core=u,m}Ct(V2Service,t);var a=V2Service.prototype;return a.checkV2=function checkV2(){var t=this.core.options.apiVersion;if("v2"===t)return!0;throw new Vl({code:Ll.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'The version "'+t+'" of client is not supported.'}})},a.checkLogin=function checkLogin(){if(0===this.core.V2NIMLoginService.getLoginStatus())throw new Vl({code:Ll.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Client logout."}})},a.emit=function emit(a){for(var u=this,m=arguments.length,g=new Array(m>1?m-1:0),h=1;h<m;h++)g[h-1]=arguments[h];this.logger.debug(this.name+"::emit event: '"+a.toString()+"',",void 0!==g[0]?g[0]:"",void 0!==g[1]?g[1]:"",void 0!==g[2]?g[2]:"");try{var _,E,T=(_=t.prototype.emit).call.apply(_,concat(E=[this,a]).call(E,g));return T}catch(t){return sa((function(){throw u.logger.error(u.name+"::emit throw error in setTimeout. event: "+a.toString()+". Error",t),t}),0),!1}},a.process=function process(t){var a=this[t.cmd+"Handler"],u=this.handler&&this.handler[t.cmd+"Handler"];if("function"==typeof a||"function"==typeof u){if(t.error)return this.logger.error(t.cmd+"::recvError",t.error),Ho.reject(t.error);try{var m=a?a.call(this,t):u.call(this.handler,t);return Ho.resolve(m)}catch(t){return Ho.reject(t)}}var g=get(t,"error.detail.ignore");return t.error&&!g?Ho.reject(t.error):Ho.resolve(t)},V2Service}(ca),ip=function(){function Service(t,a){this.name=t,this.core=a,this.name=t,this.logger=a.logger,this.core=a}return Service.prototype.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a)return a.call(this,t);var u=get(t,"error.detail.ignore");return t.error&&!u?Ho.reject(t.error):Ho.resolve(t)},Service}(),op={"6_3":"notifylog","6_4":"uploadLog","6_23":"getServerTime","6_31":"notifyDetect","6_32":"uploadDetect","6_37":"wsDetect"},ap={type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},sp={k1:1,k2:2,k3:3,k4:4,k5:5,k6:6,k7:7,k8:8,k9:9,k10:10},cp={notifylog:{sid:6,cid:3,service:"misc"},uploadLog:{sid:6,cid:4,service:"misc",hasPacketResponse:!1,params:[{type:"String",name:"url"},{type:"Property",name:"data",reflectMapper:{type:1,content:2}}]},getServerTime:{sid:6,cid:23,service:"misc",response:[{type:"Long",name:"time"}]},notifyDetect:{sid:6,cid:31,service:"misc",response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(ap)}]},uploadDetect:{sid:6,cid:32,service:"misc",hasPacketResponse:!1,params:[{type:"Property",name:"data",reflectMapper:ap}]},wsDetect:{sid:6,cid:37,service:"misc",params:[{type:"Property",name:"tag",reflectMapper:sp}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(sp)}]}},lp={type:{type:"number"},t1:{type:"number"},t2:{type:"number"},t3:{type:"number"},t4:{type:"number"},t5:{type:"number"},t6:{type:"number"}};var up=function(t){function MiscService(a){var u;return(u=t.call(this,"misc",a)||this).logLock=!1,u.core=a,registerParser({cmdMap:op,cmdConfig:cp}),u.setListener(),u}Ct(MiscService,t);var a=MiscService.prototype;return a.setListener=function setListener(){var t,a=this;this.core.eventBus.on("BinaryClientSocket/unpackError",bind$1(t=this.wsDetect).call(t,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){a.core.timeOrigin.setOriginTimetick()})),this.core.eventBus.on("logined",(function(){a.core.timeOrigin.setOriginTimetick()}))},a.getServerTime=function getServerTime(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var t;return Zl.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.clientSocket.sendCmd("getServerTime");case 2:return t=a.sent,a.abrupt("return",Cu(t.content.time));case 4:case"end":return a.stop()}}),_callee,this)})))},a.wsDetect=function wsDetect(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a,u,m,g;return Zl.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return a=Lt({k1:"val1",k2:"val2"},t),u=null,h.prev=2,h.next=5,this.core.clientSocket.sendCmd("wsDetect",{tag:a});case 5:m=h.sent,u=m.content.data,h.next=14;break;case 9:return h.prev=9,h.t0=h.catch(2),(g=h.t0).code===Ll.V2NIM_ERROR_CODE_UNPACK_ERROR?(this.logger.warn("misc::wsDetect:998"),this.wsDetectUnreliable(),this.reportBinarySocketDetectResult("packet 998")):this.logger.warn("misc::wsDetect:failed "+g.code),h.abrupt("return");case 14:u&&Pn(u)!==Pn(a)?(this.logger.warn("misc::wsDetect:content unreliable"),this.wsDetectUnreliable(),this.reportBinarySocketDetectResult("content unreliable")):this.logger.log("misc::wsDetect:success");case 15:case"end":return h.stop()}}),_callee2,this,[[2,9]])})))},a.wsDetectUnreliable=function wsDetectUnreliable(){this.core.clientSocket.doDisconnect(3,"WSDetectUnreliable")},a.reportBinarySocketDetectResult=function reportBinarySocketDetectResult(t){var a;this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.account,trace_id:null===(a=this.core.clientSocket.socket)||void 0===a?void 0:a.sessionId,start_time:Jo(),action:2,exception_service:9}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:998,description:"wsDetect::reconnect cause: "+t,operation_type:"5",target:"6-37"}),this.core.reporter.reportTraceEnd("exceptions",1)},a.notifyDetectHandler=function notifyDetectHandler(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var a;return Zl.wrap((function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:return m=t.content.data,(a=format(lp,m)).t3=t.__receiveTimeNode.time,a.t4=Jo(),u.prev=3,u.next=6,this.core.clientSocket.sendCmd("uploadDetect",{data:a});case 6:u.next=11;break;case 8:u.prev=8,u.t0=u.catch(3),this.core.logger.warn("misc::notifyDetectHandler:upload failed",u.t0);case 11:case"end":return u.stop()}var m}),_callee3,this,[[3,8]])})))},a.notifylogHandler=function notifylogHandler(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){var t,a,u;return Zl.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:if(t=void 0,!this.logLock){m.next=4;break}return this.core.logger.warn("misc::notifylogHandler:locked"),m.abrupt("return");case 4:return this.logLock=!0,m.prev=5,m.next=8,this.core.logger.extractLogs();case 8:t=m.sent,m.next=15;break;case 11:return m.prev=11,m.t0=m.catch(5),this.logLock=!1,m.abrupt("return");case 15:if(t){m.next=18;break}return this.logLock=!1,m.abrupt("return");case 18:return a="",m.prev=19,m.next=22,this.core.cloudStorage.uploadFile("string"==typeof t?{type:"file",filePath:t}:{type:"file",file:t});case 22:u=m.sent,a=u.url,m.next=30;break;case 26:return m.prev=26,m.t1=m.catch(19),this.logLock=!1,m.abrupt("return");case 30:if(a){m.next=33;break}return this.logLock=!1,m.abrupt("return");case 33:return a+=(indexOf(a).call(a,"?")>0?"&":"?")+"download="+(new Date).getTime()+"_web.log",m.prev=34,m.next=37,this.core.clientSocket.sendCmd("uploadLog",{url:a});case 37:m.next=43;break;case 39:return m.prev=39,m.t2=m.catch(34),this.logLock=!1,m.abrupt("return");case 43:return m.prev=43,m.next=46,this.logger.afterUpload();case 46:m.next=50;break;case 48:m.prev=48,m.t3=m.catch(43);case 50:this.logLock=!1;case 51:case"end":return m.stop()}}),_callee4,this,[[5,11],[19,26],[34,39],[43,48]])})))},MiscService}(ip),dp={needReconnect:!0,reconnectionAttempts:Rt,lbsUrls:xu,linkUrl:ku,xhrConnectTimeout:8e3,socketConnectTimeout:8e3,linkSSL:!0},pp=function(t){function V1NIMLoginServiceImpl(a,u){var m;(m=t.call(this,"V1NIMLoginService",a)||this).account="",m.token="",m.deviceId="",m.processId="",m.clientSession="",m.status="unconnected",m.config=dp,m.isManualLoginAttempt=!1,m.core._registerDep(up,"misc"),registerParser({cmdMap:Bd,cmdConfig:jd}),a.V1NIMLoginService=$e(m),u&&m.setOptions(u);var g=new ep(m.core,$e(m));return m.clientSocket=g,"v1"===m.core.options.apiVersion&&(m.core.clientSocket=g,m.core.auth=$e(m)),m.lbs=new tp(a),m.authenticator=new rp(a),m.doLoginStepsManager=new Vu,m}Ct(V1NIMLoginServiceImpl,t);var a=V1NIMLoginServiceImpl.prototype;return a.reset=function reset(){this.lbs.reset()},a.setOptions=function setOptions(t){var a,u,m;t&&Bt(t).length>0?(this.config=assignOptions(this.config,t),this.account=t.account||this.core.options.account,this.token=t.token||this.core.options.token,this.core.options=Lt(Lt({},this.core.options),this.config)):(this.config=assignOptions(this.core.options,this.config),this.account=this.core.options.account,this.token=this.core.options.token),null===(u=null===(a=this.core.clientSocket)||void 0===a?void 0:a.setLinkSSL)||void 0===u||u.call(a,null===(m=this.config.linkSSL)||void 0===m||m);var g="",h="";this.config.isFixedDeviceId?(g=eu.localStorage.getItem("__NIM_DEVC_ID__")||Ou(),h=eu.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||Ou(),eu.localStorage.setItem("__NIM_DEVC_ID__",g),eu.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",h)):(g=Ou(),h=Ou()),this.deviceId=g,this.clientSession=h,this.core.reporter.setConfig({common:{dev_id:g}})},a.connect=function connect(t){return void 0===t&&(t={}),this.login(t)},a.login=function login(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,Zl.mark((function _callee(){return Zl.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkApiVersion(),t.isAutoReconnect||(this.isManualLoginAttempt=!0,this.processId=Ou()),a.next=4,this._connect(t);case 4:return this.core.abtest.abtRequest(),a.prev=5,a.next=8,this.doLogin(t.isAutoReconnect);case 8:this.processId=Ou(),this.isManualLoginAttempt=!1,a.next=16;break;case 12:throw a.prev=12,a.t0=a.catch(5),this.isManualLoginAttempt=!1,a.t0;case 16:case"end":return a.stop()}}),_callee,this,[[5,12]])})))},a._connect=function _connect(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a,u,m,g=this;return Zl.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.core.status)){h.next=4;break}return a="NIM status is "+this.core.status+", and would not connect",this.logger.warn(a),h.abrupt("return",Ho.reject(a));case 4:return this.clientSocket.beforeConnect(),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",{user_id:this.core.options.account,action:t.isAutoReconnect?"auto_login":"manual_login",binary_websocket:!1,process_id:this.processId}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:Pn(Lt(Lt({},this.core.options),{account:"***",token:"***"})),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:eu.net.getNetworkStatus()}),h.next=10,this.lbs.getLbsInfos();case 10:return u=h.sent,h.prev=11,h.next=14,this.clientSocket.connect({linkUrls:u,isAutoReconnect:t.isAutoReconnect},(function(t,a){g.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:a,code:t.code||408,description:"ws_handshake_failed:"+t.message,succeed:!1},{asyncParams:eu.net.getNetworkStatus()})}));case 14:(m=h.sent)&&this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:m,code:200,succeed:!0},{asyncParams:eu.net.getNetworkStatus()}),h.next=22;break;case 18:throw h.prev=18,h.t0=h.catch(11),this.core.reporter.reportTraceEnd("login",!1),h.t0;case 22:case"end":return h.stop()}}),_callee2,this,[[11,18]])})))},a.doLogin=function doLogin(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var a,u,m,g,h;return Zl.wrap((function _callee3$(_){for(;;)switch(_.prev=_.next){case 0:return _.prev=0,_.next=3,this.authenticator.verifyAuthentication(t);case 3:a=_.sent,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:200,succeed:!0},{asyncParams:eu.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!0),this.core.status="logined",_.next=21;break;case 9:if(_.prev=9,_.t0=_.catch(0),u=_.t0,m=get(u,"data.disconnect_reason")||"",g=415===u.code?Pn({disconnect_reason:m}):u.message,this.core.logger.warn("nim login:: login failed",_.t0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:u.code||0,succeed:!1,description:g},{asyncParams:eu.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!1),this.clientSocket.doDisconnect(zd.OFFLINE,this.isManualLoginAttempt?"FailedToInitializeLogin":"ReconnectLoginFailed",_.t0),!this.isManualLoginAttempt){_.next=20;break}throw _.t0;case 20:return _.abrupt("return");case 21:return _.prev=21,h=a.loginTime?Cu(a.loginTime):Jo(),_.next=25,this.core.cloudStorage.init(h);case 25:_.next=30;break;case 27:_.prev=27,_.t1=_.catch(21),this.core.logger.error("NIM:login cloudStorage init failed ",_.t1);case 30:this.core.eventBus.emit("logined",a),this.core.emit("logined",a),this.emit("logined",a),this.core.logger.log("login done"),this.clientSocket.resetConnectStatus(),this.clientSocket.ping();case 36:case"end":return _.stop()}}),_callee3,this,[[0,9],[21,27]])})))},a.disconnect=function disconnect(){return this.logout()},a.logout=function logout(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){return Zl.wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),t.t0=this.status,t.next="logined"===t.t0?5:"connected"===t.t0||"connecting"===t.t0||"waitReconnect"===t.t0?18:"unconnected"===t.t0||"destroyed"===t.t0?21:22;break;case 5:return t.prev=5,t.next=8,this.clientSocket.sendCmd("logout",void 0,{timeout:1e3});case 8:this.clientSocket.doDisconnect(zd.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),t.next=17;break;case 12:t.prev=12,t.t1=t.catch(5),this.logger.error("Instance::disconnect sendCmd:logout error",t.t1),this.clientSocket.doDisconnect(zd.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData();case 17:return t.abrupt("break",22);case 18:return this.clientSocket.doDisconnect(zd.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),t.abrupt("return",Ho.resolve());case 21:return t.abrupt("return",Ho.resolve());case 22:case"end":return t.stop()}}),_callee4,this,[[5,12]])})))},a.kick=function kick(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){var u;return Zl.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return this._checkApiVersion(),m.next=3,this.clientSocket.sendCmd("kick",t);case 3:return u=m.sent,m.abrupt("return",null===(a=u.content)||void 0===a?void 0:a.deviceIds);case 5:case"end":return m.stop()}}),_callee5,this)})))},a._checkApiVersion=function _checkApiVersion(){if("v1"!==this.core.options.apiVersion)throw new Vl({code:Ll.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v1"'}})},a.nimLoginClientChangeHandler=function nimLoginClientChangeHandler(t){if(t.error)this.logger.error("nimLoginClientChangeHandler:: error, ",t.error);else{var a=t.content,u=formatMultiPortLoginInfo(a.datas,a.state);u.length>0&&(this.core.emit("multiPortLogin",u),this.emit("multiPortLogin",u))}},a.kickedHandler=function kickedHandler(t){if(t.error)this.logger.error("kickedHandler:: error, ",t.error);else{var a=function formatBeKickedTag(t){var a=format({clientType:{type:"enum",values:Vd},customClientType:{type:"number"}},t),u=Wd[a.reason];return Lt(a,u=u||{reason:"unknow",message:"Unknown reason"})}(t.content);this.logger.warn("kicked::",a),this.clientSocket.doDisconnect(zd.KICKED,a),this.core._clearModuleData()}},a.getConnectStatus=function getConnectStatus(){switch(this.core.status){case"unconnected":case"destroyed":default:return 0;case"connecting":return 2;case"connected":case"logined":return 1;case"waitReconnect":return 3}},a.getLoginStatus=function getLoginStatus(){switch(this.core.status){case"unconnected":case"destroyed":case"waitReconnect":default:return 0;case"connecting":case"connected":return 2;case"logined":return 1}},a.getLoginUser=function getLoginUser(){return this.core.options.account},a.emit=function emit(a){for(var u,m,g,h,_=this.name+"::emit "+a.toString(),E=arguments.length,T=new Array(E>1?E-1:0),S=1;S<E;S++)T[S-1]=arguments[S];return(u=this.logger).log.apply(u,concat(m=[""+_]).call(m,T)),(g=t.prototype.emit).call.apply(g,concat(h=[this,a]).call(h,T))},V1NIMLoginServiceImpl}(np);_export({target:"Number",stat:!0},{isNaN:function isNaN(t){return t!=t}});var mp=H.Number.isNaN;function invert(t){t=t||{};var a={};for(var u in t)a[t[u]]=u;return a}var gp,fp=invert({none:0,normal:1,all:3}),hp={normal:0,advanced:1},_p=invert(hp),vp=invert({normal:0,owner:1,manager:2}),yp={noVerify:0,needVerify:1,rejectAll:2},Ep=invert(yp),Tp={needVerify:0,noVerify:1},Sp=invert(Tp),Mp={manager:0,all:1},Ip=invert(Mp),Ap={manager:0,all:1},bp=invert(Ap),Np={manager:0,all:1},Cp=invert(Np);function formatTeam(t){var a,u=["teamId"],m=["level","memberNum","memberUpdateTime","createTime","updateTime"],g=["valid","validToCurrentUser","mute"],h={type:_p,muteType:fp,joinMode:Ep,beInviteMode:Sp,inviteMode:Ip,updateTeamMode:bp,updateExtMode:Cp};t.bits;var _=__rest(t,["bits"]);return forEach$1(u).call(u,(function(t){_[t]&&(_[t]=_[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==_[t]&&(_[t]=Cu(_[t]))})),forEach$1(g).call(g,(function(t){void 0!==_[t]&&(_[t]=1===Cu(_[t]))})),forEach$1(a=Bt(h)).call(a,(function(t){void 0!==_[t]&&(_[t]=h[t][_[t]]||_[t])})),_}function formatTeams(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatTeam(t)})):[]}function generateTeam(t){var a,u=Lt({},t),m=["avatar","name","intro","announcement","ext"],g={type:hp,joinMode:yp,beInviteMode:Tp,inviteMode:Mp,updateTeamMode:Ap,updateExtMode:Np};return forEach$1(m).call(m,(function(t){void 0!==u[t]&&(u[t]=u[t].toString())})),forEach$1(a=Bt(g)).call(a,(function(t){void 0!==u[t]&&(u[t]=g[t][u[t]])})),u}function generatorTeamMemberForCmd(t){var a=["teamId","ext","account","nickInTeam"],u={};return void 0!==t.bitConfigMask&&(u.bits=Cu(t.bitConfigMask)),forEach$1(a).call(a,(function(a){t[a]&&(u[a]=t[a].toString())})),Object.prototype.hasOwnProperty.call(t,"nickInTeam")&&(u.nickInTeam=t.nickInTeam),u}function formatTeamMember(t){var a,u=["teamId"],m=["joinTime","updateTime","bitConfigMask"],g=["active","valid","mute"],h={type:vp},_=t.bits,E=__rest(t,["bits"]);return void 0!==_&&(E.muteTeam=1===Cu(_),E.bitConfigMask=_),E.id=E.teamId+"-"+E.account,forEach$1(u).call(u,(function(t){E[t]&&(E[t]=E[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==E[t]&&(E[t]=Cu(E[t]))})),forEach$1(g).call(g,(function(t){void 0!==E[t]&&(E[t]=1===Cu(E[t]))})),forEach$1(a=Bt(h)).call(a,(function(t){void 0!==E[t]&&(E[t]=h[t][E[t]]||E[t])})),E}function formatTeamMembers(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatTeamMember(t)})):[]}function generatorMemberByTeam(t,a,u){return void 0===u&&(u="normal"),{id:t.teamId+"-"+a,teamId:t.teamId,account:a,type:u,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:t.memberUpdateTime,updateTime:t.memberUpdateTime,active:!0,valid:!0}}function generatorMembersByTeam(t,a,u){return void 0===u&&(u="normal"),a&&a.length>0?map$6(a).call(a,(function(a){return generatorMemberByTeam(t,a,u)})):[]}function formatUser(t){var a=Lt({},t);return a.createTime&&(a.createTime=+a.createTime),a.updateTime&&(a.updateTime=+a.updateTime),a.gender&&(a.gender=gp[+a.gender]),a}!function(t){t[t.unknown=0]="unknown",t[t.male=1]="male",t[t.female=2]="female"}(gp||(gp={}));var Rp={"8_1":"createTeam","8_5":"addTeamMembers","8_6":"removeTeamMembers","8_7":"updateTeamInfo","8_8":"leaveTeam","8_9":"getTeamInfo","8_10":"getTeams","8_11":"getTeamMembers","8_12":"dismissTeam","8_13":"applyTeam","8_14":"passTeamApply","8_15":"rejectTeamApply","8_16":"addTeamManagers","8_17":"removeTeamManagers","8_18":"transferTeam","8_19":"updateMyMemberInfo","8_20":"updateNickInTeam","8_21":"acceptTeamInvite","8_22":"rejectTeamInvite","8_25":"muteTeamMember","8_27":"getMutedTeamMembers","8_28":"sendTeamMsgReceipt","8_29":"getTeamMsgReads","8_30":"getTeamMsgReadAccounts","8_31":"notifyTeamMsgReceipts","8_32":"muteTeam","8_33":"getTeamMemberInvitorAccid","8_34":"getTeamsById","8_101":"syncCreateTeam","8_109":"syncTeams","8_119":"syncUpdateTeamMember","8_126":"syncMyTeamMembers"},Op={team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},teamMsgReceiptTag:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,ext:12,mute:13,invitorAccid:14}},wp=invertSerializeMap(Op),kp={getTeamInfo:{sid:8,cid:9,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:wp.team}]},getTeams:{sid:8,cid:10,service:"team",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:wp.team},{type:"Long",name:"timetag"}],ignoreErrCodes:[803]},createTeam:{sid:8,cid:1,service:"team",params:[{type:"Property",name:"team",reflectMapper:Op.team},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:wp.team},{type:"StrArray",name:"abortedAccidList"}]},sendTeamMsgReceipt:{sid:8,cid:28,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Op.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:wp.teamMsgReceiptTag}]},getTeamMsgReads:{sid:8,cid:29,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Op.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:wp.teamMsgReceiptTag}]},getTeamMsgReadAccounts:{sid:8,cid:30,service:"team",params:[{type:"Property",name:"teamMsgReceiptTag",reflectMapper:Op.teamMsgReceiptTag}],response:[{type:"Property",name:"teamMsgReceipt",reflectMapper:wp.teamMsgReceiptTag},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},notifyTeamMsgReceipts:{sid:8,cid:31,service:"team",response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:wp.teamMsgReceiptTag}]},dismissTeam:{sid:8,cid:12,service:"team",params:[{type:"Long",name:"teamId"}]},leaveTeam:{sid:8,cid:8,service:"team",params:[{type:"Long",name:"teamId"}]},transferTeam:{sid:8,cid:18,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},updateTeamInfo:{sid:8,cid:7,service:"team",params:[{type:"Property",name:"team",reflectMapper:Op.team}],response:[{type:"Long",name:"id"},{type:"Long",name:"time"}]},getTeamsById:{sid:8,cid:34,service:"team",params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:wp.team},{type:"LongArray",name:"tids"}],ignoreErrCodes:[816]},getTeamMembers:{sid:8,cid:11,service:"team",params:[{type:"Long",name:"teamId"},{type:"Long",name:"timetag"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:wp.teamMember},{type:"Long",name:"timetag"}]},getMutedTeamMembers:{sid:8,cid:27,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:wp.teamMember}]},addTeamMembers:{sid:8,cid:5,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},removeTeamMembers:{sid:8,cid:6,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applyTeam:{sid:8,cid:13,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:wp.team}]},addTeamManagers:{sid:8,cid:16,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:8,cid:17,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateMyMemberInfo:{sid:8,cid:19,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:Op.teamMember}]},updateNickInTeam:{sid:8,cid:20,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:Op.teamMember}]},muteTeamMember:{sid:8,cid:25,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:8,cid:33,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},muteTeam:{sid:8,cid:32,service:"team",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},passTeamApply:{sid:8,cid:14,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:8,cid:15,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptTeamInvite:{sid:8,cid:21,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:8,cid:22,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncTeams:{sid:8,cid:109,service:"team",response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"teams",reflectMapper:wp.team}]},syncCreateTeam:{sid:8,cid:101,service:"team",response:[{type:"Property",name:"team",reflectMapper:wp.team}]},syncUpdateTeamMember:{sid:8,cid:119,service:"team",response:[{type:"Property",name:"teamMember",reflectMapper:wp.teamMember}]},syncMyTeamMembers:{sid:8,cid:126,ext:"sync",service:"team",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember",reflectMapper:wp.teamMember},{type:"Long",name:"timetag"}]}},xp={"3_7":"getUsersNameCardFromServer","3_10":"updateMyNameCard","3_109":"syncMyNameCard","3_110":"onUpdateMyNameCard","3_3":"setBlack","3_103":"onUpdateBlackList","3_5":"setMute","3_105":"onUpdateMuteList","3_8":"syncRelations"},Pp={user:{account:1,nick:3,avatar:4,signature:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13},relationMember:{account:0,isMuted:1,isBlack:2,createTime:3,updateTime:4}},Lp=invertSerializeMap(Pp),Dp={syncMyNameCard:{sid:3,cid:109,service:"user",response:[{type:"Property",name:"user",reflectMapper:Lp.user},{type:"Long",name:"timetag"}]},setBlack:{service:"user",sid:3,cid:3,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateBlackList:{service:"user",sid:3,cid:103,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},setMute:{service:"user",sid:3,cid:5,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateMuteList:{service:"user",sid:3,cid:105,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},syncRelations:{service:"user",sid:3,cid:8,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"list",reflectMapper:Lp.relationMember},{type:"Long",name:"timetag"}]},getUsersNameCardFromServer:{service:"user",sid:3,cid:7,params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"users",reflectMapper:Lp.user}]},updateMyNameCard:{service:"user",sid:3,cid:10,params:[{type:"Property",name:"user",reflectMapper:Pp.user}],response:[{type:"Long",name:"timetag"}]},onUpdateMyNameCard:{service:"user",sid:3,cid:110,response:[{type:"Property",name:"user",reflectMapper:Lp.user}]}},Vp={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needForcePush:{type:"boolean",required:!1},forcePushIDsList:{type:"string",allowEmpty:!1,required:!1},forcePushContent:{type:"string",allowEmpty:!1,required:!1}},Up={function:{type:"string",required:!1},topic:{type:"string",required:!1},customContent:{type:"string",required:!1},account:{type:"string",required:!1}};function _createForOfIteratorHelperLoose$2(t,a){var u,m=void 0!==Wa&&$l(t)||t["@@iterator"];if(m)return bind$1(u=(m=m.call(t)).next).call(u,m);if(Ln(t)||(m=function _unsupportedIterableToArray$2(t,a){if(t){var u;if("string"==typeof t)return _arrayLikeToArray$2(t,a);var m=slice(u={}.toString.call(t)).call(u,8,-1);return"Object"===m&&t.constructor&&(m=t.constructor.name),"Map"===m||"Set"===m?Wl(t):"Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?_arrayLikeToArray$2(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var g=0;return function(){return g>=t.length?{done:!0}:{done:!1,value:t[g++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$2(t,a){(null==a||a>t.length)&&(a=t.length);for(var u=0,m=Array(a);u<a;u++)m[u]=t[u];return m}var Fp={subType:{type:"string"},setting:{resendFlag:{type:"boolean"},envConfig:{type:"string"},needSaveHistory:{type:"boolean"},needRoaming:{type:"boolean"},needOffline:{type:"boolean"},needSelfSync:{type:"boolean"},needRouted:{type:"boolean"},needUpdateSession:{type:"boolean"},isMuted:{type:"boolean"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBIZID:{type:"string"},clientAntispamHitting:{type:"boolean"},antiSpamUsingYidun:{type:"boolean"},yidunCallbackURL:{type:"string"},yidunAntiCheating:{type:"string"},yidunAntiSpamExtension:{type:"string"},yidunAntiSpamResult:{type:"string"}},pushInfo:Vp,robotInfo:Up,teamSpecializationInfo:{needACK:{type:"boolean"},isACKSent:{type:"boolean"},ackSnapshot:{type:"number"}},threadMessageInfo:{replyMsgFromAccount:{type:"string"},replyMsgToAccount:{type:"string"},replyMsgTime:{type:"number"},replyMsgIdServer:{type:"string"},replyMsgIdClient:{type:"string"},threadMsgFromAccount:{type:"string"},threadMsgToAccount:{type:"string"},threadMsgTime:{type:"number"},threadMsgIdServer:{type:"string"},threadMsgIdClient:{type:"string"}}},Bp={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMemberMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function getSessionId(t,a){return Dd[t.scene]+"-"+(t.to===a?t.from:t.to)}function msgFlow(t,a){return t.from===a?t.to===a?"in":"out":"in"}function formatMsg(t,a){var u=a.account,m=a.featureValue,g=a.statusValue,h=a.sessionAck,_=a.msgReceiptTime,E=Dd[t.scene],T=t.to===u?t.from:t.to,S=Fd.default,M=Ud.unread;Cu(t.isInBlackList)>0?(M=Ud.refused,delete t.isInBlackList):M=t.from===u?_&&_>=+t.time?Ud.receipt:Ud.sent:h&&h>=+t.time?Ud.read:Ud.unread;var I=Lt(Lt({},format(Fp,t)),{scene:E,type:Ld[t.type],fromClientType:Vd[t.fromClientType],flow:msgFlow(t,u),target:T,to:t.to,from:t.from,time:t.time?+t.time:void 0,userUpdateTime:t.userUpdateTime?+t.userUpdateTime:void 0,idClient:t.idClient,sessionId:E+"-"+T,status:Ud[g||M],feature:Fd[m||S]});if("string"==typeof I.attach)try{I.attach=JSON.parse(I.attach)}catch(t){}return"notification"===I.type&&(I.attach=I.attach?function formatNotificationAttach(t){var a,u={};if(u.type=Bp[t.id]||t.id,!t.data)return u;var m,g={ids:"accounts",id:"account",attach:"custom",channel:"channelId",calltype:"netcallType",mute:"mute",duration:"duration",time:"time",from:"from",ext:"ext"},h=t.data;return forEach$1(a=Bt(g)).call(a,(function(t){void 0!==h[t]&&(u[g[t]]=h[t])})),h.tinfo&&(u.team=formatTeam(deserialize(h.tinfo,wp.team))),h.uinfos&&(u.users=map$6(m=h.uinfos).call(m,(function(t){return formatUser(deserialize(t,Lp.user))}))),void 0!==h.mute&&(u.mute=1===Cu(h.mute)),u}(I.attach):{}),I}function formatMsgs(t,a){return t&&t.length>0?removeDupMsgsByIdClient(map$6(t).call(t,(function(t){return formatMsg(t,a)}))):[]}function removeDupMsgsByIdClient(t){for(var a,u,m={},g=_createForOfIteratorHelperLoose$2(t);!(u=g()).done;){var h=u.value,_=m[h.idClient];_&&_.time>h.time||(m[h.idClient]=h)}return map$6(a=Bt(m)).call(a,(function(t){return m[t]}))}function processPushInfoInMsg(t,a){void 0===a&&(a=!0);var u=Lt({},t);if(u.pushInfo&&a){for(var m in u.pushInfo)"boolean"==typeof u.pushInfo[m]?u[m]=u.pushInfo[m]?1:0:u[m]=u.pushInfo[m];delete u.pushInfo}return u.scene===Dd.team&&u.needForcePush&&(u.forcePushContent=u.forcePushContent||u.pushContent,u.forcePushIDsList=u.forcePushIDsList?u.forcePushIDsList:"#%@all@%#"),u}function generatorMsgForCmd(t,a,u,m){t.onSendBefore,t.onUploadStart,t.onUploadDone;var g=t.replyMsg,h=__rest(t,["onSendBefore","onUploadStart","onUploadDone","replyMsg"]),_=Lt(Lt({},formatReverse(Fp,h)),{scene:Dd[t.scene],type:Ld[t.type],from:a,fromClientType:16,fromDeviceId:u,fromNick:null==m?void 0:m.nick,userUpdateTime:null==m?void 0:m.updateTime,status:Ud[Ud.sending]});if(_.idClient=_.resendFlag?t.idClient:Ou(),!_.idClient)throw new Bl("idClient is required to resend a message","idClient","required");return _=processPushInfoInMsg(_,!1),g&&(_.replyMsgFromAccount=g.from,_.replyMsgToAccount=g.to,_.replyMsgTime=+g.time,_.replyMsgIdServer=g.idServer,_.replyMsgIdClient=g.idClient,_.threadMsgFromAccount=g.from,_.threadMsgToAccount=g.to,_.threadMsgTime=+g.time,_.threadMsgIdServer=g.idServer,_.threadMsgIdClient=g.idClient,g.threadMessageInfo&&g.threadMessageInfo.threadMsgIdServer&&(_.threadMsgFromAccount=g.threadMessageInfo.threadMsgFromAccount,_.threadMsgToAccount=g.threadMessageInfo.threadMsgToAccount,_.threadMsgTime=g.threadMessageInfo.threadMsgTime,_.threadMsgIdServer=g.threadMessageInfo.threadMsgIdServer,_.threadMsgIdClient=g.threadMessageInfo.threadMsgIdClient)),_}function formatDeletedMsgs(t,a){return map$6(t).call(t,(function(t){var u;return u=a||(mp(Cu(t.scene))?t.scene:1===Cu(t.scene)?"p2p":"team"),{deletedTime:Cu(t.time),from:t.from,idClient:t.deletedIdClient||t.idClient,idServer:t.deletedIdServer||t.idServer,scene:u,time:Cu(t.deletedMsgCreateTime),to:t.to,ext:"string"==typeof t.ext?t.ext:null}}))}function reverse(t){for(var a=[],u=(t=t||[]).length-1;u>=0;u--)a.push(t[u]);return a}var Gp,Hp,jp,qp=function(){function ModuleService(t){this.core=t}return ModuleService.prototype.processBroadcastMsg=function processBroadcastMsg(t){var a=map$6(t).call(t,(function(t){return Lt(Lt({},t),{time:Cu(t.time)})}));return this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:map$6(a).call(a,(function(t){return t.id}))}),a},ModuleService}(),Yp={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",allowEmpty:!1,required:!1},pushPayload:{type:"string",allowEmpty:!1,required:!1}},Kp={pushContent:8,pushPayload:9,needPush:107,needPushBadge:109,needPushNick:110},Wp={"4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","4_21":"syncDeleteSelfMsgs","7_1":"sendMsg","8_23":"getHistoryTeamMsgs","21_14":"getHistorySuperTeamMsgs","8_2":"sendTeamMsg","21_2":"sendSuperTeamMsg","7_11":"sendMsgReceipt","7_13":"recallMsg","7_24":"deleteSelfMsgs","21_17":"recallSuperTeamMsg","7_2":"onMsg","8_3":"onMsg","21_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_102":"onMsg","8_4":"nimOnTeamMsgs","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg","7_123":"onDeleteSelfMsg","7_124":"onDeleteSelfMsgs"},$p=Lt(Lt({scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resendFlag:13,userUpdateTime:14,ext:15,needAntiSpam:21,antiSpamContent:22,antiSpamBIZID:23,clientAntispamHitting:24,antiSpamUsingYidun:25,needACK:26,yidunCallbackURL:27,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,isDeleted:39,callbackExt:40,subType:41,yidunAntiCheating:42,envConfig:43,yidunAntiSpamExtension:44,yidunAntiSpamResult:45,__clientExt:{id:46,converter:function objectToJSONString(t){if(t&&"object"==typeof t)try{return Pn(t)}catch(t){return}},retConverter:function stringToJSONObject(t){if(t&&"string"==typeof t)try{return JSON.parse(t)}catch(t){return}}},needSaveHistory:100,needRoaming:101,needSelfSync:102,isMuted:104,needRouted:105,isInBlackList:106,needOffline:108,isReplyMsg:111,ackSnapshot:112},{pushContent:17,pushPayload:16,forcePushIDsList:18,forcePushContent:19,needForcePush:20,needPush:107,needPushBadge:109,needPushNick:110}),{function:47,topic:48,customContent:49,account:50}),zp={msg:$p,recallMsgTag:Lt({time:0,type:1,to:2,from:3,ps:4,attach:5,deletedIdClient:10,deletedIdServer:11,deleteMsgCreatetime:14,opeAccount:16,env:21},Kp),deleteSelfMsgTag:{scene:1,from:2,to:3,idServer:4,idClient:5,deletedMsgCreateTime:6,time:7,ext:8},msgReceiptTag:{to:1,from:2,time:7,idClient:11},broadcastMsg:{id:1,fromAccid:2,time:4,body:5}},Jp=invertSerializeMap(zp),Xp={sendMsg:{sid:7,cid:1,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:zp.msg}],response:[{type:"Property",name:"msg",reflectMapper:Jp.msg}],ignoreErrCodes:[7101]},sendTeamMsg:{sid:8,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:zp.msg}],response:[{type:"Property",name:"msg",reflectMapper:Jp.msg}]},sendSuperTeamMsg:{sid:21,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:zp.msg}],response:[{type:"Property",name:"msg",reflectMapper:Jp.msg}]},onMsg:{sid:7,cid:2,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:Jp.msg}]},nimOnTeamMsgs:{sid:8,cid:4,service:"msg",response:[{type:"PropertyArray",name:"datas",reflectMapper:Jp.msg}]},getHistoryTeamMsgs:{sid:8,cid:23,service:"msg",params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Jp.msg}]},getHistorySuperTeamMsgs:{sid:21,cid:14,params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Jp.msg}],service:"msg"},recallMsg:{sid:7,cid:13,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:zp.recallMsgTag}]},deleteSelfMsgs:{sid:7,cid:24,service:"msg",params:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:zp.deleteSelfMsgTag}],response:[{type:"Long",name:"timetag"}]},recallSuperTeamMsg:{sid:21,cid:17,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:zp.recallMsgTag}]},sendMsgReceipt:{sid:7,cid:11,service:"msg",params:[{type:"Property",name:"msgReceiptTag",reflectMapper:zp.msgReceiptTag}],response:[{type:"Property",name:"msgReceiptTag",reflectMapper:Jp.msgReceiptTag}]},batchMarkRead:{sid:4,cid:5,service:"msg",hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},syncMsgReceipts:{sid:4,cid:12,service:"msg",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:Jp.msgReceiptTag},{type:"Long",name:"timetag"}]},syncOfflineMsgs:{sid:4,cid:4,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:Jp.msg}]},syncRoamingMsgs:{sid:4,cid:9,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:Jp.msg}]},syncBroadcastMsg:{sid:4,cid:16,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:Jp.broadcastMsg}]},onBroadcastMsg:{sid:7,cid:17,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:Jp.broadcastMsg}]},onDeleteSelfMsg:{sid:7,cid:123,service:"msg",response:[{type:"Property",name:"deletedMsg",reflectMapper:Jp.deleteSelfMsgTag}]},onDeleteSelfMsgs:{sid:7,cid:124,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:Jp.deleteSelfMsgTag}]},syncDeleteSelfMsgs:{sid:4,cid:21,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:Jp.deleteSelfMsgTag}]}};!function(t){t[t.none=0]="none",t[t.pass=1]="pass",t[t.decline=2]="decline",t[t.read=3]="read",t[t.deleted=4]="deleted",t[t.invalid=5]="invalid"}(Gp||(Gp={})),function(t){t[t.default=0]="default",t[t.leave=1]="leave",t[t.roam=2]="roam"}(Hp||(Hp={})),function(t){t[t.applyTeam=0]="applyTeam",t[t.rejectTeamApply=1]="rejectTeamApply",t[t.teamInvite=2]="teamInvite",t[t.rejectTeamInvite=3]="rejectTeamInvite",t[t.friendRequest=5]="friendRequest",t[t.deleteFriend=6]="deleteFriend",t[t.recallMsgP2p=7]="recallMsgP2p",t[t.recallMsgTeam=8]="recallMsgTeam",t[t.recallMsgSuperTeam=12]="recallMsgSuperTeam",t[t.deleteMsgP2pOneWay=13]="deleteMsgP2pOneWay",t[t.deleteMsgTeamOneWay=14]="deleteMsgTeamOneWay",t[t.applySuperTeam=15]="applySuperTeam",t[t.rejectSuperTeamApply=16]="rejectSuperTeamApply",t[t.superTeamInvite=17]="superTeamInvite",t[t.rejectSuperTeamInvite=18]="rejectSuperTeamInvite",t[t.customP2p=100]="customP2p",t[t.customTeam=101]="customTeam",t[t.customSuperTeam=103]="customSuperTeam"}(jp||(jp={}));var Qp={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};var Zp={setting:{needSaveOffline:{type:"boolean"},isRoutable:{type:"boolean"},envConfig:{type:"string"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"boolean"}},pushInfo:Yp,recallMessageInfo:{idClient:{type:"string",rawKey:"deletedIdClient"},idServer:{type:"string",rawKey:"deletedIdServer"},createTime:{type:"number",rawKey:"deletedMsgCreateTime"},fromNick:{type:"string",rawKey:"deletedMsgFromNick"},opeAccount:{type:"string"}}};function formatSystemMessage(t,a,u){var m=+t.type,g=getEnumKeyByEnumValue(jp,m);u=u||Hp.default;var h=Lt(Lt({},format(Zp,t)),{type:g,time:+t.time,to:t.to,from:t.from,idServer:t.idServer,state:Gp[Gp.none],feature:Hp[u]});if("0"===h.idServer&&h.setting&&(h.setting.needSaveOffline=!1),"string"==typeof h.attach)try{h.attach=JSON.parse(h.attach)}catch(t){a.error("formatSystemMessage: "+h.idServer+" parse attach error",t&&t.message)}return 5===m&&h.attach?(h.attach.type=Qp[+h.attach.vt],"passFriendApply"===h.attach.type?h.state=Gp[Gp.pass]:"rejectFriendApply"===h.attach.type&&(h.state=Gp[Gp.decline])):m<=3&&h.attach&&(h.attach=function formatTeamAttach(t){var a=t.attach,u=t.tinfo,m=__rest(t,["attach","tinfo"]);return m.ext=a,void 0!==u&&(m.team=formatTeam(deserialize(t.tinfo,wp.team))),m}(h.attach)),h}function generatorSysMsgForCmd(t){var a=Lt({},t);return Lt(Lt({},formatReverse(Zp,a)),{type:jp[a.type],to:a.to,attach:a.attach})}function getSceneFromRecallSysMsg(t){return t===jp.recallMsgP2p?"p2p":t===jp.recallMsgTeam?"team":t===jp.recallMsgSuperTeam?"superTeam":""}var em=function(t){function MsgService(a){var u;return(u=t.call(this,"msg",a)||this).onV2SendMessage=function(t){var a=formatMsg(t,{account:u.core.account,featureValue:Fd.default});a.status=t.status,u.core.eventBus.emit("session/updateForNewMsg",a)},u.onV2ModifyMessage=function(t){var a,m=Dd[t.scene]+"-"+(t.to===u.core.account?t.from:t.to),g=null===(a=u.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:m}),h=formatMsg(t,g?{account:u.core.account,sessionAck:g.ack,msgReceiptTime:g.msgReceiptTime}:{account:u.core.account});u.core.eventBus.emit("session/updateForModifyMsg",h)},u.onV2RecallMsg=function(t){var a=formatDeletedMsgs([t],getSceneFromRecallSysMsg(+t.type));u.core.eventBus.emit("session/updateForDeletedMsg",a)},u.onV2DeleteSelfMsgs=function(t){var a=formatDeletedMsgs(t);u.core.eventBus.emit("session/updateForDeletedMsg",a)},u.service=new qp(a),registerParser({cmdMap:Wp,cmdConfig:Xp}),u.registerListener(),u}Ct(MsgService,t);var a=MsgService.prototype;return a.registerListener=function registerListener(){this.core.eventBus.on("forwardReceive/msg/sendMsg",this.onV2SendMessage),this.core.eventBus.on("forwardReceive/msg/modifyMsg",this.onV2ModifyMessage),this.core.eventBus.on("forwardReceive/msg/recallMsg",this.onV2RecallMsg),this.core.eventBus.on("forwardReceive/msg/deleteSelfMsgs",this.onV2DeleteSelfMsgs)},a.sendTextMsg=function sendTextMsg(t){return validate({body:{type:"string",allowEmpty:!1}},t),this.sendMsg(Lt(Lt({},t),{type:"text"}))},a.sendTipMsg=function sendTipMsg(t){return validate({body:{type:"string",allowEmpty:!1}},t),this.sendMsg(Lt(Lt({},t),{type:"tip"}))},a.sendGeoLocationMsg=function sendGeoLocationMsg(t){return validate({attach:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},t),this.sendMsg(Lt(Lt({},t),{type:"geo",attach:Pn(t.attach)}))},a.sendCustomMsg=function sendCustomMsg(t){return validate({attach:{type:"string",allowEmpty:!1}},t),this.sendMsg(Lt(Lt({},t),{type:"custom"}))},a.sendMsg=function sendMsg(t){var a,u=this;if(validate({scene:{type:"enum",values:getEnumKeys(Dd)},type:{type:"enum",values:getEnumKeys(Ld)},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},setting:{type:"object",rules:{resendFlag:{type:"boolean",required:!1},needSaveHistory:{type:"boolean",required:!1},needRoaming:{type:"boolean",required:!1},needOffline:{type:"boolean",required:!1},needSelfSync:{type:"boolean",required:!1},needRouted:{type:"boolean",required:!1},needUpdateSession:{type:"boolean",required:!1}},required:!1},antiSpamInfo:{type:"object",required:!1,rules:{clientAntispamHitting:{type:"boolean",required:!1},antiSpamUsingYidun:{type:"boolean",required:!1}}},pushInfo:{type:"object",required:!1,rules:Vp},robotInfo:{type:"object",required:!1,rules:Up},teamSpecializationInfo:{type:"object",required:!1,rules:{needACK:{type:"boolean",required:!1}}}},t),"team"===t.scene&&t.robotInfo&&!t.robotInfo.account)throw new Ul('When "scene" equals "team", account is required in robotInfo',{key:"account"},"required");var m,g="p2p"===t.scene?"sendMsg":"team"===t.scene?"sendTeamMsg":"sendSuperTeamMsg",h=generatorMsgForCmd(t,this.core.account,this.core.config.deviceId,null===(a=this.core.user)||void 0===a?void 0:a.myInfo),_=formatMsg(Lt(Lt({},h),{time:(new Date).getTime()}),{account:this.core.account,featureValue:Fd.default,statusValue:Ud.sending});try{t.onSendBefore&&t.onSendBefore(_)}catch(t){this.logger.error("sendMsg: options.onSendBefore error",t)}return this.core.eventBus.emit("session/updateForNewMsg",_),this.core.eventBus.emit("forwardSend/msg/sendMsg",h),this.core.sendCmd(g,{msg:h}).then((function(a){var g=a.content,E=a.error;if(m=g.msg,E)throw E;var T=formatMsg(Lt(Lt({},h),g.msg),{account:u.core.account,featureValue:Fd.default,statusValue:Ud.sent});return T.from===T.to&&u.markMsgsAck([T]),u.core.eventBus.emit("session/updateForNewMsg",T),u.core.eventBus.emit("forwardSend/msg/sendMsg",Lt(Lt({},generatorMsgForCmd(T,T.from,T.fromDeviceId)),{idClient:T.idClient,status:"sent"})),u.core.reporter.report("msgSend",{msgId:T.idServer,clientId:T.idClient,msgTime:T.time,fromAccid:"p2p"===t.scene?u.core.account:"",toAccid:T.to,type:Dd[T.scene],roomId:"",tid:"p2p"===t.scene?"":T.to,result:200,failReason:"",rt:Jo()-_.time}),T})).catch((function(a){var g=formatMsg(Lt(Lt(Lt({},h),{time:(new Date).getTime()}),m),{account:u.core.account,featureValue:Fd.default,statusValue:7101===a.code?Ud.refused:Ud.sendFailed});throw a.msg=g,u.core.eventBus.emit("session/updateForNewMsg",g),u.core.eventBus.emit("forwardSend/msg/sendMsg",Lt(Lt({},generatorMsgForCmd(g,g.from,g.fromDeviceId)),{status:"sendFailed"})),u.core.reporter.report("msgSend",{msgId:g.idServer,clientId:g.idClient,msgTime:g.time,fromAccid:"p2p"===t.scene?u.core.account:"",toAccid:g.to,type:Dd[g.scene],roomId:"",tid:"p2p"===t.scene?"":g.to,result:null==a?void 0:a.code,failReason:(null==a?void 0:a.message)||"",rt:Jo()-_.time}),a}))},a.resendMsg=function resendMsg(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u;return Zl.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}}},t),a=t.msg,u=Lt(Lt({},a),{attach:a.attach?Pn(a.attach):void 0,setting:{resendFlag:!0}}),a.from===this.core.account){m.next=5;break}throw new Error("You can only resend messages that you sent: "+a.idClient);case 5:return m.abrupt("return",this.sendMsg(u));case 6:case"end":return m.stop()}}),_callee,this)})))},a.forwardMsg=function forwardMsg(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a,u;return Zl.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:return validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}},scene:{type:"enum",values:getEnumKeys(Dd)},to:{type:"string",allowEmpty:!1}},t),a=t.msg,u=Lt(Lt({},a),{scene:t.scene,to:t.to,attach:a.attach?Pn(a.attach):void 0}),m.abrupt("return",this.sendMsg(u));case 4:case"end":return m.stop()}}),_callee2,this)})))},a.sendImageMsg=function sendImageMsg(t){return this.doSendFile(Lt(Lt({},t),{type:"image"}))},a.sendFileMsg=function sendFileMsg(t){return this.doSendFile(Lt(Lt({},t),{type:"file"}))},a.sendAudioMsg=function sendAudioMsg(t){return this.doSendFile(Lt(Lt({},t),{type:"audio"}))},a.sendVideoMsg=function sendVideoMsg(t){return this.doSendFile(Lt(Lt({},t),{type:"video"}))},a.doSendFile=function doSendFile(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var a;return Zl.wrap((function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:if(validate({scene:{type:"enum",values:getEnumKeys(Dd)},to:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.attach){u.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){u.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return u.prev=5,u.next=8,this.core.cloudStorage.uploadFile(t);case 8:a=u.sent,u.next=15;break;case 11:throw u.prev=11,u.t0=u.catch(5),this.logger.error("sendFile:: upload File error or abort.",u.t0),u.t0;case 15:return u.abrupt("return",this.sendMsg(Lt(Lt({},t),{attach:Pn(a),type:t.type})));case 16:case"end":return u.stop()}}),_callee3,this,[[5,11]])})))},a.recallMsg=function recallMsg(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){var a,u,m,g,h,_;return Zl.wrap((function _callee4$(E){for(;;)switch(E.prev=E.next){case 0:return validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},scene:{type:"enum",values:getEnumKeys(Dd)},time:{type:"number"}}},pushInfo:{type:"object",required:!1,rules:Yp},ps:{type:"string",allowEmpty:!1,required:!1}},t),a=t.msg,u={p2p:"recallMsg",team:"recallMsg",superTeam:"recallSuperTeamMsg"},m={p2p:7,team:8,superTeam:12},g=processPushInfoInMsg({time:a.time,type:m[a.scene],to:a.to,from:a.from,ps:t.ps,attach:t.attach,deletedIdClient:a.idClient,deletedIdServer:a.idServer,opeAccount:a.from,env:t.env,pushInfo:t.pushInfo}),E.next=7,this.core.sendCmd(u[a.scene],{recallMsgTag:g});case 7:return h=Lt({},a,{deletedMsgCreateTime:a.time}),_=formatDeletedMsgs([h]),this.core.eventBus.emit("session/updateForDeletedMsg",_),this.core.eventBus.emit("forwardSend/msg/recallMsg",g),E.abrupt("return",a);case 12:case"end":return E.stop()}}),_callee4,this)})))},a.deleteSelfMsgs=function deleteSelfMsgs(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){var a,u,m,g,h;return Zl.wrap((function _callee5$(_){for(;;)switch(_.prev=_.next){case 0:return validate({msgs:{type:"array",rules:{scene:{type:"enum",values:["p2p","team"]},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},time:{type:"number",allowEmpty:!1}}},ext:{type:"string",allowEmpty:!1,required:!1}},t),a=t.msgs,u=map$6(a).call(a,(function(a){return{scene:"p2p"===a.scene?1:2,from:a.from,to:a.to,idServer:a.idServer,idClient:a.idClient,deletedMsgCreateTime:a.time,ext:t.ext}})),_.next=5,this.core.sendCmd("deleteSelfMsgs",{deletedMsgs:u});case 5:return m=_.sent,g=map$6(u).call(u,(function(t){var a;return Lt({},t,{time:null===(a=null==m?void 0:m.content)||void 0===a?void 0:a.timetag})})),h=formatDeletedMsgs(g),this.core.eventBus.emit("session/updateForDeletedMsg",h),this.core.eventBus.emit("forwardSend/msg/deleteSelfMsgs",map$6(u).call(u,(function(t){var a;return Lt(Lt({},t),{time:null===(a=null==m?void 0:m.content)||void 0===a?void 0:a.timetag})}))),_.abrupt("return",h);case 11:case"end":return _.stop()}}),_callee5,this)})))},a.sendMsgReceipt=function sendMsgReceipt(t){var a,u;return __awaiter(this,void 0,void 0,Zl.mark((function _callee6(){var m,g,h,_;return Zl.wrap((function _callee6$(E){for(;;)switch(E.prev=E.next){case 0:if(validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},target:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),"p2p"===(m=t.msg).scene&&"in"===m.flow){E.next=5;break}return this.logger.warn("Msg scene: "+m.scene+", flow: "+m.flow+" is not allowed to send msg receipt"),E.abrupt("return",void 0);case 5:return g={to:m.target,idClient:m.idClient,time:m.time},E.next=8,this.core.sendCmd("sendMsgReceipt",{msgReceiptTag:g});case 8:return h=E.sent,_=Cu(null===(u=null===(a=h.content)||void 0===a?void 0:a.msgReceiptTag)||void 0===u?void 0:u.time),E.abrupt("return",Lt(Lt({},g),{time:_?Math.min(_,g.time):g.time}));case 11:case"end":return E.stop()}}),_callee6,this)})))},a.sendTeamMsgReceipt=function sendTeamMsgReceipt(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee7(){var a;return Zl.wrap((function _callee7$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}},max:50}},t),a=t.teamMsgReceipts,this.core.sendCmd("sendTeamMsgReceipt",{teamMsgReceipts:a}),u.abrupt("return",void 0);case 4:case"end":return u.stop()}}),_callee7,this)})))},a.getTeamMsgReads=function getTeamMsgReads(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee8(){var u,m,g;return Zl.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},t),u=t.teamMsgReceipts,h.next=4,this.core.sendCmd("getTeamMsgReads",{teamMsgReceipts:u});case 4:return m=h.sent,g=(g=null===(a=m.content)||void 0===a?void 0:a.teamMsgReceipts)?map$6(g).call(g,(function(t){return Lt(Lt({},t),{read:Cu(t.read),unread:Cu(t.unread)})})):[],h.abrupt("return",g);case 8:case"end":return h.stop()}}),_callee8,this)})))},a.getTeamMsgReadAccounts=function getTeamMsgReadAccounts(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee9(){var a,u;return Zl.wrap((function _callee9$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamMsgReceipt:{type:"object",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},t),a=t.teamMsgReceipt,m.next=4,this.core.sendCmd("getTeamMsgReadAccounts",{teamMsgReceiptTag:a});case 4:return u=m.sent,m.abrupt("return",u.content);case 6:case"end":return m.stop()}}),_callee9,this)})))},a.markMsgsAck=function markMsgsAck(t){if(t&&t.length>0){var a=[],u=[];forEach$1(t).call(t,(function(t){"p2p"===t.scene&&"in"===t.flow?a.push(t):"team"===t.scene&&"in"===t.flow&&u.push(t)})),a.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:map$6(a).call(a,(function(t){return t.idServer}))}),u.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:map$6(u).call(u,(function(t){return t.idServer}))})}},a.onMsgHandler=function onMsgHandler(t){var a;if(t.error)this.logger.error("msgHandler::recvError",t.error);else{var u=fillIdServer(t,t.content.msg,"idServer"),m=getSessionId(u,this.core.account),g=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:m}),h=formatMsg(u,g?{account:this.core.account,sessionAck:g.ack,msgReceiptTime:g.msgReceiptTime}:{account:this.core.account});this.logger.getDebugMode()?this.logger.debug("msgHandler::recvMsg",h.idClient,h.idServer,h):this.logger.log("msgHandler::recvMsg",h.idClient,h.idServer),this.markMsgsAck([h]),this.core.eventBus.emit("session/updateForNewMsg",h),"superTeam"===h.scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:h.time}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:h.time}),this.core.emit("msg",h),"notification"===h.type?this.core.eventBus.emit("team/onNotification",h):"out"!==h.flow&&this.doMsgReceiveReport(h,t),"notification"!==h.type&&this.core.user.checkUserUpdate(h)}},a.doMsgReceiveReport=function doMsgReceiveReport(t,a){if(t.from!==this.core.account){var u="p2p"===t.scene,m=get(t,"__clientExt.statistics.apiCallingTime")||0,g=get(t,"__clientExt.statistics.sendTime")||0,h=get(t,"__clientExt.statistics.attachUploadDuration")||0,_=this.core.timeOrigin.getNTPTime(),E=t.time,T=this.core.timeOrigin.checkNodeReliable(a.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(a.__receiveTimeNode):_;this.core.reporter.report("msgReceive",{msgId:t.idServer,clientId:t.idClient,serverTime:E,receiveTime:T,fromAccid:u?t.from:"",toAccid:t.to,type:Dd[t.scene],tid:u?"":t.to,apiCallingTime:m,sendTime:g,attachUploadDuration:h,callbackTime:_,preHandleTime:_,result:200,failReason:"",rt:_-E})}},a.nimOnTeamMsgsHandler=function nimOnTeamMsgsHandler(t){var a,u=this;forEach$1(a=t.content.datas).call(a,(function(a){u.onMsgHandler(Lt({},t,{content:{msg:a}}))}))},a.syncRoamingMsgsHandler=function syncRoamingMsgsHandler(t){var a,u,m=t.content.msgs||[];if(0!==m.length){var g=getSessionId(m[0],this.core.account),h=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:g}),_=(m=formatMsgs(m,h?{account:this.core.account,featureValue:Fd.roam,sessionAck:h.ack,msgReceiptTime:h.msgReceiptTime}:{account:this.core.account,featureValue:Fd.roam}))[0].time,E={timetag:_,sessionId:g,msgs:reverse(m)};"function"!=typeof(null===(u=this.core.sync)||void 0===u?void 0:u.getSyncDoneFlag)||this.core.sync.getSyncDoneFlag()||this.core.eventBus.emit("session/syncMsgs",E),this.core.emit("syncRoamingMsgs",E),"superTeam"===m[0].scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:_}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:_})}},a.syncOfflineMsgsHandler=function syncOfflineMsgsHandler(t){var a,u=this,m=t.content.msgs||[];if(0!==m.length){var g={},h=[];forEach$1(m).call(m,(function(t){var a=getSessionId(t,u.core.account),m=u.core.session.getSessionWithUncomplete({id:a}),_=formatMsg(t,m?{account:u.core.account,featureValue:Fd.leave,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:u.core.account,featureValue:Fd.leave});h.push(_),g[_.sessionId]?g[_.sessionId].push(_):g[_.sessionId]=[_]})),this.markMsgsAck(h);var _=0;forEach$1(a=Bt(g)).call(a,(function(t){var a,m=sort(a=g[t]).call(a,(function(t,a){return a.time-t.time}));(m=removeDupMsgsByIdClient(m))[0].time>_&&(_=m[0].time);var h={timetag:m[0].time,sessionId:t,msgs:m};u.core.eventBus.emit("session/syncMsgs",h),u.core.emit("syncOfflineMsgs",h)})),this.core.eventBus.emit("sync/updateTimetag",{offlineMsgs:_})}},a.syncDeleteSelfMsgsHandler=function syncDeleteSelfMsgsHandler(t){var a,u=null===(a=t.content)||void 0===a?void 0:a.deletedMsgs;u&&u.length>0||this.logger.warn("syncDeleteSelfMsgs:: no msgs");var m=u[u.length-1].time;this.core.eventBus.emit("sync/updateTimetag",{deleteSelfMsgs:m})},a.onDeleteSelfMsgHandler=function onDeleteSelfMsgHandler(t){var a=formatDeletedMsgs([t.content.deletedMsg]);this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.emit("deleteSelfMsgs",a)},a.onDeleteSelfMsgsHandler=function onDeleteSelfMsgsHandler(t){var a=formatDeletedMsgs(t.content.deletedMsgs);this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.emit("deleteSelfMsgs",a)},a.onBroadcastMsgHandler=function onBroadcastMsgHandler(t){var a=t.content.msg,u=this.service.processBroadcastMsg([a]);this.core.emit("broadcastMsgs",u)},a.syncBroadcastMsgHandler=function syncBroadcastMsgHandler(t){var a=t.content.msgs,u=this.service.processBroadcastMsg(a);this.core.emit("broadcastMsgs",u)},MsgService}(ip),tm={"5_1":"sync"},rm={sync:{sid:5,cid:1,service:"sync",hasPacketTimer:!1,params:[{type:"Property",name:"sync",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Long",name:"timetag"}]}},nm=function(t){function SyncService(a,u){var m;return void 0===u&&(u={}),(m=t.call(this,"sync",a)||this).syncDoneFlag=!1,m.config={myInfo:!!a.user.name,offlineMsgs:!!a.msg.name,teams:!!a.team.name,myTeamMembers:!!a.team.name,roamingMsgs:!!a.msg.name,relations:!!a.user.name,friends:!!a.friend.name,friendUsers:!!a.user.name,msgReceipts:!!a.msg.name,broadcastMsgs:!!a.msg.name,recallMsg:!!a.msg.name,sessionAck:!!a.session.name,superTeamSessionAck:!!a.session.name,superTeams:!!a.superTeam.name,mySuperTeamMembers:!!a.superTeam.name,superTeamRoamingMsgs:!!a.superTeam.name,deleteSuperTeamMsg:!!a.superTeam.name,deleteSelfMsgs:!!a.msg.name,sessionHistoryMsgsDelete:!!a.msgLog.name,avSignal:!!a.signaling.name},m.setOptions(u),m.timetags={},m.initEventListeners(),registerParser({cmdMap:tm,cmdConfig:rm}),m}Ct(SyncService,t);var a=SyncService.prototype;return a.setOptions=function setOptions(t){Lt(this.config,t)},a.reset=function reset(){this.timetags={},this.syncDoneFlag=!1},a.getSyncDoneFlag=function getSyncDoneFlag(){return this.syncDoneFlag},a.doSync=function doSync(){var t;return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u;return Zl.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return a=this.genSyncParams(),this.logger.log("sync::doSyncV1: ",a),m.prev=2,m.next=5,this.core.clientSocket.sendCmd("sync",{sync:a});case 5:u=m.sent,this.core.logger.log("sync::doSyncV1 done in",null===(t=u.content)||void 0===t?void 0:t.timetag),this.syncDoneFlag=!0,this.core.emit("syncdone"),m.next=17;break;case 11:return m.prev=11,m.t0=m.catch(2),this.core.logger.error("sync::doSyncV1 error",m.t0),this.syncDoneFlag=!0,this.core.emit("syncdone"),m.abrupt("return");case 17:case"end":return m.stop()}}),_callee,this,[[2,11]])})))},a.initEventListeners=function initEventListeners(){var t=this;this.core.eventBus.on("logined",(function(){t.syncDoneFlag=!1,t.doSync()})),this.core.eventBus.on("sync/updateTimetag",(function(a){var u;forEach$1(u=Bt(a)).call(u,(function(u){a[u]>(t.timetags[u]||0)&&(t.timetags[u]=a[u])}))}))},a.genSyncParams=function genSyncParams(){var t,a,u=this;return reduce(t=filter(a=Bt(this.config)).call(a,(function(t){var a=t;return u.config[a]}))).call(t,(function(t,a){var m=a;return t[m]=u.timetags[m]||0,t}),{})},a.handleImmediate=function handleImmediate(t){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),Ho.resolve(t)},a.delaySyncDone=function delaySyncDone(t){var a=this;return 102===eu.getSystemInfo().hostEnvEnum?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new Ho((function(u){sa((function(){a.handleImmediate(t).then((function(){u(t)}))}),100)}))):this.handleImmediate(t)},a.syncHandler=function syncHandler(t){return this.delaySyncDone(t)},SyncService}(ip);function pick(t,a){t=t||{};var u={};return forEach$1(a=a||[]).call(a,(function(a){void 0!==t[a]&&(u[a]=t[a])})),u}function _createForOfIteratorHelperLoose$1(t,a){var u,m=void 0!==Wa&&$l(t)||t["@@iterator"];if(m)return bind$1(u=(m=m.call(t)).next).call(u,m);if(Ln(t)||(m=function _unsupportedIterableToArray$1(t,a){if(t){var u;if("string"==typeof t)return _arrayLikeToArray$1(t,a);var m=slice(u={}.toString.call(t)).call(u,8,-1);return"Object"===m&&t.constructor&&(m=t.constructor.name),"Map"===m||"Set"===m?Wl(t):"Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?_arrayLikeToArray$1(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var g=0;return function(){return g>=t.length?{done:!0}:{done:!1,value:t[g++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$1(t,a){(null==a||a>t.length)&&(a=t.length);for(var u=0,m=Array(a);u<a;u++)m[u]=t[u];return m}var im=function(t){function UserService(a){var u;return(u=t.call(this,"user",a)||this).userInfoMap=new pc,u.myInfo=formatUser({}),registerParser({cmdMap:xp,cmdConfig:Dp}),u}Ct(UserService,t);var a=UserService.prototype;return a.setBlack=function setBlack(t){var a=this;return validate({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},t),this.core.sendCmd("setBlack",t).then((function(){a.core.eventBus.emit("forwardSend/user/updateBlackList",t.account,t.isAdd)}))},a.setMute=function setMute(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){return Zl.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},t),a.next=3,this.core.sendCmd("setMute",t).then((function(){}));case 3:this.core.eventBus.emit("forwardSend/user/setMute",t.account,t.isAdd);case 4:case"end":return a.stop()}}),_callee,this)})))},a.getRelations=function getRelations(){return this.core.sendCmd("syncRelations",{timetag:0})},a.getBlackList=function getBlackList(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var t;return Zl.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=a.sent,a.abrupt("return",t.blackList||[]);case 4:case"end":return a.stop()}}),_callee2,this)})))},a.getMuteList=function getMuteList(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var t;return Zl.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=a.sent,a.abrupt("return",t.muteList||[]);case 4:case"end":return a.stop()}}),_callee3,this)})))},a.updatePushToken=function updatePushToken(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){return Zl.wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return t.stop()}}),_callee4,this)})))},a.updateAppBackground=function updateAppBackground(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){return Zl.wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return t.stop()}}),_callee5,this)})))},a.getUsersNameCardFromServer=function getUsersNameCardFromServer(t){var a=this;return validate({accounts:{type:"array",max:150,itemType:"string"}},t),this.core.sendCmd("getUsersNameCardFromServer",pick(t,["accounts"])).then((function(u){var m,g=u.content;return a.logger.log("user:: getUsers done",t.accounts),g&&g.users?map$6(m=g.users).call(m,(function(t){return formatUser(t)})):[]}))},a.updateMyNameCard=function updateMyNameCard(t){var a=this;if(validate({nick:{type:"string",required:!1},avatar:{type:"string",required:!1},signature:{type:"string",required:!1},gender:{type:"enum",values:getEnumKeys(gp),required:!1},email:{type:"string",required:!1},birth:{type:"string",required:!1},tel:{type:"string",required:!1},ext:{type:"string",required:!1}},t),0===Bt(t).length)return Ho.resolve(this.myInfo);var u=pick(t,["nick","avatar","signature","email","birth","tel","ext"]);return t.gender&&(u.gender=gp[t.gender]),this.core.sendCmd("updateMyNameCard",{user:u}).then((function(m){var g=m.content;return g&&g.timetag&&a.core.eventBus.emit("sync/updateTimetag",{myInfo:+g.timetag}),t.gender&&(u.gender=t.gender),a.myInfo=Lt({},a.myInfo,u),a.core.eventBus.emit("forwardSend/user/updateUserInfo",u),a.myInfo}))},a.checkUserUpdate=function checkUserUpdate(t){var a=t.from;if(a!==this.core.account){var u=this.userInfoMap.get(a);if(u){var m=u.updateTime,g=t.userUpdateTime;!isNaN(m)&&!isNaN(g)&&"number"==typeof m&&"number"==typeof g&&m<g&&this.refreshUserInfo(a)}else this.refreshUserInfo(a)}},a.refreshUserInfo=function refreshUserInfo(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee6(){var a,u,m,g;return Zl.wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.getUsersNameCardFromServer({accounts:[t]});case 2:for(a=h.sent,u=_createForOfIteratorHelperLoose$1(a);!(m=u()).done;)g=m.value,this.userInfoMap.set(g.account,g),this.core.emit("updateUserInfo",g);case 4:case"end":return h.stop()}}),_callee6,this)})))},a.onUpdateBlackListHandler=function onUpdateBlackListHandler(t){var a=t.content;a.account?this.core.emit("updateBlackList",a):this.logger.warn("onUpdateBlackListHandler: no account")},a.onUpdateMuteListHandler=function onUpdateMuteListHandler(t){var a=t.content;a.account?this.core.emit("updateMuteList",a):this.logger.warn("onUpdateBlackListHandler: no account")},a.syncRelationsHandler=function syncRelationsHandler(t){var a=t.content,u=a.list,m=a.timetag,g={blackList:[],muteList:[]};return m&&this.core.eventBus.emit("sync/updateTimetag",{relations:m}),u&&u.length&&forEach$1(u).call(u,(function(t){var a=function formatRelationMember(t){var a={account:t.account,updateTime:+t.updateTime,createTime:+t.createTime};return"1"===t.isMuted&&(a.isMuted=!0),"1"===t.isBlack&&(a.isBlack=!0),a}(t);a.isBlack&&g.blackList.push(a),a.isMuted&&g.muteList.push(a)})),this.core.emit("relations",g),Ho.resolve(g)},a.syncMyNameCardHandler=function syncMyNameCardHandler(t){t.content.user&&(this.myInfo=formatUser(t.content.user),this.core.emit("syncMyNameCard",this.myInfo),this.core.eventBus.emit("sync/updateTimetag",{myInfo:t.content.timetag}))},a.onUpdateMyNameCardHandler=function onUpdateMyNameCardHandler(t){var a=t.content.user;a?(Lt(this.myInfo,formatUser(a)),this.core.emit("updateMyNameCard",this.myInfo)):this.logger.warn("onUpdateMyNameCardHandler no user info")},UserService}(ip);var om={"4_12":"syncMsgReceipts","4_14":"syncSessionAck","4_20":"syncSuperTeamSessionAck","4_22":"nimSyncSessionsWithMoreRoaming","4_25":"syncSessionReliableInfo","7_12":"multiSyncMsgReceipt","7_16":"markSessionAck","7_25":"markMultSessionsAck","7_116":"syncMarkSessionAck","21_25":"markSuperTeamSessionAck","21_32":"markMultSuperTeamSessionsAck","21_125":"syncMarkSuperTeamSessionAck","4_23":"nimSyncStickTopSessions","23_12":"nimAddStickTopSession","23_13":"nimDeleteStickTopSession","23_14":"nimUpdateStickTopSession","23_112":"nimMultiSyncAddStickTopSession","23_113":"nimMultiSyncDeleteStickTopSession","23_114":"nimMultiSyncUpdateStickTopSession"},am={msgReceiptTag:{to:1,from:2,time:7,idClient:11},stickTopSessionTag:{id:1,ext:2,createTime:3,updateTime:4},sessionAckTag:{scene:1,to:2,timetag:3},sessionReliableSyncTag:{scene:1,sessionId:2,syncStatus:3,syncEndMsgId:4,syncEndMsgidClient:5,syncEndMsgTime:6,syncStartMsgid:7,syncStartMsgidClient:8,syncStartMsgTime:9,nextMsgid:10,nextMsgidClient:11,nextMsgTime:12,roamMsgSync:13,offlineMsgSync:14,netCallOfflineMsgSync:15}},sm=invertSerializeMap(am),cm={syncMsgReceipts:{sid:4,cid:12,service:"session",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:sm.msgReceiptTag},{type:"Long",name:"timetag"}]},syncSessionAck:{sid:4,cid:14,service:"session",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamSessionAck:{sid:4,cid:20,service:"session",response:[{type:"LongLongMap",name:"superTeam"},{type:"Long",name:"timetag"}]},multiSyncMsgReceipt:{sid:7,cid:12,service:"session",response:[{type:"Property",name:"msgReceiptTag",reflectMapper:sm.msgReceiptTag}]},markSessionAck:{sid:7,cid:16,service:"session",params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSessionAck:{sid:7,cid:116,service:"session",response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSuperTeamSessionAck:{sid:21,cid:125,service:"session",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},markMultSessionsAck:{sid:7,cid:25,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:am.sessionAckTag}]},markSuperTeamSessionAck:{sid:21,cid:25,service:"session",params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},nimAddStickTopSession:{sid:23,cid:12,service:"session",params:[{type:"Property",name:"tag",reflectMapper:am.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:sm.stickTopSessionTag}]},nimDeleteStickTopSession:{sid:23,cid:13,service:"session",params:[{type:"Property",name:"tag",reflectMapper:am.stickTopSessionTag}],response:[{type:"Long",name:"timetag"}]},nimUpdateStickTopSession:{sid:23,cid:14,service:"session",params:[{type:"Property",name:"tag",reflectMapper:am.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:sm.stickTopSessionTag}]},nimMultiSyncAddStickTopSession:{sid:23,cid:112,service:"session",response:[{type:"Property",name:"data",reflectMapper:sm.stickTopSessionTag}]},nimMultiSyncDeleteStickTopSession:{sid:23,cid:113,service:"session",response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:sm.stickTopSessionTag}]},nimMultiSyncUpdateStickTopSession:{sid:23,cid:114,service:"session",response:[{type:"Property",name:"data",reflectMapper:sm.stickTopSessionTag}]},nimSyncStickTopSessions:{sid:4,cid:23,service:"session",response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:sm.stickTopSessionTag}]},markMultSuperTeamSessionsAck:{sid:21,cid:32,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:am.sessionAckTag}]},nimSyncSessionsWithMoreRoaming:{sid:4,cid:22,service:"session",response:[]},syncSessionReliableInfo:{sid:4,cid:25,service:"session",response:[]}},lm={id:{type:"string"},ext:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function formatStickTop(t,a,u){void 0===u&&(u=!0);var m=format(lm,t);m.isStickOnTop=u,m.id=a.id,u||(m.ext="");var g=Lt(Lt({},a),{stickTopInfo:a.stickTopInfo?Lt({},a.stickTopInfo,m):m});return void 0===g.lastMsg&&(g.lastMsg=null),g}var um=function(){function StickTopService(t){this.core=t}var t=StickTopService.prototype;return t.getSession=function getSession(t){return this.core.session.getSessionWithUncomplete({id:t})||this.core.session.createSession(t)},t.addStickTopSession=function addStickTopSession(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u,m,g,h,_;return Zl.wrap((function _callee$(E){for(;;)switch(E.prev=E.next){case 0:return validate({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a=getAccountFromSessionId(t.id),u=a.scene,m=a.accid,E.next=4,this.core.sendCmd("nimAddStickTopSession",{tag:{id:("superTeam"===u?"super_team":u)+"|"+m,ext:t.ext||""}});case 4:return g=E.sent,h=this.getSession(t.id),_=formatStickTop(g.content.data,h),E.abrupt("return",_);case 8:case"end":return E.stop()}}),_callee,this)})))},t.deleteStickTopSession=function deleteStickTopSession(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a,u,m,g,h,_;return Zl.wrap((function _callee2$(E){for(;;)switch(E.prev=E.next){case 0:return validate({id:{type:"string",allowEmpty:!1}},t),a=getAccountFromSessionId(t.id),u=a.scene,m=a.accid,E.next=4,this.core.sendCmd("nimDeleteStickTopSession",{tag:{id:("superTeam"===u?"super_team":u)+"|"+m}});case 4:return g=E.sent,h=this.getSession(t.id),_=formatStickTop({updateTime:g.content.timetag,ext:""},h,!1),E.abrupt("return",_);case 8:case"end":return E.stop()}}),_callee2,this)})))},t.updateStickTopSession=function updateStickTopSession(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var a,u,m,g,h,_;return Zl.wrap((function _callee3$(E){for(;;)switch(E.prev=E.next){case 0:return validate({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a=getAccountFromSessionId(t.id),u=a.scene,m=a.accid,E.next=4,this.core.sendCmd("nimUpdateStickTopSession",{tag:{id:("superTeam"===u?"super_team":u)+"|"+m,ext:t.ext||""}});case 4:return g=E.sent,h=this.getSession(t.id),_=formatStickTop(g.content.data,h),E.abrupt("return",_);case 8:case"end":return E.stop()}}),_callee3,this)})))},t.stickTopSessionHandler=function stickTopSessionHandler(t,a){void 0===a&&(a=!0);var u=getAccountFromSessionId(t.id,"|"),m=u.scene+"-"+u.accid;return formatStickTop(t,this.getSession(m),a)},StickTopService}(),dm=function(){function UnreadModuleService(t){this.core=t,this.logger=t.logger}var t=UnreadModuleService.prototype;return t.canSessionResetUnreadCount=function canSessionResetUnreadCount(t){var a=t.id;if(void 0===t.lastMsg)throw new Error("Session::canSessionResetUnreadCount: session "+a+" is not completly, lastMsg undefined");return null!==t.lastMsg||t.unread>0?!(t.ack&&t.lastMsg&&t.ack>=t.lastMsg.time)||(this.logger.log("Session::canSessionResetUnreadCount: session "+a+" reset failed, ack time is greater than last message time"),!1):(this.logger.log("Session::canSessionResetUnreadCount: session "+a+" doesn't need to be updated, lastMsg null and unread 0"),!1)},t.filterSessionForResetUnreadCount=function filterSessionForResetUnreadCount(t){var a=this,u={cmd:"markMultSuperTeamSessionsAck",params:[]},m={cmd:"markMultSessionsAck",params:[]};return forEach$1(t).call(t,(function(t){var g;try{if(!a.canSessionResetUnreadCount(t))return;var h=getAccountFromSessionId(t.id),_=h.accid,E=h.scene,T={to:_,sessionId:t.id,timetag:(null===(g=null==t?void 0:t.lastMsg)||void 0===g?void 0:g.time)||t.updateTime||0},S=function generateSceneForCmd(t){return formatReverse({scene:{type:"enum",values:Dd}},t)}({scene:E});"superTeam"===E?u.params.push(T):m.params.push(Lt(Lt({},T),S))}catch(t){a.logger.warn(t)}})),{superTeam:u,p2pOrTeam:m}},UnreadModuleService}();function chunk(t,a){t=t||[],a=a||1,a=Math.max(Math.floor(a),1);for(var u=[],m=0;m<t.length;m+=a)u.push(slice(t).call(t,m,m+a));return u}function _createForOfIteratorHelperLoose(t,a){var u,m=void 0!==Wa&&$l(t)||t["@@iterator"];if(m)return bind$1(u=(m=m.call(t)).next).call(u,m);if(Ln(t)||(m=function _unsupportedIterableToArray(t,a){if(t){var u;if("string"==typeof t)return _arrayLikeToArray(t,a);var m=slice(u={}.toString.call(t)).call(u,8,-1);return"Object"===m&&t.constructor&&(m=t.constructor.name),"Map"===m||"Set"===m?Wl(t):"Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?_arrayLikeToArray(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var g=0;return function(){return g>=t.length?{done:!0}:{done:!1,value:t[g++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var u=0,m=Array(a);u<a;u++)m[u]=t[u];return m}var pm=function(t){function SessionService(a,u){var m;return(m=t.call(this,"session",a)||this).list=new pc,m.unreadCountFilterFn=function(t){return!0},m.lastMessageFilterFn=function(t){return!0},m.initEventListeners(),registerParser({cmdMap:om,cmdConfig:cm}),m.stickTopService=new um(a),m.unreadModule=new dm(a),u&&m.setOptions(u),m}Ct(SessionService,t);var a=SessionService.prototype;return a.setOptions=function setOptions(t){"function"==typeof(null==t?void 0:t.unreadCountFilterFn)&&(this.unreadCountFilterFn=t.unreadCountFilterFn),"function"==typeof(null==t?void 0:t.lastMessageFilterFn)&&(this.lastMessageFilterFn=t.lastMessageFilterFn)},a.reset=function reset(){var t;forEach$1(t=this.list).call(t,(function(t){t.unreadMsgs=[]})),this.list.clear()},a.initEventListeners=function initEventListeners(){var t,a,u,m,g=this;this.core.eventBus.on("session/syncMsgs",bind$1(t=this.onSyncMsgs).call(t,this)),this.core.eventBus.on("session/updateForNewMsg",bind$1(a=this.updateSessionWithMsg).call(a,this)),this.core.eventBus.on("session/updateForModifyMsg",bind$1(u=this.updateSessionByModifyMsg).call(u,this)),this.core.eventBus.on("session/updateForClearMsg",(function(t,a){void 0===a&&(a=!0),t&&t.length>0&&forEach$1(t).call(t,(function(t){g.updateSession({id:t.sessionId,lastMsg:null,unread:0,unreadMsgs:[]},a)}))})),this.core.eventBus.on("session/updateForDeletedMsg",bind$1(m=this.updateSessionForDeletedMsg).call(m,this))},a.createSession=function createSession(t,a){try{var u=getAccountFromSessionId(t);return{id:t,scene:u.scene,to:u.accid,lastMsg:a,updateTime:a?a.time:0,unread:0,unreadMsgs:[],ack:0}}catch(a){throw this.logger.error("Failed to create session with "+t,a),new Error("Failed to create session with "+t)}},a.getSession=function getSession(t){validate({id:{type:"string",allowEmpty:!1}},t);var a=this.list.get(t.id);if(this.isSessionComplete(a))return a},a.getSessionWithUncomplete=function getSessionWithUncomplete(t){return this.list.get(t.id)},a.getAllSessions=function getAllSessions(){for(var t,a=[],u=_createForOfIteratorHelperLoose(this.list);!(t=u()).done;){var m=t.value;m[0];var g=m[1];this.isSessionComplete(g)&&a.push(g)}return a},a.getSessions=function getSessions(t){validate({limit:{type:"number",required:!1},lastSessionId:{type:"string",allowEmpty:!1,required:!1},desc:{type:"boolean",required:!1}},t);var a=[],u=t.limit,m=void 0===u?100:u,g=t.desc,h=void 0===g||g,_=t.lastSessionId,E=0;if(h){for(var T,S,M=_createForOfIteratorHelperLoose(this.list);!(S=M()).done;){var I=S.value,A=I[0],b=I[1];if(_===A)break;this.isSessionComplete(b)&&a.push(b)}return reverse$1(T=slice(a).call(a,-m)).call(T)}for(var N,C=_createForOfIteratorHelperLoose(this.list);!(N=C()).done;){var R=N.value,O=R[0],w=R[1];if(_)O===_&&(_=void 0);else if(this.isSessionComplete(w)){if(++E>m)break;a.push(w)}}return a},a.resetSessionUnreadCount=function resetSessionUnreadCount(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var u,m,g,h,_,E,T,S,M=this;return Zl.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:if(validate({id:{type:"string",allowEmpty:!1}},t),validate({id:{type:"string",allowEmpty:!1}},t),u=t.id,m=this.list.get(u)){I.next=7;break}throw this.logger.warn("resetSessionUnreadCount: can not find session "+u),new Error("Session::canSessionResetUnreadCount: can not find session "+u);case 7:g=!1;try{g=this.unreadModule.canSessionResetUnreadCount(m)}catch(t){this.logger.warn(t)}if(!1!==g){I.next=11;break}return I.abrupt("return");case 11:return h=getAccountFromSessionId(u),_=h.accid,E=h.scene,T={to:_,timetag:(null===(a=null==m?void 0:m.lastMsg)||void 0===a?void 0:a.time)||m.updateTime||0},S="markSuperTeamSessionAck","superTeam"!==E&&(T.scene="p2p"===E?0:1,S="markSessionAck"),I.abrupt("return",this.core.sendCmd(S,T).then((function(){var t=M.storeUnreadByAck(u,T.timetag);t&&M.core.emit("updateSession",t)})));case 16:case"end":return I.stop()}}),_callee,this)})))},a.resetMultiSessionUnreadCount=function resetMultiSessionUnreadCount(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a,u,m,g,h,_,E,T,S,M,I,A,b,N,C=this;return Zl.wrap((function _callee2$(R){for(;;)switch(R.prev=R.next){case 0:validate({ids:{type:"array",itemType:"string",min:1}},t),m=filter(a=map$6(u=t.ids).call(u,(function(t){return C.list.get(t)}))).call(a,(function(a,u){return!!a||(C.logger.warn("Session::canSessionResetUnreadCount: can not find session "+t.ids[u]),!1)})),g=this.unreadModule.filterSessionForResetUnreadCount(m),h=g.superTeam,_=g.p2pOrTeam,E=chunk(h.params,50),T=chunk(_.params,50),S=_createForOfIteratorHelperLoose(E);case 6:if((M=S()).done){R.next=13;break}return I=M.value,R.next=10,this.core.sendCmd(h.cmd,{datas:I});case 10:forEach$1(I).call(I,(function(t){var a=C.storeUnreadByAck(t.sessionId,t.timetag);a&&C.core.emit("updateSession",a)}));case 11:R.next=6;break;case 13:A=_createForOfIteratorHelperLoose(T);case 14:if((b=A()).done){R.next=21;break}return N=b.value,R.next=18,this.core.sendCmd(_.cmd,{datas:N});case 18:forEach$1(N).call(N,(function(t){var a=C.storeUnreadByAck(t.sessionId,t.timetag);a&&C.core.emit("updateSession",a)}));case 19:R.next=14;break;case 21:case"end":return R.stop()}}),_callee2,this)})))},a.resetAllSessionsUnreadCount=function resetAllSessionsUnreadCount(){var t,a=[];return forEach$1(t=this.list).call(t,(function(t){a.push(t.id)})),0===a.length?Ho.resolve():this.resetMultiSessionUnreadCount({ids:a})},a.deleteSession=function deleteSession(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){return Zl.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({id:{type:"string",allowEmpty:!1},isSyncToServer:{type:"boolean",required:!1}},t),this.list.delete(t.id),!this.core.msgLog||!t.isSyncToServer){a.next=5;break}return a.next=5,this.core.msgLog.deleteRoamingMsgs({ids:[t.id]});case 5:case"end":return a.stop()}}),_callee3,this)})))},a.deleteAllSessionsFromLocal=function deleteAllSessionsFromLocal(){this.list.clear()},a.addStickTopSession=function addStickTopSession(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){var a;return Zl.wrap((function _callee4$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.stickTopService.addStickTopSession(t);case 2:return a=u.sent,this.list.set(a.id,a),u.abrupt("return",a);case 5:case"end":return u.stop()}}),_callee4,this)})))},a.deleteStickTopSession=function deleteStickTopSession(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){var a;return Zl.wrap((function _callee5$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.stickTopService.deleteStickTopSession(t);case 2:return a=u.sent,this.list.set(a.id,a),u.abrupt("return",a);case 5:case"end":return u.stop()}}),_callee5,this)})))},a.updateStickTopSession=function updateStickTopSession(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee6(){var a;return Zl.wrap((function _callee6$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.stickTopService.updateStickTopSession(t);case 2:return a=u.sent,this.list.set(a.id,a),u.abrupt("return",a);case 5:case"end":return u.stop()}}),_callee6,this)})))},a.nimMultiSyncAddStickTopSessionHandler=function nimMultiSyncAddStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler(t.content.data);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimMultiSyncDeleteStickTopSessionHandler=function nimMultiSyncDeleteStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler({id:t.content.data.id,updateTime:t.content.timetag,ext:""},!1);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimMultiSyncUpdateStickTopSessionHandler=function nimMultiSyncUpdateStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler(t.content.data);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimSyncStickTopSessionsHandler=function nimSyncStickTopSessionsHandler(t){var a,u=this;if(this.core.eventBus.emit("sync/updateTimetag",{stickTopSessions:t.content.timetag}),t.content.isThereAnyChange){var m=t.content.datas,g=[];forEach$1(a=this.list).call(a,(function(t){var a;t&&(null===(a=null==t?void 0:t.stickTopInfo)||void 0===a?void 0:a.isStickOnTop)&&g.push(t)})),forEach$1(g).call(g,(function(t){var a=t.id;if(!find(m).call(m,(function(t){var u=getAccountFromSessionId(t.id,"|");return u.scene+"-"+u.accid===a}))){var u={},g=getAccountFromSessionId(a,"-"),h=g.scene,_=g.accid;u.id=h+"|"+_,u.ext="",u.isTop=!1,m.push(u)}})),forEach$1(m).call(m,(function(t){var a;!1===t.isTop?(delete t.isTop,a=u.stickTopService.stickTopSessionHandler(t,!1)):a=u.stickTopService.stickTopSessionHandler(t),u.list.set(a.id,a)}))}},a.updateSessionWithMsg=function updateSessionWithMsg(t){var a,u,m=!0,g=!0,h="boolean"!=typeof(null===(a=t.pushInfo)||void 0===a?void 0:a.needPushBadge)||(null===(u=t.pushInfo)||void 0===u?void 0:u.needPushBadge);try{m=!!this.unreadCountFilterFn(t)}catch(t){this.logger.error("session:updateSessionWithMsg, unreadCountFilterFn error",t)}try{g=!!this.lastMessageFilterFn(t)}catch(t){this.logger.error("session:updateSessionWithMsg, lastMessageFilterFn error",t)}var _=this.list.get(t.sessionId)||this.createSession(t.sessionId),E=!1;if(this.logger.log("session:updateSessionWithMsg, pending ",t.sessionId,t.idClient,t.idServer,g,m),g&&(!_.lastMsg||_.lastMsg.time<t.time||t.status===Ud[Ud.sending]||_.lastMsg.status===Ud[Ud.sending])&&(_.lastMsg=t,_.updateTime=t.time,E=!0),m&&h&&t.status===Ud[Ud.unread]&&t.time>(_.ack||0)){_.unread++;var T=_.unreadMsgs||[];T.unshift(t),sort(T).call(T,(function(t,a){return a.time-t.time})),_.unreadMsgs=T,E=!0}E&&(this.logger.log("session:updateSessionWithMsg updating ",_.id,_.unread,_.lastMsg&&_.lastMsg.idClient),this.list.set(_.id,_),this.core.emit("updateSession",_))},a.updateSessionByModifyMsg=function updateSessionByModifyMsg(t){var a=this.list.get(t.sessionId)||this.createSession(t.sessionId),u=a.unreadMsgs||[],m=findIndex$1(u).call(u,(function(a){return a.idClient===t.idClient}));m>-1&&(u[m]=t),a.unreadMsgs=u,this.list.set(a.id,a);var g=!0;try{g=!!this.lastMessageFilterFn(t)}catch(t){this.logger.error("session:updateSessionByModifyMsg, lastMessageFilterFn error",t)}g&&(a.lastMsg&&a.lastMsg.idClient!==t.idClient||(a.lastMsg=t,a.updateTime=t.time,this.logger.log("session:updateSessionByModifyMsg updating ",a.id,a.unread,a.lastMsg&&a.lastMsg.idClient),this.list.set(a.id,a),this.core.emit("updateSession",a)))},a.storeUnreadByAck=function storeUnreadByAck(t,a){var u=this.list.get(t)||this.createSession(t);if(!(u.ack&&a<u.ack)){var m=u.unreadMsgs||[],g=[],h=[],_=0;return u.unreadMsgs=[],m.length>0&&(forEach$1(m).call(m,(function(t){includes(h).call(h,t.idClient)||t.time>a&&(_++,h.push(t.idClient),g.push(t))})),u.unreadMsgs=sort(g).call(g,(function(t,a){return a.time-t.time}))),u.ack=a,u.unread=_,u.lastMsg&&"unread"===u.lastMsg.status&&a>=u.lastMsg.time&&(u.lastMsg.status="read"),this.list.set(t,u),u}this.logger.warn("storeUnreadByAck: not need update ack",t,a,u.ack)},a.updateSession=function updateSession(t,a){void 0===a&&(a=!0);var u=t.id,m=this.list.get(u)||this.createSession(t.id),g=Lt(m,t);return this.list.set(u,g),this.logger.log("updateSession: update",a,pick(t,["id","ack","unread"]),g.lastMsg&&g.lastMsg.idClient),a&&this.core.emit("updateSession",g),g},a.isSessionComplete=function isSessionComplete(t){return!!t&&(!!(t.id&&t.scene&&t.to)&&void 0!==t.lastMsg)},a.syncSessionAckHandler=function syncSessionAckHandler(t){var a,u,m=this,g=t.content.p2p||{},h=t.content.team.m_map||{};this.logger.log("syncSessionAck::",g,h),forEach$1(a=Bt(g)).call(a,(function(t){m.updateSession({id:"p2p-"+t,ack:g[t]},!1)})),forEach$1(u=Bt(h)).call(u,(function(t){m.updateSession({id:"team-"+t,ack:h[t]},!1)}))},a.syncSuperTeamSessionAckHandler=function syncSuperTeamSessionAckHandler(t){var a,u=this,m=t.content.superTeam.m_map;this.logger.log("syncSuperTeamSessionAck::",m),forEach$1(a=Bt(m)).call(a,(function(t){u.updateSession({id:"superTeam-"+t,ack:m[t]},!1)}))},a.syncMarkSessionAckHandler=function syncMarkSessionAckHandler(t){var a=t.content,u=(0===a.scene?"p2p":1===a.scene?"team":"superTeam")+"-"+a.to,m=this.list.get(u);if(m&&m.ack&&a.timetag<m.ack)this.logger.warn("syncMarkSessionAckHandler: "+u+" do not need update ack",m.ack,a.timetag);else{var g=this.storeUnreadByAck(u,a.timetag);g&&this.core.emit("updateSession",g)}},a.syncMarkSuperTeamSessionAckHandler=function syncMarkSuperTeamSessionAckHandler(t){t.content.scene=5,this.syncMarkSessionAckHandler(t)},a.onSyncDone=function onSyncDone(){var t,a,u,m=this,g=[];forEach$1(t=this.list).call(t,(function(t,a){g.push(m.storeUnreadByAck(a,t.ack||0))})),this.list.clear(),forEach$1(a=sort(g).call(g,(function(t,a){return t.updateTime-a.updateTime}))).call(a,(function(t){m.list.set(t.id,t)})),(g=sort(u=filter(g).call(g,(function(t){return m.isSessionComplete(t)}))).call(u,(function(t,a){return a.updateTime-t.updateTime}))).length>0&&this.core.emit("sessions",g)},a.onSyncMsgs=function onSyncMsgs(t){var a,u=this,m=this.list.get(t.sessionId),g=[];try{var h;g=filter(h=t.msgs).call(h,(function(t){var a,m,g="boolean"!=typeof(null===(a=t.pushInfo)||void 0===a?void 0:a.needPushBadge)||(null===(m=t.pushInfo)||void 0===m?void 0:m.needPushBadge);return u.unreadCountFilterFn(JSON.parse(Pn(t)))&&g}))}catch(t){this.logger.error("session:onSyncMsgs, unreadCountFilterFn error ",t)}var _,E=[];try{var T;E=filter(T=t.msgs).call(T,(function(t){return u.lastMessageFilterFn(JSON.parse(Pn(t)))}))}catch(t){this.logger.error("session:onSyncMsgs, lastMessageFilterFn error ",t)}E&&E.length>0&&(_=E[E.length-1],_=E[0].time>_.time?E[0]:_);var S=_?_.time:0;m||(m=_?this.createSession(t.sessionId,_):this.createSession(t.sessionId)),m.unreadMsgs=m.unreadMsgs?filter(a=concat(g).call(g,m.unreadMsgs)).call(a,(function(t){return t.status===Ud[Ud.unread]})):filter(g).call(g,(function(t){return t.status===Ud[Ud.unread]})),m.updateTime&&m.updateTime>=S||(m.updateTime=S),m.lastMsg&&m.lastMsg.time>=S||(m.lastMsg=_),this.list.set(m.id,m)},a.updateSessionForDeletedMsg=function updateSessionForDeletedMsg(t){var a,u=this,m={};forEach$1(t).call(t,(function(t){var a,g=t.to===u.core.account?t.from:t.to,h=t.scene+"-"+g,_=u.list.get(h);if(_){var E=some(a=_.unreadMsgs).call(a,(function(a){return a.idClient===t.idClient})),T=!0;try{T=!!u.unreadCountFilterFn(t)}catch(t){u.logger.error("session:updateSessionForDeletedMsg, unreadCountFilterFn error",t)}var S=_.ack||0;if(T&&E&&S<t.time&&t.from!==u.core.account&&_.unread>0&&(_.unread=_.unread-1,_.unreadMsgs&&_.unreadMsgs.length>0)){var M,I=function findIndex(t,a){t=t||[],a=a||{};for(var u=0;u<t.length;u++){var m=!0;for(var g in a)if(t[u][g]!==a[g]){m=!1;break}if(m)return u}return-1}(_.unreadMsgs,{idClient:t.idClient});I>=0&&splice(M=_.unreadMsgs).call(M,I,1)}_.lastMsg&&_.lastMsg.idClient===t.idClient&&(_.lastMsg=null),m[_.id]=!0}})),forEach$1(a=Bt(m)).call(a,(function(t){var a=u.list.get(t);a&&u.core.emit("updateSession",a)}))},a.multiSyncMsgReceiptHandler=function multiSyncMsgReceiptHandler(t){var a,u=null===(a=t.content)||void 0===a?void 0:a.msgReceiptTag;if(u){this.updateSessionMsgReceiptTime([u],!0),u.msgReceiptTime=u.time,u.sessionId="p2p-"+u.from,u.time,u.from;var m=__rest(u,["time","from"]);this.core.emit("msgReceipts",[m])}},a.syncMsgReceiptsHandler=function syncMsgReceiptsHandler(t){var a,u=null===(a=t.content)||void 0===a?void 0:a.msgReceipts;u&&this.updateSessionMsgReceiptTime(u,!1)},a.updateSessionMsgReceiptTime=function updateSessionMsgReceiptTime(t,a){var u=this;void 0===a&&(a=!0),t&&t.length>0&&forEach$1(t).call(t,(function(t){var m=u.list.get("p2p-"+t.from);m||(m=u.createSession("p2p-"+t.from));var g=Cu(t.time);m.msgReceiptTime&&m.msgReceiptTime>=g||(m.msgReceiptTime=g,m.lastMsg&&"sent"===m.lastMsg.status&&g>=m.lastMsg.time&&(m.lastMsg.status="receipt"),u.logger.log("session: update session "+m.id+" msgReceiptTime: "+m.msgReceiptTime),u.list.set(m.id,m),a&&u.core.emit("updateSession",m))}))},SessionService}(ip),mm=function(){function ModuleService(t){this.core=t}var t=ModuleService.prototype;return t.notifyAddTeamMembers=function notifyAddTeamMembers(t,a){this.core.emit("addTeamMembers",{team:t,accounts:a,members:generatorMembersByTeam(t,a)})},t.notifyUpdateTeamManagers=function notifyUpdateTeamManagers(t,a,u,m){this.core.emit("updateTeamManagers",{team:{teamId:t,memberUpdateTime:m},accounts:a,isManager:u,members:map$6(a).call(a,(function(a){return{id:t+"-"+a,account:a,type:u?"manager":"normal",updateTime:m}}))})},t.notifyRemoveTeamMembers=function notifyRemoveTeamMembers(t,a){this.core.emit("removeTeamMembers",{team:t,accounts:a})},t.notifyTransferTeam=function notifyTransferTeam(t,a,u){this.core.emit("transferTeam",{team:t,from:{id:t.teamId+"-"+a,type:"normal",account:a,updateTime:t.memberUpdateTime},to:{id:t.teamId+"-"+u,type:"owner",account:u,updateTime:t.memberUpdateTime}})},t.notifyUpdateTeamMembersMute=function notifyUpdateTeamMembersMute(t,a,u){this.core.emit("updateTeamMembersMute",{team:t,accounts:a,members:map$6(a).call(a,(function(a){return{id:t.teamId+"-"+a,account:a,teamId:t.teamId,mute:u,updateTime:t.memberUpdateTime}})),mute:u})},ModuleService}();function cloneDeep(t,a){if((a=new pc).get(t))return t;if(t instanceof RegExp)return new RegExp(t);if(t instanceof Date)return new Date(t.getTime());if(Ln(t))return a.set(t,!0),map$6(t).call(t,(function(t){return cloneDeep(t,a)}));if("object"==typeof t&&null!==t){var u;a.set(t,!0);var m={};return forEach$1(u=Bt(t)).call(u,(function(u){m[u]=cloneDeep(t[u],a)})),m}return t}var gm=function(t){function TeamService(a){var u;return(u=t.call(this,"team",a)||this).myTeamMembersMap=new pc,u.service=new mm(a),u.setListeners(),registerParser({cmdMap:Rp,cmdConfig:kp}),u}Ct(TeamService,t);var a=TeamService.prototype;return a.setListeners=function setListeners(){var t=this;this.core.eventBus.on("forwardReceive/team/updateMyMemberInfo",(function(a){t.emitMemberUpdate(a)})),this.core.eventBus.on("team/onNotification",(function(a){return t.notificationHandler(a)}))},a.reset=function reset(){this.myTeamMembersMap.clear()},a.mergeMyTeamMembers=function mergeMyTeamMembers(t){var a=this;forEach$1(t).call(t,(function(t){var u=t.teamId,m=a.myTeamMembersMap.get(u),g=Lt({},m,t);a.myTeamMembersMap.set(u,g)}))},a.getTeamInfo=function getTeamInfo(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u;return Zl.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),m.next=3,this.core.sendCmd("getTeamInfo",{teamId:t.teamId});case 3:return a=m.sent,u=a.content.team,m.abrupt("return",formatTeam(u));case 6:case"end":return m.stop()}}),_callee,this)})))},a.getTeams=function getTeams(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var t,a;return Zl.wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.core.sendCmd("getTeams",{timetag:0});case 2:return t=u.sent,a=t.content.teams,u.abrupt("return",formatTeams(a));case 5:case"end":return u.stop()}}),_callee2,this)})))},a.getTeamsById=function getTeamsById(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var a,u;return Zl.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamIds:{type:"array",itemType:"string"}},t),m.next=3,this.core.sendCmd("getTeamsById",{teamIds:t.teamIds});case 3:return a=m.sent,u=formatTeams(a.content.teams),m.abrupt("return",{teams:u,tids:a.content.tids});case 6:case"end":return m.stop()}}),_callee3,this)})))},a.createTeam=function createTeam(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){var a,u,m;return Zl.wrap((function _callee4$(g){for(;;)switch(g.prev=g.next){case 0:return validate({type:{type:"enum",values:["advanced","normal"]},name:{type:"string",allowEmpty:!1},level:{type:"number",required:!1},accounts:{type:"array",itemType:"string",required:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},t),a=generateTeam(t),g.next=4,this.core.sendCmd("createTeam",{team:a,accounts:t.accounts||[],ps:t.ps||""});case 4:return u=g.sent,m=formatTeam(u.content.team),this.core.eventBus.emit("forwardSend/team/created",m),g.abrupt("return",m);case 8:case"end":return g.stop()}}),_callee4,this)})))},a.dismissTeam=function dismissTeam(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){return Zl.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("dismissTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee5,this)})))},a.leaveTeam=function leaveTeam(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee6(){return Zl.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("leaveTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee6,this)})))},a.transferTeam=function transferTeam(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee7(){return Zl.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},t),a.next=3,this.core.sendCmd("transferTeam",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.updateTeamInfo=function updateTeamInfo(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee8(){var a;return Zl.wrap((function _callee8$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},t),a=generateTeam(t),u.next=4,this.core.sendCmd("updateTeamInfo",{team:a});case 4:return u.abrupt("return",formatTeam(a));case 5:case"end":return u.stop()}}),_callee8,this)})))},a.getTeamMembers=function getTeamMembers(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee9(){var u,m;return Zl.wrap((function _callee9$(g){for(;;)switch(g.prev=g.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",required:!1}},t),g.next=3,this.core.sendCmd("getTeamMembers",{teamId:t.teamId,timetag:0});case 3:if(u=g.sent,m=formatTeamMembers(null===(a=u.content)||void 0===a?void 0:a.teamMembers),t.accounts&&t.accounts.length>0){g.next=7;break}return g.abrupt("return",m);case 7:return g.abrupt("return",filter(m).call(m,(function(a){var u;return null===(u=t.accounts)||void 0===u?void 0:includes(u).call(u,a.account)})));case 8:case"end":return g.stop()}}),_callee9,this)})))},a.getMutedTeamMembers=function getMutedTeamMembers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee10(){var a,u;return Zl.wrap((function _callee10$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),m.next=3,this.core.sendCmd("getMutedTeamMembers",{teamId:t.teamId});case 3:return a=m.sent,u=a.content,m.abrupt("return",formatTeamMembers(u.teamMembers));case 6:case"end":return m.stop()}}),_callee10,this)})))},a.addTeamMembers=function addTeamMembers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee11(){return Zl.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("addTeamMembers",{teamId:t.teamId,accounts:t.accounts,ps:t.ps||"",attach:t.ext||""});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.removeTeamMembers=function removeTeamMembers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee12(){return Zl.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("removeTeamMembers",{teamId:t.teamId,accounts:t.accounts});case 3:case"end":return a.stop()}}),_callee12,this)})))},a.applyTeam=function applyTeam(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee13(){var a;return Zl.wrap((function _callee13$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),u.next=3,this.core.sendCmd("applyTeam",{teamId:t.teamId,ps:t.ps||""});case 3:return a=u.sent,u.abrupt("return",formatTeam(a.content.team));case 5:case"end":return u.stop()}}),_callee13,this)})))},a.addTeamManagers=function addTeamManagers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee14(){return Zl.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("addTeamManagers",t);case 3:case"end":return a.stop()}}),_callee14,this)})))},a.removeTeamManagers=function removeTeamManagers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee15(){return Zl.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("removeTeamManagers",t);case 3:case"end":return a.stop()}}),_callee15,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee16(){var a,u,m;return Zl.wrap((function _callee16$(g){for(;;)switch(g.prev=g.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},t),a=generatorTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,bitConfigMask:t.bitConfigMask,ext:t.ext}),g.next=4,this.core.sendCmd("updateMyMemberInfo",{teamMember:a});case 4:return u=formatTeamMember(Lt({updateTime:(new Date).getTime(),account:this.core.account},a)),m=this.emitMemberUpdate(u),this.core.eventBus.emit("forwardSend/team/updateMyMemberInfo",m),g.abrupt("return",u);case 8:case"end":return g.stop()}}),_callee16,this)})))},a.emitMemberUpdate=function emitMemberUpdate(t){t=formatTeamMember(t),this.mergeMyTeamMembers([t]),this.core.emit("updateTeamMember",t);var a=cloneDeep(this.myTeamMembersMap.get(t.teamId));return this.core.emit("myTeamMembers",[a]),a},a.updateMemberNick=function updateMemberNick(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee17(){var a,u;return Zl.wrap((function _callee17$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},t),a=generatorTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,account:t.account}),m.next=4,this.core.sendCmd("updateNickInTeam",{teamMember:a});case 4:return u=formatTeamMember(Lt({updateTime:(new Date).getTime()},a)),m.abrupt("return",u);case 6:case"end":return m.stop()}}),_callee17,this)})))},a.muteTeamMember=function muteTeamMember(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee18(){return Zl.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteTeamMember",{teamId:t.teamId,account:t.account,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee18,this)})))},a.getTeamMemberInvitorAccid=function getTeamMemberInvitorAccid(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee19(){var u,m;return Zl.wrap((function _callee19$(g){for(;;)switch(g.prev=g.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:200}},t),u={teamId:t.teamId},t.accounts&&t.accounts.length>0&&(u.accounts=t.accounts),g.next=5,this.core.sendCmd("getTeamMemberInvitorAccid",u);case 5:return m=g.sent,g.abrupt("return",(null===(a=m.content)||void 0===a?void 0:a.accountsMap)||{});case 7:case"end":return g.stop()}}),_callee19,this)})))},a.muteTeam=function muteTeam(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee20(){return Zl.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteTeam",{teamId:t.teamId,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.passTeamApply=function passTeamApply(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee21(){var a;return Zl.wrap((function _callee21$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),u.prev=1,u.next=4,this.core.sendCmd("passTeamApply",t);case 4:this.core.eventBus.emit("forwardSend/team/passTeamApply",t),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),a=u.t0,this.core.eventBus.emit("forwardSend/team/passTeamApply",t,null==a?void 0:a.code),u.t0;case 12:case"end":return u.stop()}}),_callee21,this,[[1,7]])})))},a.rejectTeamApply=function rejectTeamApply(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee22(){var a;return Zl.wrap((function _callee22$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),u.prev=1,u.next=4,this.core.sendCmd("rejectTeamApply",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamApply",t),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),a=u.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamApply",t,null==a?void 0:a.code),u.t0;case 12:case"end":return u.stop()}}),_callee22,this,[[1,7]])})))},a.acceptTeamInvite=function acceptTeamInvite(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee23(){var a;return Zl.wrap((function _callee23$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),u.prev=1,u.next=4,this.core.sendCmd("acceptTeamInvite",t);case 4:this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",t),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),a=u.t0,this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",t,null==a?void 0:a.code),u.t0;case 12:case"end":return u.stop()}}),_callee23,this,[[1,7]])})))},a.rejectTeamInvite=function rejectTeamInvite(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee24(){var a;return Zl.wrap((function _callee24$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),u.prev=1,u.next=4,this.core.sendCmd("rejectTeamInvite",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",t),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),a=u.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",t,null==a?void 0:a.code),u.t0;case 12:case"end":return u.stop()}}),_callee24,this,[[1,7]])})))},a.notifyTeamMsgReceiptsHandler=function notifyTeamMsgReceiptsHandler(t){var a,u=null===(a=t.content)||void 0===a?void 0:a.teamMsgReceipts;u&&u.length>0&&(this.core.emit("teamMsgReceipts",u),this.core.emit("msgReceipts",u))},a.syncTeamsHandler=function syncTeamsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{teams:Cu(a.timetag)});var u=null==a?void 0:a.teams;if(u&&u.length){var m=formatTeams(u);this.core.emit("teams",m)}},a.syncCreateTeamHandler=function syncCreateTeamHandler(t){var a=t.content,u=formatTeam(null==a?void 0:a.team),m=generatorMemberByTeam(u,u.owner,"owner");this.core.emit("createTeam",u,m)},a.syncUpdateTeamMemberHandler=function syncUpdateTeamMemberHandler(t){var a=t.content,u=formatTeamMember(null==a?void 0:a.teamMember);u.updateTime||(u.updateTime=(new Date).getTime()),this.mergeMyTeamMembers([u]),this.core.emit("updateTeamMember",u);var m=cloneDeep(this.myTeamMembersMap.get(u.teamId));this.core.emit("myTeamMembers",[m])},a.syncMyTeamMembersHandler=function syncMyTeamMembersHandler(t){var a,u=t.content;this.core.eventBus.emit("sync/updateTimetag",{myTeamMembers:Cu(u.timetag)});var m=null==u?void 0:map$6(a=u.teamMembers).call(a,(function(t){return formatTeamMember(t)}));this.mergeMyTeamMembers(m),this.core.emit("myTeamMembers",cloneDeep(m))},a.notificationHandler=function notificationHandler(t){var a=t.attach,u=t.scene,m=t.from,g=t.to,h=t.time,_=t.idServer,E=t.idClient,T=a.team,S=a.account,M=a.accounts,I=a.type;if("team"===u)switch(this.logger.getDebugMode()?this.logger.debug("team::recvNotification",_,E,a):this.logger.log("team::recvNotification",_,E,g,I,S,M),I){case"updateTeam":T.updateTime=h,this.core.emit("updateTeam",T);break;case"addTeamMembers":this.service.notifyAddTeamMembers(T,M);break;case"acceptTeamInvite":this.service.notifyAddTeamMembers(T,[m]);break;case"passTeamApply":this.service.notifyAddTeamMembers(T,[S]);break;case"addTeamManagers":this.service.notifyUpdateTeamManagers(g,M,!0,h);break;case"removeTeamManagers":this.service.notifyUpdateTeamManagers(g,M,!1,h);break;case"removeTeamMembers":this.service.notifyRemoveTeamMembers(T,M);break;case"leaveTeam":this.service.notifyRemoveTeamMembers(T,[m]);break;case"dismissTeam":this.core.emit("dismissTeam",{teamId:g});break;case"transferTeam":this.service.notifyTransferTeam(T,m,S);break;case"updateTeamMemberMute":this.service.notifyUpdateTeamMembersMute(T,[S],a.mute)}},TeamService}(ip),fm={"4_6":"syncOfflineSysMsgs","4_18":"syncOfflineSysMsgs","4_19":"syncRecallMsgOfflineAndRoaming","7_3":"onSysMsg","7_7":"sendCustomSysMsg","7_14":"onRecallMsg","21_18":"onRecallMsg","21_117":"onRecallMsg","7_15":"syncRecallMsgOfflineAndRoaming","21_19":"onSysMsg","21_16":"sendSuperTeamCustomSysMsg"},hm={sysMsg:Lt({time:0,type:1,to:2,from:3,content:4,attach:5,idServer:6,needSaveOffline:7,deletedIdClient:10,deletedIdServer:11,needcAntiSpam:12,antiSpamContent:13,deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,envConfig:21,callbackExt:22,isRoutable:105},Kp)},_m=invertSerializeMap(hm),vm={onSysMsg:{service:"systemMessage",sid:7,cid:3,response:[{type:"Property",name:"sysMsg",reflectMapper:_m.sysMsg}]},sendCustomSysMsg:{service:"systemMessage",sid:7,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:hm.sysMsg}]},sendSuperTeamCustomSysMsg:{service:"systemMessage",sid:21,cid:16,params:[{type:"Property",name:"sysMsg",reflectMapper:hm.sysMsg}]},sendFilterCustomSysMsg:{service:"systemMessage",sid:101,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:hm.sysMsg}]},batchMarkRead:{service:"systemMessage",sid:4,cid:5,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},onRecallMsg:{sid:7,cid:14,service:"systemMessage",response:[{type:"Property",name:"sysMsg",reflectMapper:_m.sysMsg}]},syncRecallMsgOfflineAndRoaming:{sid:7,cid:15,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:_m.sysMsg},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]},syncOfflineSysMsgs:{sid:4,cid:9,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:_m.sysMsg}]}},ym=function(t){function SystemMessageService(a){var u;return(u=t.call(this,"systemMessage",a)||this).sysMsgUnread={total:0,friend:0,msg:0,team:0,superTeam:0},u.core.eventBus.on("logined",(function(){u.initEventListeners()})),registerParser({cmdMap:fm,cmdConfig:vm}),u}Ct(SystemMessageService,t);var a=SystemMessageService.prototype;return a.initEventListeners=function initEventListeners(){var t=this;this.core.eventBus.on("systemMessage/passFriendApply",(function(a){t.core.emit("updateSystemMessages",[{idServer:a.idServer,from:a.account,state:"pass",type:"friendRequest"}])})),this.core.eventBus.on("systemMessage/rejectFriendApply",(function(a){t.core.emit("updateSystemMessages",[{idServer:a.idServer,from:a.account,state:"decline",type:"friendRequest"}])}))},a.doMarkSysMsgAck=function doMarkSysMsgAck(t){var a=[],u=[],m=["customSuperTeam"];forEach$1(t).call(t,(function(t){t.idServer&&(includes(m).call(m,t.type)?u.push(t.idServer):a.push(t.idServer))})),a.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:a}),u.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:u})},a.sendCustomSysMsg=function sendCustomSysMsg(t){var a=this;validate({to:{type:"string",allowEmpty:!1},type:{type:"enum",values:["customP2p","customTeam","customSuperTeam"]},attach:{type:"string",allowEmpty:!1},setting:{type:"object",rules:{needSaveOffline:{type:"boolean",required:!1},env:{type:"string",allowEmpty:!1,required:!1}},required:!1},pushInfo:{type:"object",required:!1,rules:Yp}},t);var u="customSuperTeam"===t.type?"sendSuperTeamCustomSysMsg":"sendCustomSysMsg";return this.core.sendCmd(u,{sysMsg:generatorSysMsgForCmd(t)}).then((function(){a.logger.log("sendCustomSysMsg success")})).catch((function(t){throw a.logger.error("sendCustomSysMsg failed",t.message),t}))},a.onSysMsgHandler=function onSysMsgHandler(t){var a,u=null===(a=t.content)||void 0===a?void 0:a.sysMsg;if(u){var m=formatSystemMessage(u=fillIdServer(t,t.content.sysMsg,"idServer"),this.logger,Hp.default);this.core.emit("sysMsg",m),this.doMarkSysMsgAck([m])}else this.logger.warn("onSysMsg no content.sysMsg")},a.syncOfflineSysMsgsHandler=function syncOfflineSysMsgsHandler(t){var a,u=this;if(t.content.sysMsgs&&t.content.sysMsgs.length>0){var m=map$6(a=t.content.sysMsgs).call(a,(function(t){return formatSystemMessage(t,u.logger,Hp.leave)}));this.core.emit("syncSysMsgs",m),this.doMarkSysMsgAck(m)}},a.onRecallMsgHandler=function onRecallMsgHandler(t){var a,u=null===(a=t.content)||void 0===a?void 0:a.sysMsg;if(u){var m=formatDeletedMsgs([u=fillIdServer(t,t.content.sysMsg,"idServer")],getSceneFromRecallSysMsg(+u.type));this.core.eventBus.emit("session/updateForDeletedMsg",m);var g=formatSystemMessage(u,this.logger,Hp.default);this.core.emit("sysMsg",g),this.doMarkSysMsgAck([g])}else this.logger.warn("onSysMsg no content.sysMsg")},a.syncRecallMsgOfflineAndRoamingHandler=function syncRecallMsgOfflineAndRoamingHandler(t){var a=this,u=t.content,m=u.timetag,g=u.type,h=u.sysMsgs,_=Cu(g),E=1===_?Hp.leave:Hp.roam,T=map$6(h).call(h,(function(t){return formatSystemMessage(t,a.logger,E)}));1===_&&this.doMarkSysMsgAck(T),this.core.eventBus.emit("sync/updateTimetag",{recallMsg:m}),this.core.emit("syncSysMsgs",T)},SystemMessageService}(ip);function reverseFriend(t){var a=["bitsExtension","createTime","updateTime","passRelationShip","relationShip","source"],u=Lt({},t);return forEach$1(a).call(a,(function(t){void 0!==u[t]&&(u[t]=Cu(u[t]))})),void 0!==u.relationShip&&(u.valid=1===u.relationShip),u}var Em={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};var Tm={"12_4":"getFriends","12_1":"friendReuqest","12_2":"deleteFriend","12_3":"updateFriend","12_5":"syncFriends","12_6":"syncFriendUsers","12_101":"syncFriendRequest","12_102":"syncDeleteFriend","12_103":"syncUpdateFriend"},Sm={updateFriendTag:{account:4,alias:8,ext:10},delFriendParams:{delAlias:1},friendTag:{account:4,relationShip:5,passRelationShip:6,source:7,alias:8,bitsExtension:9,ext:10,createTime:11,updateTime:12,serverex:13},userTag:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13}},Mm=invertSerializeMap(Sm),Im={getFriends:{sid:12,cid:4,service:"friend",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:Mm.friendTag},{type:"Long",name:"timetag"}]},friendReuqest:{sid:12,cid:1,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:12,cid:2,service:"friend",params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams",reflectMapper:Sm.delFriendParams}]},updateFriend:{sid:12,cid:3,service:"friend",params:[{type:"Property",name:"updateFriendTag",reflectMapper:Sm.updateFriendTag}]},syncFriends:{sid:12,cid:5,service:"friend",response:[{type:"PropertyArray",name:"friends",entity:"friendTag",reflectMapper:Mm.friendTag},{type:"Long",name:"timetag"}]},syncFriendUsers:{sid:12,cid:6,service:"friend",response:[{type:"PropertyArray",name:"users",entity:"userTag",reflectMapper:Mm.userTag},{type:"Long",name:"timetag"}]},syncFriendRequest:{sid:12,cid:101,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}],response:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},syncDeleteFriend:{sid:12,cid:102,service:"friend",response:[{type:"String",name:"account"}]},syncUpdateFriend:{sid:12,cid:103,service:"friend",response:[{type:"Property",name:"friend",reflectMapper:Mm.friendTag}]}},Am=function(t){function FriendService(a){var u;return u=t.call(this,"friend",a)||this,registerParser({cmdMap:Tm,cmdConfig:Im}),u}Ct(FriendService,t);var a=FriendService.prototype;return a.getFriends=function getFriends(){var t;return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u;return Zl.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("getFriends",{timetag:0});case 2:return a=m.sent,u=(null===(t=a.content)||void 0===t?void 0:t.friends)||[],u=map$6(u).call(u,(function(t){return reverseFriend(t)})),m.abrupt("return",u);case 6:case"end":return m.stop()}}),_callee,this)})))},a.addFriend=function addFriend(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a;return Zl.wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:return validate({account:{type:"string",allowEmpty:!1},ps:{type:"string",allowEmpty:!1,required:!1}},t),u.next=3,this.core.sendCmd("friendReuqest",{account:t.account,type:1,ps:t.ps||""});case 3:return a=(new Date).getTime(),this.core.eventBus.emit("forwardSend/friend/addFriend",t.account),u.abrupt("return",{account:t.account,createTime:a,updateTime:a,valid:!0,source:0,passRelationShip:1,relationShip:1,bitsExtension:0});case 6:case"end":return u.stop()}}),_callee2,this)})))},a.applyFriend=function applyFriend(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){return Zl.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("friendReuqest",{account:t.account,type:2,ps:t.ps||""});case 3:case"end":return a.stop()}}),_callee3,this)})))},a.passFriendApply=function passFriendApply(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){var a=this;return Zl.wrap((function _callee4$(u){for(;;)switch(u.prev=u.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),u.prev=1,u.next=4,this.core.sendCmd("friendReuqest",{account:t.account,type:3,ps:t.ps||""}).then((function(u){return a.core.eventBus.emit("systemMessage/passFriendApply",t),u}));case 4:this.core.eventBus.emit("forwardSend/friend/passFriendApply",t.account),u.next=11;break;case 7:throw u.prev=7,u.t0=u.catch(1),this.core.eventBus.emit("forwardSend/friend/passFriendApply",t.account,u.t0),u.t0;case 11:case"end":return u.stop()}}),_callee4,this,[[1,7]])})))},a.rejectFriendApply=function rejectFriendApply(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){var a=this;return Zl.wrap((function _callee5$(u){for(;;)switch(u.prev=u.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),u.prev=1,u.next=4,this.core.sendCmd("friendReuqest",{account:t.account,type:4,ps:t.ps||""}).then((function(u){return a.core.eventBus.emit("systemMessage/rejectFriendApply",t),u}));case 4:this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",t.account,t.ps),u.next=11;break;case 7:throw u.prev=7,u.t0=u.catch(1),this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",t.account,t.ps,u.t0),u.t0;case 11:case"end":return u.stop()}}),_callee5,this,[[1,7]])})))},a.deleteFriend=function deleteFriend(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee6(){return Zl.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},delAlias:{type:"boolean"}},t),a.next=3,this.core.sendCmd("deleteFriend",{account:t.account,delFriendParams:{delAlias:!0===t.delAlias?1:0}});case 3:this.core.eventBus.emit("forwardSend/friend/deleteFriend",t.account);case 4:case"end":return a.stop()}}),_callee6,this)})))},a.updateFriend=function updateFriend(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee7(){return Zl.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},alias:{type:"string"},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("updateFriend",{updateFriendTag:t});case 3:this.core.eventBus.emit("forwardSend/friend/updateFriend",t);case 4:case"end":return a.stop()}}),_callee7,this)})))},a.syncFriendRequestHandler=function syncFriendRequestHandler(t){var a=function formatFriendRequest(t){var a=Lt({},t);try{a.ps=a.ps&&JSON.parse(a.ps)}catch(t){}if(a.type=Em[a.type],"addFriend"===a.type||"passFriendApply"===a.type){var u=(new Date).getTime();a.friend={account:t.account,alias:"",createTime:u,ext:"",updateTime:u,valid:!0}}return a}(t.content);this.core.emit("syncFriend",a)},a.syncDeleteFriendHandler=function syncDeleteFriendHandler(t){var a=t.content.account;this.logger.log("friend::emit syncFriendAction: deleteFriend "+a),this.core.emit("syncFriend",{type:"deleteFriend",account:a})},a.syncUpdateFriendHandler=function syncUpdateFriendHandler(t){var a=reverseFriend(t.content.friend);this.logger.log("friend::emit syncFriendAction: updateFriend, ",null==a?void 0:a.account),this.core.emit("syncFriend",{type:"updateFriend",friend:a})},a.syncFriendsHandler=function syncFriendsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{friends:Cu(a.timetag)});var u=null==a?void 0:a.friends;if(u&&u.length){var m=map$6(u).call(u,(function(t){return reverseFriend(t)}));this.core.emit("friends",m)}},a.syncFriendUsersHandler=function syncFriendUsersHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{friendUsers:Cu(a.timetag)});var u=null==a?void 0:a.users;if(u&&u.length){var m=map$6(u).call(u,(function(t){return formatUser(t)}));this.core.emit("users",m)}},FriendService}(ip);function formatSubscribes(t){return t&&t.length>0?map$6(t).call(t,(function(t){return function formatSubscribe(t){var a=Lt({},t),u=["subscribeTime","time"];return forEach$1(u).call(u,(function(t){a[t]&&(a[t]=Cu(a[t]))})),a}(t)})):[]}function formatEvent(t){if(!t)return t;var a=t.serverExt,u=__rest(t,["serverExt"]),m=["time","type","value"];if(forEach$1(m).call(m,(function(t){u[t]&&(u[t]=Cu(u[t]))})),u.clientType&&(u.clientType=getEnumKeyByEnumValue(Vd,u.clientType)||""),a)try{u.ext=JSON.parse(a),"string"==typeof u.ext[0]&&(u.ext=u.ext[0])}catch(t){}return u}var bm={"14_1":"publishEvent","14_2":"pushEvent","14_3":"subscribeEvent","14_4":"unSubscribeEventsByAccounts","14_5":"unSubscribeEventsByType","14_6":"querySubscribeEventsByAccounts","14_7":"querySubscribeEventsByType","14_9":"pushEvents"},Nm={msgEvent:{type:1,value:2,idClient:3,ext:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverExt:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105}},Cm=invertSerializeMap(Nm),Rm={publishEvent:{sid:14,cid:1,service:"event",params:[{type:"Property",name:"msgEvent",reflectMapper:Nm.msgEvent}],response:[{type:"Property",name:"msgEvent",reflectMapper:Cm.msgEvent}]},pushEvent:{sid:14,cid:2,service:"event",response:[{type:"Property",name:"msgEvent",reflectMapper:Cm.msgEvent}]},subscribeEvent:{sid:14,cid:3,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Nm.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:14,cid:4,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Nm.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:14,cid:5,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Nm.msgEventSubscribe}]},querySubscribeEventsByAccounts:{sid:14,cid:6,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Nm.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Cm.msgEventSubscribe}]},querySubscribeEventsByType:{sid:14,cid:7,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Nm.msgEventSubscribe}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Cm.msgEventSubscribe}]},pushEvents:{sid:14,cid:9,service:"event",response:[{type:"PropertyArray",name:"msgEvents",reflectMapper:Cm.msgEvent}]}},Om=function(t){function EventService(a){var u;return u=t.call(this,"event",a)||this,registerParser({cmdMap:bm,cmdConfig:Rm}),u}Ct(EventService,t);var a=EventService.prototype;return a.publishEvent=function publishEvent(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var u,m,g;return Zl.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return validate({type:{type:"number"},value:{type:"number"},ext:{type:"string",required:!1},validTime:{type:"number",min:60,max:2592e3,required:!1},broadcastType:{type:"number",required:!1},sync:{type:"boolean",required:!1}},t),u=Lt(Lt({validTime:t.validTime||604800,broadcastType:t.broadcastType||2},t),{idClient:Ou(),sync:!0===t.sync?1:0}),h.next=4,this.core.sendCmd("publishEvent",{msgEvent:u});case 4:return m=h.sent,g=(null===(a=m.content)||void 0===a?void 0:a.msgEvent)||{},h.abrupt("return",formatEvent(g));case 7:case"end":return h.stop()}}),_callee,this)})))},a.subscribeEvent=function subscribeEvent(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var u,m,g;return Zl.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100},subscribeTime:{type:"number",min:60,max:2592e3,required:!1}},t),u=Lt(Lt({subscribeTime:2592e3},t),{sync:!0===t.sync?1:0}),h.next=4,this.core.sendCmd("subscribeEvent",{msgEventSubscribe:u,accounts:t.accounts});case 4:return m=h.sent,g=(null===(a=m.content)||void 0===a?void 0:a.accounts)||[],h.abrupt("return",{failedAccounts:g});case 7:case"end":return h.stop()}}),_callee2,this)})))},a.unSubscribeEvents=function unSubscribeEvents(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var u,m,g;return Zl.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},t),u={type:t.type},!(t.accounts&&t.accounts.length>0)){h.next=9;break}return h.next=5,this.core.sendCmd("unSubscribeEventsByAccounts",{msgEventSubscribe:u,accounts:t.accounts});case 5:g=h.sent,m=(null===(a=g.content)||void 0===a?void 0:a.accounts)||[],h.next=12;break;case 9:return h.next=11,this.core.sendCmd("unSubscribeEventsByType",{msgEventSubscribe:u});case 11:m=[];case 12:return h.abrupt("return",{failedAccounts:m});case 13:case"end":return h.stop()}}),_callee3,this)})))},a.querySubscribeEvents=function querySubscribeEvents(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){var u;return Zl.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},t),!(t.accounts&&t.accounts.length>0)){m.next=7;break}return m.next=4,this.core.sendCmd("querySubscribeEventsByAccounts",{msgEventSubscribe:{type:t.type},accounts:t.accounts});case 4:u=m.sent,m.next=10;break;case 7:return m.next=9,this.core.sendCmd("querySubscribeEventsByType",{msgEventSubscribe:{type:t.type}});case 9:u=m.sent;case 10:return m.abrupt("return",formatSubscribes(null===(a=u.content)||void 0===a?void 0:a.msgEventSubscribes));case 11:case"end":return m.stop()}}),_callee4,this)})))},a.pushEventHandler=function pushEventHandler(t){var a,u=(null===(a=t.content)||void 0===a?void 0:a.msgEvent)||{};this.core.emit("pushEvents",[formatEvent(u)])},a.pushEventsHandler=function pushEventsHandler(t){var a,u=(null===(a=t.content)||void 0===a?void 0:a.msgEvents)||{};this.core.emit("pushEvents",function formatEvents(t){return Ln(t)&&t.length>0?map$6(t).call(t,(function(t){return formatEvent(t)})):[]}(u))},EventService}(ip);function generateThreadMsgsParams(t){var a={scene:Dd[t.scene],from:t.threadMsgFromAccount,to:t.threadMsgToAccount,time:t.threadMsgTime,idServer:t.threadMsgIdServer},u={limit:t.limit<100?t.limit:100,beginTime:"number"==typeof t.beginTime?t.beginTime:0,reverse:!0===reverse$1(t)?1:0};return t.lastMsgId&&(u.lastMsgId=t.lastMsgId),{msg:a,threadMsgReq:u}}var wm,km={"23_1":"getThreadMsgs","23_2":"getMsgsByIdServer"},xm={msg:$p,threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2}},Pm=invertSerializeMap(xm),Lm={getThreadMsgs:{sid:23,cid:1,service:"msgExtend",params:[{type:"Property",name:"msg",reflectMapper:xm.msg},{type:"Property",name:"threadMsgReq",reflectMapper:xm.threadMsgReq}],response:[{type:"Property",name:"threadMsg",reflectMapper:Pm.msg},{type:"Property",name:"threadMsgsMeta",reflectMapper:Pm.threadMsgsMeta},{type:"PropertyArray",name:"msgs",reflectMapper:Pm.msg}]},getMsgsByIdServer:{sid:23,cid:2,service:"msgExtend",params:[{type:"PropertyArray",name:"reqMsgs",reflectMapper:xm.msg}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Pm.msg}]}},Dm=function(t){function MsgExtendService(a){var u;return u=t.call(this,"msgExtend",a)||this,registerParser({cmdMap:km,cmdConfig:Lm}),u}Ct(MsgExtendService,t);var a=MsgExtendService.prototype;return a.getThreadMsgs=function getThreadMsgs(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var u,m,g,h,_,E,T;return Zl.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return validate({scene:{type:"enum",values:getEnumKeys(Dd)},threadMsgFromAccount:{type:"string",allowEmpty:!1},threadMsgIdServer:{type:"string",allowEmpty:!1},threadMsgTime:{type:"number"},threadMsgToAccount:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},lastMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1}},t),S.next=3,this.core.sendCmd("getThreadMsgs",generateThreadMsgsParams(t));case 3:return u=S.sent,m=u.content,g=m.msgs,h=m.threadMsg,_=u.content.threadMsgsMeta,E=getSessionId(h,this.core.account),T=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:E}),g=formatMsgs(g,T?{account:this.core.account,sessionAck:T.ack,msgReceiptTime:T.msgReceiptTime}:{account:this.core.account}),h=formatMsg(h,T?{account:this.core.account,sessionAck:T.ack,msgReceiptTime:T.msgReceiptTime}:{account:this.core.account}),S.abrupt("return",{msgs:g,threadMsg:h,total:Cu(_.total),timetag:Cu(_.lastMsgTime)});case 11:case"end":return S.stop()}}),_callee,this)})))},a.getMsgsByIdServer=function getMsgsByIdServer(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a,u,m,g,h=this;return Zl.wrap((function _callee2$(_){for(;;)switch(_.prev=_.next){case 0:return validate({reqMsgs:{type:"array",rules:{scene:{type:"enum",values:getEnumKeys(Dd)},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},time:{type:"number"}},min:1,max:100}},t),_.next=3,this.core.sendCmd("getMsgsByIdServer",{reqMsgs:map$6(a=t.reqMsgs).call(a,(function(t){return Lt(Lt({},t),{scene:getEnumKeyByEnumValue(Dd,t.scene)})}))});case 3:return m=_.sent,g=map$6(u=m.content.msgs).call(u,(function(t){var a,u=getSessionId(t,h.core.account),m=null===(a=h.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:u});return formatMsg(t,m?{account:h.core.account,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:h.core.account})})),_.abrupt("return",g);case 6:case"end":return _.stop()}}),_callee2,this)})))},MsgExtendService}(ip);!function(t){t[t.ASC=1]="ASC",t[t.DESC=2]="DESC"}(wm||(wm={}));var Vm,Um={"7_6":"getHistoryMsgs","7_9":"deleteRoamingMsgs","4_24":"syncClearServerHistoryMsgs","7_18":"clearHistoryMsgsFromServer","7_118":"multiSyncClearServerHistoryMsgs","7_26":"nimFtsCloudMsgLogsAggWithSession","7_27":"nimFtsCloudMsgLogs"},Fm={msg:$p,clearHistoryMsgsFromServerReqTag:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,time:6,ext:7},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},ftsReqTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msglogsLimit:5,orderRule:6,p2pSessionList:7,teamSessionList:8,senderList:9,msgTypeList:10,msgSubTypeList:11}},Bm=invertSerializeMap(Fm),Gm={deleteRoamingMsgs:{sid:7,cid:9,service:"msgLog",params:[{type:"StrArray",name:"ids"}]},getHistoryMsgs:{sid:7,cid:6,params:[{type:"String",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Bm.msg}],service:"msgLog"},clearHistoryMsgsFromServer:{sid:7,cid:18,params:[{type:"Property",name:"clearHistoryMsgsFromServerReqTag",reflectMapper:Fm.clearHistoryMsgsFromServerReqTag}],response:[{type:"Long",name:"timetag"}],service:"msgLog"},multiSyncClearServerHistoryMsgs:{sid:7,cid:118,response:[{type:"Property",name:"data",reflectMapper:Bm.clearMsgsParamsWithSync}],service:"msgLog"},syncClearServerHistoryMsgs:{sid:4,cid:24,service:"msgLog",response:[{type:"PropertyArray",name:"datas",reflectMapper:Bm.clearMsgsParamsWithSync}]},nimFtsCloudMsgLogsAggWithSession:{sid:7,cid:26,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:Fm.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Bm.msg}]},nimFtsCloudMsgLogs:{sid:7,cid:27,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:Fm.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Bm.msg}]}};!function(t){t[t.p2p=1]="p2p",t[t.team=2]="team"}(Vm||(Vm={}));var Hm={type:{type:"enum",values:Vm},isDeleteRoam:{type:"boolean"},isSyncSelf:{type:"boolean"},time:{type:"number"}};function formatClearResult(t){var a=format(Hm,t);return{sessionId:"p2p"===a.type?"p2p-"+a.otherAccid:"team-"+a.toTid,time:a.time}}var jm={orderRule:{type:"enum",values:wm}};function generateFtsTagForCmd(t){var a,u=format(jm,t);Ln(u.msgTypeList)&&(u.msgTypeList=map$6(a=u.msgTypeList).call(a,(function(t){return Ld[t]})).join(","));var m=["p2pSessionList","teamSessionList","senderList","msgSubTypeList"];return forEach$1(m).call(m,(function(t){Ln(u[t])&&(u[t]=u[t].join(","))})),u}var qm,Ym,Km=function(t){function MsgLogService(a){var u;return(u=t.call(this,"msgLog",a)||this).onV2ClearHistoryMessage=function(t){var a=formatClearResult(t);u.core.eventBus.emit("session/updateForClearMsg",[a],!0)},registerParser({cmdMap:Um,cmdConfig:Gm}),u.registerListener(),u}Ct(MsgLogService,t);var a=MsgLogService.prototype;return a.registerListener=function registerListener(){this.core.eventBus.on("forwardReceive/msgLog/clearHistoryMsgsFromServer",this.onV2ClearHistoryMessage)},a.deleteRoamingMsgs=function deleteRoamingMsgs(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u;return Zl.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:validate({ids:{type:"array",itemType:"string"}},t),a=[],m.prev=2,a=map$6(u=t.ids).call(u,(function(t){var a=getAccountFromSessionId(t);return a.scene+"|"+a.accid})),m.next=10;break;case 6:throw m.prev=6,m.t0=m.catch(2),this.logger.error("Failed to delete roaming msgs with "+t.ids,m.t0),new Error("Failed to create session with "+t.ids);case 10:return m.next=12,this.core.sendCmd("deleteRoamingMsgs",{ids:a});case 12:case"end":return m.stop()}}),_callee,this,[[2,6]])})))},a.getHistoryMsgs=function getHistoryMsgs(t){var a,u;return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var m,g,h,_,E,T,S;return Zl.wrap((function _callee2$(M){for(;;)switch(M.prev=M.next){case 0:return"function"!=typeof(null===(a=this.core.sync)||void 0===a?void 0:a.getSyncDoneFlag)||this.core.sync.getSyncDoneFlag()||this.logger.warn("Please call getHistoryMsgs after syncdone event"),validate({scene:{type:"enum",values:getEnumKeys(Dd)},to:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},lastMsgId:{type:"string",required:!1,allowEmpty:!1},asc:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},t),g="p2p"===t.scene?"getHistoryMsgs":"team"===t.scene?"getHistoryTeamMsgs":"getHistorySuperTeamMsgs",M.next=5,this.core.sendCmd(g,assignOptions({beginTime:0,endTime:0,lastMsgId:0,limit:100,reverse:!1},Lt(Lt({},t),{msgTypes:t.msgTypes?map$6(m=t.msgTypes).call(m,(function(t){return Ld[t]})):[]})));case 5:if(h=M.sent,(_=h.content).msgs&&_.msgs.length>0){M.next=9;break}return M.abrupt("return",[]);case 9:if(E=getSessionId(_.msgs[0],this.core.account),T=null===(u=this.core.session)||void 0===u?void 0:u.getSessionWithUncomplete({id:E}),S=formatMsgs(_.msgs,T?{account:this.core.account,sessionAck:T.ack,msgReceiptTime:T.msgReceiptTime}:{account:this.core.account}),!0!==t.asc){M.next=14;break}return M.abrupt("return",sort(S).call(S,(function(t,a){return t.time-a.time})));case 14:return M.abrupt("return",S);case 15:case"end":return M.stop()}}),_callee2,this)})))},a.clearHistoryMsgsFromServer=function clearHistoryMsgsFromServer(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var a,u,m;return Zl.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:return validate({scene:{type:"enum",values:["p2p","team"]},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},isSyncSelf:{type:"boolean",required:!1}},t),(a=Lt(Lt({isDeleteRoam:1},t),{type:"team"===t.scene?2:1,isSyncSelf:!0===t.isSyncSelf?1:0}))[2===a.type?"toTid":"otherAccid"]=t.to,g.next=5,this.core.sendCmd("clearHistoryMsgsFromServer",{clearHistoryMsgsFromServerReqTag:a});case 5:return u=g.sent,m=u.content,this.core.eventBus.emit("session/updateForClearMsg",[{sessionId:t.scene+"-"+t.to}],!0),this.core.eventBus.emit("forwardSend/msgLog/clearHistoryMsgsFromServer",Lt(Lt({},a),{time:m.timetag})),g.abrupt("return",m);case 10:case"end":return g.stop()}}),_callee3,this)})))},a.multiSyncClearServerHistoryMsgsHandler=function multiSyncClearServerHistoryMsgsHandler(t){var a=formatClearResult(t.content.data);this.core.eventBus.emit("session/updateForClearMsg",[a],!0),this.core.emit("clearServerHistoryMsgs",[a])},a.ftsCloudMsgLogs=function ftsCloudMsgLogs(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){return Zl.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.baseFtsCloudMsgLogs(t,"nimFtsCloudMsgLogs"));case 1:case"end":return a.stop()}}),_callee4,this)})))},a.ftsCloudMsgLogsAggWithSession=function ftsCloudMsgLogsAggWithSession(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){return Zl.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.baseFtsCloudMsgLogs(t,"nimFtsCloudMsgLogsAggWithSession"));case 1:case"end":return a.stop()}}),_callee5,this)})))},a.baseFtsCloudMsgLogs=function baseFtsCloudMsgLogs(t,a){return __awaiter(this,void 0,void 0,Zl.mark((function _callee6(){var u,m,g,h=this;return Zl.wrap((function _callee6$(_){for(;;)switch(_.prev=_.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",required:!1},msglogsLimit:{type:"number",required:!1},orderRule:{type:"enum",values:getEnumKeys(wm),required:!1},p2pSessionList:{type:"array",itemType:"string",required:!1},teamSessionList:{type:"array",itemType:"string",required:!1},senderList:{type:"array",itemType:"string",required:!1},msgTypeList:{type:"array",itemType:"enum",values:getEnumKeys(Ld),required:!1},msgSubTypeList:{type:"array",itemType:"number",required:!1}},t),!(t.fromTime&&t.toTime&&t.toTime<t.fromTime)){_.next=3;break}throw new Ul("Request parameter error: toTime should be greater than fromTime",t,"");case 3:return m=generateFtsTagForCmd(t),_.next=6,this.core.sendCmd(a,{tag:m});case 6:return g=_.sent,_.abrupt("return",map$6(u=g.content.datas).call(u,(function(t){var a,u=getSessionId(t,h.core.account),m=null===(a=h.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:u});return formatMsg(t,m?{account:h.core.account,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:h.core.account})})));case 8:case"end":return _.stop()}}),_callee6,this)})))},a.syncClearServerHistoryMsgsHandler=function syncClearServerHistoryMsgsHandler(t){var a=function formatClearResults(t){return Ln(t)&&t.length>0?map$6(t).call(t,(function(t){return formatClearResult(t)})):[]}(t.content.datas);this.core.emit("clearServerHistoryMsgs",a)},MsgLogService}(ip),Wm={"22_1":"requestProxy","22_2":"onRequestProxy"},$m={requestProxyTag:{zone:1,path:2,method:3,header:4,body:5},requestProxyMsgTag:{from:1,body:2,time:3}},zm=invertSerializeMap($m),Jm={requestProxy:{sid:22,cid:1,service:"passThrough",params:[{type:"Property",name:"requestProxyTag",reflectMapper:$m.requestProxyTag}],response:[{type:"Property",name:"requestProxyTag",reflectMapper:zm.requestProxyTag}]},onRequestProxy:{sid:22,cid:2,service:"passThrough",response:[{type:"Property",name:"proxyMsg",reflectMapper:zm.requestProxyMsgTag}]}},Xm=function(t){function PassThroughService(a){var u;return(u=t.call(this,"passThrough",a)||this).core=a,registerParser({cmdMap:Wm,cmdConfig:Jm}),u}Ct(PassThroughService,t);var a=PassThroughService.prototype;return a.request=function request(t){return validate({path:{type:"string",allowEmpty:!1}},t),this.core.sendCmd("requestProxy",{requestProxyTag:t}).then((function(t){return t.content.requestProxyTag}))},a.onRequestProxyHandler=function onRequestProxyHandler(t){var a=t.content.proxyMsg;a&&a.time&&(a.time=+a.time),this.core.emit("proxyMsg",a)},PassThroughService}(ip),Qm={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},Zm={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function getUploadResponseFormat(t){return void 0===t&&(t="file"),Pn(Qm[t]||{}).replace(/"/gi,'\\"')}!function(t){t[t.nos=1]="nos",t[t.s3=2]="s3"}(qm||(qm={})),function(t){t[t.dontNeed=-1]="dontNeed",t[t.time=2]="time",t[t.urls=3]="urls"}(Ym||(Ym={}));var eg={chunkUploadHost:"https://wannos-web.127.net",chunkUploadHostBackupList:["https://fileup.chatnos.com","https://oss.chatnos.com"],commonUploadHost:"https://fileup.chatnos.com",commonUploadHostBackupList:["https://oss.chatnos.com"],chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0};function pickBy(t,a){t=t||{},a=a||function(){return!0};var u={};for(var m in t)a(t[m])&&(u[m]=t[m]);return u}var tg=function(){function NOS(t,a){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=t,this.cloudStorage=a}var t=NOS.prototype;return t.reset=function reset(){this.nosErrorCount=0},t.getNosAccessToken=function getNosAccessToken(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u,m;return Zl.wrap((function _callee$(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.core.sendCmd("getNosAccessToken",{tag:t});case 2:return a=g.sent,u=get(a,"content.nosAccessTokenTag.token"),m=t.url,g.abrupt("return",{token:u,url:-1!==indexOf(m).call(m,"?")?m+"&token="+u:m+"?token="+u});case 6:case"end":return g.stop()}}),_callee,this)})))},t.deleteNosAccessToken=function deleteNosAccessToken(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){return Zl.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("deleteNosAccessToken",{tag:t});case 2:case"end":return a.stop()}}),_callee2,this)})))},t.nosUpload=function nosUpload(t,a){var u,m,g,h,_,E,T,S;return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var M,I,A,b,N,C,R,O,w,k,x,P,L,D,V,U,B,G,H;return Zl.wrap((function _callee3$(j){for(;;)switch(j.prev=j.next){case 0:if(M=get(this.core,"config.cdn.bucket"),I={tag:t.nosScenes||M||"nim"},t.nosSurvivalTime&&(I.expireSec=t.nosSurvivalTime),A=this.core.adapters.getFileUploadInformation(t),!(!a&&!A)){j.next=18;break}return j.prev=6,j.next=9,this.core.sendCmd("getNosToken",{responseBody:getUploadResponseFormat(t.type),nosToken:I});case 9:b=j.sent,j.next=18;break;case 12:if(j.prev=12,j.t0=j.catch(6),this.core.logger.error("uploadFile:: getNosToken error",j.t0),!(j.t0 instanceof Vl)){j.next=17;break}throw j.t0;case 17:throw new Gl({code:"v2"===get(this.core,"options.apiVersion")?Ll.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:j.t0,curProvider:1}});case 18:return N=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",A?null===(u=A.uploadInfo)||void 0===u?void 0:u.objectName:a?null==a?void 0:a.objectName:b.content.nosToken.objectName),C="",a&&a.shortUrl&&(C=a.shortUrl),(null===(h=null===(g=null===(m=null==A?void 0:A.uploadInfo)||void 0===m?void 0:m.payload)||void 0===g?void 0:g.mixStoreToken)||void 0===h?void 0:h.shortUrl)&&(C=A.uploadInfo.payload.mixStoreToken.shortUrl),R=C||N,j.prev=23,w=A?{token:null===(_=null==A?void 0:A.uploadInfo)||void 0===_?void 0:_.token,bucket:null===(E=null==A?void 0:A.uploadInfo)||void 0===E?void 0:E.bucketName,objectName:null===(T=null==A?void 0:A.uploadInfo)||void 0===T?void 0:T.objectName}:a||b.content.nosToken,this.core.logger.log("uploadFile:: uploadFile params",{nosToken:w,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,platform:eu.platform}),k="BROWSER"===eu.platform?this.config.chunkUploadHost:this.config.commonUploadHost+"/"+(w&&w.bucket),this.core.reporterHookCloudStorage.update({remote_addr:k,operation_type:a?2:0}),j.next=30,this.core.adapters.uploadFile(Lt(Lt(Lt({},t),{nosToken:w,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,maxSize:t.maxSize||this.config.chunkMaxSize}),a?{payload:{mixStoreToken:a}}:{}));case 30:O=j.sent,j.next=65;break;case 33:if(j.prev=33,j.t1=j.catch(23),this.core.logger.error("uploadFile::nos uploadFile error:",j.t1),x="v2"===get(this.core,"options.apiVersion"),j.t1.code!==Ll.V2NIM_ERROR_CODE_CANCELLED&&10499!==j.t1.errCode){j.next=39;break}throw new Gl({code:x?Ll.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:get(j.t1,"message")||"Request abort",rawError:j.t1,curProvider:1}});case 39:if(!x||j.t1.errCode!==Ll.V2NIM_ERROR_CODE_FILE_OPEN_FAILED){j.next=41;break}throw new Vl({code:Ll.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:get(j.t1,"message")||"Read file failed",rawError:j.t1,curProvider:1}});case 41:return j.next=43,eu.net.getNetworkStatus();case 43:if(P=j.sent,!1!==P.net_connect){j.next=47;break}throw new Gl({code:"v2"===get(this.core,"options.apiVersion")?Ll.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:j.t1,curProvider:1}});case 47:if(!a){j.next=64;break}if(!(this.nosErrorCount<=0)){j.next=60;break}j.prev=49,this.cloudStorage.mixStorage._addCircuitTimer(),j.next=56;break;case 53:throw j.prev=53,j.t2=j.catch(49),new Gl({code:"v2"===get(this.core,"options.apiVersion")?Ll.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:j.t2,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:t.file||t.filePath}});case 56:return this.nosErrorCount=get(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),j.abrupt("return",this.cloudStorage._uploadFile(t));case 60:return this.nosErrorCount--,j.abrupt("return",this.nosUpload(t,a));case 62:j.next=65;break;case 64:throw new Gl({code:"v2"===get(this.core,"options.apiVersion")?Ll.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:j.t1,curProvider:1}});case 65:if(L=null==O?void 0:O.type,(D=L&&indexOf(L).call(L,"/")>-1?slice(L).call(L,0,indexOf(L).call(L,"/")):"")||(D=t.type||""),(V={image:"imageInfo",video:"vinfo",audio:"vinfo"})[D]){j.next=71;break}return j.abrupt("return",Lt({url:R},O));case 71:return j.prev=71,j.next=74,this.core.adapters.request(N+"?"+V[D],{method:"GET",dataType:"json",timeout:5e3},{exception_service:3});case 74:U=j.sent,j.next=81;break;case 77:return j.prev=77,j.t3=j.catch(71),this.core.logger.error("uploadFile:: fetch file info error",j.t3),j.abrupt("return",Lt({url:R},O));case 81:if(!U){j.next=88;break}return B=U.data,G="imageInfo"===V[D]?B:null===(S=null==B?void 0:B.GetVideoInfo)||void 0===S?void 0:S.VideoInfo,H={url:R,name:O.name,size:O.size,ext:O.ext,w:null==G?void 0:G.Width,h:null==G?void 0:G.Height,orientation:null==G?void 0:G.Orientation,dur:null==G?void 0:G.Duration,audioCodec:null==G?void 0:G.AudioCodec,videoCodec:null==G?void 0:G.VideoCodec,container:null==G?void 0:G.Container},j.abrupt("return",pickBy(H,(function(t){return void 0!==t})));case 88:return j.abrupt("return",Lt({url:R},O));case 89:case"end":return j.stop()}}),_callee3,this,[[6,12],[23,33],[49,53],[71,77]])})))},t._getNosCdnHost=function _getNosCdnHost(){var t;return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){var a,u,m,g=this;return Zl.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,this.core.sendCmd("getNosCdnHost");case 3:a=h.sent,h.next=10;break;case 6:return h.prev=6,h.t0=h.catch(0),this.core.logger.error("getNosCdnHost::error",h.t0),h.abrupt("return");case 10:if(a){h.next=12;break}return h.abrupt("return");case 12:u=null===(t=null==a?void 0:a.content)||void 0===t?void 0:t.nosConfigTag,0!==(m=Cu(null==u?void 0:u.expire))&&u.cdnDomain?-1===m?(this.config.cdn.bucket=u.bucket,this.config.cdn.cdnDomain=u.cdnDomain,this.config.cdn.objectNamePrefix=u.objectNamePrefix):(this.config.cdn.bucket=u.bucket,this.config.cdn.cdnDomain=u.cdnDomain,this.config.cdn.objectNamePrefix=u.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){g._getNosCdnHost()}),1e3*m)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return h.stop()}}),_callee4,this,[[0,6]])})))},We(NOS,[{key:"config",get:function get(){return this.cloudStorage.config}}]),NOS}(),rg={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},ng={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4,policyVersion:5},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4,policyVersion:5},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},ig={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:ng.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:invertSerializeItem(ng.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:ng.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:invertSerializeItem(ng.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:invertSerializeItem(ng.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:invertSerializeItem(ng.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:invertSerializeItem(ng.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:ng.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:invertSerializeItem(ng.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:ng.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:invertSerializeItem(ng.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:ng.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:invertSerializeItem(ng.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:ng.nosAccessTokenTag}]}},og=function(){function MixStorage(t,a){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=t,this.cloudStorage=a,this.logger=t.logger}var t=MixStorage.prototype;return t.reset=function reset(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10},t.getGrayscaleConfig=function getGrayscaleConfig(t,a){var u;return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var m,g;return Zl.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(eu.localStorage)try{eu.localStorage.getItem&&eu.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(eu.localStorage.getItem(this.GRAYKEY))[t])}catch(t){eu.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",t)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<a)){h.next=17;break}return h.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(m=h.sent).content||!m.content.grayConfigTag){h.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(m.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(m.content.grayConfigTag.ttl)}catch(t){this.logger.error("getGrayscaleConfig error",t)}if(this.grayConfig){h.next=10;break}return h.abrupt("return");case 10:g=eu.localStorage.getItem(this.GRAYKEY)?JSON.parse(eu.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),g[t]=this.grayConfig,eu.localStorage.setItem(this.GRAYKEY,Pn(g)),h.next=17;break;case 16:this.logger.log("uploadFile:: result grayConfig:",m.content);case 17:if(!(null===(u=this.grayConfig)||void 0===u?void 0:u.mixStoreEnable)){h.next=20;break}return h.next=20,this._getMixStorePolicy(t);case 20:case"end":return h.stop()}}),_callee,this)})))},t._getMixStorePolicy=function _getMixStorePolicy(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a,u,m,g,h,_,E;return Zl.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:if(a=(new Date).getTime(),eu.localStorage)try{this.mixStorePolicy=JSON.parse(eu.localStorage.getItem(this.MIXSTOREKEY))[t],this.curProvider=Cu(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>a&&(m=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-a,this.core.timerManager.addTimer(bind$1(u=this._getMixStorePolicy).call(u,this,t),m))}catch(a){eu.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(eu.localStorage.getItem(this.MIXSTOREKEY))[t]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",a)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=a)){T.next=31;break}return T.prev=3,T.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]});case 6:h=T.sent,_=h.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.mixStorePolicy.policyVersion=_.policyVersion,this.mixStorePolicy.ttl=Number(_.ttl),this.mixStorePolicy.providers=_.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=Cu(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=_.nosPolicy?JSON.parse(_.nosPolicy):null,this.mixStorePolicy.s3Policy=_.s3Policy?JSON.parse(_.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(bind$1(g=this._getMixStorePolicy).call(g,this,t),1e3*this.mixStorePolicy.ttl),E=eu.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(eu.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),E[t]=this.mixStorePolicy,eu.localStorage.setItem(this.MIXSTOREKEY,Pn(E)),T.next=31;break;case 24:if(T.prev=24,T.t0=T.catch(3),this.logger.error("getMixStorePolicy error",T.t0),0!==this.mixStoreErrorCount){T.next=29;break}throw new Error("getMixStorePolicy all count error");case 29:this._getMixStorePolicy(t),this.mixStoreErrorCount--;case 31:this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 32:case"end":return T.stop()}}),_callee2,this,[[3,24]])})))},t._addCircuitTimer=function _addCircuitTimer(){var t=this,a=this.mixStorePolicy.providers,u=a[(indexOf(a).call(a,String(this.curProvider))+1)%a.length];if(!u)throw new Error("uploadFile nextProvider error");if(u===a[0])throw new Error("uploadFile all policy fail");if(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+u),this.curProvider=Cu(u),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy){var m=this.mixStorePolicy[1===this.curProvider?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!m||0===m)throw new Error("uploadFile circuit error");this.circuitTimer=this.core.timerManager.addTimer((function(){t.logger.log("uploadFile:: upload policy will change,now policy:"+t.curProvider+" nextProvider:"+Cu(t.mixStorePolicy.providers[0])),t.curProvider=Cu(t.mixStorePolicy.providers[0]),t.core.timerManager.deleteTimer(t.circuitTimer)}),1e3*m)}throw new Error("uploadFile will not retry again")},t.getFileAuthToken=function getFileAuthToken(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var a;return Zl.wrap((function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:t});case 2:return a=u.sent,u.abrupt("return",a.content.mixStoreAuthTokenResTag);case 4:case"end":return u.stop()}}),_callee3,this)})))},MixStorage}(),ag=vu.trim,sg=b("".charAt),cg=m.parseFloat,lg=m.Symbol,ug=lg&&lg.iterator,dg=1/cg(mu+"-0")!=-1/0||ug&&!fails((function(){cg(Object(ug))}))?function parseFloat(t){var a=ag(toString(t)),u=cg(a);return 0===u&&"-"==sg(a,0)?-0:u}:cg;_export({global:!0,forced:parseFloat!=dg},{parseFloat:dg});var pg=H.parseFloat,mg=-1,gg=function(){function AWS(t,a){this.s3=null,this.core=t,this.cloudStorage=a,this.logger=t.logger}var t=AWS.prototype;return t.s3Upload=function s3Upload(t,a){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var u,m,g,h,_,E,T,S,M,I,A,b,N,C,R=this;return Zl.wrap((function _callee2$(O){for(;;)switch(O.prev=O.next){case 0:if(mg+=1,!t.file){O.next=5;break}u=t.file,O.next=20;break;case 5:if("string"!=typeof t.fileInput){O.next=15;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((m=document.getElementById(t.fileInput))&&m.files&&m.files[0])){O.next=12;break}u=m.files[0],O.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:O.next=20;break;case 15:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){O.next=19;break}u=t.fileInput.files[0],O.next=20;break;case 19:throw new Error("Can not get file from fileInput "+t.fileInput);case 20:if(this.mixStorePolicy.s3Policy){O.next=22;break}throw new Error("dont get s3 policy");case 22:return g={accessKeyId:a.accessKeyId,secretAccessKey:a.secretAccessKey,sessionToken:a.sessionToken,region:a.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},h=this.s3,_=decodeURIComponent(a.bucket),E=decodeURIComponent(a.objectName),T=u,S="https://"+_+".s3.amazonaws.com/"+E,M={},(I=this.mixStorePolicy.s3Policy)&&I.uploadConfig&&Ln(I.uploadConfig.uploadUrl)&&I.uploadConfig.uploadUrl.length>0&&(A=I.uploadConfig.uploadUrl.length,mg%=A,M.endpoint=I.uploadConfig.uploadUrl[mg],M.s3ForcePathStyle=!0,S=M.endpoint+"/"+_+"/"+E),this.core.reporterHookCloudStorage.update({remote_addr:S,operation_type:1}),(b=new h(M)).config.update(g),N={Bucket:_,Key:E,Body:T,Metadata:{token:a.token},ContentType:T.type||"application/octet-stream"},this.core.logger.log("uploadFile:: s3 upload params:",N),(C=b.upload(N)).on("httpUploadProgress",(function(a){var u=pg((a.loaded/a.total).toFixed(2));t.onUploadProgress&&t.onUploadProgress({total:a.total,loaded:a.loaded,percentage:u,percentageText:Math.round(100*u)+"%"})})),O.abrupt("return",new Ho((function(u,m){var g=(new Date).getTime();C.send((function(h,S){return __awaiter(R,void 0,void 0,Zl.mark((function _callee(){var M,I,A,b,N,C,R,O;return Zl.wrap((function _callee$(w){for(;;)switch(w.prev=w.next){case 0:if(!h||"RequestAbortedError"!==h.code){w.next=5;break}this.logger.error("uploadFile:","api::s3:upload file abort.",h),m(new Gl({code:"v2"===get(this.core,"options.apiVersion")?Ll.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:h,curProvider:2}})),w.next=41;break;case 5:if(!h){w.next=26;break}return this.logger.error("uploadFile:","api::s3:upload file failed.",h),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(I=null===(M=this.core)||void 0===M?void 0:M.auth)||void 0===I?void 0:I.account),trace_id:null===(A=this.core.clientSocket.socket)||void 0===A?void 0:A.sessionId,start_time:g,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof h.status?h.status:"number"==typeof h.code?h.code:0,description:h.message||""+h.code,operation_type:1,target:Pn({bucket:_,object:E})},{asyncParams:eu.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),w.next=12,eu.net.getNetworkStatus();case 12:if(b=w.sent,!1!==b.net_connect){w.next=16;break}return w.abrupt("return",m(new Gl({code:"v2"===get(this.core,"options.apiVersion")?Ll.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:h,curProvider:this.cloudStorage.mixStorage.curProvider}})));case 16:w.prev=16,this.cloudStorage.mixStorage._addCircuitTimer(),w.next=23;break;case 20:return w.prev=20,w.t0=w.catch(16),w.abrupt("return",m(new Gl({code:"v2"===get(this.core,"options.apiVersion")?Ll.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:w.t0,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:t.file||t.filePath}})));case 23:u(this.cloudStorage._uploadFile(t)),w.next=41;break;case 26:if(N=(N=(N=this.mixStorePolicy.s3Policy.cdnSchema).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn)).replace("{objectName}",S.Key),C={size:T.size,name:T.name,url:a.shortUrl?a.shortUrl:N,ext:T.name.split(".")[1]||"unknown"},R=t.type||"",(O={image:"imageInfo"})[R]){w.next=36;break}return w.abrupt("return",u(C));case 36:return w.t1=u,w.next=39,this.getS3FileInfo({url:N,infoSuffix:O[R],s3Result:C});case 39:return w.t2=w.sent,w.abrupt("return",(0,w.t1)(w.t2));case 41:case"end":return w.stop()}}),_callee,this,[[16,20]])})))})),t.onUploadStart&&t.onUploadStart(C)})));case 39:case"end":return O.stop()}}),_callee2,this)})))},t.getS3FileInfo=function getS3FileInfo(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var u,m,g,h,_,E,T;return Zl.wrap((function _callee3$(S){for(;;)switch(S.prev=S.next){case 0:return u=t.url,m=t.infoSuffix,g=t.s3Result,S.prev=1,S.next=4,this.core.adapters.request(u+"?"+m,{method:"GET",dataType:"text",timeout:5e3},{exception_service:3});case 4:h=S.sent,S.next=11;break;case 7:return S.prev=7,S.t0=S.catch(1),this.core.logger.error("uploadFile:: fetch file info error",S.t0),S.abrupt("return",g);case 11:if(!h){S.next=18;break}return _=h.data,E="imageInfo"===m?_:null===(a=null==_?void 0:_.GetVideoInfo)||void 0===a?void 0:a.VideoInfo,T=Lt(Lt({},g),{w:null==E?void 0:E.Width,h:null==E?void 0:E.Height,orientation:null==E?void 0:E.Orientation,dur:null==E?void 0:E.Duration,audioCodec:null==E?void 0:E.AudioCodec,videoCodec:null==E?void 0:E.VideoCodec,container:null==E?void 0:E.Container}),S.abrupt("return",pickBy(T,(function(t){return void 0!==t})));case 18:return this.core.logger.error("uploadFile:: fetch s3 file info no result",u+"?"+m),S.abrupt("return",g);case 20:case"end":return S.stop()}}),_callee3,this,[[1,7]])})))},We(AWS,[{key:"mixStorePolicy",get:function get(){return this.cloudStorage.mixStorage.mixStorePolicy}}]),AWS}(),fg=function(){function CloudStorageService(t,a){void 0===a&&(a={}),this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=t.logger,this.core=t,this.nos=new tg(t,this),this.mixStorage=new og(t,this),this.aws=new gg(t,this),registerParser({cmdMap:rg,cmdConfig:ig}),this.setOptions(a),this.setListeners()}var t=CloudStorageService.prototype;return t.setOptions=function setOptions(t){void 0===t&&(t={});var a=t.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=a+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=a+"-AllMixStorePolicy";var u=t.s3,m=__rest(t,["s3"]),g=Lt({},eg,this.config);if(m&&Object.prototype.hasOwnProperty.call(m,"cdn")){var h=Lt(Lt({},g.cdn),m.cdn);this.config=Lt({},g,m),this.config.cdn=h}else this.config=Lt({},g,m);u&&(this.aws.s3=u)},t.setListeners=function setListeners(){var t,a,u,m;this.core.eventBus.on("kicked",bind$1(t=this._clearUnCompleteTask).call(t,this)),this.core.eventBus.on("disconnect",bind$1(a=this._clearUnCompleteTask).call(a,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",bind$1(u=this._clearUnCompleteTask).call(u,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",bind$1(m=this._clearUnCompleteTask).call(m,this))},t._clearUnCompleteTask=function _clearUnCompleteTask(){var t,a=this;forEach$1(t=Bt(this.uploadTaskMap)).call(t,(function(t){var u=a.uploadTaskMap[t];u&&u.abort&&u.abort()})),this.uploadTaskMap={}},t.init=function init(t){return void 0===t&&(t=Jo()),__awaiter(this,void 0,void 0,Zl.mark((function _callee(){return Zl.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(this.mixStorage.reset(),this.nos.reset(),!this.config.isNeedToGetUploadPolicyFromServer){a.next=5;break}return a.next=5,this.mixStorage.getGrayscaleConfig(this.core.options.appkey,t);case 5:return a.next=7,this.nos._getNosCdnHost();case 7:case"end":return a.stop()}}),_callee,this)})))},t.processCallback=function processCallback(t,a){var u=this,m=t.onUploadProgress,g=t.onUploadDone,h=t.onUploadStart;return{onUploadStart:"function"==typeof h?function(t){u.uploadTaskMap[a]=t;try{h(t)}catch(t){u.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",t)}}:function(t){u.uploadTaskMap[a]=t},onUploadProgress:"function"==typeof m?function(t){u.core.reporterHookCloudStorage.update({transferred_size:t.loaded,full_size:t.total});try{m(t)}catch(t){u.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",t)}}:function(t){u.core.reporterHookCloudStorage.update({transferred_size:t.loaded,full_size:t.total})},onUploadDone:"function"==typeof g?function(t){u.core.reporterHookCloudStorage.end(0);try{g(t)}catch(t){u.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",t)}}:function(){u.core.reporterHookCloudStorage.end(0)},taskKey:a}},t.uploadFile=function uploadFile(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a,u,m,g,h,_,E,T;return Zl.wrap((function _callee2$(S){for(;;)switch(S.prev=S.next){case 0:if(validate({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},t),t.fileInput||t.file||t.filePath){S.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!t.type||"file"===t.type){S.next=7;break}if(!(a=get(t,"file.type"))||"string"!=typeof a||-1!==indexOf(a).call(a,t.type)){S.next=7;break}throw new Error('The meta type "'+a+'" does not match "'+t.type+'"');case 7:return this.core.reporterHookCloudStorage.start(),t.file?this.core.reporterHookCloudStorage.update({full_size:t.file.size}):"string"==typeof t.fileInput?(u=document.getElementById(t.fileInput))&&u.files&&u.files[0]&&this.core.reporterHookCloudStorage.update({full_size:u.files[0].size}):t.fileInput&&t.fileInput.files&&t.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:t.fileInput.files[0].size}),m=Ou(),g=this.processCallback(t,m),h=g.onUploadStart,_=g.onUploadProgress,E=g.onUploadDone,t.onUploadStart=h,t.onUploadProgress=_,t.onUploadDone=E,T=null,S.prev=15,S.next=18,this._uploadFile(t);case 18:T=S.sent,t.md5&&(T.md5=t.md5),delete this.uploadTaskMap[m],S.next=28;break;case 23:throw S.prev=23,S.t0=S.catch(15),delete this.uploadTaskMap[m],this.core.reporterHookCloudStorage.end((S.t0&&S.t0.code)===Ll.V2NIM_ERROR_CODE_CANCELLED?3:1),S.t0;case 28:return T&&(T.size=void 0===T.size?void 0:Number(T.size),T.w=void 0===T.w?void 0:Number(T.w),T.h=void 0===T.h?void 0:Number(T.h),T.dur=void 0===T.dur?void 0:Number(T.dur)),T.url=decodeURIComponent(T.url),t.onUploadDone({size:T.size,name:T.name,url:T.url,ext:T.name.split(".")[1]||"unknown"}),S.abrupt("return",T);case 32:case"end":return S.stop()}}),_callee2,this,[[15,23]])})))},t._uploadFile=function _uploadFile(t){var a,u;return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var m,g,h,_;return Zl.wrap((function _callee3$(E){for(;;)switch(E.prev=E.next){case 0:if(get(this.mixStorage,"grayConfig.mixStoreEnable")&&get(this.mixStorage,"mixStorePolicy.providers.length")){E.next=3;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),E.abrupt("return",this.nos.nosUpload(t));case 3:if(this.logger.log("uploadFile::_uploadFile, grayConfig enable:"+get(this.mixStorage,"grayConfig.mixStoreEnable")+" curProvider:"+get(this.mixStorage,"curProvider")),m=this.core.adapters.getFileUploadInformation(t),g=!0,m?!1===m.complete&&2===this.mixStorage.curProvider&&(g=!1):g=!1,this.aws.s3||(this.mixStorage.curProvider=1),h=Zm,g){E.next=23;break}return E.prev=10,E.next=13,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:t.nosSurvivalTime,returnBody:getUploadResponseFormat(t.type),policyVersion:this.mixStorage.mixStorePolicy.policyVersion}});case 13:_=E.sent,h=_.content.mixStoreTokenResTag,E.next=23;break;case 17:if(E.prev=17,E.t0=E.catch(10),this.core.logger.error("uploadFile:: getMixStoreToken error",E.t0),!(E.t0 instanceof Vl)){E.next=22;break}throw E.t0;case 22:throw new Gl({code:"v2"===get(this.core,"options.apiVersion")?Ll.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:E.t0,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}});case 23:if(g){E.next=27;break}return E.abrupt("return",2===this.mixStorage.curProvider?this.aws.s3Upload(t,h):this.nos.nosUpload(t,h));case 27:return E.abrupt("return",this.nos.nosUpload(t,null===(u=null===(a=null==m?void 0:m.uploadInfo)||void 0===a?void 0:a.payload)||void 0===u?void 0:u.mixStoreToken));case 28:case"end":return E.stop()}}),_callee3,this,[[10,17]])})))},t.getThumbUrl=function getThumbUrl(t,a){var u,m,g,h,_;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),t;var E=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);E[0],E[1],E[2],E[3],E[4];var T=E[5];if(E[6],E[7],null===(u=this.grayConfig)||void 0===u?void 0:u.mixStoreEnable){var S=this._getUrlType(t);if(2===S&&this.mixStorePolicy.s3Policy&&get(this.mixStorePolicy,"s3Policy.thumbPolicy.imagethumb"))return(null===(g=null===(m=this.mixStorePolicy.s3Policy)||void 0===m?void 0:m.thumbPolicy)||void 0===g?void 0:g.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",T).replace("{x}",a.width.toString()).replace("{y}",a.height.toString());if(1===S&&this.mixStorePolicy.nosPolicy&&get(this.mixStorePolicy,"nosPolicy.thumbPolicy.imagethumb"))return(null===(_=null===(h=this.mixStorePolicy.nosPolicy)||void 0===h?void 0:h.thumbPolicy)||void 0===_?void 0:_.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",T).replace("{x}",a.width.toString()).replace("{y}",a.height.toString())}return includes(t).call(t,"?")?t+"&imageView&thumbnail="+a.width+"x"+a.height:t+"?imageView&thumbnail="+a.width+"x"+a.height},t.getVideoCoverUrl=function getVideoCoverUrl(t,a){var u,m,g,h,_;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),t;var E=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);E[0],E[1],E[2],E[3],E[4];var T=E[5];if(E[6],E[7],null===(u=this.grayConfig)||void 0===u?void 0:u.mixStoreEnable){var S=this._getUrlType(t);if(2===S&&this.mixStorePolicy.s3Policy&&get(this.mixStorePolicy,"s3Policy.thumbPolicy.vframe"))return(null===(g=null===(m=this.mixStorePolicy.s3Policy)||void 0===m?void 0:m.thumbPolicy)||void 0===g?void 0:g.vframe).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",T).replace("{x}",a.width.toString()).replace("{y}",a.height.toString()).replace("{offset}","0").replace("{type}","png");if(1===S&&this.mixStorePolicy.nosPolicy&&get(this.mixStorePolicy,"nosPolicy.thumbPolicy.vframe"))return(null===(_=null===(h=this.mixStorePolicy.nosPolicy)||void 0===h?void 0:h.thumbPolicy)||void 0===_?void 0:_.vframe).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",T).replace("{x}",a.width.toString()).replace("{y}",a.height.toString()).replace("{offset}","0").replace("{type}","png")}return includes(t).call(t,"?")?t+"&vframe&offset=0&resize="+a.width+"x"+a.height+"&type=png":t+"?vframe&offset=0&resize="+a.width+"x"+a.height+"&type=png"},t.getPrivateUrl=function getPrivateUrl(t){var a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),"";var u=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);u[0];var m=u[1];u[2];var g=u[3];u[4];var h=u[5];if(u[6],u[7],null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable){var _=this._getUrlType(t);return 2===_&&this.mixStorePolicy.s3Policy&&(t=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",h)),1===_&&this.mixStorePolicy.nosPolicy&&(t=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",h)),t}var E=this.config,T=E.downloadUrl,S=E.downloadHostList,M=E.nosCdnEnable,I=this.config.cdn.cdnDomain,A=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",b=decodeURIComponent(h),N=indexOf(b).call(b,A);if(I&&N>-1&&M)return""+m+I+"/"+slice(b).call(b,N);if(includes(S).call(S,g)&&includes(h).call(h,"/")){var C=indexOf(h).call(h,"/"),R=h.substring(0,C),O=h.substring(C+1);return T.replace("{bucket}",R).replace("{object}",O)}var w=filter(S).call(S,(function(t){return"string"==typeof g&&includes(g).call(g,t)}))[0],k=w?g.replace(w,"").replace(/\W/g,""):null;return k?T.replace("{bucket}",k).replace("{object}",h):t},t.getOriginUrl=function getOriginUrl(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){var a;return Zl.wrap((function _callee4$(u){for(;;)switch(u.prev=u.next){case 0:if("string"==typeof t&&includes(t).call(t,"_im_url=1")){u.next=2;break}return u.abrupt("return",t);case 2:return u.next=4,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:t}});case 4:return a=u.sent,u.abrupt("return",a.content.nosSafeUrlTag.originUrl);case 6:case"end":return u.stop()}}),_callee4,this)})))},t.getFileToken=function getFileToken(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){var a,u,m,g,h,_=this;return Zl.wrap((function _callee5$(E){for(;;)switch(E.prev=E.next){case 0:if(validate({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},t),a=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,u=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,a!==String(-1)||u!==String(-1)){E.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(2!==t.type){E.next=17;break}if(!(a&&indexOf(a).call(a,String(2))>=0||u&&indexOf(u).call(u,String(2))>0)){E.next=13;break}return E.abrupt("return",this.mixStorage.getFileAuthToken(t));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:E.next=33;break;case 17:if(t.urls&&t.urls.length){E.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(g=[],h=[],forEach$1(m=t.urls).call(m,(function(t){var a=_._getUrlType(t);1===a&&h.push(t),2===a&&g.push(t)})),(!u||0!==g.length&&indexOf(u).call(u,String(3))<0)&&(this.logger.warn("s3 url don't support url token"),g=[]),(!a||0!==h.length&&indexOf(a).call(a,String(3))<0)&&(this.logger.warn("nos url don't support url token"),h=[]),0!==g.length||0!==h.length){E.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==g.length&&0!==h.length){E.next=33;break}return t.urls=Pn(t.urls),E.abrupt("return",this.mixStorage.getFileAuthToken(t));case 33:case"end":return E.stop()}}),_callee5,this)})))},t._getUrlType=function _getUrlType(t){var a,u;return this.mixStorePolicy.nosPolicy&&some(a=this.mixStorePolicy.nosPolicy.dlcdns).call(a,(function(a){return indexOf(t).call(t,a)>=0}))?1:this.mixStorePolicy.s3Policy&&some(u=this.mixStorePolicy.s3Policy.dlcdns).call(u,(function(a){return indexOf(t).call(t,a)>=0}))?2:null},t.getNosAccessToken=function getNosAccessToken(t){return validate({url:{type:"string",allowEmpty:!1}},t),this.nos.getNosAccessToken(t)},t.deleteNosAccessToken=function deleteNosAccessToken(t){return validate({token:{type:"string",allowEmpty:!1}},t),this.nos.deleteNosAccessToken(t)},t.process=function process(t){var a=get(t,"error.detail.ignore");return t.error&&!a?Ho.reject(t.error):Ho.resolve(t)},We(CloudStorageService,[{key:"grayConfig",get:function get(){return this.mixStorage.grayConfig}},{key:"mixStorePolicy",get:function get(){return this.mixStorage.mixStorePolicy}}]),CloudStorageService}(),hg=invert({none:0,normal:1,all:3}),_g=invert({normal:0,advanced:1}),vg=invert({normal:0,owner:1,manager:2}),yg={noVerify:0,needVerify:1,rejectAll:2},Eg=invert(yg),Tg={needVerify:0,noVerify:1},Sg=invert(Tg),Mg={manager:0,all:1},Ig=invert(Mg),Ag={manager:0,all:1},bg=invert(Ag),Ng={manager:0,all:1},Cg=invert(Ng);function formatSuperTeam(t){var a,u=["teamId"],m=["level","memberNum","memberUpdateTime","createTime","updateTime"],g=["valid","validToCurrentUser","mute"],h={type:_g,muteType:hg,joinMode:Eg,beInviteMode:Sg,inviteMode:Ig,updateTeamMode:bg,updateExtMode:Cg};t.bits;var _=__rest(t,["bits"]);return forEach$1(u).call(u,(function(t){_[t]&&(_[t]=_[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==_[t]&&(_[t]=Cu(_[t]))})),forEach$1(g).call(g,(function(t){void 0!==_[t]&&(_[t]=1===Cu(_[t]))})),forEach$1(a=Bt(h)).call(a,(function(t){void 0!==_[t]&&(_[t]=h[t][_[t]]||_[t])})),_}function formatSuperTeams(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatSuperTeam(t)})):[]}function generateSuperTeam(t){var a,u=Lt({},t),m=["avatar","name","intro","announcement","ext"],g={joinMode:yg,beInviteMode:Tg,inviteMode:Mg,updateTeamMode:Ag,updateExtMode:Ng};return forEach$1(m).call(m,(function(t){void 0!==u[t]&&(u[t]=u[t].toString())})),forEach$1(a=Bt(g)).call(a,(function(t){void 0!==u[t]&&(u[t]=g[t][u[t]])})),u}function generatorSuperTeamMemberForCmd(t){var a=["teamId","ext","account","nickInTeam"],u={};return void 0!==t.bitConfigMask&&(u.bits=Cu(t.bitConfigMask)),forEach$1(a).call(a,(function(a){t[a]&&(u[a]=t[a].toString())})),Object.prototype.hasOwnProperty.call(t,"nickInTeam")&&(u.nickInTeam=t.nickInTeam),u}function formatSuperTeamMember(t){var a,u=["teamId"],m=["joinTime","updateTime","bitConfigMask"],g=["active","valid","mute"],h={type:vg},_=t.bits,E=__rest(t,["bits"]);return void 0!==_&&(E.muteTeam=1===Cu(_),E.bitConfigMask=_),E.id=E.teamId+"-"+E.account,forEach$1(u).call(u,(function(t){E[t]&&(E[t]=E[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==E[t]&&(E[t]=Cu(E[t]))})),forEach$1(g).call(g,(function(t){void 0!==E[t]&&(E[t]=1===Cu(E[t]))})),forEach$1(a=Bt(h)).call(a,(function(t){void 0!==E[t]&&(E[t]=h[t][E[t]]||E[t])})),E}function formatSuperTeamMembers(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatSuperTeamMember(t)})):[]}function generatorMemberBySuperTeam(t,a,u){return void 0===u&&(u="normal"),{id:t.teamId+"-"+a,teamId:t.teamId,account:a,type:u,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:t.memberUpdateTime,updateTime:t.memberUpdateTime,active:!0,valid:!0}}function generatorMembersBySuperTeam(t,a,u){return void 0===u&&(u="normal"),a&&a.length>0?map$6(a).call(a,(function(a){return generatorMemberBySuperTeam(t,a,u)})):[]}var Rg=function(){function ModuleService(t){this.core=t}var t=ModuleService.prototype;return t.notifyAddSuperTeamMembers=function notifyAddSuperTeamMembers(t,a){this.core.emit("addSuperTeamMembers",{team:t,accounts:a,members:generatorMembersBySuperTeam(t,a)})},t.notifyUpdateSuperTeamManagers=function notifyUpdateSuperTeamManagers(t,a,u,m){this.core.emit("updateSuperTeamManagers",{team:{teamId:t,memberUpdateTime:m},accounts:a,isManager:u,members:map$6(a).call(a,(function(a){return{id:t+"-"+a,type:u?"manager":"normal",account:a,updateTime:m}}))})},t.notifyRemoveSuperTeamMembers=function notifyRemoveSuperTeamMembers(t,a){this.core.emit("removeSuperTeamMembers",{team:t,accounts:a})},t.notifyTransferSuperTeam=function notifyTransferSuperTeam(t,a,u){this.core.emit("transferSuperTeam",{team:t,from:{id:t.teamId+"-"+a,account:a,type:"normal",updateTime:t.memberUpdateTime},to:{id:t.teamId+"-"+u,account:u,type:"owner",updateTime:t.memberUpdateTime}})},t.notifyUpdateSuperTeamMembersMute=function notifyUpdateSuperTeamMembersMute(t,a,u){this.core.emit("updateSuperTeamMembersMute",{team:t,accounts:a,members:map$6(a).call(a,(function(a){return{id:t.teamId+"-"+a,account:a,teamId:t.teamId,mute:u,updateTime:t.memberUpdateTime}})),mute:u})},ModuleService}(),Og={"21_5":"addSuperTeamMembers","21_6":"removeSuperTeamMembers","21_7":"leaveSuperTeam","21_8":"updateSuperTeamInfo","21_9":"getSuperTeamInfo","21_12":"getSuperTeams","21_15":"getSuperTeamMembers","21_10":"updateMySuperTeamMemberInfo","21_20":"applySuperTeam","21_21":"passSuperTeamApply","21_22":"rejectSuperTeamApply","21_23":"acceptSuperTeamInvite","21_24":"rejectSuperTeamInvite","21_26":"addSuperTeamManagers","21_27":"removeSuperTeamManagers","21_28":"muteSuperTeam","21_29":"muteSuperTeamMembers","21_30":"updateSuperTeamMemberNick","21_31":"transferSuperTeam","21_33":"getSuperTeamMembersByAccounts","21_34":"queryMuteSuperTeamMembers","21_101":"syncCreateSuperTeam","21_109":"syncSuperTeams","21_110":"syncUpdateSuperTeamMember","21_111":"syncMySuperTeamMembers"},wg={superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,updateTime:11,ext:12,mute:13,invitorAccid:14,joinTime:15}},kg=invertSerializeMap(wg),xg={getSuperTeamInfo:{sid:21,cid:9,service:"superTeam",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"superTeam",reflectMapper:kg.superTeam}]},getSuperTeams:{sid:21,cid:12,service:"superTeam",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"superTeams",reflectMapper:kg.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},updateSuperTeamInfo:{sid:21,cid:8,service:"superTeam",params:[{type:"Property",name:"superTeam",reflectMapper:wg.superTeam}],response:[{type:"Long",name:"time"}]},addSuperTeamMembers:{sid:21,cid:5,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},removeSuperTeamMembers:{sid:21,cid:6,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},addSuperTeamManagers:{sid:21,cid:26,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:21,cid:27,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applySuperTeam:{sid:21,cid:20,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"superTeam",reflectMapper:kg.superTeam}]},transferSuperTeam:{sid:21,cid:31,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},muteSuperTeam:{sid:21,cid:28,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},muteSuperTeamMembers:{sid:21,cid:29,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"Int",name:"mute"}]},updateSuperTeamMemberNick:{sid:21,cid:30,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:wg.superTeamMember}]},updateMySuperTeamMemberInfo:{sid:21,cid:10,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:wg.superTeamMember}]},getSuperTeamMembersByAccounts:{sid:21,cid:33,service:"superTeam",params:[{type:"StrArray",name:"memberIds"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:kg.superTeamMember}]},getSuperTeamMembers:{sid:21,cid:15,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:kg.superTeamMember}]},queryMuteSuperTeamMembers:{sid:21,cid:34,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:kg.superTeamMember}]},leaveSuperTeam:{sid:21,cid:7,service:"superTeam",params:[{type:"Long",name:"teamId"}]},passSuperTeamApply:{sid:21,cid:21,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:21,cid:22,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:21,cid:23,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:21,cid:24,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncSuperTeams:{sid:21,cid:109,service:"superTeam",response:[{type:"PropertyArray",name:"teams",reflectMapper:kg.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},syncCreateSuperTeam:{sid:21,cid:101,service:"superTeam",response:[{type:"Property",name:"superTeam",reflectMapper:kg.superTeam}]},syncUpdateSuperTeamMember:{sid:21,cid:110,service:"superTeam",response:[{type:"Property",name:"teamMember",reflectMapper:kg.superTeamMember}]},syncMySuperTeamMembers:{sid:21,cid:111,ext:"sync",service:"superTeam",response:[{type:"PropertyArray",name:"teamMembers",reflectMapper:kg.superTeamMember},{type:"Long",name:"timetag"}]}},Pg=function(t){function SuperTeamService(a){var u;return(u=t.call(this,"superTeam",a)||this).mySuperTeamMembersMap=new pc,u.service=new Rg(a),registerParser({cmdMap:Og,cmdConfig:xg}),u.setListeners(),u}Ct(SuperTeamService,t);var a=SuperTeamService.prototype;return a.setListeners=function setListeners(){var t=this;this.core.eventBus.on("forwardReceive/superTeam/updateMyMemberInfo",(function(a){t.emitMemberUpdate(a)})),this.core.eventBus.on("team/onNotification",(function(a){return t.notificationHandler(a)}))},a.reset=function reset(){this.mySuperTeamMembersMap.clear()},a.mergeMySuperTeamMembers=function mergeMySuperTeamMembers(t){var a=this;forEach$1(t).call(t,(function(t){var u=t.teamId,m=a.mySuperTeamMembersMap.get(u),g=Lt({},m,t);a.mySuperTeamMembersMap.set(u,g)}))},a.getSuperTeamInfo=function getSuperTeamInfo(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a,u;return Zl.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),m.next=3,this.core.sendCmd("getSuperTeamInfo",{teamId:t.teamId});case 3:return a=m.sent,u=a.content.superTeam,m.abrupt("return",formatSuperTeam(u));case 6:case"end":return m.stop()}}),_callee,this)})))},a.getSuperTeams=function getSuperTeams(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var t,a;return Zl.wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.core.sendCmd("getSuperTeams",{timetag:0});case 2:return t=u.sent,a=t.content.superTeams,u.abrupt("return",formatSuperTeams(a));case 5:case"end":return u.stop()}}),_callee2,this)})))},a.updateSuperTeamInfo=function updateSuperTeamInfo(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var a;return Zl.wrap((function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},t),a=generateSuperTeam(t),u.next=4,this.core.sendCmd("updateSuperTeamInfo",{superTeam:a});case 4:return u.abrupt("return",formatSuperTeam(a));case 5:case"end":return u.stop()}}),_callee3,this)})))},a.addSuperTeamMembers=function addSuperTeamMembers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){return Zl.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("addSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts,ps:t.ps||"",attach:t.ext||""});case 3:case"end":return a.stop()}}),_callee4,this)})))},a.removeSuperTeamMembers=function removeSuperTeamMembers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){return Zl.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("removeSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts});case 3:case"end":return a.stop()}}),_callee5,this)})))},a.addSuperTeamManagers=function addSuperTeamManagers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee6(){return Zl.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("addSuperTeamManagers",t);case 3:case"end":return a.stop()}}),_callee6,this)})))},a.removeSuperTeamManagers=function removeSuperTeamManagers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee7(){return Zl.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("removeSuperTeamManagers",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.applySuperTeam=function applySuperTeam(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee8(){var a;return Zl.wrap((function _callee8$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),u.next=3,this.core.sendCmd("applySuperTeam",{teamId:t.teamId,ps:t.ps||""});case 3:return a=u.sent,u.abrupt("return",formatSuperTeam(a.content.superTeam));case 5:case"end":return u.stop()}}),_callee8,this)})))},a.transferSuperTeam=function transferSuperTeam(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee9(){return Zl.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},t),a.next=3,this.core.sendCmd("transferSuperTeam",t);case 3:case"end":return a.stop()}}),_callee9,this)})))},a.muteSuperTeam=function muteSuperTeam(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee10(){return Zl.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteSuperTeam",{teamId:t.teamId,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee10,this)})))},a.muteSuperTeamMembers=function muteSuperTeamMembers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee11(){return Zl.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string"},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.updateMemberNick=function updateMemberNick(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee12(){var a,u;return Zl.wrap((function _callee12$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},t),a=generatorSuperTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,account:t.account}),m.next=4,this.core.sendCmd("updateSuperTeamMemberNick",{teamMember:a});case 4:return u=formatSuperTeamMember(Lt({updateTime:(new Date).getTime()},a)),m.abrupt("return",u);case 6:case"end":return m.stop()}}),_callee12,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee13(){var a,u,m;return Zl.wrap((function _callee13$(g){for(;;)switch(g.prev=g.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},t),a=generatorSuperTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,bitConfigMask:t.bitConfigMask,ext:t.ext}),g.next=4,this.core.sendCmd("updateMySuperTeamMemberInfo",{teamMember:a});case 4:return u=formatSuperTeamMember(Lt({updateTime:(new Date).getTime(),account:this.core.account},a)),m=this.emitMemberUpdate(u),this.core.eventBus.emit("forwardSend/superTeam/updateMyMemberInfo",m),g.abrupt("return",u);case 8:case"end":return g.stop()}}),_callee13,this)})))},a.getSuperTeamMembersByAccounts=function getSuperTeamMembersByAccounts(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee14(){var u,m,g;return Zl.wrap((function _callee14$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:20,min:1}},t),m=map$6(u=t.accounts).call(u,(function(a){return t.teamId+"|"+a})),h.next=4,this.core.sendCmd("getSuperTeamMembersByAccounts",{memberIds:m});case 4:return g=h.sent,h.abrupt("return",formatSuperTeamMembers(null===(a=g.content)||void 0===a?void 0:a.superTeamMembers));case 6:case"end":return h.stop()}}),_callee14,this)})))},a.getSuperTeamMembers=function getSuperTeamMembers(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee15(){var u;return Zl.wrap((function _callee15$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,max:1e3,required:!1},reverse:{type:"boolean",required:!1}},t),m.next=3,this.core.sendCmd("getSuperTeamMembers",Lt({joinTime:0,limit:100,reverse:!1},t));case 3:return u=m.sent,m.abrupt("return",formatSuperTeamMembers(null===(a=u.content)||void 0===a?void 0:a.superTeamMembers));case 5:case"end":return m.stop()}}),_callee15,this)})))},a.queryMuteMembers=function queryMuteMembers(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee16(){var a,u;return Zl.wrap((function _callee16$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},t),m.next=3,this.core.sendCmd("queryMuteSuperTeamMembers",Lt({limit:100,joinTime:0,reverse:!1},t));case 3:return a=m.sent,u=a.content,m.abrupt("return",formatSuperTeamMembers(u.superTeamMembers));case 6:case"end":return m.stop()}}),_callee16,this)})))},a.leaveSuperTeam=function leaveSuperTeam(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee17(){return Zl.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("leaveSuperTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee17,this)})))},a.passSuperTeamApply=function passSuperTeamApply(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee18(){var a;return Zl.wrap((function _callee18$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),u.prev=1,u.next=4,this.core.sendCmd("passSuperTeamApply",t);case 4:this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",t),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),a=u.t0,this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",t,null==a?void 0:a.code),u.t0;case 12:case"end":return u.stop()}}),_callee18,this,[[1,7]])})))},a.rejectSuperTeamApply=function rejectSuperTeamApply(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee19(){var a;return Zl.wrap((function _callee19$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),u.prev=1,u.next=4,this.core.sendCmd("rejectSuperTeamApply",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",t),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),a=u.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",t,null==a?void 0:a.code),u.t0;case 12:case"end":return u.stop()}}),_callee19,this,[[1,7]])})))},a.acceptSuperTeamInvite=function acceptSuperTeamInvite(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee20(){var a;return Zl.wrap((function _callee20$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),u.prev=1,u.next=4,this.core.sendCmd("acceptSuperTeamInvite",t);case 4:this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",t),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),a=u.t0,this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",t,null==a?void 0:a.code),u.t0;case 12:case"end":return u.stop()}}),_callee20,this,[[1,7]])})))},a.rejectSuperTeamInvite=function rejectSuperTeamInvite(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee21(){var a;return Zl.wrap((function _callee21$(u){for(;;)switch(u.prev=u.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),u.prev=1,u.next=4,this.core.sendCmd("rejectSuperTeamInvite",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",t),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),a=u.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",t,null==a?void 0:a.code),u.t0;case 12:case"end":return u.stop()}}),_callee21,this,[[1,7]])})))},a.emitMemberUpdate=function emitMemberUpdate(t){t=formatSuperTeamMember(t),this.mergeMyTeamMembers([t]),this.core.emit("updateTeamMember",t);var a=cloneDeep(this.mySuperTeamMembersMap.get(t.teamId));return this.core.emit("myTeamMembers",[a]),a},a.mergeMyTeamMembers=function mergeMyTeamMembers(t){var a=this;forEach$1(t).call(t,(function(t){var u=t.teamId,m=a.mySuperTeamMembersMap.get(u),g=Lt({},m,t);a.mySuperTeamMembersMap.set(u,g)}))},a.syncSuperTeamsHandler=function syncSuperTeamsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{superTeams:Cu(a.timetag)});var u=null==a?void 0:a.teams;if(u&&u.length){var m=formatSuperTeams(u);this.core.emit("superTeams",m)}},a.syncCreateSuperTeamHandler=function syncCreateSuperTeamHandler(t){var a=t.content,u=formatSuperTeam(null==a?void 0:a.superTeam),m=generatorMemberBySuperTeam(u,u.owner,"owner");this.core.emit("createSuperTeam",u,m)},a.syncUpdateSuperTeamMemberHandler=function syncUpdateSuperTeamMemberHandler(t){var a=t.content,u=formatSuperTeamMember(null==a?void 0:a.teamMember);u.updateTime||(u.updateTime=(new Date).getTime()),this.mergeMySuperTeamMembers([u]),this.core.emit("updateSuperTeamMember",u);var m=cloneDeep(this.mySuperTeamMembersMap.get(u.teamId));this.core.emit("mySuperTeamMembers",[m])},a.syncMySuperTeamMembersHandler=function syncMySuperTeamMembersHandler(t){var a,u=t.content;this.core.eventBus.emit("sync/updateTimetag",{mySuperTeamMembers:Cu(u.timetag)});var m=null==u?void 0:map$6(a=u.teamMembers).call(a,(function(t){return formatSuperTeamMember(t)}));this.mergeMySuperTeamMembers(m),this.core.emit("mySuperTeamMembers",cloneDeep(m))},a.notificationHandler=function notificationHandler(t){var a=t.attach,u=t.scene,m=t.from,g=t.to,h=t.time,_=t.idServer,E=t.idClient,T=a.team,S=a.account,M=a.accounts,I=a.type;if("superTeam"===u)switch(this.logger.getDebugMode()?this.logger.debug("superTeam::recvNotification",_,E,a):this.logger.log("superTeam::recvNotification",_,E,g,I,S,M),I){case"updateSuperTeam":T.updateTime=h,this.core.emit("updateSuperTeam",T);break;case"addSuperTeamMembers":this.service.notifyAddSuperTeamMembers(T,M);break;case"acceptSuperTeamInvite":this.service.notifyAddSuperTeamMembers(T,[m]);break;case"passSuperTeamApply":this.service.notifyAddSuperTeamMembers(T,[S]);break;case"addSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(g,M,!0,h);break;case"removeSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(g,M,!1,h);break;case"removeSuperTeamMembers":this.service.notifyRemoveSuperTeamMembers(T,M);break;case"leaveSuperTeam":this.service.notifyRemoveSuperTeamMembers(T,[m]);break;case"dismissSuperTeam":this.core.emit("dismissSuperTeam",{teamId:g});break;case"transferSuperTeam":this.service.notifyTransferSuperTeam(T,m,S);break;case"updateSuperTeamMembersMute":this.service.notifyUpdateSuperTeamMembersMute(T,M,a.mute)}},SuperTeamService}(ip),Lg={"13_1":"getChatroomAddress","24_1":"getQChatAddress"},Dg={getChatroomAddress:{sid:13,cid:1,service:"plugin",params:[{type:"Long",name:"chatroomId"},{type:"Bool",name:"isWeixinApp"},{type:"Int",name:"ipType"}],response:[{type:"StrArray",name:"address"}]},getQChatAddress:{sid:24,cid:1,service:"plugin",params:[{type:"Property",name:"getQChatAddressTag",reflectMapper:{ipType:1}}],response:[{type:"StrArray",name:"address"}]}},Vg=function(t){function PluginService(a){var u;return(u=t.call(this,"plugin",a)||this).core=a,registerParser({cmdMap:Lg,cmdConfig:Dg}),u}Ct(PluginService,t);var a=PluginService.prototype;return a.getChatroomAddress=function getChatroomAddress(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var a;return Zl.wrap((function _callee$(u){for(;;)switch(u.prev=u.next){case 0:return validate({chatroomId:{type:"string",allowEmpty:!1},ipType:{type:"number",required:!1}},t),u.next=3,this.core.sendCmd("getChatroomAddress",{chatroomId:t.chatroomId,isWeixinApp:"WXAPP"===eu.platform,ipType:t.ipType||0});case 3:return a=u.sent,u.abrupt("return",a.content.address);case 5:case"end":return u.stop()}}),_callee,this)})))},a.getQChatAddress=function getQChatAddress(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a;return Zl.wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:return validate({ipType:{type:"number",required:!1}},t),u.next=3,this.core.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:(null==t?void 0:t.ipType)||0}});case 3:return a=u.sent,u.abrupt("return",a.content.address);case 5:case"end":return u.stop()}}),_callee2,this)})))},PluginService}(ip),Ug={"7_19":"nimQueryCloudSessionList","7_20":"nimQueryCloudSession","7_21":"nimUpdateCloudSession","7_22":"nimDeleteCloudSessionList","7_121":"nimMultiSyncUpdateCloudSession"},Fg={sessionReqTag:{minTimestamp:1,maxTimestamp:2,includedLastMsg:3,limit:4,hasMore:5},sessionTag:{sessionId:1,updateTime:2,ext:3,lastMsg:4,lastMsgType:5}},Bg=invertSerializeMap(Fg),Gg={nimQueryCloudSessionList:{sid:7,cid:19,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:Fg.sessionReqTag}],response:[{type:"Property",name:"tag",reflectMapper:Bg.sessionReqTag},{type:"PropertyArray",name:"sessions",reflectMapper:Bg.sessionTag}]},nimQueryCloudSession:{sid:7,cid:20,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:Fg.sessionTag}],response:[{type:"Property",name:"session",reflectMapper:Bg.sessionTag}]},nimUpdateCloudSession:{sid:7,cid:21,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:Fg.sessionTag}]},nimDeleteCloudSessionList:{sid:7,cid:22,service:"cloudSession",params:[{type:"PropertyArray",name:"tags",reflectMapper:Fg.sessionTag}]},nimMultiSyncUpdateCloudSession:{sid:7,cid:121,service:"cloudSession",response:[{type:"Property",name:"session",reflectMapper:Bg.sessionTag}]}},Hg={sessionId:{type:"string"},updateTime:{type:"number"},ext:{type:"string"},lastMsg:{type:"object"},lastMsgType:{type:"number"}};function formatCloudSession(t,a,u){var m=format(Hg,t),g=getAccountFromSessionId(m.sessionId,"|"),h=g.accid,_=g.scene;if(m.sessionId=_+"-"+h,m.lastMsg){var E=1===m.lastMsgType;m.lastMsgInfo=E?{isLastMsgRecalled:E,revokedMsg:formatSystemMessage(deserialize(m.lastMsg,_m.sysMsg),u)}:{isLastMsgRecalled:E,lastMsg:formatMsg(deserialize(m.lastMsg,Jp.msg),{account:a})}}return delete m.lastMsg,delete m.lastMsgType,m}function formatCloudSessions(t,a,u){return t&&t.length>0?map$6(t).call(t,(function(t){return formatCloudSession(t,a,u)})):[]}var jg=function(t){function CloudSessionService(a){var u;return u=t.call(this,"cloudSession",a)||this,registerParser({cmdMap:Ug,cmdConfig:Gg}),u}Ct(CloudSessionService,t);var a=CloudSessionService.prototype;return a.queryCloudSessionList=function queryCloudSessionList(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var u,m,g,h;return Zl.wrap((function _callee$(_){for(;;)switch(_.prev=_.next){case 0:return validate({minTimestamp:{type:"number",min:0,required:!1},maxTimestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},includedLastMsg:{type:"boolean",required:!1}},t),(u=Lt({limit:100,includedLastMsg:!0},t)).includedLastMsg=Kd.boolean(t,"includedLastMsg"),_.next=5,this.core.sendCmd("nimQueryCloudSessionList",{tag:u});case 5:return m=_.sent,g=(null===(a=m.content)||void 0===a?void 0:a.tag)||{},h=m.content.sessions,_.abrupt("return",{hasMore:+g.hasMore>0,sessionList:formatCloudSessions(h,this.core.account,this.logger)});case 9:case"end":return _.stop()}}),_callee,this)})))},a.queryCloudSession=function queryCloudSession(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var a,u,m,g;return Zl.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return validate({sessionId:{type:"string",allowEmpty:!1}},t),a=getAccountFromSessionId(t.sessionId,"-"),u=a.accid,m=a.scene,h.next=4,this.core.sendCmd("nimQueryCloudSession",{tag:{sessionId:"superTeam"===m?"super_team|"+u:m+"|"+u}});case 4:return g=h.sent,h.abrupt("return",formatCloudSession(g.content.session,this.core.account,this.logger));case 6:case"end":return h.stop()}}),_callee2,this)})))},a.updateCloudSession=function updateCloudSession(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var a,u,m;return Zl.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:return validate({sessionId:{type:"string",allowEmpty:!1},ext:{type:"string",allowEmpty:!1,required:!1}},t),a=getAccountFromSessionId(t.sessionId,"-"),u=a.accid,m=a.scene,g.next=4,this.core.sendCmd("nimUpdateCloudSession",{tag:{sessionId:"superTeam"===m?"super_team|"+u:m+"|"+u,ext:t.ext}});case 4:case"end":return g.stop()}}),_callee3,this)})))},a.deleteCloudSessionList=function deleteCloudSessionList(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){var a,u;return Zl.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return validate({sessionIdList:{type:"array",itemType:"string"}},t),u=map$6(a=t.sessionIdList).call(a,(function(t){var a=getAccountFromSessionId(t,"-"),u=a.accid,m=a.scene;return{sessionId:"superTeam"===m?"super_team|"+u:m+"|"+u}})),m.next=4,this.core.sendCmd("nimDeleteCloudSessionList",{tags:u});case 4:case"end":return m.stop()}}),_callee4,this)})))},a.nimMultiSyncUpdateCloudSessionHandler=function nimMultiSyncUpdateCloudSessionHandler(t){var a=formatCloudSession(t.content.session,this.core.account,this.logger);this.core.emit("multiSyncUpdateCloudSession",a)},CloudSessionService}(ip),qg={needPush:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needPushBadge:{type:"boolean",required:!1}},Yg={"15_1":"signalingCreate","15_2":"signalingDelay","15_3":"signalingClose","15_4":"signalingJoin","15_5":"signalingLeave","15_6":"signalingInvite","15_7":"signalingCancelInvite","15_8":"signalingReject","15_9":"signalingAccept","15_10":"signalingSendCustomCommand","15_11":"signalingRecvNotification","15_12":"signalingMultiSyncNotification","15_13":"signalingSyncNotification","15_14":"singalingSyncChannels","15_15":"signalingQueryInfo","15_16":"signalingCallEx","15_17":"signalingJoinAndAccept"},Kg={avSignalTag:Lt({type:1,name:2,channelId:3,createTime:4,expireTime:5,creatorAccid:6,ext:7,invalid:8,fromAccid:10,toAccid:11,requestId:12,members:18,attach:19,attachExt:20,needOffline:21,msgId:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},{needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needPushBadge:17})},Wg=invertSerializeMap(Kg),$g={signalingCreate:{sid:15,cid:1,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Wg.avSignalTag}]},signalingDelay:{sid:15,cid:2,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Wg.avSignalTag}]},signalingClose:{sid:15,cid:3,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Wg.avSignalTag}]},signalingJoin:{sid:15,cid:4,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Wg.avSignalTag}]},signalingLeave:{sid:15,cid:5,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}]},signalingInvite:{sid:15,cid:6,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}]},signalingCancelInvite:{sid:15,cid:7,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}]},signalingReject:{sid:15,cid:8,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}]},signalingAccept:{sid:15,cid:9,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}]},signalingSendCustomCommand:{sid:15,cid:10,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}]},signalingRecvNotification:{sid:15,cid:11,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:Wg.avSignalTag}]},signalingMultiSyncNotification:{sid:15,cid:12,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:Wg.avSignalTag}]},signalingSyncNotification:{sid:15,cid:13,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:Wg.avSignalTag}]},singalingSyncChannels:{sid:15,cid:14,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:Wg.avSignalTag}]},signalingQueryInfo:{sid:15,cid:15,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Wg.avSignalTag}]},signalingCallEx:{sid:15,cid:16,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Wg.avSignalTag}]},signalingJoinAndAccept:{sid:15,cid:17,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Kg.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Wg.avSignalTag}]},signalingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:"signaling",params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},zg={type:{type:"number"},createTime:{type:"number"},expireTime:{type:"number"},invalid:{type:"boolean"},pushInfo:qg,pluginSetting:{nertcInfo:{nertcChannelName:{type:"string"},nertcTokenTtl:{type:"number"},nertcToken:{type:"string"},nertcJoinRoomQueryParamMap:{type:"string"},callStatus:{type:"number"}}},callStatus:{type:"number"},attach:{type:"object"},members:{type:"object"},needOffline:{type:"boolean"},uid:{type:"number"},time:{type:"number"}};function formatSignalingChannelMember(t){return format(zg,deserialize(t,{1:"accid",2:"uid",3:"createTime",4:"expireTime"}))}function formatSignaling(t){var a,u=format(zg,t),m=[];u.members&&u.members.length>0&&(m=map$6(a=u.members).call(a,(function(t){return formatSignalingChannelMember(t)})),delete u.members);return m.length>0?{channelInfo:u,memberList:m}:{channelInfo:u}}function formatSignalingWithCallStatus(t){var a,u=format(zg,t),m=[];u.members&&u.members.length>0&&(m=map$6(a=u.members).call(a,(function(t){return formatSignalingChannelMember(t)})),delete u.members);var g=200;return t.callStatus&&(g=Number(t.callStatus)),m.length>0?{channelInfo:u,memberList:m,callStatus:g}:{channelInfo:u,callStatus:g}}function generateSignalingForCmd(t){return formatReverse(zg,t)}var Jg=function(t){function SignalingService(a){var u;return(u=t.call(this)||this).timer=0,u.pollingInterval=12e4,u.name="signaling",u.logger=a.logger,u.core=a,u.channels={},registerParser({cmdMap:Yg,cmdConfig:$g}),u}Ct(SignalingService,t);var a=SignalingService.prototype;return a.callEx=function callEx(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee(){var u,m,g,h;return Zl.wrap((function _callee$(_){for(;;)switch(_.prev=_.next){case 0:return validate({type:{type:"number"},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:qg},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},t),_.next=3,this.core.sendCmd("signalingCallEx",{tag:generateSignalingForCmd(t)});case 3:return u=_.sent,m=(null===(a=u.content)||void 0===a?void 0:a.data)||{},g=formatSignalingWithCallStatus(m),this.channels[g.channelInfo.channelId]=cloneDeep(g.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(h=this.aotoDelay).call(h,this),this.pollingInterval,-1)),_.abrupt("return",g);case 9:case"end":return _.stop()}}),_callee,this)})))},a.joinAndAccept=function joinAndAccept(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee2(){var u,m,g,h,_,E;return Zl.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},uid:{type:"number",required:!1},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},t),u=t.fromAccid,(m=__rest(t,["fromAccid"])).toAccid=u,T.next=5,this.core.sendCmd("signalingJoinAndAccept",{tag:generateSignalingForCmd(m)});case 5:return g=T.sent,h=(null===(a=g.content)||void 0===a?void 0:a.data)||{},_=formatSignalingWithCallStatus(h),this.channels[_.channelInfo.channelId]=cloneDeep(_.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(E=this.aotoDelay).call(E,this),this.pollingInterval,-1)),T.abrupt("return",_);case 11:case"end":return T.stop()}}),_callee2,this)})))},a.create=function create(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee3(){var u,m;return Zl.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:return validate({type:{type:"number"},ext:{type:"string",required:!1}},t),g.next=3,this.core.sendCmd("signalingCreate",{tag:generateSignalingForCmd(t)});case 3:return u=g.sent,m=(null===(a=u.content)||void 0===a?void 0:a.data)||{},g.abrupt("return",formatSignaling(m));case 6:case"end":return g.stop()}}),_callee3,this)})))},a.close=function close(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee4(){return Zl.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingClose",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee4,this)})))},a.queryInfo=function queryInfo(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee5(){var u,m;return Zl.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return validate({name:{type:"string",allowEmpty:!1}},t),g.next=3,this.core.sendCmd("signalingQueryInfo",{tag:t});case 3:return u=g.sent,m=(null===(a=u.content)||void 0===a?void 0:a.data)||{},g.abrupt("return",formatSignaling(m));case 6:case"end":return g.stop()}}),_callee5,this)})))},a.join=function join(t){var a;return __awaiter(this,void 0,void 0,Zl.mark((function _callee6(){var u,m,g,h;return Zl.wrap((function _callee6$(_){for(;;)switch(_.prev=_.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},uid:{type:"number",min:0,required:!1},needOffline:{type:"boolean",required:!1}},t),_.next=3,this.core.sendCmd("signalingJoin",{tag:generateSignalingForCmd(t)});case 3:return u=_.sent,m=(null===(a=u.content)||void 0===a?void 0:a.data)||{},g=formatSignaling(m),this.channels[g.channelInfo.channelId]=cloneDeep(g.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(h=this.aotoDelay).call(h,this),this.pollingInterval,-1)),_.abrupt("return",g);case 9:case"end":return _.stop()}}),_callee6,this)})))},a.aotoDelay=function aotoDelay(){return __awaiter(this,void 0,void 0,Zl.mark((function _callee7(){var t,a,u,m,g;return Zl.wrap((function _callee7$(h){for(;;)switch(h.prev=h.next){case 0:if(0!==(t=Bt(this.channels)).length){h.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,h.abrupt("return");case 5:this.logger.log("signling:autoDelay",t),a=0;case 7:if(!(a<t.length)){h.next=24;break}return u=t[a],h.prev=9,h.next=12,this.core.sendCmd("signalingDelay",{tag:{channelId:u}});case 12:m=h.sent,g=formatSignaling(m.content.data),this.channels[u]=g.channelInfo,h.next=21;break;case 17:h.prev=17,h.t0=h.catch(9),this.logger.warn("signling:autoDelay "+u+" failed",h.t0),delete this.channels[u];case 21:a++,h.next=7;break;case 24:case"end":return h.stop()}}),_callee7,this,[[9,17]])})))},a.leave=function leave(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee8(){return Zl.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingLeave",{tag:generateSignalingForCmd(t)});case 3:delete this.channels[t.channelId];case 4:case"end":return a.stop()}}),_callee8,this)})))},a.invite=function invite(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee9(){return Zl.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:qg}},t),a.next=3,this.core.sendCmd("signalingInvite",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee9,this)})))},a.cancelInvite=function cancelInvite(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee10(){return Zl.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingCancelInvite",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee10,this)})))},a.reject=function reject(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee11(){var a,u;return Zl.wrap((function _callee11$(m){for(;;)switch(m.prev=m.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a=t.fromAccid,(u=__rest(t,["fromAccid"])).toAccid=a,m.next=5,this.core.sendCmd("signalingReject",{tag:generateSignalingForCmd(u)});case 5:case"end":return m.stop()}}),_callee11,this)})))},a.accept=function accept(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee12(){var a,u,m,g,h;return Zl.wrap((function _callee12$(_){for(;;)switch(_.prev=_.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},autoJoin:{type:"boolean",required:!1},uid:{type:"number",min:0,required:!1},joinAttachExt:{type:"string",required:!1}},t),a=t.autoJoin,u=t.joinAttachExt,m=t.fromAccid,(g=__rest(t,["autoJoin","joinAttachExt","fromAccid"])).toAccid=m,_.next=5,this.core.sendCmd("signalingAccept",{tag:generateSignalingForCmd(g)});case 5:if(this.logger.log("Signaling:accept, accept success, autoJoin "+t.autoJoin),!a){_.next=10;break}return h={channelId:t.channelId,needOffline:t.needOffline,attachExt:u,uid:t.uid},_.next=10,this.join(h);case 10:case"end":return _.stop()}}),_callee12,this)})))},a.sendCustomCommand=function sendCustomCommand(t){return __awaiter(this,void 0,void 0,Zl.mark((function _callee13(){return Zl.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},attachExt:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("signalingSendCustomCommand",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee13,this)})))},a.signalingRecvNotificationHandler=function signalingRecvNotificationHandler(t){var a=fillIdServer(t,t.content.data,"msgId","0"),u=a.msgId;this.doNotify(a),u&&Cu(u)&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:[u]})},a.signalingMultiSyncNotificationHandler=function signalingMultiSyncNotificationHandler(t){this.doNotify(t.content.data,3)},a.doNotify=function doNotify(t,a){void 0===a&&(a=0);var u=function formatSignalingNotification(t,a){void 0===a&&(a=0);var u=format(zg,t),m=u.attach,g=u.attachExt,h=u.time,_=u.msgId;u.fromAccid,u.toAccid,u.members,u.requestId,u.pushInfo;var E=__rest(u,["attach","attachExt","time","msgId","fromAccid","toAccid","members","requestId","pushInfo"]);if(2===m.type)try{u.member={accid:u.attach.member[1],uid:Number(u.attach.member[2]),createTime:Number(u.attach.member[3]),expireTime:Number(u.attach.member[4])}}catch(t){delete u.member}var T=m.type;return delete u.attach,{metaData:{eventType:T,channelInfo:E,feature:a,ext:g||"",time:h,msgId:_},rawData:u}}(t,a),m=u.metaData,g=u.rawData,h=g.fromAccid,_=g.toAccid,E=g.requestId,T=g.pushInfo,S=g.msgId,M=g.member;switch(m.eventType){case 1:this.emit("signalingClose",{fromAccid:h,metaData:m});break;case 2:this.emit("signalingJoin",{fromAccid:h,metaData:m,member:M});break;case 3:this.emit("signalingInvite",{fromAccid:h,toAccid:_,requestId:E,pushInfo:T,metaData:m});break;case 4:this.emit("signalingCancelInvite",{fromAccid:h,toAccid:_,requestId:E,metaData:m});break;case 5:this.emit("signalingReject",{fromAccid:h,toAccid:_,requestId:E,metaData:m});break;case 6:this.emit("signalingAccept",{fromAccid:h,toAccid:_,requestId:E,metaData:m});break;case 7:this.emit("signalingLeave",{fromAccid:h,metaData:m});break;case 8:this.emit("signalingCustomCommand",{fromAccid:h,metaData:m});break;default:this.logger.warn("signaling:notification, no such a type "+m.eventType,g)}return S},a.signalingSyncNotificationHandler=function signalingSyncNotificationHandler(t){var a,u,m=this;if(t.content.datas&&t.content.datas.length>0){var g=filter(a=map$6(u=t.content.datas).call(u,(function(t){return m.doNotify(t,1)}))).call(a,(function(t){return t}));g.length>0&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:g})}},a.singalingSyncChannelsHandler=function singalingSyncChannelsHandler(t){var a,u=this;if(this.timer=0,this.channels={},t.content.datas&&t.content.datas.length>0){var m=map$6(a=t.content.datas).call(a,(function(t){return formatSignaling(t)}));forEach$1(m).call(m,(function(t){var a=t.channelInfo.channelId;u.channels[a]=cloneDeep(t.channelInfo)})),this.emit("singalingSyncChannels",m)}},a.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a)return a.call(this,t),Ho.resolve(t);var u=get(t,"error.detail.ignore");return t.error&&!u?Ho.reject(t.error):Ho.resolve(t)},SignalingService}(ca.EventEmitter);return function setAdapters(t){merge$1(eu,t())}((function getAdapter(){return{setLogger:setLogger,platform:"BROWSER",localStorage:window.localStorage,request:Zu,WebSocket:window.WebSocket,uploadFile:uploadFileFn,getFileUploadInformation:getFileUploadInformationFn,getSystemInfo:getSystemInfoFn,net:Ad,powerMonitor:new Cd,logStorage:kd}})),Qu.registerService(pp,"V1NIMLoginService"),Qu.registerService(em,"msg"),Qu.registerService(im,"user"),Qu.registerService(pm,"session"),Qu.registerService(gm,"team"),Qu.registerService(ym,"systemMessage"),Qu.registerService(Am,"friend"),Qu.registerService(Om,"event"),Qu.registerService(Dm,"msgExtend"),Qu.registerService(Km,"msgLog"),Qu.registerService(Xm,"passThrough"),Qu.registerService(fg,"cloudStorage"),Qu.registerService(Pg,"superTeam"),Qu.registerService(nm,"sync"),Qu.registerService(Vg,"plugin"),Qu.registerService(jg,"cloudSession"),Qu.registerService(Jg,"signaling"),Qu}));
