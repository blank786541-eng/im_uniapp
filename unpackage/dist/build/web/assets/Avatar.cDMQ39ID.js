import{d as e,g as t,q as a,h as o,c as r,E as n,j as s,o as l,a as i,l as u,G as c,u as d,k as m,t as v,x as I,p,y as g}from"./index-CA_4_S1o.js";import{_ as f}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=f(e({__name:"Avatar",props:{account:{},width:{default:"53px"},height:{default:"53px"},teamId:{default:""},avatar:{default:""},size:{default:""},gotoUserCard:{type:Boolean,default:!1},fontSize:{default:""},isRedirect:{type:Boolean,default:!1},isManager:{type:Boolean,default:!1}},emits:["onLongpress"],setup(e,{emit:f}){const S=e,_=f;let y=!1;S.size;const U=t();let M=!1;const $=t("");a(()=>{!function(){if(S.teamId){const e=uni.$UIKitStore.teamMemberStore.getTeamMember(S.teamId,[uni.$UIKitStore.userStore.myUserInfo.accountId])[0];e&&(A=e.memberRole==n.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER||e.memberRole==n.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_OWNER)}}()});const h=o(()=>{var e;$.value=null==(e=uni.$UIKitStore.uiStore.getAppellation({account:S.account,ignoreAlias:!1}))?void 0:e.slice(0,2)}),E=o(()=>{var e,t;null==(t=null==(e=uni.$UIKitStore)?void 0:e.userStore)||t.getUserActive(S.account).then(e=>{U.value=e,y=uni.$UIKitStore.uiStore.friends.filter(e=>!uni.$UIKitStore.relationStore.blacklist.includes(e.accountId)).some(e=>e.accountId===S.account)})}),R=r(()=>{var e,t,a,o;return U.value=null==(a=null==(t=null==(e=uni.$UIKitStore)?void 0:e.userStore)?void 0:t.users)?void 0:a.get(S.account),S.avatar||(null==(o=U.value)?void 0:o.avatar)}),x=`__yx_avatar_color_${S.account}__`;let b=uni.getStorageSync(x);if(!b){const e={0:"#60CFA7",1:"#53C3F3",2:"#537FF4",3:"#854FE2",4:"#BE65D9",5:"#E9749D",6:"#F9B751"}[Math.floor(7*Math.random())];uni.setStorageSync(x,e),b=e}let A=!1;const K=()=>{var e,t,a,o;console.log(`isFriend:${y}manager:${A} `),S.gotoUserCard&&!M&&(S.isRedirect?(S.teamId&&A||y)&&(S.account===(null==(t=null==(e=uni.$UIKitStore)?void 0:e.userStore)?void 0:t.myUserInfo.accountId)?I({url:"/pages/User/my/my-detail"}):I({url:`/pages/User/friend/index?account=${S.account}&conversationId=${S.teamId}`})):(S.teamId&&A||y)&&(S.account===(null==(o=null==(a=uni.$UIKitStore)?void 0:a.userStore)?void 0:o.myUserInfo.accountId)?p({url:"/pages/User/my/my-detail"}):p({url:`/pages/User/friend/index?account=${S.account}&conversationId=${S.teamId}`})))},F=()=>{M=!0,_("onLongpress")},T=()=>{const e=setTimeout(()=>{M=!1,clearTimeout(e)},200)};return s(()=>{E(),h()}),(e,t)=>{const a=g;return l(),i("div",{class:"avatar",style:c({width:S.width,height:S.height}),onClick:K,onLongpress:F,onTouchend:T},[R.value?(l(),u(a,{key:0,"lazy-load":!0,class:"avatar-img",src:R.value,mode:"aspectFill"},null,8,["src"])):(l(),i("div",{key:1,class:"avatar-name-wrapper",style:c({backgroundColor:d(b)})},[m("div",{class:"avatar-name-text",style:{fontSize:"13px"}},v($.value),1)],4))],36)}}}),[["__scopeId","data-v-b00db510"]]);export{S as A};
