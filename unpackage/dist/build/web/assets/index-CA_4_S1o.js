function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./pages-Conversation-index.C7VpNxJ5.js","./uni-app.es.f5Xd5cz1.js","./Empty.DhhBt1kg.js","./_plugin-vue_export-helper.BCo6x5W8.js","./Empty-B5L5g8VQ.css","./Avatar.cDMQ39ID.js","./Avatar-dkwObndw.css","./Appellation.vue_vue_type_script_setup_true_lang.Bn2FxhVA.js","./Icon.DO2Wg01x.js","./Icon-Cv2ZCaAV.css","./dayjs.min.CwOgZug2.js","./emoji.SrFHKbUG.js","./reporter.BDLo06V-.js","./HeaderInput.NhHrJsao.js","./AssetsImage.D01ldk7e.js","./AssetsImage-CH-3dxF9.css","./HeaderInput-DnkmbjiR.css","./index-D6DcvPv9.css","./pages-index-index.CI_0cHw_.js","./index-B1hcg2gj.css","./pages-Bao-index.CWsrEzZ5.js","./defaultHeader.BLoWIqPs.js","./defaultHeader-DnYl53oM.css","./index-CzrNMA9B.css","./pages-Bao-my-order.CZJ8FQxY.js","./bao-header.DXmW7jS-.js","./bao-header-CIGsF-y6.css","./my-order-B2gweiHm.css","./pages-Bao-team.Ck3_-uz9.js","./team-ZJOrE4Nl.css","./pages-Bao-detail.CK3h8CBh.js","./detail-BLF2LzEf.css","./pages-Bao-pay-detail.B0rQwBUL.js","./FormInput.sYKNP4AX.js","./FormInput-wEZAvPMt.css","./uni-popup.BNglwmFT.js","./uni-popup-kHh-bS7x.css","./pay-detail-DsZFXZwm.css","./pages-Bao-certification.JE9ZAn_b.js","./form-input.CNku4d-1.js","./form-input-B6CnSRjv.css","./certification-D7lTPPc3.css","./pages-Conversation-conversation-search-index.FIGbChhe.js","./search-input.CZNuPT7x.js","./search-input-DfNlYgnB.css","./index-BxhSjPOv.css","./pages-Login-login-form.DfV4PO49.js","./logo.JMJ4T4w9.js","./label-input.93u5bOWo.js","./label-input-DtuL6LKU.css","./config.A7D2bxor.js","./login-form-B4mAvwqf.css","./pages-Login-changePassword.BbUhA4ZP.js","./changePassword-F02nKQ6-.css","./pages-Login-register.Dmuxk_RP.js","./register-ZNjAqU1-.css","./pages-Chat-index.CgZg0YlL.js","./page-meta.phPE4ZZK.js","./message-text.6ab8ngmM.js","./message-file.BFObQXzu.js","./message-file-D71t8gZU.css","./message-text-Dt1kBNcv.css","./date.BkwCqfeE.js","./permission.DD8MzfWC.js","./index-6zuXy_I-.css","./pages-Chat-video-play.BVMV33u8.js","./NavBar.B_pGq4kd.js","./NavBar-Dgc1Dk1a.css","./video-play-z-WRcQEi.css","./pages-Other-scan.gKkHyVJ7.js","./scan-B_F3Wi0k.css","./pages-Other-webview.BQ4gRVi5.js","./webview-l1lC-Rl_.css","./pages-Other-video-call.B3O55wRa.js","./NERTC.C_LcuRBv.js","./video-call-CheSBIOB.css","./pages-Other-team-video-call.CTNtitIo.js","./team-video-call-Bhvd9_S4.css","./pages-Other-select-call-user.CA773i42.js","./PersonSelect.cBJMe6Rx.js","./PersonSelect-BsXU3vq4.css","./select-call-user-BfwVJDvw.css","./pages-Chat-message-p2p-set.EouS19yr.js","./p2p-set-BaGfAwsi.css","./pages-Chat-message-add-note.DcUK7p9k.js","./add-note-DVFGO27F.css","./pages-Chat-message-pin-list.C_K-4mps.js","./pin-list-Dn1hT0MY.css","./pages-Chat-forward.Dd_OktAg.js","./friend.CuoyITGk.js","./forward-Dizkpqn9.css","./pages-Chat-message-read-info.R8zk9OCE.js","./message-read-info-FhjUzqRS.css","./pages-Team-team-set-index.DiD0TgHx.js","./index-C56k1V2_.css","./pages-Team-team-set-team-qrcode.BNXlPR2l.js","./uqrcode.D_gmVgak.js","./team-qrcode-57NBi6XV.css","./pages-Team-team-set-team-info-edit.B_OqjccM.js","./team-info-edit-WQIsK3k1.css","./pages-Team-team-set-team-name-edit.BueML1Jw.js","./team-name-edit-C7LCjHbb.css","./pages-Team-team-set-team-intro-edit.DHRgonQq.js","./team-intro-edit-BL4C7AdF.css","./pages-Team-team-set-team-avatar-edit.e9V7yJ35.js","./team-avatar-edit-Byo5ZR3L.css","./pages-Team-team-set-nick-in-team.frWg4DaK.js","./nick-in-team-Bf6odimu.css","./pages-Team-team-set-team-manage.eciKHBmc.js","./team-manage-CWgiKs00.css","./pages-Team-team-set-transform-team.DgzsPAQl.js","./transform-team-Wm4blQN3.css","./pages-Team-team-set-team-manager-list.C2FPL2lI.js","./team-manager-list-BUXh8CQa.css","./pages-Team-team-set-add-team-manager.KbygS5q2.js","./add-team-manager-C7G2Mpa8.css","./pages-Team-team-member-index.BSiKoRIP.js","./index-CrVCYLDH.css","./pages-Team-team-create-index.CwZ8DahQ.js","./index-zin0YO_6.css","./pages-Team-team-add-index.BVIFHXP3.js","./index-BrQgE_dR.css","./pages-Contact-index.CkCJy8cu.js","./index-DuFhUj61.css","./pages-Contact-contact-list-group-list.S0JDRtrb.js","./group-list-Dre48zlx.css","./pages-Contact-contact-list-valid-list.CNvO1CZ2.js","./valid-list-n6ov2TDt.css","./pages-Contact-contact-list-black-list.BNEPb3sO.js","./black-list-epS1axy7.css","./pages-User-friend-add-friend.BzbBphTr.js","./add-friend-CUTIPWp9.css","./pages-User-friend-friend-edit.DRJMakca.js","./friend-edit-Dxv6dWiC.css","./pages-User-friend-index.D0JS-6zH.js","./UserCard.Crym-xlU.js","./UserCard-BlpPfjO4.css","./index-BI3uX_9v.css","./pages-User-my-index.Bs-PbgDz.js","./index-npKItKqq.css","./pages-User-my-about.CClTslkE.js","./about-G4BBYX4V.css","./pages-User-my-setting.Df4Oysie.js","./setting-C7La0AOy.css","./pages-User-my-my-detail.DIJ_qwXA.js","./my-detail-B5QuZHGF.css","./pages-User-my-detail-change-name.B4UQlkDf.js","./change-name-D-3-C_me.css","./pages-User-my-detail-change-mobile.B7VjY4Xg.js","./change-mobile-B35gj4ec.css","./pages-User-my-detail-my-qrcode.Cq_Oy0e1.js","./my-qrcode-BDOpwRnQ.css","./pages-User-my-detail-change-sign.Dh0UIA-w.js","./change-sign-QvrPgraI.css","./pages-User-my-collection-card.KuMIzsdM.js","./collection-card-BRTv5H8t.css","./pages-User-my-collection-list.zaoFwLxo.js","./collection-list-C68nINuW.css","./pages-User-my-detail-index.D2ctjji1.js","./index-Bj-Ws9Be.css","./pages-User-detail-item-index.G33k98N6.js","./index-tMkW3XDH.css","./pages-Team-team-set-change-intro.XrELGhEs.js","./change-intro-DoOptpP0.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const scriptRel="modulepreload",assetsURL=function(e,t){return new URL(e,t).href},seen={},__vitePreload=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),o=(null==i?void 0:i.nonce)||(null==i?void 0:i.getAttribute("nonce"));r=Promise.all(t.map(t=>{if((t=assetsURL(t,n))in seen)return;seen[t]=!0;const r=t.endsWith(".css"),i=r?'[rel="stylesheet"]':"";if(!!n)for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.href===t&&(!r||"stylesheet"===i.rel))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;const s=document.createElement("link");return s.rel=r?"stylesheet":scriptRel,r||(s.as="script",s.crossOrigin=""),s.href=t,o&&s.setAttribute("nonce",o),document.head.appendChild(s),r?new Promise((e,n)=>{s.addEventListener("load",e),s.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}return r.then(()=>e()).catch(e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e})},messageText$1="Message",cantactsText$1="Cantact",mineText$1="Me",baoxian$1="Insurance",en$1={messageText:messageText$1,cantactsText:cantactsText$1,mineText:mineText$1,baoxian:baoxian$1},__vite_glob_0_0=Object.freeze(Object.defineProperty({__proto__:null,baoxian:baoxian$1,cantactsText:cantactsText$1,default:en$1,messageText:messageText$1,mineText:mineText$1},Symbol.toStringTag,{value:"Module"})),messageText="消息",cantactsText="通讯录",mineText="我的",baoxian="保险",zhHans={messageText:messageText,cantactsText:cantactsText,mineText:mineText,baoxian:baoxian},__vite_glob_0_1=Object.freeze(Object.defineProperty({__proto__:null,baoxian:baoxian,cantactsText:cantactsText,default:zhHans,messageText:messageText,mineText:mineText},Symbol.toStringTag,{value:"Module"}));
/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
function makeMap(e,t){const n=new Set(e.split(","));return t?e=>n.has(e.toLowerCase()):e=>n.has(e)}const EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,isOn=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),isModelListener=e=>e.startsWith("onUpdate:"),extend$2=Object.assign,remove=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},hasOwnProperty$2=Object.prototype.hasOwnProperty,hasOwn$1=(e,t)=>hasOwnProperty$2.call(e,t),isArray$3=Array.isArray,isMap=e=>"[object Map]"===toTypeString(e),isSet=e=>"[object Set]"===toTypeString(e),isRegExp=e=>"[object RegExp]"===toTypeString(e),isFunction$2=e=>"function"==typeof e,isString$1=e=>"string"==typeof e,isSymbol=e=>"symbol"==typeof e,isObject$3=e=>null!==e&&"object"==typeof e,isPromise=e=>(isObject$3(e)||isFunction$2(e))&&isFunction$2(e.then)&&isFunction$2(e.catch),objectToString=Object.prototype.toString,toTypeString=e=>objectToString.call(e),toRawType=e=>toTypeString(e).slice(8,-1),isPlainObject$3=e=>"[object Object]"===toTypeString(e),isIntegerKey=e=>isString$1(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cacheStringFunction=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(e=>e.replace(camelizeRE,(e,t)=>t?t.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(e=>e.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(e=>e.charAt(0).toUpperCase()+e.slice(1)),toHandlerKey=cacheStringFunction(e=>e?`on${capitalize(e)}`:""),hasChanged=(e,t)=>!Object.is(e,t),invokeArrayFns$1=(e,t)=>{for(let n=0;n<e.length;n++)e[n](t)},def=(e,t,n)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:n})},looseToNumber=e=>{const t=parseFloat(e);return isNaN(t)?e:t},toNumber=e=>{const t=isString$1(e)?Number(e):NaN;return isNaN(t)?e:t};let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{});function normalizeStyle$1(e){if(isArray$3(e)){const t={};for(let n=0;n<e.length;n++){const r=e[n],i=isString$1(r)?parseStringStyle(r):normalizeStyle$1(r);if(i)for(const e in i)t[e]=i[e]}return t}if(isString$1(e)||isObject$3(e))return e}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:([^]+)/,styleCommentRE=/\/\*[^]*?\*\//g;function parseStringStyle(e){const t={};return e.replace(styleCommentRE,"").split(listDelimiterRE).forEach(e=>{if(e){const n=e.split(propertyDelimiterRE);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function stringifyStyle(e){let t="";if(!e||isString$1(e))return t;for(const n in e){const r=e[n],i=n.startsWith("--")?n:hyphenate(n);(isString$1(r)||"number"==typeof r)&&(t+=`${i}:${r};`)}return t}function normalizeClass$1(e){let t="";if(isString$1(e))t=e;else if(isArray$3(e))for(let n=0;n<e.length;n++){const r=normalizeClass$1(e[n]);r&&(t+=r+" ")}else if(isObject$3(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}const specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(e){return!!e||""===e}const toDisplayString=e=>isString$1(e)?e:null==e?"":isArray$3(e)||isObject$3(e)&&(e.toString===objectToString||!isFunction$2(e.toString))?JSON.stringify(e,replacer$1,2):String(e),replacer$1=(e,t)=>t&&t.__v_isRef?replacer$1(e,t.value):isMap(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[t,n],r)=>(e[stringifySymbol(t,r)+" =>"]=n,e),{})}:isSet(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>stringifySymbol(e))}:isSymbol(t)?stringifySymbol(t):!isObject$3(t)||isArray$3(t)||isPlainObject$3(t)?t:String(t),stringifySymbol=(e,t="")=>{var n;return isSymbol(e)?`Symbol(${null!=(n=e.description)?n:t})`:e},BUILT_IN_TAG_NAMES=["ad","ad-content-page","ad-draw","audio","button","camera","canvas","checkbox","checkbox-group","cover-image","cover-view","editor","form","functional-page-navigator","icon","image","input","label","live-player","live-pusher","map","movable-area","movable-view","navigator","official-account","open-data","picker","picker-view","picker-view-column","progress","radio","radio-group","rich-text","scroll-view","slider","swiper","swiper-item","switch","text","textarea","video","view","web-view","location-picker","location-view"],BUILT_IN_TAGS=BUILT_IN_TAG_NAMES.map(e=>"uni-"+e),UVUE_WEB_BUILT_IN_TAGS=["list-view","list-item","sticky-section","sticky-header","cloud-db-element"].map(e=>"uni-"+e),UNI_UI_CONFLICT_TAGS=["list-item"].map(e=>"uni-"+e);function isBuiltInComponent(e){if(-1!==UNI_UI_CONFLICT_TAGS.indexOf(e))return!1;const t="uni-"+e.replace("v-uni-","");return-1!==BUILT_IN_TAGS.indexOf(t)||-1!==UVUE_WEB_BUILT_IN_TAGS.indexOf(t)}const LINEFEED="\n",ON_REACH_BOTTOM_DISTANCE=50,UNI_STORAGE_LOCALE="UNI_LOCALE",I18N_JSON_DELIMITERS=["%","%"],PRIMARY_COLOR="#007aff",SCHEME_RE=/^([a-z-]+:)?\/\//i,DATA_RE=/^data:.*,.*/,WEB_INVOKE_APPSERVICE="WEB_INVOKE_APPSERVICE",ON_SHOW="onShow",ON_HIDE="onHide",ON_LAUNCH="onLaunch",ON_ERROR="onError",ON_THEME_CHANGE="onThemeChange",OFF_THEME_CHANGE="offThemeChange",ON_PAGE_NOT_FOUND="onPageNotFound",ON_UNHANDLE_REJECTION="onUnhandledRejection",ON_EXIT="onExit",ON_LOAD="onLoad",ON_READY="onReady",ON_UNLOAD="onUnload",ON_INIT="onInit",ON_SAVE_EXIT_STATE="onSaveExitState",ON_RESIZE="onResize",ON_BACK_PRESS="onBackPress",ON_PAGE_SCROLL="onPageScroll",ON_TAB_ITEM_TAP="onTabItemTap",ON_REACH_BOTTOM="onReachBottom",ON_PULL_DOWN_REFRESH="onPullDownRefresh",ON_SHARE_TIMELINE="onShareTimeline",ON_SHARE_CHAT="onShareChat",ON_ADD_TO_FAVORITES="onAddToFavorites",ON_SHARE_APP_MESSAGE="onShareAppMessage",ON_NAVIGATION_BAR_BUTTON_TAP="onNavigationBarButtonTap",ON_NAVIGATION_BAR_CHANGE="onNavigationBarChange",ON_NAVIGATION_BAR_SEARCH_INPUT_CLICKED="onNavigationBarSearchInputClicked",ON_NAVIGATION_BAR_SEARCH_INPUT_CHANGED="onNavigationBarSearchInputChanged",ON_NAVIGATION_BAR_SEARCH_INPUT_CONFIRMED="onNavigationBarSearchInputConfirmed",ON_NAVIGATION_BAR_SEARCH_INPUT_FOCUS_CHANGED="onNavigationBarSearchInputFocusChanged",ON_APP_ENTER_FOREGROUND="onAppEnterForeground",ON_APP_ENTER_BACKGROUND="onAppEnterBackground",ON_WEB_INVOKE_APP_SERVICE="onWebInvokeAppService",ON_WXS_INVOKE_CALL_METHOD="onWxsInvokeCallMethod";function getLen(e=""){return(""+e).replace(/[^\x00-\xff]/g,"**").length}function hasLeadingSlash(e){return 0===e.indexOf("/")}function addLeadingSlash(e){return hasLeadingSlash(e)?e:"/"+e}function removeLeadingSlash(e){return hasLeadingSlash(e)?e.slice(1):e}const invokeArrayFns=(e,t)=>{let n;for(let r=0;r<e.length;r++)n=e[r](t);return n};function updateElementStyle(e,t){for(const n in t)e.style[n]=t[n]}function once$1(e,t=null){let n;return(...r)=>(e&&(n=e.apply(t,r),e=null),n)}const _completeValue=e=>e>9?e:"0"+e;function formatDateTime({date:e=new Date,mode:t="date"}){return"time"===t?_completeValue(e.getHours())+":"+_completeValue(e.getMinutes()):e.getFullYear()+"-"+_completeValue(e.getMonth()+1)+"-"+_completeValue(e.getDate())}function callOptions(e,t){e=e||{},isString$1(t)&&(t={errMsg:t}),/:ok$/.test(t.errMsg)?isFunction$2(e.success)&&e.success(t):isFunction$2(e.fail)&&e.fail(t),isFunction$2(e.complete)&&e.complete(t)}function sortObject(e){let t={};return isPlainObject$3(e)&&Object.keys(e).sort().forEach(n=>{const r=n;t[r]=e[r]}),Object.keys(t)?t:e}function getGlobalOnce(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;function e(){return this}return void 0!==e()?e():new Function("return this")()}let g$2;function getGlobal$1(){return g$2||(g$2=getGlobalOnce(),g$2)}function isComponentInternalInstance(e){return!!e.appContext}function resolveComponentInstance(e){return e&&(isComponentInternalInstance(e)?e.proxy:e)}function resolveOwnerVm(e){if(!e)return;let t=e.type.name;for(;t&&isBuiltInComponent(hyphenate(t));)t=(e=e.parent).type.name;return e.proxy}function isElement(e){return 1===e.nodeType}function resolveOwnerEl(e,t=!1){const{vnode:n}=e;if(isElement(n.el))return t?n.el?[n.el]:[]:n.el;const{subTree:r}=e;if(16&r.shapeFlag){const e=r.children.filter(e=>e.el&&isElement(e.el));if(e.length>0)return t?e.map(e=>e.el):e[0].el}return t?n.el?[n.el]:[]:n.el}function normalizeStyle(e){const t=getGlobal$1();if(t&&t.UTSJSONObject&&e instanceof t.UTSJSONObject){const n={};return t.UTSJSONObject.keys(e).forEach(t=>{n[t]=e[t]}),normalizeStyle$1(n)}if(e instanceof Map){const t={};return e.forEach((e,n)=>{t[n]=e}),normalizeStyle$1(t)}if(isString$1(e))return parseStringStyle(e);if(isArray$3(e)){const t={};for(let n=0;n<e.length;n++){const r=e[n],i=isString$1(r)?parseStringStyle(r):normalizeStyle(r);if(i)for(const e in i)t[e]=i[e]}return t}return normalizeStyle$1(e)}function normalizeClass(e){let t="";const n=getGlobal$1();if(n&&n.UTSJSONObject&&e instanceof n.UTSJSONObject)n.UTSJSONObject.keys(e).forEach(n=>{e[n]&&(t+=n+" ")});else if(e instanceof Map)e.forEach((e,n)=>{e&&(t+=n+" ")});else if(isArray$3(e))for(let r=0;r<e.length;r++){const n=normalizeClass(e[r]);n&&(t+=n+" ")}else t=normalizeClass$1(e);return t.trim()}function formatKey(e){return camelize(e.substring(5))}const initCustomDatasetOnce=once$1(e=>{e=e||(e=>e.tagName.startsWith("UNI-"));const t=HTMLElement.prototype,n=t.setAttribute;t.setAttribute=function(t,r){if(t.startsWith("data-")&&e(this)){(this.__uniDataset||(this.__uniDataset={}))[formatKey(t)]=r}n.call(this,t,r)};const r=t.removeAttribute;t.removeAttribute=function(t){this.__uniDataset&&t.startsWith("data-")&&e(this)&&delete this.__uniDataset[formatKey(t)],r.call(this,t)}});function getCustomDataset(e){return extend$2({},e.dataset,e.__uniDataset)}const unitRE=new RegExp("\"[^\"]+\"|'[^']+'|url\\([^)]+\\)|(\\d*\\.?\\d+)[r|u]px","g");function toFixed(e,t){const n=Math.pow(10,t+1),r=Math.floor(e*n);return 10*Math.round(r/10)/n}const defaultRpx2Unit={unit:"rem",unitRatio:10/320,unitPrecision:5};function createRpx2Unit(e,t,n){return r=>r.replace(unitRE,(r,i)=>{if(!i)return r;if(1===t)return`${i}${e}`;const o=toFixed(parseFloat(i)*t,n);return 0===o?"0":`${o}${e}`})}function passive(e){return{passive:e}}function normalizeTarget(e){const{id:t,offsetTop:n,offsetLeft:r}=e;return{id:t,dataset:getCustomDataset(e),offsetTop:n,offsetLeft:r}}function addFont(e,t,n){const r=document.fonts;if(r){const i=new FontFace(e,t,n);return i.load().then(()=>{r.add&&r.add(i)})}return new Promise(r=>{const i=document.createElement("style"),o=[];if(n){const{style:e,weight:t,stretch:r,unicodeRange:i,variant:s,featureSettings:a}=n;e&&o.push(`font-style:${e}`),t&&o.push(`font-weight:${t}`),r&&o.push(`font-stretch:${r}`),i&&o.push(`unicode-range:${i}`),s&&o.push(`font-variant:${s}`),a&&o.push(`font-feature-settings:${a}`)}i.innerText=`@font-face{font-family:"${e}";src:${t};${o.join(";")}}`,document.head.appendChild(i),r()})}function scrollTo(e,t,n){if(isString$1(e)){const t=document.querySelector(e);if(t){const{top:n}=t.getBoundingClientRect();e=n+window.pageYOffset;const r=document.querySelector("uni-page-head");r&&(e-=r.offsetHeight)}}e<0&&(e=0);const r=document.documentElement,{clientHeight:i,scrollHeight:o}=r;if(e=Math.min(e,o-i),0===t)return void(r.scrollTop=document.body.scrollTop=e);if(window.scrollY===e)return;const s=t=>{if(t<=0)return void window.scrollTo(0,e);const n=e-window.scrollY;requestAnimationFrame(function(){window.scrollTo(0,window.scrollY+n/t*10),s(t-10)})};s(t)}function decode$2(e){try{return decodeURIComponent(""+e)}catch(t){}return""+e}function decodedQuery(e={}){const t={};return Object.keys(e).forEach(n=>{try{t[n]=decode$2(e[n])}catch(r){t[n]=e[n]}}),t}const PLUS_RE$1=/\+/g;function parseQuery$1(e){const t={};if(""===e||"?"===e)return t;const n=("?"===e[0]?e.slice(1):e).split("&");for(let r=0;r<n.length;++r){const e=n[r].replace(PLUS_RE$1," ");let i=e.indexOf("="),o=decode$2(i<0?e:e.slice(0,i)),s=i<0?null:decode$2(e.slice(i+1));if(o in t){let e=t[o];isArray$3(e)||(e=t[o]=[e]),e.push(s)}else t[o]=s}return t}function parseUrl(e){const[t,n]=e.split("?",2);return{path:t,query:parseQuery$1(n||"")}}function debounce$1(e,t,{clearTimeout:n,setTimeout:r}){let i;const o=function(){n(i);i=r(()=>e.apply(this,arguments),t)};return o.cancel=function(){n(i)},o}class EventChannel{constructor(e,t){this.id=e,this.listener={},this.emitCache=[],t&&Object.keys(t).forEach(e=>{this.on(e,t[e])})}emit(e,...t){const n=this.listener[e];if(!n)return this.emitCache.push({eventName:e,args:t});n.forEach(e=>{e.fn.apply(e.fn,t)}),this.listener[e]=n.filter(e=>"once"!==e.type)}on(e,t){this._addListener(e,"on",t),this._clearCache(e)}once(e,t){this._addListener(e,"once",t),this._clearCache(e)}off(e,t){const n=this.listener[e];if(n)if(t)for(let r=0;r<n.length;)n[r].fn===t&&(n.splice(r,1),r--),r++;else delete this.listener[e]}_clearCache(e){for(let t=0;t<this.emitCache.length;t++){const n=this.emitCache[t],r=e?n.eventName===e?e:null:n.eventName;if(!r)continue;"number"!=typeof this.emit.apply(this,[r,...n.args])?(this.emitCache.splice(t,1),t--):this.emitCache.pop()}}_addListener(e,t,n){(this.listener[e]||(this.listener[e]=[])).push({fn:n,type:t})}}const PAGE_HOOKS=[ON_INIT,ON_LOAD,ON_SHOW,ON_HIDE,ON_UNLOAD,ON_BACK_PRESS,ON_PAGE_SCROLL,ON_TAB_ITEM_TAP,ON_REACH_BOTTOM,ON_PULL_DOWN_REFRESH,ON_SHARE_TIMELINE,ON_SHARE_APP_MESSAGE,ON_SHARE_CHAT,ON_ADD_TO_FAVORITES,ON_SAVE_EXIT_STATE,ON_NAVIGATION_BAR_BUTTON_TAP,ON_NAVIGATION_BAR_SEARCH_INPUT_CLICKED,ON_NAVIGATION_BAR_SEARCH_INPUT_CHANGED,ON_NAVIGATION_BAR_SEARCH_INPUT_CONFIRMED,ON_NAVIGATION_BAR_SEARCH_INPUT_FOCUS_CHANGED];function isRootImmediateHook(e){return[ON_LOAD,ON_SHOW].indexOf(e)>-1}function isRootHook(e){return PAGE_HOOKS.indexOf(e)>-1}const UniLifecycleHooks=[ON_SHOW,ON_HIDE,ON_LAUNCH,ON_ERROR,ON_THEME_CHANGE,ON_PAGE_NOT_FOUND,ON_UNHANDLE_REJECTION,ON_EXIT,ON_INIT,ON_LOAD,ON_READY,ON_UNLOAD,ON_RESIZE,ON_BACK_PRESS,ON_PAGE_SCROLL,ON_TAB_ITEM_TAP,ON_REACH_BOTTOM,ON_PULL_DOWN_REFRESH,ON_SHARE_TIMELINE,ON_ADD_TO_FAVORITES,ON_SHARE_APP_MESSAGE,ON_SHARE_CHAT,ON_SAVE_EXIT_STATE,ON_NAVIGATION_BAR_BUTTON_TAP,ON_NAVIGATION_BAR_SEARCH_INPUT_CLICKED,ON_NAVIGATION_BAR_SEARCH_INPUT_CHANGED,ON_NAVIGATION_BAR_SEARCH_INPUT_CONFIRMED,ON_NAVIGATION_BAR_SEARCH_INPUT_FOCUS_CHANGED];function isUniLifecycleHook(e,t,n=!0){return!(n&&!isFunction$2(t))&&(UniLifecycleHooks.indexOf(e)>-1||0===e.indexOf("on"))}let vueApp;const createVueAppHooks=[];function onCreateVueApp(e){if(vueApp)return e(vueApp);createVueAppHooks.push(e)}function invokeCreateVueAppHook(e){vueApp=e,createVueAppHooks.forEach(t=>t(e))}const invokeCreateErrorHandler=once$1((e,t)=>t(e)),E$1=function(){};E$1.prototype={_id:1,on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n,_id:this._id}),this._id++},once:function(e,t,n){var r=this;function i(){r.off(e,i),t.apply(n,arguments)}return i._=t,this.on(e,i,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t){for(var o=r.length-1;o>=0;o--)if(r[o].fn===t||r[o].fn._===t||r[o]._id===t){r.splice(o,1);break}i=r}return i.length?n[e]=i:delete n[e],this}};var E$1$1=E$1;const borderStyles={black:"rgba(0,0,0,0.4)",white:"rgba(255,255,255,0.4)"};function normalizeTabBarStyles(e){return e&&e in borderStyles?borderStyles[e]:e}function normalizeTitleColor(e){return"black"===e?"#000000":"#ffffff"}function resolveStringStyleItem(e,t,n){if(isString$1(t)&&t.startsWith("@")){let r=e[t.replace("@","")]||t;switch(n){case"titleColor":r=normalizeTitleColor(r);break;case"borderStyle":r=normalizeTabBarStyles(r)}return r}return t}function normalizeStyles(e,t={},n="light"){const r=t[n],i={};return void 0!==r&&e?(Object.keys(e).forEach(o=>{const s=e[o];i[o]=isPlainObject$3(s)?normalizeStyles(s,t,n):isArray$3(s)?s.map(e=>isPlainObject$3(e)?normalizeStyles(e,t,n):resolveStringStyleItem(r,e)):resolveStringStyleItem(r,s,o)}),i):e}
/**
* @dcloudio/uni-h5-vue v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let activeEffectScope,activeEffect;class EffectScope{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=activeEffectScope,!e&&activeEffectScope&&(this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const t=activeEffectScope;try{return activeEffectScope=this,e()}finally{activeEffectScope=t}}}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(e){if(this._active){let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0,this._active=!1}}}function effectScope(e){return new EffectScope(e)}function recordEffectScope(e,t=activeEffectScope){t&&t.active&&t.effects.push(e)}function getCurrentScope(){return activeEffectScope}class ReactiveEffect{constructor(e,t,n,r){this.fn=e,this.trigger=t,this.scheduler=n,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,recordEffectScope(this,r)}get dirty(){if(2===this._dirtyLevel||3===this._dirtyLevel){this._dirtyLevel=1,pauseTracking();for(let e=0;e<this._depsLength;e++){const t=this.deps[e];if(t.computed&&(triggerComputed(t.computed),this._dirtyLevel>=4))break}1===this._dirtyLevel&&(this._dirtyLevel=0),resetTracking()}return this._dirtyLevel>=4}set dirty(e){this._dirtyLevel=e?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=shouldTrack,t=activeEffect;try{return shouldTrack=!0,activeEffect=this,this._runnings++,preCleanupEffect(this),this.fn()}finally{postCleanupEffect(this),this._runnings--,activeEffect=t,shouldTrack=e}}stop(){var e;this.active&&(preCleanupEffect(this),postCleanupEffect(this),null==(e=this.onStop)||e.call(this),this.active=!1)}}function triggerComputed(e){return e.value}function preCleanupEffect(e){e._trackId++,e._depsLength=0}function postCleanupEffect(e){if(e.deps.length>e._depsLength){for(let t=e._depsLength;t<e.deps.length;t++)cleanupDepEffect(e.deps[t],e);e.deps.length=e._depsLength}}function cleanupDepEffect(e,t){const n=e.get(t);void 0!==n&&t._trackId!==n&&(e.delete(t),0===e.size&&e.cleanup())}let shouldTrack=!0,pauseScheduleStack=0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const e=trackStack.pop();shouldTrack=void 0===e||e}function pauseScheduling(){pauseScheduleStack++}function resetScheduling(){for(pauseScheduleStack--;!pauseScheduleStack&&queueEffectSchedulers.length;)queueEffectSchedulers.shift()()}function trackEffect(e,t,n){if(t.get(e)!==e._trackId){t.set(e,e._trackId);const n=e.deps[e._depsLength];n!==t?(n&&cleanupDepEffect(n,e),e.deps[e._depsLength++]=t):e._depsLength++}}const queueEffectSchedulers=[];function triggerEffects(e,t,n){pauseScheduling();for(const r of e.keys()){let n;r._dirtyLevel<t&&(null!=n?n:n=e.get(r)===r._trackId)&&(r._shouldSchedule||(r._shouldSchedule=0===r._dirtyLevel),r._dirtyLevel=t),r._shouldSchedule&&(null!=n?n:n=e.get(r)===r._trackId)&&(r.trigger(),r._runnings&&!r.allowRecurse||2===r._dirtyLevel||(r._shouldSchedule=!1,r.scheduler&&queueEffectSchedulers.push(r.scheduler)))}resetScheduling()}const createDep=(e,t)=>{const n=new Map;return n.cleanup=e,n.computed=t,n},targetMap=new WeakMap,ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol("");function track(e,t,n){if(shouldTrack&&activeEffect){let t=targetMap.get(e);t||targetMap.set(e,t=new Map);let r=t.get(n);r||t.set(n,r=createDep(()=>t.delete(n))),trackEffect(activeEffect,r)}}function trigger(e,t,n,r,i,o){const s=targetMap.get(e);if(!s)return;let a=[];if("clear"===t)a=[...s.values()];else if("length"===n&&isArray$3(e)){const e=Number(r);s.forEach((t,n)=>{("length"===n||!isSymbol(n)&&n>=e)&&a.push(t)})}else switch(void 0!==n&&a.push(s.get(n)),t){case"add":isArray$3(e)?isIntegerKey(n)&&a.push(s.get("length")):(a.push(s.get(ITERATE_KEY)),isMap(e)&&a.push(s.get(MAP_KEY_ITERATE_KEY)));break;case"delete":isArray$3(e)||(a.push(s.get(ITERATE_KEY)),isMap(e)&&a.push(s.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(e)&&a.push(s.get(ITERATE_KEY))}pauseScheduling();for(const c of a)c&&triggerEffects(c,4);resetScheduling()}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>"arguments"!==e&&"caller"!==e).map(e=>Symbol[e]).filter(isSymbol)),arrayInstrumentations=createArrayInstrumentations();function createArrayInstrumentations(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...e){const n=toRaw(this);for(let t=0,i=this.length;t<i;t++)track(n,"get",t+"");const r=n[t](...e);return-1===r||!1===r?n[t](...e.map(toRaw)):r}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...e){pauseTracking(),pauseScheduling();const n=toRaw(this)[t].apply(this,e);return resetScheduling(),resetTracking(),n}}),e}function hasOwnProperty$1(e){const t=toRaw(this);return track(t,"has",e),t.hasOwnProperty(e)}class BaseReactiveHandler{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){const r=this._isReadonly,i=this._isShallow;if("__v_isReactive"===t)return!r;if("__v_isReadonly"===t)return r;if("__v_isShallow"===t)return i;if("__v_raw"===t)return n===(r?i?shallowReadonlyMap:readonlyMap:i?shallowReactiveMap:reactiveMap).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const o=isArray$3(e);if(!r){if(o&&hasOwn$1(arrayInstrumentations,t))return Reflect.get(arrayInstrumentations,t,n);if("hasOwnProperty"===t)return hasOwnProperty$1}const s=Reflect.get(e,t,n);return(isSymbol(t)?builtInSymbols.has(t):isNonTrackableKeys(t))?s:(r||track(e,"get",t),i?s:isRef(s)?o&&isIntegerKey(t)?s:s.value:isObject$3(s)?r?readonly(s):reactive(s):s)}}class MutableReactiveHandler extends BaseReactiveHandler{constructor(e=!1){super(!1,e)}set(e,t,n,r){let i=e[t];if(!this._isShallow){const t=isReadonly(i);if(isShallow(n)||isReadonly(n)||(i=toRaw(i),n=toRaw(n)),!isArray$3(e)&&isRef(i)&&!isRef(n))return!t&&(i.value=n,!0)}const o=isArray$3(e)&&isIntegerKey(t)?Number(t)<e.length:hasOwn$1(e,t),s=Reflect.set(e,t,n,r);return e===toRaw(r)&&(o?hasChanged(n,i)&&trigger(e,"set",t,n):trigger(e,"add",t,n)),s}deleteProperty(e,t){const n=hasOwn$1(e,t);e[t];const r=Reflect.deleteProperty(e,t);return r&&n&&trigger(e,"delete",t,void 0),r}has(e,t){const n=Reflect.has(e,t);return isSymbol(t)&&builtInSymbols.has(t)||track(e,"has",t),n}ownKeys(e){return track(e,"iterate",isArray$3(e)?"length":ITERATE_KEY),Reflect.ownKeys(e)}}class ReadonlyReactiveHandler extends BaseReactiveHandler{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const mutableHandlers=new MutableReactiveHandler,readonlyHandlers=new ReadonlyReactiveHandler,shallowReactiveHandlers=new MutableReactiveHandler(!0),toShallow=e=>e,getProto=e=>Reflect.getPrototypeOf(e);function get$1(e,t,n=!1,r=!1){const i=toRaw(e=e.__v_raw),o=toRaw(t);n||(hasChanged(t,o)&&track(i,"get",t),track(i,"get",o));const{has:s}=getProto(i),a=r?toShallow:n?toReadonly:toReactive;return s.call(i,t)?a(e.get(t)):s.call(i,o)?a(e.get(o)):void(e!==i&&e.get(t))}function has(e,t=!1){const n=this.__v_raw,r=toRaw(n),i=toRaw(e);return t||(hasChanged(e,i)&&track(r,"has",e),track(r,"has",i)),e===i?n.has(e):n.has(e)||n.has(i)}function size(e,t=!1){return e=e.__v_raw,!t&&track(toRaw(e),"iterate",ITERATE_KEY),Reflect.get(e,"size",e)}function add(e){e=toRaw(e);const t=toRaw(this);return getProto(t).has.call(t,e)||(t.add(e),trigger(t,"add",e,e)),this}function set$1(e,t){t=toRaw(t);const n=toRaw(this),{has:r,get:i}=getProto(n);let o=r.call(n,e);o||(e=toRaw(e),o=r.call(n,e));const s=i.call(n,e);return n.set(e,t),o?hasChanged(t,s)&&trigger(n,"set",e,t):trigger(n,"add",e,t),this}function deleteEntry(e){const t=toRaw(this),{has:n,get:r}=getProto(t);let i=n.call(t,e);i||(e=toRaw(e),i=n.call(t,e)),r&&r.call(t,e);const o=t.delete(e);return i&&trigger(t,"delete",e,void 0),o}function clear(){const e=toRaw(this),t=0!==e.size,n=e.clear();return t&&trigger(e,"clear",void 0,void 0),n}function createForEach(e,t){return function(n,r){const i=this,o=i.__v_raw,s=toRaw(o),a=t?toShallow:e?toReadonly:toReactive;return!e&&track(s,"iterate",ITERATE_KEY),o.forEach((e,t)=>n.call(r,a(e),a(t),i))}}function createIterableMethod(e,t,n){return function(...r){const i=this.__v_raw,o=toRaw(i),s=isMap(o),a="entries"===e||e===Symbol.iterator&&s,c="keys"===e&&s,l=i[e](...r),d=n?toShallow:t?toReadonly:toReactive;return!t&&track(o,"iterate",c?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:e,done:t}=l.next();return t?{value:e,done:t}:{value:a?[d(e[0]),d(e[1])]:d(e),done:t}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(e){return function(...t){return"delete"!==e&&("clear"===e?void 0:this)}}function createInstrumentations(){const e={get(e){return get$1(this,e)},get size(){return size(this)},has:has,add:add,set:set$1,delete:deleteEntry,clear:clear,forEach:createForEach(!1,!1)},t={get(e){return get$1(this,e,!1,!0)},get size(){return size(this)},has:has,add:add,set:set$1,delete:deleteEntry,clear:clear,forEach:createForEach(!1,!0)},n={get(e){return get$1(this,e,!0)},get size(){return size(this,!0)},has(e){return has.call(this,e,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!1)},r={get(e){return get$1(this,e,!0,!0)},get size(){return size(this,!0)},has(e){return has.call(this,e,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(i=>{e[i]=createIterableMethod(i,!1,!1),n[i]=createIterableMethod(i,!0,!1),t[i]=createIterableMethod(i,!1,!0),r[i]=createIterableMethod(i,!0,!0)}),[e,n,t,r]}const[mutableInstrumentations,readonlyInstrumentations,shallowInstrumentations,shallowReadonlyInstrumentations]=createInstrumentations();function createInstrumentationGetter(e,t){const n=t?e?shallowReadonlyInstrumentations:shallowInstrumentations:e?readonlyInstrumentations:mutableInstrumentations;return(t,r,i)=>"__v_isReactive"===r?!e:"__v_isReadonly"===r?e:"__v_raw"===r?t:Reflect.get(hasOwn$1(n,r)&&r in t?n:t,r,i)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(e){return e.__v_skip||!Object.isExtensible(e)?0:targetTypeMap(toRawType(e))}function reactive(e){return isReadonly(e)?e:createReactiveObject(e,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(e){return createReactiveObject(e,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(e){return createReactiveObject(e,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function createReactiveObject(e,t,n,r,i){if(!isObject$3(e))return e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const o=i.get(e);if(o)return o;const s=getTargetType(e);if(0===s)return e;const a=new Proxy(e,2===s?r:n);return i.set(e,a),a}function isReactive(e){return isReadonly(e)?isReactive(e.__v_raw):!(!e||!e.__v_isReactive)}function isReadonly(e){return!(!e||!e.__v_isReadonly)}function isShallow(e){return!(!e||!e.__v_isShallow)}function isProxy(e){return isReactive(e)||isReadonly(e)}function toRaw(e){const t=e&&e.__v_raw;return t?toRaw(t):e}function markRaw(e){return Object.isExtensible(e)&&def(e,"__v_skip",!0),e}const toReactive=e=>isObject$3(e)?reactive(e):e,toReadonly=e=>isObject$3(e)?readonly(e):e;class ComputedRefImpl{constructor(e,t,n,r){this.getter=e,this._setter=t,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new ReactiveEffect(()=>e(this._value),()=>triggerRefValue(this,2===this.effect._dirtyLevel?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!r,this.__v_isReadonly=n}get value(){const e=toRaw(this);return e._cacheable&&!e.effect.dirty||!hasChanged(e._value,e._value=e.effect.run())||triggerRefValue(e,4),trackRefValue(e),e.effect._dirtyLevel>=2&&triggerRefValue(e,2),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function computed$1(e,t,n=!1){let r,i;const o=isFunction$2(e);o?(r=e,i=NOOP):(r=e.get,i=e.set);return new ComputedRefImpl(r,i,o||!i,n)}function trackRefValue(e){var t;shouldTrack&&activeEffect&&(e=toRaw(e),trackEffect(activeEffect,null!=(t=e.dep)?t:e.dep=createDep(()=>e.dep=void 0,e instanceof ComputedRefImpl?e:void 0)))}function triggerRefValue(e,t=4,n){const r=(e=toRaw(e)).dep;r&&triggerEffects(r,t)}function isRef(e){return!(!e||!0!==e.__v_isRef)}function ref(e){return createRef(e,!1)}function shallowRef(e){return createRef(e,!0)}function createRef(e,t){return isRef(e)?e:new RefImpl(e,t)}class RefImpl{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:toRaw(e),this._value=t?e:toReactive(e)}get value(){return trackRefValue(this),this._value}set value(e){const t=this.__v_isShallow||isShallow(e)||isReadonly(e);e=t?e:toRaw(e),hasChanged(e,this._rawValue)&&(this._rawValue=e,this._value=t?e:toReactive(e),triggerRefValue(this,4))}}function unref(e){return isRef(e)?e.value:e}const shallowUnwrapHandlers={get:(e,t,n)=>unref(Reflect.get(e,t,n)),set:(e,t,n,r)=>{const i=e[t];return isRef(i)&&!isRef(n)?(i.value=n,!0):Reflect.set(e,t,n,r)}};function proxyRefs(e){return isReactive(e)?e:new Proxy(e,shallowUnwrapHandlers)}const stack=[];function warn$1(e,...t){pauseTracking();const n=stack.length?stack[stack.length-1].component:null,r=n&&n.appContext.config.warnHandler,i=getComponentTrace();if(r)t.length&&(t[0]=String(t[0])),callWithErrorHandling(r,n,11,[e+t.map(e=>{var t,n;return null!=(n=null==(t=e.toString)?void 0:t.call(e))?n:JSON.stringify(e)}).join(""),n&&n.proxy,i.map(({vnode:e})=>`at <${formatComponentName(n,e.type)}>`).join("\n"),i]);else{const n=[`[Vue warn]: ${e}`,...t];i.length&&n.push("\n",...formatTrace(i)),console.warn(...n)}resetTracking()}function getComponentTrace(){let e=stack[stack.length-1];if(!e)return[];const t=[];for(;e;){const n=t[0];n&&n.vnode===e?n.recurseCount++:t.push({vnode:e,recurseCount:0});const r=e.component&&e.component.parent;e=r&&r.vnode}return t}function formatTrace(e){const t=[];return e.forEach((e,n)=>{t.push(...0===n?[]:["\n"],...formatTraceEntry(e))}),t}function formatTraceEntry({vnode:e,recurseCount:t}){const n=t>0?`... (${t} recursive calls)`:"",r=!!e.component&&null==e.component.parent,i=` at <${formatComponentName(e.component,e.type,r)}`,o=">"+n;return e.props?[i,...formatProps(e.props),o]:[i+o]}function formatProps(e){const t=[],n=Object.keys(e);return n.slice(0,3).forEach(n=>{t.push(...formatProp(n,e[n]))}),n.length>3&&t.push(" ..."),t}function formatProp(e,t,n){return isString$1(t)?(t=JSON.stringify(t),n?t:[`${e}=${t}`]):"number"==typeof t||"boolean"==typeof t||null==t?n?t:[`${e}=${t}`]:isRef(t)?(t=formatProp(e,toRaw(t.value),!0),n?t:[`${e}=Ref<`,t,">"]):isFunction$2(t)?[`${e}=fn${t.name?`<${t.name}>`:""}`]:(t=toRaw(t),n?t:[`${e}=`,t])}function callWithErrorHandling(e,t,n,r){try{return r?e(...r):e()}catch(i){handleError(i,t,n)}}function callWithAsyncErrorHandling(e,t,n,r){if(isFunction$2(e)){const i=callWithErrorHandling(e,t,n,r);return i&&isPromise(i)&&i.catch(e=>{handleError(e,t,n)}),i}const i=[];for(let o=0;o<e.length;o++)i.push(callWithAsyncErrorHandling(e[o],t,n,r));return i}function handleError(e,t,n,r=!0){const i=t?t.vnode:null;if(t){let r=t.parent;const i=t.proxy,o=`https://vuejs.org/error-reference/#runtime-${n}`;for(;r;){const t=r.ec;if(t)for(let n=0;n<t.length;n++)if(!1===t[n](e,i,o))return;r=r.parent}const s=t.appContext.config.errorHandler;if(s)return void callWithErrorHandling(s,null,10,[e,i,o])}logError(e,n,i,r)}function logError(e,t,n,r=!0){console.error(e)}let isFlushing=!1,isFlushPending=!1;const queue$1=[];let flushIndex=0;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;function nextTick(e){const t=currentFlushPromise||resolvedPromise;return e?t.then(this?e.bind(this):e):t}function findInsertionIndex(e){let t=flushIndex+1,n=queue$1.length;for(;t<n;){const r=t+n>>>1,i=queue$1[r],o=getId(i);o<e||o===e&&i.pre?t=r+1:n=r}return t}function queueJob(e){queue$1.length&&queue$1.includes(e,isFlushing&&e.allowRecurse?flushIndex+1:flushIndex)||(null==e.id?queue$1.push(e):queue$1.splice(findInsertionIndex(e.id),0,e),queueFlush())}function queueFlush(){isFlushing||isFlushPending||(isFlushPending=!0,currentFlushPromise=resolvedPromise.then(flushJobs))}function invalidateJob(e){const t=queue$1.indexOf(e);t>flushIndex&&queue$1.splice(t,1)}function queuePostFlushCb(e){isArray$3(e)?pendingPostFlushCbs.push(...e):activePostFlushCbs&&activePostFlushCbs.includes(e,e.allowRecurse?postFlushIndex+1:postFlushIndex)||pendingPostFlushCbs.push(e),queueFlush()}function flushPreFlushCbs(e,t,n=(isFlushing?flushIndex+1:0)){for(;n<queue$1.length;n++){const t=queue$1[n];if(t&&t.pre){if(e&&t.id!==e.uid)continue;queue$1.splice(n,1),n--,t()}}}function flushPostFlushCbs(e){if(pendingPostFlushCbs.length){const e=[...new Set(pendingPostFlushCbs)].sort((e,t)=>getId(e)-getId(t));if(pendingPostFlushCbs.length=0,activePostFlushCbs)return void activePostFlushCbs.push(...e);for(activePostFlushCbs=e,postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++)activePostFlushCbs[postFlushIndex]();activePostFlushCbs=null,postFlushIndex=0}}const getId=e=>null==e.id?1/0:e.id,comparator=(e,t)=>{const n=getId(e)-getId(t);if(0===n){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return n};function flushJobs(e){isFlushPending=!1,isFlushing=!0,queue$1.sort(comparator);try{for(flushIndex=0;flushIndex<queue$1.length;flushIndex++){const e=queue$1[flushIndex];e&&!1!==e.active&&callWithErrorHandling(e,null,14)}}finally{flushIndex=0,queue$1.length=0,flushPostFlushCbs(),isFlushing=!1,currentFlushPromise=null,(queue$1.length||pendingPostFlushCbs.length)&&flushJobs()}}function emit$2(e,t,...n){if(e.isUnmounted)return;const r=e.vnode.props||EMPTY_OBJ;let i=n;const o=t.startsWith("update:"),s=o&&t.slice(7);if(s&&s in r){const e=`${"modelValue"===s?"model":s}Modifiers`,{number:t,trim:o}=r[e]||EMPTY_OBJ;o&&(i=n.map(e=>isString$1(e)?e.trim():e)),t&&(i=n.map(looseToNumber))}let a,c=r[a=toHandlerKey(t)]||r[a=toHandlerKey(camelize(t))];!c&&o&&(c=r[a=toHandlerKey(hyphenate(t))]),c&&callWithAsyncErrorHandling(c,e,6,normalizeWxsEventArgs(e,c,i));const l=r[a+"Once"];if(l){if(e.emitted){if(e.emitted[a])return}else e.emitted={};e.emitted[a]=!0,callWithAsyncErrorHandling(l,e,6,normalizeWxsEventArgs(e,l,i))}}function normalizeWxsEventArgs(e,t,n){if(1!==n.length)return n;if(isFunction$2(t)){if(t.length<2)return n}else if(!t.find(e=>e.length>=2))return n;const r=n[0];if(r&&hasOwn$1(r,"type")&&hasOwn$1(r,"timeStamp")&&hasOwn$1(r,"target")&&hasOwn$1(r,"currentTarget")&&hasOwn$1(r,"detail")){const t=e.proxy,r=t.$gcd(t,!0);r&&n.push(r)}return n}function normalizeEmitsOptions(e,t,n=!1){const r=t.emitsCache,i=r.get(e);if(void 0!==i)return i;const o=e.emits;let s={},a=!1;if(!isFunction$2(e)){const r=e=>{const n=normalizeEmitsOptions(e,t,!0);n&&(a=!0,extend$2(s,n))};!n&&t.mixins.length&&t.mixins.forEach(r),e.extends&&r(e.extends),e.mixins&&e.mixins.forEach(r)}return o||a?(isArray$3(o)?o.forEach(e=>s[e]=null):extend$2(s,o),isObject$3(e)&&r.set(e,s),s):(isObject$3(e)&&r.set(e,null),null)}function isEmitListener(e,t){return!(!e||!isOn(t))&&(t=t.slice(2).replace(/Once$/,""),hasOwn$1(e,t[0].toLowerCase()+t.slice(1))||hasOwn$1(e,hyphenate(t))||hasOwn$1(e,t))}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(e){const t=currentRenderingInstance;return currentRenderingInstance=e,currentScopeId=e&&e.type.__scopeId||null,t}function withCtx(e,t=currentRenderingInstance,n){if(!t)return e;if(e._n)return e;const r=(...n)=>{r._d&&setBlockTracking(-1);const i=setCurrentRenderingInstance(t);let o;try{o=e(...n)}finally{setCurrentRenderingInstance(i),r._d&&setBlockTracking(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function markAttrsAccessed(){}function renderComponentRoot(e){const{type:t,vnode:n,proxy:r,withProxy:i,props:o,propsOptions:[s],slots:a,attrs:c,emit:l,render:d,renderCache:u,data:p,setupState:h,ctx:g,inheritAttrs:m}=e;let f,v;const y=setCurrentRenderingInstance(e);try{if(4&n.shapeFlag){const e=i||r,t=e;f=normalizeVNode(d.call(t,e,u,o,h,p,g)),v=c}else{const e=t;0,f=normalizeVNode(e.length>1?e(o,{attrs:c,slots:a,emit:l}):e(o,null)),v=t.props?c:getFunctionalFallthrough(c)}}catch(I){blockStack.length=0,handleError(I,e,1),f=createVNode(Comment)}let _=f;if(v&&!1!==m){const e=Object.keys(v),{shapeFlag:t}=_;e.length&&7&t&&(s&&e.some(isModelListener)&&(v=filterModelListeners(v,s)),_=cloneVNode(_,v))}return n.dirs&&(_=cloneVNode(_),_.dirs=_.dirs?_.dirs.concat(n.dirs):n.dirs),n.transition&&(_.transition=n.transition),f=_,setCurrentRenderingInstance(y),f}const getFunctionalFallthrough=e=>{let t;for(const n in e)("class"===n||"style"===n||isOn(n))&&((t||(t={}))[n]=e[n]);return t},filterModelListeners=(e,t)=>{const n={};for(const r in e)isModelListener(r)&&r.slice(9)in t||(n[r]=e[r]);return n};function shouldUpdateComponent(e,t,n){const{props:r,children:i,component:o}=e,{props:s,children:a,patchFlag:c}=t,l=o.emitsOptions;if(t.dirs||t.transition)return!0;if(!(n&&c>=0))return!(!i&&!a||a&&a.$stable)||r!==s&&(r?!s||hasPropsChanged(r,s,l):!!s);if(1024&c)return!0;if(16&c)return r?hasPropsChanged(r,s,l):!!s;if(8&c){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const n=e[t];if(s[n]!==r[n]&&!isEmitListener(l,n))return!0}}return!1}function hasPropsChanged(e,t,n){const r=Object.keys(t);if(r.length!==Object.keys(e).length)return!0;for(let i=0;i<r.length;i++){const o=r[i];if(t[o]!==e[o]&&!isEmitListener(n,o))return!0}return!1}function updateHOCHostEl({vnode:e,parent:t},n){for(;t;){const r=t.subTree;if(r.suspense&&r.suspense.activeBranch===e&&(r.el=e.el),r!==e)break;(e=t.vnode).el=n,t=t.parent}}const COMPONENTS="components";function resolveComponent(e,t){return resolveAsset(COMPONENTS,e,!0,t)||e}const NULL_DYNAMIC_COMPONENT=Symbol.for("v-ndc");function resolveDynamicComponent(e){return isString$1(e)?resolveAsset(COMPONENTS,e,!1)||e:e||NULL_DYNAMIC_COMPONENT}function resolveAsset(e,t,n=!0,r=!1){const i=currentRenderingInstance||currentInstance;if(i){const n=i.type;if(e===COMPONENTS){const e=getComponentName(n,!1);if(e&&(e===t||e===camelize(t)||e===capitalize(camelize(t))))return n}const o=resolve(i[e]||n[e],t)||resolve(i.appContext[e],t);return!o&&r?n:o}}function resolve(e,t){return e&&(e[t]||e[camelize(t)]||e[capitalize(camelize(t))])}const isSuspense=e=>e.__isSuspense;function queueEffectWithSuspense(e,t){t&&t.pendingBranch?isArray$3(e)?t.effects.push(...e):t.effects.push(e):queuePostFlushCb(e)}const ssrContextKey=Symbol.for("v-scx"),useSSRContext=()=>inject(ssrContextKey);function watchEffect(e,t){return doWatch(e,null,t)}const INITIAL_WATCHER_VALUE={};function watch(e,t,n){return doWatch(e,t,n)}function doWatch(e,t,{immediate:n,deep:r,flush:i,once:o,onTrack:s,onTrigger:a}=EMPTY_OBJ){if(t&&o){const e=t;t=(...t)=>{e(...t),T()}}const c=currentInstance,l=e=>!0===r?e:traverse(e,!1===r?1:void 0);let d,u,p=!1,h=!1;if(isRef(e)?(d=()=>e.value,p=isShallow(e)):isReactive(e)?(d=()=>l(e),p=!0):isArray$3(e)?(h=!0,p=e.some(e=>isReactive(e)||isShallow(e)),d=()=>e.map(e=>isRef(e)?e.value:isReactive(e)?l(e):isFunction$2(e)?callWithErrorHandling(e,c,2):void 0)):d=isFunction$2(e)?t?()=>callWithErrorHandling(e,c,2):()=>(u&&u(),callWithAsyncErrorHandling(e,c,3,[m])):NOOP,t&&r){const e=d;d=()=>traverse(e())}let g,m=e=>{u=_.onStop=()=>{callWithErrorHandling(e,c,4),u=_.onStop=void 0}};if(isInSSRComponentSetup){if(m=NOOP,t?n&&callWithAsyncErrorHandling(t,c,3,[d(),h?[]:void 0,m]):d(),"sync"!==i)return NOOP;{const e=useSSRContext();g=e.__watcherHandles||(e.__watcherHandles=[])}}let f=h?new Array(e.length).fill(INITIAL_WATCHER_VALUE):INITIAL_WATCHER_VALUE;const v=()=>{if(_.active&&_.dirty)if(t){const e=_.run();(r||p||(h?e.some((e,t)=>hasChanged(e,f[t])):hasChanged(e,f)))&&(u&&u(),callWithAsyncErrorHandling(t,c,3,[e,f===INITIAL_WATCHER_VALUE?void 0:h&&f[0]===INITIAL_WATCHER_VALUE?[]:f,m]),f=e)}else _.run()};let y;v.allowRecurse=!!t,"sync"===i?y=v:"post"===i?y=()=>queuePostRenderEffect(v,c&&c.suspense):(v.pre=!0,c&&(v.id=c.uid),y=()=>queueJob(v));const _=new ReactiveEffect(d,NOOP,y),I=getCurrentScope(),T=()=>{_.stop(),I&&remove(I.effects,_)};return t?n?v():f=_.run():"post"===i?queuePostRenderEffect(_.run.bind(_),c&&c.suspense):_.run(),g&&g.push(T),T}function instanceWatch(e,t,n){const r=this.proxy,i=isString$1(e)?e.includes(".")?createPathGetter(r,e):()=>r[e]:e.bind(r,r);let o;isFunction$2(t)?o=t:(o=t.handler,n=t);const s=setCurrentInstance(this),a=doWatch(i,o.bind(r),n);return s(),a}function createPathGetter(e,t){const n=t.split(".");return()=>{let t=e;for(let e=0;e<n.length&&t;e++)t=t[n[e]];return t}}function traverse(e,t,n=0,r){if(!isObject$3(e)||e.__v_skip)return e;if(t&&t>0){if(n>=t)return e;n++}if((r=r||new Set).has(e))return e;if(r.add(e),isRef(e))traverse(e.value,t,n,r);else if(isArray$3(e))for(let i=0;i<e.length;i++)traverse(e[i],t,n,r);else if(isSet(e)||isMap(e))e.forEach(e=>{traverse(e,t,n,r)});else if(isPlainObject$3(e))for(const i in e)traverse(e[i],t,n,r);return e}function withDirectives(e,t){if(null===currentRenderingInstance)return e;const n=getExposeProxy(currentRenderingInstance)||currentRenderingInstance.proxy,r=e.dirs||(e.dirs=[]);for(let i=0;i<t.length;i++){let[e,o,s,a=EMPTY_OBJ]=t[i];e&&(isFunction$2(e)&&(e={mounted:e,updated:e}),e.deep&&traverse(o),r.push({dir:e,instance:n,value:o,oldValue:void 0,arg:s,modifiers:a}))}return e}function invokeDirectiveHook(e,t,n,r){const i=e.dirs,o=t&&t.dirs;for(let s=0;s<i.length;s++){const a=i[s];o&&(a.oldValue=o[s].value);let c=a.dir[r];c&&(pauseTracking(),callWithAsyncErrorHandling(c,n,8,[e.el,a,e,t]),resetTracking())}}const leaveCbKey=Symbol("_leaveCb"),enterCbKey$1=Symbol("_enterCb");function useTransitionState(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return onMounted(()=>{e.isMounted=!0}),onBeforeUnmount(()=>{e.isUnmounting=!0}),e}const TransitionHookValidator=[Function,Array],BaseTransitionPropsValidators={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:TransitionHookValidator,onEnter:TransitionHookValidator,onAfterEnter:TransitionHookValidator,onEnterCancelled:TransitionHookValidator,onBeforeLeave:TransitionHookValidator,onLeave:TransitionHookValidator,onAfterLeave:TransitionHookValidator,onLeaveCancelled:TransitionHookValidator,onBeforeAppear:TransitionHookValidator,onAppear:TransitionHookValidator,onAfterAppear:TransitionHookValidator,onAppearCancelled:TransitionHookValidator},BaseTransitionImpl={name:"BaseTransition",props:BaseTransitionPropsValidators,setup(e,{slots:t}){const n=getCurrentInstance(),r=useTransitionState();return()=>{const i=t.default&&getTransitionRawChildren(t.default(),!0);if(!i||!i.length)return;let o=i[0];if(i.length>1)for(const e of i)if(e.type!==Comment){o=e;break}const s=toRaw(e),{mode:a}=s;if(r.isLeaving)return emptyPlaceholder(o);const c=getKeepAliveChild(o);if(!c)return emptyPlaceholder(o);const l=resolveTransitionHooks(c,s,r,n);setTransitionHooks(c,l);const d=n.subTree,u=d&&getKeepAliveChild(d);if(u&&u.type!==Comment&&!isSameVNodeType(c,u)){const e=resolveTransitionHooks(u,s,r,n);if(setTransitionHooks(u,e),"out-in"===a)return r.isLeaving=!0,e.afterLeave=()=>{r.isLeaving=!1,!1!==n.update.active&&(n.effect.dirty=!0,n.update())},emptyPlaceholder(o);"in-out"===a&&c.type!==Comment&&(e.delayLeave=(e,t,n)=>{getLeavingNodesForType(r,u)[String(u.key)]=u,e[leaveCbKey]=()=>{t(),e[leaveCbKey]=void 0,delete l.delayedLeave},l.delayedLeave=n})}return o}}},BaseTransition=BaseTransitionImpl;function getLeavingNodesForType(e,t){const{leavingVNodes:n}=e;let r=n.get(t.type);return r||(r=Object.create(null),n.set(t.type,r)),r}function resolveTransitionHooks(e,t,n,r){const{appear:i,mode:o,persisted:s=!1,onBeforeEnter:a,onEnter:c,onAfterEnter:l,onEnterCancelled:d,onBeforeLeave:u,onLeave:p,onAfterLeave:h,onLeaveCancelled:g,onBeforeAppear:m,onAppear:f,onAfterAppear:v,onAppearCancelled:y}=t,_=String(e.key),I=getLeavingNodesForType(n,e),T=(e,t)=>{e&&callWithAsyncErrorHandling(e,r,9,t)},S=(e,t)=>{const n=t[1];T(e,t),isArray$3(e)?e.every(e=>e.length<=1)&&n():e.length<=1&&n()},E={mode:o,persisted:s,beforeEnter(t){let r=a;if(!n.isMounted){if(!i)return;r=m||a}t[leaveCbKey]&&t[leaveCbKey](!0);const o=I[_];o&&isSameVNodeType(e,o)&&o.el[leaveCbKey]&&o.el[leaveCbKey](),T(r,[t])},enter(e){let t=c,r=l,o=d;if(!n.isMounted){if(!i)return;t=f||c,r=v||l,o=y||d}let s=!1;const a=e[enterCbKey$1]=t=>{s||(s=!0,T(t?o:r,[e]),E.delayedLeave&&E.delayedLeave(),e[enterCbKey$1]=void 0)};t?S(t,[e,a]):a()},leave(t,r){const i=String(e.key);if(t[enterCbKey$1]&&t[enterCbKey$1](!0),n.isUnmounting)return r();T(u,[t]);let o=!1;const s=t[leaveCbKey]=n=>{o||(o=!0,r(),T(n?g:h,[t]),t[leaveCbKey]=void 0,I[i]===e&&delete I[i])};I[i]=e,p?S(p,[t,s]):s()},clone:e=>resolveTransitionHooks(e,t,n,r)};return E}function emptyPlaceholder(e){if(isKeepAlive(e))return(e=cloneVNode(e)).children=null,e}function getKeepAliveChild(e){return isKeepAlive(e)?e.children?e.children[0]:void 0:e}function setTransitionHooks(e,t){6&e.shapeFlag&&e.component?setTransitionHooks(e.component.subTree,t):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function getTransitionRawChildren(e,t=!1,n){let r=[],i=0;for(let o=0;o<e.length;o++){let s=e[o];const a=null==n?s.key:String(n)+String(null!=s.key?s.key:o);s.type===Fragment?(128&s.patchFlag&&i++,r=r.concat(getTransitionRawChildren(s.children,t,a))):(t||s.type!==Comment)&&r.push(null!=a?cloneVNode(s,{key:a}):s)}if(i>1)for(let o=0;o<r.length;o++)r[o].patchFlag=-2;return r}
/*! #__NO_SIDE_EFFECTS__ */function defineComponent(e,t){return isFunction$2(e)?(()=>extend$2({name:e.name},t,{setup:e}))():e}const isAsyncWrapper=e=>!!e.type.__asyncLoader;
/*! #__NO_SIDE_EFFECTS__ */function defineAsyncComponent(e){isFunction$2(e)&&(e={loader:e});const{loader:t,loadingComponent:n,errorComponent:r,delay:i=200,timeout:o,suspensible:s=!0,onError:a}=e;let c,l=null,d=0;const u=()=>{let e;return l||(e=l=t().catch(e=>{if(e=e instanceof Error?e:new Error(String(e)),a)return new Promise((t,n)=>{a(e,()=>t((d++,l=null,u())),()=>n(e),d+1)});throw e}).then(t=>e!==l&&l?l:(t&&(t.__esModule||"Module"===t[Symbol.toStringTag])&&(t=t.default),c=t,t)))};return defineComponent({name:"AsyncComponentWrapper",__asyncLoader:u,get __asyncResolved(){return c},setup(){const e=currentInstance;if(c)return()=>createInnerComp(c,e);const t=t=>{l=null,handleError(t,e,13,!r)};if(s&&e.suspense||isInSSRComponentSetup)return u().then(t=>()=>createInnerComp(t,e)).catch(e=>(t(e),()=>r?createVNode(r,{error:e}):null));const a=ref(!1),d=ref(),p=ref(!!i);return i&&setTimeout(()=>{p.value=!1},i),null!=o&&setTimeout(()=>{if(!a.value&&!d.value){const e=new Error(`Async component timed out after ${o}ms.`);t(e),d.value=e}},o),u().then(()=>{a.value=!0,e.parent&&isKeepAlive(e.parent.vnode)&&(e.parent.effect.dirty=!0,queueJob(e.parent.update))}).catch(e=>{t(e),d.value=e}),()=>a.value&&c?createInnerComp(c,e):d.value&&r?createVNode(r,{error:d.value}):n&&!p.value?createVNode(n):void 0}})}function createInnerComp(e,t){const{ref:n,props:r,children:i,ce:o}=t.vnode,s=createVNode(e,r,i);return s.ref=n,s.ce=o,delete t.vnode.ce,s}const isKeepAlive=e=>e.type.__isKeepAlive;class Cache{constructor(e){this.max=e,this._cache=new Map,this._keys=new Set,this._max=parseInt(e,10)}get(e){const{_cache:t,_keys:n,_max:r}=this,i=t.get(e);if(i)n.delete(e),n.add(e);else if(n.add(e),r&&n.size>r){const e=n.values().next().value;this.pruneCacheEntry(t.get(e)),this.delete(e)}return i}set(e,t){this._cache.set(e,t)}delete(e){this._cache.delete(e),this._keys.delete(e)}forEach(e,t){this._cache.forEach(e.bind(t))}}const KeepAliveImpl={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number],matchBy:{type:String,default:"name"},cache:Object},setup(e,{slots:t}){const n=getCurrentInstance(),r=n.ctx;if(!r.renderer)return()=>{const e=t.default&&t.default();return e&&1===e.length?e[0]:e};const i=e.cache||new Cache(e.max);i.pruneCacheEntry=s;let o=null;function s(t){var r;!o||!isSameVNodeType(t,o)||"key"===e.matchBy&&t.key!==o.key?(resetShapeFlag(r=t),d(r,n,a,!0)):o&&resetShapeFlag(o)}const a=n.suspense,{renderer:{p:c,m:l,um:d,o:{createElement:u}}}=r,p=u("div");function h(t){i.forEach((n,r)=>{const o=getMatchingName(n,e.matchBy);!o||t&&t(o)||(i.delete(r),s(n))})}r.activate=(e,t,n,r,i)=>{const o=e.component;if(o.ba){const e=o.isDeactivated;o.isDeactivated=!1,invokeArrayFns$1(o.ba),o.isDeactivated=e}l(e,t,n,0,a),c(o.vnode,e,t,n,o,a,r,e.slotScopeIds,i),queuePostRenderEffect(()=>{o.isDeactivated=!1,o.a&&invokeArrayFns$1(o.a);const t=e.props&&e.props.onVnodeMounted;t&&invokeVNodeHook(t,o.parent,e)},a)},r.deactivate=e=>{const t=e.component;t.bda&&invokeKeepAliveHooks(t.bda),l(e,p,null,1,a),queuePostRenderEffect(()=>{t.bda&&resetHookState(t.bda),t.da&&invokeArrayFns$1(t.da);const n=e.props&&e.props.onVnodeUnmounted;n&&invokeVNodeHook(n,t.parent,e),t.isDeactivated=!0},a)},watch(()=>[e.include,e.exclude,e.matchBy],([e,t])=>{e&&h(t=>matches$1(e,t)),t&&h(e=>!matches$1(t,e))},{flush:"post",deep:!0});let g=null;const m=()=>{null!=g&&i.set(g,getInnerChild(n.subTree))};return onMounted(m),onUpdated(m),onBeforeUnmount(()=>{i.forEach((t,r)=>{i.delete(r),s(t);const{subTree:o,suspense:a}=n,c=getInnerChild(o);if(t.type===c.type&&("key"!==e.matchBy||t.key===c.key)){c.component.bda&&invokeArrayFns$1(c.component.bda),resetShapeFlag(c);const e=c.component.da;return void(e&&queuePostRenderEffect(e,a))}})}),()=>{if(g=null,!t.default)return null;const n=t.default(),r=n[0];if(n.length>1)return o=null,n;if(!isVNode(r)||!(4&r.shapeFlag)&&!isSuspense(r.type))return o=null,r;let s=getInnerChild(r);const a=s.type,c=getMatchingName(s,e.matchBy),{include:l,exclude:d}=e;if(l&&(!c||!matches$1(l,c))||d&&c&&matches$1(d,c))return o=s,r;const u=null==s.key?a:s.key,p=i.get(u);return s.el&&(s=cloneVNode(s),isSuspense(r.type)&&(r.ssContent=s)),g=u,p&&(s.el=p.el,s.component=p.component,s.transition&&setTransitionHooks(s,s.transition),s.shapeFlag|=512),s.shapeFlag|=256,o=s,isSuspense(r.type)?r:s}}},KeepAlive=KeepAliveImpl;function matches$1(e,t){return isArray$3(e)?e.some(e=>matches$1(e,t)):isString$1(e)?e.split(",").includes(t):!!isRegExp(e)&&e.test(t)}function onBeforeActivate(e,t){registerKeepAliveHook(e,"ba",t)}function onActivated(e,t){registerKeepAliveHook(e,"a",t)}function onBeforeDeactivate(e,t){registerKeepAliveHook(e,"bda",t)}function onDeactivated(e,t){registerKeepAliveHook(e,"da",t)}function registerKeepAliveHook(e,t,n=currentInstance){const r=e.__wdc||(e.__wdc=()=>{let t=n;for(;t;){if(t.isDeactivated)return;t=t.parent}return e()});if(r.__called=!1,injectHook(t,r,n),n){let e=n.parent;for(;e&&e.parent;)isKeepAlive(e.parent.vnode)&&injectToKeepAliveRoot(r,t,n,e),e=e.parent}}function injectToKeepAliveRoot(e,t,n,r){const i=injectHook(t,e,r,!0);onUnmounted(()=>{remove(r[t],i)},n)}function resetShapeFlag(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function getInnerChild(e){return isSuspense(e.type)?e.ssContent:e}function getMatchingName(e,t){if("name"===t){const t=e.type;return getComponentName(isAsyncWrapper(e)?t.__asyncResolved||{}:t)}return String(e.key)}function invokeKeepAliveHooks(e){for(let t=0;t<e.length;t++){const n=e[t];n.__called||(n(),n.__called=!0)}}function resetHookState(e){e.forEach(e=>e.__called=!1)}function injectHook(e,t,n=currentInstance,r=!1){if(n){if(isRootHook(e)&&n.$pageInstance){if(n.type.__reserved)return;if(n!==n.$pageInstance&&(n=n.$pageInstance,isRootImmediateHook(e))){const r=n.proxy;callWithAsyncErrorHandling(t.bind(r),n,e,ON_LOAD===e?[r.$page.options]:[])}}const i=n[e]||(n[e]=[]),o=t.__weh||(t.__weh=(...r)=>{if(n.isUnmounted)return;pauseTracking();const i=setCurrentInstance(n),o=callWithAsyncErrorHandling(t,n,e,r);return i(),resetTracking(),o});return r?i.unshift(o):i.push(o),o}}const createHook=e=>(t,n=currentInstance)=>(!isInSSRComponentSetup||"sp"===e)&&injectHook(e,(...e)=>t(...e),n),onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(e,t=currentInstance){injectHook("ec",e,t)}function renderList(e,t,n,r){let i;const o=n&&n[r];if(isArray$3(e)||isString$1(e)){i=new Array(e.length);for(let n=0,r=e.length;n<r;n++)i[n]=t(e[n],n,void 0,o&&o[n])}else if("number"==typeof e){i=new Array(e);for(let n=0;n<e;n++)i[n]=t(n+1,n,void 0,o&&o[n])}else if(isObject$3(e))if(e[Symbol.iterator])i=Array.from(e,(e,n)=>t(e,n,void 0,o&&o[n]));else{const n=Object.keys(e);i=new Array(n.length);for(let r=0,s=n.length;r<s;r++){const s=n[r];i[r]=t(e[s],s,r,o&&o[r])}}else i=[];return n&&(n[r]=i),i}function renderSlot(e,t,n={},r,i){if(currentRenderingInstance.isCE||currentRenderingInstance.parent&&isAsyncWrapper(currentRenderingInstance.parent)&&currentRenderingInstance.parent.isCE)return"default"!==t&&(n.name=t),createVNode("slot",n,r&&r());let o=e[t];o&&o._c&&(o._d=!1),openBlock();const s=o&&ensureValidVNode(o(n)),a=createBlock(Fragment,{key:n.key||s&&s.key||`_${t}`},s||(r?r():[]),s&&1===e._?64:-2);return!i&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),o&&o._c&&(o._d=!0),a}function ensureValidVNode(e){return e.some(e=>!isVNode(e)||e.type!==Comment&&!(e.type===Fragment&&!ensureValidVNode(e.children)))?e:null}const getPublicInstance=e=>{if(!e)return null;if(isStatefulComponent(e)){return getExposeProxy(e)||e.proxy}return getPublicInstance(e.parent)},createForceUpdate=e=>function(){e.effect.dirty=!0,queueJob(e.update)},publicPropertiesMap=extend$2(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>getPublicInstance(e.parent),$root:e=>getPublicInstance(e.root),$emit:e=>e.emit,$options:e=>resolveMergedOptions(e),$forceUpdate:e=>e.f||(e.f=createForceUpdate(e)),$nextTick:e=>e.n||(e.n=nextTick.bind(e.proxy)),$watch:e=>instanceWatch.bind(e)}),hasSetupBinding=(e,t)=>e!==EMPTY_OBJ&&!e.__isScriptSetup&&hasOwn$1(e,t),PublicInstanceProxyHandlers={get({_:e},t){const{ctx:n,setupState:r,data:i,props:o,accessCache:s,type:a,appContext:c}=e;let l;if("$"!==t[0]){const a=s[t];if(void 0!==a)switch(a){case 1:return r[t];case 2:return i[t];case 4:return n[t];case 3:return o[t]}else{if(hasSetupBinding(r,t))return s[t]=1,r[t];if(i!==EMPTY_OBJ&&hasOwn$1(i,t))return s[t]=2,i[t];if((l=e.propsOptions[0])&&hasOwn$1(l,t))return s[t]=3,o[t];if(n!==EMPTY_OBJ&&hasOwn$1(n,t))return s[t]=4,n[t];shouldCacheAccess&&(s[t]=0)}}const d=publicPropertiesMap[t];let u,p;return d?("$attrs"===t&&track(e,"get",t),d(e)):(u=a.__cssModules)&&(u=u[t])?u:n!==EMPTY_OBJ&&hasOwn$1(n,t)?(s[t]=4,n[t]):(p=c.config.globalProperties,hasOwn$1(p,t)?p[t]:void 0)},set({_:e},t,n){const{data:r,setupState:i,ctx:o}=e;return hasSetupBinding(i,t)?(i[t]=n,!0):r!==EMPTY_OBJ&&hasOwn$1(r,t)?(r[t]=n,!0):!hasOwn$1(e.props,t)&&(("$"!==t[0]||!(t.slice(1)in e))&&(o[t]=n,!0))},has({_:{data:e,setupState:t,accessCache:n,ctx:r,appContext:i,propsOptions:o}},s){let a;return!!n[s]||e!==EMPTY_OBJ&&hasOwn$1(e,s)||hasSetupBinding(t,s)||(a=o[0])&&hasOwn$1(a,s)||hasOwn$1(r,s)||hasOwn$1(publicPropertiesMap,s)||hasOwn$1(i.config.globalProperties,s)},defineProperty(e,t,n){return null!=n.get?e._.accessCache[t]=0:hasOwn$1(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};function normalizePropsOrEmits(e){return isArray$3(e)?e.reduce((e,t)=>(e[t]=null,e),{}):e}let shouldCacheAccess=!0;function applyOptions$1(e){const t=resolveMergedOptions(e),n=e.proxy,r=e.ctx;shouldCacheAccess=!1,t.beforeCreate&&callHook$1(t.beforeCreate,e,"bc");const{data:i,computed:o,methods:s,watch:a,provide:c,inject:l,created:d,beforeMount:u,mounted:p,beforeUpdate:h,updated:g,activated:m,deactivated:f,beforeDestroy:v,beforeUnmount:y,destroyed:_,unmounted:I,render:T,renderTracked:S,renderTriggered:E,errorCaptured:M,serverPrefetch:b,expose:C,inheritAttrs:A,components:O,directives:R,filters:N}=t;if(l&&resolveInjections(l,r,null),s)for(const k in s){const e=s[k];isFunction$2(e)&&(r[k]=e.bind(n))}if(i){const t=i.call(n,n);isObject$3(t)&&(e.data=reactive(t))}if(shouldCacheAccess=!0,o)for(const k in o){const e=o[k],t=isFunction$2(e)?e.bind(n,n):isFunction$2(e.get)?e.get.bind(n,n):NOOP,i=!isFunction$2(e)&&isFunction$2(e.set)?e.set.bind(n):NOOP,s=computed$2({get:t,set:i});Object.defineProperty(r,k,{enumerable:!0,configurable:!0,get:()=>s.value,set:e=>s.value=e})}if(a)for(const k in a)createWatcher(a[k],r,n,k);if(c){const e=isFunction$2(c)?c.call(n):c;Reflect.ownKeys(e).forEach(t=>{provide(t,e[t])})}function w(e,t){isArray$3(t)?t.forEach(t=>e(t.bind(n))):t&&e(t.bind(n))}if(d&&callHook$1(d,e,"c"),w(onBeforeMount,u),w(onMounted,p),w(onBeforeUpdate,h),w(onUpdated,g),w(onActivated,m),w(onDeactivated,f),w(onErrorCaptured,M),w(onRenderTracked,S),w(onRenderTriggered,E),w(onBeforeUnmount,y),w(onUnmounted,I),w(onServerPrefetch,b),isArray$3(C))if(C.length){const t=e.exposed||(e.exposed={});C.forEach(e=>{Object.defineProperty(t,e,{get:()=>n[e],set:t=>n[e]=t})})}else e.exposed||(e.exposed={});T&&e.render===NOOP&&(e.render=T),null!=A&&(e.inheritAttrs=A),O&&(e.components=O),R&&(e.directives=R);const P=e.appContext.config.globalProperties.$applyOptions;P&&P(t,e,n)}function resolveInjections(e,t,n=NOOP){isArray$3(e)&&(e=normalizeInject(e));for(const r in e){const n=e[r];let i;i=isObject$3(n)?"default"in n?inject(n.from||r,n.default,!0):inject(n.from||r):inject(n),isRef(i)?Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:e=>i.value=e}):t[r]=i}}function callHook$1(e,t,n){callWithAsyncErrorHandling(isArray$3(e)?e.map(e=>e.bind(t.proxy)):e.bind(t.proxy),t,n)}function createWatcher(e,t,n,r){const i=r.includes(".")?createPathGetter(n,r):()=>n[r];if(isString$1(e)){const n=t[e];isFunction$2(n)&&watch(i,n)}else if(isFunction$2(e))watch(i,e.bind(n));else if(isObject$3(e))if(isArray$3(e))e.forEach(e=>createWatcher(e,t,n,r));else{const r=isFunction$2(e.handler)?e.handler.bind(n):t[e.handler];isFunction$2(r)&&watch(i,r,e)}}function resolveMergedOptions(e){const t=e.type,{mixins:n,extends:r}=t,{mixins:i,optionsCache:o,config:{optionMergeStrategies:s}}=e.appContext,a=o.get(t);let c;return a?c=a:i.length||n||r?(c={},i.length&&i.forEach(e=>mergeOptions$1(c,e,s,!0)),mergeOptions$1(c,t,s)):c=t,isObject$3(t)&&o.set(t,c),c}function mergeOptions$1(e,t,n,r=!1){const{mixins:i,extends:o}=t;o&&mergeOptions$1(e,o,n,!0),i&&i.forEach(t=>mergeOptions$1(e,t,n,!0));for(const s in t)if(r&&"expose"===s);else{const r=internalOptionMergeStrats[s]||n&&n[s];e[s]=r?r(e[s],t[s]):t[s]}return e}const internalOptionMergeStrats={data:mergeDataFn,props:mergeEmitsOrPropsOptions,emits:mergeEmitsOrPropsOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray$1,created:mergeAsArray$1,beforeMount:mergeAsArray$1,mounted:mergeAsArray$1,beforeUpdate:mergeAsArray$1,updated:mergeAsArray$1,beforeDestroy:mergeAsArray$1,beforeUnmount:mergeAsArray$1,destroyed:mergeAsArray$1,unmounted:mergeAsArray$1,activated:mergeAsArray$1,deactivated:mergeAsArray$1,errorCaptured:mergeAsArray$1,serverPrefetch:mergeAsArray$1,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(e,t){return t?e?function(){return extend$2(isFunction$2(e)?e.call(this,this):e,isFunction$2(t)?t.call(this,this):t)}:t:e}function mergeInject(e,t){return mergeObjectOptions(normalizeInject(e),normalizeInject(t))}function normalizeInject(e){if(isArray$3(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function mergeAsArray$1(e,t){return e?[...new Set([].concat(e,t))]:t}function mergeObjectOptions(e,t){return e?extend$2(Object.create(null),e,t):t}function mergeEmitsOrPropsOptions(e,t){return e?isArray$3(e)&&isArray$3(t)?[...new Set([...e,...t])]:extend$2(Object.create(null),normalizePropsOrEmits(e),normalizePropsOrEmits(null!=t?t:{})):t}function mergeWatchOptions(e,t){if(!e)return t;if(!t)return e;const n=extend$2(Object.create(null),e);for(const r in t)n[r]=mergeAsArray$1(e[r],t[r]);return n}function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid$1=0;function createAppAPI(e,t){return function(n,r=null){isFunction$2(n)||(n=extend$2({},n)),null==r||isObject$3(r)||(r=null);const i=createAppContext(),o=new WeakSet;let s=!1;const a=i.app={_uid:uid$1++,_component:n,_props:r,_container:null,_context:i,_instance:null,version:version$2,get config(){return i.config},set config(e){},use:(e,...t)=>(o.has(e)||(e&&isFunction$2(e.install)?(o.add(e),e.install(a,...t)):isFunction$2(e)&&(o.add(e),e(a,...t))),a),mixin:e=>(i.mixins.includes(e)||i.mixins.push(e),a),component:(e,t)=>t?(i.components[e]=t,a):i.components[e],directive:(e,t)=>t?(i.directives[e]=t,a):i.directives[e],mount(o,c,l){if(!s){const d=createVNode(n,r);return d.appContext=i,!0===l?l="svg":!1===l&&(l=void 0),c&&t?t(d,o):e(d,o,l),s=!0,a._container=o,o.__vue_app__=a,a._instance=d.component,getExposeProxy(d.component)||d.component.proxy}},unmount(){s&&(e(null,a._container),delete a._container.__vue_app__)},provide:(e,t)=>(i.provides[e]=t,a),runWithContext(e){const t=currentApp;currentApp=a;try{return e()}finally{currentApp=t}}};return a}}let currentApp=null;function provide(e,t){if(currentInstance){let n=currentInstance.provides;const r=currentInstance.parent&&currentInstance.parent.provides;r===n&&(n=currentInstance.provides=Object.create(r)),n[e]=t,"app"===currentInstance.type.mpType&&currentInstance.appContext.app.provide(e,t)}else;}function inject(e,t,n=!1){const r=currentInstance||currentRenderingInstance;if(r||currentApp){const i=r?null==r.parent?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:currentApp._context.provides;if(i&&e in i)return i[e];if(arguments.length>1)return n&&isFunction$2(t)?t.call(r&&r.proxy):t}}function initProps(e,t,n,r=!1){const i={},o={};def(o,InternalObjectKey,1),e.propsDefaults=Object.create(null),setFullProps(e,t,i,o);for(const s in e.propsOptions[0])s in i||(i[s]=void 0);n?e.props=r?i:shallowReactive(i):e.type.props?e.props=i:e.props=o,e.attrs=o}function updateProps(e,t,n,r){const{props:i,attrs:o,vnode:{patchFlag:s}}=e,a=toRaw(i),[c]=e.propsOptions;let l=!1;if(!(r||s>0)||16&s){let r;setFullProps(e,t,i,o)&&(l=!0);for(const o in a)t&&(hasOwn$1(t,o)||(r=hyphenate(o))!==o&&hasOwn$1(t,r))||(c?!n||void 0===n[o]&&void 0===n[r]||(i[o]=resolvePropValue(c,a,o,void 0,e,!0)):delete i[o]);if(o!==a)for(const e in o)t&&hasOwn$1(t,e)||(delete o[e],l=!0)}else if(8&s){const n=e.vnode.dynamicProps;for(let r=0;r<n.length;r++){let s=n[r];if(isEmitListener(e.emitsOptions,s))continue;const d=t[s];if(c)if(hasOwn$1(o,s))d!==o[s]&&(o[s]=d,l=!0);else{const t=camelize(s);i[t]=resolvePropValue(c,a,t,d,e,!1)}else d!==o[s]&&(o[s]=d,l=!0)}}l&&trigger(e,"set","$attrs")}function setFullProps(e,t,n,r){const[i,o]=e.propsOptions;let s,a=!1;if(t)for(let c in t){if(isReservedProp(c))continue;const l=t[c];let d;i&&hasOwn$1(i,d=camelize(c))?o&&o.includes(d)?(s||(s={}))[d]=l:n[d]=l:isEmitListener(e.emitsOptions,c)||c in r&&l===r[c]||(r[c]=l,a=!0)}if(o){const t=toRaw(n),r=s||EMPTY_OBJ;for(let s=0;s<o.length;s++){const a=o[s];n[a]=resolvePropValue(i,t,a,r[a],e,!hasOwn$1(r,a))}}return a}function resolvePropValue(e,t,n,r,i,o){const s=e[n];if(null!=s){const e=hasOwn$1(s,"default");if(e&&void 0===r){const e=s.default;if(s.type!==Function&&!s.skipFactory&&isFunction$2(e)){const{propsDefaults:o}=i;if(n in o)r=o[n];else{const s=setCurrentInstance(i);r=o[n]=e.call(null,t),s()}}else r=e}s[0]&&(o&&!e?r=!1:!s[1]||""!==r&&r!==hyphenate(n)||(r=!0))}return r}function normalizePropsOptions(e,t,n=!1){const r=t.propsCache,i=r.get(e);if(i)return i;const o=e.props,s={},a=[];let c=!1;if(!isFunction$2(e)){const r=e=>{c=!0;const[n,r]=normalizePropsOptions(e,t,!0);extend$2(s,n),r&&a.push(...r)};!n&&t.mixins.length&&t.mixins.forEach(r),e.extends&&r(e.extends),e.mixins&&e.mixins.forEach(r)}if(!o&&!c)return isObject$3(e)&&r.set(e,EMPTY_ARR),EMPTY_ARR;if(isArray$3(o))for(let d=0;d<o.length;d++){const e=camelize(o[d]);validatePropName(e)&&(s[e]=EMPTY_OBJ)}else if(o)for(const d in o){const e=camelize(d);if(validatePropName(e)){const t=o[d],n=s[e]=isArray$3(t)||isFunction$2(t)?{type:t}:extend$2({},t);if(n){const t=getTypeIndex(Boolean,n.type),r=getTypeIndex(String,n.type);n[0]=t>-1,n[1]=r<0||t<r,(t>-1||hasOwn$1(n,"default"))&&a.push(e)}}}const l=[s,a];return isObject$3(e)&&r.set(e,l),l}function validatePropName(e){return"$"!==e[0]&&!isReservedProp(e)}function getType(e){if(null===e)return"null";if("function"==typeof e)return e.name||"";if("object"==typeof e){return e.constructor&&e.constructor.name||""}return""}function isSameType(e,t){return getType(e)===getType(t)}function getTypeIndex(e,t){return isArray$3(t)?t.findIndex(t=>isSameType(t,e)):isFunction$2(t)&&isSameType(t,e)?0:-1}const isInternalKey=e=>"_"===e[0]||"$stable"===e,normalizeSlotValue=e=>isArray$3(e)?e.map(normalizeVNode):[normalizeVNode(e)],normalizeSlot$1=(e,t,n)=>{if(t._n)return t;const r=withCtx((...e)=>normalizeSlotValue(t(...e)),n);return r._c=!1,r},normalizeObjectSlots=(e,t,n)=>{const r=e._ctx;for(const i in e){if(isInternalKey(i))continue;const n=e[i];if(isFunction$2(n))t[i]=normalizeSlot$1(i,n,r);else if(null!=n){const e=normalizeSlotValue(n);t[i]=()=>e}}},normalizeVNodeSlots=(e,t)=>{const n=normalizeSlotValue(t);e.slots.default=()=>n},initSlots=(e,t)=>{if(32&e.vnode.shapeFlag){const n=t._;n?(e.slots=toRaw(t),def(t,"_",n)):normalizeObjectSlots(t,e.slots={})}else e.slots={},t&&normalizeVNodeSlots(e,t);def(e.slots,InternalObjectKey,1)},updateSlots=(e,t,n)=>{const{vnode:r,slots:i}=e;let o=!0,s=EMPTY_OBJ;if(32&r.shapeFlag){const e=t._;e?n&&1===e?o=!1:(extend$2(i,t),n||1!==e||delete i._):(o=!t.$stable,normalizeObjectSlots(t,i)),s=t}else t&&(normalizeVNodeSlots(e,t),s={default:1});if(o)for(const a in i)isInternalKey(a)||null!=s[a]||delete i[a]};function setRef(e,t,n,r,i=!1){if(isArray$3(e))return void e.forEach((e,o)=>setRef(e,t&&(isArray$3(t)?t[o]:t),n,r,i));if(isAsyncWrapper(r)&&!i)return;const o=4&r.shapeFlag?getExposeProxy(r.component)||r.component.proxy:r.el,s=i?null:o,{i:a,r:c}=e,l=t&&t.r,d=a.refs===EMPTY_OBJ?a.refs={}:a.refs,u=a.setupState;if(null!=l&&l!==c&&(isString$1(l)?(d[l]=null,hasOwn$1(u,l)&&(u[l]=null)):isRef(l)&&(l.value=null)),isFunction$2(c))callWithErrorHandling(c,a,12,[s,d]);else{const t=isString$1(c),r=isRef(c);if(t||r){const a=()=>{if(e.f){const n=t?hasOwn$1(u,c)?u[c]:d[c]:c.value;i?isArray$3(n)&&remove(n,o):isArray$3(n)?n.includes(o)||n.push(o):t?(d[c]=[o],hasOwn$1(u,c)&&(u[c]=d[c])):(c.value=[o],e.k&&(d[e.k]=c.value))}else t?(d[c]=s,hasOwn$1(u,c)&&(u[c]=s)):r&&(c.value=s,e.k&&(d[e.k]=s))};s?(a.id=-1,queuePostRenderEffect(a,n)):a()}}}const queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(e){return baseCreateRenderer(e)}function baseCreateRenderer(e,t){getGlobalThis().__VUE__=!0;const{insert:n,remove:r,patchProp:i,forcePatchProp:o,createElement:s,createText:a,createComment:c,setText:l,setElementText:d,parentNode:u,nextSibling:p,setScopeId:h=NOOP,insertStaticContent:g}=e,m=(e,t,n,r=null,i=null,o=null,s=void 0,a=null,c=!!t.dynamicChildren)=>{if(e===t)return;e&&!isSameVNodeType(e,t)&&(r=F(e),V(e,i,o,!0),e=null),-2===t.patchFlag&&(c=!1,t.dynamicChildren=null);const{type:l,ref:d,shapeFlag:u}=t;switch(l){case Text:f(e,t,n,r);break;case Comment:v(e,t,n,r);break;case Static:null==e&&y(t,n,r,s);break;case Fragment:C(e,t,n,r,i,o,s,a,c);break;default:1&u?_(e,t,n,r,i,o,s,a,c):6&u?A(e,t,n,r,i,o,s,a,c):(64&u||128&u)&&l.process(e,t,n,r,i,o,s,a,c,G)}null!=d&&i&&setRef(d,e&&e.ref,o,t||e,!t)},f=(e,t,r,i)=>{if(null==e)n(t.el=a(t.children),r,i);else{const n=t.el=e.el;t.children!==e.children&&l(n,t.children)}},v=(e,t,r,i)=>{null==e?n(t.el=c(t.children||""),r,i):t.el=e.el},y=(e,t,n,r)=>{[e.el,e.anchor]=g(e.children,t,n,r,e.el,e.anchor)},_=(e,t,n,r,i,o,s,a,c)=>{"svg"===t.type?s="svg":"math"===t.type&&(s="mathml"),null==e?I(t,n,r,i,o,s,a,c):E(e,t,i,o,s,a,c)},I=(e,t,r,o,a,c,l,u)=>{let p,h;const{props:g,shapeFlag:m,transition:f,dirs:v}=e;if(p=e.el=s(e.type,c,g&&g.is,g),8&m?d(p,e.children):16&m&&S(e.children,p,null,o,a,resolveChildrenNamespace(e,c),l,u),v&&invokeDirectiveHook(e,null,o,"created"),T(p,e,e.scopeId,l,o),g){for(const t in g)"value"===t||isReservedProp(t)||i(p,t,null,g[t],c,e.children,o,a,B);"value"in g&&i(p,"value",null,g.value,c),(h=g.onVnodeBeforeMount)&&invokeVNodeHook(h,o,e)}Object.defineProperty(p,"__vueParentComponent",{value:o,enumerable:!1}),v&&invokeDirectiveHook(e,null,o,"beforeMount");const y=needTransition(a,f);y&&f.beforeEnter(p),n(p,t,r),((h=g&&g.onVnodeMounted)||y||v)&&queuePostRenderEffect(()=>{h&&invokeVNodeHook(h,o,e),y&&f.enter(p),v&&invokeDirectiveHook(e,null,o,"mounted")},a)},T=(e,t,n,r,i)=>{if(n&&h(e,n),r)for(let o=0;o<r.length;o++)h(e,r[o]);if(i){if(t===i.subTree){const t=i.vnode;T(e,t,t.scopeId,t.slotScopeIds,i.parent)}}},S=(e,t,n,r,i,o,s,a,c=0)=>{for(let l=c;l<e.length;l++){const c=e[l]=a?cloneIfMounted(e[l]):normalizeVNode(e[l]);m(null,c,t,n,r,i,o,s,a)}},E=(e,t,n,r,s,a,c)=>{const l=t.el=e.el;let{patchFlag:u,dynamicChildren:p,dirs:h}=t;u|=16&e.patchFlag;const g=e.props||EMPTY_OBJ,m=t.props||EMPTY_OBJ;let f;if(n&&toggleRecurse(n,!1),(f=m.onVnodeBeforeUpdate)&&invokeVNodeHook(f,n,t,e),h&&invokeDirectiveHook(t,e,n,"beforeUpdate"),n&&toggleRecurse(n,!0),p?M(e.dynamicChildren,p,l,n,r,resolveChildrenNamespace(t,s),a):c||P(e,t,l,null,n,r,resolveChildrenNamespace(t,s),a,!1),u>0){if(16&u)b(l,t,g,m,n,r,s);else if(2&u&&g.class!==m.class&&i(l,"class",null,m.class,s),4&u&&i(l,"style",g.style,m.style,s),8&u){const a=t.dynamicProps;for(let t=0;t<a.length;t++){const c=a[t],d=g[c],u=m[c];(u!==d||"value"===c||o&&o(l,c))&&i(l,c,d,u,s,e.children,n,r,B)}}1&u&&e.children!==t.children&&d(l,t.children)}else c||null!=p||b(l,t,g,m,n,r,s);((f=m.onVnodeUpdated)||h)&&queuePostRenderEffect(()=>{f&&invokeVNodeHook(f,n,t,e),h&&invokeDirectiveHook(t,e,n,"updated")},r)},M=(e,t,n,r,i,o,s)=>{for(let a=0;a<t.length;a++){const c=e[a],l=t[a],d=c.el&&(c.type===Fragment||!isSameVNodeType(c,l)||70&c.shapeFlag)?u(c.el):n;m(c,l,d,null,r,i,o,s,!0)}},b=(e,t,n,r,s,a,c)=>{if(n!==r){if(n!==EMPTY_OBJ)for(const o in n)isReservedProp(o)||o in r||i(e,o,n[o],null,c,t.children,s,a,B);for(const l in r){if(isReservedProp(l))continue;const d=r[l],u=n[l];(d!==u&&"value"!==l||o&&o(e,l))&&i(e,l,u,d,c,t.children,s,a,B)}"value"in r&&i(e,"value",n.value,r.value,c)}},C=(e,t,r,i,o,s,c,l,d)=>{const u=t.el=e?e.el:a(""),p=t.anchor=e?e.anchor:a("");let{patchFlag:h,dynamicChildren:g,slotScopeIds:m}=t;m&&(l=l?l.concat(m):m),null==e?(n(u,r,i),n(p,r,i),S(t.children||[],r,p,o,s,c,l,d)):h>0&&64&h&&g&&e.dynamicChildren?(M(e.dynamicChildren,g,r,o,s,c,l),(null!=t.key||o&&t===o.subTree)&&traverseStaticChildren(e,t,!0)):P(e,t,r,p,o,s,c,l,d)},A=(e,t,n,r,i,o,s,a,c)=>{t.slotScopeIds=a,null==e?512&t.shapeFlag?i.ctx.activate(t,n,r,s,c):O(t,n,r,i,o,s,c):R(e,t,c)},O=(e,t,n,r,i,o,s)=>{const a=e.component=createComponentInstance(e,r,i);if(isKeepAlive(e)&&(a.ctx.renderer=G),setupComponent$1(a),a.asyncDep){if(i&&i.registerDep(a,N),!e.el){const e=a.subTree=createVNode(Comment);v(null,e,t,n)}}else N(a,e,t,n,i,o,s)},R=(e,t,n)=>{const r=t.component=e.component;if(shouldUpdateComponent(e,t,n)){if(r.asyncDep&&!r.asyncResolved)return void w(r,t,n);r.next=t,invalidateJob(r.update),r.effect.dirty=!0,r.update()}else t.el=e.el,r.vnode=t},N=(e,t,n,r,i,o,s)=>{const a=()=>{if(e.isMounted){let{next:t,bu:n,u:r,parent:c,vnode:l}=e;{const n=locateNonHydratedAsyncRoot(e);if(n)return t&&(t.el=l.el,w(e,t,s)),void n.asyncDep.then(()=>{e.isUnmounted||a()})}let d,p=t;toggleRecurse(e,!1),t?(t.el=l.el,w(e,t,s)):t=l,n&&invokeArrayFns$1(n),(d=t.props&&t.props.onVnodeBeforeUpdate)&&invokeVNodeHook(d,c,t,l),toggleRecurse(e,!0);const h=renderComponentRoot(e),g=e.subTree;e.subTree=h,m(g,h,u(g.el),F(g),e,i,o),t.el=h.el,null===p&&updateHOCHostEl(e,h.el),r&&queuePostRenderEffect(r,i),(d=t.props&&t.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(d,c,t,l),i)}else{let s;const{el:a,props:c}=t,{bm:l,m:d,parent:u}=e,p=isAsyncWrapper(t);if(toggleRecurse(e,!1),l&&invokeArrayFns$1(l),!p&&(s=c&&c.onVnodeBeforeMount)&&invokeVNodeHook(s,u,t),toggleRecurse(e,!0),a&&W){const n=()=>{e.subTree=renderComponentRoot(e),W(a,e.subTree,e,i,null)};p?t.type.__asyncLoader().then(()=>!e.isUnmounted&&n()):n()}else{const s=e.subTree=renderComponentRoot(e);m(null,s,n,r,e,i,o),t.el=s.el}if(d&&queuePostRenderEffect(d,i),!p&&(s=c&&c.onVnodeMounted)){const e=t;queuePostRenderEffect(()=>invokeVNodeHook(s,u,e),i)}(256&t.shapeFlag||u&&isAsyncWrapper(u.vnode)&&256&u.vnode.shapeFlag)&&(e.ba&&invokeKeepAliveHooks(e.ba),e.a&&queuePostRenderEffect(e.a,i)),e.isMounted=!0,t=n=r=null}},c=e.effect=new ReactiveEffect(a,NOOP,()=>queueJob(l),e.scope),l=e.update=()=>{c.dirty&&c.run()};l.id=e.uid,toggleRecurse(e,!0),l()},w=(e,t,n)=>{t.component=e;const r=e.vnode.props;e.vnode=t,e.next=null,updateProps(e,t.props,r,n),updateSlots(e,t.children,n),pauseTracking(),flushPreFlushCbs(e),resetTracking()},P=(e,t,n,r,i,o,s,a,c=!1)=>{const l=e&&e.children,u=e?e.shapeFlag:0,p=t.children,{patchFlag:h,shapeFlag:g}=t;if(h>0){if(128&h)return void L(l,p,n,r,i,o,s,a,c);if(256&h)return void k(l,p,n,r,i,o,s,a,c)}8&g?(16&u&&B(l,i,o),p!==l&&d(n,p)):16&u?16&g?L(l,p,n,r,i,o,s,a,c):B(l,i,o,!0):(8&u&&d(n,""),16&g&&S(p,n,r,i,o,s,a,c))},k=(e,t,n,r,i,o,s,a,c)=>{t=t||EMPTY_ARR;const l=(e=e||EMPTY_ARR).length,d=t.length,u=Math.min(l,d);let p;for(p=0;p<u;p++){const r=t[p]=c?cloneIfMounted(t[p]):normalizeVNode(t[p]);m(e[p],r,n,null,i,o,s,a,c)}l>d?B(e,i,o,!0,!1,u):S(t,n,r,i,o,s,a,c,u)},L=(e,t,n,r,i,o,s,a,c)=>{let l=0;const d=t.length;let u=e.length-1,p=d-1;for(;l<=u&&l<=p;){const r=e[l],d=t[l]=c?cloneIfMounted(t[l]):normalizeVNode(t[l]);if(!isSameVNodeType(r,d))break;m(r,d,n,null,i,o,s,a,c),l++}for(;l<=u&&l<=p;){const r=e[u],l=t[p]=c?cloneIfMounted(t[p]):normalizeVNode(t[p]);if(!isSameVNodeType(r,l))break;m(r,l,n,null,i,o,s,a,c),u--,p--}if(l>u){if(l<=p){const e=p+1,u=e<d?t[e].el:r;for(;l<=p;)m(null,t[l]=c?cloneIfMounted(t[l]):normalizeVNode(t[l]),n,u,i,o,s,a,c),l++}}else if(l>p)for(;l<=u;)V(e[l],i,o,!0),l++;else{const h=l,g=l,f=new Map;for(l=g;l<=p;l++){const e=t[l]=c?cloneIfMounted(t[l]):normalizeVNode(t[l]);null!=e.key&&f.set(e.key,l)}let v,y=0;const _=p-g+1;let I=!1,T=0;const S=new Array(_);for(l=0;l<_;l++)S[l]=0;for(l=h;l<=u;l++){const r=e[l];if(y>=_){V(r,i,o,!0);continue}let d;if(null!=r.key)d=f.get(r.key);else for(v=g;v<=p;v++)if(0===S[v-g]&&isSameVNodeType(r,t[v])){d=v;break}void 0===d?V(r,i,o,!0):(S[d-g]=l+1,d>=T?T=d:I=!0,m(r,t[d],n,null,i,o,s,a,c),y++)}const E=I?getSequence(S):EMPTY_ARR;for(v=E.length-1,l=_-1;l>=0;l--){const e=g+l,u=t[e],p=e+1<d?t[e+1].el:r;0===S[l]?m(null,u,n,p,i,o,s,a,c):I&&(v<0||l!==E[v]?x(u,n,p,2):v--)}}},x=(e,t,r,i,o=null)=>{const{el:s,type:a,transition:c,children:l,shapeFlag:d}=e;if(6&d)return void x(e.component.subTree,t,r,i);if(128&d)return void e.suspense.move(t,r,i);if(64&d)return void a.move(e,t,r,G);if(a===Fragment){n(s,t,r);for(let e=0;e<l.length;e++)x(l[e],t,r,i);return void n(e.anchor,t,r)}if(a===Static)return void(({el:e,anchor:t},r,i)=>{let o;for(;e&&e!==t;)o=p(e),n(e,r,i),e=o;n(t,r,i)})(e,t,r);if(2!==i&&1&d&&c)if(0===i)c.beforeEnter(s),n(s,t,r),queuePostRenderEffect(()=>c.enter(s),o);else{const{leave:e,delayLeave:i,afterLeave:o}=c,a=()=>n(s,t,r),l=()=>{e(s,()=>{a(),o&&o()})};i?i(s,a,l):l()}else n(s,t,r)},V=(e,t,n,r=!1,i=!1)=>{const{type:o,props:s,ref:a,children:c,dynamicChildren:l,shapeFlag:d,patchFlag:u,dirs:p}=e;if(null!=a&&setRef(a,null,n,e,!0),256&d)return void t.ctx.deactivate(e);const h=1&d&&p,g=!isAsyncWrapper(e);let m;if(g&&(m=s&&s.onVnodeBeforeUnmount)&&invokeVNodeHook(m,t,e),6&d)$(e.component,n,r);else{if(128&d)return void e.suspense.unmount(n,r);h&&invokeDirectiveHook(e,null,t,"beforeUnmount"),64&d?e.type.remove(e,t,n,i,G,r):l&&(o!==Fragment||u>0&&64&u)?B(l,t,n,!1,!0):(o===Fragment&&384&u||!i&&16&d)&&B(c,t,n),r&&D(e)}(g&&(m=s&&s.onVnodeUnmounted)||h)&&queuePostRenderEffect(()=>{m&&invokeVNodeHook(m,t,e),h&&invokeDirectiveHook(e,null,t,"unmounted")},n)},D=e=>{const{type:t,el:n,anchor:i,transition:o}=e;if(t===Fragment)return void U(n,i);if(t===Static)return void(({el:e,anchor:t})=>{let n;for(;e&&e!==t;)n=p(e),r(e),e=n;r(t)})(e);const s=()=>{r(n),o&&!o.persisted&&o.afterLeave&&o.afterLeave()};if(1&e.shapeFlag&&o&&!o.persisted){const{leave:t,delayLeave:r}=o,i=()=>t(n,s);r?r(e.el,s,i):i()}else s()},U=(e,t)=>{let n;for(;e!==t;)n=p(e),r(e),e=n;r(t)},$=(e,t,n)=>{const{bum:r,scope:i,update:o,subTree:s,um:a}=e;r&&invokeArrayFns$1(r),i.stop(),o&&(o.active=!1,V(s,e,t,n)),a&&queuePostRenderEffect(a,t),queuePostRenderEffect(()=>{e.isUnmounted=!0},t),t&&t.pendingBranch&&!t.isUnmounted&&e.asyncDep&&!e.asyncResolved&&e.suspenseId===t.pendingId&&(t.deps--,0===t.deps&&t.resolve())},B=(e,t,n,r=!1,i=!1,o=0)=>{for(let s=o;s<e.length;s++)V(e[s],t,n,r,i)},F=e=>6&e.shapeFlag?F(e.component.subTree):128&e.shapeFlag?e.suspense.next():p(e.anchor||e.el);let j=!1;const q=(e,t,n)=>{null==e?t._vnode&&V(t._vnode,null,null,!0):m(t._vnode||null,e,t,null,null,null,n),j||(j=!0,flushPreFlushCbs(),flushPostFlushCbs(),j=!1),t._vnode=e},G={p:m,um:V,m:x,r:D,mt:O,mc:S,pc:P,pbc:M,n:F,o:e};let H,W;return t&&([H,W]=t(G)),{render:q,hydrate:H,createApp:createAppAPI(q,H)}}function resolveChildrenNamespace({type:e,props:t},n){return"svg"===n&&"foreignObject"===e||"mathml"===n&&"annotation-xml"===e&&t&&t.encoding&&t.encoding.includes("html")?void 0:n}function toggleRecurse({effect:e,update:t},n){e.allowRecurse=t.allowRecurse=n}function needTransition(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function traverseStaticChildren(e,t,n=!1){const r=e.children,i=t.children;if(isArray$3(r)&&isArray$3(i))for(let o=0;o<r.length;o++){const e=r[o];let t=i[o];1&t.shapeFlag&&!t.dynamicChildren&&((t.patchFlag<=0||32===t.patchFlag)&&(t=i[o]=cloneIfMounted(i[o]),t.el=e.el),n||traverseStaticChildren(e,t)),t.type===Text&&(t.el=e.el)}}function getSequence(e){const t=e.slice(),n=[0];let r,i,o,s,a;const c=e.length;for(r=0;r<c;r++){const c=e[r];if(0!==c){if(i=n[n.length-1],e[i]<c){t[r]=i,n.push(r);continue}for(o=0,s=n.length-1;o<s;)a=o+s>>1,e[n[a]]<c?o=a+1:s=a;c<e[n[o]]&&(o>0&&(t[r]=n[o-1]),n[o]=r)}}for(o=n.length,s=n[o-1];o-- >0;)n[o]=s,s=t[s];return n}function locateNonHydratedAsyncRoot(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:locateNonHydratedAsyncRoot(t)}const isTeleport=e=>e.__isTeleport,Fragment=Symbol.for("v-fgt"),Text=Symbol.for("v-txt"),Comment=Symbol.for("v-cmt"),Static=Symbol.for("v-stc"),blockStack=[];let currentBlock=null;function openBlock(e=!1){blockStack.push(currentBlock=e?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(e){isBlockTreeEnabled+=e}function setupBlock(e){return e.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(e),e}function createElementBlock(e,t,n,r,i,o){return setupBlock(createBaseVNode(e,t,n,r,i,o,!0))}function createBlock(e,t,n,r,i){return setupBlock(createVNode(e,t,n,r,i,!0))}function isVNode(e){return!!e&&!0===e.__v_isVNode}function isSameVNodeType(e,t){return e.type===t.type&&e.key===t.key}const InternalObjectKey="__vInternal",normalizeKey=({key:e})=>null!=e?e:null,normalizeRef=({ref:e,ref_key:t,ref_for:n})=>("number"==typeof e&&(e=""+e),null!=e?isString$1(e)||isRef(e)||isFunction$2(e)?{i:currentRenderingInstance,r:e,k:t,f:!!n}:e:null);function createBaseVNode(e,t=null,n=null,r=0,i=null,o=(e===Fragment?0:1),s=!1,a=!1){const c={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&normalizeKey(t),ref:t&&normalizeRef(t),scopeId:currentScopeId,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:r,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:currentRenderingInstance};return a?(normalizeChildren(c,n),128&o&&e.normalize(c)):n&&(c.shapeFlag|=isString$1(n)?8:16),isBlockTreeEnabled>0&&!s&&currentBlock&&(c.patchFlag>0||6&o)&&32!==c.patchFlag&&currentBlock.push(c),c}const createVNode=_createVNode;function _createVNode(e,t=null,n=null,r=0,i=null,o=!1){if(e&&e!==NULL_DYNAMIC_COMPONENT||(e=Comment),isVNode(e)){const r=cloneVNode(e,t,!0);return n&&normalizeChildren(r,n),isBlockTreeEnabled>0&&!o&&currentBlock&&(6&r.shapeFlag?currentBlock[currentBlock.indexOf(e)]=r:currentBlock.push(r)),r.patchFlag|=-2,r}if(isClassComponent(e)&&(e=e.__vccOpts),t){t=guardReactiveProps(t);let{class:e,style:n}=t;e&&!isString$1(e)&&(t.class=normalizeClass(e)),isObject$3(n)&&(isProxy(n)&&!isArray$3(n)&&(n=extend$2({},n)),t.style=normalizeStyle(n))}return createBaseVNode(e,t,n,r,i,isString$1(e)?1:isSuspense(e)?128:isTeleport(e)?64:isObject$3(e)?4:isFunction$2(e)?2:0,o,!0)}function guardReactiveProps(e){return e?isProxy(e)||InternalObjectKey in e?extend$2({},e):e:null}function cloneVNode(e,t,n=!1){const{props:r,ref:i,patchFlag:o,children:s}=e,a=t?mergeProps(r||{},t):r;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:a,key:a&&normalizeKey(a),ref:t&&t.ref?n&&i?isArray$3(i)?i.concat(normalizeRef(t)):[i,normalizeRef(t)]:normalizeRef(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:s,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Fragment?-1===o?16:16|o:o,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&cloneVNode(e.ssContent),ssFallback:e.ssFallback&&cloneVNode(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce}}function createTextVNode(e=" ",t=0){return createVNode(Text,null,e,t)}function createCommentVNode(e="",t=!1){return t?(openBlock(),createBlock(Comment,null,e)):createVNode(Comment,null,e)}function normalizeVNode(e){return null==e||"boolean"==typeof e?createVNode(Comment):isArray$3(e)?createVNode(Fragment,null,e.slice()):"object"==typeof e?cloneIfMounted(e):createVNode(Text,null,String(e))}function cloneIfMounted(e){return null===e.el&&-1!==e.patchFlag||e.memo?e:cloneVNode(e)}function normalizeChildren(e,t){let n=0;const{shapeFlag:r}=e;if(null==t)t=null;else if(isArray$3(t))n=16;else if("object"==typeof t){if(65&r){const n=t.default;return void(n&&(n._c&&(n._d=!1),normalizeChildren(e,n()),n._c&&(n._d=!0)))}{n=32;const r=t._;r||InternalObjectKey in t?3===r&&currentRenderingInstance&&(1===currentRenderingInstance.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=currentRenderingInstance}}else isFunction$2(t)?(t={default:t,_ctx:currentRenderingInstance},n=32):(t=String(t),64&r?(n=16,t=[createTextVNode(t)]):n=8);e.children=t,e.shapeFlag|=n}function mergeProps(...e){const t={};for(let n=0;n<e.length;n++){const r=e[n];for(const e in r)if("class"===e)t.class!==r.class&&(t.class=normalizeClass([t.class,r.class]));else if("style"===e)t.style=normalizeStyle([t.style,r.style]);else if(isOn(e)){const n=t[e],i=r[e];!i||n===i||isArray$3(n)&&n.includes(i)||(t[e]=n?[].concat(n,i):i)}else""!==e&&(t[e]=r[e])}return t}function invokeVNodeHook(e,t,n,r=null){callWithAsyncErrorHandling(e,t,7,[n,r])}const emptyAppContext=createAppContext();let uid=0;function createComponentInstance(e,t,n){const r=e.type,i=(t?t.appContext:e.appContext)||emptyAppContext,o={uid:uid++,vnode:e,type:r,parent:t,appContext:i,get renderer(){return"app"===r.mpType?"app":this.$pageInstance&&this.$pageInstance==o?"page":"component"},root:null,next:null,subTree:null,effect:null,update:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(r,i),emitsOptions:normalizeEmitsOptions(r,i),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:r.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,bda:null,da:null,ba:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return o.ctx={_:o},o.root=t?t.root:o,o.emit=emit$2.bind(null,o),o.$pageInstance=t&&t.$pageInstance,e.ce&&e.ce(o),o}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance;let internalSetCurrentInstance,setInSSRSetupState;{const e=getGlobalThis(),t=(t,n)=>{let r;return(r=e[t])||(r=e[t]=[]),r.push(n),e=>{r.length>1?r.forEach(t=>t(e)):r[0](e)}};internalSetCurrentInstance=t("__VUE_INSTANCE_SETTERS__",e=>currentInstance=e),setInSSRSetupState=t("__VUE_SSR_SETTERS__",e=>isInSSRComponentSetup=e)}const setCurrentInstance=e=>{const t=currentInstance;return internalSetCurrentInstance(e),e.scope.on(),()=>{e.scope.off(),internalSetCurrentInstance(t)}},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),internalSetCurrentInstance(null)};function isStatefulComponent(e){return 4&e.vnode.shapeFlag}let isInSSRComponentSetup=!1,compile$1;function setupComponent$1(e,t=!1){t&&setInSSRSetupState(t);const{props:n,children:r}=e.vnode,i=isStatefulComponent(e);initProps(e,n,i,t),initSlots(e,r);const o=i?setupStatefulComponent(e,t):void 0;return t&&setInSSRSetupState(!1),o}function setupStatefulComponent(e,t){const n=e.type;e.accessCache=Object.create(null),e.proxy=markRaw(new Proxy(e.ctx,PublicInstanceProxyHandlers));const{setup:r}=n;if(r){const n=e.setupContext=r.length>1?createSetupContext(e):null,i=setCurrentInstance(e);pauseTracking();const o=callWithErrorHandling(r,e,0,[e.props,n]);if(resetTracking(),i(),isPromise(o)){if(o.then(unsetCurrentInstance,unsetCurrentInstance),t)return o.then(n=>{handleSetupResult(e,n,t)}).catch(t=>{handleError(t,e,0)});e.asyncDep=o}else handleSetupResult(e,o,t)}else finishComponentSetup(e,t)}function handleSetupResult(e,t,n){isFunction$2(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:isObject$3(t)&&(e.setupState=proxyRefs(t)),finishComponentSetup(e,n)}function finishComponentSetup(e,t,n){const r=e.type;if(!e.render){if(!t&&compile$1&&!r.render){const t=r.template||resolveMergedOptions(e).template;if(t){const{isCustomElement:n,compilerOptions:i}=e.appContext.config,{delimiters:o,compilerOptions:s}=r,a=extend$2(extend$2({isCustomElement:n,delimiters:o},i),s);r.render=compile$1(t,a)}}e.render=r.render||NOOP}{const t=setCurrentInstance(e);pauseTracking();try{applyOptions$1(e)}finally{resetTracking(),t()}}}function getAttrsProxy(e){return e.attrsProxy||(e.attrsProxy=new Proxy(e.attrs,{get:(t,n)=>(track(e,"get","$attrs"),t[n])}))}function createSetupContext(e){const t=t=>{e.exposed=t||{}};return{get attrs(){return getAttrsProxy(e)},slots:e.slots,emit:e.emit,expose:t}}function getExposeProxy(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(proxyRefs(markRaw(e.exposed)),{get:(t,n)=>n in t?t[n]:n in publicPropertiesMap?publicPropertiesMap[n](e):void 0,has:(e,t)=>t in e||t in publicPropertiesMap}))}const classifyRE=/(?:^|[-_])(\w)/g,classify=e=>e.replace(classifyRE,e=>e.toUpperCase()).replace(/[-_]/g,"");function getComponentName(e,t=!0){return isFunction$2(e)?e.displayName||e.name:e.name||t&&e.__name}function formatComponentName(e,t,n=!1){let r=getComponentName(t);if(!r&&t.__file){const e=t.__file.match(/([^/\\]+)\.\w+$/);e&&(r=e[1])}if(!r&&e&&e.parent){const n=e=>{for(const n in e)if(e[n]===t)return n};r=n(e.components||e.parent.type.components)||n(e.appContext.components)}return r?classify(r):n?"App":"Anonymous"}function isClassComponent(e){return isFunction$2(e)&&"__vccOpts"in e}const computed$2=(e,t)=>computed$1(e,t,isInSSRComponentSetup);function h$1(e,t,n){const r=arguments.length;return 2===r?isObject$3(t)&&!isArray$3(t)?isVNode(t)?createVNode(e,null,[t]):createVNode(e,t):createVNode(e,null,t):(r>3?n=Array.prototype.slice.call(arguments,2):3===r&&isVNode(n)&&(n=[n]),createVNode(e,t,n))}const version$2="3.4.21",svgNS="http://www.w3.org/2000/svg",mathmlNS="http://www.w3.org/1998/Math/MathML",doc="undefined"!=typeof document?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,r)=>{const i="svg"===t?doc.createElementNS(svgNS,e):"mathml"===t?doc.createElementNS(mathmlNS,e):n?doc.createElement(e,{is:n}):doc.createElement(e);return"select"===e&&r&&null!=r.multiple&&i.setAttribute("multiple",r.multiple),i},createText:e=>doc.createTextNode(e),createComment:e=>doc.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>doc.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,n,r,i,o){const s=n?n.previousSibling:t.lastChild;if(i&&(i===o||i.nextSibling))for(;t.insertBefore(i.cloneNode(!0),n),i!==o&&(i=i.nextSibling););else{templateContainer.innerHTML="svg"===r?`<svg>${e}</svg>`:"mathml"===r?`<math>${e}</math>`:e;const i=templateContainer.content;if("svg"===r||"mathml"===r){const e=i.firstChild;for(;e.firstChild;)i.appendChild(e.firstChild);i.removeChild(e)}t.insertBefore(i,n)}return[s?s.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}},TRANSITION="transition",ANIMATION="animation",vtcKey=Symbol("_vtc"),Transition=(e,{slots:t})=>h$1(BaseTransition,resolveTransitionProps(e),t);Transition.displayName="Transition";const DOMTransitionPropsValidators={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};Transition.props=extend$2({},BaseTransitionPropsValidators,DOMTransitionPropsValidators);const callHook=(e,t=[])=>{isArray$3(e)?e.forEach(e=>e(...t)):e&&e(...t)},hasExplicitCallback=e=>!!e&&(isArray$3(e)?e.some(e=>e.length>1):e.length>1);function resolveTransitionProps(e){const t={};for(const O in e)O in DOMTransitionPropsValidators||(t[O]=e[O]);if(!1===e.css)return t;const{name:n="v",type:r,duration:i,enterFromClass:o=`${n}-enter-from`,enterActiveClass:s=`${n}-enter-active`,enterToClass:a=`${n}-enter-to`,appearFromClass:c=o,appearActiveClass:l=s,appearToClass:d=a,leaveFromClass:u=`${n}-leave-from`,leaveActiveClass:p=`${n}-leave-active`,leaveToClass:h=`${n}-leave-to`}=e,g=normalizeDuration(i),m=g&&g[0],f=g&&g[1],{onBeforeEnter:v,onEnter:y,onEnterCancelled:_,onLeave:I,onLeaveCancelled:T,onBeforeAppear:S=v,onAppear:E=y,onAppearCancelled:M=_}=t,b=(e,t,n)=>{removeTransitionClass(e,t?d:a),removeTransitionClass(e,t?l:s),n&&n()},C=(e,t)=>{e._isLeaving=!1,removeTransitionClass(e,u),removeTransitionClass(e,h),removeTransitionClass(e,p),t&&t()},A=e=>(t,n)=>{const i=e?E:y,s=()=>b(t,e,n);callHook(i,[t,s]),nextFrame(()=>{removeTransitionClass(t,e?c:o),addTransitionClass(t,e?d:a),hasExplicitCallback(i)||whenTransitionEnds(t,r,m,s)})};return extend$2(t,{onBeforeEnter(e){callHook(v,[e]),addTransitionClass(e,o),addTransitionClass(e,s)},onBeforeAppear(e){callHook(S,[e]),addTransitionClass(e,c),addTransitionClass(e,l)},onEnter:A(!1),onAppear:A(!0),onLeave(e,t){e._isLeaving=!0;const n=()=>C(e,t);addTransitionClass(e,u),forceReflow(),addTransitionClass(e,p),nextFrame(()=>{e._isLeaving&&(removeTransitionClass(e,u),addTransitionClass(e,h),hasExplicitCallback(I)||whenTransitionEnds(e,r,f,n))}),callHook(I,[e,n])},onEnterCancelled(e){b(e,!1),callHook(_,[e])},onAppearCancelled(e){b(e,!0),callHook(M,[e])},onLeaveCancelled(e){C(e),callHook(T,[e])}})}function normalizeDuration(e){if(null==e)return null;if(isObject$3(e))return[NumberOf(e.enter),NumberOf(e.leave)];{const t=NumberOf(e);return[t,t]}}function NumberOf(e){return toNumber(e)}function addTransitionClass(e,t){t.split(/\s+/).forEach(t=>t&&e.classList.add(t)),(e[vtcKey]||(e[vtcKey]=new Set)).add(t)}function removeTransitionClass(e,t){t.split(/\s+/).forEach(t=>t&&e.classList.remove(t));const n=e[vtcKey];n&&(n.delete(t),n.size||(e[vtcKey]=void 0))}function nextFrame(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let endId=0;function whenTransitionEnds(e,t,n,r){const i=e._endId=++endId,o=()=>{i===e._endId&&r()};if(n)return setTimeout(o,n);const{type:s,timeout:a,propCount:c}=getTransitionInfo(e,t);if(!s)return r();const l=s+"end";let d=0;const u=()=>{e.removeEventListener(l,p),o()},p=t=>{t.target===e&&++d>=c&&u()};setTimeout(()=>{d<c&&u()},a+1),e.addEventListener(l,p)}function getTransitionInfo(e,t){const n=window.getComputedStyle(e),r=e=>(n[e]||"").split(", "),i=r(`${TRANSITION}Delay`),o=r(`${TRANSITION}Duration`),s=getTimeout(i,o),a=r(`${ANIMATION}Delay`),c=r(`${ANIMATION}Duration`),l=getTimeout(a,c);let d=null,u=0,p=0;t===TRANSITION?s>0&&(d=TRANSITION,u=s,p=o.length):t===ANIMATION?l>0&&(d=ANIMATION,u=l,p=c.length):(u=Math.max(s,l),d=u>0?s>l?TRANSITION:ANIMATION:null,p=d?d===TRANSITION?o.length:c.length:0);return{type:d,timeout:u,propCount:p,hasTransform:d===TRANSITION&&/\b(transform|all)(,|$)/.test(r(`${TRANSITION}Property`).toString())}}function getTimeout(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((t,n)=>toMs(t)+toMs(e[n])))}function toMs(e){return"auto"===e?0:1e3*Number(e.slice(0,-1).replace(",","."))}function forceReflow(){return document.body.offsetHeight}function patchClass(e,t,n){const{__wxsAddClass:r,__wxsRemoveClass:i}=e;i&&i.length&&(t=(t||"").split(/\s+/).filter(e=>-1===i.indexOf(e)).join(" "),i.length=0),r&&r.length&&(t=(t||"")+" "+r.join(" "));const o=e[vtcKey];o&&(t=(t?[t,...o]:[...o]).join(" ")),null==t?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}const vShowOriginalDisplay=Symbol("_vod"),vShowHidden=Symbol("_vsh"),vShow={beforeMount(e,{value:t},{transition:n}){e[vShowOriginalDisplay]="none"===e.style.display?"":e.style.display,n&&t?n.beforeEnter(e):setDisplay(e,t)},mounted(e,{value:t},{transition:n}){n&&t&&n.enter(e)},updated(e,{value:t,oldValue:n},{transition:r}){!t!=!n&&(r?t?(r.beforeEnter(e),setDisplay(e,!0),r.enter(e)):r.leave(e,()=>{setDisplay(e,!1)}):setDisplay(e,t))},beforeUnmount(e,{value:t}){setDisplay(e,t)}};function setDisplay(e,t){e.style.display=t?e[vShowOriginalDisplay]:"none",e[vShowHidden]=!t}const CSS_VAR_TEXT=Symbol(""),displayRE=/(^|;)\s*display\s*:/;function patchStyle(e,t,n){const r=e.style,i=isString$1(n);let o=!1;if(n&&!i){if(t)if(isString$1(t))for(const e of t.split(";")){const t=e.slice(0,e.indexOf(":")).trim();null==n[t]&&setStyle(r,t,"")}else for(const e in t)null==n[e]&&setStyle(r,e,"");for(const e in n)"display"===e&&(o=!0),setStyle(r,e,n[e])}else if(i){if(t!==n){const e=r[CSS_VAR_TEXT];e&&(n+=";"+e),r.cssText=n,o=displayRE.test(n)}}else t&&e.removeAttribute("style");vShowOriginalDisplay in e&&(e[vShowOriginalDisplay]=o?r.display:"",e[vShowHidden]&&(r.display="none"));const{__wxsStyle:s}=e;if(s)for(const a in s)setStyle(r,a,s[a])}const importantRE=/\s*!important$/;function setStyle(e,t,n){if(isArray$3(n))n.forEach(n=>setStyle(e,t,n));else if(null==n&&(n=""),n=normalizeRpx(n),t.startsWith("--"))e.setProperty(t,n);else{const r=autoPrefix(e,t);importantRE.test(n)?e.setProperty(hyphenate(r),n.replace(importantRE,""),"important"):e[r]=n}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(e,t){const n=prefixCache[t];if(n)return n;let r=camelize(t);if("filter"!==r&&r in e)return prefixCache[t]=r;r=capitalize(r);for(let i=0;i<prefixes.length;i++){const n=prefixes[i]+r;if(n in e)return prefixCache[t]=n}return t}const{unit:unit,unitRatio:unitRatio,unitPrecision:unitPrecision}=defaultRpx2Unit,rpx2Unit=createRpx2Unit(unit,unitRatio,unitPrecision),normalizeRpx=e=>isString$1(e)?rpx2Unit(e):e,xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(e,t,n,r,i){if(r&&t.startsWith("xlink:"))null==n?e.removeAttributeNS(xlinkNS,t.slice(6,t.length)):e.setAttributeNS(xlinkNS,t,n);else{const r=isSpecialBooleanAttr(t);null==n||r&&!includeBooleanAttr(n)?e.removeAttribute(t):e.setAttribute(t,r?"":n)}}function patchDOMProp(e,t,n,r,i,o,s){if("innerHTML"===t||"textContent"===t)return r&&s(r,i,o),void(e[t]=null==n?"":n);const a=e.tagName;if("value"===t&&"PROGRESS"!==a&&!a.includes("-")){const r=null==n?"":n;return("OPTION"===a?e.getAttribute("value")||"":e.value)===r&&"_value"in e||(e.value=r),null==n&&e.removeAttribute(t),void(e._value=n)}let c=!1;if(""===n||null==n){const r=typeof e[t];"boolean"===r?n=includeBooleanAttr(n):null==n&&"string"===r?(n="",c=!0):"number"===r&&(n=0,c=!0)}try{e[t]=n}catch(l){}c&&e.removeAttribute(t)}function addEventListener(e,t,n,r){e.addEventListener(t,n,r)}function removeEventListener(e,t,n,r){e.removeEventListener(t,n,r)}const veiKey=Symbol("_vei");function patchEvent(e,t,n,r,i=null){const o=e[veiKey]||(e[veiKey]={}),s=o[t];if(r&&s)s.value=r;else{const[n,a]=parseName(t);if(r){addEventListener(e,n,o[t]=createInvoker(r,i),a)}else s&&(removeEventListener(e,n,s,a),o[t]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(e){let t;if(optionsModifierRE.test(e)){let n;for(t={};n=e.match(optionsModifierRE);)e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}return[":"===e[2]?e.slice(3):hyphenate(e.slice(2)),t]}let cachedNow=0;const p$1=Promise.resolve(),getNow=()=>cachedNow||(p$1.then(()=>cachedNow=0),cachedNow=Date.now());function createInvoker(e,t){const n=e=>{if(e._vts){if(e._vts<=n.attached)return}else e._vts=Date.now();const r=t&&t.proxy,i=r&&r.$nne,{value:o}=n;if(i&&isArray$3(o)){const n=patchStopImmediatePropagation(e,o);for(let r=0;r<n.length;r++){const o=n[r];callWithAsyncErrorHandling(o,t,5,o.__wwe?[e]:i(e))}return}callWithAsyncErrorHandling(patchStopImmediatePropagation(e,n.value),t,5,i&&!o.__wwe?i(e,o,t):[e])};return n.value=e,n.attached=getNow(),n}function patchStopImmediatePropagation(e,t){if(isArray$3(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(e=>{const t=t=>!t._stopped&&e&&e(t);return t.__wwe=e.__wwe,t})}return t}function patchWxs(e,t,n,r=null){if(!n||!r)return;const i=t.replace("change:",""),{attrs:o}=r,s=o[i],a=(e.__wxsProps||(e.__wxsProps={}))[i];if(a===s)return;e.__wxsProps[i]=s;const c=r.proxy;nextTick(()=>{n(s,a,c.$gcd(c,!0),c.$gcd(c,!1))})}const isNativeOn=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,forcePatchProp=(e,t)=>0===t.indexOf("change:")||("class"===t&&e.__wxsClassChanged?(e.__wxsClassChanged=!1,!0):!("style"!==t||!e.__wxsStyleChanged)&&(e.__wxsStyleChanged=!1,!0)),patchProp=(e,t,n,r,i,o,s,a,c)=>{if(0===t.indexOf("change:"))return patchWxs(e,t,r,s);const l="svg"===i;"class"===t?patchClass(e,r,l):"style"===t?patchStyle(e,n,r):isOn(t)?isModelListener(t)||patchEvent(e,t,n,r,s):("."===t[0]?(t=t.slice(1),1):"^"===t[0]?(t=t.slice(1),0):shouldSetAsProp(e,t,r,l))?patchDOMProp(e,t,r,o,s,a,c):("true-value"===t?e._trueValue=r:"false-value"===t&&(e._falseValue=r),patchAttr(e,t,r,l))};function shouldSetAsProp(e,t,n,r){if(r)return"innerHTML"===t||"textContent"===t||!!(t in e&&isNativeOn(t)&&isFunction$2(n));if("spellcheck"===t||"draggable"===t||"translate"===t)return!1;if("form"===t)return!1;if("list"===t&&"INPUT"===e.tagName)return!1;if("type"===t&&"TEXTAREA"===e.tagName)return!1;if("width"===t||"height"===t){const t=e.tagName;if("IMG"===t||"VIDEO"===t||"CANVAS"===t||"SOURCE"===t)return!1}return(!isNativeOn(t)||!isString$1(n))&&t in e}const systemModifiers=["ctrl","shift","alt","meta"],modifierGuards={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,t)=>systemModifiers.some(n=>e[`${n}Key`]&&!t.includes(n))},withModifiers=(e,t)=>{const n=e._withMods||(e._withMods={}),r=t.join(".");return n[r]||(n[r]=(n,...r)=>{for(let e=0;e<t.length;e++){const r=modifierGuards[t[e]];if(r&&r(n,t))return}return e(n,...r)})},rendererOptions=extend$2({patchProp:patchProp,forcePatchProp:forcePatchProp},nodeOps);let renderer;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}const createApp$1=(...e)=>{const t=ensureRenderer().createApp(...e),{mount:n}=t;return t.mount=e=>{const r=normalizeContainer(e);if(!r)return;const i=t._component;isFunction$2(i)||i.render||i.template||(i.template=r.innerHTML),r.innerHTML="";const o=n(r,!1,resolveRootNamespace(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),o},t};function resolveRootNamespace(e){return e instanceof SVGElement?"svg":"function"==typeof MathMLElement&&e instanceof MathMLElement?"mathml":void 0}function normalizeContainer(e){if(isString$1(e)){return document.querySelector(e)}return e}
/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const isBrowser="undefined"!=typeof document;function isESModule(e){return e.__esModule||"Module"===e[Symbol.toStringTag]}const assign$1=Object.assign;function applyToParams(e,t){const n={};for(const r in t){const i=t[r];n[r]=isArray$2(i)?i.map(e):e(i)}return n}const noop$1=()=>{},isArray$2=Array.isArray,HASH_RE=/#/g,AMPERSAND_RE=/&/g,SLASH_RE=/\//g,EQUAL_RE=/=/g,IM_RE=/\?/g,PLUS_RE=/\+/g,ENC_BRACKET_OPEN_RE=/%5B/g,ENC_BRACKET_CLOSE_RE=/%5D/g,ENC_CARET_RE=/%5E/g,ENC_BACKTICK_RE=/%60/g,ENC_CURLY_OPEN_RE=/%7B/g,ENC_PIPE_RE=/%7C/g,ENC_CURLY_CLOSE_RE=/%7D/g,ENC_SPACE_RE=/%20/g;function commonEncode(e){return encodeURI(""+e).replace(ENC_PIPE_RE,"|").replace(ENC_BRACKET_OPEN_RE,"[").replace(ENC_BRACKET_CLOSE_RE,"]")}function encodeHash(e){return commonEncode(e).replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryValue(e){return commonEncode(e).replace(PLUS_RE,"%2B").replace(ENC_SPACE_RE,"+").replace(HASH_RE,"%23").replace(AMPERSAND_RE,"%26").replace(ENC_BACKTICK_RE,"`").replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryKey(e){return encodeQueryValue(e).replace(EQUAL_RE,"%3D")}function encodePath(e){return commonEncode(e).replace(HASH_RE,"%23").replace(IM_RE,"%3F")}function encodeParam(e){return null==e?"":encodePath(e).replace(SLASH_RE,"%2F")}function decode$1(e){try{return decodeURIComponent(""+e)}catch(t){}return""+e}const TRAILING_SLASH_RE=/\/$/,removeTrailingSlash=e=>e.replace(TRAILING_SLASH_RE,"");function parseURL(e,t,n="/"){let r,i={},o="",s="";const a=t.indexOf("#");let c=t.indexOf("?");return a<c&&a>=0&&(c=-1),c>-1&&(r=t.slice(0,c),o=t.slice(c+1,a>-1?a:t.length),i=e(o)),a>-1&&(r=r||t.slice(0,a),s=t.slice(a,t.length)),r=resolveRelativePath(null!=r?r:t,n),{fullPath:r+(o&&"?")+o+s,path:r,query:i,hash:decode$1(s)}}function stringifyURL(e,t){const n=t.query?e(t.query):"";return t.path+(n&&"?")+n+(t.hash||"")}function stripBase(e,t){return t&&e.toLowerCase().startsWith(t.toLowerCase())?e.slice(t.length)||"/":e}function isSameRouteLocation(e,t,n){const r=t.matched.length-1,i=n.matched.length-1;return r>-1&&r===i&&isSameRouteRecord(t.matched[r],n.matched[i])&&isSameRouteLocationParams(t.params,n.params)&&e(t.query)===e(n.query)&&t.hash===n.hash}function isSameRouteRecord(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function isSameRouteLocationParams(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!isSameRouteLocationParamsValue(e[n],t[n]))return!1;return!0}function isSameRouteLocationParamsValue(e,t){return isArray$2(e)?isEquivalentArray(e,t):isArray$2(t)?isEquivalentArray(t,e):e===t}function isEquivalentArray(e,t){return isArray$2(t)?e.length===t.length&&e.every((e,n)=>e===t[n]):1===e.length&&e[0]===t}function resolveRelativePath(e,t){if(e.startsWith("/"))return e;if(!e)return t;const n=t.split("/"),r=e.split("/"),i=r[r.length-1];".."!==i&&"."!==i||r.push("");let o,s,a=n.length-1;for(o=0;o<r.length;o++)if(s=r[o],"."!==s){if(".."!==s)break;a>1&&a--}return n.slice(0,a).join("/")+"/"+r.slice(o).join("/")}var NavigationType,NavigationType2,NavigationDirection,NavigationDirection2;function normalizeBase(e){if(!e)if(isBrowser){const t=document.querySelector("base");e=(e=t&&t.getAttribute("href")||"/").replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return"/"!==e[0]&&"#"!==e[0]&&(e="/"+e),removeTrailingSlash(e)}NavigationType2=NavigationType||(NavigationType={}),NavigationType2.pop="pop",NavigationType2.push="push",NavigationDirection2=NavigationDirection||(NavigationDirection={}),NavigationDirection2.back="back",NavigationDirection2.forward="forward",NavigationDirection2.unknown="";const BEFORE_HASH_RE=/^[^#]+#/;function createHref(e,t){return e.replace(BEFORE_HASH_RE,"#")+t}function getElementPosition(e,t){const n=document.documentElement.getBoundingClientRect(),r=e.getBoundingClientRect();return{behavior:t.behavior,left:r.left-n.left-(t.left||0),top:r.top-n.top-(t.top||0)}}const computeScrollPosition=()=>({left:window.scrollX,top:window.scrollY});function scrollToPosition(e){let t;if("el"in e){const n=e.el,r="string"==typeof n&&n.startsWith("#"),i="string"==typeof n?r?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!i)return;t=getElementPosition(i,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(null!=t.left?t.left:window.scrollX,null!=t.top?t.top:window.scrollY)}function getScrollKey(e,t){return(history.state?history.state.position-t:-1)+e}const scrollPositions=new Map;function saveScrollPosition(e,t){scrollPositions.set(e,t)}function getSavedScrollPosition(e){const t=scrollPositions.get(e);return scrollPositions.delete(e),t}let createBaseLocation=()=>location.protocol+"//"+location.host;function createCurrentLocation(e,t){const{pathname:n,search:r,hash:i}=t,o=e.indexOf("#");if(o>-1){let t=i.includes(e.slice(o))?e.slice(o).length:1,n=i.slice(t);return"/"!==n[0]&&(n="/"+n),stripBase(n,"")}return stripBase(n,e)+r+i}function useHistoryListeners(e,t,n,r){let i=[],o=[],s=null;const a=({state:o})=>{const a=createCurrentLocation(e,location),c=n.value,l=t.value;let d=0;if(o){if(n.value=a,t.value=o,s&&s===c)return void(s=null);d=l?o.position-l.position:0}else r(a);i.forEach(e=>{e(n.value,c,{delta:d,type:NavigationType.pop,direction:d?d>0?NavigationDirection.forward:NavigationDirection.back:NavigationDirection.unknown})})};function c(){const{history:e}=window;e.state&&e.replaceState(assign$1({},e.state,{scroll:computeScrollPosition()}),"")}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",c,{passive:!0}),{pauseListeners:function(){s=n.value},listen:function(e){i.push(e);const t=()=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)};return o.push(t),t},destroy:function(){for(const e of o)e();o=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",c)}}}function buildState(e,t,n,r=!1,i=!1){return{back:e,current:t,forward:n,replaced:r,position:window.history.length,scroll:i?computeScrollPosition():null}}function useHistoryStateNavigation(e){const{history:t,location:n}=window,r={value:createCurrentLocation(e,n)},i={value:t.state};function o(r,o,s){const a=e.indexOf("#"),c=a>-1?(n.host&&document.querySelector("base")?e:e.slice(a))+r:createBaseLocation()+e+r;try{t[s?"replaceState":"pushState"](o,"",c),i.value=o}catch(l){console.error(l),n[s?"replace":"assign"](c)}}return i.value||o(r.value,{back:null,current:r.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0),{location:r,state:i,push:function(e,n){const s=assign$1({},i.value,t.state,{forward:e,scroll:computeScrollPosition()});o(s.current,s,!0),o(e,assign$1({},buildState(r.value,e,null),{position:s.position+1},n),!1),r.value=e},replace:function(e,n){o(e,assign$1({},t.state,buildState(i.value.back,e,i.value.forward,!0),n,{position:i.value.position}),!0),r.value=e}}}function createWebHistory(e){const t=useHistoryStateNavigation(e=normalizeBase(e)),n=useHistoryListeners(e,t.state,t.location,t.replace);const r=assign$1({location:"",base:e,go:function(e,t=!0){t||n.pauseListeners(),history.go(e)},createHref:createHref.bind(null,e)},t,n);return Object.defineProperty(r,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(r,"state",{enumerable:!0,get:()=>t.state.value}),r}function createWebHashHistory(e){return(e=location.host?e||location.pathname+location.search:"").includes("#")||(e+="#"),createWebHistory(e)}function isRouteLocation(e){return"string"==typeof e||e&&"object"==typeof e}function isRouteName(e){return"string"==typeof e||"symbol"==typeof e}const START_LOCATION_NORMALIZED={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},NavigationFailureSymbol=Symbol("");var NavigationFailureType,NavigationFailureType2;function createRouterError(e,t){return assign$1(new Error,{type:e,[NavigationFailureSymbol]:!0},t)}function isNavigationFailure(e,t){return e instanceof Error&&NavigationFailureSymbol in e&&(null==t||!!(e.type&t))}NavigationFailureType2=NavigationFailureType||(NavigationFailureType={}),NavigationFailureType2[NavigationFailureType2.aborted=4]="aborted",NavigationFailureType2[NavigationFailureType2.cancelled=8]="cancelled",NavigationFailureType2[NavigationFailureType2.duplicated=16]="duplicated";const BASE_PARAM_PATTERN="[^/]+?",BASE_PATH_PARSER_OPTIONS={sensitive:!1,strict:!1,start:!0,end:!0},REGEX_CHARS_RE=/[.+*?^${}()[\]/\\]/g;function tokensToParser(e,t){const n=assign$1({},BASE_PATH_PARSER_OPTIONS,t),r=[];let i=n.start?"^":"";const o=[];for(const c of e){const e=c.length?[]:[90];n.strict&&!c.length&&(i+="/");for(let t=0;t<c.length;t++){const r=c[t];let s=40+(n.sensitive?.25:0);if(0===r.type)t||(i+="/"),i+=r.value.replace(REGEX_CHARS_RE,"\\$&"),s+=40;else if(1===r.type){const{value:e,repeatable:n,optional:l,regexp:d}=r;o.push({name:e,repeatable:n,optional:l});const u=d||BASE_PARAM_PATTERN;if(u!==BASE_PARAM_PATTERN){s+=10;try{new RegExp(`(${u})`)}catch(a){throw new Error(`Invalid custom RegExp for param "${e}" (${u}): `+a.message)}}let p=n?`((?:${u})(?:/(?:${u}))*)`:`(${u})`;t||(p=l&&c.length<2?`(?:/${p})`:"/"+p),l&&(p+="?"),i+=p,s+=20,l&&(s+=-8),n&&(s+=-20),".*"===u&&(s+=-50)}e.push(s)}r.push(e)}if(n.strict&&n.end){const e=r.length-1;r[e][r[e].length-1]+=.7000000000000001}n.strict||(i+="/?"),n.end?i+="$":n.strict&&(i+="(?:/|$)");const s=new RegExp(i,n.sensitive?"":"i");return{re:s,score:r,keys:o,parse:function(e){const t=e.match(s),n={};if(!t)return null;for(let r=1;r<t.length;r++){const e=t[r]||"",i=o[r-1];n[i.name]=e&&i.repeatable?e.split("/"):e}return n},stringify:function(t){let n="",r=!1;for(const i of e){r&&n.endsWith("/")||(n+="/"),r=!1;for(const e of i)if(0===e.type)n+=e.value;else if(1===e.type){const{value:o,repeatable:s,optional:a}=e,c=o in t?t[o]:"";if(isArray$2(c)&&!s)throw new Error(`Provided param "${o}" is an array but it is not repeatable (* or + modifiers)`);const l=isArray$2(c)?c.join("/"):c;if(!l){if(!a)throw new Error(`Missing required param "${o}"`);i.length<2&&(n.endsWith("/")?n=n.slice(0,-1):r=!0)}n+=l}}return n||"/"}}}function compareScoreArray(e,t){let n=0;for(;n<e.length&&n<t.length;){const r=t[n]-e[n];if(r)return r;n++}return e.length<t.length?1===e.length&&80===e[0]?-1:1:e.length>t.length?1===t.length&&80===t[0]?1:-1:0}function comparePathParserScore(e,t){let n=0;const r=e.score,i=t.score;for(;n<r.length&&n<i.length;){const e=compareScoreArray(r[n],i[n]);if(e)return e;n++}if(1===Math.abs(i.length-r.length)){if(isLastScoreNegative(r))return 1;if(isLastScoreNegative(i))return-1}return i.length-r.length}function isLastScoreNegative(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const ROOT_TOKEN={type:0,value:""},VALID_PARAM_RE=/[a-zA-Z0-9_]/;function tokenizePath(e){if(!e)return[[]];if("/"===e)return[[ROOT_TOKEN]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(e){throw new Error(`ERR (${n})/"${l}": ${e}`)}let n=0,r=n;const i=[];let o;function s(){o&&i.push(o),o=[]}let a,c=0,l="",d="";function u(){l&&(0===n?o.push({type:0,value:l}):1===n||2===n||3===n?(o.length>1&&("*"===a||"+"===a)&&t(`A repeatable param (${l}) must be alone in its segment. eg: '/:ids+.`),o.push({type:1,value:l,regexp:d,repeatable:"*"===a||"+"===a,optional:"*"===a||"?"===a})):t("Invalid state to consume buffer"),l="")}function p(){l+=a}for(;c<e.length;)if(a=e[c++],"\\"!==a||2===n)switch(n){case 0:"/"===a?(l&&u(),s()):":"===a?(u(),n=1):p();break;case 4:p(),n=r;break;case 1:"("===a?n=2:VALID_PARAM_RE.test(a)?p():(u(),n=0,"*"!==a&&"?"!==a&&"+"!==a&&c--);break;case 2:")"===a?"\\"==d[d.length-1]?d=d.slice(0,-1)+a:n=3:d+=a;break;case 3:u(),n=0,"*"!==a&&"?"!==a&&"+"!==a&&c--,d="";break;default:t("Unknown state")}else r=n,n=4;return 2===n&&t(`Unfinished custom RegExp for param "${l}"`),u(),s(),i}function createRouteRecordMatcher(e,t,n){const r=tokensToParser(tokenizePath(e.path),n),i=assign$1(r,{record:e,parent:t,children:[],alias:[]});return t&&!i.record.aliasOf==!t.record.aliasOf&&t.children.push(i),i}function createRouterMatcher(e,t){const n=[],r=new Map;function i(e,n,r){const a=!r,c=normalizeRouteRecord(e);c.aliasOf=r&&r.record;const l=mergeOptions(t,e),d=[c];if("alias"in e){const t="string"==typeof e.alias?[e.alias]:e.alias;for(const e of t)d.push(assign$1({},c,{components:r?r.record.components:c.components,path:e,aliasOf:r?r.record:c}))}let u,p;for(const t of d){const{path:d}=t;if(n&&"/"!==d[0]){const e=n.record.path,r="/"===e[e.length-1]?"":"/";t.path=n.record.path+(d&&r+d)}if(u=createRouteRecordMatcher(t,n,l),r?r.alias.push(u):(p=p||u,p!==u&&p.alias.push(u),a&&e.name&&!isAliasRecord(u)&&o(e.name)),c.children){const e=c.children;for(let t=0;t<e.length;t++)i(e[t],u,r&&r.children[t])}r=r||u,(u.record.components&&Object.keys(u.record.components).length||u.record.name||u.record.redirect)&&s(u)}return p?()=>{o(p)}:noop$1}function o(e){if(isRouteName(e)){const t=r.get(e);t&&(r.delete(e),n.splice(n.indexOf(t),1),t.children.forEach(o),t.alias.forEach(o))}else{const t=n.indexOf(e);t>-1&&(n.splice(t,1),e.record.name&&r.delete(e.record.name),e.children.forEach(o),e.alias.forEach(o))}}function s(e){let t=0;for(;t<n.length&&comparePathParserScore(e,n[t])>=0&&(e.record.path!==n[t].record.path||!isRecordChildOf(e,n[t]));)t++;n.splice(t,0,e),e.record.name&&!isAliasRecord(e)&&r.set(e.record.name,e)}return t=mergeOptions({strict:!1,end:!0,sensitive:!1},t),e.forEach(e=>i(e)),{addRoute:i,resolve:function(e,t){let i,o,s,a={};if("name"in e&&e.name){if(i=r.get(e.name),!i)throw createRouterError(1,{location:e});s=i.record.name,a=assign$1(paramsFromLocation(t.params,i.keys.filter(e=>!e.optional).concat(i.parent?i.parent.keys.filter(e=>e.optional):[]).map(e=>e.name)),e.params&&paramsFromLocation(e.params,i.keys.map(e=>e.name))),o=i.stringify(a)}else if(null!=e.path)o=e.path,i=n.find(e=>e.re.test(o)),i&&(a=i.parse(o),s=i.record.name);else{if(i=t.name?r.get(t.name):n.find(e=>e.re.test(t.path)),!i)throw createRouterError(1,{location:e,currentLocation:t});s=i.record.name,a=assign$1({},t.params,e.params),o=i.stringify(a)}const c=[];let l=i;for(;l;)c.unshift(l.record),l=l.parent;return{name:s,path:o,params:a,matched:c,meta:mergeMetaFields(c)}},removeRoute:o,getRoutes:function(){return n},getRecordMatcher:function(e){return r.get(e)}}}function paramsFromLocation(e,t){const n={};for(const r of t)r in e&&(n[r]=e[r]);return n}function normalizeRouteRecord(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:normalizeRecordProps(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function normalizeRecordProps(e){const t={},n=e.props||!1;if("component"in e)t.default=n;else for(const r in e.components)t[r]="object"==typeof n?n[r]:n;return t}function isAliasRecord(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function mergeMetaFields(e){return e.reduce((e,t)=>assign$1(e,t.meta),{})}function mergeOptions(e,t){const n={};for(const r in e)n[r]=r in t?t[r]:e[r];return n}function isRecordChildOf(e,t){return t.children.some(t=>t===e||isRecordChildOf(e,t))}function parseQuery(e){const t={};if(""===e||"?"===e)return t;const n=("?"===e[0]?e.slice(1):e).split("&");for(let r=0;r<n.length;++r){const e=n[r].replace(PLUS_RE," "),i=e.indexOf("="),o=decode$1(i<0?e:e.slice(0,i)),s=i<0?null:decode$1(e.slice(i+1));if(o in t){let e=t[o];isArray$2(e)||(e=t[o]=[e]),e.push(s)}else t[o]=s}return t}function stringifyQuery$1(e){let t="";for(let n in e){const r=e[n];if(n=encodeQueryKey(n),null==r){void 0!==r&&(t+=(t.length?"&":"")+n);continue}(isArray$2(r)?r.map(e=>e&&encodeQueryValue(e)):[r&&encodeQueryValue(r)]).forEach(e=>{void 0!==e&&(t+=(t.length?"&":"")+n,null!=e&&(t+="="+e))})}return t}function normalizeQuery(e){const t={};for(const n in e){const r=e[n];void 0!==r&&(t[n]=isArray$2(r)?r.map(e=>null==e?null:""+e):null==r?r:""+r)}return t}const matchedRouteKey=Symbol(""),viewDepthKey=Symbol(""),routerKey=Symbol(""),routeLocationKey=Symbol(""),routerViewLocationKey=Symbol("");function useCallbacks(){let e=[];return{add:function(t){return e.push(t),()=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)}},list:()=>e.slice(),reset:function(){e=[]}}}function guardToPromiseFn(e,t,n,r,i,o=e=>e()){const s=r&&(r.enterCallbacks[i]=r.enterCallbacks[i]||[]);return()=>new Promise((a,c)=>{const l=e=>{!1===e?c(createRouterError(4,{from:n,to:t})):e instanceof Error?c(e):isRouteLocation(e)?c(createRouterError(2,{from:t,to:e})):(s&&r.enterCallbacks[i]===s&&"function"==typeof e&&s.push(e),a())},d=o(()=>e.call(r&&r.instances[i],t,n,l));let u=Promise.resolve(d);e.length<3&&(u=u.then(l)),u.catch(e=>c(e))})}function extractComponentsGuards(e,t,n,r,i=e=>e()){const o=[];for(const s of e)for(const e in s.components){let a=s.components[e];if("beforeRouteEnter"===t||s.instances[e])if(isRouteComponent(a)){const c=(a.__vccOpts||a)[t];c&&o.push(guardToPromiseFn(c,n,r,s,e,i))}else{let c=a();o.push(()=>c.then(o=>{if(!o)return Promise.reject(new Error(`Couldn't resolve component "${e}" at "${s.path}"`));const a=isESModule(o)?o.default:o;s.components[e]=a;const c=(a.__vccOpts||a)[t];return c&&guardToPromiseFn(c,n,r,s,e,i)()}))}}return o}function isRouteComponent(e){return"object"==typeof e||"displayName"in e||"props"in e||"__vccOpts"in e}function useLink(e){const t=inject(routerKey),n=inject(routeLocationKey),r=computed$2(()=>t.resolve(unref(e.to))),i=computed$2(()=>{const{matched:e}=r.value,{length:t}=e,i=e[t-1],o=n.matched;if(!i||!o.length)return-1;const s=o.findIndex(isSameRouteRecord.bind(null,i));if(s>-1)return s;const a=getOriginalPath(e[t-2]);return t>1&&getOriginalPath(i)===a&&o[o.length-1].path!==a?o.findIndex(isSameRouteRecord.bind(null,e[t-2])):s}),o=computed$2(()=>i.value>-1&&includesParams(n.params,r.value.params)),s=computed$2(()=>i.value>-1&&i.value===n.matched.length-1&&isSameRouteLocationParams(n.params,r.value.params));return{route:r,href:computed$2(()=>r.value.href),isActive:o,isExactActive:s,navigate:function(n={}){return guardEvent(n)?t[unref(e.replace)?"replace":"push"](unref(e.to)).catch(noop$1):Promise.resolve()}}}const RouterLinkImpl=defineComponent({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:useLink,setup(e,{slots:t}){const n=reactive(useLink(e)),{options:r}=inject(routerKey),i=computed$2(()=>({[getLinkClass(e.activeClass,r.linkActiveClass,"router-link-active")]:n.isActive,[getLinkClass(e.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive}));return()=>{const r=t.default&&t.default(n);return e.custom?r:h$1("a",{"aria-current":n.isExactActive?e.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:i.value},r)}}}),RouterLink=RouterLinkImpl;function guardEvent(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey||e.defaultPrevented||void 0!==e.button&&0!==e.button)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function includesParams(e,t){for(const n in t){const r=t[n],i=e[n];if("string"==typeof r){if(r!==i)return!1}else if(!isArray$2(i)||i.length!==r.length||r.some((e,t)=>e!==i[t]))return!1}return!0}function getOriginalPath(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const getLinkClass=(e,t,n)=>null!=e?e:null!=t?t:n,RouterViewImpl=defineComponent({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:n}){const r=inject(routerViewLocationKey),i=computed$2(()=>e.route||r.value),o=inject(viewDepthKey,0),s=computed$2(()=>{let e=unref(o);const{matched:t}=i.value;let n;for(;(n=t[e])&&!n.components;)e++;return e}),a=computed$2(()=>i.value.matched[s.value]);provide(viewDepthKey,computed$2(()=>s.value+1)),provide(matchedRouteKey,a),provide(routerViewLocationKey,i);const c=ref();return watch(()=>[c.value,a.value,e.name],([e,t,n],[r,i,o])=>{t&&(t.instances[n]=e,i&&i!==t&&e&&e===r&&(t.leaveGuards.size||(t.leaveGuards=i.leaveGuards),t.updateGuards.size||(t.updateGuards=i.updateGuards))),!e||!t||i&&isSameRouteRecord(t,i)&&r||(t.enterCallbacks[n]||[]).forEach(t=>t(e))},{flush:"post"}),()=>{const r=i.value,o=e.name,s=a.value,l=s&&s.components[o];if(!l)return normalizeSlot(n.default,{Component:l,route:r});const d=s.props[o],u=d?!0===d?r.params:"function"==typeof d?d(r):d:null,p=h$1(l,assign$1({},u,t,{onVnodeUnmounted:e=>{e.component.isUnmounted&&(s.instances[o]=null)},ref:c}));return normalizeSlot(n.default,{Component:p,route:r})||p}}});function normalizeSlot(e,t){if(!e)return null;const n=e(t);return 1===n.length?n[0]:n}const RouterView=RouterViewImpl;function createRouter(e){const t=createRouterMatcher(e.routes,e),n=e.parseQuery||parseQuery,r=e.stringifyQuery||stringifyQuery$1,i=e.history,o=useCallbacks(),s=useCallbacks(),a=useCallbacks(),c=shallowRef(START_LOCATION_NORMALIZED);let l=START_LOCATION_NORMALIZED;isBrowser&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=applyToParams.bind(null,e=>""+e),u=applyToParams.bind(null,encodeParam),p=applyToParams.bind(null,decode$1);function h(e,o){if(o=assign$1({},o||c.value),"string"==typeof e){const r=parseURL(n,e,o.path),s=t.resolve({path:r.path},o),a=i.createHref(r.fullPath);return assign$1(r,s,{params:p(s.params),hash:decode$1(r.hash),redirectedFrom:void 0,href:a})}let s;if(null!=e.path)s=assign$1({},e,{path:parseURL(n,e.path,o.path).path});else{const t=assign$1({},e.params);for(const e in t)null==t[e]&&delete t[e];s=assign$1({},e,{params:u(t)}),o.params=u(o.params)}const a=t.resolve(s,o),l=e.hash||"";a.params=d(p(a.params));const h=stringifyURL(r,assign$1({},e,{hash:encodeHash(l),path:a.path})),g=i.createHref(h);return assign$1({fullPath:h,hash:l,query:r===stringifyQuery$1?normalizeQuery(e.query):e.query||{}},a,{redirectedFrom:void 0,href:g})}function g(e){return"string"==typeof e?parseURL(n,e,c.value.path):assign$1({},e)}function m(e,t){if(l!==e)return createRouterError(8,{from:t,to:e})}function f(e){return y(e)}function v(e){const t=e.matched[e.matched.length-1];if(t&&t.redirect){const{redirect:n}=t;let r="function"==typeof n?n(e):n;return"string"==typeof r&&(r=r.includes("?")||r.includes("#")?r=g(r):{path:r},r.params={}),assign$1({query:e.query,hash:e.hash,params:null!=r.path?{}:e.params},r)}}function y(e,t){const n=l=h(e),i=c.value,o=e.state,s=e.force,a=!0===e.replace,d=v(n);if(d)return y(assign$1(g(d),{state:"object"==typeof d?assign$1({},o,d.state):o,force:s,replace:a}),t||n);const u=n;let p;return u.redirectedFrom=t,!s&&isSameRouteLocation(r,i,n)&&(p=createRouterError(16,{to:u,from:i}),N(i,i,!0,!1)),(p?Promise.resolve(p):T(u,i)).catch(e=>isNavigationFailure(e)?isNavigationFailure(e,2)?e:R(e):O(e,u,i)).then(e=>{if(e){if(isNavigationFailure(e,2))return y(assign$1({replace:a},g(e.to),{state:"object"==typeof e.to?assign$1({},o,e.to.state):o,force:s}),t||u)}else e=E(u,i,!0,a,o);return S(u,i,e),e})}function _(e,t){const n=m(e,t);return n?Promise.reject(n):Promise.resolve()}function I(e){const t=k.values().next().value;return t&&"function"==typeof t.runWithContext?t.runWithContext(e):e()}function T(e,t){let n;const[r,i,a]=extractChangingRecords(e,t);n=extractComponentsGuards(r.reverse(),"beforeRouteLeave",e,t);for(const o of r)o.leaveGuards.forEach(r=>{n.push(guardToPromiseFn(r,e,t))});const c=_.bind(null,e,t);return n.push(c),x(n).then(()=>{n=[];for(const r of o.list())n.push(guardToPromiseFn(r,e,t));return n.push(c),x(n)}).then(()=>{n=extractComponentsGuards(i,"beforeRouteUpdate",e,t);for(const r of i)r.updateGuards.forEach(r=>{n.push(guardToPromiseFn(r,e,t))});return n.push(c),x(n)}).then(()=>{n=[];for(const r of a)if(r.beforeEnter)if(isArray$2(r.beforeEnter))for(const i of r.beforeEnter)n.push(guardToPromiseFn(i,e,t));else n.push(guardToPromiseFn(r.beforeEnter,e,t));return n.push(c),x(n)}).then(()=>(e.matched.forEach(e=>e.enterCallbacks={}),n=extractComponentsGuards(a,"beforeRouteEnter",e,t,I),n.push(c),x(n))).then(()=>{n=[];for(const r of s.list())n.push(guardToPromiseFn(r,e,t));return n.push(c),x(n)}).catch(e=>isNavigationFailure(e,8)?e:Promise.reject(e))}function S(e,t,n){a.list().forEach(r=>I(()=>r(e,t,n)))}function E(e,t,n,r,o){const s=m(e,t);if(s)return s;const a=t===START_LOCATION_NORMALIZED,l=isBrowser?history.state:{};n&&(r||a?i.replace(e.fullPath,assign$1({scroll:a&&l&&l.scroll},o)):i.push(e.fullPath,o)),c.value=e,N(e,t,n,a),R()}let M;let b,C=useCallbacks(),A=useCallbacks();function O(e,t,n){R(e);const r=A.list();return r.length?r.forEach(r=>r(e,t,n)):console.error(e),Promise.reject(e)}function R(e){return b||(b=!e,M||(M=i.listen((e,t,n)=>{if(!L.listening)return;const r=h(e),o=v(r);if(o)return void y(assign$1(o,{replace:!0}),r).catch(noop$1);l=r;const s=c.value;isBrowser&&saveScrollPosition(getScrollKey(s.fullPath,n.delta),computeScrollPosition()),T(r,s).catch(e=>isNavigationFailure(e,12)?e:isNavigationFailure(e,2)?(y(e.to,r).then(e=>{isNavigationFailure(e,20)&&!n.delta&&n.type===NavigationType.pop&&i.go(-1,!1)}).catch(noop$1),Promise.reject()):(n.delta&&i.go(-n.delta,!1),O(e,r,s))).then(e=>{(e=e||E(r,s,!1))&&(n.delta&&!isNavigationFailure(e,8)?i.go(-n.delta,!1):n.type===NavigationType.pop&&isNavigationFailure(e,20)&&i.go(-1,!1)),S(r,s,e)}).catch(noop$1)})),C.list().forEach(([t,n])=>e?n(e):t()),C.reset()),e}function N(t,n,r,i){const{scrollBehavior:o}=e;if(!isBrowser||!o)return Promise.resolve();const s=!r&&getSavedScrollPosition(getScrollKey(t.fullPath,0))||(i||!r)&&history.state&&history.state.scroll||null;return nextTick().then(()=>o(t,n,s)).then(e=>e&&scrollToPosition(e)).catch(e=>O(e,t,n))}const w=e=>i.go(e);let P;const k=new Set,L={currentRoute:c,listening:!0,addRoute:function(e,n){let r,i;return isRouteName(e)?(r=t.getRecordMatcher(e),i=n):i=e,t.addRoute(i,r)},removeRoute:function(e){const n=t.getRecordMatcher(e);n&&t.removeRoute(n)},hasRoute:function(e){return!!t.getRecordMatcher(e)},getRoutes:function(){return t.getRoutes().map(e=>e.record)},resolve:h,options:e,push:f,replace:function(e){return f(assign$1(g(e),{replace:!0}))},go:w,back:()=>w(-1),forward:()=>w(1),beforeEach:o.add,beforeResolve:s.add,afterEach:a.add,onError:A.add,isReady:function(){return b&&c.value!==START_LOCATION_NORMALIZED?Promise.resolve():new Promise((e,t)=>{C.add([e,t])})},install(e){e.component("RouterLink",RouterLink),e.component("RouterView",RouterView),e.config.globalProperties.$router=this,Object.defineProperty(e.config.globalProperties,"$route",{enumerable:!0,get:()=>unref(c)}),isBrowser&&!P&&c.value===START_LOCATION_NORMALIZED&&(P=!0,f(i.location).catch(e=>{}));const t={};for(const r in START_LOCATION_NORMALIZED)Object.defineProperty(t,r,{get:()=>c.value[r],enumerable:!0});e.provide(routerKey,this),e.provide(routeLocationKey,shallowReactive(t)),e.provide(routerViewLocationKey,c);const n=e.unmount;k.add(e),e.unmount=function(){k.delete(e),k.size<1&&(l=START_LOCATION_NORMALIZED,M&&M(),M=null,c.value=START_LOCATION_NORMALIZED,P=!1,b=!1),n()}}};function x(e){return e.reduce((e,t)=>e.then(()=>I(t)),Promise.resolve())}return L}function extractChangingRecords(e,t){const n=[],r=[],i=[],o=Math.max(t.matched.length,e.matched.length);for(let s=0;s<o;s++){const o=t.matched[s];o&&(e.matched.find(e=>isSameRouteRecord(e,o))?r.push(o):n.push(o));const a=e.matched[s];a&&(t.matched.find(e=>isSameRouteRecord(e,a))||i.push(a))}return[n,r,i]}function useRouter(){return inject(routerKey)}function useRoute(){return inject(routeLocationKey)}const isObject$2=e=>null!==e&&"object"==typeof e,defaultDelimiters=["{","}"];class BaseFormatter{constructor(){this._caches=Object.create(null)}interpolate(e,t,n=defaultDelimiters){if(!t)return[e];let r=this._caches[e];return r||(r=parse(e,n),this._caches[e]=r),compile(r,t)}}const RE_TOKEN_LIST_VALUE=/^(?:\d)+/,RE_TOKEN_NAMED_VALUE=/^(?:\w)+/;function parse(e,[t,n]){const r=[];let i=0,o="";for(;i<e.length;){let s=e[i++];if(s===t){o&&r.push({type:"text",value:o}),o="";let t="";for(s=e[i++];void 0!==s&&s!==n;)t+=s,s=e[i++];const a=s===n,c=RE_TOKEN_LIST_VALUE.test(t)?"list":a&&RE_TOKEN_NAMED_VALUE.test(t)?"named":"unknown";r.push({value:t,type:c})}else o+=s}return o&&r.push({type:"text",value:o}),r}function compile(e,t){const n=[];let r=0;const i=Array.isArray(t)?"list":isObject$2(t)?"named":"unknown";if("unknown"===i)return n;for(;r<e.length;){const o=e[r];switch(o.type){case"text":n.push(o.value);break;case"list":n.push(t[parseInt(o.value,10)]);break;case"named":"named"===i&&n.push(t[o.value])}r++}return n}const LOCALE_ZH_HANS="zh-Hans",LOCALE_ZH_HANT="zh-Hant",LOCALE_EN="en",LOCALE_FR="fr",LOCALE_ES="es",hasOwnProperty=Object.prototype.hasOwnProperty,hasOwn=(e,t)=>hasOwnProperty.call(e,t),defaultFormatter=new BaseFormatter;function include(e,t){return!!t.find(t=>-1!==e.indexOf(t))}function startsWith(e,t){return t.find(t=>0===e.indexOf(t))}function normalizeLocale(e,t){if(!e)return;if(e=e.trim().replace(/_/g,"-"),t&&t[e])return e;if("chinese"===(e=e.toLowerCase()))return LOCALE_ZH_HANS;if(0===e.indexOf("zh"))return e.indexOf("-hans")>-1?LOCALE_ZH_HANS:e.indexOf("-hant")>-1||include(e,["-tw","-hk","-mo","-cht"])?LOCALE_ZH_HANT:LOCALE_ZH_HANS;let n=[LOCALE_EN,LOCALE_FR,LOCALE_ES];t&&Object.keys(t).length>0&&(n=Object.keys(t));const r=startsWith(e,n);return r||void 0}class I18n{constructor({locale:e,fallbackLocale:t,messages:n,watcher:r,formater:i}){this.locale=LOCALE_EN,this.fallbackLocale=LOCALE_EN,this.message={},this.messages={},this.watchers=[],t&&(this.fallbackLocale=t),this.formater=i||defaultFormatter,this.messages=n||{},this.setLocale(e||LOCALE_EN),r&&this.watchLocale(r)}setLocale(e){const t=this.locale;this.locale=normalizeLocale(e,this.messages)||this.fallbackLocale,this.messages[this.locale]||(this.messages[this.locale]={}),this.message=this.messages[this.locale],t!==this.locale&&this.watchers.forEach(e=>{e(this.locale,t)})}getLocale(){return this.locale}watchLocale(e){const t=this.watchers.push(e)-1;return()=>{this.watchers.splice(t,1)}}add(e,t,n=!0){const r=this.messages[e];r?n?Object.assign(r,t):Object.keys(t).forEach(e=>{hasOwn(r,e)||(r[e]=t[e])}):this.messages[e]=t}f(e,t,n){return this.formater.interpolate(e,t,n).join("")}t(e,t,n){let r=this.message;return"string"==typeof t?(t=normalizeLocale(t,this.messages))&&(r=this.messages[t]):n=t,hasOwn(r,e)?this.formater.interpolate(r[e],n).join(""):(console.warn(`Cannot translate the value of keypath ${e}. Use the value of keypath as default.`),e)}}function watchAppLocale(e,t){e.$watchLocale?e.$watchLocale(e=>{t.setLocale(e)}):e.$watch(()=>e.$locale,e=>{t.setLocale(e)})}function getDefaultLocale(){return"undefined"!=typeof uni&&uni.getLocale?uni.getLocale():"undefined"!=typeof global&&global.getLocale?global.getLocale():LOCALE_EN}function initVueI18n(e,t={},n,r){if("string"!=typeof e){const n=[t,e];e=n[0],t=n[1]}"string"!=typeof e&&(e=getDefaultLocale()),"string"!=typeof n&&(n="undefined"!=typeof __uniConfig&&__uniConfig.fallbackLocale||LOCALE_EN);const i=new I18n({locale:e,fallbackLocale:n,messages:t,watcher:r});let o=(e,t)=>{if("function"!=typeof getApp$1)o=function(e,t){return i.t(e,t)};else{let e=!1;o=function(t,n){const r=getApp$1().$vm;return r&&(r.$locale,e||(e=!0,watchAppLocale(r,i))),i.t(t,n)}}return o(e,t)};return{i18n:i,f:(e,t,n)=>i.f(e,t,n),t:(e,t)=>o(e,t),add:(e,t,n=!0)=>i.add(e,t,n),watch:e=>i.watchLocale(e),getLocale:()=>i.getLocale(),setLocale:e=>i.setLocale(e)}}function isI18nStr(e,t){return e.indexOf(t[0])>-1}const isEnableLocale=once$1(()=>"undefined"!=typeof __uniConfig&&__uniConfig.locales&&!!Object.keys(__uniConfig.locales).length);let i18n;function getLocaleMessage(){const e=uni.getLocale(),t=__uniConfig.locales;return t[e]||t[__uniConfig.fallbackLocale]||t.en||{}}function formatI18n(e){return isI18nStr(e,I18N_JSON_DELIMITERS)?useI18n().f(e,getLocaleMessage(),I18N_JSON_DELIMITERS):e}function resolveJsonObj(e,t){if(1===t.length){if(e){const n=e=>isString$1(e)&&isI18nStr(e,I18N_JSON_DELIMITERS),r=t[0];let i=[];if(isArray$3(e)&&(i=e.filter(e=>n(e[r]))).length)return i;const o=e[t[0]];if(n(o))return e}return}const n=t.shift();return resolveJsonObj(e&&e[n],t)}function defineI18nProperties(e,t){return t.map(t=>defineI18nProperty(e,t))}function defineI18nProperty(e,t){const n=resolveJsonObj(e,t);if(!n)return!1;const r=t[t.length-1];if(isArray$3(n))n.forEach(e=>defineI18nProperty(e,[r]));else{let e=n[r];Object.defineProperty(n,r,{get:()=>formatI18n(e),set(t){e=t}})}return!0}function useI18n(){if(!i18n){let e;if(e=navigator.cookieEnabled&&window.localStorage&&localStorage[UNI_STORAGE_LOCALE]||__uniConfig.locale||navigator.language,i18n=initVueI18n(e),isEnableLocale()){const t=Object.keys(__uniConfig.locales||{});t.length&&t.forEach(e=>i18n.add(e,__uniConfig.locales[e])),i18n.setLocale(e)}}return i18n}function normalizeMessages(e,t,n){return t.reduce((t,r,i)=>(t[e+r]=n[i],t),{})}const initI18nAsyncMsgsOnce=once$1(()=>{const e="uni.async.",t=["error"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["The connection timed out, click the screen to try again."]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["Se agotó el tiempo de conexión, haga clic en la pantalla para volver a intentarlo."]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["La connexion a expiré, cliquez sur l'écran pour réessayer."]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["连接服务器超时，点击屏幕重试"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["連接服務器超時，點擊屏幕重試"]),!1)}),initI18nShowActionSheetMsgsOnce=once$1(()=>{const e="uni.showActionSheet.",t=["cancel"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["Cancel"]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["Cancelar"]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["Annuler"]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["取消"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["取消"]),!1)}),initI18nShowToastMsgsOnce=once$1(()=>{const e="uni.showToast.",t=["unpaired"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["Please note showToast must be paired with hideToast"]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["Tenga en cuenta que showToast debe estar emparejado con hideToast"]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["Veuillez noter que showToast doit être associé à hideToast"]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["请注意 showToast 与 hideToast 必须配对使用"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["請注意 showToast 與 hideToast 必須配對使用"]),!1)}),initI18nShowLoadingMsgsOnce=once$1(()=>{const e="uni.showLoading.",t=["unpaired"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["Please note showLoading must be paired with hideLoading"]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["Tenga en cuenta que showLoading debe estar emparejado con hideLoading"]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["Veuillez noter que showLoading doit être associé à hideLoading"]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["请注意 showLoading 与 hideLoading 必须配对使用"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["請注意 showLoading 與 hideLoading 必須配對使用"]),!1)}),initI18nShowModalMsgsOnce=once$1(()=>{const e="uni.showModal.",t=["cancel","confirm"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["Cancel","OK"]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["Cancelar","OK"]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["Annuler","OK"]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["取消","确定"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["取消","確定"]),!1)}),initI18nChooseFileMsgsOnce=once$1(()=>{const e="uni.chooseFile.",t=["notUserActivation"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["File chooser dialog can only be shown with a user activation"]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["El cuadro de diálogo del selector de archivos solo se puede mostrar con la activación del usuario"]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["La boîte de dialogue du sélecteur de fichier ne peut être affichée qu'avec une activation par l'utilisateur"]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["文件选择器对话框只能在由用户激活时显示"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["文件選擇器對話框只能在由用戶激活時顯示"]),!1)}),initI18nSetClipboardDataMsgsOnce=once$1(()=>{const e="uni.setClipboardData.",t=["success","fail"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["Content copied","Copy failed, please copy manually"]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["Contenido copiado","Error al copiar, copie manualmente"]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["Contenu copié","Échec de la copie, copiez manuellement"]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["内容已复制","复制失败，请手动复制"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["內容已復制","復制失敗，請手動復製"]),!1)}),initI18nGetClipboardDataMsgsOnce=once$1(()=>{const e="uni.getClipboardData.",t=["fail"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["Reading failed, please paste manually"]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["Error de lectura, pegue manualmente"]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["Échec de la lecture, veuillez coller manuellement"]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["读取失败，请手动粘贴"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["讀取失敗，請手動粘貼"]),!1)}),initI18nPickerMsgsOnce=once$1(()=>{const e="uni.picker.",t=["done","cancel"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["Done","Cancel"]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["OK","Cancelar"]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["OK","Annuler"]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["完成","取消"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["完成","取消"]),!1)}),initI18nVideoMsgsOnce=once$1(()=>{const e="uni.video.",t=["danmu","volume"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["Danmu","Volume"]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["Danmu","Volumen"]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["Danmu","Le Volume"]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["弹幕","音量"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["彈幕","音量"]),!1)}),initI18nChooseLocationMsgsOnce=once$1(()=>{const e="uni.chooseLocation.",t=["search","cancel"];useI18n().add(LOCALE_EN,normalizeMessages(e,t,["Find Place","Cancel"]),!1),useI18n().add(LOCALE_ES,normalizeMessages(e,t,["Encontrar","Cancelar"]),!1),useI18n().add(LOCALE_FR,normalizeMessages(e,t,["Trouve","Annuler"]),!1),useI18n().add(LOCALE_ZH_HANS,normalizeMessages(e,t,["搜索地点","取消"]),!1),useI18n().add(LOCALE_ZH_HANT,normalizeMessages(e,t,["搜索地點","取消"]),!1)});function initNavigationBarI18n(e){if(isEnableLocale())return defineI18nProperties(e,[["titleText"],["searchInput","placeholder"],["buttons","text"]])}function initTabBarI18n(e){return isEnableLocale()&&e.list&&e.list.forEach(e=>{defineI18nProperty(e,["text"])}),e}function initBridge(e){const t=new E$1$1;return{on:(e,n)=>t.on(e,n),once:(e,n)=>t.once(e,n),off:(e,n)=>t.off(e,n),emit:(e,...n)=>t.emit(e,...n),subscribe(n,r,i=!1){t[i?"once":"on"](`${e}.${n}`,r)},unsubscribe(n,r){t.off(`${e}.${n}`,r)},subscribeHandler(n,r,i){t.emit(`${e}.${n}`,r,i)}}}const INVOKE_VIEW_API="invokeViewApi",INVOKE_SERVICE_API="invokeServiceApi";let invokeServiceMethodId=1;const invokeServiceMethod=(e,t,n)=>{const{subscribe:r,publishHandler:i}=UniViewJSBridge$1,o=n?invokeServiceMethodId++:0;n&&r(INVOKE_SERVICE_API+"."+o,n,!0),i(INVOKE_SERVICE_API,{id:o,name:e,args:t})},viewMethods=Object.create(null);function normalizeViewMethodName(e,t){return e+"."+t}function subscribeViewMethod(e,t){UniViewJSBridge$1.subscribe(normalizeViewMethodName(e,INVOKE_VIEW_API),onInvokeViewMethod)}function unsubscribeViewMethod(e){UniViewJSBridge$1.unsubscribe(normalizeViewMethodName(e,INVOKE_VIEW_API)),Object.keys(viewMethods).forEach(t=>{0===t.indexOf(e+".")&&delete viewMethods[t]})}function registerViewMethod(e,t,n){t=normalizeViewMethodName(e,t),viewMethods[t]||(viewMethods[t]=n)}function unregisterViewMethod(e,t){t=normalizeViewMethodName(e,t),delete viewMethods[t]}function onInvokeViewMethod({id:e,name:t,args:n},r){t=normalizeViewMethodName(r,t);const i=t=>{e&&UniViewJSBridge$1.publishHandler(INVOKE_VIEW_API+"."+e,t)},o=viewMethods[t];o?o(n,i):i({})}const ViewJSBridge=extend$2(initBridge("service"),{invokeServiceMethod:invokeServiceMethod}),LONGPRESS_TIMEOUT=350,LONGPRESS_THRESHOLD=10,passiveOptions$3=passive(!0);let longPressTimer;function clearLongPressTimer(){longPressTimer&&(clearTimeout(longPressTimer),longPressTimer=null)}let startPageX=0,startPageY=0;function touchstart(e){if(clearLongPressTimer(),1!==e.touches.length)return;const{pageX:t,pageY:n}=e.touches[0];startPageX=t,startPageY=n,longPressTimer=setTimeout(function(){const t=new CustomEvent("longpress",{bubbles:!0,cancelable:!0,target:e.target,currentTarget:e.currentTarget});t.touches=e.touches,t.changedTouches=e.changedTouches,e.target.dispatchEvent(t)},LONGPRESS_TIMEOUT)}function touchmove(e){if(!longPressTimer)return;if(1!==e.touches.length)return clearLongPressTimer();const{pageX:t,pageY:n}=e.touches[0];return Math.abs(t-startPageX)>LONGPRESS_THRESHOLD||Math.abs(n-startPageY)>LONGPRESS_THRESHOLD?clearLongPressTimer():void 0}function initLongPress(){window.addEventListener("touchstart",touchstart,passiveOptions$3),window.addEventListener("touchmove",touchmove,passiveOptions$3),window.addEventListener("touchend",clearLongPressTimer,passiveOptions$3),window.addEventListener("touchcancel",clearLongPressTimer,passiveOptions$3)}function checkValue$1(e,t){const n=Number(e);return isNaN(n)?t:n}function getWindowWidth$1(){const e=/^Apple/.test(navigator.vendor)&&"number"==typeof window.orientation,t=e&&90===Math.abs(window.orientation);var n=e?Math[t?"max":"min"](screen.width,screen.height):screen.width;return Math.min(window.innerWidth,document.documentElement.clientWidth,n)||n}function useRem(){const e=__uniConfig.globalStyle||{},t=checkValue$1(e.rpxCalcMaxDeviceWidth,960),n=checkValue$1(e.rpxCalcBaseDeviceWidth,375);function r(){let e=getWindowWidth$1();e=e<=t?e:n,document.documentElement.style.fontSize=e/23.4375+"px"}r(),document.addEventListener("DOMContentLoaded",r),window.addEventListener("load",r),window.addEventListener("resize",r)}function getDefaultExportFromCjs$1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var attrs=["top","left","right","bottom"],inited$1,elementComputedStyle={},support;function getSupport(){return support="CSS"in window&&"function"==typeof CSS.supports?CSS.supports("top: env(safe-area-inset-top)")?"env":CSS.supports("top: constant(safe-area-inset-top)")?"constant":"":""}function init(){if(support="string"==typeof support?support:getSupport()){var e=[],t=!1;try{var n=Object.defineProperty({},"passive",{get:function(){t={passive:!0}}});window.addEventListener("test",null,n)}catch(s){}var r=document.createElement("div");i(r,{position:"absolute",left:"0",top:"0",width:"0",height:"0",zIndex:"-1",overflow:"hidden",visibility:"hidden"}),attrs.forEach(function(e){!function(e,n){var r=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),l={position:"absolute",width:"100px",height:"200px",boxSizing:"border-box",overflow:"hidden",paddingBottom:support+"(safe-area-inset-"+n+")"};i(r,l),i(s,l),i(a,{transition:"0s",animation:"none",width:"400px",height:"400px"}),i(c,{transition:"0s",animation:"none",width:"250%",height:"250%"}),r.appendChild(a),s.appendChild(c),e.appendChild(r),e.appendChild(s),o(function(){r.scrollTop=s.scrollTop=1e4;var e=r.scrollTop,i=s.scrollTop;function o(){this.scrollTop!==(this===r?e:i)&&(r.scrollTop=s.scrollTop=1e4,e=r.scrollTop,i=s.scrollTop,attrChange(n))}r.addEventListener("scroll",o,t),s.addEventListener("scroll",o,t)});var d=getComputedStyle(r);Object.defineProperty(elementComputedStyle,n,{configurable:!0,get:function(){return parseFloat(d.paddingBottom)}})}(r,e)}),document.body.appendChild(r),o(),inited$1=!0}else attrs.forEach(function(e){elementComputedStyle[e]=0});function i(e,t){var n=e.style;Object.keys(t).forEach(function(e){var r=t[e];n[e]=r})}function o(t){t?e.push(t):e.forEach(function(e){e()})}}function getAttr(e){return inited$1||init(),elementComputedStyle[e]}var changeAttrs=[];function attrChange(e){changeAttrs.length||setTimeout(function(){var e={};changeAttrs.forEach(function(t){e[t]=elementComputedStyle[t]}),changeAttrs.length=0,callbacks.forEach(function(t){t(e)})},0),changeAttrs.push(e)}var callbacks=[];function onChange(e){getSupport()&&(inited$1||init(),"function"==typeof e&&callbacks.push(e))}function offChange(e){var t=callbacks.indexOf(e);t>=0&&callbacks.splice(t,1)}var safeAreaInsets={get support(){return 0!=("string"==typeof support?support:getSupport()).length},get top(){return getAttr("top")},get left(){return getAttr("left")},get right(){return getAttr("right")},get bottom(){return getAttr("bottom")},onChange:onChange,offChange:offChange},out=safeAreaInsets;const safeAreaInsets$1=getDefaultExportFromCjs$1(out),onEventPrevent=withModifiers(()=>{},["prevent"]),onEventStop=withModifiers(e=>{},["stop"]);function getWindowOffsetCssVar(e,t){return parseInt((e.getPropertyValue(t).match(/\d+/)||["0"])[0])}function getWindowTop(){const e=getWindowOffsetCssVar(document.documentElement.style,"--window-top");return e?e+safeAreaInsets$1.top:0}function getWindowOffset(){const e=document.documentElement.style,t=getWindowTop(),n=getWindowOffsetCssVar(e,"--window-bottom"),r=getWindowOffsetCssVar(e,"--window-left"),i=getWindowOffsetCssVar(e,"--window-right"),o=getWindowOffsetCssVar(e,"--top-window-height");return{top:t,bottom:n?n+safeAreaInsets$1.bottom:0,left:r?r+safeAreaInsets$1.left:0,right:i?i+safeAreaInsets$1.right:0,topWindowHeight:o||0}}function updateCssVar(e){const t=document.documentElement.style;Object.keys(e).forEach(n=>{t.setProperty(n,e[n])})}function updatePageCssVar(e){return updateCssVar(e)}function PolySymbol(e){return Symbol(e)}function hasRpx(e){return-1!==(e+="").indexOf("rpx")||-1!==e.indexOf("upx")}function rpx2px(e,t=!1){if(t)return rpx2pxWithReplace(e);if(isString$1(e)){const t=parseInt(e)||0;return hasRpx(e)?uni.upx2px(t):t}return e}function rpx2pxWithReplace(e){return hasRpx(e)?e.replace(/(\d+(\.\d+)?)[ru]px/g,(e,t)=>uni.upx2px(parseFloat(t))+"px"):e}function get$pageByPage(e){return e.$page}function isBuiltInElement(e){return 0===e.tagName.indexOf("UNI-")}const ICON_PATH_CANCEL="M20.928 10.176l-4.928 4.928-4.928-4.928-0.896 0.896 4.928 4.928-4.928 4.928 0.896 0.896 4.928-4.928 4.928 4.928 0.896-0.896-4.928-4.928 4.928-4.928-0.896-0.896zM16 2.080q-3.776 0-7.040 1.888-3.136 1.856-4.992 4.992-1.888 3.264-1.888 7.040t1.888 7.040q1.856 3.136 4.992 4.992 3.264 1.888 7.040 1.888t7.040-1.888q3.136-1.856 4.992-4.992 1.888-3.264 1.888-7.040t-1.888-7.040q-1.856-3.136-4.992-4.992-3.264-1.888-7.040-1.888zM16 28.64q-3.424 0-6.4-1.728-2.848-1.664-4.512-4.512-1.728-2.976-1.728-6.4t1.728-6.4q1.664-2.848 4.512-4.512 2.976-1.728 6.4-1.728t6.4 1.728q2.848 1.664 4.512 4.512 1.728 2.976 1.728 6.4t-1.728 6.4q-1.664 2.848-4.512 4.512-2.976 1.728-6.4 1.728z",ICON_PATH_CLEAR="M16 0q-4.352 0-8.064 2.176-3.616 2.144-5.76 5.76-2.176 3.712-2.176 8.064t2.176 8.064q2.144 3.616 5.76 5.76 3.712 2.176 8.064 2.176t8.064-2.176q3.616-2.144 5.76-5.76 2.176-3.712 2.176-8.064t-2.176-8.064q-2.144-3.616-5.76-5.76-3.712-2.176-8.064-2.176zM22.688 21.408q0.32 0.32 0.304 0.752t-0.336 0.736-0.752 0.304-0.752-0.32l-5.184-5.376-5.376 5.184q-0.32 0.32-0.752 0.304t-0.736-0.336-0.304-0.752 0.32-0.752l5.376-5.184-5.184-5.376q-0.32-0.32-0.304-0.752t0.336-0.752 0.752-0.304 0.752 0.336l5.184 5.376 5.376-5.184q0.32-0.32 0.752-0.304t0.752 0.336 0.304 0.752-0.336 0.752l-5.376 5.184 5.184 5.376z",ICON_PATH_DOWNLOAD="M15.808 1.696q-3.776 0-7.072 1.984-3.2 1.888-5.088 5.152-1.952 3.392-1.952 7.36 0 3.776 1.952 7.072 1.888 3.2 5.088 5.088 3.296 1.952 7.072 1.952 3.968 0 7.36-1.952 3.264-1.888 5.152-5.088 1.984-3.296 1.984-7.072 0-4-1.984-7.36-1.888-3.264-5.152-5.152-3.36-1.984-7.36-1.984zM20.864 18.592l-3.776 4.928q-0.448 0.576-1.088 0.576t-1.088-0.576l-3.776-4.928q-0.448-0.576-0.24-0.992t0.944-0.416h2.976v-8.928q0-0.256 0.176-0.432t0.4-0.176h1.216q0.224 0 0.4 0.176t0.176 0.432v8.928h2.976q0.736 0 0.944 0.416t-0.24 0.992z",ICON_PATH_INFO="M15.808 0.128q-4.224 0-7.872 2.176-3.552 2.112-5.632 5.728-2.176 3.776-2.176 8.16 0 4.224 2.176 7.872 2.080 3.552 5.632 5.632 3.648 2.176 7.872 2.176 4.384 0 8.16-2.176 3.616-2.080 5.728-5.632 2.176-3.648 2.176-7.872 0-4.416-2.176-8.16-2.112-3.616-5.728-5.728-3.744-2.176-8.16-2.176zM16.864 23.776q0 0.064-0.064 0.064h-1.568q-0.096 0-0.096-0.064l-0.256-11.328q0-0.064 0.064-0.064h2.112q0.096 0 0.064 0.064l-0.256 11.328zM16 10.88q-0.576 0-0.976-0.4t-0.4-0.96 0.4-0.96 0.976-0.4 0.976 0.4 0.4 0.96-0.4 0.96-0.976 0.4z",ICON_PATH_SEARCH="M20.928 22.688q-1.696 1.376-3.744 2.112-2.112 0.768-4.384 0.768-3.488 0-6.464-1.728-2.88-1.696-4.576-4.608-1.76-2.976-1.76-6.464t1.76-6.464q1.696-2.88 4.576-4.576 2.976-1.76 6.464-1.76t6.464 1.76q2.912 1.696 4.608 4.576 1.728 2.976 1.728 6.464 0 2.272-0.768 4.384-0.736 2.048-2.112 3.744l9.312 9.28-1.824 1.824-9.28-9.312zM12.8 23.008q2.784 0 5.184-1.376 2.304-1.376 3.68-3.68 1.376-2.4 1.376-5.184t-1.376-5.152q-1.376-2.336-3.68-3.68-2.4-1.408-5.184-1.408t-5.152 1.408q-2.336 1.344-3.68 3.68-1.408 2.368-1.408 5.152t1.408 5.184q1.344 2.304 3.68 3.68 2.368 1.376 5.152 1.376zM12.8 23.008v0z",ICON_PATH_SUCCESS_NO_CIRCLE="M1.952 18.080q-0.32-0.352-0.416-0.88t0.128-0.976l0.16-0.352q0.224-0.416 0.64-0.528t0.8 0.176l6.496 4.704q0.384 0.288 0.912 0.272t0.88-0.336l17.312-14.272q0.352-0.288 0.848-0.256t0.848 0.352l-0.416-0.416q0.32 0.352 0.32 0.816t-0.32 0.816l-18.656 18.912q-0.32 0.352-0.8 0.352t-0.8-0.32l-7.936-8.064z",ICON_PATH_SUCCESS="M15.808 0.16q-4.224 0-7.872 2.176-3.552 2.112-5.632 5.728-2.144 3.744-2.144 8.128 0 4.192 2.144 7.872 2.112 3.52 5.632 5.632 3.68 2.144 7.872 2.144 4.384 0 8.128-2.144 3.616-2.080 5.728-5.632 2.176-3.648 2.176-7.872 0-4.384-2.176-8.128-2.112-3.616-5.728-5.728-3.744-2.176-8.128-2.176zM24.832 11.328l-11.264 11.104q-0.032 0.032-0.112 0.032t-0.112-0.032l-5.216-5.376q-0.096-0.128 0-0.288l0.704-0.96q0.032-0.064 0.112-0.064t0.112 0.032l4.256 3.264q0.064 0.032 0.144 0.032t0.112-0.032l10.336-8.608q0.064-0.064 0.144-0.064t0.112 0.064l0.672 0.672q0.128 0.128 0 0.224z",ICON_PATH_WAITING="M15.84 0.096q-4.224 0-7.872 2.176-3.552 2.112-5.632 5.728-2.144 3.744-2.144 8.128 0 4.192 2.144 7.872 2.112 3.52 5.632 5.632 3.68 2.144 7.872 2.144 4.384 0 8.128-2.144 3.616-2.080 5.728-5.632 2.176-3.648 2.176-7.872 0-4.384-2.176-8.128-2.112-3.616-5.728-5.728-3.744-2.176-8.128-2.176zM23.008 21.92l-0.512 0.896q-0.096 0.128-0.224 0.064l-8-3.808q-0.096-0.064-0.16-0.128-0.128-0.096-0.128-0.288l0.512-12.096q0-0.064 0.048-0.112t0.112-0.048h1.376q0.064 0 0.112 0.048t0.048 0.112l0.448 10.848 6.304 4.256q0.064 0.064 0.080 0.128t-0.016 0.128z",ICON_PATH_WARN="M15.808 0.16q-4.224 0-7.872 2.176-3.552 2.112-5.632 5.728-2.144 3.744-2.144 8.128 0 4.192 2.144 7.872 2.112 3.52 5.632 5.632 3.68 2.144 7.872 2.144 4.384 0 8.128-2.144 3.616-2.080 5.728-5.632 2.176-3.648 2.176-7.872 0-4.384-2.176-8.128-2.112-3.616-5.728-5.728-3.744-2.176-8.128-2.176zM15.136 8.672h1.728q0.128 0 0.224 0.096t0.096 0.256l-0.384 10.24q0 0.064-0.048 0.112t-0.112 0.048h-1.248q-0.096 0-0.144-0.048t-0.048-0.112l-0.384-10.24q0-0.16 0.096-0.256t0.224-0.096zM16 23.328q-0.48 0-0.832-0.352t-0.352-0.848 0.352-0.848 0.832-0.352 0.832 0.352 0.352 0.848-0.352 0.848-0.832 0.352z",ICON_PATH_BACK="M21.781 7.844l-9.063 8.594 9.063 8.594q0.25 0.25 0.25 0.609t-0.25 0.578q-0.25 0.25-0.578 0.25t-0.578-0.25l-9.625-9.125q-0.156-0.125-0.203-0.297t-0.047-0.359q0-0.156 0.047-0.328t0.203-0.297l9.625-9.125q0.25-0.25 0.578-0.25t0.578 0.25q0.25 0.219 0.25 0.578t-0.25 0.578z",ICON_PATH_CLOSE="M17.25 16.156l7.375-7.313q0.281-0.281 0.281-0.641t-0.281-0.641q-0.25-0.25-0.625-0.25t-0.625 0.25l-7.375 7.344-7.313-7.344q-0.25-0.25-0.625-0.25t-0.625 0.25q-0.281 0.25-0.281 0.625t0.281 0.625l7.313 7.344-7.375 7.344q-0.281 0.25-0.281 0.625t0.281 0.625q0.125 0.125 0.281 0.188t0.344 0.063q0.156 0 0.328-0.063t0.297-0.188l7.375-7.344 7.375 7.406q0.125 0.156 0.297 0.219t0.328 0.063q0.188 0 0.344-0.078t0.281-0.203q0.281-0.25 0.281-0.609t-0.281-0.641l-7.375-7.406z",ICON_PATH_CONFIRM="M31.562 4.9966666659375q0.435 0.399 0.435 0.87 0.036 0.58-0.399 0.98l-18.61 19.917q-0.145 0.145-0.327 0.217-0.073 0.037-0.145 0.11-0.254 0.035-0.472 0.035-0.29 0-0.544-0.036l-0.145-0.072q-0.109-0.073-0.217-0.182l-0.11-0.072L0.363 16.2786666659375q-0.327-0.399-0.363-0.907 0-0.544 0.363-1.016 0.435-0.326 0.961-0.362 0.527-0.036 0.962 0.362l9.722 9.542L29.712 5.0326666659375q0.399-0.363 0.943-0.363 0.544-0.036 0.907 0.327z";function createSvgIconVNode(e,t="#000",n=27){return createVNode("svg",{width:n,height:n,viewBox:"0 0 32 32"},[createVNode("path",{d:e,fill:t},null,8,["d","fill"])],8,["width","height"])}function useCurrentPageId(){{const{$pageInstance:e}=getCurrentInstance();return e&&getPageProxyId(e.proxy)}}function getPageIdByVm(e){const t=resolveComponentInstance(e);if(t.$page)return getPageProxyId(t);if(!t.$)return;{const{$pageInstance:e}=t.$;if(e)return getPageProxyId(e.proxy)}const n=t.$.root.proxy;return n&&n.$page?getPageProxyId(n):void 0}function getCurrentPage(){const e=getCurrentPages$1(),t=e.length;if(t)return e[t-1]}function getCurrentPageMeta(){var e;const t=null==(e=getCurrentPage())?void 0:e.$page;if(t)return t.meta}function getCurrentPageId(){const e=getCurrentPageMeta();return e?e.id:-1}function getCurrentPageVm(){const e=getCurrentPage();if(e)return e.$vm}const PAGE_META_KEYS=["navigationBar","pullToRefresh"];function initGlobalStyle(){return JSON.parse(JSON.stringify(__uniConfig.globalStyle||{}))}function initRouteMeta(e,t){const n=initGlobalStyle(),r=extend$2({id:t},n,e);PAGE_META_KEYS.forEach(t=>{r[t]=extend$2({},n[t],e[t])});const{navigationBar:i}=r;return i.titleText&&i.titleImage&&(i.titleText=""),r}function initPageInternalInstance(e,t,n,r,i,o){const{id:s,route:a}=r,c=normalizeStyles(r.navigationBar,__uniConfig.themeConfig,o).titleColor;return{id:s,path:addLeadingSlash(a),route:a,fullPath:t,options:n,meta:r,openType:e,eventChannel:i,statusBarStyle:"#ffffff"===c?"light":"dark"}}function getPageProxyId(e){var t,n;return(null==(t=e.$page)?void 0:t.id)||(null==(n=e.$basePage)?void 0:n.id)}function removeHook(e,t,n){const r=e.$[t];isArray$3(r)&&n.__weh&&remove(r,n.__weh)}function invokeHook(e,t,n){if(isString$1(e))n=t,t=e,e=getCurrentPageVm();else if("number"==typeof e){const t=getCurrentPages$1().find(t=>get$pageByPage(t).id===e);e=t?t.$vm:getCurrentPageVm()}if(!e)return;const r=e.$[t];return r&&invokeArrayFns(r,n)}function disableScrollListener(e){e.preventDefault()}let testReachBottomTimer,lastScrollHeight=0;function createScrollListener({onPageScroll:e,onReachBottom:t,onReachBottomDistance:n}){let r=!1,i=!1,o=!0;const s=()=>{function s(){if((()=>{const{scrollHeight:e}=document.documentElement,t=window.innerHeight,r=window.scrollY,o=r>0&&e>t&&r+t+n>=e,s=Math.abs(e-lastScrollHeight)>n;return!o||i&&!s?(!o&&i&&(i=!1),!1):(lastScrollHeight=e,i=!0,!0)})())return t&&t(),o=!1,setTimeout(function(){o=!0},350),!0}e&&e(window.pageYOffset),t&&o&&(s()||(testReachBottomTimer=setTimeout(s,300))),r=!1};return function(){clearTimeout(testReachBottomTimer),r||requestAnimationFrame(s),r=!0}}function normalizeRoute(e){if(0===e.indexOf("/")||0===e.indexOf("uni:"))return e;let t="";const n=getCurrentPages$1();return n.length&&(t=get$pageByPage(n[n.length-1]).route),getRealRoute(t,e)}function getRealRoute(e,t){if(0===t.indexOf("/"))return t;if(0===t.indexOf("./"))return getRealRoute(e,t.slice(2));const n=t.split("/"),r=n.length;let i=0;for(;i<r&&".."===n[i];i++);n.splice(0,i),t=n.join("/");const o=e.length>0?e.split("/"):[];return o.splice(o.length-i-1,i+1),addLeadingSlash(o.concat(n).join("/"))}function getRouteOptions(e,t=!1){return t?__uniRoutes.find(t=>t.path===e||t.alias===e):__uniRoutes.find(t=>t.path===e)}function normalizeTabBarRoute(e,t,n){const r=getRouteOptions(addLeadingSlash(t));if(r){const{meta:e}=r;delete e.tabBarIndex,e.isQuit=e.isTabBar=!1}const i=getRouteOptions(addLeadingSlash(n));if(i){const{meta:t}=i;t.tabBarIndex=e,t.isQuit=t.isTabBar=!0;const r=__uniConfig.tabBar;r&&r.list&&r.list[e]&&(r.list[e].pagePath=removeLeadingSlash(n))}}function initView(){useRem(),initCustomDatasetOnce(isBuiltInElement),initLongPress()}class ComponentDescriptor{constructor(e){this.$bindClass=!1,this.$bindStyle=!1,this.$vm=e,this.$el=resolveOwnerEl(e.$),this.$el.getAttribute&&(this.$bindClass=!!this.$el.getAttribute("class"),this.$bindStyle=!!this.$el.getAttribute("style"))}selectComponent(e){if(!this.$el||!e)return;const t=getWxsVm(this.$el.querySelector(e));return t?createComponentDescriptor(t,!1):void 0}selectAllComponents(e){if(!this.$el||!e)return[];const t=[],n=this.$el.querySelectorAll(e);for(let r=0;r<n.length;r++){const e=getWxsVm(n[r]);e&&t.push(createComponentDescriptor(e,!1))}return t}forceUpdate(e){"class"===e?this.$bindClass?(this.$el.__wxsClassChanged=!0,this.$vm.$forceUpdate()):this.updateWxsClass():"style"===e&&(this.$bindStyle?(this.$el.__wxsStyleChanged=!0,this.$vm.$forceUpdate()):this.updateWxsStyle())}updateWxsClass(){const{__wxsAddClass:e}=this.$el;e.length&&(this.$el.className=e.join(" "))}updateWxsStyle(){const{__wxsStyle:e}=this.$el;e&&this.$el.setAttribute("style",stringifyStyle(e))}setStyle(e){return this.$el&&e?(isString$1(e)&&(e=parseStringStyle(e)),isPlainObject$3(e)&&(this.$el.__wxsStyle=e,this.forceUpdate("style")),this):this}addClass(e){if(!this.$el||!e)return this;const t=this.$el.__wxsAddClass||(this.$el.__wxsAddClass=[]);return-1===t.indexOf(e)&&(t.push(e),this.forceUpdate("class")),this}removeClass(e){if(!this.$el||!e)return this;const{__wxsAddClass:t}=this.$el;if(t){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const n=this.$el.__wxsRemoveClass||(this.$el.__wxsRemoveClass=[]);return-1===n.indexOf(e)&&(n.push(e),this.forceUpdate("class")),this}hasClass(e){return this.$el&&this.$el.classList.contains(e)}getDataset(){return this.$el&&this.$el.dataset}callMethod(e,t={}){const n=this.$vm[e];isFunction$2(n)?n(JSON.parse(JSON.stringify(t))):this.$vm.ownerId&&UniViewJSBridge$1.publishHandler(ON_WXS_INVOKE_CALL_METHOD,{nodeId:this.$el.__id,ownerId:this.$vm.ownerId,method:e,args:t})}requestAnimationFrame(e){return window.requestAnimationFrame(e)}getState(){return this.$el&&(this.$el.__wxsState||(this.$el.__wxsState={}))}triggerEvent(e,t={}){return this.$vm.$emit(e,t),this}getComputedStyle(e){if(this.$el){const t=window.getComputedStyle(this.$el);return e&&e.length?e.reduce((e,n)=>(e[n]=t[n],e),{}):t}return{}}setTimeout(e,t){return window.setTimeout(e,t)}clearTimeout(e){return window.clearTimeout(e)}getBoundingClientRect(){return this.$el.getBoundingClientRect()}}function createComponentDescriptor(e,t=!0){if(t&&e&&(e=resolveOwnerVm(e.$)),e&&e.$el)return e.$el.__wxsComponentDescriptor||(e.$el.__wxsComponentDescriptor=new ComponentDescriptor(e)),e.$el.__wxsComponentDescriptor}function getComponentDescriptor(e,t){return createComponentDescriptor(e,t)}function resolveOwnerComponentPublicInstance(e,t,n=!0){if(!t)return!1;if(n&&e.length<2)return!1;const r=resolveOwnerVm(t);if(!r)return!1;const i=r.$.type;return!(!i.$wxs&&!i.$renderjs)&&r}function wrapperH5WxsEvent(e,t,n,r=!0){if(t){e.__instance||(e.__instance=!0,Object.defineProperty(e,"instance",{get:()=>getComponentDescriptor(n.proxy,!1)}));const i=resolveOwnerComponentPublicInstance(t,n,r);if(i)return[e,getComponentDescriptor(i,!1)]}}function getWxsVm(e){if(e)return e.__vueParentComponent&&e.__vueParentComponent.proxy}const isKeyboardEvent=e=>!e.type.indexOf("key")&&e instanceof KeyboardEvent,isClickEvent=e=>"click"===e.type,isMouseEvent=e=>0===e.type.indexOf("mouse")||["contextmenu"].includes(e.type),isTouchEvent=e=>"undefined"!=typeof TouchEvent&&e instanceof TouchEvent||0===e.type.indexOf("touch")||["longpress"].indexOf(e.type)>=0;function $nne(e,t,n){const{currentTarget:r}=e;if(!(e instanceof Event&&r instanceof HTMLElement))return[e];const i=!isBuiltInElement(r);if(i)return wrapperH5WxsEvent(e,t,n,!1)||[e];const o=createNativeEvent(e,i);if(isClickEvent(e))normalizeClickEvent(o,e);else if(isMouseEvent(e))normalizeMouseEvent(o,e);else if(isTouchEvent(e)){const t=getWindowTop();o.touches=normalizeTouchEvent(e.touches,t),o.changedTouches=normalizeTouchEvent(e.changedTouches,t)}else if(isKeyboardEvent(e)){["key","code"].forEach(t=>{Object.defineProperty(o,t,{get:()=>e[t]})})}return wrapperH5WxsEvent(o,t,n)||[o]}function findUniTarget(e){for(;!isBuiltInElement(e);)e=e.parentElement;return e}function createNativeEvent(e,t=!1){const{type:n,timeStamp:r,target:i,currentTarget:o}=e;let s,a;s=normalizeTarget(t?i:findUniTarget(i)),a=normalizeTarget(o);const c={type:n,timeStamp:r,target:s,detail:{},currentTarget:a};return e instanceof CustomEvent&&isPlainObject$3(e.detail)&&(c.detail=e.detail),e._stopped&&(c._stopped=!0),e.type.startsWith("touch")&&(c.touches=e.touches,c.changedTouches=e.changedTouches),wrapperEvent(c,e),c}function wrapperEvent(e,t){extend$2(e,{preventDefault:()=>t.preventDefault(),stopPropagation:()=>t.stopPropagation()})}function normalizeClickEvent(e,t){const{x:n,y:r}=t,i=getWindowTop();e.detail={x:n,y:r-i},e.touches=e.changedTouches=[createTouchEvent(t,i)]}function normalizeMouseEvent(e,t){const n=getWindowTop();e.pageX=t.pageX,e.pageY=t.pageY-n,e.clientX=t.clientX,e.clientY=t.clientY-n,e.touches=e.changedTouches=[createTouchEvent(t,n)]}function createTouchEvent(e,t){return{force:1,identifier:0,clientX:e.clientX,clientY:e.clientY-t,pageX:e.pageX,pageY:e.pageY-t}}function normalizeTouchEvent(e,t){const n=[];for(let r=0;r<e.length;r++){const{identifier:i,pageX:o,pageY:s,clientX:a,clientY:c,force:l}=e[r];n.push({identifier:i,pageX:o,pageY:s-t,clientX:a,clientY:c-t,force:l||0})}return n}const instance=Object.defineProperty({__proto__:null,$nne:$nne,createNativeEvent:createNativeEvent},Symbol.toStringTag,{value:"Module"});function initAppConfig$1(e){const t=e.globalProperties;extend$2(t,instance),t.$gcd=getComponentDescriptor}function initViewPlugin(e){initAppConfig$1(e._context.config)}const invokeOnCallback=(e,t)=>UniServiceJSBridge$1.emit("api."+e,t);let invokeViewMethodId=1;function publishViewMethodName(e){return(e||getCurrentPageId())+"."+INVOKE_VIEW_API}const invokeViewMethod=(e,t,n,r)=>{const{subscribe:i,publishHandler:o}=UniServiceJSBridge$1,s=r?invokeViewMethodId++:0;r&&i(INVOKE_VIEW_API+"."+s,r,!0),o(publishViewMethodName(n),{id:s,name:e,args:t},n)},invokeViewMethodKeepAlive=(e,t,n,r)=>{const{subscribe:i,unsubscribe:o,publishHandler:s}=UniServiceJSBridge$1,a=invokeViewMethodId++,c=INVOKE_VIEW_API+"."+a;return i(c,n),s(publishViewMethodName(r),{id:a,name:e,args:t},r),()=>{o(c)}},ServiceJSBridge=extend$2(initBridge("view"),{invokeOnCallback:invokeOnCallback,invokeViewMethod:invokeViewMethod,invokeViewMethodKeepAlive:invokeViewMethodKeepAlive});function initOn(){const{on:e}=UniServiceJSBridge$1;e(ON_RESIZE,onResize$1),e(ON_APP_ENTER_FOREGROUND,onAppEnterForeground),e(ON_APP_ENTER_BACKGROUND,onAppEnterBackground)}function onResize$1(e){invokeHook(getCurrentPage(),ON_RESIZE,e),UniServiceJSBridge$1.invokeOnCallback("onWindowResize",e)}function onAppEnterForeground(e){const t=getCurrentPage();invokeHook(getApp$1(),ON_SHOW,e),invokeHook(t,ON_SHOW)}function onAppEnterBackground(){invokeHook(getApp$1(),ON_HIDE),invokeHook(getCurrentPage(),ON_HIDE)}const SUBSCRIBE_LIFECYCLE_HOOKS=[ON_PAGE_SCROLL,ON_REACH_BOTTOM];function initSubscribe(){SUBSCRIBE_LIFECYCLE_HOOKS.forEach(e=>UniServiceJSBridge$1.subscribe(e,createPageEvent(e)))}function createPageEvent(e){return(t,n)=>{invokeHook(parseInt(n),e,t)}}function initService(){initOn(),initSubscribe()}function initAppVm(e){e.$vm=e,e.$mpType="app";const t=ref(useI18n().getLocale());Object.defineProperty(e,"$locale",{get:()=>t.value,set(e){t.value=e}})}function initPageVm(e,t){e.route=t.route,e.$vm=e,e.$page=t,e.$mpType="page",e.$fontFamilySet=new Set,t.meta.isTabBar&&(e.$.__isTabBar=!0,e.$.__isActive=!0)}function getOpenerEventChannel(){if(this.$route){const e=this.$route.meta;return e.eventChannel||(e.eventChannel=new EventChannel(this.$page.id)),e.eventChannel}}function initAppConfig(e){e.globalProperties.getOpenerEventChannel=getOpenerEventChannel}function initServicePlugin(e){initAppConfig(e._context.config)}function createLaunchOptions(){return{path:"",query:{},scene:1001,referrerInfo:{appId:"",extraData:{}}}}function defineGlobalData(e,t){const n=e.$options||{};n.globalData=extend$2(n.globalData||{},t),Object.defineProperty(e,"globalData",{get:()=>n.globalData,set(e){n.globalData=e}})}function converPx(e){return/^-?\d+[ur]px$/i.test(e)?e.replace(/(^-?\d+)[ur]px$/i,(e,t)=>`${uni.upx2px(parseFloat(t))}px`):/^-?[\d\.]+$/.test(e)?`${e}px`:e||""}function converType(e){return e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`).replace("webkit","-webkit")}function getStyle(e){const t=["matrix","matrix3d","scale","scale3d","rotate3d","skew","translate","translate3d"],n=["scaleX","scaleY","scaleZ","rotate","rotateX","rotateY","rotateZ","skewX","skewY","translateX","translateY","translateZ"],r=["opacity","background-color"],i=["width","height","left","right","top","bottom"],o=e.animates,s=e.option,a=s.transition,c={},l=[];return o.forEach(e=>{let o=e.type,s=[...e.args];if(t.concat(n).includes(o))o.startsWith("rotate")||o.startsWith("skew")?s=s.map(e=>parseFloat(e)+"deg"):o.startsWith("translate")&&(s=s.map(converPx)),n.indexOf(o)>=0&&(s.length=1),l.push(`${o}(${s.join(",")})`);else if(r.concat(i).includes(s[0])){o=s[0];const e=s[1];c[o]=i.includes(o)?converPx(e):e}}),c.transform=c.webkitTransform=l.join(" "),c.transition=c.webkitTransition=Object.keys(c).map(e=>`${converType(e)} ${a.duration}ms ${a.timingFunction} ${a.delay}ms`).join(","),c.transformOrigin=c.webkitTransformOrigin=s.transformOrigin,c}function startAnimation(e){const t=e.animation;if(!t||!t.actions||!t.actions.length)return;let n=0;const r=t.actions,i=t.actions.length;function o(){const t=r[n],s=t.option.transition,a=getStyle(t);Object.keys(a).forEach(t=>{e.$el.style[t]=a[t]}),n+=1,n<i&&setTimeout(o,s.duration+s.delay)}setTimeout(()=>{o()},0)}const animation={props:["animation"],watch:{animation:{deep:!0,handler(){startAnimation(this)}}},mounted(){startAnimation(this)}},defineBuiltInComponent=e=>{e.__reserved=!0;const{props:t,mixins:n}=e;return t&&t.animation||(n||(e.mixins=[])).push(animation),defineSystemComponent(e)},defineSystemComponent=e=>(e.__reserved=!0,e.compatConfig={MODE:3},defineComponent(e));function withWebEvent(e){return e.__wwe=!0,e}function useCustomEvent(e,t){return(n,r,i)=>{e.value&&t(n,normalizeCustomEvent(n,r,e.value,i||{}))}}function useNativeEvent(e){return(t,n)=>{e(t,createNativeEvent(n))}}function normalizeCustomEvent(e,t,n,r){let i;return i=normalizeTarget(n),{type:t.__evName||r.type||e,timeStamp:t.timeStamp||0,target:i,currentTarget:i,detail:r}}const hoverProps={hoverClass:{type:String,default:"none"},hoverStopPropagation:{type:Boolean,default:!1},hoverStartTime:{type:[Number,String],default:50},hoverStayTime:{type:[Number,String],default:400}};function useHover(e){const t=ref(!1);let n,r,i=!1;function o(){requestAnimationFrame(()=>{clearTimeout(r),r=setTimeout(()=>{t.value=!1},parseInt(e.hoverStayTime))})}function s(r){r._hoverPropagationStopped||e.hoverClass&&"none"!==e.hoverClass&&!e.disabled&&(e.hoverStopPropagation&&(r._hoverPropagationStopped=!0),i=!0,n=setTimeout(()=>{t.value=!0,i||o()},parseInt(e.hoverStartTime)))}function a(){i=!1,t.value&&o()}function c(){a(),window.removeEventListener("mouseup",c)}return{hovering:t,binding:{onTouchstartPassive:withWebEvent(function(e){e.touches.length>1||s(e)}),onMousedown:withWebEvent(function(e){i||(s(e),window.addEventListener("mouseup",c))}),onTouchend:withWebEvent(function(){a()}),onMouseup:withWebEvent(function(){i&&c()}),onTouchcancel:withWebEvent(function(){i=!1,t.value=!1,clearTimeout(n)})}}}function useBooleanAttr(e,t){return isString$1(t)&&(t=[t]),t.reduce((t,n)=>(e[n]&&(t[n]=!0),t),Object.create(null))}const uniFormKey=PolySymbol("uf"),labelProps={for:{type:String,default:""}},uniLabelKey=PolySymbol("ul");function useProvideLabel(){const e=[];return provide(uniLabelKey,{addHandler(t){e.push(t)},removeHandler(t){e.splice(e.indexOf(t),1)}}),e}const index$y=defineBuiltInComponent({name:"Label",props:labelProps,setup(e,{slots:t}){const n=ref(null),r=useCurrentPageId(),i=useProvideLabel(),o=computed$2(()=>e.for||t.default&&t.default.length),s=withWebEvent(t=>{const n=t.target;let o=/^uni-(checkbox|radio|switch)-/.test(n.className);o||(o=/^uni-(checkbox|radio|switch|button)$|^(svg|path)$/i.test(n.tagName)),o||(e.for?UniViewJSBridge$1.emit("uni-label-click-"+r+"-"+e.for,t,!0):i.length&&i[0](t,!0))});return()=>createVNode("uni-label",{ref:n,class:{"uni-label-pointer":o},onClick:s},[t.default&&t.default()],10,["onClick"])}});function useListeners$1(e,t){_addListeners(e.id,t),watch(()=>e.id,(e,n)=>{_removeListeners(n,t,!0),_addListeners(e,t,!0)}),onUnmounted(()=>{_removeListeners(e.id,t)})}function _addListeners(e,t,n){const r=useCurrentPageId();n&&!e||isPlainObject$3(t)&&Object.keys(t).forEach(i=>{n?0!==i.indexOf("@")&&0!==i.indexOf("uni-")&&UniViewJSBridge$1.on(`uni-${i}-${r}-${e}`,t[i]):0===i.indexOf("uni-")?UniViewJSBridge$1.on(i,t[i]):e&&UniViewJSBridge$1.on(`uni-${i}-${r}-${e}`,t[i])})}function _removeListeners(e,t,n){const r=useCurrentPageId();n&&!e||isPlainObject$3(t)&&Object.keys(t).forEach(i=>{n?0!==i.indexOf("@")&&0!==i.indexOf("uni-")&&UniViewJSBridge$1.off(`uni-${i}-${r}-${e}`,t[i]):0===i.indexOf("uni-")?UniViewJSBridge$1.off(i,t[i]):e&&UniViewJSBridge$1.off(`uni-${i}-${r}-${e}`,t[i])})}const buttonProps={id:{type:String,default:""},hoverClass:{type:String,default:"button-hover"},hoverStartTime:{type:[Number,String],default:20},hoverStayTime:{type:[Number,String],default:70},hoverStopPropagation:{type:Boolean,default:!1},disabled:{type:[Boolean,String],default:!1},formType:{type:String,default:""},openType:{type:String,default:""},loading:{type:[Boolean,String],default:!1},plain:{type:[Boolean,String],default:!1}},index$x=defineBuiltInComponent({name:"Button",props:buttonProps,setup(e,{slots:t}){const n=ref(null),r=inject(uniFormKey,!1),{hovering:i,binding:o}=useHover(e),s=withWebEvent((t,i)=>{if(e.disabled)return t.stopImmediatePropagation();i&&n.value.click();const o=e.formType;if(o){if(!r)return;"submit"===o?r.submit(t):"reset"===o&&r.reset(t)}else;}),a=inject(uniLabelKey,!1);return a&&(a.addHandler(s),onBeforeUnmount(()=>{a.removeHandler(s)})),useListeners$1(e,{"label-click":s}),()=>{const r=e.hoverClass,a=useBooleanAttr(e,"disabled"),c=useBooleanAttr(e,"loading"),l=useBooleanAttr(e,"plain"),d=r&&"none"!==r;return createVNode("uni-button",mergeProps({ref:n,onClick:s,id:e.id,class:d&&i.value?r:""},d&&o,a,c,l),[t.default&&t.default()],16,["onClick","id"])}}}),TEMP_PATH="",pageMetaKey=PolySymbol("upm");function usePageMeta(){return inject(pageMetaKey)}function providePageMeta(e){const t=initPageMeta(e);return provide(pageMetaKey,t),t}function usePageRoute(){return useRoute()}function initPageMeta(e){return reactive(normalizePageMeta(JSON.parse(JSON.stringify(initRouteMeta(useRoute().meta,e)))))}function normalizePageMeta(e){{const{navigationBar:t}=e,{titleSize:n,titleColor:r,backgroundColor:i}=t;t.titleText=t.titleText||"",t.type=t.type||"default",t.titleSize=n||"16px",t.titleColor=r||"#000000",t.backgroundColor=i||"#F8F8F8",initNavigationBarI18n(t)}if(history.state){const t=history.state.__type__;"redirectTo"!==t&&"reLaunch"!==t||0!==getCurrentPages$1().length||(e.isEntry=!0,e.isQuit=!0)}return e}function getStateId(){return history.state&&history.state.__id__||1}var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=function(){const e=new Uint8Array(256);for(var t=0;t<chars.length;t++)e[chars.charCodeAt(t)]=t;return e}();function encode$1(e){var t,n=new Uint8Array(e),r=n.length,i="";for(t=0;t<r;t+=3)i+=chars[n[t]>>2],i+=chars[(3&n[t])<<4|n[t+1]>>4],i+=chars[(15&n[t+1])<<2|n[t+2]>>6],i+=chars[63&n[t+2]];return r%3==2?i=i.substring(0,i.length-1)+"=":r%3==1&&(i=i.substring(0,i.length-2)+"=="),i}function decode(e){var t,n,r,i,o,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),d=new Uint8Array(l);for(t=0;t<a;t+=4)n=lookup[e.charCodeAt(t)],r=lookup[e.charCodeAt(t+1)],i=lookup[e.charCodeAt(t+2)],o=lookup[e.charCodeAt(t+3)],d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|i>>2,d[c++]=(3&i)<<6|63&o;return l}const CHOOSE_SIZE_TYPES=["original","compressed"],CHOOSE_SOURCE_TYPES=["album","camera"],HTTP_METHODS=["GET","OPTIONS","HEAD","POST","PUT","DELETE","TRACE","CONNECT","PATCH"];function elemInArray(e,t){return e&&-1!==t.indexOf(e)?e:t[0]}function elemsInArray(e,t){return!isArray$3(e)||0===e.length||e.find(e=>-1===t.indexOf(e))?t:e}function tryCatch(e){return function(){try{return e.apply(e,arguments)}catch(t){console.error(t)}}}let invokeCallbackId=1;const invokeCallbacks={};function addInvokeCallback(e,t,n,r=!1){return invokeCallbacks[e]={name:t,keepAlive:r,callback:n},e}function invokeCallback(e,t,n){if("number"==typeof e){const r=invokeCallbacks[e];if(r)return r.keepAlive||delete invokeCallbacks[e],r.callback(t,n)}return t}function findInvokeCallbackByName(e){for(const t in invokeCallbacks)if(invokeCallbacks[t].name===e)return!0;return!1}function removeKeepAliveApiCallback(e,t){for(const n in invokeCallbacks){const r=invokeCallbacks[n];r.callback===t&&r.name===e&&delete invokeCallbacks[n]}}function offKeepAliveApiCallback(e){UniServiceJSBridge$1.off("api."+e)}function onKeepAliveApiCallback(e){UniServiceJSBridge$1.on("api."+e,t=>{for(const n in invokeCallbacks){const r=invokeCallbacks[n];r.name===e&&r.callback(t)}})}function createKeepAliveApiCallback(e,t){return addInvokeCallback(invokeCallbackId++,e,t,!0)}const API_SUCCESS="success",API_FAIL="fail",API_COMPLETE="complete";function getApiCallbacks(e){const t={};for(const n in e){const r=e[n];isFunction$2(r)&&(t[n]=tryCatch(r),delete e[n])}return t}function normalizeErrMsg(e,t){return e&&-1!==e.indexOf(":fail")?t+e.substring(e.indexOf(":fail")):t+":ok"}function createAsyncApiCallback(e,t={},{beforeAll:n,beforeSuccess:r}={}){isPlainObject$3(t)||(t={});const{success:i,fail:o,complete:s}=getApiCallbacks(t),a=isFunction$2(i),c=isFunction$2(o),l=isFunction$2(s),d=invokeCallbackId++;return addInvokeCallback(d,e,d=>{(d=d||{}).errMsg=normalizeErrMsg(d.errMsg,e),isFunction$2(n)&&n(d),d.errMsg===e+":ok"?(isFunction$2(r)&&r(d,t),a&&i(d)):c&&o(d),l&&s(d)}),d}const HOOK_SUCCESS="success",HOOK_FAIL="fail",HOOK_COMPLETE="complete",globalInterceptors={},scopedInterceptors={};function wrapperHook(e,t){return function(n){return e(n,t)||n}}function queue(e,t,n){let r=!1;for(let i=0;i<e.length;i++){const o=e[i];if(r)r=Promise.resolve(wrapperHook(o,n));else{const e=o(t,n);if(isPromise(e)&&(r=Promise.resolve(e)),!1===e)return{then(){},catch(){}}}}return r||{then:e=>e(t),catch(){}}}function wrapperOptions(e,t={}){return[HOOK_SUCCESS,HOOK_FAIL,HOOK_COMPLETE].forEach(n=>{const r=e[n];if(!isArray$3(r))return;const i=t[n];t[n]=function(e){queue(r,e,t).then(e=>isFunction$2(i)&&i(e)||e)}}),t}function wrapperReturnValue(e,t){const n=[];isArray$3(globalInterceptors.returnValue)&&n.push(...globalInterceptors.returnValue);const r=scopedInterceptors[e];return r&&isArray$3(r.returnValue)&&n.push(...r.returnValue),n.forEach(e=>{t=e(t)||t}),t}function getApiInterceptorHooks(e){const t=Object.create(null);Object.keys(globalInterceptors).forEach(e=>{"returnValue"!==e&&(t[e]=globalInterceptors[e].slice())});const n=scopedInterceptors[e];return n&&Object.keys(n).forEach(e=>{"returnValue"!==e&&(t[e]=(t[e]||[]).concat(n[e]))}),t}function invokeApi(e,t,n,r){const i=getApiInterceptorHooks(e);if(i&&Object.keys(i).length){if(isArray$3(i.invoke)){return queue(i.invoke,n).then(n=>t(wrapperOptions(getApiInterceptorHooks(e),n),...r))}return t(wrapperOptions(i,n),...r)}return t(n,...r)}function hasCallback(e){return!(!isPlainObject$3(e)||![API_SUCCESS,API_FAIL,API_COMPLETE].find(t=>isFunction$2(e[t])))}function handlePromise(e){return e}function promisify(e,t){return(n={},...r)=>hasCallback(n)?wrapperReturnValue(e,invokeApi(e,t,extend$2({},n),r)):wrapperReturnValue(e,handlePromise(new Promise((i,o)=>{invokeApi(e,t,extend$2({},n,{success:i,fail:o}),r)})))}function formatApiArgs(e,t){const n=e[0];if(!t||!t.formatArgs||!isPlainObject$3(t.formatArgs)&&isPlainObject$3(n))return;const r=t.formatArgs,i=Object.keys(r);for(let o=0;o<i.length;o++){const t=i[o],s=r[t];if(isFunction$2(s)){const r=s(e[0][t],n);if(isString$1(r))return r}else hasOwn$1(n,t)||(n[t]=s)}}function invokeSuccess(e,t,n){return invokeCallback(e,extend$2(n||{},{errMsg:t+":ok"}))}function invokeFail(e,t,n,r={}){const i=t+":fail";let o="";return o=n?0===n.indexOf(i)?n:i+" "+n:i,delete r.errCode,invokeCallback(e,extend$2({errMsg:o},r))}function beforeInvokeApi(e,t,n,r){if(r&&r.beforeInvoke){const e=r.beforeInvoke(t);if(isString$1(e))return e}const i=formatApiArgs(t,r);if(i)return i}function checkCallback(e){if(!isFunction$2(e))throw new Error('Invalid args: type check failed for args "callback". Expected Function')}function wrapperOnApi(e,t,n){return r=>{checkCallback(r);const i=beforeInvokeApi(e,[r],void 0,n);if(i)throw new Error(i);const o=!findInvokeCallbackByName(e);createKeepAliveApiCallback(e,r),o&&(onKeepAliveApiCallback(e),t())}}function wrapperOffApi(e,t,n){return r=>{checkCallback(r);const i=beforeInvokeApi(e,[r],void 0,n);if(i)throw new Error(i);removeKeepAliveApiCallback(e=e.replace("off","on"),r);findInvokeCallbackByName(e)||(offKeepAliveApiCallback(e),t())}}function parseErrMsg(e){return!e||isString$1(e)?e:e.stack?("undefined"!=typeof globalThis&&globalThis.harmonyChannel||console.error(e.message+"\n"+e.stack),e.message):e}function wrapperTaskApi(e,t,n,r){return i=>{const o=createAsyncApiCallback(e,i,r),s=beforeInvokeApi(e,[i],n,r);return s?invokeFail(o,e,s):t(i,{resolve:t=>invokeSuccess(o,e,t),reject:(t,n)=>invokeFail(o,e,parseErrMsg(t),n)})}}function wrapperSyncApi(e,t,n,r){return(...i)=>{const o=beforeInvokeApi(e,i,n,r);if(o)throw new Error(o);return t.apply(null,i)}}function wrapperAsyncApi(e,t,n,r){return wrapperTaskApi(e,t,n,r)}function defineOnApi(e,t,n){return wrapperOnApi(e,t,n)}function defineOffApi(e,t,n){return wrapperOffApi(e,t,n)}function defineTaskApi(e,t,n,r){return promisify(e,wrapperTaskApi(e,t,void 0,r))}function defineSyncApi(e,t,n,r){return wrapperSyncApi(e,t,void 0,r)}function defineAsyncApi(e,t,n,r){return promisify(e,wrapperAsyncApi(e,t,void 0,r))}function createUnsupportedMsg(e){return`method 'uni.${e}' not supported`}function createUnsupportedSyncApi(e){return()=>{console.error(createUnsupportedMsg(e))}}const createUnsupportedOnApi=createUnsupportedSyncApi;function createUnsupportedAsyncApi(e){return(t,{reject:n})=>n(createUnsupportedMsg(e))}const API_BASE64_TO_ARRAY_BUFFER="base64ToArrayBuffer",API_ARRAY_BUFFER_TO_BASE64="arrayBufferToBase64",base64ToArrayBuffer=defineSyncApi(API_BASE64_TO_ARRAY_BUFFER,e=>decode(e)),arrayBufferToBase64=defineSyncApi(API_ARRAY_BUFFER_TO_BASE64,e=>encode$1(e)),API_UPX2PX="upx2px",EPS=1e-4,BASE_DEVICE_WIDTH=750;let isIOS$1=!1,deviceWidth=0,deviceDPR=0,maxWidth=960,baseWidth=375,includeWidth=750;function checkDeviceWidth(){let e,t,n;{const{windowWidth:r,pixelRatio:i,platform:o}=getBaseSystemInfo();e=r,t=i,n=o}deviceWidth=e,deviceDPR=t,isIOS$1="ios"===n}function checkValue(e,t){const n=Number(e);return isNaN(n)?t:n}function checkMaxWidth(){const e=__uniConfig.globalStyle||{};maxWidth=checkValue(e.rpxCalcMaxDeviceWidth,960),baseWidth=checkValue(e.rpxCalcBaseDeviceWidth,375),includeWidth=checkValue(e.rpxCalcBaseDeviceWidth,750)}const upx2px=defineSyncApi(API_UPX2PX,(e,t)=>{if(0===deviceWidth&&(checkDeviceWidth(),checkMaxWidth()),0===(e=Number(e)))return 0;let n=t||deviceWidth;n=e===includeWidth||n<=maxWidth?n:baseWidth;let r=e/BASE_DEVICE_WIDTH*n;return r<0&&(r=-r),r=Math.floor(r+EPS),0===r&&(r=1!==deviceDPR&&isIOS$1?.5:1),e<0?-r:r}),API_ADD_INTERCEPTOR="addInterceptor",API_REMOVE_INTERCEPTOR="removeInterceptor";function mergeInterceptorHook(e,t){Object.keys(t).forEach(n=>{isFunction$2(t[n])&&(e[n]=mergeHook(e[n],t[n]))})}function removeInterceptorHook(e,t){e&&t&&Object.keys(t).forEach(n=>{const r=e[n],i=t[n];isArray$3(r)&&isFunction$2(i)&&remove(r,i)})}function mergeHook(e,t){const n=t?e?e.concat(t):isArray$3(t)?t:[t]:e;return n?dedupeHooks(n):n}function dedupeHooks(e){const t=[];for(let n=0;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}const addInterceptor=defineSyncApi(API_ADD_INTERCEPTOR,(e,t)=>{isString$1(e)&&isPlainObject$3(t)?mergeInterceptorHook(scopedInterceptors[e]||(scopedInterceptors[e]={}),t):isPlainObject$3(e)&&mergeInterceptorHook(globalInterceptors,e)}),removeInterceptor=defineSyncApi(API_REMOVE_INTERCEPTOR,(e,t)=>{isString$1(e)?isPlainObject$3(t)?removeInterceptorHook(scopedInterceptors[e],t):delete scopedInterceptors[e]:isPlainObject$3(e)&&removeInterceptorHook(globalInterceptors,e)}),interceptors={},API_ON="$on",API_ONCE="$once",API_OFF="$off",API_EMIT="$emit";class EventBus{constructor(){this.$emitter=new E$1$1}on(e,t){return this.$emitter.on(e,t)}once(e,t){return this.$emitter.once(e,t)}off(e,t){e?this.$emitter.off(e,t):this.$emitter.e={}}emit(e,...t){this.$emitter.emit(e,...t)}}const eventBus=new EventBus,$on=defineSyncApi(API_ON,(e,t)=>(eventBus.on(e,t),()=>eventBus.off(e,t))),$once=defineSyncApi(API_ONCE,(e,t)=>(eventBus.once(e,t),()=>eventBus.off(e,t))),$off=defineSyncApi(API_OFF,(e,t)=>{isArray$3(e)||(e=e?[e]:[]),e.forEach(e=>{eventBus.off(e,t)})}),$emit=defineSyncApi(API_EMIT,(e,...t)=>{eventBus.emit(e,...t)});function __f__(e,t,...n){t&&n.push(t),console[e].apply(console,n)}const API_CREATE_VIDEO_CONTEXT="createVideoContext",API_CREATE_MAP_CONTEXT="createMapContext",API_CREATE_CANVAS_CONTEXT="createCanvasContext",API_CREATE_INNER_AUDIO_CONTEXT="createInnerAudioContext",RATES=[.5,.8,1,1.25,1.5,2];class VideoContext{constructor(e,t){this.id=e,this.pageId=t}play(){operateVideoPlayer(this.id,this.pageId,"play")}pause(){operateVideoPlayer(this.id,this.pageId,"pause")}stop(){operateVideoPlayer(this.id,this.pageId,"stop")}seek(e){operateVideoPlayer(this.id,this.pageId,"seek",{position:e})}sendDanmu(e){operateVideoPlayer(this.id,this.pageId,"sendDanmu",e)}playbackRate(e){~RATES.indexOf(e)||(e=1),operateVideoPlayer(this.id,this.pageId,"playbackRate",{rate:e})}requestFullScreen(e={}){operateVideoPlayer(this.id,this.pageId,"requestFullScreen",e)}exitFullScreen(){operateVideoPlayer(this.id,this.pageId,"exitFullScreen")}showStatusBar(){operateVideoPlayer(this.id,this.pageId,"showStatusBar")}hideStatusBar(){operateVideoPlayer(this.id,this.pageId,"hideStatusBar")}}const createVideoContext=defineSyncApi(API_CREATE_VIDEO_CONTEXT,(e,t)=>new VideoContext(e,getPageIdByVm(t||getCurrentPageVm()))),operateMapCallback=(e,t)=>{const n=t.errMsg||"";new RegExp("\\:\\s*fail").test(n)?e.fail&&e.fail(t):e.success&&e.success(t),e.complete&&e.complete(t)},operateMapWrap=(e,t,n,r)=>{operateMap(e,t,n,r,e=>{r&&operateMapCallback(r,e)})};class MapContext{constructor(e,t){this.id=e,this.pageId=t}getCenterLocation(e){operateMapWrap(this.id,this.pageId,"getCenterLocation",e)}moveToLocation(e){operateMapWrap(this.id,this.pageId,"moveToLocation",e)}getScale(e){operateMapWrap(this.id,this.pageId,"getScale",e)}getRegion(e){operateMapWrap(this.id,this.pageId,"getRegion",e)}includePoints(e){operateMapWrap(this.id,this.pageId,"includePoints",e)}translateMarker(e){operateMapWrap(this.id,this.pageId,"translateMarker",e)}$getAppMap(){}addCustomLayer(e){operateMapWrap(this.id,this.pageId,"addCustomLayer",e)}removeCustomLayer(e){operateMapWrap(this.id,this.pageId,"removeCustomLayer",e)}addGroundOverlay(e){operateMapWrap(this.id,this.pageId,"addGroundOverlay",e)}removeGroundOverlay(e){operateMapWrap(this.id,this.pageId,"removeGroundOverlay",e)}updateGroundOverlay(e){operateMapWrap(this.id,this.pageId,"updateGroundOverlay",e)}initMarkerCluster(e){operateMapWrap(this.id,this.pageId,"initMarkerCluster",e)}addMarkers(e){operateMapWrap(this.id,this.pageId,"addMarkers",e)}removeMarkers(e){operateMapWrap(this.id,this.pageId,"removeMarkers",e)}moveAlong(e){operateMapWrap(this.id,this.pageId,"moveAlong",e)}setLocMarkerIcon(e){operateMapWrap(this.id,this.pageId,"setLocMarkerIcon",e)}openMapApp(e){operateMapWrap(this.id,this.pageId,"openMapApp",e)}on(e,t){operateMapWrap(this.id,this.pageId,"on",{name:e,callback:t})}}const createMapContext=defineSyncApi(API_CREATE_MAP_CONTEXT,(e,t)=>new MapContext(e,getPageIdByVm(t||getCurrentPageVm())));function getInt(e,t){return function(n,r){n?r[e]=Math.round(n):void 0!==t&&(r[e]=t)}}const formatWidth=getInt("width"),formatHeight=getInt("height"),API_CANVAS_GET_IMAGE_DATA="canvasGetImageData",CanvasGetImageDataOptions={formatArgs:{x:getInt("x"),y:getInt("y"),width:formatWidth,height:formatHeight}},CanvasGetImageDataProtocol={canvasId:{type:String,required:!0},x:{type:Number,required:!0},y:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0}},API_CANVAS_PUT_IMAGE_DATA="canvasPutImageData",CanvasPutImageDataOptions=CanvasGetImageDataOptions,CanvasPutImageDataProtocol=extend$2({data:{type:Uint8ClampedArray,required:!0}},CanvasGetImageDataProtocol,{height:{type:Number}}),fileTypes={PNG:"png",JPG:"jpg",JPEG:"jpg"},API_CANVAS_TO_TEMP_FILE_PATH="canvasToTempFilePath",CanvasToTempFilePathOptions={formatArgs:{x:getInt("x",0),y:getInt("y",0),width:formatWidth,height:formatHeight,destWidth:getInt("destWidth"),destHeight:getInt("destHeight"),fileType(e,t){e=(e||"").toUpperCase();let n=fileTypes[e];n||(n=fileTypes.PNG),t.fileType=n},quality(e,t){t.quality=e&&e>0&&e<1?e:1}}},CanvasToTempFilePathProtocol={x:Number,y:Number,width:Number,height:Number,destWidth:Number,destHeight:Number,canvasId:{type:String,required:!0},fileType:String,quality:Number};function operateCanvas(e,t,n,r,i){UniServiceJSBridge$1.invokeViewMethod(`canvas.${e}`,{type:n,data:r},t,e=>{i&&i(e)})}var methods1=["scale","rotate","translate","setTransform","transform"],methods2=["drawImage","fillText","fill","stroke","fillRect","strokeRect","clearRect","strokeText"],methods3=["setFillStyle","setTextAlign","setStrokeStyle","setGlobalAlpha","setShadow","setFontSize","setLineCap","setLineJoin","setLineWidth","setMiterLimit","setTextBaseline","setLineDash"];function measureText(e,t){const n=document.createElement("canvas").getContext("2d");return n.font=t,n.measureText(e).width||0}const predefinedColor={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"#00000000"};function checkColor(e){let t=null;if(null!=(t=/^#([0-9|A-F|a-f]{6})$/.exec(e=e||"#000000"))){return[parseInt(t[1].slice(0,2),16),parseInt(t[1].slice(2,4),16),parseInt(t[1].slice(4),16),255]}if(null!=(t=/^#([0-9|A-F|a-f]{3})$/.exec(e))){let e=t[1].slice(0,1),n=t[1].slice(1,2),r=t[1].slice(2,3);return e=parseInt(e+e,16),n=parseInt(n+n,16),r=parseInt(r+r,16),[e,n,r,255]}if(null!=(t=/^rgb\((.+)\)$/.exec(e)))return t[1].split(",").map(function(e){return Math.min(255,parseInt(e.trim()))}).concat(255);if(null!=(t=/^rgba\((.+)\)$/.exec(e)))return t[1].split(",").map(function(e,t){return 3===t?Math.floor(255*parseFloat(e.trim())):Math.min(255,parseInt(e.trim()))});var n=e.toLowerCase();if(hasOwn$1(predefinedColor,n)){t=/^#([0-9|A-F|a-f]{6,8})$/.exec(predefinedColor[n]);const e=parseInt(t[1].slice(0,2),16),r=parseInt(t[1].slice(2,4),16),i=parseInt(t[1].slice(4,6),16);let o=parseInt(t[1].slice(6,8),16);return o=o>=0?o:255,[e,r,i,o]}return console.error("unsupported color:"+e),[0,0,0,255]}class CanvasGradient{constructor(e,t){this.type=e,this.data=t,this.colorStop=[]}addColorStop(e,t){this.colorStop.push([e,checkColor(t)])}}class Pattern{constructor(e,t){this.type="pattern",this.data=e,this.colorStop=t}}class TextMetrics{constructor(e){this.width=e}}const getTempPath=()=>TEMP_PATH;class CanvasContext{constructor(e,t){this.id=e,this.pageId=t,this.actions=[],this.path=[],this.subpath=[],this.drawingState=[],this.state={lineDash:[0,0],shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:[0,0,0,0],font:"10px sans-serif",fontSize:10,fontWeight:"normal",fontStyle:"normal",fontFamily:"sans-serif"}}setFillStyle(e){console.log("initCanvasContextProperty implemented.")}setStrokeStyle(e){console.log("initCanvasContextProperty implemented.")}setShadow(e,t,n,r){console.log("initCanvasContextProperty implemented.")}addColorStop(e,t){console.log("initCanvasContextProperty implemented.")}setLineWidth(e){console.log("initCanvasContextProperty implemented.")}setLineCap(e){console.log("initCanvasContextProperty implemented.")}setLineJoin(e){console.log("initCanvasContextProperty implemented.")}setLineDash(e,t){console.log("initCanvasContextProperty implemented.")}setMiterLimit(e){console.log("initCanvasContextProperty implemented.")}fillRect(e,t,n,r){console.log("initCanvasContextProperty implemented.")}strokeRect(e,t,n,r){console.log("initCanvasContextProperty implemented.")}clearRect(e,t,n,r){console.log("initCanvasContextProperty implemented.")}fill(){console.log("initCanvasContextProperty implemented.")}stroke(){console.log("initCanvasContextProperty implemented.")}scale(e,t){console.log("initCanvasContextProperty implemented.")}rotate(e){console.log("initCanvasContextProperty implemented.")}translate(e,t){console.log("initCanvasContextProperty implemented.")}setFontSize(e){console.log("initCanvasContextProperty implemented.")}fillText(e,t,n,r){console.log("initCanvasContextProperty implemented.")}setTextAlign(e){console.log("initCanvasContextProperty implemented.")}setTextBaseline(e){console.log("initCanvasContextProperty implemented.")}drawImage(e,t,n,r,i,o,s,a,c){console.log("initCanvasContextProperty implemented.")}setGlobalAlpha(e){console.log("initCanvasContextProperty implemented.")}strokeText(e,t,n,r){console.log("initCanvasContextProperty implemented.")}setTransform(e,t,n,r,i,o){console.log("initCanvasContextProperty implemented.")}draw(e=!1,t){var n=[...this.actions];this.actions=[],this.path=[],operateCanvas(this.id,this.pageId,"actionsChanged",{actions:n,reserve:e},t)}createLinearGradient(e,t,n,r){return new CanvasGradient("linear",[e,t,n,r])}createCircularGradient(e,t,n){return new CanvasGradient("radial",[e,t,n])}createPattern(e,t){if(void 0===t)console.error("Failed to execute 'createPattern' on 'CanvasContext': 2 arguments required, but only 1 present.");else{if(!(["repeat","repeat-x","repeat-y","no-repeat"].indexOf(t)<0))return new Pattern(e,t);console.error("Failed to execute 'createPattern' on 'CanvasContext': The provided type ('"+t+"') is not one of 'repeat', 'no-repeat', 'repeat-x', or 'repeat-y'.")}}measureText(e,t){let n=0;return n=measureText(e,this.state.font),new TextMetrics(n)}save(){this.actions.push({method:"save",data:[]}),this.drawingState.push(this.state)}restore(){this.actions.push({method:"restore",data:[]}),this.state=this.drawingState.pop()||{lineDash:[0,0],shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:[0,0,0,0],font:"10px sans-serif",fontSize:10,fontWeight:"normal",fontStyle:"normal",fontFamily:"sans-serif"}}beginPath(){this.path=[],this.subpath=[],this.path.push({method:"beginPath",data:[]})}moveTo(e,t){this.path.push({method:"moveTo",data:[e,t]}),this.subpath=[[e,t]]}lineTo(e,t){0===this.path.length&&0===this.subpath.length?this.path.push({method:"moveTo",data:[e,t]}):this.path.push({method:"lineTo",data:[e,t]}),this.subpath.push([e,t])}quadraticCurveTo(e,t,n,r){this.path.push({method:"quadraticCurveTo",data:[e,t,n,r]}),this.subpath.push([n,r])}bezierCurveTo(e,t,n,r,i,o){this.path.push({method:"bezierCurveTo",data:[e,t,n,r,i,o]}),this.subpath.push([i,o])}arc(e,t,n,r,i,o=!1){this.path.push({method:"arc",data:[e,t,n,r,i,o]}),this.subpath.push([e,t])}rect(e,t,n,r){this.path.push({method:"rect",data:[e,t,n,r]}),this.subpath=[[e,t]]}arcTo(e,t,n,r,i){this.path.push({method:"arcTo",data:[e,t,n,r,i]}),this.subpath.push([n,r])}clip(){this.actions.push({method:"clip",data:[...this.path]})}closePath(){this.path.push({method:"closePath",data:[]}),this.subpath.length&&(this.subpath=[this.subpath.shift()])}clearActions(){this.actions=[],this.path=[],this.subpath=[]}getActions(){var e=[...this.actions];return this.clearActions(),e}set lineDashOffset(e){this.actions.push({method:"setLineDashOffset",data:[e]})}set globalCompositeOperation(e){this.actions.push({method:"setGlobalCompositeOperation",data:[e]})}set shadowBlur(e){this.actions.push({method:"setShadowBlur",data:[e]})}set shadowColor(e){this.actions.push({method:"setShadowColor",data:[e]})}set shadowOffsetX(e){this.actions.push({method:"setShadowOffsetX",data:[e]})}set shadowOffsetY(e){this.actions.push({method:"setShadowOffsetY",data:[e]})}set font(e){var t=this;this.state.font=e;var n=e.match(/^(([\w\-]+\s)*)(\d+\.?\d*r?px)(\/(\d+\.?\d*(r?px)?))?\s+(.*)/);if(n){var r=n[1].trim().split(/\s/),i=parseFloat(n[3]),o=n[7],s=[];r.forEach(function(e,n){["italic","oblique","normal"].indexOf(e)>-1?(s.push({method:"setFontStyle",data:[e]}),t.state.fontStyle=e):["bold","normal","lighter","bolder"].indexOf(e)>-1||/^\d+$/.test(e)?(s.push({method:"setFontWeight",data:[e]}),t.state.fontWeight=e):0===n?(s.push({method:"setFontStyle",data:["normal"]}),t.state.fontStyle="normal"):1===n&&a()}),1===r.length&&a(),r=s.map(function(e){return e.data[0]}).join(" "),this.state.fontSize=i,this.state.fontFamily=o,this.actions.push({method:"setFont",data:[`${r} ${i}px ${o}`]})}else console.warn("Failed to set 'font' on 'CanvasContext': invalid format.");function a(){s.push({method:"setFontWeight",data:["normal"]}),t.state.fontWeight="normal"}}get font(){return this.state.font}set fillStyle(e){this.setFillStyle(e)}set strokeStyle(e){this.setStrokeStyle(e)}set globalAlpha(e){e=Math.floor(255*parseFloat(e)),this.actions.push({method:"setGlobalAlpha",data:[e]})}set textAlign(e){this.actions.push({method:"setTextAlign",data:[e]})}set lineCap(e){this.actions.push({method:"setLineCap",data:[e]})}set lineJoin(e){this.actions.push({method:"setLineJoin",data:[e]})}set lineWidth(e){this.actions.push({method:"setLineWidth",data:[e]})}set miterLimit(e){this.actions.push({method:"setMiterLimit",data:[e]})}set textBaseline(e){this.actions.push({method:"setTextBaseline",data:[e]})}}const initCanvasContextProperty=once$1(()=>{[...methods1,...methods2].forEach(function(e){CanvasContext.prototype[e]=function(e){switch(e){case"fill":case"stroke":return function(){this.actions.push({method:e+"Path",data:[...this.path]})};case"fillRect":return function(e,t,n,r){this.actions.push({method:"fillPath",data:[{method:"rect",data:[e,t,n,r]}]})};case"strokeRect":return function(e,t,n,r){this.actions.push({method:"strokePath",data:[{method:"rect",data:[e,t,n,r]}]})};case"fillText":case"strokeText":return function(t,n,r,i){var o=[t.toString(),n,r];"number"==typeof i&&o.push(i),this.actions.push({method:e,data:o})};case"drawImage":return function(t,n,r,i,o,s,a,c,l){var d;function u(e){return"number"==typeof e}void 0===l&&(s=n,a=r,c=i,l=o,n=void 0,r=void 0,i=void 0,o=void 0),d=u(n)&&u(r)&&u(i)&&u(o)?[t,s,a,c,l,n,r,i,o]:u(c)&&u(l)?[t,s,a,c,l]:[t,s,a],this.actions.push({method:e,data:d})};default:return function(...t){this.actions.push({method:e,data:t})}}}(e)}),methods3.forEach(function(e){CanvasContext.prototype[e]=function(e){switch(e){case"setFillStyle":case"setStrokeStyle":return function(t){"object"!=typeof t?this.actions.push({method:e,data:["normal",checkColor(t)]}):this.actions.push({method:e,data:[t.type,t.data,t.colorStop]})};case"setGlobalAlpha":return function(t){t=Math.floor(255*parseFloat(t)),this.actions.push({method:e,data:[t]})};case"setShadow":return function(t,n,r,i){i=checkColor(i),this.actions.push({method:e,data:[t,n,r,i]}),this.state.shadowBlur=r,this.state.shadowColor=i,this.state.shadowOffsetX=t,this.state.shadowOffsetY=n};case"setLineDash":return function(t,n){t=t||[0,0],n=n||0,this.actions.push({method:e,data:[t,n]}),this.state.lineDash=t};case"setFontSize":return function(t){this.state.font=this.state.font.replace(/\d+\.?\d*px/,t+"px"),this.state.fontSize=t,this.actions.push({method:e,data:[t]})};default:return function(...t){this.actions.push({method:e,data:t})}}}(e)})}),createCanvasContext=defineSyncApi(API_CREATE_CANVAS_CONTEXT,(e,t)=>{if(initCanvasContextProperty(),t)return new CanvasContext(e,getPageIdByVm(t));const n=getPageIdByVm(getCurrentPageVm());if(n)return new CanvasContext(e,n);UniServiceJSBridge$1.emit(ON_ERROR,"createCanvasContext:fail")}),canvasGetImageData=defineAsyncApi(API_CANVAS_GET_IMAGE_DATA,({canvasId:e,x:t,y:n,width:r,height:i},{resolve:o,reject:s})=>{const a=getPageIdByVm(getCurrentPageVm());a?operateCanvas(e,a,"getImageData",{x:t,y:n,width:r,height:i},function(e){if(e.errMsg&&-1!==e.errMsg.indexOf("fail"))return void s("",e);let t=e.data;t&&t.length&&(e.data=new Uint8ClampedArray(t)),delete e.compressed,o(e)}):s()},CanvasGetImageDataProtocol,CanvasGetImageDataOptions),canvasPutImageData=defineAsyncApi(API_CANVAS_PUT_IMAGE_DATA,({canvasId:e,data:t,x:n,y:r,width:i,height:o},{resolve:s,reject:a})=>{var c=getPageIdByVm(getCurrentPageVm());if(!c)return void a();t=Array.prototype.slice.call(t),operateCanvas(e,c,"putImageData",{data:t,x:n,y:r,width:i,height:o,compressed:void 0},e=>{e.errMsg&&-1!==e.errMsg.indexOf("fail")?a():s(e)})},CanvasPutImageDataProtocol,CanvasPutImageDataOptions),canvasToTempFilePath=defineAsyncApi(API_CANVAS_TO_TEMP_FILE_PATH,({x:e=0,y:t=0,width:n,height:r,destWidth:i,destHeight:o,canvasId:s,fileType:a,quality:c},{resolve:l,reject:d})=>{var u=getPageIdByVm(getCurrentPageVm());if(!u)return void d();operateCanvas(s,u,"toTempFilePath",{x:e,y:t,width:n,height:r,destWidth:i,destHeight:o,fileType:a,quality:c,dirname:`${getTempPath()}/canvas`},e=>{e.errMsg&&-1!==e.errMsg.indexOf("fail")?d("",e):l(e)})},CanvasToTempFilePathProtocol,CanvasToTempFilePathOptions),innerAudioContextEventNames=["onCanplay","onPlay","onPause","onStop","onEnded","onTimeUpdate","onError","onWaiting","onSeeking","onSeeked"],innerAudioContextOffEventNames=["offCanplay","offPlay","offPause","offStop","offEnded","offTimeUpdate","offError","offWaiting","offSeeking","offSeeked"],defaultOptions={thresholds:[0],initialRatio:0,observeAll:!1},MARGINS=["top","right","bottom","left"];let reqComponentObserverId$1=1;function normalizeRootMargin(e={}){return MARGINS.map(t=>`${Number(e[t])||0}px`).join(" ")}class ServiceIntersectionObserver{constructor(e,t){this._pageId=getPageIdByVm(e),this._component=e,this._options=extend$2({},defaultOptions,t)}relativeTo(e,t){return this._options.relativeToSelector=e,this._options.rootMargin=normalizeRootMargin(t),this}relativeToViewport(e){return this._options.relativeToSelector=void 0,this._options.rootMargin=normalizeRootMargin(e),this}observe(e,t){isFunction$2(t)&&(this._options.selector=e,this._reqId=reqComponentObserverId$1++,addIntersectionObserver({reqId:this._reqId,component:this._component,options:this._options,callback:t},this._pageId))}disconnect(){this._reqId&&removeIntersectionObserver({reqId:this._reqId,component:this._component},this._pageId)}}const createIntersectionObserver=defineSyncApi("createIntersectionObserver",(e,t)=>((e=resolveComponentInstance(e))&&!getPageIdByVm(e)&&(t=e,e=null),new ServiceIntersectionObserver(e||getCurrentPageVm(),t)));let reqComponentObserverId=1;class ServiceMediaQueryObserver{constructor(e){this._pageId=(null==e?void 0:e.$page)&&e.$page.id,this._component=e}observe(e,t){isFunction$2(t)&&(this._reqId=reqComponentObserverId++,addMediaQueryObserver({reqId:this._reqId,component:this._component,options:e,callback:t},this._pageId))}disconnect(){this._reqId&&removeMediaQueryObserver({reqId:this._reqId,component:this._component},this._pageId)}}const createMediaQueryObserver=defineSyncApi("createMediaQueryObserver",e=>((e=resolveComponentInstance(e))&&!getPageIdByVm(e)&&(e=null),new ServiceMediaQueryObserver(e||getCurrentPageVm())));let index$w=0,optionsCache={};function operateEditor(e,t,n,r){const i={options:r},o=r&&("success"in r||"fail"in r||"complete"in r);if(o){const e=String(index$w++);i.callbackId=e,optionsCache[e]=r}UniServiceJSBridge$1.invokeViewMethod(`editor.${e}`,{type:n,data:i},t,({callbackId:e,data:t})=>{o&&(callOptions(optionsCache[e],t),delete optionsCache[e])})}class EditorContext{constructor(e,t){this.id=e,this.pageId=t}format(e,t){this._exec("format",{name:e,value:t})}insertDivider(){this._exec("insertDivider")}insertImage(e){this._exec("insertImage",e)}insertText(e){this._exec("insertText",e)}setContents(e){this._exec("setContents",e)}getContents(e){this._exec("getContents",e)}clear(e){this._exec("clear",e)}removeFormat(e){this._exec("removeFormat",e)}undo(e){this._exec("undo",e)}redo(e){this._exec("redo",e)}blur(e){this._exec("blur",e)}getSelectionText(e){this._exec("getSelectionText",e)}scrollIntoView(e){this._exec("scrollIntoView",e)}_exec(e,t){operateEditor(this.id,this.pageId,e,t)}}const ContextClasss={canvas:CanvasContext,map:MapContext,video:VideoContext,editor:EditorContext};function convertContext(e){if(e&&e.contextInfo){const{id:t,type:n,page:r}=e.contextInfo,i=ContextClasss[n];e.context=new i(t,r),delete e.contextInfo}}class NodesRef{constructor(e,t,n,r){this._selectorQuery=e,this._component=t,this._selector=n,this._single=r}boundingClientRect(e){return this._selectorQuery._push(this._selector,this._component,this._single,{id:!0,dataset:!0,rect:!0,size:!0},e),this._selectorQuery}fields(e,t){return this._selectorQuery._push(this._selector,this._component,this._single,e,t),this._selectorQuery}scrollOffset(e){return this._selectorQuery._push(this._selector,this._component,this._single,{id:!0,dataset:!0,scrollOffset:!0},e),this._selectorQuery}context(e){return this._selectorQuery._push(this._selector,this._component,this._single,{context:!0},e),this._selectorQuery}node(e){return this._selectorQuery._push(this._selector,this._component,this._single,{node:!0},e),this._selectorQuery}}class SelectorQuery{constructor(e){this._component=void 0,this._page=e,this._queue=[],this._queueCb=[]}exec(e){return requestComponentInfo(this._page,this._queue,t=>{const n=this._queueCb;t.forEach((e,t)=>{isArray$3(e)?e.forEach(convertContext):convertContext(e);const r=n[t];isFunction$2(r)&&r.call(this,e)}),isFunction$2(e)&&e.call(this,t)}),this._nodesRef}in(e){return this._component=resolveComponentInstance(e),this}select(e){return this._nodesRef=new NodesRef(this,this._component,e,!0)}selectAll(e){return this._nodesRef=new NodesRef(this,this._component,e,!1)}selectViewport(){return this._nodesRef=new NodesRef(this,null,"",!0)}_push(e,t,n,r,i){this._queue.push({component:t,selector:e,single:n,fields:r}),this._queueCb.push(i)}}const createSelectorQuery=defineSyncApi("createSelectorQuery",e=>((e=resolveComponentInstance(e))&&!getPageIdByVm(e)&&(e=null),new SelectorQuery(e||getCurrentPageVm()))),API_CREATE_ANIMATION="createAnimation",CreateAnimationOptions={formatArgs:{}},CreateAnimationProtocol={duration:Number,timingFunction:String,delay:Number,transformOrigin:String},defaultOption={duration:400,timingFunction:"linear",delay:0,transformOrigin:"50% 50% 0"};class MPAnimation{constructor(e){this.actions=[],this.currentTransform={},this.currentStepAnimates=[],this.option=extend$2({},defaultOption,e)}_getOption(e){const t={transition:extend$2({},this.option,e),transformOrigin:""};return t.transformOrigin=t.transition.transformOrigin,delete t.transition.transformOrigin,t}_pushAnimates(e,t){this.currentStepAnimates.push({type:e,args:t})}_converType(e){return e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}_getValue(e){return"number"==typeof e?`${e}px`:e}export(){const e=this.actions;return this.actions=[],{actions:e}}step(e){return this.currentStepAnimates.forEach(e=>{"style"!==e.type?this.currentTransform[e.type]=e:this.currentTransform[`${e.type}.${e.args[0]}`]=e}),this.actions.push({animates:Object.values(this.currentTransform),option:this._getOption(e)}),this.currentStepAnimates=[],this}}const initAnimationProperty=once$1(()=>{const e=["opacity","backgroundColor"],t=["width","height","left","right","top","bottom"];["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"].concat(e,t).forEach(n=>{MPAnimation.prototype[n]=function(...r){return e.concat(t).includes(n)?this._pushAnimates("style",[this._converType(n),t.includes(n)?this._getValue(r[0]):r[0]]):this._pushAnimates(n,r),this}})}),createAnimation$1=defineSyncApi(API_CREATE_ANIMATION,e=>(initAnimationProperty(),new MPAnimation(e)),CreateAnimationProtocol,CreateAnimationOptions),API_ON_TAB_BAR_MID_BUTTON_TAP="onTabBarMidButtonTap",onTabBarMidButtonTap=defineOnApi(API_ON_TAB_BAR_MID_BUTTON_TAP,()=>{}),API_ON_WINDOW_RESIZE="onWindowResize",API_OFF_WINDOW_RESIZE="offWindowResize",onWindowResize=defineOnApi(API_ON_WINDOW_RESIZE,()=>{}),offWindowResize=defineOffApi(API_OFF_WINDOW_RESIZE,()=>{}),API_SET_LOCALE="setLocale",API_GET_LOCALE="getLocale",API_ON_LOCALE_CHANGE="onLocaleChange",getLocale=defineSyncApi(API_GET_LOCALE,()=>{const e=getApp$1();return e&&e.$vm?e.$vm.$locale:useI18n().getLocale()}),onLocaleChange=defineOnApi(API_ON_LOCALE_CHANGE,()=>{}),setLocale=defineSyncApi(API_SET_LOCALE,e=>{const t=getApp$1();if(!t)return!1;return t.$vm.$locale!==e&&(t.$vm.$locale=e,navigator.cookieEnabled&&window.localStorage&&(localStorage[UNI_STORAGE_LOCALE]=e),UniServiceJSBridge$1.invokeOnCallback(API_ON_LOCALE_CHANGE,{locale:e}),!0)}),API_SET_PAGE_META="setPageMeta",setPageMeta=defineAsyncApi(API_SET_PAGE_META,(e,{resolve:t})=>{t(setCurrentPageMeta(getCurrentPageVm(),e))}),API_GET_SELECTED_TEXT_RANGE="getSelectedTextRange",getSelectedTextRange$1=defineAsyncApi(API_GET_SELECTED_TEXT_RANGE,(e,{resolve:t,reject:n})=>{UniServiceJSBridge$1.invokeViewMethod(API_GET_SELECTED_TEXT_RANGE,{},getCurrentPageId(),e=>{void 0===e.end&&void 0===e.start?n("no focused"):t(e)})}),appHooks={[ON_UNHANDLE_REJECTION]:[],[ON_PAGE_NOT_FOUND]:[],[ON_ERROR]:[],[ON_SHOW]:[],[ON_HIDE]:[]};function onAppHook(e,t){const n=getApp$1();if(n&&n.$vm)return injectHook(e,t,n.$vm.$);appHooks[e].push(t)}function injectAppHooks(e){Object.keys(appHooks).forEach(t=>{appHooks[t].forEach(n=>{injectHook(t,n,e)})})}function offAppHook(e,t){const n=getApp$1();if(n&&n.$vm)return removeHook(n.$vm,e,t);remove(appHooks[e],t)}function onUnhandledRejection(e){onAppHook(ON_UNHANDLE_REJECTION,e)}function offUnhandledRejection(e){offAppHook(ON_UNHANDLE_REJECTION,e)}function onPageNotFound(e){onAppHook(ON_PAGE_NOT_FOUND,e)}function offPageNotFound(e){offAppHook(ON_PAGE_NOT_FOUND,e)}function onError(e){onAppHook(ON_ERROR,e)}function offError(e){offAppHook(ON_ERROR,e)}function onAppShow(e){onAppHook(ON_SHOW,e)}function offAppShow(e){offAppHook(ON_SHOW,e)}function onAppHide(e){onAppHook(ON_HIDE,e)}function offAppHide(e){offAppHook(ON_HIDE,e)}const API_GET_ENTER_OPTIONS_SYNC="getEnterOptionsSync",getEnterOptionsSync=defineSyncApi(API_GET_ENTER_OPTIONS_SYNC,()=>getEnterOptions()),API_GET_LAUNCH_OPTIONS_SYNC="getLaunchOptionsSync",getLaunchOptionsSync=defineSyncApi(API_GET_LAUNCH_OPTIONS_SYNC,()=>getLaunchOptions());let cid,cidErrMsg,enabled;function normalizePushMessage(e){try{return JSON.parse(e)}catch(t){}return e}function invokePushCallback(e){if("enabled"===e.type)enabled=!0;else if("clientId"===e.type)cid=e.cid,cidErrMsg=e.errMsg,invokeGetPushCidCallbacks(cid,e.errMsg);else if("pushMsg"===e.type){const t={type:"receive",data:normalizePushMessage(e.message)};for(let e=0;e<onPushMessageCallbacks.length;e++){if((0,onPushMessageCallbacks[e])(t),t.stopped)break}}else"click"===e.type&&onPushMessageCallbacks.forEach(t=>{t({type:"click",data:normalizePushMessage(e.message)})})}const getPushCidCallbacks=[];function invokeGetPushCidCallbacks(e,t){getPushCidCallbacks.forEach(n=>{n(e,t)}),getPushCidCallbacks.length=0}const API_GET_PUSH_CLIENT_ID="getPushClientId",getPushClientId=defineAsyncApi(API_GET_PUSH_CLIENT_ID,(e,{resolve:t,reject:n})=>{Promise.resolve().then(()=>{void 0===enabled&&(enabled=!1,cid="",cidErrMsg="uniPush is not enabled"),getPushCidCallbacks.push((e,r)=>{e?t({cid:e}):n(r)}),void 0!==cid&&invokeGetPushCidCallbacks(cid,cidErrMsg)})}),onPushMessageCallbacks=[],onPushMessage=e=>{-1===onPushMessageCallbacks.indexOf(e)&&onPushMessageCallbacks.push(e)},offPushMessage=e=>{if(e){const t=onPushMessageCallbacks.indexOf(e);t>-1&&onPushMessageCallbacks.splice(t,1)}else onPushMessageCallbacks.length=0},API_CAN_I_USE="canIUse",API_MAKE_PHONE_CALL="makePhoneCall",API_GET_CLIPBOARD_DATA="getClipboardData",API_SET_CLIPBOARD_DATA="setClipboardData",SetClipboardDataOptions={formatArgs:{showToast:!0},beforeInvoke(){initI18nSetClipboardDataMsgsOnce()},beforeSuccess(e,t){if(!t.showToast)return;const{t:n}=useI18n(),r=n("uni.setClipboardData.success");r&&uni.showToast({title:r,icon:"success",mask:!1})}},SetClipboardDataProtocol={data:{type:String,required:!0},showToast:{type:Boolean}},API_ON_ACCELEROMETER="onAccelerometer",API_OFF_ACCELEROMETER="offAccelerometer",API_START_ACCELEROMETER="startAccelerometer",API_STOP_ACCELEROMETER="stopAccelerometer",API_ON_COMPASS="onCompass",API_OFF_COMPASS="offCompass",API_START_COMPASS="startCompass",API_STOP_COMPASS="stopCompass",API_VIBRATE_SHORT="vibrateShort",API_VIBRATE_LONG="vibrateLong",API_GET_STORAGE="getStorage",API_GET_STORAGE_SYNC="getStorageSync",API_SET_STORAGE="setStorage",API_SET_STORAGE_SYNC="setStorageSync",API_REMOVE_STORAGE="removeStorage",API_GET_FILE_INFO="getFileInfo",GetFileInfoOptions={formatArgs:{filePath(e,t){t.filePath=getRealPath(e)}}},GetFileInfoProtocol={filePath:{type:String,required:!0}},API_OPEN_DOCUMENT="openDocument",OpenDocumentOptions={formatArgs:{filePath(e,t){t.filePath=getRealPath(e)}}},OpenDocumentProtocol={filePath:{type:String,required:!0},fileType:String},API_HIDE_KEYBOARD="hideKeyboard",API_CHOOSE_LOCATION="chooseLocation",API_GET_LOCATION="getLocation",coordTypes$1=["wgs84","gcj02"],GetLocationOptions={formatArgs:{type(e,t){e=(e||"").toLowerCase(),-1===coordTypes$1.indexOf(e)?t.type=coordTypes$1[0]:t.type=e},altitude(e,t){t.altitude=e||!1}}},GetLocationProtocol={type:String,altitude:Boolean},API_OPEN_LOCATION="openLocation",checkProps=(e,t)=>{if(void 0===t)return`${e} should not be empty.`;if("number"!=typeof t){let e=typeof t;return e=e[0].toUpperCase()+e.substring(1),`Expected Number, got ${e} with value ${JSON.stringify(t)}.`}},OpenLocationOptions={formatArgs:{latitude(e,t){const n=checkProps("latitude",e);if(n)return n;t.latitude=e},longitude(e,t){const n=checkProps("longitude",e);if(n)return n;t.longitude=e},scale(e,t){e=Math.floor(e),t.scale=e>=5&&e<=18?e:18}}},OpenLocationProtocol={latitude:Number,longitude:Number,scale:Number,name:String,address:String},API_CHOOSE_IMAGE="chooseImage",ChooseImageOptions={formatArgs:{count(e,t){(!e||e<=0)&&(t.count=9)},sizeType(e,t){t.sizeType=elemsInArray(e,CHOOSE_SIZE_TYPES)},sourceType(e,t){t.sourceType=elemsInArray(e,CHOOSE_SOURCE_TYPES)},extension(e,t){if(e instanceof Array&&0===e.length)return"param extension should not be empty.";e||(t.extension=["*"])}}},ChooseImageProtocol={count:Number,sizeType:[Array,String],sourceType:Array,extension:Array},API_CHOOSE_VIDEO="chooseVideo",ChooseVideoOptions={formatArgs:{sourceType(e,t){t.sourceType=elemsInArray(e,CHOOSE_SOURCE_TYPES)},compressed:!0,maxDuration:60,camera:"back",extension(e,t){if(e instanceof Array&&0===e.length)return"param extension should not be empty.";e||(t.extension=["*"])}}},ChooseVideoProtocol={sourceType:Array,compressed:Boolean,maxDuration:Number,camera:String,extension:Array},API_CHOOSE_FILE="chooseFile",CHOOSE_MEDIA_TYPE=["all","image","video"],ChooseFileOptions={formatArgs:{count(e,t){(!e||e<=0)&&(t.count=100)},sourceType(e,t){t.sourceType=elemsInArray(e,CHOOSE_SOURCE_TYPES)},type(e,t){t.type=elemInArray(e,CHOOSE_MEDIA_TYPE)},extension(e,t){if(e instanceof Array&&0===e.length)return"param extension should not be empty.";e||("all"!==t.type&&t.type?t.extension=["*"]:t.extension=[""])}}},ChooseFileProtocol={count:Number,sourceType:Array,type:String,extension:Array},API_GET_IMAGE_INFO="getImageInfo",GetImageInfoOptions={formatArgs:{src(e,t){t.src=getRealPath(e)}}},GetImageInfoProtocol={src:{type:String,required:!0}},API_PREVIEW_IMAGE="previewImage",PreviewImageOptions={formatArgs:{urls(e,t){t.urls=e.map(e=>isString$1(e)&&e?getRealPath(e):"")},current(e,t){"number"==typeof e?t.current=e>0&&e<t.urls.length?e:0:isString$1(e)&&e&&(t.current=getRealPath(e))}}},PreviewImageProtocol={urls:{type:Array,required:!0},current:{type:[Number,String]}},API_CLOSE_PREVIEW_IMAGE="closePreviewImage",API_GET_VIDEO_INFO="getVideoInfo",GetVideoInfoOptions={formatArgs:{src(e,t){t.src=getRealPath(e)}}},GetVideoInfoProtocol={src:{type:String,required:!0}},API_SAVE_IMAGE_TO_PHOTOS_ALBUM="saveImageToPhotosAlbum",API_SAVE_VIDEO_TO_PHOTOS_ALBUM="saveVideoToPhotosAlbum",API_REQUEST="request",dataType={JSON:"json"},RESPONSE_TYPE=["text","arraybuffer"],DEFAULT_RESPONSE_TYPE="text",encode$2=encodeURIComponent;function stringifyQuery(e,t){let n=e.split("#");const r=n[1]||"";n=n[0].split("?");let i=n[1]||"";e=n[0];const o=i.split("&").filter(e=>e),s={};o.forEach(e=>{const t=e.split("=");s[t[0]]=t[1]});for(const a in t)if(hasOwn$1(t,a)){let e=t[a];null==e?e="":isPlainObject$3(e)&&(e=JSON.stringify(e)),s[encode$2(a)]=encode$2(e)}return i=Object.keys(s).map(e=>`${e}=${s[e]}`).join("&"),e+(i?"?"+i:"")+(r?"#"+r:"")}const RequestProtocol={method:String,data:[Object,String,Array,ArrayBuffer],url:{type:String,required:!0},header:Object,dataType:String,responseType:String,withCredentials:Boolean},RequestOptions={formatArgs:{method(e,t){t.method=elemInArray((e||"").toUpperCase(),HTTP_METHODS)},data(e,t){t.data=e||""},url(e,t){t.method===HTTP_METHODS[0]&&isPlainObject$3(t.data)&&Object.keys(t.data).length&&(t.url=stringifyQuery(e,t.data))},header(e,t){const n=t.header=e||{};t.method!==HTTP_METHODS[0]&&(Object.keys(n).find(e=>"content-type"===e.toLowerCase())||(n["Content-Type"]="application/json"))},dataType(e,t){t.dataType=(e||dataType.JSON).toLowerCase()},responseType(e,t){t.responseType=(e||"").toLowerCase(),-1===RESPONSE_TYPE.indexOf(t.responseType)&&(t.responseType=DEFAULT_RESPONSE_TYPE)}}},API_DOWNLOAD_FILE="downloadFile",DownloadFileOptions={formatArgs:{header(e,t){t.header=e||{}}}},DownloadFileProtocol={url:{type:String,required:!0},header:Object,timeout:Number},API_UPLOAD_FILE="uploadFile",UploadFileOptions={formatArgs:{filePath(e,t){e&&(t.filePath=getRealPath(e))},header(e,t){t.header=e||{}},formData(e,t){t.formData=e||{}}}},UploadFileProtocol={url:{type:String,required:!0},files:Array,filePath:String,name:String,header:Object,formData:Object,timeout:Number},API_CONNECT_SOCKET="connectSocket",ConnectSocketOptions={formatArgs:{header(e,t){t.header=e||{}},method(e,t){t.method=elemInArray((e||"").toUpperCase(),HTTP_METHODS)},protocols(e,t){isString$1(e)&&(t.protocols=[e])}}},ConnectSocketProtocol={url:{type:String,required:!0},header:{type:Object},method:String,protocols:[Array,String]},API_SEND_SOCKET_MESSAGE="sendSocketMessage",API_CLOSE_SOCKET="closeSocket",API_START_LOCATION_UPDATE="startLocationUpdate",API_ON_LOCATION_CHANGE="onLocationChange",API_STOP_LOCATION_UPDATE="stopLocationUpdate",API_OFF_LOCATION_CHANGE="offLocationChange",API_OFF_LOCATION_CHANGE_ERROR="offLocationChangeError",API_ON_LOCATION_CHANGE_ERROR="onLocationChangeError",coordTypes=["wgs84","gcj02"],StartLocationUpdateProtocol={type:String},StartLocationUpdateOptions={formatArgs:{type(e,t){e=(e||"").toLowerCase(),-1===coordTypes.indexOf(e)?t.type=coordTypes[1]:t.type=e}}};function encodeQueryString(e){if(!isString$1(e))return e;const t=e.indexOf("?");if(-1===t)return e;const n=e.slice(t+1).trim().replace(/^(\?|#|&)/,"");if(!n)return e;e=e.slice(0,t);const r=[];return n.split("&").forEach(e=>{const t=e.replace(/\+/g," ").split("="),n=t.shift(),i=t.length>0?t.join("="):"";r.push(n+"="+encodeURIComponent(i))}),r.length?e+"?"+r.join("&"):e}const ANIMATION_IN$1=["slide-in-right","slide-in-left","slide-in-top","slide-in-bottom","fade-in","zoom-out","zoom-fade-out","pop-in","none"],ANIMATION_OUT$1=["slide-out-right","slide-out-left","slide-out-top","slide-out-bottom","fade-out","zoom-in","zoom-fade-in","pop-out","none"],BaseRouteProtocol={url:{type:String,required:!0}},API_NAVIGATE_TO="navigateTo",API_REDIRECT_TO="redirectTo",API_RE_LAUNCH="reLaunch",API_SWITCH_TAB="switchTab",API_NAVIGATE_BACK="navigateBack",API_PRELOAD_PAGE="preloadPage",API_UN_PRELOAD_PAGE="unPreloadPage",NavigateToProtocol=extend$2({},BaseRouteProtocol,createAnimationProtocol(ANIMATION_IN$1)),NavigateBackProtocol=extend$2({delta:{type:Number}},createAnimationProtocol(ANIMATION_OUT$1)),RedirectToProtocol=BaseRouteProtocol,ReLaunchProtocol=BaseRouteProtocol,SwitchTabProtocol=BaseRouteProtocol,NavigateToOptions=createRouteOptions(API_NAVIGATE_TO),RedirectToOptions=createRouteOptions(API_REDIRECT_TO),ReLaunchOptions=createRouteOptions(API_RE_LAUNCH),SwitchTabOptions=createRouteOptions(API_SWITCH_TAB),NavigateBackOptions={formatArgs:{delta(e,t){e=parseInt(e+"")||1,t.delta=Math.min(getCurrentPages$1().length-1,e)}}};function createAnimationProtocol(e){return{animationType:{type:String,validator(t){if(t&&-1===e.indexOf(t))return"`"+t+"` is not supported for `animationType` (supported values are: `"+e.join("`|`")+"`)"}},animationDuration:{type:Number}}}let navigatorLock;function beforeRoute(){navigatorLock=""}function createRouteOptions(e){return{formatArgs:{url:createNormalizeUrl(e)},beforeAll:beforeRoute}}function createNormalizeUrl(e){return function(t,n){if(!t)return'Missing required args: "url"';const r=(t=normalizeRoute(t)).split("?")[0],i=getRouteOptions(r,!0);if(!i)return"page `"+t+"` is not found";if(e===API_NAVIGATE_TO||e===API_REDIRECT_TO){if(i.meta.isTabBar)return`can not ${e} a tabbar page`}else if(e===API_SWITCH_TAB&&!i.meta.isTabBar)return"can not switch to no-tabBar page";if(e!==API_SWITCH_TAB&&e!==API_PRELOAD_PAGE||!i.meta.isTabBar||"appLaunch"===n.openType||(t=r),i.meta.isEntry&&(t=t.replace(i.alias,"/")),n.url=encodeQueryString(t),e!==API_UN_PRELOAD_PAGE)if(e!==API_PRELOAD_PAGE){if(navigatorLock===t&&"appLaunch"!==n.openType)return`${navigatorLock} locked`;__uniConfig.ready&&(navigatorLock=t)}else if(i.meta.isTabBar){const e=getCurrentPages$1(),t=i.path.slice(1);if(e.find(e=>e.route===t))return"tabBar page `"+t+"` already exists"}}}const API_HIDE_LOADING="hideLoading",API_HIDE_TOAST="hideToast",API_LOAD_FONT_FACE="loadFontFace",FRONT_COLORS=["#ffffff","#000000"],API_SET_NAVIGATION_BAR_COLOR="setNavigationBarColor",SetNavigationBarColorOptions={formatArgs:{animation(e,t){e||(e={duration:0,timingFunc:"linear"}),t.animation={duration:e.duration||0,timingFunc:e.timingFunc||"linear"}}}},SetNavigationBarColorProtocol={frontColor:{type:String,required:!0,validator(e){if(-1===FRONT_COLORS.indexOf(e))return`invalid frontColor "${e}"`}},backgroundColor:{type:String,required:!0},animation:Object},API_SET_NAVIGATION_BAR_TITLE="setNavigationBarTitle",API_SHOW_NAVIGATION_BAR_LOADING="showNavigationBarLoading",API_HIDE_NAVIGATION_BAR_LOADING="hideNavigationBarLoading",API_PAGE_SCROLL_TO="pageScrollTo",PageScrollToProtocol={scrollTop:Number,selector:String,duration:Number},PageScrollToOptions={formatArgs:{duration:300}},API_SHOW_ACTION_SHEET="showActionSheet",ShowActionSheetProtocol={itemList:{type:Array,required:!0},title:String,itemColor:String,popover:Object},ShowActionSheetOptions={formatArgs:{itemColor:"#000"}},API_SHOW_LOADING="showLoading",ShowLoadingProtocol={title:String,mask:Boolean},ShowLoadingOptions={formatArgs:{title:"",mask:!1}},API_SHOW_MODAL="showModal",ShowModalProtocol={title:String,content:String,showCancel:Boolean,cancelText:String,cancelColor:String,confirmText:String,confirmColor:String},ShowModalOptions={beforeInvoke(){initI18nShowModalMsgsOnce()},formatArgs:{title:"",content:"",placeholderText:"",showCancel:!0,editable:!1,cancelText(e,t){if(!hasOwn$1(t,"cancelText")){const{t:e}=useI18n();t.cancelText=e("uni.showModal.cancel")}},cancelColor:"#000",confirmText(e,t){if(!hasOwn$1(t,"confirmText")){const{t:e}=useI18n();t.confirmText=e("uni.showModal.confirm")}},confirmColor:PRIMARY_COLOR}},API_SHOW_TOAST="showToast",SHOW_TOAST_ICON=["success","loading","none","error"],ShowToastProtocol={title:String,icon:String,image:String,duration:Number,mask:Boolean},ShowToastOptions={formatArgs:{title:"",icon(e,t){t.icon=elemInArray(e,SHOW_TOAST_ICON)},image(e,t){t.image=e?getRealPath(e):""},duration:1500,mask:!1}},API_START_PULL_DOWN_REFRESH="startPullDownRefresh",API_STOP_PULL_DOWN_REFRESH="stopPullDownRefresh",IndexProtocol={index:{type:Number,required:!0}},IndexOptions={beforeInvoke(){const e=getCurrentPageMeta();if(e&&!e.isTabBar)return"not TabBar page"},formatArgs:{index(e){if(!__uniConfig.tabBar.list[e])return"tabbar item not found"}}},API_SET_TAB_BAR_ITEM="setTabBarItem",SetTabBarItemProtocol=extend$2({text:String,iconPath:String,selectedIconPath:String,pagePath:String},IndexProtocol),SetTabBarItemOptions={beforeInvoke:IndexOptions.beforeInvoke,formatArgs:extend$2({pagePath(e,t){e&&(t.pagePath=removeLeadingSlash(e))}},IndexOptions.formatArgs)},API_SET_TAB_BAR_STYLE="setTabBarStyle",SetTabBarStyleProtocol={color:String,selectedColor:String,backgroundColor:String,backgroundImage:String,backgroundRepeat:String,borderStyle:String},GRADIENT_RE=/^(linear|radial)-gradient\(.+?\);?$/,SetTabBarStyleOptions={beforeInvoke:IndexOptions.beforeInvoke,formatArgs:{backgroundImage(e,t){e&&!GRADIENT_RE.test(e)&&(t.backgroundImage=getRealPath(e))},borderStyle(e,t){e&&(t.borderStyle="white"===e?"white":"black")}}},API_HIDE_TAB_BAR="hideTabBar",API_SHOW_TAB_BAR="showTabBar",API_HIDE_TAB_BAR_RED_DOT="hideTabBarRedDot",HideTabBarRedDotProtocol=IndexProtocol,HideTabBarRedDotOptions=IndexOptions,API_SHOW_TAB_BAR_RED_DOT="showTabBarRedDot",ShowTabBarRedDotProtocol=IndexProtocol,ShowTabBarRedDotOptions=IndexOptions,API_REMOVE_TAB_BAR_BADGE="removeTabBarBadge",RemoveTabBarBadgeProtocol=IndexProtocol,RemoveTabBarBadgeOptions=IndexOptions,API_SET_TAB_BAR_BADGE="setTabBarBadge",SetTabBarBadgeProtocol=extend$2({text:{type:String,required:!0}},IndexProtocol),SetTabBarBadgeOptions={beforeInvoke:IndexOptions.beforeInvoke,formatArgs:extend$2({text(e,t){getLen(e)>=4&&(t.text="...")}},IndexOptions.formatArgs)},initIntersectionObserverPolyfill=function(){if("object"==typeof window)if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var e=function(){for(var e=window.document,t=i(e);t;)t=i(e=t.ownerDocument);return e}(),t=[],n=null,r=null;s.prototype.THROTTLE_TIMEOUT=100,s.prototype.POLL_INTERVAL=null,s.prototype.USE_MUTATION_OBSERVER=!0,s._setupCrossOriginUpdater=function(){return n||(n=function(e,n){r=e&&n?p(e,n):{top:0,bottom:0,left:0,right:0,width:0,height:0},t.forEach(function(e){e._checkForIntersections()})}),n},s._resetCrossOriginUpdater=function(){n=null,r=null},s.prototype.observe=function(e){if(!this._observationTargets.some(function(t){return t.element==e})){if(!e||1!=e.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:e,entry:null}),this._monitorIntersections(e.ownerDocument),this._checkForIntersections()}},s.prototype.unobserve=function(e){this._observationTargets=this._observationTargets.filter(function(t){return t.element!=e}),this._unmonitorIntersections(e.ownerDocument),0==this._observationTargets.length&&this._unregisterInstance()},s.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},s.prototype.takeRecords=function(){var e=this._queuedEntries.slice();return this._queuedEntries=[],e},s.prototype._initThresholds=function(e){var t=e||[0];return Array.isArray(t)||(t=[t]),t.sort().filter(function(e,t,n){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return e!==n[t-1]})},s.prototype._parseRootMargin=function(e){var t=(e||"0px").split(/\s+/).map(function(e){var t=/^(-?\d*\.?\d+)(px|%)$/.exec(e);if(!t)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(t[1]),unit:t[2]}});return t[1]=t[1]||t[0],t[2]=t[2]||t[0],t[3]=t[3]||t[1],t},s.prototype._monitorIntersections=function(t){var n=t.defaultView;if(n&&-1==this._monitoringDocuments.indexOf(t)){var r=this._checkForIntersections,o=null,s=null;this.POLL_INTERVAL?o=n.setInterval(r,this.POLL_INTERVAL):(a(n,"resize",r,!0),a(t,"scroll",r,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in n&&(s=new n.MutationObserver(r)).observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!0})),this._monitoringDocuments.push(t),this._monitoringUnsubscribes.push(function(){var e=t.defaultView;e&&(o&&e.clearInterval(o),c(e,"resize",r,!0)),c(t,"scroll",r,!0),s&&s.disconnect()});var l=this.root&&(this.root.ownerDocument||this.root)||e;if(t!=l){var d=i(t);d&&this._monitorIntersections(d.ownerDocument)}}},s.prototype._unmonitorIntersections=function(t){var n=this._monitoringDocuments.indexOf(t);if(-1!=n){var r=this.root&&(this.root.ownerDocument||this.root)||e;if(!this._observationTargets.some(function(e){var n=e.element.ownerDocument;if(n==t)return!0;for(;n&&n!=r;){var o=i(n);if((n=o&&o.ownerDocument)==t)return!0}return!1})){var o=this._monitoringUnsubscribes[n];if(this._monitoringDocuments.splice(n,1),this._monitoringUnsubscribes.splice(n,1),o(),t!=r){var s=i(t);s&&this._unmonitorIntersections(s.ownerDocument)}}}},s.prototype._unmonitorAllIntersections=function(){var e=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var t=0;t<e.length;t++)e[t]()},s.prototype._checkForIntersections=function(){if(this.root||!n||r){var e=this._rootIsInDom(),t=e?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach(function(r){var i=r.element,s=d(i),a=this._rootContainsTarget(i),c=r.entry,l=e&&a&&this._computeTargetAndRootIntersection(i,s,t),u=null;this._rootContainsTarget(i)?n&&!this.root||(u=t):u={top:0,bottom:0,left:0,right:0,width:0,height:0};var p=r.entry=new o({time:window.performance&&performance.now&&performance.now(),target:i,boundingClientRect:s,rootBounds:u,intersectionRect:l});c?e&&a?this._hasCrossedThreshold(c,p)&&this._queuedEntries.push(p):c&&c.isIntersecting&&this._queuedEntries.push(p):this._queuedEntries.push(p)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},s.prototype._computeTargetAndRootIntersection=function(t,i,o){if("none"!=window.getComputedStyle(t).display){for(var s=i,a=g(t),c=!1;!c&&a;){var u=null,h=1==a.nodeType?window.getComputedStyle(a):{};if("none"==h.display)return null;if(a==this.root||9==a.nodeType)if(c=!0,a==this.root||a==e)n&&!this.root?!r||0==r.width&&0==r.height?(a=null,u=null,s=null):u=r:u=o;else{var m=g(a),f=m&&d(m),v=m&&this._computeTargetAndRootIntersection(m,f,o);f&&v?(a=m,u=p(f,v)):(a=null,s=null)}else{var y=a.ownerDocument;a!=y.body&&a!=y.documentElement&&"visible"!=h.overflow&&(u=d(a))}if(u&&(s=l(u,s)),!s)break;a=a&&g(a)}return s}},s.prototype._getRootRect=function(){var t;if(this.root&&!m(this.root))t=d(this.root);else{var n=m(this.root)?this.root:e,r=n.documentElement,i=n.body;t={top:0,left:0,right:r.clientWidth||i.clientWidth,width:r.clientWidth||i.clientWidth,bottom:r.clientHeight||i.clientHeight,height:r.clientHeight||i.clientHeight}}return this._expandRectByRootMargin(t)},s.prototype._expandRectByRootMargin=function(e){var t=this._rootMarginValues.map(function(t,n){return"px"==t.unit?t.value:t.value*(n%2?e.width:e.height)/100}),n={top:e.top-t[0],right:e.right+t[1],bottom:e.bottom+t[2],left:e.left-t[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},s.prototype._hasCrossedThreshold=function(e,t){var n=e&&e.isIntersecting?e.intersectionRatio||0:-1,r=t.isIntersecting?t.intersectionRatio||0:-1;if(n!==r)for(var i=0;i<this.thresholds.length;i++){var o=this.thresholds[i];if(o==n||o==r||o<n!=o<r)return!0}},s.prototype._rootIsInDom=function(){return!this.root||h(e,this.root)},s.prototype._rootContainsTarget=function(t){var n=this.root&&(this.root.ownerDocument||this.root)||e;return h(n,t)&&(!this.root||n==t.ownerDocument)},s.prototype._registerInstance=function(){t.indexOf(this)<0&&t.push(this)},s.prototype._unregisterInstance=function(){var e=t.indexOf(this);-1!=e&&t.splice(e,1)},window.IntersectionObserver=s,window.IntersectionObserverEntry=o}function i(e){try{return e.defaultView&&e.defaultView.frameElement||null}catch(t){return null}}function o(e){this.time=e.time,this.target=e.target,this.rootBounds=u(e.rootBounds),this.boundingClientRect=u(e.boundingClientRect),this.intersectionRect=u(e.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0}),this.isIntersecting=!!e.intersectionRect;var t=this.boundingClientRect,n=t.width*t.height,r=this.intersectionRect,i=r.width*r.height;this.intersectionRatio=n?Number((i/n).toFixed(4)):this.isIntersecting?1:0}function s(e,t){var n,r,i,o=t||{};if("function"!=typeof e)throw new Error("callback must be a function");if(o.root&&1!=o.root.nodeType&&9!=o.root.nodeType)throw new Error("root must be a Document or Element");this._checkForIntersections=(n=this._checkForIntersections.bind(this),r=this.THROTTLE_TIMEOUT,i=null,function(){i||(i=setTimeout(function(){n(),i=null},r))}),this._callback=e,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(o.rootMargin),this.thresholds=this._initThresholds(o.threshold),this.root=o.root||null,this.rootMargin=this._rootMarginValues.map(function(e){return e.value+e.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}function a(e,t,n,r){"function"==typeof e.addEventListener?e.addEventListener(t,n,r):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,n)}function c(e,t,n,r){"function"==typeof e.removeEventListener?e.removeEventListener(t,n,r):"function"==typeof e.detatchEvent&&e.detatchEvent("on"+t,n)}function l(e,t){var n=Math.max(e.top,t.top),r=Math.min(e.bottom,t.bottom),i=Math.max(e.left,t.left),o=Math.min(e.right,t.right),s=o-i,a=r-n;return s>=0&&a>=0&&{top:n,bottom:r,left:i,right:o,width:s,height:a}||null}function d(e){var t;try{t=e.getBoundingClientRect()}catch(n){}return t?(t.width&&t.height||(t={top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.right-t.left,height:t.bottom-t.top}),t):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function u(e){return!e||"x"in e?e:{top:e.top,y:e.top,bottom:e.bottom,left:e.left,x:e.left,right:e.right,width:e.width,height:e.height}}function p(e,t){var n=t.top-e.top,r=t.left-e.left;return{top:n,left:r,height:t.height,width:t.width,bottom:n+t.height,right:r+t.width}}function h(e,t){for(var n=t;n;){if(n==e)return!0;n=g(n)}return!1}function g(t){var n=t.parentNode;return 9==t.nodeType&&t!=e?i(t):(n&&n.assignedSlot&&(n=n.assignedSlot.parentNode),n&&11==n.nodeType&&n.host?n.host:n)}function m(e){return e&&9===e.nodeType}};function normalizeRect(e){const{bottom:t,height:n,left:r,right:i,top:o,width:s}=e||{};return{bottom:t,height:n,left:r,right:i,top:o,width:s}}function rectifyIntersectionRatio(e){const{intersectionRatio:t,boundingClientRect:{height:n,width:r},intersectionRect:{height:i,width:o}}=e;return 0!==t?t:i===n?o/r:i/n}function requestComponentObserver(e,t,n){initIntersectionObserverPolyfill();const r=t.relativeToSelector?e.querySelector(t.relativeToSelector):null,i=new IntersectionObserver(e=>{e.forEach(e=>{n({intersectionRatio:rectifyIntersectionRatio(e),intersectionRect:normalizeRect(e.intersectionRect),boundingClientRect:normalizeRect(e.boundingClientRect),relativeRect:normalizeRect(e.rootBounds),time:Date.now(),dataset:getCustomDataset(e.target),id:e.target.id})})},{root:r,rootMargin:t.rootMargin,threshold:t.thresholds});if(t.observeAll){i.USE_MUTATION_OBSERVER=!0;const n=e.querySelectorAll(t.selector);for(let e=0;e<n.length;e++)i.observe(n[e])}else{i.USE_MUTATION_OBSERVER=!1;const n=e.matches(t.selector)?e:e.querySelector(t.selector);n?i.observe(n):console.warn(`Node ${t.selector} is not found. Intersection observer will not trigger.`)}return i}function removeNonTabBarPages(){const e=getCurrentPageVm();if(!e)return;const t=getCurrentPagesMap(),n=t.keys();for(const r of n){const e=t.get(r);e.$.__isTabBar?e.$.__isActive=!1:removePage(r)}e.$.__isTabBar&&(e.$.__isVisible=!1,invokeHook(e,ON_HIDE))}function isSamePage(e,t){return e===t.fullPath||"/"===e&&t.meta.isEntry}function getTabBarPageId(e){const t=getCurrentPagesMap().values();for(const n of t){const t=getPage$BasePage(n);if(isSamePage(e,t))return n.$.__isActive=!0,t.id}}const switchTab=defineAsyncApi(API_SWITCH_TAB,({url:e,tabBarText:t,isAutomatedTesting:n},{resolve:r,reject:i})=>{if(entryPageState.handledBeforeEntryPageRoutes)return removeNonTabBarPages(),navigate({type:API_SWITCH_TAB,url:e,tabBarText:t,isAutomatedTesting:n},getTabBarPageId(e)).then(r).catch(i);switchTabPagesBeforeEntryPages.push({args:{type:API_SWITCH_TAB,url:e,tabBarText:t,isAutomatedTesting:n},resolve:r,reject:i})},SwitchTabProtocol,SwitchTabOptions);function removeLastPage(){const e=getCurrentPage();if(!e)return;const t=getPage$BasePage(e);removePage(normalizeRouteKey(t.path,t.id))}const redirectTo=defineAsyncApi(API_REDIRECT_TO,({url:e,isAutomatedTesting:t},{resolve:n,reject:r})=>{if(entryPageState.handledBeforeEntryPageRoutes)return removeLastPage(),navigate({type:API_REDIRECT_TO,url:e,isAutomatedTesting:t}).then(n).catch(r);redirectToPagesBeforeEntryPages.push({args:{type:API_REDIRECT_TO,url:e,isAutomatedTesting:t},resolve:n,reject:r})},RedirectToProtocol,RedirectToOptions);function removeAllPages(){const e=getCurrentPagesMap().keys();for(const t of e)removePage(t)}const reLaunch=defineAsyncApi(API_RE_LAUNCH,({url:e,isAutomatedTesting:t},{resolve:n,reject:r})=>{if(entryPageState.handledBeforeEntryPageRoutes)return removeAllPages(),navigate({type:API_RE_LAUNCH,url:e,isAutomatedTesting:t}).then(n).catch(r);reLaunchPagesBeforeEntryPages.push({args:{type:API_RE_LAUNCH,url:e,isAutomatedTesting:t},resolve:n,reject:r})},ReLaunchProtocol,ReLaunchOptions);function navigate({type:e,url:t,tabBarText:n,events:r,isAutomatedTesting:i},o){const s=getApp$1().$router,{path:a,query:c}=parseUrl(t);return new Promise((t,l)=>{const d=createPageState(e,o);s["navigateTo"===e?"push":"replace"]({path:a,query:c,state:d,force:!0}).then(o=>{if(isNavigationFailure(o))return l(o.message);if("switchTab"===e&&(s.currentRoute.value.meta.tabBarText=n),"navigateTo"===e){const e=s.currentRoute.value.meta;return e.eventChannel?r&&(Object.keys(r).forEach(t=>{e.eventChannel._addListener(t,"on",r[t])}),e.eventChannel._clearCache()):e.eventChannel=new EventChannel(d.__id__,r),t(i?{__id__:d.__id__}:{eventChannel:e.eventChannel})}return i?t({__id__:d.__id__}):t()})})}function handleBeforeEntryPageRoutes(){if(entryPageState.handledBeforeEntryPageRoutes)return;entryPageState.handledBeforeEntryPageRoutes=!0;const e=[...navigateToPagesBeforeEntryPages];navigateToPagesBeforeEntryPages.length=0,e.forEach(({args:e,resolve:t,reject:n})=>navigate(e).then(t).catch(n));const t=[...switchTabPagesBeforeEntryPages];switchTabPagesBeforeEntryPages.length=0,t.forEach(({args:e,resolve:t,reject:n})=>(removeNonTabBarPages(),navigate(e,getTabBarPageId(e.url)).then(t).catch(n)));const n=[...redirectToPagesBeforeEntryPages];redirectToPagesBeforeEntryPages.length=0,n.forEach(({args:e,resolve:t,reject:n})=>(removeLastPage(),navigate(e).then(t).catch(n)));const r=[...reLaunchPagesBeforeEntryPages];reLaunchPagesBeforeEntryPages.length=0,r.forEach(({args:e,resolve:t,reject:n})=>(removeAllPages(),navigate(e).then(t).catch(n)))}let tabBar;function useTabBar(){return tabBar||(tabBar=__uniConfig.tabBar&&reactive(initTabBarI18n(__uniConfig.tabBar))),tabBar}function cssSupports(e){const t=window.CSS&&window.CSS.supports;return t&&(t(e)||t.apply(window.CSS,e.split(":")))}const cssVar=cssSupports("--a:0"),cssEnv=cssSupports("top:env(a)"),cssConstant=cssSupports("top:constant(a)"),cssBackdropFilter=cssSupports("backdrop-filter:blur(10px)"),SCHEMA_CSS={"css.var":cssVar,"css.env":cssEnv,"css.constant":cssConstant,"css.backdrop-filter":cssBackdropFilter},canIUse=defineSyncApi(API_CAN_I_USE,e=>hasOwn$1(SCHEMA_CSS,e)?SCHEMA_CSS[e]:!!hasOwn$1(uni,e)),envMethod=(()=>cssEnv?"env":cssConstant?"constant":"")();function updateCurPageCssVar(e){let t=0;if(e.isTabBar){const e=useTabBar();e.shown&&(t=parseInt(e.height))}updatePageCssVar({"--window-top":normalizeWindowTop(0),"--window-bottom":normalizeWindowBottom(t)})}function normalizeWindowTop(e){return envMethod?`calc(${e}px + ${envMethod}(safe-area-inset-top))`:`${e}px`}function normalizeWindowBottom(e){return envMethod?`calc(${e}px + ${envMethod}(safe-area-inset-bottom))`:`${e}px`}const SEP="$$",currentPagesMap=new Map;function getPage$BasePage(e){return e.$page}const entryPageState={handledBeforeEntryPageRoutes:!1},navigateToPagesBeforeEntryPages=[],switchTabPagesBeforeEntryPages=[],redirectToPagesBeforeEntryPages=[],reLaunchPagesBeforeEntryPages=[];function pruneCurrentPages(){currentPagesMap.forEach((e,t)=>{e.$.isUnmounted&&currentPagesMap.delete(t)})}function getCurrentPagesMap(){return currentPagesMap}function getCurrentPages$1(){return getCurrentBasePages()}function getCurrentBasePages(){const e=[],t=currentPagesMap.values();for(const n of t)n.$.__isTabBar?n.$.__isActive&&e.push(n):e.push(n);return e}function removeRouteCache(e){const t=pageCacheMap.get(e);t&&(pageCacheMap.delete(e),routeCache.pruneCacheEntry(t))}function removePage(e,t=!0){const n=currentPagesMap.get(e);n.$.__isUnload=!0,invokeHook(n,ON_UNLOAD),currentPagesMap.delete(e),t&&removeRouteCache(e)}let id=getStateId();function createPageState(e,t){return{__id__:t||++id,__type__:e}}function initPublicPage(e){const t=usePageMeta();let n=e.fullPath;return e.meta.isEntry&&-1===n.indexOf(e.meta.route)&&(n="/"+e.meta.route+n.replace("/","")),initPageInternalInstance("navigateTo",n,{},t)}function initPage(e){const t=initPublicPage(e.$route);initPageVm(e,t),currentPagesMap.set(normalizeRouteKey(t.path,t.id),e),1===currentPagesMap.size&&setTimeout(()=>{handleBeforeEntryPageRoutes()},0)}function normalizeRouteKey(e,t){return e+SEP+t}function useKeepAliveRoute(){const e=useRoute();return{routeKey:computed$2(()=>normalizeRouteKey("/"+e.meta.route,getStateId())),isTabBar:computed$2(()=>e.meta.isTabBar),routeCache:routeCache}}const pageCacheMap=new Map,routeCache={get:e=>pageCacheMap.get(e),set(e,t){pruneRouteCache(e),pageCacheMap.set(e,t)},delete(e){pageCacheMap.get(e)&&pageCacheMap.delete(e)},forEach(e){pageCacheMap.forEach(e)}};function isTabBarVNode(e){return"tabBar"===e.props.type}function pruneRouteCache(e){const t=parseInt(e.split(SEP)[1]);t&&routeCache.forEach((e,n)=>{const r=parseInt(n.split(SEP)[1]);if(r&&r>t){if(isTabBarVNode(e))return;routeCache.delete(n),routeCache.pruneCacheEntry(e),nextTick(()=>pruneCurrentPages())}})}function updateCurPageAttrs(e){{const t="nvue-dir-"+__uniConfig.nvue["flex-direction"];e.isNVue?(document.body.setAttribute("nvue",""),document.body.setAttribute(t,"")):(document.body.removeAttribute("nvue"),document.body.removeAttribute(t))}}function onPageShow(e,t){updateBodyScopeId(e),updateCurPageCssVar(t),updateCurPageAttrs(t),initPageScrollListener(e,t)}function onPageReady(e){const t=getScopeId(e);t&&updateCurPageBodyScopeId(t)}function updateCurPageBodyScopeId(e){const t=document.querySelector("uni-page-body");t&&t.setAttribute(e,"")}function getScopeId(e){return e.type.__scopeId}let curScopeId;function updateBodyScopeId(e){const t=getScopeId(e),{body:n}=document;curScopeId&&n.removeAttribute(curScopeId),t&&n.setAttribute(t,""),curScopeId=t}const supportsPassive=(()=>{let e=!1;try{const t={};Object.defineProperty(t,"passive",{get(){e=!0}}),window.addEventListener("test-passive",()=>{},t)}catch(t){}return e})(),passiveOptions$2=!!supportsPassive&&{passive:!1};let curScrollListener;function initPageScrollListener(e,t){if(document.removeEventListener("touchmove",disableScrollListener),curScrollListener&&document.removeEventListener("scroll",curScrollListener),t.disableScroll)return document.addEventListener("touchmove",disableScrollListener,passiveOptions$2);const{onPageScroll:n,onReachBottom:r}=e,i="transparent"===t.navigationBar.type;if(!(null==n?void 0:n.length)&&!(null==r?void 0:r.length)&&!i)return;const o={},s=getPage$BasePage(e.proxy).id;(n||i)&&(o.onPageScroll=createOnPageScroll(s,n,i)),(null==r?void 0:r.length)&&(o.onReachBottomDistance=t.onReachBottomDistance||ON_REACH_BOTTOM_DISTANCE,o.onReachBottom=()=>UniViewJSBridge$1.publishHandler(ON_REACH_BOTTOM,{},s)),curScrollListener=createScrollListener(o),requestAnimationFrame(()=>document.addEventListener("scroll",curScrollListener))}function createOnPageScroll(e,t,n){return r=>{t&&UniViewJSBridge$1.publishHandler(ON_PAGE_SCROLL,{scrollTop:r},e),n&&UniViewJSBridge$1.emit(e+"."+ON_PAGE_SCROLL,{scrollTop:r})}}function findElem(e){return e.$el}function addBase(e){const{base:t}=__uniConfig.router;return 0===addLeadingSlash(e).indexOf(t)?addLeadingSlash(e):t+e}function getRealPath(e){const{base:t,assets:n}=__uniConfig.router;if("./"===t&&(0!==e.indexOf("./")||!e.includes("/static/")&&0!==e.indexOf("./"+(n||"assets")+"/")||(e=e.slice(1))),0===e.indexOf("/")){if(0!==e.indexOf("//"))return addBase(e.slice(1));e="https:"+e}if(SCHEME_RE.test(e)||DATA_RE.test(e)||0===e.indexOf("blob:"))return e;const r=getCurrentBasePages();return r.length?addBase(getRealRoute(getPage$BasePage(r[r.length-1]).route,e).slice(1)):e}const ua=navigator.userAgent,isAndroid=/android/i.test(ua),isIOS=/iphone|ipad|ipod/i.test(ua),isWindows=ua.match(/Windows NT ([\d|\d.\d]*)/i),isMac=/Macintosh|Mac/i.test(ua),isLinux=/Linux|X11/i.test(ua),isIPadOS=isMac&&navigator.maxTouchPoints>0;function getScreenFix(){return/^Apple/.test(navigator.vendor)&&"number"==typeof window.orientation}function isLandscape(e){return e&&90===Math.abs(window.orientation)}function getScreenWidth(e,t){return e?Math[t?"max":"min"](screen.width,screen.height):screen.width}function getScreenHeight(e,t){return e?Math[t?"min":"max"](screen.height,screen.width):screen.height}function getWindowWidth(e){return Math.min(window.innerWidth,document.documentElement.clientWidth,e)||e}function getBaseSystemInfo(){const e=getScreenFix(),t=getWindowWidth(getScreenWidth(e,isLandscape(e)));return{platform:isIOS?"ios":"other",pixelRatio:window.devicePixelRatio,windowWidth:t}}function operateVideoPlayer(e,t,n,r){UniServiceJSBridge$1.invokeViewMethod("video."+e,{videoId:e,type:n,data:r},t)}function operateMap(e,t,n,r,i){UniServiceJSBridge$1.invokeViewMethod("map."+e,{type:n,data:r},t,i)}function getRootInfo(e){const t={};if(e.id&&(t.id=""),e.dataset&&(t.dataset={}),e.rect&&(t.left=0,t.right=0,t.top=0,t.bottom=0),e.size&&(t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight),e.scrollOffset){const e=document.documentElement,n=document.body;t.scrollLeft=e.scrollLeft||n.scrollLeft||0,t.scrollTop=e.scrollTop||n.scrollTop||0,t.scrollHeight=e.scrollHeight||n.scrollHeight||0,t.scrollWidth=e.scrollWidth||n.scrollWidth||0}return t}function getNodeInfo(e,t){const n={},{top:r,topWindowHeight:i}=getWindowOffset();if(t.node){const t=e.tagName.split("-")[1]||e.tagName;t&&(n.node=e.querySelector(t))}if(t.id&&(n.id=e.id),t.dataset&&(n.dataset=getCustomDataset(e)),t.rect||t.size){const o=e.getBoundingClientRect();t.rect&&(n.left=o.left,n.right=o.right,n.top=o.top-r-i,n.bottom=o.bottom-r-i),t.size&&(n.width=o.width,n.height=o.height)}if(isArray$3(t.properties)&&t.properties.forEach(e=>{e=e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()})}),t.scrollOffset)if("UNI-SCROLL-VIEW"===e.tagName){const t=e.children[0].children[0];n.scrollLeft=t.scrollLeft,n.scrollTop=t.scrollTop,n.scrollHeight=t.scrollHeight,n.scrollWidth=t.scrollWidth}else n.scrollLeft=0,n.scrollTop=0,n.scrollHeight=0,n.scrollWidth=0;if(isArray$3(t.computedStyle)){const r=getComputedStyle(e);t.computedStyle.forEach(e=>{n[e]=r[e]})}return t.context&&(n.contextInfo=getContextInfo(e)),n}function findElm(e,t){return e?e.$el:t.$el}function matches(e,t){return(e.matches||e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){const t=this.parentElement.querySelectorAll(e);let n=t.length;for(;--n>=0&&t.item(n)!==this;);return n>-1}).call(e,t)}function getNodesInfo(e,t,n,r,i){const o=findElm(t,e),s=o.parentElement;if(!s)return r?null:[];const{nodeType:a}=o,c=3===a||8===a;if(r){const e=c?s.querySelector(n):matches(o,n)?o:o.querySelector(n);return e?getNodeInfo(e,i):null}{let e=[];const t=(c?s:o).querySelectorAll(n);return t&&t.length&&[].forEach.call(t,t=>{e.push(getNodeInfo(t,i))}),!c&&matches(o,n)&&e.unshift(getNodeInfo(o,i)),e}}function requestComponentInfo(e,t,n){const r=[];t.forEach(({component:t,selector:n,single:i,fields:o})=>{null===t?r.push(getRootInfo(o)):r.push(getNodesInfo(e,t,n,i,o))}),n(r)}function setCurrentPageMeta(e,{pageStyle:t,rootFontSize:n}){if(t){(document.querySelector("uni-page-body")||document.body).setAttribute("style",t)}n&&document.documentElement.style.fontSize!==n&&(document.documentElement.style.fontSize=n)}function addIntersectionObserver({reqId:e,component:t,options:n,callback:r},i){const o=findElem(t);(o.__io||(o.__io={}))[e]=requestComponentObserver(o,n,r)}function removeIntersectionObserver({reqId:e,component:t},n){const r=findElem(t),i=r.__io&&r.__io[e];i&&(i.disconnect(),delete r.__io[e])}let mediaQueryObservers={},listeners={};function handleMediaQueryStr(e){const t=[],n=["width","minWidth","maxWidth","height","minHeight","maxHeight","orientation"];for(const r of n)"orientation"!==r&&e[r]&&Number(e[r]>=0)&&t.push(`(${humpToLine(r)}: ${Number(e[r])}px)`),"orientation"===r&&e[r]&&t.push(`(${humpToLine(r)}: ${e[r]})`);return t.join(" and ")}function humpToLine(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}function addMediaQueryObserver({reqId:e,component:t,options:n,callback:r},i){const o=mediaQueryObservers[e]=window.matchMedia(handleMediaQueryStr(n)),s=listeners[e]=e=>r(e.matches);s(o),o.addListener(s)}function removeMediaQueryObserver({reqId:e,component:t},n){const r=listeners[e],i=mediaQueryObservers[e];i&&(i.removeListener(r),delete listeners[e],delete mediaQueryObservers[e])}function saveImage(e,t,n){n(null,e)}const files$2={};function urlToFile(e,t){const n=files$2[e];return n?Promise.resolve(n):/^data:[a-z-]+\/[a-z-]+;base64,/.test(e)?Promise.resolve(base64ToFile(e)):t?Promise.reject(new Error("not find")):new Promise((t,n)=>{const r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.onload=function(){t(this.response)},r.onerror=n,r.send()})}function base64ToFile(e){const t=e.split(","),n=t[0].match(/:(.*?);/),r=n?n[1]:"",i=atob(t[1]);let o=i.length;const s=new Uint8Array(o);for(;o--;)s[o]=i.charCodeAt(o);return blobToFile(s,r)}function getExtname(e){const t=e.split("/")[1];return t?`.${t}`:""}function getFileName(e){const t=(e=e.split("#")[0].split("?")[0]).split("/");return t[t.length-1]}function blobToFile(e,t){let n;if(e instanceof File)n=e;else{t=t||e.type||"";const i=`${Date.now()}${getExtname(t)}`;try{n=new File([e],i,{type:t})}catch(r){n=e=e instanceof Blob?e:new Blob([e],{type:t}),n.name=n.name||i}}return n}function fileToUrl(e){for(const n in files$2)if(hasOwn$1(files$2,n)){if(files$2[n]===e)return n}var t=(window.URL||window.webkitURL).createObjectURL(e);return files$2[t]=e,t}function getSameOriginUrl(e){const t=document.createElement("a");return t.href=e,t.origin===location.origin?Promise.resolve(e):urlToFile(e).then(fileToUrl)}function revokeObjectURL(e){(window.URL||window.webkitURL).revokeObjectURL(e),delete files$2[e]}const launchOptions=createLaunchOptions(),enterOptions=createLaunchOptions();function getEnterOptions(){return extend$2({},enterOptions)}function getLaunchOptions(){return extend$2({},launchOptions)}function initLaunchOptions({path:e,query:t}){return extend$2(launchOptions,{path:e,query:t}),extend$2(enterOptions,launchOptions),extend$2({},launchOptions)}const ResizeSensor=defineBuiltInComponent({name:"ResizeSensor",props:{initial:{type:Boolean,default:!1}},emits:["resize"],setup(e,{emit:t}){const n=ref(null),r=useResizeSensorReset(n),i=useResizeSensorUpdate(n,t,r);return useResizeSensorLifecycle(n,e,i,r),()=>createVNode("uni-resize-sensor",{ref:n,onAnimationstartOnce:i},[createVNode("div",{onScroll:i},[createVNode("div",null,null)],40,["onScroll"]),createVNode("div",{onScroll:i},[createVNode("div",null,null)],40,["onScroll"])],40,["onAnimationstartOnce"])}});function useResizeSensorUpdate(e,t,n){const r=reactive({width:-1,height:-1});return watch(()=>extend$2({},r),e=>t("resize",e)),()=>{const t=e.value;t&&(r.width=t.offsetWidth,r.height=t.offsetHeight,n())}}function useResizeSensorReset(e){return()=>{const{firstElementChild:t,lastElementChild:n}=e.value;t.scrollLeft=1e5,t.scrollTop=1e5,n.scrollLeft=1e5,n.scrollTop=1e5}}function useResizeSensorLifecycle(e,t,n,r){onActivated(r),onMounted(()=>{t.initial&&nextTick(n);const i=e.value;i.offsetParent!==i.parentElement&&(i.parentElement.style.position="relative"),"AnimationEvent"in window||r()})}const pixelRatio=function(){if(navigator.userAgent.includes("jsdom"))return 1;const e=document.createElement("canvas");e.height=e.width=0;const t=e.getContext("2d"),n=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/n}();function wrapper(e,t=!0){const n=t?pixelRatio:1;e.width=e.offsetWidth*n,e.height=e.offsetHeight*n,e.getContext("2d").__hidpi__=t}let isHidpi=!1;function initHidpi(){if(isHidpi)return;isHidpi=!0;const e={fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all",transform:[4,5],setTransform:[4,5]},t=CanvasRenderingContext2D.prototype;t.drawImageByCanvas=function(e){return function(t,n,r,i,o,s,a,c,l,d){if(!this.__hidpi__)return e.apply(this,arguments);n*=pixelRatio,r*=pixelRatio,i*=pixelRatio,o*=pixelRatio,s*=pixelRatio,a*=pixelRatio,c=d?c*pixelRatio:c,l=d?l*pixelRatio:l,e.call(this,t,n,r,i,o,s,a,c,l)}}(t.drawImage),1!==pixelRatio&&(!function(e,t){for(const n in e)hasOwn$1(e,n)&&t(e[n],n)}(e,function(e,n){t[n]=function(t){return function(){if(!this.__hidpi__)return t.apply(this,arguments);let n=Array.prototype.slice.call(arguments);if("all"===e)n=n.map(function(e){return e*pixelRatio});else if(Array.isArray(e))for(let t=0;t<e.length;t++)n[e[t]]*=pixelRatio;return t.apply(this,n)}}(t[n])}),t.stroke=function(e){return function(){if(!this.__hidpi__)return e.apply(this,arguments);this.lineWidth*=pixelRatio,e.apply(this,arguments),this.lineWidth/=pixelRatio}}(t.stroke),t.fillText=function(e){return function(){if(!this.__hidpi__)return e.apply(this,arguments);const t=Array.prototype.slice.call(arguments);t[1]*=pixelRatio,t[2]*=pixelRatio,t[3]&&"number"==typeof t[3]&&(t[3]*=pixelRatio);var n=this.__font__||this.font;this.font=n.replace(/(\d+\.?\d*)(px|em|rem|pt)/g,function(e,t,n){return t*pixelRatio+n}),e.apply(this,t),this.font=n}}(t.fillText),t.strokeText=function(e){return function(){if(!this.__hidpi__)return e.apply(this,arguments);var t=Array.prototype.slice.call(arguments);t[1]*=pixelRatio,t[2]*=pixelRatio,t[3]&&"number"==typeof t[3]&&(t[3]*=pixelRatio);var n=this.__font__||this.font;this.font=n.replace(/(\d+\.?\d*)(px|em|rem|pt)/g,function(e,t,n){return t*pixelRatio+n}),e.apply(this,t),this.font=n}}(t.strokeText),t.drawImage=function(e){return function(){if(!this.__hidpi__)return e.apply(this,arguments);this.scale(pixelRatio,pixelRatio),e.apply(this,arguments),this.scale(1/pixelRatio,1/pixelRatio)}}(t.drawImage))}const initHidpiOnce=once$1(()=>initHidpi());function $getRealPath(e){return e?getRealPath(e):e}function resolveColor(e){return(e=e.slice(0))[3]=e[3]/255,"rgba("+e.join(",")+")"}function processTouches(e,t){Array.from(t).forEach(t=>{t.x=t.clientX-e.left,t.y=t.clientY-e.top})}let tempCanvas;function getTempCanvas(e=0,t=0){return tempCanvas||(tempCanvas=document.createElement("canvas")),tempCanvas.width=e,tempCanvas.height=t,tempCanvas}const props$x={canvasId:{type:String,default:""},disableScroll:{type:[Boolean,String],default:!1},hidpi:{type:Boolean,default:!0}},index$v=defineBuiltInComponent({inheritAttrs:!1,name:"Canvas",compatConfig:{MODE:3},props:props$x,computed:{id(){return this.canvasId}},setup(e,{emit:t,slots:n}){initHidpiOnce();const r=ref(null),i=ref(null),o=ref(null),s=ref(!1),a=useNativeEvent(t),{$attrs:c,$excludeAttrs:l,$listeners:d}=useAttrs({excludeListeners:!0}),{_listeners:u}=useListeners(e,d,a),{_handleSubscribe:p,_resize:h}=useMethods(e,i,s);return useSubscribe(p,useContextInfo(e.canvasId),!0),onMounted(()=>{h()}),()=>{const{canvasId:t,disableScroll:s}=e;return createVNode("uni-canvas",mergeProps({ref:r,"canvas-id":t,"disable-scroll":s},c.value,l.value,u.value),[createVNode("canvas",{ref:i,class:"uni-canvas-canvas",width:"300",height:"150"},null,512),createVNode("div",{style:"position: absolute;top: 0;left: 0;width: 100%;height: 100%;overflow: hidden;"},[n.default&&n.default()]),createVNode(ResizeSensor,{ref:o,onResize:h},null,8,["onResize"])],16,["canvas-id","disable-scroll"])}}});function useListeners(e,t,n){return{_listeners:computed$2(()=>{let r=t.value,i=extend$2({},(()=>{let e={};for(const t in r)if(hasOwn$1(r,t)){const n=r[t];e[t]=n}return e})());return["onTouchstart","onTouchmove","onTouchend"].forEach(t=>{let r=[];i[t]&&r.push(withWebEvent(e=>{const r=e.currentTarget.getBoundingClientRect();processTouches(r,e.touches),processTouches(r,e.changedTouches),n(t.replace("on","").toLocaleLowerCase(),e)})),e.disableScroll&&"onTouchmove"===t&&r.push(onEventPrevent),i[t]=r}),i})}}function useMethods(e,t,n){let r=[],i={};const o=computed$2(()=>e.hidpi?pixelRatio:1);function s({actions:e,reserve:o},s){if(!e)return;if(n.value)return void r.push([e,o]);let c=t.value,l=c.getContext("2d");o||(l.fillStyle="#000000",l.strokeStyle="#000000",l.shadowColor="#000000",l.shadowBlur=0,l.shadowOffsetX=0,l.shadowOffsetY=0,l.setTransform(1,0,0,1,0,0),l.clearRect(0,0,c.width,c.height)),function(e){e.forEach(function(e){let t=e.method,n=e.data,r="";function o(){const e=i[r]=new Image;e.onload=function(){e.ready=!0},getSameOriginUrl(r).then(t=>{e.src=t}).catch(()=>{e.src=r})}"drawImage"===t?(r=n[0],r=$getRealPath(r),n[0]=r):"setFillStyle"===t&&"pattern"===n[0]&&(r=n[1],r=$getRealPath(r),n[1]=r),r&&!i[r]&&o()})}(e);for(let t=0;t<e.length;t++){const n=e[t];let r=n.method;const o=n.data,c=o[0];if(/^set/.test(r)&&"setTransform"!==r){const n=r[3].toLowerCase()+r.slice(4);let i;if("fillStyle"===n||"strokeStyle"===n){if("normal"===c)i=resolveColor(o[1]);else if("linear"===c){const e=l.createLinearGradient(...o[1]);o[2].forEach(function(t){const n=t[0],r=resolveColor(t[1]);e.addColorStop(n,r)}),i=e}else if("radial"===c){let e=o[1];const t=e[0],n=e[1],r=e[2],s=l.createRadialGradient(t,n,0,t,n,r);o[2].forEach(function(e){const t=e[0],n=resolveColor(e[1]);s.addColorStop(t,n)}),i=s}else if("pattern"===c){if(!a(o[1],e.slice(t+1),s,function(e){e&&(l[n]=l.createPattern(e,o[2]))}))break;continue}l[n]=i}else if("globalAlpha"===n)l[n]=Number(c)/255;else if("shadow"===n){let e=["shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor"];o.forEach(function(t,n){l[e[n]]="shadowColor"===e[n]?resolveColor(t):t})}else if("fontSize"===n){const e=l.__font__||l.font;l.__font__=l.font=e.replace(/\d+\.?\d*px/,c+"px")}else"lineDash"===n?(l.setLineDash(c),l.lineDashOffset=o[1]||0):"textBaseline"===n?("normal"===c&&(o[0]="alphabetic"),l[n]=c):"font"===n?l.__font__=l.font=c:l[n]=c}else if("fillPath"===r||"strokePath"===r)r=r.replace(/Path/,""),l.beginPath(),o.forEach(function(e){l[e.method].apply(l,e.data)}),l[r]();else if("fillText"===r)l.fillText.apply(l,o);else if("drawImage"===r){if("break"===function(){let n=[...o],r=n[0],c=n.slice(1);if(i=i||{},!a(r,e.slice(t+1),s,function(e){e&&l.drawImage.apply(l,[e].concat([...c.slice(4,8)],[...c.slice(0,4)]))}))return"break"}())break}else"clip"===r?(o.forEach(function(e){l[e.method].apply(l,e.data)}),l.clip()):l[r].apply(l,o)}n.value||s({errMsg:"drawCanvas:ok"})}function a(e,t,o,a){let c=i[e];return c.ready?(a(c),!0):(r.unshift([t,!0]),n.value=!0,c.onload=function(){c.ready=!0,a(c),n.value=!1;let e=r.slice(0);r=[];for(let t=e.shift();t;)s({actions:t[0],reserve:t[1]},o),t=e.shift()},!1)}function c({x:e=0,y:n=0,width:r,height:i,destWidth:s,destHeight:a,hidpi:c=!0,dataType:l,quality:d=1,type:u="png"},p){const h=t.value;let g;const m=h.offsetWidth-e;r=r?Math.min(r,m):m;const f=h.offsetHeight-n;i=i?Math.min(i,f):f,c?(s=r,a=i):s||a?s?a||(a=Math.round(i/r*s)):(a||(a=Math.round(i*o.value)),s=Math.round(r/i*a)):(s=Math.round(r*o.value),a=Math.round(i*o.value));const v=getTempCanvas(s,a),y=v.getContext("2d");let _;"jpeg"!==u&&"jpg"!==u||(u="jpeg",y.fillStyle="#fff",y.fillRect(0,0,s,a)),y.__hidpi__=!0,y.drawImageByCanvas(h,e,n,r,i,0,0,s,a,!1);try{let e;if("base64"===l)g=v.toDataURL(`image/${u}`,d);else{const e=y.getImageData(0,0,s,a);g=Array.prototype.slice.call(e.data)}_={data:g,compressed:e,width:s,height:a}}catch(I){_={errMsg:`canvasGetImageData:fail ${I}`}}if(v.height=v.width=0,y.__hidpi__=!1,!p)return _;p(_)}const l={actionsChanged:s,getImageData:c,putImageData:function({data:e,x:n,y:r,width:i,height:o,compressed:s},a){try{0,o||(o=Math.round(e.length/4/i));const s=getTempCanvas(i,o);s.getContext("2d").putImageData(new ImageData(new Uint8ClampedArray(e),i,o),0,0),t.value.getContext("2d").drawImage(s,n,r,i,o),s.height=s.width=0}catch(c){return void a({errMsg:"canvasPutImageData:fail"})}a({errMsg:"canvasPutImageData:ok"})},toTempFilePath:function({x:e=0,y:t=0,width:n,height:r,destWidth:i,destHeight:o,fileType:s,quality:a,dirname:l},d){const u=c({x:e,y:t,width:n,height:r,destWidth:i,destHeight:o,hidpi:!1,dataType:"base64",type:s,quality:a});u.errMsg?d({errMsg:u.errMsg.replace("canvasPutImageData","toTempFilePath")}):saveImage(u.data,l,(e,t)=>{let n="toTempFilePath:"+(e?"fail":"ok");e&&(n+=` ${e.message}`),d({errMsg:n,tempFilePath:t})})}};return extend$2(l,{_resize:function(n){let r=t.value;if(!n||r.width!==Math.floor(n.width*o.value)||r.height!==Math.floor(n.height*o.value))if(r.width>0&&r.height>0){let t=r.getContext("2d"),n=t.getImageData(0,0,r.width,r.height);wrapper(r,e.hidpi),t.putImageData(n,0,0)}else wrapper(r,e.hidpi)},_handleSubscribe:function(e,t,n){let r=l[e];0!==e.indexOf("_")&&isFunction$2(r)&&r(t,n)}})}const uniCheckGroupKey=PolySymbol("ucg"),props$w={name:{type:String,default:""}},index$u=defineBuiltInComponent({name:"CheckboxGroup",props:props$w,emits:["change"],setup(e,{emit:t,slots:n}){const r=ref(null);return useProvideCheckGroup(e,useCustomEvent(r,t)),()=>createVNode("uni-checkbox-group",{ref:r},[n.default&&n.default()],512)}});function useProvideCheckGroup(e,t){const n=[],r=()=>n.reduce((e,t)=>(t.value.checkboxChecked&&e.push(t.value.value),e),new Array);provide(uniCheckGroupKey,{addField(e){n.push(e)},removeField(e){n.splice(n.indexOf(e),1)},checkboxChange(e){t("change",e,{value:r()})}});const i=inject(uniFormKey,!1);return i&&i.addField({submit:()=>{let t=["",null];return""!==e.name&&(t[0]=e.name,t[1]=r()),t}}),r}const props$v={checked:{type:[Boolean,String],default:!1},id:{type:String,default:""},disabled:{type:[Boolean,String],default:!1},value:{type:String,default:""},color:{type:String,default:"#007aff"},backgroundColor:{type:String,default:""},borderColor:{type:String,default:""},activeBackgroundColor:{type:String,default:""},activeBorderColor:{type:String,default:""},iconColor:{type:String,default:""},foreColor:{type:String,default:""}},index$t=defineBuiltInComponent({name:"Checkbox",props:props$v,setup(e,{slots:t}){const n=ref(null),r=ref(e.checked),i=computed$2(()=>"true"===r.value||!0===r.value),o=ref(e.value);const s=computed$2(()=>function(t){if(e.disabled)return{backgroundColor:"#E1E1E1",borderColor:"#D1D1D1"};const n={};return t?(e.activeBorderColor&&(n.borderColor=e.activeBorderColor),e.activeBackgroundColor&&(n.backgroundColor=e.activeBackgroundColor)):(e.borderColor&&(n.borderColor=e.borderColor),e.backgroundColor&&(n.backgroundColor=e.backgroundColor)),n}(i.value));watch([()=>e.checked,()=>e.value],([e,t])=>{r.value=e,o.value=t});const{uniCheckGroup:a,uniLabel:c}=useCheckboxInject(r,o,()=>{r.value=!1}),l=t=>{e.disabled||(r.value=!r.value,a&&a.checkboxChange(t),t.stopPropagation())};return c&&(c.addHandler(l),onBeforeUnmount(()=>{c.removeHandler(l)})),useListeners$1(e,{"label-click":l}),()=>{const i=useBooleanAttr(e,"disabled");let o;return o=r.value,createVNode("uni-checkbox",mergeProps(i,{id:e.id,onClick:l,ref:n}),[createVNode("div",{class:"uni-checkbox-wrapper",style:{"--HOVER-BD-COLOR":e.activeBorderColor}},[createVNode("div",{class:["uni-checkbox-input",{"uni-checkbox-input-disabled":e.disabled}],style:s.value},[o?createSvgIconVNode(ICON_PATH_SUCCESS_NO_CIRCLE,e.disabled?"#ADADAD":e.foreColor||e.iconColor||e.color,22):""],6),t.default&&t.default()],4)],16,["id","onClick"])}}});function useCheckboxInject(e,t,n){const r=computed$2(()=>({checkboxChecked:Boolean(e.value),value:t.value})),i={reset:n},o=inject(uniCheckGroupKey,!1);o&&o.addField(r);const s=inject(uniFormKey,!1);s&&s.addField(i);const a=inject(uniLabelKey,!1);return onBeforeUnmount(()=>{o&&o.removeField(r),s&&s.removeField(i)}),{uniCheckGroup:o,uniForm:s,uniLabel:a}}let resetTimer;function iosHideKeyboard(){}const props$u={cursorSpacing:{type:[Number,String],default:0},showConfirmBar:{type:[Boolean,String],default:"auto"},adjustPosition:{type:[Boolean,String],default:!0},autoBlur:{type:[Boolean,String],default:!1}},emit$1=["keyboardheightchange"];function useKeyboard$1(e,t,n){function r(e){const t=computed$2(()=>0===String(navigator.vendor).indexOf("Apple"));e.addEventListener("focus",()=>{clearTimeout(resetTimer),document.addEventListener("click",iosHideKeyboard,!1)});e.addEventListener("blur",()=>{t.value&&e.blur(),document.removeEventListener("click",iosHideKeyboard,!1),t.value&&document.documentElement.scrollTo(document.documentElement.scrollLeft,document.documentElement.scrollTop)})}watch(()=>t.value,e=>e&&r(e))}const INFO_COLOR="#10aeff",WARN_COLOR="#f76260",GREY_COLOR="#b2b2b2",CANCEL_COLOR="#f43530",ICONS={success:{d:ICON_PATH_SUCCESS,c:PRIMARY_COLOR},success_no_circle:{d:ICON_PATH_SUCCESS_NO_CIRCLE,c:PRIMARY_COLOR},info:{d:ICON_PATH_INFO,c:INFO_COLOR},warn:{d:ICON_PATH_WARN,c:WARN_COLOR},waiting:{d:ICON_PATH_WAITING,c:INFO_COLOR},cancel:{d:ICON_PATH_CANCEL,c:CANCEL_COLOR},download:{d:ICON_PATH_DOWNLOAD,c:PRIMARY_COLOR},search:{d:ICON_PATH_SEARCH,c:GREY_COLOR},clear:{d:ICON_PATH_CLEAR,c:GREY_COLOR}},index$r=defineBuiltInComponent({name:"Icon",props:{type:{type:String,required:!0,default:""},size:{type:[String,Number],default:23},color:{type:String,default:""}},setup(e){const t=ref(null),n=computed$2(()=>ICONS[e.type]);return()=>{const{value:r}=n;return createVNode("uni-icon",{ref:t},[r&&r.d&&createSvgIconVNode(r.d,e.color||r.c,rpx2px(e.size))],512)}}}),props$s={src:{type:String,default:""},mode:{type:String,default:"scaleToFill"},lazyLoad:{type:[Boolean,String],default:!1},draggable:{type:Boolean,default:!1}},FIX_MODES={widthFix:["offsetWidth","height",(e,t)=>e/t],heightFix:["offsetHeight","width",(e,t)=>e*t]},IMAGE_MODES={aspectFit:["center center","contain"],aspectFill:["center center","cover"],widthFix:[,"100% 100%"],heightFix:[,"100% 100%"],top:["center top"],bottom:["center bottom"],center:["center center"],left:["left center"],right:["right center"],"top left":["left top"],"top right":["right top"],"bottom left":["left bottom"],"bottom right":["right bottom"]},index$q=defineBuiltInComponent({name:"Image",props:props$s,setup(e,{emit:t}){const n=ref(null),r=useImageState(n,e),i=useCustomEvent(n,t),{fixSize:o}=useImageSize(n,e,r);return useImageLoader(r,e,n,o,i),()=>createVNode("uni-image",{ref:n},[createVNode("div",{style:r.modeStyle},null,4),FIX_MODES[e.mode]?createVNode(ResizeSensor,{onResize:o},null,8,["onResize"]):createVNode("span",null,null)],512)}});function useImageState(e,t){const n=ref(""),r=computed$2(()=>{let e="auto",r="";const i=IMAGE_MODES[t.mode];return i?(i[0]&&(r=i[0]),i[1]&&(e=i[1])):(r="0% 0%",e="100% 100%"),`background-image:${n.value?'url("'+n.value+'")':"none"};background-position:${r};background-size:${e};`}),i=reactive({rootEl:e,src:computed$2(()=>t.src?getRealPath(t.src):""),origWidth:0,origHeight:0,origStyle:{width:"",height:""},modeStyle:r,imgSrc:n});return onMounted(()=>{const t=e.value;i.origWidth=t.clientWidth||0,i.origHeight=t.clientHeight||0}),i}function useImageLoader(e,t,n,r,i){let o,s;const a=(t=0,n=0,r="")=>{e.origWidth=t,e.origHeight=n,e.imgSrc=r},c=c=>{if(!c)return l(),void a();o=o||new Image,o.onload=e=>{const{width:d,height:u}=o;a(d,u,c),nextTick(()=>{r()}),o.draggable=t.draggable,s&&s.remove(),s=o,n.value.appendChild(o),l(),i("load",e,{width:d,height:u})},o.onerror=t=>{a(),l(),i("error",t,{errMsg:`GET ${e.src} 404 (Not Found)`})},o.src=c},l=()=>{o&&(o.onload=null,o.onerror=null,o=null)};watch(()=>e.src,e=>c(e)),watch(()=>e.imgSrc,e=>{!e&&s&&(s.remove(),s=null)}),onMounted(()=>c(e.src)),onBeforeUnmount(()=>l())}const isChrome="Google Inc."===navigator.vendor;function fixNumber(e){return isChrome&&e>10&&(e=2*Math.round(e/2)),e}function useImageSize(e,t,n){const r=()=>{const{mode:r}=t,i=FIX_MODES[r];if(!i)return;const{origWidth:o,origHeight:s}=n,a=o&&s?o/s:0;if(!a)return;const c=e.value,l=c[i[0]];l&&(c.style[i[1]]=fixNumber(i[2](l,a))+"px")},i=()=>{const{style:t}=e.value,{origStyle:{width:r,height:i}}=n;t.width=r,t.height=i};return watch(()=>t.mode,(e,t)=>{FIX_MODES[t]&&i(),FIX_MODES[e]&&r()}),{fixSize:r,resetSize:i}}function throttle(e,t){let n,r,i=0;const o=function(...o){const s=Date.now();clearTimeout(n),r=()=>{r=null,i=s,e.apply(this,o)},s-i<t?n=setTimeout(r,t-(s-i)):r()};return o.cancel=function(){clearTimeout(n),r=null},o.flush=function(){clearTimeout(n),r&&r()},o}const passiveOptions$1=passive(!0),states=[];let userInteract=0,inited=!1;const setUserAction=e=>states.forEach(t=>t.userAction=e);function addInteractListener(e={userAction:!1}){if(!inited){["touchstart","touchmove","touchend","mousedown","mouseup"].forEach(e=>{document.addEventListener(e,function(){!userInteract&&setUserAction(!0),userInteract++,setTimeout(()=>{! --userInteract&&setUserAction(!1)},0)},passiveOptions$1)}),inited=!0}states.push(e)}function removeInteractListener(e){const t=states.indexOf(e);t>=0&&states.splice(t,1)}const getInteractStatus=()=>!!userInteract;function useUserAction(){const e=reactive({userAction:!1});return onMounted(()=>{addInteractListener(e)}),onBeforeUnmount(()=>{removeInteractListener(e)}),{state:e}}function useScopedAttrs(){const e=reactive({attrs:{}});return onMounted(()=>{let t=getCurrentInstance();for(;t;){const n=t.type.__scopeId;n&&(e.attrs[n]=""),t=t.proxy&&"page"===t.proxy.$mpType?null:t.parent}}),{state:e}}function useFormField(e,t){const n=inject(uniFormKey,!1);if(!n)return;const r=getCurrentInstance(),i={submit(){const n=r.proxy;return[n[e],isString$1(t)?n[t]:t.value]},reset(){isString$1(t)?r.proxy[t]="":t.value=""}};n.addField(i),onBeforeUnmount(()=>{n.removeField(i)})}function getSelectedTextRange(e,t){const n=document.activeElement;if(!n)return t({});const r={};["input","textarea"].includes(n.tagName.toLowerCase())&&(r.start=n.selectionStart,r.end=n.selectionEnd),t(r)}const UniViewJSBridgeSubscribe=function(){registerViewMethod(getCurrentPageId(),"getSelectedTextRange",getSelectedTextRange)};function getValueString(e,t,n){"number"===t&&isNaN(Number(e))&&(e="");return null==e?"":String(e)}const INPUT_MODES=["none","text","decimal","numeric","tel","search","email","url"],props$r=extend$2({},{name:{type:String,default:""},modelValue:{type:[String,Number]},value:{type:[String,Number]},disabled:{type:[Boolean,String],default:!1},autoFocus:{type:[Boolean,String],default:!1},focus:{type:[Boolean,String],default:!1},cursor:{type:[Number,String],default:-1},selectionStart:{type:[Number,String],default:-1},selectionEnd:{type:[Number,String],default:-1},type:{type:String,default:"text"},password:{type:[Boolean,String],default:!1},placeholder:{type:String,default:""},placeholderStyle:{type:String,default:""},placeholderClass:{type:String,default:""},maxlength:{type:[Number,String],default:140},confirmType:{type:String,default:"done"},confirmHold:{type:Boolean,default:!1},ignoreCompositionEvent:{type:Boolean,default:!0},step:{type:String,default:"0.000000000000000001"},inputmode:{type:String,default:void 0,validator:e=>!!~INPUT_MODES.indexOf(e)},cursorColor:{type:String,default:""}},props$u),emit=["input","focus","blur","update:value","update:modelValue","update:focus","compositionstart","compositionupdate","compositionend",...emit$1];function useBase(e,t,n){const r=ref(null),i=useCustomEvent(t,n),o=computed$2(()=>{const t=Number(e.selectionStart);return isNaN(t)?-1:t}),s=computed$2(()=>{const t=Number(e.selectionEnd);return isNaN(t)?-1:t}),a=computed$2(()=>{const t=Number(e.cursor);return isNaN(t)?-1:t}),c=computed$2(()=>{var t=Number(e.maxlength);return isNaN(t)?140:t});let l="";l=getValueString(e.modelValue,e.type)||getValueString(e.value,e.type);const d=reactive({value:l,valueOrigin:l,maxlength:c,focus:e.focus,composing:!1,selectionStart:o,selectionEnd:s,cursor:a});return watch(()=>d.focus,e=>n("update:focus",e)),watch(()=>d.maxlength,e=>d.value=d.value.slice(0,e),{immediate:!1}),{fieldRef:r,state:d,trigger:i}}function useValueSync(e,t,n,r){let i=null;i=debounce$1(n=>{t.value=getValueString(n,e.type)},100,{setTimeout:setTimeout,clearTimeout:clearTimeout}),watch(()=>e.modelValue,i),watch(()=>e.value,i);const o=throttle((e,t)=>{i.cancel(),n("update:modelValue",t.value),n("update:value",t.value),r("input",e,t)},100);return onBeforeMount(()=>{i.cancel(),o.cancel()}),{trigger:r,triggerInput:(e,t,n)=>{i.cancel(),o(e,t),n&&o.flush()}}}function useAutoFocus(e,t){useUserAction();const n=computed$2(()=>e.autoFocus||e.focus);function r(){if(!n.value)return;const e=t.value;e?e.focus():setTimeout(r,100)}watch(()=>e.focus,e=>{e?r():function(){const e=t.value;e&&e.blur()}()}),onMounted(()=>{n.value&&nextTick(r)})}function useEvent(e,t,n,r,i,o){function s(){const n=e.value;n&&t.focus&&t.selectionStart>-1&&t.selectionEnd>-1&&"number"!==n.type&&(n.selectionStart=t.selectionStart,n.selectionEnd=t.selectionEnd)}function a(){const n=e.value;n&&t.focus&&t.selectionStart<0&&t.selectionEnd<0&&t.cursor>-1&&"number"!==n.type&&(n.selectionEnd=n.selectionStart=t.cursor)}function c(e){return"number"===e.type?null:e.selectionEnd}watch([()=>t.selectionStart,()=>t.selectionEnd],s),watch(()=>t.cursor,a),watch(()=>e.value,function(){const l=e.value;if(!l)return;const d=function(e,r){e.stopPropagation(),isFunction$2(o)&&!1===o(e,t)||(t.value=l.value,t.composing&&n.ignoreCompositionEvent||i(e,{value:l.value,cursor:c(l)},r))};function u(e){n.ignoreCompositionEvent||r(e.type,e,{value:e.data})}l.addEventListener("change",e=>e.stopPropagation()),l.addEventListener("focus",function(e){t.focus=!0,r("focus",e,{value:t.value}),s(),a()}),l.addEventListener("blur",function(e){t.composing&&(t.composing=!1,d(e,!0)),t.focus=!1,r("blur",e,{value:t.value,cursor:c(e.target)})}),l.addEventListener("input",d),l.addEventListener("compositionstart",e=>{e.stopPropagation(),t.composing=!0,u(e)}),l.addEventListener("compositionend",e=>{e.stopPropagation(),t.composing&&(t.composing=!1,d(e)),u(e)}),l.addEventListener("compositionupdate",u)})}function useField(e,t,n,r){UniViewJSBridgeSubscribe();const{fieldRef:i,state:o,trigger:s}=useBase(e,t,n),{triggerInput:a}=useValueSync(e,o,n,s);useAutoFocus(e,i),useKeyboard$1(e,i);const{state:c}=useScopedAttrs();useFormField("name",o),useEvent(i,o,e,s,a,r);return{fieldRef:i,state:o,scopedAttrsState:c,fixDisabledColor:0===String(navigator.vendor).indexOf("Apple")&&CSS.supports("image-orientation:from-image"),trigger:s}}const props$q=extend$2({},props$r,{placeholderClass:{type:String,default:"input-placeholder"},textContentType:{type:String,default:""}}),resolveDigitDecimalPointDeleteContentBackward=once$1(()=>{{const e=navigator.userAgent;let t="";const n=e.match(/OS\s([\w_]+)\slike/);if(n)t=n[1].replace(/_/g,".");else if(/Macintosh|Mac/i.test(e)&&navigator.maxTouchPoints>0){const n=e.match(/Version\/(\S*)\b/);n&&(t=n[1])}return!!t&&parseInt(t)>=16&&parseFloat(t)<17.2}});function resolveDigitDecimalPoint(e,t,n,r,i){if(t.value)if("."===e.data){if("."===t.value.slice(-1))return n.value=r.value=t.value=t.value.slice(0,-1),!1;if(t.value&&!t.value.includes("."))return t.value+=".",i&&(i.fn=()=>{n.value=r.value=t.value=t.value.slice(0,-1),r.removeEventListener("blur",i.fn)},r.addEventListener("blur",i.fn)),!1}else if("deleteContentBackward"===e.inputType&&resolveDigitDecimalPointDeleteContentBackward()&&"."===t.value.slice(-2,-1))return t.value=n.value=r.value=t.value.slice(0,-2),!0}function useCache(e,t){if("number"===t.value){const t=void 0===e.modelValue?e.value:e.modelValue,n=ref(null!=t?t.toLocaleString():"");return watch(()=>e.modelValue,e=>{n.value=null!=e?e.toLocaleString():""}),watch(()=>e.value,e=>{n.value=null!=e?e.toLocaleString():""}),n}return ref("")}const Input=defineBuiltInComponent({name:"Input",props:props$q,emits:["confirm",...emit],setup(e,{emit:t,expose:n}){const r=["text","number","idcard","digit","password","tel"],i=["off","one-time-code"],o=computed$2(()=>{let t="";switch(e.type){case"text":t="text","search"===e.confirmType&&(t="search");break;case"idcard":t="text";break;case"digit":t="number";break;default:t=r.includes(e.type)?e.type:"text"}return e.password?"password":t}),s=computed$2(()=>{const t=i.indexOf(e.textContentType),n=i.indexOf(hyphenate(e.textContentType));return i[-1!==t?t:-1!==n?n:0]});let a=useCache(e,o),c={fn:null};const l=ref(null),{fieldRef:d,state:u,scopedAttrsState:p,fixDisabledColor:h,trigger:g}=useField(e,l,t,(t,n)=>{const r=t.target;if("number"===o.value){if(c.fn&&(r.removeEventListener("blur",c.fn),c.fn=null),r.validity&&!r.validity.valid){if((!a.value||!r.value)&&"-"===t.data||"-"===a.value[0]&&"deleteContentBackward"===t.inputType)return a.value="-",n.value="",c.fn=()=>{a.value=r.value=""},r.addEventListener("blur",c.fn),!1;const e=resolveDigitDecimalPoint(t,a,n,r,c);return"boolean"==typeof e?e:(a.value=n.value=r.value="-"===a.value?"":a.value,!1)}{const e=resolveDigitDecimalPoint(t,a,n,r,c);if("boolean"==typeof e)return e;a.value=r.value}const i=n.maxlength;if(i>0&&r.value.length>i){r.value=r.value.slice(0,i),n.value=r.value;return(void 0!==e.modelValue&&null!==e.modelValue?e.modelValue.toString():"")!==r.value}}});watch(()=>u.value,t=>{"number"!==e.type||"-"===a.value&&""===t||(a.value=t.toString())});const m=["number","digit"],f=computed$2(()=>m.includes(e.type)?e.step:"");function v(t){if("Enter"!==t.key)return;const n=t.target;t.stopPropagation(),g("confirm",t,{value:n.value}),!e.confirmHold&&n.blur()}return n({$triggerInput:e=>{t("update:modelValue",e.value),t("update:value",e.value),u.value=e.value}}),()=>{let t=e.disabled&&h?createVNode("input",{key:"disabled-input",ref:d,value:u.value,tabindex:"-1",readonly:!!e.disabled,type:o.value,maxlength:u.maxlength,step:f.value,class:"uni-input-input",style:e.cursorColor?{caretColor:e.cursorColor}:{},onFocus:e=>e.target.blur()},null,44,["value","readonly","type","maxlength","step","onFocus"]):createVNode("input",{key:"input",ref:d,value:u.value,onInput:e=>{u.value=e.target.value.toString()},disabled:!!e.disabled,type:o.value,maxlength:u.maxlength,step:f.value,enterkeyhint:e.confirmType,pattern:"number"===e.type?"[0-9]*":void 0,class:"uni-input-input",style:e.cursorColor?{caretColor:e.cursorColor}:{},autocomplete:s.value,onKeyup:v,inputmode:e.inputmode},null,44,["value","onInput","disabled","type","maxlength","step","enterkeyhint","pattern","autocomplete","onKeyup","inputmode"]);return createVNode("uni-input",{ref:l},[createVNode("div",{class:"uni-input-wrapper"},[withDirectives(createVNode("div",mergeProps(p.attrs,{style:e.placeholderStyle,class:["uni-input-placeholder",e.placeholderClass]}),[e.placeholder],16),[[vShow,!(u.value.length||"-"===a.value||a.value.includes("."))]]),"search"===e.confirmType?createVNode("form",{action:"",onSubmit:e=>e.preventDefault(),class:"uni-input-form"},[t],40,["onSubmit"]):t])],512)}}});function entries(e){return Object.keys(e).map(t=>[t,e[t]])}const DEFAULT_EXCLUDE_KEYS=["class","style"],LISTENER_PREFIX=/^on[A-Z]+/,useAttrs=(e={})=>{const{excludeListeners:t=!1,excludeKeys:n=[]}=e,r=getCurrentInstance(),i=shallowRef({}),o=shallowRef({}),s=shallowRef({}),a=n.concat(DEFAULT_EXCLUDE_KEYS);return r.attrs=reactive(r.attrs),watchEffect(()=>{const e=entries(r.attrs).reduce((e,[n,r])=>(a.includes(n)?e.exclude[n]=r:LISTENER_PREFIX.test(n)?(t||(e.attrs[n]=r),e.listeners[n]=r):e.attrs[n]=r,e),{exclude:{},attrs:{},listeners:{}});i.value=e.attrs,o.value=e.listeners,s.value=e.exclude}),{$attrs:i,$listeners:o,$excludeAttrs:s}};function flatVNode(e){const t=[];return isArray$3(e)&&e.forEach(e=>{isVNode(e)?e.type===Fragment?t.push(...flatVNode(e.children)):t.push(e):isArray$3(e)&&t.push(...flatVNode(e))}),t}const movableAreaProps={scaleArea:{type:Boolean,default:!1}},MovableArea=defineBuiltInComponent({inheritAttrs:!1,name:"MovableArea",props:movableAreaProps,setup(e,{slots:t}){const n=ref(null),r=ref(!1);let{setContexts:i,events:o}=useMovableAreaState(e,n);const{$listeners:s,$attrs:a,$excludeAttrs:c}=useAttrs(),l=s.value;["onTouchstart","onTouchmove","onTouchend"].forEach(e=>{let t=l[e],n=o[`_${e}`];l[e]=t?[].concat(t,n):n}),onMounted(()=>{o._resize(),r.value=!0});let d=[];const u=[];function p(){const e=[];for(let t=0;t<d.length;t++){let n=d[t];n=n.el;const r=u.find(e=>n===e.rootRef.value);r&&e.push(markRaw(r))}i(e)}return provide("_isMounted",r),provide("movableAreaRootRef",n),provide("addMovableViewContext",e=>{u.push(e),p()}),provide("removeMovableViewContext",e=>{const t=u.indexOf(e);t>=0&&(u.splice(t,1),p())}),()=>{const e=t.default&&t.default();return d=flatVNode(e),createVNode("uni-movable-area",mergeProps({ref:n},a.value,c.value,l),[createVNode(ResizeSensor,{onResize:o._resize},null,8,["onResize"]),d],16)}}});function calc(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function useMovableAreaState(e,t){const n=ref(0),r=ref(0),i=reactive({x:null,y:null}),o=ref(null);let s=null,a=[];function c(e,n=a){let r=t.value;return function e(t){for(let r=0;r<n.length;r++){const e=n[r];if(t===e.rootRef.value)return e}return t===r||t===document.body||t===document?null:e(t.parentNode)}(e)}const l=withWebEvent(t=>{let n=t.touches;if(n&&n.length>1){let t={x:n[1].pageX-n[0].pageX,y:n[1].pageY-n[0].pageY};if(o.value=calc(t),i.x=t.x,i.y=t.y,!e.scaleArea){let e=c(n[0].target),t=c(n[1].target);s=e&&e===t?e:null}}}),d=withWebEvent(t=>{let n=t.touches;if(n&&n.length>1){t.preventDefault();let c={x:n[1].pageX-n[0].pageX,y:n[1].pageY-n[0].pageY};if(null!==i.x&&o.value&&o.value>0){let t=calc(c)/o.value;(r=t)&&1!==r&&(e.scaleArea?a.forEach(function(e){e._setScale(r)}):s&&s._setScale(r))}i.x=c.x,i.y=c.y}var r}),u=withWebEvent(t=>{let n=t.touches;n&&n.length||t.changedTouches&&(i.x=0,i.y=0,o.value=null,e.scaleArea?a.forEach(function(e){e._endScale()}):s&&s._endScale())});return provide("movableAreaWidth",n),provide("movableAreaHeight",r),{setContexts(e){a=e},events:{_onTouchstart:l,_onTouchmove:d,_onTouchend:u,_resize:function(){!function(){let e=window.getComputedStyle(t.value),i=t.value.getBoundingClientRect();n.value=i.width-["Left","Right"].reduce(function(t,n){const r="padding"+n;return t+parseFloat(e["border"+n+"Width"])+parseFloat(e[r])},0),r.value=i.height-["Top","Bottom"].reduce(function(t,n){const r="padding"+n;return t+parseFloat(e["border"+n+"Width"])+parseFloat(e[r])},0)}(),a.forEach(function(e,t){e.setParent()})}}}}const addListenerToElement=function(e,t,n,r){e.addEventListener(t,e=>{isFunction$2(n)&&!1===n(e)&&((void 0===e.cancelable||e.cancelable)&&e.preventDefault(),e.stopPropagation())},{passive:!1})};let __mouseMoveEventListener,__mouseUpEventListener;function useTouchtrack(e,t,n){onBeforeUnmount(()=>{document.removeEventListener("mousemove",__mouseMoveEventListener),document.removeEventListener("mouseup",__mouseUpEventListener)});let r=0,i=0,o=0,s=0;const a=function(e,n,a,c){if(!1===t({cancelable:e.cancelable,target:e.target,currentTarget:e.currentTarget,preventDefault:e.preventDefault.bind(e),stopPropagation:e.stopPropagation.bind(e),touches:e.touches,changedTouches:e.changedTouches,detail:{state:n,x:a,y:c,dx:a-r,dy:c-i,ddx:a-o,ddy:c-s,timeStamp:e.timeStamp}}))return!1};let c,l,d=null;addListenerToElement(e,"touchstart",function(e){if(c=!0,1===e.touches.length&&!d)return d=e,r=o=e.touches[0].pageX,i=s=e.touches[0].pageY,a(e,"start",r,i)}),addListenerToElement(e,"mousedown",function(e){if(l=!0,!c&&!d)return d=e,r=o=e.pageX,i=s=e.pageY,a(e,"start",r,i)}),addListenerToElement(e,"touchmove",function(e){if(1===e.touches.length&&d){const t=a(e,"move",e.touches[0].pageX,e.touches[0].pageY);return o=e.touches[0].pageX,s=e.touches[0].pageY,t}});const u=__mouseMoveEventListener=function(e){if(!c&&l&&d){const t=a(e,"move",e.pageX,e.pageY);return o=e.pageX,s=e.pageY,t}};document.addEventListener("mousemove",u),addListenerToElement(e,"touchend",function(e){if(0===e.touches.length&&d)return c=!1,d=null,a(e,"end",e.changedTouches[0].pageX,e.changedTouches[0].pageY)});const p=__mouseUpEventListener=function(e){if(l=!1,!c&&d)return d=null,a(e,"end",e.pageX,e.pageY)};document.addEventListener("mouseup",p),addListenerToElement(e,"touchcancel",function(e){if(d){c=!1;const t=d;return d=null,a(e,n?"cancel":"end",t.touches[0].pageX,t.touches[0].pageY)}})}function e(e,t,n){return e>t-n&&e<t+n}function t$2(t,n){return e(t,0,n)}function Decline(){}function Friction$1(e,t){this._m=e,this._f=1e3*t,this._startTime=0,this._v=0}function Spring$1(e,t,n){this._m=e,this._k=t,this._c=n,this._solution=null,this._endPosition=0,this._startTime=0}function STD(e,t,n){this._springX=new Spring$1(e,t,n),this._springY=new Spring$1(e,t,n),this._springScale=new Spring$1(e,t,n),this._startTime=0}Decline.prototype.x=function(e){return Math.sqrt(e)},Friction$1.prototype.setV=function(e,t){const n=Math.pow(Math.pow(e,2)+Math.pow(t,2),.5);this._x_v=e,this._y_v=t,this._x_a=-this._f*this._x_v/n,this._y_a=-this._f*this._y_v/n,this._t=Math.abs(e/this._x_a)||Math.abs(t/this._y_a),this._lastDt=null,this._startTime=(new Date).getTime()},Friction$1.prototype.setS=function(e,t){this._x_s=e,this._y_s=t},Friction$1.prototype.s=function(e){void 0===e&&(e=((new Date).getTime()-this._startTime)/1e3),e>this._t&&(e=this._t,this._lastDt=e);let t=this._x_v*e+.5*this._x_a*Math.pow(e,2)+this._x_s,n=this._y_v*e+.5*this._y_a*Math.pow(e,2)+this._y_s;return(this._x_a>0&&t<this._endPositionX||this._x_a<0&&t>this._endPositionX)&&(t=this._endPositionX),(this._y_a>0&&n<this._endPositionY||this._y_a<0&&n>this._endPositionY)&&(n=this._endPositionY),{x:t,y:n}},Friction$1.prototype.ds=function(e){return void 0===e&&(e=((new Date).getTime()-this._startTime)/1e3),e>this._t&&(e=this._t),{dx:this._x_v+this._x_a*e,dy:this._y_v+this._y_a*e}},Friction$1.prototype.delta=function(){return{x:-1.5*Math.pow(this._x_v,2)/this._x_a||0,y:-1.5*Math.pow(this._y_v,2)/this._y_a||0}},Friction$1.prototype.dt=function(){return-this._x_v/this._x_a},Friction$1.prototype.done=function(){const t=e(this.s().x,this._endPositionX)||e(this.s().y,this._endPositionY)||this._lastDt===this._t;return this._lastDt=null,t},Friction$1.prototype.setEnd=function(e,t){this._endPositionX=e,this._endPositionY=t},Friction$1.prototype.reconfigure=function(e,t){this._m=e,this._f=1e3*t},Spring$1.prototype._solve=function(e,t){const n=this._c,r=this._m,i=this._k,o=n*n-4*r*i;if(0===o){const i=-n/(2*r),o=e,s=t/(i*e);return{x:function(e){return(o+s*e)*Math.pow(Math.E,i*e)},dx:function(e){const t=Math.pow(Math.E,i*e);return i*(o+s*e)*t+s*t}}}if(o>0){const i=(-n-Math.sqrt(o))/(2*r),s=(-n+Math.sqrt(o))/(2*r),a=(t-i*e)/(s-i),c=e-a;return{x:function(e){let t,n;return e===this._t&&(t=this._powER1T,n=this._powER2T),this._t=e,t||(t=this._powER1T=Math.pow(Math.E,i*e)),n||(n=this._powER2T=Math.pow(Math.E,s*e)),c*t+a*n},dx:function(e){let t,n;return e===this._t&&(t=this._powER1T,n=this._powER2T),this._t=e,t||(t=this._powER1T=Math.pow(Math.E,i*e)),n||(n=this._powER2T=Math.pow(Math.E,s*e)),c*i*t+a*s*n}}}const s=Math.sqrt(4*r*i-n*n)/(2*r),a=-n/2*r,c=e,l=(t-a*e)/s;return{x:function(e){return Math.pow(Math.E,a*e)*(c*Math.cos(s*e)+l*Math.sin(s*e))},dx:function(e){const t=Math.pow(Math.E,a*e),n=Math.cos(s*e),r=Math.sin(s*e);return t*(l*s*n-c*s*r)+a*t*(l*r+c*n)}}},Spring$1.prototype.x=function(e){return void 0===e&&(e=((new Date).getTime()-this._startTime)/1e3),this._solution?this._endPosition+this._solution.x(e):0},Spring$1.prototype.dx=function(e){return void 0===e&&(e=((new Date).getTime()-this._startTime)/1e3),this._solution?this._solution.dx(e):0},Spring$1.prototype.setEnd=function(e,t,n){if(n||(n=(new Date).getTime()),e!==this._endPosition||!t$2(t,.1)){t=t||0;let r=this._endPosition;this._solution&&(t$2(t,.1)&&(t=this._solution.dx((n-this._startTime)/1e3)),r=this._solution.x((n-this._startTime)/1e3),t$2(t,.1)&&(t=0),t$2(r,.1)&&(r=0),r+=this._endPosition),this._solution&&t$2(r-e,.1)&&t$2(t,.1)||(this._endPosition=e,this._solution=this._solve(r-this._endPosition,t),this._startTime=n)}},Spring$1.prototype.snap=function(e){this._startTime=(new Date).getTime(),this._endPosition=e,this._solution={x:function(){return 0},dx:function(){return 0}}},Spring$1.prototype.done=function(t){return t||(t=(new Date).getTime()),e(this.x(),this._endPosition,.1)&&t$2(this.dx(),.1)},Spring$1.prototype.reconfigure=function(e,t,n){this._m=e,this._k=t,this._c=n,this.done()||(this._solution=this._solve(this.x()-this._endPosition,this.dx()),this._startTime=(new Date).getTime())},Spring$1.prototype.springConstant=function(){return this._k},Spring$1.prototype.damping=function(){return this._c},Spring$1.prototype.configuration=function(){return[{label:"Spring Constant",read:this.springConstant.bind(this),write:function(e,t){e.reconfigure(1,t,e.damping())}.bind(this,this),min:100,max:1e3},{label:"Damping",read:this.damping.bind(this),write:function(e,t){e.reconfigure(1,e.springConstant(),t)}.bind(this,this),min:1,max:500}]},STD.prototype.setEnd=function(e,t,n,r){const i=(new Date).getTime();this._springX.setEnd(e,r,i),this._springY.setEnd(t,r,i),this._springScale.setEnd(n,r,i),this._startTime=i},STD.prototype.x=function(){const e=((new Date).getTime()-this._startTime)/1e3;return{x:this._springX.x(e),y:this._springY.x(e),scale:this._springScale.x(e)}},STD.prototype.done=function(){const e=(new Date).getTime();return this._springX.done(e)&&this._springY.done(e)&&this._springScale.done(e)},STD.prototype.reconfigure=function(e,t,n){this._springX.reconfigure(e,t,n),this._springY.reconfigure(e,t,n),this._springScale.reconfigure(e,t,n)};const movableViewProps={direction:{type:String,default:"none"},inertia:{type:[Boolean,String],default:!1},outOfBounds:{type:[Boolean,String],default:!1},x:{type:[Number,String],default:0},y:{type:[Number,String],default:0},damping:{type:[Number,String],default:20},friction:{type:[Number,String],default:2},disabled:{type:[Boolean,String],default:!1},scale:{type:[Boolean,String],default:!1},scaleMin:{type:[Number,String],default:.1},scaleMax:{type:[Number,String],default:10},scaleValue:{type:[Number,String],default:1},animation:{type:[Boolean,String],default:!0}};function v(e,t){return+((1e3*e-1e3*t)/1e3).toFixed(1)}const MovableView=defineBuiltInComponent({name:"MovableView",props:movableViewProps,emits:["change","scale"],setup(e,{slots:t,emit:n}){const r=ref(null),i=useCustomEvent(r,n),{setParent:o}=useMovableViewState(e,i,r);return()=>createVNode("uni-movable-view",{ref:r},[createVNode(ResizeSensor,{onResize:o},null,8,["onResize"]),t.default&&t.default()],512)}});let requesting=!1;function _requestAnimationFrame(e){requesting||(requesting=!0,requestAnimationFrame(function(){e(),requesting=!1}))}function p(e,t){if(e===t)return 0;let n=e.offsetLeft;return e.offsetParent?n+=p(e.offsetParent,t):0}function f(e,t){if(e===t)return 0;let n=e.offsetTop;return e.offsetParent?n+=f(e.offsetParent,t):0}function g$1(e,t,n){let r={id:0,cancelled:!1};return function e(t,n,r,i){if(!t||!t.cancelled){r(n);let o=n.done();o||t.cancelled||(t.id=requestAnimationFrame(e.bind(null,t,n,r,i))),o&&i&&i(n)}}(r,e,t,n),{cancel:function(e){e&&e.id&&cancelAnimationFrame(e.id),e&&(e.cancelled=!0)}.bind(null,r),model:e}}function _getPx(e){return/\d+[ur]px$/i.test(e)?uni.upx2px(parseFloat(e)):Number(e)||0}function useMovableViewLayout(e,t,n){const r=inject("movableAreaWidth",ref(0)),i=inject("movableAreaHeight",ref(0)),o=inject("movableAreaRootRef"),s={x:0,y:0},a={x:0,y:0},c=ref(0),l=ref(0),d=ref(0),u=ref(0),h=ref(0),g=ref(0);return{_updateBoundary:function(){let e=0-s.x+a.x,t=r.value-c.value-s.x-a.x;d.value=Math.min(e,t),h.value=Math.max(e,t);let n=0-s.y+a.y,o=i.value-l.value-s.y-a.y;u.value=Math.min(n,o),g.value=Math.max(n,o)},_updateOffset:function(){s.x=p(e.value,o.value),s.y=f(e.value,o.value)},_updateWH:function(r){r=r||t.value,r=n(r);let i=e.value.getBoundingClientRect();l.value=i.height/t.value,c.value=i.width/t.value;let o=l.value*r,s=c.value*r;a.x=(s-c.value)/2,a.y=(o-l.value)/2},_scaleOffset:a,minX:d,minY:u,maxX:h,maxY:g}}function useMovableViewTransform(e,t,n,r,i,o,s,a,c,l,d,u,p,h){const g=computed$2(()=>{let e=Number(t.damping);return isNaN(e)?20:e}),m=computed$2(()=>"all"===t.direction||"horizontal"===t.direction),f=computed$2(()=>"all"===t.direction||"vertical"===t.direction),y=ref(_getPx(t.x)),_=ref(_getPx(t.y));watch(()=>t.x,e=>{y.value=_getPx(e)}),watch(()=>t.y,e=>{_.value=_getPx(e)}),watch(y,e=>{!function(e){if(m.value){if(e+n.x===c.value)return c;d&&d.cancel(),E(e+n.x,_.value+n.y,r.value)}}(e)}),watch(_,e=>{!function(e){if(f.value){if(e+n.y===l.value)return l;d&&d.cancel(),E(y.value+n.x,e+n.y,r.value)}}(e)});const I=new STD(1,9*Math.pow(g.value,2)/40,g.value);function T(e,t){let n=!1;return e>i.value?(e=i.value,n=!0):e<s.value&&(e=s.value,n=!0),t>o.value?(t=o.value,n=!0):t<a.value&&(t=a.value,n=!0),{x:e,y:t,outOfBounds:n}}function S(){u&&u.cancel(),d&&d.cancel()}function E(e,n,i,o,s,a){S(),m.value||(e=c.value),f.value||(n=l.value),t.scale||(i=r.value);let u=T(e,n);e=u.x,n=u.y,t.animation?(I._springX._solution=null,I._springY._solution=null,I._springScale._solution=null,I._springX._endPosition=c.value,I._springY._endPosition=l.value,I._springScale._endPosition=r.value,I.setEnd(e,n,i,1),d=g$1(I,function(){let e=I.x();M(e.x,e.y,e.scale,o,s,a)},function(){d.cancel()})):M(e,n,i,o,s,a)}function M(i,o,s,a="",d,u){null!==i&&"NaN"!==i.toString()&&"number"==typeof i||(i=c.value||0),null!==o&&"NaN"!==o.toString()&&"number"==typeof o||(o=l.value||0),i=Number(i.toFixed(1)),o=Number(o.toFixed(1)),s=Number(s.toFixed(1)),c.value===i&&l.value===o||d||h("change",{},{x:v(i,n.x),y:v(o,n.y),source:a}),t.scale||(s=r.value),s=+(s=p(s)).toFixed(3),u&&s!==r.value&&h("scale",{},{x:i,y:o,scale:s});let g="translateX("+i+"px) translateY("+o+"px) translateZ(0px) scale("+s+")";e.value&&(e.value.style.transform=g,e.value.style.webkitTransform=g,c.value=i,l.value=o,r.value=s)}return{FAandSFACancel:S,_getLimitXY:T,_animationTo:E,_setTransform:M,_revise:function(e){let t=T(c.value,l.value),n=t.x,i=t.y,o=t.outOfBounds;return o&&E(n,i,r.value,e),o},dampingNumber:g,xMove:m,yMove:f,xSync:y,ySync:_,_STD:I}}function useMovableViewInit(e,t,n,r,i,o,s,a,c,l){const d=computed$2(()=>{let t=Number(e.scaleMin);return isNaN(t)?.1:t}),u=computed$2(()=>{let t=Number(e.scaleMax);return isNaN(t)?10:t}),p=ref(Number(e.scaleValue)||1);watch(p,t=>{!function(t){if(!e.scale)return!1;P(t=L(t),!0),k(t)}(t)}),watch(d,()=>{x()}),watch(u,()=>{x()}),watch(()=>e.scaleValue,e=>{p.value=Number(e)||0});const{_updateBoundary:h,_updateOffset:g,_updateWH:m,_scaleOffset:f,minX:v,minY:y,maxX:_,maxY:I}=useMovableViewLayout(t,r,L),{FAandSFACancel:T,_getLimitXY:S,_animationTo:E,_setTransform:M,_revise:b,dampingNumber:C,xMove:A,yMove:O,xSync:R,ySync:N,_STD:w}=useMovableViewTransform(t,e,f,r,_,I,v,y,s,a,c,l,L,n);function P(t,n){if(e.scale){t=L(t),m(t),h();const e=S(s.value,a.value),r=e.x,i=e.y;n?E(r,i,t,"",!0,!0):_requestAnimationFrame(function(){M(r,i,t,"",!0,!0)})}}function k(e){i.value=e}function L(e){return e=Math.max(.1,d.value,e),e=Math.min(10,u.value,e)}function x(){if(!e.scale)return!1;P(r.value,!0),k(r.value)}return{_updateOldScale:k,_endScale:function(){o.value=!1,k(r.value)},_setScale:function(e){e&&(e=i.value*e,o.value=!0,P(e))},scaleValueSync:p,_updateBoundary:h,_updateOffset:g,_updateWH:m,_scaleOffset:f,minX:v,minY:y,maxX:_,maxY:I,FAandSFACancel:T,_getLimitXY:S,_animationTo:E,_setTransform:M,_revise:b,dampingNumber:C,xMove:A,yMove:O,xSync:R,ySync:N,_STD:w}}function useMovableViewState(e,t,n){const r=inject("_isMounted",ref(!1)),i=inject("addMovableViewContext",()=>{}),o=inject("removeMovableViewContext",()=>{});let s,a,c=ref(1),l=ref(1),d=ref(!1),u=ref(0),p=ref(0),h=null,g=!1,m=null,f=null;const v=new Decline,y=new Decline,_={historyX:[0,0],historyY:[0,0],historyT:[0,0]},I=computed$2(()=>{let t=Number(e.friction);return isNaN(t)||t<=0?2:t}),T=new Friction$1(1,I.value);watch(()=>e.disabled,()=>{G()});const{_updateOldScale:S,_endScale:E,_setScale:M,scaleValueSync:b,_updateBoundary:C,_updateOffset:A,_updateWH:O,_scaleOffset:R,minX:N,minY:w,maxX:P,maxY:k,FAandSFACancel:L,_getLimitXY:x,_setTransform:V,_revise:D,dampingNumber:U,xMove:$,yMove:B,xSync:F,ySync:j,_STD:q}=useMovableViewInit(e,n,t,c,l,d,u,p,null,h);function G(){d.value||e.disabled||(L(),_.historyX=[0,0],_.historyY=[0,0],_.historyT=[0,0],$.value&&(s=u.value),B.value&&(a=p.value),n.value.style.willChange="transform",m=null,f=null,g=!0)}function H(){if(!r.value)return;L();let t=e.scale?b.value:1;A(),O(t),C();let n=x(F.value+R.x,j.value+R.y),i=n.x,o=n.y;V(i,o,t,"",!0),S(t)}return onMounted(()=>{useTouchtrack(n.value,t=>{switch(t.detail.state){case"start":G();break;case"move":!function(t){if(!d.value&&!e.disabled&&g){let n=u.value,r=p.value;if(null===f&&(f=Math.abs(t.detail.dx/t.detail.dy)>1?"htouchmove":"vtouchmove"),$.value&&(n=t.detail.dx+s,_.historyX.shift(),_.historyX.push(n),B.value||null!==m||(m=Math.abs(t.detail.dx/t.detail.dy)<1)),B.value&&(r=t.detail.dy+a,_.historyY.shift(),_.historyY.push(r),$.value||null!==m||(m=Math.abs(t.detail.dy/t.detail.dx)<1)),_.historyT.shift(),_.historyT.push(t.detail.timeStamp),!m){t.preventDefault();let i="touch";n<N.value?e.outOfBounds?(i="touch-out-of-bounds",n=N.value-v.x(N.value-n)):n=N.value:n>P.value&&(e.outOfBounds?(i="touch-out-of-bounds",n=P.value+v.x(n-P.value)):n=P.value),r<w.value?e.outOfBounds?(i="touch-out-of-bounds",r=w.value-y.x(w.value-r)):r=w.value:r>k.value&&(e.outOfBounds?(i="touch-out-of-bounds",r=k.value+y.x(r-k.value)):r=k.value),_requestAnimationFrame(function(){V(n,r,c.value,i)})}}}(t);break;case"end":!function(){if(!d.value&&!e.disabled&&g&&(n.value.style.willChange="auto",g=!1,!m&&!D("out-of-bounds")&&e.inertia)){const e=1e3*(_.historyX[1]-_.historyX[0])/(_.historyT[1]-_.historyT[0]),t=1e3*(_.historyY[1]-_.historyY[0])/(_.historyT[1]-_.historyT[0]),n=u.value,r=p.value;T.setV(e,t),T.setS(n,r);const i=T.delta().x,o=T.delta().y;let s=i+n,a=o+r;s<N.value?(s=N.value,a=r+(N.value-n)*o/i):s>P.value&&(s=P.value,a=r+(P.value-n)*o/i),a<w.value?(a=w.value,s=n+(w.value-r)*i/o):a>k.value&&(a=k.value,s=n+(k.value-r)*i/o),T.setEnd(s,a),h=g$1(T,function(){let e=T.s(),t=e.x,n=e.y;V(t,n,c.value,"friction")},function(){h.cancel()})}e.outOfBounds||e.inertia||L()}()}}),H(),T.reconfigure(1,I.value),q.reconfigure(1,9*Math.pow(U.value,2)/40,U.value),n.value.style.transformOrigin="center";const t={rootRef:n,setParent:H,_endScale:E,_setScale:M};i(t),onUnmounted(()=>{o(t)})}),onUnmounted(()=>{L()}),{setParent:H}}const pickerViewProps={value:{type:Array,default:()=>[],validator:function(e){return isArray$3(e)&&e.filter(e=>"number"==typeof e).length===e.length}},indicatorStyle:{type:String,default:""},indicatorClass:{type:String,default:""},maskStyle:{type:String,default:""},maskClass:{type:String,default:""}};function useState$4(e){const t=reactive([...e.value]),n=reactive({value:t,height:34});return watch(()=>e.value,(e,t)=>{n.value.length=e.length,e.forEach((e,t)=>{e!==n.value[t]&&n.value.splice(t,1,e)})}),n}const PickerView=defineBuiltInComponent({name:"PickerView",props:pickerViewProps,emits:["change","pickstart","pickend","update:value"],setup(e,{slots:t,emit:n}){const r=ref(null),i=ref(null),o=useCustomEvent(r,n),s=useState$4(e),a=ref(null);onMounted(()=>{const e=a.value;e&&(s.height=e.$el.offsetHeight)});let c=ref([]),l=ref([]);function d(e){let t=l.value;t=t.filter(e=>e.type!==Comment);let n=t.indexOf(e);return-1!==n?n:c.value.indexOf(e)}return provide("getPickerViewColumn",function(e){return computed$2({get(){const t=d(e.vnode);return s.value[t]||0},set(t){const r=d(e.vnode);if(r<0)return;if(s.value[r]!==t){s.value[r]=t;const e=s.value.map(e=>e);n("update:value",e),o("change",{},{value:e})}}})}),provide("pickerViewProps",e),provide("pickerViewState",s),()=>{const e=t.default&&t.default();{const t=flatVNode(e);c.value=t,nextTick(()=>{l.value=t})}return createVNode("uni-picker-view",{ref:r},[createVNode(ResizeSensor,{ref:a,onResize:({height:e})=>s.height=e},null,8,["onResize"]),createVNode("div",{ref:i,class:"uni-picker-view-wrapper"},[e],512)],512)}}});class Friction{constructor(e){this._drag=e,this._dragLog=Math.log(e),this._x=0,this._v=0,this._startTime=0}set(e,t){this._x=e,this._v=t,this._startTime=(new Date).getTime()}setVelocityByEnd(e){this._v=(e-this._x)*this._dragLog/(Math.pow(this._drag,100)-1)}x(e){void 0===e&&(e=((new Date).getTime()-this._startTime)/1e3);const t=e===this._dt&&this._powDragDt?this._powDragDt:this._powDragDt=Math.pow(this._drag,e);return this._dt=e,this._x+this._v*t/this._dragLog-this._v/this._dragLog}dx(e){void 0===e&&(e=((new Date).getTime()-this._startTime)/1e3);const t=e===this._dt&&this._powDragDt?this._powDragDt:this._powDragDt=Math.pow(this._drag,e);return this._dt=e,this._v*t}done(){return Math.abs(this.dx())<3}reconfigure(e){const t=this.x(),n=this.dx();this._drag=e,this._dragLog=Math.log(e),this.set(t,n)}configuration(){const e=this;return[{label:"Friction",read:function(){return e._drag},write:function(t){e.reconfigure(t)},min:.001,max:.1,step:.001}]}}function o$1(e,t,n){return e>t-n&&e<t+n}function a$1(e,t){return o$1(e,0,t)}class Spring{constructor(e,t,n){this._m=e,this._k=t,this._c=n,this._solution=null,this._endPosition=0,this._startTime=0}_solve(e,t){const n=this._c,r=this._m,i=this._k,o=n*n-4*r*i;if(0===o){const i=-n/(2*r),o=e,s=t/(i*e);return{x:function(e){return(o+s*e)*Math.pow(Math.E,i*e)},dx:function(e){const t=Math.pow(Math.E,i*e);return i*(o+s*e)*t+s*t}}}if(o>0){const i=(-n-Math.sqrt(o))/(2*r),s=(-n+Math.sqrt(o))/(2*r),a=(t-i*e)/(s-i),c=e-a;return{x:function(e){let t,n;return e===this._t&&(t=this._powER1T,n=this._powER2T),this._t=e,t||(t=this._powER1T=Math.pow(Math.E,i*e)),n||(n=this._powER2T=Math.pow(Math.E,s*e)),c*t+a*n},dx:function(e){let t,n;return e===this._t&&(t=this._powER1T,n=this._powER2T),this._t=e,t||(t=this._powER1T=Math.pow(Math.E,i*e)),n||(n=this._powER2T=Math.pow(Math.E,s*e)),c*i*t+a*s*n}}}const s=Math.sqrt(4*r*i-n*n)/(2*r),a=-n/2*r,c=e,l=(t-a*e)/s;return{x:function(e){return Math.pow(Math.E,a*e)*(c*Math.cos(s*e)+l*Math.sin(s*e))},dx:function(e){const t=Math.pow(Math.E,a*e),n=Math.cos(s*e),r=Math.sin(s*e);return t*(l*s*n-c*s*r)+a*t*(l*r+c*n)}}}x(e){return void 0===e&&(e=((new Date).getTime()-this._startTime)/1e3),this._solution?this._endPosition+this._solution.x(e):0}dx(e){return void 0===e&&(e=((new Date).getTime()-this._startTime)/1e3),this._solution?this._solution.dx(e):0}setEnd(e,t,n){if(n||(n=(new Date).getTime()),e!==this._endPosition||!a$1(t,.4)){t=t||0;let r=this._endPosition;this._solution&&(a$1(t,.4)&&(t=this._solution.dx((n-this._startTime)/1e3)),r=this._solution.x((n-this._startTime)/1e3),a$1(t,.4)&&(t=0),a$1(r,.4)&&(r=0),r+=this._endPosition),this._solution&&a$1(r-e,.4)&&a$1(t,.4)||(this._endPosition=e,this._solution=this._solve(r-this._endPosition,t),this._startTime=n)}}snap(e){this._startTime=(new Date).getTime(),this._endPosition=e,this._solution={x:function(){return 0},dx:function(){return 0}}}done(e){return e||(e=(new Date).getTime()),o$1(this.x(),this._endPosition,.4)&&a$1(this.dx(),.4)}reconfigure(e,t,n){this._m=e,this._k=t,this._c=n,this.done()||(this._solution=this._solve(this.x()-this._endPosition,this.dx()),this._startTime=(new Date).getTime())}springConstant(){return this._k}damping(){return this._c}configuration(){return[{label:"Spring Constant",read:this.springConstant.bind(this),write:function(e,t){e.reconfigure(1,t,e.damping())}.bind(this,this),min:100,max:1e3},{label:"Damping",read:this.damping.bind(this),write:function(e,t){e.reconfigure(1,e.springConstant(),t)}.bind(this,this),min:1,max:500}]}}class Scroll{constructor(e,t,n){this._extent=e,this._friction=t||new Friction(.01),this._spring=n||new Spring(1,90,20),this._startTime=0,this._springing=!1,this._springOffset=0}snap(e,t){this._springOffset=0,this._springing=!0,this._spring.snap(e),this._spring.setEnd(t)}set(e,t){this._friction.set(e,t),e>0&&t>=0?(this._springOffset=0,this._springing=!0,this._spring.snap(e),this._spring.setEnd(0)):e<-this._extent&&t<=0?(this._springOffset=0,this._springing=!0,this._spring.snap(e),this._spring.setEnd(-this._extent)):this._springing=!1,this._startTime=(new Date).getTime()}x(e){if(!this._startTime)return 0;if(e||(e=((new Date).getTime()-this._startTime)/1e3),this._springing)return this._spring.x()+this._springOffset;let t=this._friction.x(e),n=this.dx(e);return(t>0&&n>=0||t<-this._extent&&n<=0)&&(this._springing=!0,this._spring.setEnd(0,n),t<-this._extent?this._springOffset=-this._extent:this._springOffset=0,t=this._spring.x()+this._springOffset),t}dx(e){let t;return t=this._lastTime===e?this._lastDx:this._springing?this._spring.dx(e):this._friction.dx(e),this._lastTime=e,this._lastDx=t,t}done(){return this._springing?this._spring.done():this._friction.done()}setVelocityByEnd(e){this._friction.setVelocityByEnd(e)}configuration(){const e=this._friction.configuration();return e.push.apply(e,this._spring.configuration()),e}}function createAnimation(e,t,n){const r={id:0,cancelled:!1};return function e(t,n,r,i){if(!t||!t.cancelled){r(n);const o=n.done();o||t.cancelled||(t.id=requestAnimationFrame(e.bind(null,t,n,r,i))),o&&i&&i(n)}}(r,e,t,n),{cancel:function(e){e&&e.id&&cancelAnimationFrame(e.id),e&&(e.cancelled=!0)}.bind(null,r),model:e}}class Scroller{constructor(e,t){t=t||{},this._element=e,this._options=t,this._enableSnap=t.enableSnap||!1,this._itemSize=t.itemSize||0,this._enableX=t.enableX||!1,this._enableY=t.enableY||!1,this._shouldDispatchScrollEvent=!!t.onScroll,this._enableX?(this._extent=(t.scrollWidth||this._element.offsetWidth)-this._element.parentElement.offsetWidth,this._scrollWidth=t.scrollWidth):(this._extent=(t.scrollHeight||this._element.offsetHeight)-this._element.parentElement.offsetHeight,this._scrollHeight=t.scrollHeight),this._position=0,this._scroll=new Scroll(this._extent,t.friction,t.spring),this._onTransitionEnd=this.onTransitionEnd.bind(this),this.updatePosition()}onTouchStart(){this._startPosition=this._position,this._lastChangePos=this._startPosition,this._startPosition>0?this._startPosition/=.5:this._startPosition<-this._extent&&(this._startPosition=(this._startPosition+this._extent)/.5-this._extent),this._animation&&(this._animation.cancel(),this._scrolling=!1),this.updatePosition()}onTouchMove(e,t){let n=this._startPosition;this._enableX?n+=e:this._enableY&&(n+=t),n>0?n*=.5:n<-this._extent&&(n=.5*(n+this._extent)-this._extent),this._position=n,this.updatePosition(),this.dispatchScroll()}onTouchEnd(e,t,n){if(this._enableSnap&&this._position>-this._extent&&this._position<0){if(this._enableY&&(Math.abs(t)<this._itemSize&&Math.abs(n.y)<300||Math.abs(n.y)<150))return void this.snap();if(this._enableX&&(Math.abs(e)<this._itemSize&&Math.abs(n.x)<300||Math.abs(n.x)<150))return void this.snap()}let r;if(this._enableX?this._scroll.set(this._position,n.x):this._enableY&&this._scroll.set(this._position,n.y),this._enableSnap){const e=this._scroll._friction.x(100),t=e%this._itemSize;r=Math.abs(t)>this._itemSize/2?e-(this._itemSize-Math.abs(t)):e-t,r<=0&&r>=-this._extent&&this._scroll.setVelocityByEnd(r)}this._lastTime=Date.now(),this._lastDelay=0,this._scrolling=!0,this._lastChangePos=this._position,this._lastIdx=Math.floor(Math.abs(this._position/this._itemSize)),this._animation=createAnimation(this._scroll,()=>{const e=Date.now(),t=(e-this._scroll._startTime)/1e3,n=this._scroll.x(t);this._position=n,this.updatePosition();const r=this._scroll.dx(t);this._shouldDispatchScrollEvent&&e-this._lastTime>this._lastDelay&&(this.dispatchScroll(),this._lastDelay=Math.abs(2e3/r),this._lastTime=e)},()=>{this._enableSnap&&(r<=0&&r>=-this._extent&&(this._position=r,this.updatePosition()),isFunction$2(this._options.onSnap)&&this._options.onSnap(Math.floor(Math.abs(this._position)/this._itemSize))),this._shouldDispatchScrollEvent&&this.dispatchScroll(),this._scrolling=!1})}onTransitionEnd(){this._element.style.webkitTransition="",this._element.style.transition="",this._element.removeEventListener("transitionend",this._onTransitionEnd),this._snapping&&(this._snapping=!1),this.dispatchScroll()}snap(){const e=this._itemSize,t=this._position%e,n=Math.abs(t)>this._itemSize/2?this._position-(e-Math.abs(t)):this._position-t;this._position!==n&&(this._snapping=!0,this.scrollTo(-n),isFunction$2(this._options.onSnap)&&this._options.onSnap(Math.floor(Math.abs(this._position)/this._itemSize)))}scrollTo(e,t){this._animation&&(this._animation.cancel(),this._scrolling=!1),"number"==typeof e&&(this._position=-e),this._position<-this._extent?this._position=-this._extent:this._position>0&&(this._position=0);const n="transform "+(t||.2)+"s ease-out";this._element.style.webkitTransition="-webkit-"+n,this._element.style.transition=n,this.updatePosition(),this._element.addEventListener("transitionend",this._onTransitionEnd)}dispatchScroll(){if(isFunction$2(this._options.onScroll)&&Math.round(Number(this._lastPos))!==Math.round(this._position)){this._lastPos=this._position;const e={target:{scrollLeft:this._enableX?-this._position:0,scrollTop:this._enableY?-this._position:0,scrollHeight:this._scrollHeight||this._element.offsetHeight,scrollWidth:this._scrollWidth||this._element.offsetWidth,offsetHeight:this._element.parentElement.offsetHeight,offsetWidth:this._element.parentElement.offsetWidth}};this._options.onScroll(e)}}update(e,t,n){let r=0;const i=this._position;this._enableX?(r=this._element.childNodes.length?(t||this._element.offsetWidth)-this._element.parentElement.offsetWidth:0,this._scrollWidth=t):(r=this._element.childNodes.length?(t||this._element.offsetHeight)-this._element.parentElement.offsetHeight:0,this._scrollHeight=t),"number"==typeof e&&(this._position=-e),this._position<-r?this._position=-r:this._position>0&&(this._position=0),this._itemSize=n||this._itemSize,this.updatePosition(),i!==this._position&&(this.dispatchScroll(),isFunction$2(this._options.onSnap)&&this._options.onSnap(Math.floor(Math.abs(this._position)/this._itemSize))),this._extent=r,this._scroll._extent=r}updatePosition(){let e="";this._enableX?e="translateX("+this._position+"px) translateZ(0)":this._enableY&&(e="translateY("+this._position+"px) translateZ(0)"),this._element.style.webkitTransform=e,this._element.style.transform=e}isScrolling(){return this._scrolling||this._snapping}}function useScroller(e,t){const n={trackingID:-1,maxDy:0,maxDx:0},r=new Scroller(e,t);function i(e){const t=e,r=e;return"move"===t.detail.state||"end"===t.detail.state?{x:t.detail.dx,y:t.detail.dy}:{x:r.screenX-n.x,y:r.screenY-n.y}}return{scroller:r,handleTouchStart:function(e){const t=e,i=e;"start"===t.detail.state?(n.trackingID="touch",n.x=t.detail.x,n.y=t.detail.y):(n.trackingID="mouse",n.x=i.screenX,n.y=i.screenY),n.maxDx=0,n.maxDy=0,n.historyX=[0],n.historyY=[0],n.historyTime=[t.detail.timeStamp||i.timeStamp],n.listener=r,r.onTouchStart&&r.onTouchStart(),("boolean"!=typeof e.cancelable||e.cancelable)&&e.preventDefault()},handleTouchMove:function(e){const t=e,r=e;if(-1!==n.trackingID){("boolean"!=typeof e.cancelable||e.cancelable)&&e.preventDefault();const o=i(e);if(o){for(n.maxDy=Math.max(n.maxDy,Math.abs(o.y)),n.maxDx=Math.max(n.maxDx,Math.abs(o.x)),n.historyX.push(o.x),n.historyY.push(o.y),n.historyTime.push(t.detail.timeStamp||r.timeStamp);n.historyTime.length>10;)n.historyTime.shift(),n.historyX.shift(),n.historyY.shift();n.listener&&n.listener.onTouchMove&&n.listener.onTouchMove(o.x,o.y)}}},handleTouchEnd:function(e){if(-1!==n.trackingID){e.preventDefault();const t=i(e);if(t){const e=n.listener;n.trackingID=-1,n.listener=null;const r={x:0,y:0};if(n.historyTime.length>2)for(let t=n.historyTime.length-1,i=n.historyTime[t],o=n.historyX[t],s=n.historyY[t];t>0;){t--;const e=i-n.historyTime[t];if(e>30&&e<50){r.x=(o-n.historyX[t])/(e/1e3),r.y=(s-n.historyY[t])/(e/1e3);break}}n.historyTime=[],n.historyX=[],n.historyY=[],e&&e.onTouchEnd&&e.onTouchEnd(t.x,t.y,r)}}}}}function useCustomClick(e){let t=0,n=0;e.addEventListener("touchstart",e=>{const r=e.changedTouches[0];t=r.clientX,n=r.clientY}),e.addEventListener("touchend",e=>{const r=e.changedTouches[0];if(Math.abs(r.clientX-t)<20&&Math.abs(r.clientY-n)<20){const t={bubbles:!0,cancelable:!0,target:e.target,currentTarget:e.currentTarget},n=new CustomEvent("click",t);["screenX","screenY","clientX","clientY","pageX","pageY"].forEach(e=>{n[e]=r[e]}),e.target.dispatchEvent(n)}})}const PickerViewColumn=defineBuiltInComponent({name:"PickerViewColumn",setup(e,{slots:t,emit:n}){const r=ref(null),i=ref(null),o=inject("getPickerViewColumn"),s=getCurrentInstance(),a=o?o(s):ref(0),c=inject("pickerViewProps"),l=inject("pickerViewState"),d=ref(34),u=ref(null);onMounted(()=>{const e=u.value;d.value=e.$el.offsetHeight});const p=computed$2(()=>(l.height-d.value)/2),{state:h}=useScopedAttrs();let g;const m=reactive({current:a.value,length:0});let f;function v(){g&&!f&&(f=!0,nextTick(()=>{f=!1;let e=Math.min(m.current,m.length-1);e=Math.max(e,0),g.update(e*d.value,void 0,d.value)}))}watch(()=>a.value,e=>{e!==m.current&&(m.current=e,v())}),watch(()=>m.current,e=>a.value=e),watch([()=>d.value,()=>m.length,()=>l.height],v);let y=0;function _(e){const t=y+e.deltaY;if(Math.abs(t)>10){y=0;let e=Math.min(m.current+(t<0?-1:1),m.length-1);m.current=e=Math.max(e,0),g.scrollTo(e*d.value)}else y=t;e.preventDefault()}function I({clientY:e}){const t=r.value;if(!g.isScrolling()){const n=e-t.getBoundingClientRect().top-l.height/2,r=d.value/2;if(!(Math.abs(n)<=r)){const e=Math.ceil((Math.abs(n)-r)/d.value),t=n<0?-e:e;let i=Math.min(m.current+t,m.length-1);m.current=i=Math.max(i,0),g.scrollTo(i*d.value)}}}return onMounted(()=>{const e=r.value,t=i.value,{scroller:n,handleTouchStart:o,handleTouchMove:s,handleTouchEnd:a}=useScroller(t,{enableY:!0,enableX:!1,enableSnap:!0,itemSize:d.value,friction:new Friction(1e-4),spring:new Spring(2,90,20),onSnap:e=>{isNaN(e)||e===m.current||(m.current=e)}});g=n,useTouchtrack(e,e=>{switch(e.detail.state){case"start":o(e);break;case"move":s(e),e.stopPropagation();break;case"end":case"cancel":a(e)}},!0),useCustomClick(e),v()}),()=>{const e=t.default&&t.default();m.length=flatVNode(e).length;const n=`${p.value}px 0`;return createVNode("uni-picker-view-column",{ref:r},[createVNode("div",{onWheel:_,onClick:I,class:"uni-picker-view-group"},[createVNode("div",mergeProps(h.attrs,{class:["uni-picker-view-mask",c.maskClass],style:`background-size: 100% ${p.value}px;${c.maskStyle}`}),null,16),createVNode("div",mergeProps(h.attrs,{class:["uni-picker-view-indicator",c.indicatorClass],style:c.indicatorStyle}),[createVNode(ResizeSensor,{ref:u,onResize:({height:e})=>d.value=e},null,8,["onResize"])],16),createVNode("div",{ref:i,class:["uni-picker-view-content"],style:{padding:n,"--picker-view-column-indicator-height":`${d.value}px`}},[e],4)],40,["onWheel","onClick"])],512)}}}),uniRadioGroupKey=PolySymbol("ucg"),props$p={name:{type:String,default:""}},index$n=defineBuiltInComponent({name:"RadioGroup",props:props$p,setup(e,{emit:t,slots:n}){const r=ref(null);return useProvideRadioGroup(e,useCustomEvent(r,t)),()=>createVNode("uni-radio-group",{ref:r},[n.default&&n.default()],512)}});function useProvideRadioGroup(e,t){const n=[];onMounted(()=>{a(n.length-1)});const r=()=>{var e;return null==(e=n.find(e=>e.value.radioChecked))?void 0:e.value.value};provide(uniRadioGroupKey,{addField(e){n.push(e)},removeField(e){n.splice(n.indexOf(e),1)},radioChange(e,i){a(n.indexOf(i),!0),t("change",e,{value:r()})}});const i=inject(uniFormKey,!1),o={submit:()=>{let t=["",null];return""!==e.name&&(t[0]=e.name,t[1]=r()),t}};function s(e,t){e.value={radioChecked:t,value:e.value.value}}function a(e,t){n.forEach((r,i)=>{i!==e&&(t?s(n[i],!1):n.forEach((e,t)=>{i>=t||n[t].value.radioChecked&&s(n[i],!1)}))})}return i&&(i.addField(o),onBeforeUnmount(()=>{i.removeField(o)})),n}const props$o={checked:{type:[Boolean,String],default:!1},id:{type:String,default:""},disabled:{type:[Boolean,String],default:!1},value:{type:String,default:""},color:{type:String,default:"#007aff"},backgroundColor:{type:String,default:""},borderColor:{type:String,default:""},activeBackgroundColor:{type:String,default:""},activeBorderColor:{type:String,default:""},iconColor:{type:String,default:"#ffffff"}},index$m=defineBuiltInComponent({name:"Radio",props:props$o,setup(e,{slots:t}){const n=ref(null),r=ref(e.checked),i=ref(e.value);const o=computed$2(()=>function(){if(e.disabled)return{backgroundColor:"#E1E1E1",borderColor:"#D1D1D1"};const t={};return r.value?(t.backgroundColor=e.activeBackgroundColor||e.color,t.borderColor=e.activeBorderColor||t.backgroundColor):(e.borderColor&&(t.borderColor=e.borderColor),e.backgroundColor&&(t.backgroundColor=e.backgroundColor)),t}(r.value));watch([()=>e.checked,()=>e.value],([e,t])=>{r.value=e,i.value=t});const{uniCheckGroup:s,uniLabel:a,field:c}=useRadioInject(r,i,()=>{r.value=!1}),l=t=>{e.disabled||r.value||(r.value=!0,s&&s.radioChange(t,c),t.stopPropagation())};return a&&(a.addHandler(l),onBeforeUnmount(()=>{a.removeHandler(l)})),useListeners$1(e,{"label-click":l}),()=>{const i=useBooleanAttr(e,"disabled");let s;return s=r.value,createVNode("uni-radio",mergeProps(i,{id:e.id,onClick:l,ref:n}),[createVNode("div",{class:"uni-radio-wrapper",style:{"--HOVER-BD-COLOR":r.value?o.value.borderColor:e.activeBorderColor}},[createVNode("div",{class:["uni-radio-input",{"uni-radio-input-disabled":e.disabled}],style:o.value},[s?createSvgIconVNode(ICON_PATH_SUCCESS_NO_CIRCLE,e.disabled?"#ADADAD":e.iconColor,18):""],6),t.default&&t.default()],4)],16,["id","onClick"])}}});function useRadioInject(e,t,n){const r=computed$2({get:()=>({radioChecked:Boolean(e.value),value:t.value}),set:({radioChecked:t})=>{e.value=t}}),i={reset:n},o=inject(uniRadioGroupKey,!1);o&&o.addField(r);const s=inject(uniFormKey,!1);s&&s.addField(i);const a=inject(uniLabelKey,!1);return onBeforeUnmount(()=>{o&&o.removeField(r),s&&s.removeField(i)}),{uniCheckGroup:o,uniForm:s,uniLabel:a,field:r}}const Refresher=defineBuiltInComponent({name:"Refresher",props:{refreshState:{type:String,default:""},refresherHeight:{type:Number,default:0},refresherThreshold:{type:Number,default:45},refresherDefaultStyle:{type:String,default:"black"},refresherBackground:{type:String,default:"#fff"}},setup(e,{slots:t}){const n=ref(null),r=computed$2(()=>{const t={backgroundColor:e.refresherBackground};switch(e.refreshState){case"pulling":t.height=e.refresherHeight+"px";break;case"refreshing":t.height=e.refresherThreshold+"px",t.transition="height 0.3s";break;case"":case"refresherabort":case"restore":t.height="0px",t.transition="height 0.3s"}return t}),i=computed$2(()=>{const t=e.refresherHeight/e.refresherThreshold;return 360*(t>1?1:t)});return()=>{const{refreshState:o,refresherDefaultStyle:s,refresherThreshold:a}=e;return createVNode("div",{ref:n,style:r.value,class:"uni-scroll-view-refresher"},["none"!==s?createVNode("div",{class:"uni-scroll-view-refresh"},[createVNode("div",{class:"uni-scroll-view-refresh-inner"},["pulling"==o?createVNode("svg",{key:"refresh__icon",style:{transform:"rotate("+i.value+"deg)"},fill:"#2BD009",class:"uni-scroll-view-refresh__icon",width:"24",height:"24",viewBox:"0 0 24 24"},[createVNode("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},null),createVNode("path",{d:"M0 0h24v24H0z",fill:"none"},null)],4):null,"refreshing"==o?createVNode("svg",{key:"refresh__spinner",class:"uni-scroll-view-refresh__spinner",width:"24",height:"24",viewBox:"25 25 50 50"},[createVNode("circle",{cx:"50",cy:"50",r:"20",fill:"none",style:"color: #2bd009","stroke-width":"3"},null)]):null])]):null,"none"===s?createVNode("div",{class:"uni-scroll-view-refresher-container",style:{height:`${a}px`}},[t.default&&t.default()]):null],4)}}}),passiveOptions=passive(!0),props$m={direction:{type:[String],default:"vertical"},scrollX:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},showScrollbar:{type:[Boolean,String],default:!0},upperThreshold:{type:[Number,String],default:50},lowerThreshold:{type:[Number,String],default:50},scrollTop:{type:[Number,String],default:0},scrollLeft:{type:[Number,String],default:0},scrollIntoView:{type:String,default:""},scrollWithAnimation:{type:[Boolean,String],default:!1},enableBackToTop:{type:[Boolean,String],default:!1},refresherEnabled:{type:[Boolean,String],default:!1},refresherThreshold:{type:Number,default:45},refresherDefaultStyle:{type:String,default:"black"},refresherBackground:{type:String,default:"#fff"},refresherTriggered:{type:[Boolean,String],default:!1}},ScrollView=defineBuiltInComponent({name:"ScrollView",compatConfig:{MODE:3},props:props$m,emits:["scroll","scrolltoupper","scrolltolower","refresherrefresh","refresherrestore","refresherpulling","refresherabort","update:refresherTriggered"],setup(e,{emit:t,slots:n,expose:r}){const i=ref(null),o=ref(null),s=ref(null),a=ref(null),c=useCustomEvent(i,t),{state:l,scrollTopNumber:d,scrollLeftNumber:u}=useScrollViewState(e),{realScrollX:p,realScrollY:h,_scrollLeftChanged:g,_scrollTopChanged:m}=useScrollViewLoader(e,l,d,u,c,i,o,a,t),f=computed$2(()=>{let e="";return p.value?e+="overflow-x:auto;":e+="overflow-x:hidden;",h.value?e+="overflow-y:auto;":e+="overflow-y:hidden;",e}),v=computed$2(()=>{let t="uni-scroll-view";return!1===e.showScrollbar&&(t+=" uni-scroll-view-scrollbar-hidden"),t});return r({$getMain:()=>o.value}),()=>{const{refresherEnabled:t,refresherBackground:r,refresherDefaultStyle:c,refresherThreshold:d}=e,{refresherHeight:u,refreshState:p}=l;return createVNode("uni-scroll-view",{ref:i},[createVNode("div",{ref:s,class:"uni-scroll-view"},[createVNode("div",{ref:o,style:f.value,class:v.value},[t?createVNode(Refresher,{refreshState:p,refresherHeight:u,refresherThreshold:d,refresherDefaultStyle:c,refresherBackground:r},{default:()=>["none"==c?n.refresher&&n.refresher():null]},8,["refreshState","refresherHeight","refresherThreshold","refresherDefaultStyle","refresherBackground"]):null,createVNode("div",{ref:a,class:"uni-scroll-view-content"},[n.default&&n.default()],512)],6)],512)],512)}}});function useScrollViewState(e){const t=computed$2(()=>Number(e.scrollTop)||0),n=computed$2(()=>Number(e.scrollLeft)||0);return{state:reactive({lastScrollTop:t.value,lastScrollLeft:n.value,lastScrollToUpperTime:0,lastScrollToLowerTime:0,refresherHeight:0,refreshState:""}),scrollTopNumber:t,scrollLeftNumber:n}}function useScrollViewLoader(e,t,n,r,i,o,s,a,c){let l=!1,d=0,u=!1,p=()=>{};const h=computed$2(()=>e.scrollX),g=computed$2(()=>e.scrollY),m=computed$2(()=>{let t=Number(e.upperThreshold);return isNaN(t)?50:t}),f=computed$2(()=>{let t=Number(e.lowerThreshold);return isNaN(t)?50:t});function v(e,t){const n=s.value;let r=0,i="";if(e<0?e=0:"x"===t&&e>n.scrollWidth-n.offsetWidth?e=n.scrollWidth-n.offsetWidth:"y"===t&&e>n.scrollHeight-n.offsetHeight&&(e=n.scrollHeight-n.offsetHeight),"x"===t?r=n.scrollLeft-e:"y"===t&&(r=n.scrollTop-e),0===r)return;let o=a.value;o.style.transition="transform .3s ease-out",o.style.webkitTransition="-webkit-transform .3s ease-out","x"===t?i="translateX("+r+"px) translateZ(0)":"y"===t&&(i="translateY("+r+"px) translateZ(0)"),o.removeEventListener("transitionend",p),o.removeEventListener("webkitTransitionEnd",p),p=()=>function(e,t){a.value.style.transition="",a.value.style.webkitTransition="",a.value.style.transform="",a.value.style.webkitTransform="";let n=s.value;"x"===t?(n.style.overflowX=h.value?"auto":"hidden",n.scrollLeft=e):"y"===t&&(n.style.overflowY=g.value?"auto":"hidden",n.scrollTop=e);a.value.removeEventListener("transitionend",p),a.value.removeEventListener("webkitTransitionEnd",p)}(e,t),o.addEventListener("transitionend",p),o.addEventListener("webkitTransitionEnd",p),"x"===t?n.style.overflowX="hidden":"y"===t&&(n.style.overflowY="hidden"),o.style.transform=i,o.style.webkitTransform=i}function y(t){g.value&&(e.scrollWithAnimation?v(t,"y"):s.value.scrollTop=t)}function _(t){h.value&&(e.scrollWithAnimation?v(t,"x"):s.value.scrollLeft=t)}function I(t){if(t){if(!/^[_a-zA-Z][-_a-zA-Z0-9:]*$/.test(t))return void console.error(`id error: scroll-into-view=${t}`);let n=o.value.querySelector("#"+t);if(n){let t=s.value.getBoundingClientRect(),r=n.getBoundingClientRect();if(h.value){let n=r.left-t.left,i=s.value.scrollLeft+n;e.scrollWithAnimation?v(i,"x"):s.value.scrollLeft=i}if(g.value){let n=r.top-t.top,i=s.value.scrollTop+n;e.scrollWithAnimation?v(i,"y"):s.value.scrollTop=i}}}}function T(n){if(e.refresherEnabled){switch(n){case"refreshing":t.refresherHeight=e.refresherThreshold,l||(l=!0,i("refresherpulling",{},{deltaY:t.refresherHeight,dy:t.refresherHeight}),i("refresherrefresh",{},{dy:E.y-S.y}),c("update:refresherTriggered",!0));break;case"restore":case"refresherabort":l=!1,t.refresherHeight=d=0,"restore"===n&&(u=!1,i("refresherrestore",{},{dy:E.y-S.y})),"refresherabort"===n&&u&&(u=!1,i("refresherabort",{},{dy:E.y-S.y}))}t.refreshState=n}}let S={x:0,y:0},E={x:0,y:e.refresherThreshold};return onMounted(()=>{nextTick(()=>{y(n.value),_(r.value)}),I(e.scrollIntoView);let o=function(e){e.preventDefault(),e.stopPropagation(),function(e){const n=e.target;i("scroll",e,{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop,scrollHeight:n.scrollHeight,scrollWidth:n.scrollWidth,deltaX:t.lastScrollLeft-n.scrollLeft,deltaY:t.lastScrollTop-n.scrollTop}),g.value&&(n.scrollTop<=m.value&&t.lastScrollTop-n.scrollTop>0&&e.timeStamp-t.lastScrollToUpperTime>200&&(i("scrolltoupper",e,{direction:"top"}),t.lastScrollToUpperTime=e.timeStamp),n.scrollTop+n.offsetHeight+f.value>=n.scrollHeight&&t.lastScrollTop-n.scrollTop<0&&e.timeStamp-t.lastScrollToLowerTime>200&&(i("scrolltolower",e,{direction:"bottom"}),t.lastScrollToLowerTime=e.timeStamp)),h.value&&(n.scrollLeft<=m.value&&t.lastScrollLeft-n.scrollLeft>0&&e.timeStamp-t.lastScrollToUpperTime>200&&(i("scrolltoupper",e,{direction:"left"}),t.lastScrollToUpperTime=e.timeStamp),n.scrollLeft+n.offsetWidth+f.value>=n.scrollWidth&&t.lastScrollLeft-n.scrollLeft<0&&e.timeStamp-t.lastScrollToLowerTime>200&&(i("scrolltolower",e,{direction:"right"}),t.lastScrollToLowerTime=e.timeStamp)),t.lastScrollTop=n.scrollTop,t.lastScrollLeft=n.scrollLeft}(e)},a=null,c=function(n){if(null===S)return;let r=n.touches[0].pageX,o=n.touches[0].pageY,c=s.value;if(Math.abs(r-S.x)>Math.abs(o-S.y))if(h.value){if(0===c.scrollLeft&&r>S.x)return void(a=!1);if(c.scrollWidth===c.offsetWidth+c.scrollLeft&&r<S.x)return void(a=!1);a=!0}else a=!1;else if(g.value)if(0===c.scrollTop&&o>S.y)a=!1,e.refresherEnabled&&!1!==n.cancelable&&n.preventDefault();else{if(c.scrollHeight===c.offsetHeight+c.scrollTop&&o<S.y)return void(a=!1);a=!0}else a=!1;if(a&&n.stopPropagation(),0===c.scrollTop&&1===n.touches.length&&T("pulling"),e.refresherEnabled&&"pulling"===t.refreshState){const r=o-S.y;0===d&&(d=o),l?(t.refresherHeight=r+e.refresherThreshold,u=!1):(t.refresherHeight=o-d,t.refresherHeight>0&&(u=!0,i("refresherpulling",n,{deltaY:r,dy:r})))}},p=function(e){1===e.touches.length&&(S={x:e.touches[0].pageX,y:e.touches[0].pageY})},v=function(n){E={x:n.changedTouches[0].pageX,y:n.changedTouches[0].pageY},t.refresherHeight>=e.refresherThreshold?T("refreshing"):T("refresherabort"),S={x:0,y:0},E={x:0,y:e.refresherThreshold}};s.value.addEventListener("touchstart",p,passiveOptions),s.value.addEventListener("touchmove",c,passive(!1)),s.value.addEventListener("scroll",o,passive(!1)),s.value.addEventListener("touchend",v,passiveOptions),onBeforeUnmount(()=>{s.value.removeEventListener("touchstart",p),s.value.removeEventListener("touchmove",c),s.value.removeEventListener("scroll",o),s.value.removeEventListener("touchend",v)})}),onActivated(()=>{g.value&&(s.value.scrollTop=t.lastScrollTop),h.value&&(s.value.scrollLeft=t.lastScrollLeft)}),watch(n,e=>{y(e)}),watch(r,e=>{_(e)}),watch(()=>e.scrollIntoView,e=>{I(e)}),watch(()=>e.refresherTriggered,e=>{!0===e?T("refreshing"):!1===e&&T("restore")}),{realScrollX:h,realScrollY:g,_scrollTopChanged:y,_scrollLeftChanged:_}}const props$k={indicatorDots:{type:[Boolean,String],default:!1},vertical:{type:[Boolean,String],default:!1},autoplay:{type:[Boolean,String],default:!1},circular:{type:[Boolean,String],default:!1},interval:{type:[Number,String],default:5e3},duration:{type:[Number,String],default:500},current:{type:[Number,String],default:0},indicatorColor:{type:String,default:""},indicatorActiveColor:{type:String,default:""},previousMargin:{type:String,default:""},nextMargin:{type:String,default:""},currentItemId:{type:String,default:""},skipHiddenItemLayout:{type:[Boolean,String],default:!1},displayMultipleItems:{type:[Number,String],default:1},disableTouch:{type:[Boolean,String],default:!1},navigation:{type:[Boolean,String],default:!1},navigationColor:{type:String,default:"#fff"},navigationActiveColor:{type:String,default:"rgba(53, 53, 53, 0.6)"}};function useState$3(e){return reactive({interval:computed$2(()=>{const t=Number(e.interval);return isNaN(t)?5e3:t}),duration:computed$2(()=>{const t=Number(e.duration);return isNaN(t)?500:t}),displayMultipleItems:computed$2(()=>{const t=Math.round(e.displayMultipleItems);return isNaN(t)?1:t}),current:Math.round(e.current)||0,currentItemId:e.currentItemId,userTracking:!1})}function useLayout(e,t,n,r,i,o){function s(){l&&(clearTimeout(l),l=null)}let a,c,l=null,d=!0,u=0,p=1,h=null,g=!1,m=0,f="";const v=computed$2(()=>n.value.length>t.displayMultipleItems),y=computed$2(()=>e.circular&&v.value);function _(i){Math.floor(2*u)===Math.floor(2*i)&&Math.ceil(2*u)===Math.ceil(2*i)||y.value&&function(r){if(!d)for(let i=n.value,o=i.length,s=r+t.displayMultipleItems,a=0;a<o;a++){const t=i[a],n=Math.floor(r/o)*o+a,c=n+o,l=n-o,d=Math.max(r-(n+1),n-s,0),u=Math.max(r-(c+1),c-s,0),p=Math.max(r-(l+1),l-s,0),h=Math.min(d,u,p),g=[n,c,l][[d,u,p].indexOf(h)];t.updatePosition(g,e.vertical)}}(i);const s="translate("+(e.vertical?"0":100*-i*p+"%")+", "+(e.vertical?100*-i*p+"%":"0")+") translateZ(0)",c=r.value;if(c&&(c.style.webkitTransform=s,c.style.transform=s),u=i,!a){if(i%1==0)return;a=i}i-=Math.floor(a);const l=n.value;i<=-(l.length-1)?i+=l.length:i>=l.length&&(i-=l.length),i=a%1>.5||a<0?i-1:i,o("transition",{},{dx:e.vertical?0:i*c.offsetWidth,dy:e.vertical?i*c.offsetHeight:0})}function I(e){const r=n.value.length;if(!r)return-1;const i=(Math.round(e)%r+r)%r;if(y.value){if(r<=t.displayMultipleItems)return 0}else if(i>r-t.displayMultipleItems)return r-t.displayMultipleItems;return i}function T(){h=null}function S(){if(!h)return void(g=!1);const e=h,r=e.toPos,i=e.acc,s=e.endTime,l=e.source,d=s-Date.now();if(d<=0){_(r),h=null,g=!1,a=null;const e=n.value[t.current];if(e){const n=e.getItemId();o("animationfinish",{},{current:t.current,currentItemId:n,source:l})}return}_(r+i*d*d/2),c=requestAnimationFrame(S)}function E(e,r,i){T();const o=t.duration,s=n.value.length;let a=u;if(y.value)if(i<0){for(;a<e;)a+=s;for(;a-s>e;)a-=s}else if(i>0){for(;a>e;)a-=s;for(;a+s<e;)a+=s;a+s-e<e-a&&(a+=s)}else{for(;a+s<e;)a+=s;for(;a-s>e;)a-=s;a+s-e<e-a&&(a+=s)}else"click"===r&&(e=e+t.displayMultipleItems-1<s?e:0);h={toPos:e,acc:2*(a-e)/(o*o),endTime:Date.now()+o,source:r},g||(g=!0,c=requestAnimationFrame(S))}function M(){s();const e=n.value,r=function(){l=null,f="autoplay",y.value?t.current=I(t.current+1):t.current=t.current+t.displayMultipleItems<e.length?t.current+1:0,E(t.current,"autoplay",y.value?1:0),l=setTimeout(r,t.interval)};d||e.length<=t.displayMultipleItems||(l=setTimeout(r,t.interval))}function b(e){e?M():s()}return watch([()=>e.current,()=>e.currentItemId,()=>[...n.value]],()=>{let r=-1;if(e.currentItemId)for(let t=0,i=n.value;t<i.length;t++){if(i[t].getItemId()===e.currentItemId){r=t;break}}r<0&&(r=Math.round(e.current)||0),r=r<0?0:r,t.current!==r&&(f="",t.current=r)}),watch([()=>e.vertical,()=>y.value,()=>t.displayMultipleItems,()=>[...n.value]],function(){s(),h&&(_(h.toPos),h=null);const i=n.value;for(let t=0;t<i.length;t++)i[t].updatePosition(t,e.vertical);p=1;const o=r.value;if(1===t.displayMultipleItems&&i.length){const e=i[0].getBoundingClientRect(),t=o.getBoundingClientRect();p=e.width/t.width,p>0&&p<1||(p=1)}const a=u;u=-2;const c=t.current;c>=0?(d=!1,t.userTracking?(_(a+c-m),m=c):(_(c),e.autoplay&&M())):(d=!0,_(-t.displayMultipleItems-1))}),watch(()=>t.interval,()=>{l&&(s(),M())}),watch(()=>t.current,(e,r)=>{!function(e,r){const i=f;f="";const s=n.value;if(!i){const t=s.length;E(e,"",y.value&&r+(t-e)%t>t/2?1:0)}const a=s[e];if(a){const e=t.currentItemId=a.getItemId();o("change",{},{current:t.current,currentItemId:e,source:i})}}(e,r),i("update:current",e)}),watch(()=>t.currentItemId,e=>{i("update:currentItemId",e)}),watch(()=>e.autoplay&&!t.userTracking,b),b(e.autoplay&&!t.userTracking),onMounted(()=>{let i=!1,o=0,a=0;function c(e){t.userTracking=!1;const n=o/Math.abs(o);let r=0;!e&&Math.abs(o)>.2&&(r=.5*n);const i=I(u+r);e?_(m):(f="touch",t.current=i,E(i,"touch",0!==r?r:0===i&&y.value&&u>=1?1:0))}useTouchtrack(r.value,l=>{if(!e.disableTouch&&!d){if("start"===l.detail.state)return t.userTracking=!0,i=!1,s(),m=u,o=0,a=Date.now(),void T();if("end"===l.detail.state)return c(!1);if("cancel"===l.detail.state)return c(!0);if(t.userTracking){if(!i){i=!0;const n=Math.abs(l.detail.dx),r=Math.abs(l.detail.dy);if((n>=r&&e.vertical||n<=r&&!e.vertical)&&(t.userTracking=!1),!t.userTracking)return void(e.autoplay&&M())}return function(i){const s=a;a=Date.now();const c=n.value.length-t.displayMultipleItems;function l(e){return.5-.25/(e+.5)}function d(e,t){let n=m+e;o=.6*o+.4*t,y.value||(n<0||n>c)&&(n<0?n=-l(-n):n>c&&(n=c+l(n-c)),o=0),_(n)}const u=a-s||1,p=r.value;e.vertical?d(-i.dy/p.offsetHeight,-i.ddy/u):d(-i.dx/p.offsetWidth,-i.ddx/u)}(l.detail),!1}}})}),onUnmounted(()=>{s(),cancelAnimationFrame(c)}),{onSwiperDotClick:function(e){E(t.current=e,f="click",y.value?1:0)},circularEnabled:y,swiperEnabled:v}}const Swiper=defineBuiltInComponent({name:"Swiper",props:props$k,emits:["change","transition","animationfinish","update:current","update:currentItemId"],setup(e,{slots:t,emit:n}){const r=ref(null),i=useCustomEvent(r,n),o=ref(null),s=ref(null),a=useState$3(e),c=computed$2(()=>{let t={};return(e.nextMargin||e.previousMargin)&&(t=e.vertical?{left:0,right:0,top:rpx2px(e.previousMargin,!0),bottom:rpx2px(e.nextMargin,!0)}:{top:0,bottom:0,left:rpx2px(e.previousMargin,!0),right:rpx2px(e.nextMargin,!0)}),t}),l=computed$2(()=>{const t=Math.abs(100/a.displayMultipleItems)+"%";return{width:e.vertical?"100%":t,height:e.vertical?t:"100%"}});let d=[];const u=[],p=ref([]);function h(){const e=[];for(let t=0;t<d.length;t++){let n=d[t];n instanceof Element||(n=n.el);const r=u.find(e=>n===e.rootRef.value);r&&e.push(markRaw(r))}p.value=e}provide("addSwiperContext",function(e){u.push(e),h()});provide("removeSwiperContext",function(e){const t=u.indexOf(e);t>=0&&(u.splice(t,1),h())});const{onSwiperDotClick:g,circularEnabled:m,swiperEnabled:f}=useLayout(e,a,p,s,n,i);let v=()=>null;return v=useSwiperNavigation(r,e,a,g,p,m,f),()=>{const n=t.default&&t.default();return d=flatVNode(n),createVNode("uni-swiper",{ref:r},[createVNode("div",{ref:o,class:"uni-swiper-wrapper"},[createVNode("div",{class:"uni-swiper-slides",style:c.value},[createVNode("div",{ref:s,class:"uni-swiper-slide-frame",style:l.value},[n],4)],4),e.indicatorDots&&createVNode("div",{class:["uni-swiper-dots",e.vertical?"uni-swiper-dots-vertical":"uni-swiper-dots-horizontal"]},[p.value.map((t,n,r)=>createVNode("div",{onClick:()=>g(n),class:{"uni-swiper-dot":!0,"uni-swiper-dot-active":n<a.current+a.displayMultipleItems&&n>=a.current||n<a.current+a.displayMultipleItems-r.length},style:{background:n===a.current?e.indicatorActiveColor:e.indicatorColor}},null,14,["onClick"]))],2),v()],512)],512)}}}),useSwiperNavigation=(e,t,n,r,i,o,s)=>{let a=!1,c=!1,l=!1,d=ref(!1);function u(e,n){const r=e.currentTarget;r&&(r.style.backgroundColor="over"===n?t.navigationActiveColor:"")}watchEffect(()=>{a="auto"===t.navigation,d.value=!0!==t.navigation||a,y()}),watchEffect(()=>{const e=i.value.length,t=!o.value;c=0===n.current&&t,l=n.current===e-1&&t||t&&n.current+n.displayMultipleItems>=e,s.value||(c=!0,l=!0,a&&(d.value=!0))});const p={onMouseover:e=>u(e,"over"),onMouseout:e=>u(e,"out")};function h(e,t,s){if(e.stopPropagation(),s)return;const a=i.value.length;let c=n.current;switch(t){case"prev":c--,c<0&&o.value&&(c=a-1);break;case"next":c++,c>=a&&o.value&&(c=0)}r(c)}const g=()=>createSvgIconVNode(ICON_PATH_BACK,t.navigationColor,26);let m;const f=n=>{clearTimeout(m);const{clientX:r,clientY:i}=n,{left:o,right:s,top:a,bottom:c,width:l,height:u}=e.value.getBoundingClientRect();let p=!1;if(p=t.vertical?!(i-a<u/3||c-i<u/3):!(r-o<l/3||s-r<l/3),p)return m=setTimeout(()=>{d.value=p},300);d.value=p},v=()=>{d.value=!0};function y(){e.value&&(e.value.removeEventListener("mousemove",f),e.value.removeEventListener("mouseleave",v),a&&(e.value.addEventListener("mousemove",f),e.value.addEventListener("mouseleave",v)))}return onMounted(y),function(){const e={"uni-swiper-navigation-hide":d.value,"uni-swiper-navigation-vertical":t.vertical};return t.navigation?createVNode(Fragment,null,[createVNode("div",mergeProps({class:["uni-swiper-navigation uni-swiper-navigation-prev",extend$2({"uni-swiper-navigation-disabled":c},e)],onClick:e=>h(e,"prev",c)},p),[g()],16,["onClick"]),createVNode("div",mergeProps({class:["uni-swiper-navigation uni-swiper-navigation-next",extend$2({"uni-swiper-navigation-disabled":l},e)],onClick:e=>h(e,"next",l)},p),[g()],16,["onClick"])]):null}},props$j={itemId:{type:String,default:""}},SwiperItem=defineBuiltInComponent({name:"SwiperItem",props:props$j,setup(e,{slots:t}){const n=ref(null),r={rootRef:n,getItemId:()=>e.itemId,getBoundingClientRect:()=>n.value.getBoundingClientRect(),updatePosition(e,t){const r=t?"0":100*e+"%",i=t?100*e+"%":"0",o=n.value,s=`translate(${r},${i}) translateZ(0)`;o&&(o.style.webkitTransform=s,o.style.transform=s)}};return onMounted(()=>{const e=inject("addSwiperContext");e&&e(r)}),onUnmounted(()=>{const e=inject("removeSwiperContext");e&&e(r)}),()=>createVNode("uni-swiper-item",{ref:n,style:{position:"absolute",width:"100%",height:"100%"}},[t.default&&t.default()],512)}}),props$i={name:{type:String,default:""},checked:{type:[Boolean,String],default:!1},type:{type:String,default:"switch"},id:{type:String,default:""},disabled:{type:[Boolean,String],default:!1},color:{type:String,default:""}},index$j=defineBuiltInComponent({name:"Switch",props:props$i,emits:["change"],setup(e,{emit:t}){const n=ref(null),r=ref(e.checked),i=useSwitchInject(e,r),o=useCustomEvent(n,t);watch(()=>e.checked,e=>{r.value=e});const s=t=>{e.disabled||(r.value=!r.value,o("change",t,{value:r.value}))};return i&&(i.addHandler(s),onBeforeUnmount(()=>{i.removeHandler(s)})),useListeners$1(e,{"label-click":s}),()=>{const{color:t,type:i}=e,o=useBooleanAttr(e,"disabled"),a={};let c;return t&&r.value&&(a.backgroundColor=t,a.borderColor=t),c=r.value,createVNode("uni-switch",mergeProps({id:e.id,ref:n},o,{onClick:s}),[createVNode("div",{class:"uni-switch-wrapper"},[withDirectives(createVNode("div",{class:["uni-switch-input",[r.value?"uni-switch-input-checked":""]],style:a},null,6),[[vShow,"switch"===i]]),withDirectives(createVNode("div",{class:"uni-checkbox-input"},[c?createSvgIconVNode(ICON_PATH_SUCCESS_NO_CIRCLE,e.color,22):""],512),[[vShow,"checkbox"===i]])])],16,["id","onClick"])}}});function useSwitchInject(e,t){const n=inject(uniFormKey,!1),r=inject(uniLabelKey,!1),i={submit:()=>{const n=["",null];return e.name&&(n[0]=e.name,n[1]=t.value),n},reset:()=>{t.value=!1}};return n&&(n.addField(i),onUnmounted(()=>{n.removeField(i)})),r}const SPACE_UNICODE={ensp:" ",emsp:" ",nbsp:" "};function normalizeText(e,{space:t,decode:n}){let r="",i=!1;for(let o of e)t&&SPACE_UNICODE[t]&&" "===o&&(o=SPACE_UNICODE[t]),i?(r+="n"===o?LINEFEED:"\\"===o?"\\":"\\"+o,i=!1):"\\"===o?i=!0:r+=o;return n?r.replace(/&nbsp;/g,SPACE_UNICODE.nbsp).replace(/&ensp;/g,SPACE_UNICODE.ensp).replace(/&emsp;/g,SPACE_UNICODE.emsp).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'"):r}function parseText(e,t){return normalizeText(e,t).split(LINEFEED)}const index$i=defineBuiltInComponent({name:"Text",props:{selectable:{type:[Boolean,String],default:!1},space:{type:String,default:""},decode:{type:[Boolean,String],default:!1}},setup(e,{slots:t}){const n=ref(null);return()=>{const r=[];return t.default&&t.default().forEach(t=>{if(8&t.shapeFlag&&t.type!==Comment){const n=parseText(t.children,{space:e.space,decode:e.decode}),i=n.length-1;n.forEach((e,t)=>{(0!==t||e)&&r.push(createTextVNode(e)),t!==i&&r.push(createVNode("br"))})}else r.push(t)}),createVNode("uni-text",{ref:n,selectable:!!e.selectable||null},[createVNode("span",null,r)],8,["selectable"])}}}),props$h=extend$2({},props$r,{placeholderClass:{type:String,default:"input-placeholder"},autoHeight:{type:[Boolean,String],default:!1},confirmType:{type:String,default:"return",validator:e=>ConfirmTypes.concat("return").includes(e)}});let fixMargin=!1;const ConfirmTypes=["done","go","next","search","send"];function setFixMargin(){const e="(prefers-color-scheme: dark)";fixMargin=0===String(navigator.platform).indexOf("iP")&&0===String(navigator.vendor).indexOf("Apple")&&window.matchMedia(e).media!==e}const index$h=defineBuiltInComponent({name:"Textarea",props:props$h,emits:["confirm","linechange",...emit],setup(e,{emit:t,expose:n}){const r=ref(null),i=ref(null),{fieldRef:o,state:s,scopedAttrsState:a,fixDisabledColor:c,trigger:l}=useField(e,r,t),d=computed$2(()=>s.value.split(LINEFEED)),u=computed$2(()=>ConfirmTypes.includes(e.confirmType)),p=ref(0),h=ref(null);function g({height:e}){p.value=e}function m(e){"Enter"===e.key&&u.value&&e.preventDefault()}function f(t){if("Enter"===t.key&&u.value){!function(e){l("confirm",e,{value:s.value})}(t);const n=t.target;!e.confirmHold&&n.blur()}}return watch(()=>p.value,t=>{const n=r.value,o=h.value,s=i.value;let a=parseFloat(getComputedStyle(n).lineHeight);isNaN(a)&&(a=o.offsetHeight);var c=Math.round(t/a);l("linechange",{},{height:t,heightRpx:750/window.innerWidth*t,lineCount:c}),e.autoHeight&&(s.style.height=t+"px")}),setFixMargin(),n({$triggerInput:e=>{t("update:modelValue",e.value),t("update:value",e.value),s.value=e.value}}),()=>{let t=e.disabled&&c?createVNode("textarea",{key:"disabled-textarea",ref:o,value:s.value,tabindex:"-1",readonly:!!e.disabled,maxlength:s.maxlength,class:{"uni-textarea-textarea":!0,"uni-textarea-textarea-fix-margin":fixMargin},style:{overflowY:e.autoHeight?"hidden":"auto",...e.cursorColor&&{caretColor:e.cursorColor}},onFocus:e=>e.target.blur()},null,46,["value","readonly","maxlength","onFocus"]):createVNode("textarea",{key:"textarea",ref:o,value:s.value,disabled:!!e.disabled,maxlength:s.maxlength,enterkeyhint:e.confirmType,inputmode:e.inputmode,class:{"uni-textarea-textarea":!0,"uni-textarea-textarea-fix-margin":fixMargin},style:{overflowY:e.autoHeight?"hidden":"auto",...e.cursorColor&&{caretColor:e.cursorColor}},onKeydown:m,onKeyup:f},null,46,["value","disabled","maxlength","enterkeyhint","inputmode","onKeydown","onKeyup"]);return createVNode("uni-textarea",{ref:r,"auto-height":e.autoHeight},[createVNode("div",{ref:i,class:"uni-textarea-wrapper"},[withDirectives(createVNode("div",mergeProps(a.attrs,{style:e.placeholderStyle,class:["uni-textarea-placeholder",e.placeholderClass]}),[e.placeholder],16),[[vShow,!s.value.length]]),createVNode("div",{ref:h,class:"uni-textarea-line"},[" "],512),createVNode("div",{class:"uni-textarea-compute"},[d.value.map(e=>createVNode("div",null,[e.trim()?e:"."])),createVNode(ResizeSensor,{initial:!0,onResize:g},null,8,["initial","onResize"])]),"search"===e.confirmType?createVNode("form",{action:"",onSubmit:()=>!1,class:"uni-input-form"},[t],40,["onSubmit"]):t],512)],8,["auto-height"])}}}),index$g=defineBuiltInComponent({name:"View",props:extend$2({},hoverProps),setup(e,{slots:t}){const n=ref(null),{hovering:r,binding:i}=useHover(e);return()=>{const o=e.hoverClass;return o&&"none"!==o?createVNode("uni-view",mergeProps({class:r.value?o:"",ref:n},i),[renderSlot(t,"default")],16):createVNode("uni-view",{ref:n},[renderSlot(t,"default")],512)}}});function normalizeEvent(e,t){if(t||(t=e.id),t)return e.$options.name.toLowerCase()+"."+t}function addSubscribe(e,t,n){e&&registerViewMethod(n||getCurrentPageId(),e,({type:e,data:n},r)=>{t(e,n,r)})}function removeSubscribe(e,t){e&&unregisterViewMethod(t||getCurrentPageId(),e)}function useSubscribe(e,t,n,r){const i=getCurrentInstance().proxy;onMounted(()=>{addSubscribe(t||normalizeEvent(i),e,r),!n&&t||watch(()=>i.id,(t,n)=>{addSubscribe(normalizeEvent(i,t),e,r),removeSubscribe(n&&normalizeEvent(i,n))})}),onBeforeUnmount(()=>{removeSubscribe(t||normalizeEvent(i),r)})}let index$f=0;function useContextInfo(e){const t=useCurrentPageId(),n=getCurrentInstance().proxy,r=n.$options.name.toLowerCase(),i=e||n.id||"context"+index$f++;return onMounted(()=>{n.$el.__uniContextInfo={id:i,type:r,page:t}}),`${r}.${i}`}function getContextInfo(e){return e.__uniContextInfo}function injectLifecycleHook(e,t,n,r){isFunction$2(t)&&injectHook(e,t.bind(n),r)}function initHooks(e,t,n){const r=e.mpType||n.$mpType;if(r&&"component"!==r&&("page"!==r||"component"!==t.renderer)&&(Object.keys(e).forEach(r=>{if(isUniLifecycleHook(r,e[r],!1)){const i=e[r];isArray$3(i)?i.forEach(e=>injectLifecycleHook(r,e,n,t)):injectLifecycleHook(r,i,n,t)}}),"page"===r)){t.__isVisible=!0;try{let e=t.attrs.__pageQuery;0,invokeHook(n,ON_LOAD,e),delete t.attrs.__pageQuery;const r=n.$page;"preloadPage"!==(null==r?void 0:r.openType)&&invokeHook(n,ON_SHOW)}catch(i){console.error(i.message+LINEFEED+i.stack)}}}function applyOptions(e,t,n){initHooks(e,t,n)}function set(e,t,n){return e[t]=n}function $callMethod(e,...t){const n=this[e];return n?n(...t):(console.error(`method ${e} not found`),null)}function createErrorHandler(e){const t=e.config.errorHandler;return function(n,r,i){t&&t(n,r,i);const o=e._instance;if(!o||!o.proxy)throw n;o[ON_ERROR]?invokeHook(o.proxy,ON_ERROR,n):logError(n,i,r?r.$.vnode:null,!1)}}function mergeAsArray(e,t){return e?[...new Set([].concat(e,t))]:t}function initOptionMergeStrategies(e){UniLifecycleHooks.forEach(t=>{e[t]=mergeAsArray})}function initApp$1(e){const t=e.config;t.errorHandler=invokeCreateErrorHandler(e,createErrorHandler),initOptionMergeStrategies(t.optionMergeStrategies);const n=t.globalProperties;n.$set=set,n.$applyOptions=applyOptions,n.$callMethod=$callMethod,invokeCreateVueAppHook(e)}function initRouter(e){const t=createRouter(createRouterOptions());t.beforeEach((e,t)=>{e&&t&&e.meta.isTabBar&&t.meta.isTabBar&&saveTabBarScrollPosition(t.meta.tabBarIndex)}),e.router=t,e.use(t)}let positionStore=Object.create(null);function getTabBarScrollPosition(e){return positionStore[e]}function saveTabBarScrollPosition(e){"undefined"!=typeof window&&(positionStore[e]={left:window.pageXOffset,top:window.pageYOffset})}const scrollBehavior=(e,t,n)=>{if(n)return n;if(e&&t&&e.meta.isTabBar&&t.meta.isTabBar){const t=getTabBarScrollPosition(e.meta.tabBarIndex);if(t)return t}return{left:0,top:0}};function createRouterOptions(){return{history:initHistory(),strict:!!__uniConfig.router.strict,routes:__uniRoutes,scrollBehavior:scrollBehavior}}function removeCurrentPages(e=1){const t=getCurrentBasePages(),n=t.length-1,r=n-e;for(let i=n;i>r;i--){const e=getPage$BasePage(t[i]);removePage(normalizeRouteKey(e.path,e.id),!1)}}function initHistory(){let{routerBase:e}=__uniConfig.router;"/"===e&&(e="");const t=createWebHashHistory(e);return t.listen((e,t,n)=>{"back"===n.direction&&removeCurrentPages(Math.abs(n.delta))}),t}const index$e={install(e){initApp$1(e),initViewPlugin(e),initServicePlugin(e),e.config.warnHandler||(e.config.warnHandler=warnHandler),initRouter(e)}};function warnHandler(e,t,n){if(t){if("PageMetaHead"===t.$.type.name)return;const e=t.$.parent;if(e&&"PageMeta"===e.type.name)return}const r=[`[Vue warn]: ${e}`];n.length&&r.push("\n",n),console.warn(...r)}const clazz={class:"uni-async-loading"},loadingVNode=createVNode("i",{class:"uni-loading"},null,-1),AsyncLoadingComponent=defineSystemComponent({name:"AsyncLoading",render:()=>(openBlock(),createBlock("div",clazz,[loadingVNode]))});function reload(){window.location.reload()}const AsyncErrorComponent=defineSystemComponent({name:"AsyncError",props:["error"],setup(){initI18nAsyncMsgsOnce();const{t:e}=useI18n();return()=>createVNode("div",{class:"uni-async-error",onClick:reload},[e("uni.async.error")],8,["onClick"])}});let appVm;function getApp$1(){return appVm}function initApp(e){appVm=e,Object.defineProperty(appVm.$.ctx,"$children",{get:()=>getCurrentBasePages().map(e=>e.$vm)});const t=appVm.$.appContext.app;t.component(AsyncLoadingComponent.name)||t.component(AsyncLoadingComponent.name,AsyncLoadingComponent),t.component(AsyncErrorComponent.name)||t.component(AsyncErrorComponent.name,AsyncErrorComponent),initAppVm(appVm),defineGlobalData(appVm),initService(),initView()}function wrapperComponentSetup(e,{clone:t,init:n,setup:r,before:i}){t&&(e=extend$2({},e)),i&&i(e);const o=e.setup;return e.setup=(e,t)=>{const i=getCurrentInstance();if(n(i.proxy),r(i),o)return o(e,t)},e}function setupComponent(e,t){return e&&(e.__esModule||"Module"===e[Symbol.toStringTag])?wrapperComponentSetup(e.default,t):wrapperComponentSetup(e,t)}function setupPage(e){return setupComponent(e,{clone:!0,init:initPage,setup(e){e.$pageInstance=e;const t=usePageRoute(),n=decodedQuery(t.query);e.attrs.__pageQuery=n,getPage$BasePage(e.proxy).options=n,e.proxy.options=n;const r=usePageMeta();return updateCurPageCssVar(r),e.onReachBottom=reactive([]),e.onPageScroll=reactive([]),watch([e.onReachBottom,e.onPageScroll],()=>{const t=getCurrentPage();e.proxy===t&&initPageScrollListener(e,r)},{once:!0}),onBeforeMount(()=>{onPageShow(e,r)}),onMounted(()=>{onPageReady(e);const{onReady:n}=e;n&&invokeArrayFns$1(n),invokeOnTabItemTap(t)}),onBeforeActivate(()=>{if(!e.__isVisible){onPageShow(e,r),e.__isVisible=!0;const{onShow:n}=e;n&&invokeArrayFns$1(n),nextTick(()=>{invokeOnTabItemTap(t)})}}),onBeforeDeactivate(()=>{if(e.__isVisible&&!e.__isUnload){e.__isVisible=!1;{const{onHide:t}=e;t&&invokeArrayFns$1(t)}}}),subscribeViewMethod(r.id),onBeforeUnmount(()=>{unsubscribeViewMethod(r.id)}),n}})}function setupApp(e){return setupComponent(e,{init:initApp,setup(e){const t=usePageRoute(),n=()=>{injectAppHooks(e);const{onLaunch:n,onShow:r,onPageNotFound:i}=e,o=initLaunchOptions({path:t.path.slice(1)||__uniRoutes[0].meta.route,query:decodedQuery(t.query)});if(n&&invokeArrayFns$1(n,o),r&&invokeArrayFns$1(r,o),!t.matched.length){const e={notFound:!0,openType:"appLaunch",path:t.path,query:{},scene:1001};handleBeforeEntryPageRoutes(),i&&invokeArrayFns$1(i,e)}};return useRouter().isReady().then(n),onMounted(()=>{window.addEventListener("resize",debounce$1(onResize,50,{setTimeout:setTimeout,clearTimeout:clearTimeout})),window.addEventListener("message",onMessage),document.addEventListener("visibilitychange",onVisibilityChange),onThemeChange$2()}),t.query},before(e){e.mpType="app";const{setup:t}=e,n=()=>(openBlock(),createBlock(LayoutComponent));e.setup=(e,r)=>{const i=t&&t(e,r);return isFunction$2(i)?n:i},e.render=n}})}function onResize(){const{windowWidth:e,windowHeight:t,screenWidth:n,screenHeight:r}=uni.getSystemInfoSync(),i=90===Math.abs(Number(window.orientation))?"landscape":"portrait";UniServiceJSBridge$1.emit(ON_RESIZE,{deviceOrientation:i,size:{windowWidth:e,windowHeight:t,screenWidth:n,screenHeight:r}})}function onMessage(e){isPlainObject$3(e.data)&&e.data.type===WEB_INVOKE_APPSERVICE&&UniServiceJSBridge$1.emit(ON_WEB_INVOKE_APP_SERVICE,e.data.data,e.data.pageId)}function onVisibilityChange(){const{emit:e}=UniServiceJSBridge$1;"visible"===document.visibilityState?e(ON_APP_ENTER_FOREGROUND,getEnterOptions()):e(ON_APP_ENTER_BACKGROUND)}function onThemeChange$2(){let e=null;try{e=window.matchMedia("(prefers-color-scheme: dark)")}catch(t){}if(e){let t=e=>{UniServiceJSBridge$1.emit(ON_THEME_CHANGE,{theme:e.matches?"dark":"light"})};e.addEventListener?e.addEventListener("change",t):e.addListener(t)}}function invokeOnTabItemTap(e){const{tabBarText:t,tabBarIndex:n,route:r}=e.meta;t&&invokeHook("onTabItemTap",{index:n,text:t,pagePath:r})}function formatTime(e){e=e>0&&e<1/0?e:0;const t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%3600%60),i=(t<10?"0":"")+t;let o=(n<10?"0":"")+n+":"+((r<10?"0":"")+r);return"00"!==i&&(o=i+":"+o),o}function useGesture(e,t,n){const r=reactive({seeking:!1,gestureType:"none",volumeOld:0,volumeNew:0,currentTimeOld:0,currentTimeNew:0,toastThin:!1}),i={x:0,y:0};let o=null;let s;return{state:r,onTouchstart:function(e){const t=e.targetTouches[0];i.x=t.pageX,i.y=t.pageY,r.gestureType="none",r.volumeOld=0},onTouchmove:function(a){function c(){a.stopPropagation(),a.preventDefault()}n.fullscreen&&c();const l=r.gestureType;if("stop"===l)return;const d=a.targetTouches[0],u=d.pageX,p=d.pageY,h=i,g=t.value;if("progress"===l?(!function(e){const n=t.value,i=n.duration;let o=e/600*i+r.currentTimeOld;o<0?o=0:o>i&&(o=i);r.currentTimeNew=o}(u-h.x),r.seeking=!0):"volume"===l&&function(e){const n=t.value,i=r.volumeOld;let o;"number"==typeof i&&(o=i-e/200,o<0?o=0:o>1&&(o=1),clearTimeout(s),s=void 0,null==s&&(s=setTimeout(()=>{r.toastThin=!1,s=void 0},1e3)),n.volume=o,r.volumeNew=o)}(p-h.y),"none"===l)if(Math.abs(u-h.x)>Math.abs(p-h.y)){if(!e.enableProgressGesture)return void(r.gestureType="stop");r.gestureType="progress",r.currentTimeOld=r.currentTimeNew=g.currentTime,n.fullscreen||c()}else{if(!e.pageGesture&&!e.vslideGesture)return void(r.gestureType="stop");"none"!==r.gestureType&&null!=o||(o=setTimeout(()=>{r.toastThin=!0},500)),r.gestureType="volume",r.volumeOld=g.volume,n.fullscreen||c()}},onTouchend:function(e){const n=t.value;"none"!==r.gestureType&&"stop"!==r.gestureType&&(e.stopPropagation(),e.preventDefault()),"progress"===r.gestureType&&r.currentTimeOld!==r.currentTimeNew&&(n.currentTime=r.currentTimeNew),r.gestureType="none"}}}function useFullscreen(e,t,n,r,i){const o=reactive({fullscreen:!1}),s=/^Apple/.test(navigator.vendor);function a(t){o.fullscreen=t,e("fullscreenchange",{},{fullScreen:t,direction:"vertical"})}function c(e){const o=i.value,c=t.value,l=n.value;let d;e?!document.fullscreenEnabled&&!document.webkitFullscreenEnabled||s&&!r.userAction?l.webkitEnterFullScreen?l.webkitEnterFullScreen():(d=!0,c.remove(),c.classList.add("uni-video-type-fullscreen"),document.body.appendChild(c)):c[document.fullscreenEnabled?"requestFullscreen":"webkitRequestFullscreen"]():document.fullscreenEnabled||document.webkitFullscreenEnabled?document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement&&document.webkitExitFullscreen():l.webkitExitFullScreen?l.webkitExitFullScreen():(d=!0,c.remove(),c.classList.remove("uni-video-type-fullscreen"),o.appendChild(c)),d&&a(e)}function l(){c(!1)}return onBeforeUnmount(l),{state:o,onFullscreenChange:function(e,t){t&&document.fullscreenEnabled||a(!(!document.fullscreenElement&&!document.webkitFullscreenElement))},emitFullscreenChange:a,toggleFullscreen:c,requestFullScreen:function(){c(!0)},exitFullScreen:l}}function useVideo(e,t,n){const r=ref(null),i=computed$2(()=>getRealPath(e.src)),o=computed$2(()=>"true"===e.muted||!0===e.muted),s=reactive({start:!1,src:i,playing:!1,currentTime:0,duration:0,progress:0,buffered:0,muted:o,pauseUpdatingCurrentTime:!1});function a(e){const t=e.target,n=t.buffered;n.length&&(s.buffered=n.end(n.length-1)/t.duration*100)}function c(){r.value.pause()}function l(e){const t=r.value;"number"!=typeof(e=Number(e))||isNaN(e)||(t.currentTime=e)}return watch(()=>i.value,()=>{s.playing=!1,s.currentTime=0}),watch(()=>s.buffered,e=>{n("progress",{},{buffered:e})}),watch(()=>o.value,e=>{r.value.muted=e}),{videoRef:r,state:s,play:function(){const e=r.value;s.start=!0,e.play()},pause:c,stop:function(){l(0),c()},seek:l,playbackRate:function(e){r.value.playbackRate=e},toggle:function(){const e=r.value;s.playing?e.pause():e.play()},onDurationChange:function({target:e}){s.duration=e.duration},onLoadedMetadata:function(t){const r=Number(e.initialTime)||0,i=t.target;r>0&&(i.currentTime=r),n("loadedmetadata",t,{width:i.videoWidth,height:i.videoHeight,duration:i.duration}),a(t)},onProgress:a,onWaiting:function(e){n("waiting",e,{})},onVideoError:function(e){s.playing=!1,n("error",e,{})},onPlay:function(e){s.start=!0,s.playing=!0,n("play",e,{})},onPause:function(e){s.playing=!1,n("pause",e,{})},onEnded:function(e){s.playing=!1,n("ended",e,{})},onTimeUpdate:function(e){const t=e.target;s.pauseUpdatingCurrentTime||(s.currentTime=t.currentTime);const r=t.currentTime;n("timeupdate",e,{currentTime:r,duration:t.duration})}}}function useControls(e,t,n,r){const i=ref(null),o=ref(null),s=computed$2(()=>e.showCenterPlayBtn&&!t.start),a=ref(!0),c=computed$2(()=>!s.value&&e.controls&&a.value),l=reactive({seeking:!1,touching:!1,controlsTouching:!1,centerPlayBtnShow:s,controlsShow:c,controlsVisible:a});let d;function u(){d=setTimeout(()=>{l.controlsVisible=!1},3e3)}function p(){d&&(clearTimeout(d),d=null)}return onBeforeUnmount(()=>{d&&clearTimeout(d)}),watch(()=>l.controlsShow&&t.playing&&!l.controlsTouching,e=>{e?u():p()}),onMounted(()=>{const e=passive(!1);let s,a,c,d=!0;const u=o.value;function p(e){const n=e.targetTouches[0],o=n.pageX,u=n.pageY;if(d&&Math.abs(o-s)<Math.abs(u-a))return void h(e);d=!1;const p=i.value.offsetWidth;let g=c+(o-s)/p*100;g<0?g=0:g>100&&(g=100),t.progress=g,null==r||r(t.duration*g/100),l.seeking=!0,e.preventDefault(),e.stopPropagation()}function h(r){l.controlsTouching=!1,l.touching&&(u.removeEventListener("touchmove",p,e),d||(r.preventDefault(),r.stopPropagation(),n(t.duration*t.progress/100)),l.touching=!1)}u.addEventListener("touchstart",n=>{l.controlsTouching=!0;const r=n.targetTouches[0];s=r.pageX,a=r.pageY,c=t.progress,d=!0,l.touching=!0,u.addEventListener("touchmove",p,e)}),u.addEventListener("touchend",h),u.addEventListener("touchcancel",h)}),{state:l,progressRef:i,ballRef:o,clickProgress:function(e){const r=i.value;let o=e.target,s=e.offsetX;for(;o&&o!==r;)s+=o.offsetLeft,o=o.parentNode;const a=r.offsetWidth;let c=0;s>=0&&s<=a&&(c=s/a,n(t.duration*c))},toggleControls:function(){l.controlsVisible=!l.controlsVisible},autoHideStart:u,autoHideEnd:p}}function useDanmu(e,t){const n=ref(null),r=reactive({enable:Boolean(e.enableDanmu)});let i={time:0,index:-1};const o=isArray$3(e.danmuList)?JSON.parse(JSON.stringify(e.danmuList)):[];function s(e){const t=document.createElement("p");t.className="uni-video-danmu-item",t.innerText=e.text;let r=`bottom: ${100*Math.random()}%;color: ${e.color};`;t.setAttribute("style",r);n.value.appendChild(t),setTimeout(function(){r+="left: 0;-webkit-transform: translateX(-100%);transform: translateX(-100%);",t.setAttribute("style",r),setTimeout(function(){t.remove()},4e3)},17)}return o.sort(function(e,t){return(e.time||0)-(t.time||0)}),{state:r,danmuRef:n,updateDanmu:function(e){const n=e.target.currentTime,a=i,c={time:n,index:a.index};if(n>a.time)for(let i=a.index+1;i<o.length;i++){const e=o[i];if(!(n>=(e.time||0)))break;c.index=i,t.playing&&r.enable&&s(e)}else if(n<a.time)for(let t=a.index-1;t>-1;t--){if(!(n<=(o[t].time||0)))break;c.index=t-1}i=c},toggleDanmu:function(){r.enable=!r.enable},sendDanmu:function(e){o.splice(i.index+1,0,{text:String(e.text),color:e.color,time:t.currentTime||0})}}}function useContext(e,t,n,r,i,o,s,a){const c={play:e,stop:n,pause:t,seek:r,sendDanmu:i,playbackRate:o,requestFullScreen:s,exitFullScreen:a};useSubscribe((e,t)=>{let n;switch(e){case"seek":n=t.position;break;case"sendDanmu":n=t;break;case"playbackRate":n=t.rate}e in c&&c[e](n)},useContextInfo(),!0)}function useProgressing(e,t,n,r,i){const o=computed$2(()=>"progress"===t.gestureType||n.touching);return watch(o,r=>{e.pauseUpdatingCurrentTime=r,n.controlsTouching=r,"progress"===t.gestureType&&r&&(n.controlsVisible=r)}),watch([()=>e.currentTime,()=>{props$g.duration}],()=>{e.progress=e.currentTime/e.duration*100}),watch(()=>t.currentTimeNew,t=>{e.currentTime=t}),o}const props$g={id:{type:String,default:""},src:{type:String,default:""},duration:{type:[Number,String],default:""},controls:{type:[Boolean,String],default:!0},danmuList:{type:Array,default:()=>[]},danmuBtn:{type:[Boolean,String],default:!1},enableDanmu:{type:[Boolean,String],default:!1},autoplay:{type:[Boolean,String],default:!1},loop:{type:[Boolean,String],default:!1},muted:{type:[Boolean,String],default:!1},objectFit:{type:String,default:"contain"},poster:{type:String,default:""},direction:{type:[String,Number],default:""},showProgress:{type:Boolean,default:!0},initialTime:{type:[String,Number],default:0},showFullscreenBtn:{type:[Boolean,String],default:!0},pageGesture:{type:[Boolean,String],default:!1},vslideGesture:{type:[Boolean,String],default:!1},enableProgressGesture:{type:[Boolean,String],default:!0},showPlayBtn:{type:[Boolean,String],default:!0},showCenterPlayBtn:{type:[Boolean,String],default:!0}},index$d=defineBuiltInComponent({name:"Video",props:props$g,emits:["fullscreenchange","progress","loadedmetadata","waiting","error","play","pause","ended","timeupdate"],setup(e,{emit:t,attrs:n,slots:r}){const i=ref(null),o=ref(null),s=useCustomEvent(i,t),{state:a}=useUserAction(),{$attrs:c}=useAttrs({excludeListeners:!0});useI18n(),initI18nVideoMsgsOnce();const{videoRef:l,state:d,play:u,pause:p,stop:h,seek:g,playbackRate:m,toggle:f,onDurationChange:v,onLoadedMetadata:y,onProgress:_,onWaiting:I,onVideoError:T,onPlay:S,onPause:E,onEnded:M,onTimeUpdate:b}=useVideo(e,n,s),{state:C,danmuRef:A,updateDanmu:O,toggleDanmu:R,sendDanmu:N}=useDanmu(e,d),{state:w,onFullscreenChange:P,emitFullscreenChange:k,toggleFullscreen:L,requestFullScreen:x,exitFullScreen:V}=useFullscreen(s,o,l,a,i),{state:D,onTouchstart:U,onTouchend:$,onTouchmove:B}=useGesture(e,l,w),{state:F,progressRef:j,ballRef:q,clickProgress:G,toggleControls:H,autoHideEnd:W,autoHideStart:z}=useControls(e,d,g,e=>{D.currentTimeNew=e});useContext(u,p,h,g,N,m,x,V);const K=useProgressing(d,D,F);return()=>createVNode("uni-video",{ref:i,id:e.id,onClick:H},[createVNode("div",{ref:o,class:"uni-video-container",onTouchstart:U,onTouchend:$,onTouchmove:B,onFullscreenchange:withModifiers(P,["stop"]),onWebkitfullscreenchange:withModifiers(e=>P(e,!0),["stop"])},[createVNode("video",mergeProps({ref:l,style:{"object-fit":e.objectFit},muted:!!e.muted,loop:!!e.loop,src:d.src,poster:e.poster,autoplay:!!e.autoplay},c.value,{class:"uni-video-video","webkit-playsinline":!0,playsinline:!0,onDurationchange:v,onLoadedmetadata:y,onProgress:_,onWaiting:I,onError:T,onPlay:S,onPause:E,onEnded:M,onTimeupdate:e=>{b(e),O(e)},onWebkitbeginfullscreen:()=>k(!0),onX5videoenterfullscreen:()=>k(!0),onWebkitendfullscreen:()=>k(!1),onX5videoexitfullscreen:()=>k(!1)}),null,16,["muted","loop","src","poster","autoplay","webkit-playsinline","playsinline","onDurationchange","onLoadedmetadata","onProgress","onWaiting","onError","onPlay","onPause","onEnded","onTimeupdate","onWebkitbeginfullscreen","onX5videoenterfullscreen","onWebkitendfullscreen","onX5videoexitfullscreen"]),withDirectives(createVNode("div",{class:"uni-video-bar uni-video-bar-full",onClick:withModifiers(()=>{},["stop"])},[createVNode("div",{class:"uni-video-controls"},[withDirectives(createVNode("div",{class:{"uni-video-icon":!0,"uni-video-control-button":!0,"uni-video-control-button-play":!d.playing,"uni-video-control-button-pause":d.playing},onClick:withModifiers(f,["stop"])},null,10,["onClick"]),[[vShow,e.showPlayBtn]]),withDirectives(createVNode("div",{class:"uni-video-current-time"},[formatTime(d.currentTime)],512),[[vShow,e.showProgress]]),withDirectives(createVNode("div",{ref:j,class:"uni-video-progress-container",onClick:withModifiers(G,["stop"])},[createVNode("div",{class:{"uni-video-progress":!0,"uni-video-progress-progressing":K.value}},[createVNode("div",{style:{width:d.buffered-d.progress+"%",left:d.progress+"%"},class:"uni-video-progress-buffered"},null,4),createVNode("div",{style:{width:d.progress+"%"},class:"uni-video-progress-played"},null,4),createVNode("div",{ref:q,style:{left:d.progress+"%"},class:{"uni-video-ball":!0,"uni-video-ball-progressing":K.value}},[createVNode("div",{class:"uni-video-inner"},null)],6)],2)],8,["onClick"]),[[vShow,e.showProgress]]),withDirectives(createVNode("div",{class:"uni-video-duration"},[formatTime(Number(e.duration)||d.duration)],512),[[vShow,e.showProgress]])]),withDirectives(createVNode("div",{class:{"uni-video-icon":!0,"uni-video-danmu-button":!0,"uni-video-danmu-button-active":C.enable},onClick:withModifiers(R,["stop"])},null,10,["onClick"]),[[vShow,e.danmuBtn]]),withDirectives(createVNode("div",{class:{"uni-video-icon":!0,"uni-video-fullscreen":!0,"uni-video-type-fullscreen":w.fullscreen},onClick:withModifiers(()=>L(!w.fullscreen),["stop"])},null,10,["onClick"]),[[vShow,e.showFullscreenBtn]])],8,["onClick"]),[[vShow,F.controlsShow]]),withDirectives(createVNode("div",{ref:A,style:"z-index: 0;",class:"uni-video-danmu"},null,512),[[vShow,d.start&&C.enable]]),F.centerPlayBtnShow&&createVNode("div",{class:"uni-video-cover",onClick:withModifiers(()=>{},["stop"])},[createVNode("div",{class:"uni-video-cover-play-button uni-video-icon",onClick:withModifiers(u,["stop"])},null,8,["onClick"])],8,["onClick"]),createVNode("div",{class:"uni-video-loading"},["volume"===D.gestureType?createVNode("div",{class:{"uni-video-toast-container":!0,"uni-video-toast-container-thin":D.toastThin},style:{marginTop:"5px"}},[!D.toastThin&&D.volumeNew>0&&"volume"===D.gestureType?createVNode("text",{class:"uni-video-icon uni-video-toast-icon"},[""]):!D.toastThin&&createVNode("text",{class:"uni-video-icon uni-video-toast-icon"},[""]),createVNode("div",{class:"uni-video-toast-draw",style:{width:100*D.volumeNew+"%"}},null)],2):null]),createVNode("div",{class:{"uni-video-toast":!0,"uni-video-toast-progress":K.value}},[createVNode("div",{class:"uni-video-toast-title"},[createVNode("span",{class:"uni-video-toast-title-current-time"},[formatTime(D.currentTimeNew)])," / ",Number(e.duration)||formatTime(d.duration)])],2),createVNode("div",{class:"uni-video-slots"},[r.default&&r.default()])],40,["onTouchstart","onTouchend","onTouchmove","onFullscreenchange","onWebkitfullscreenchange"])],8,["id","onClick"])}}),onWebInvokeAppService=({name:e,arg:t})=>{"postMessage"===e||uni[e](t)},Invoke=once$1(()=>UniServiceJSBridge$1.on(ON_WEB_INVOKE_APP_SERVICE,onWebInvokeAppService)),props$f={src:{type:String,default:""},fullscreen:{type:Boolean,default:!0}},index$c=defineBuiltInComponent({inheritAttrs:!1,name:"WebView",props:props$f,emits:["load"],setup(e,{emit:t}){Invoke();const n=ref(null),r=ref(null),{$attrs:i,$excludeAttrs:o,$listeners:s}=useAttrs({excludeListeners:!0}),a=useCustomEvent(n,t);let c;return(()=>{const t=document.createElement("iframe");t.onload=function(t){a("load",t,{src:e.src})},watchEffect(()=>{for(const e in i.value)if(hasOwn$1(i.value,e)){const n=i.value[e];t[e]=n}}),watchEffect(()=>{t.src=getRealPath(e.src)}),r.value=t,c=useWebViewSize(n,r,e.fullscreen),e.fullscreen&&document.body.appendChild(t)})(),onMounted(()=>{var t;c(),!e.fullscreen&&(null==(t=n.value)||t.appendChild(r.value))}),onActivated(()=>{e.fullscreen&&(r.value.style.display="block")}),onDeactivated(()=>{e.fullscreen&&(r.value.style.display="none")}),onBeforeUnmount(()=>{e.fullscreen&&document.body.removeChild(r.value)}),()=>createVNode(Fragment,null,[createVNode("uni-web-view",mergeProps({class:e.fullscreen?"uni-webview--fullscreen":""},s.value,o.value,{ref:n}),[createVNode(ResizeSensor,{onResize:c},null,8,["onResize"])],16)])}});function useWebViewSize(e,t,n){return()=>{var r,i;if(n){const{top:n,left:r,width:i,height:o}=e.value.getBoundingClientRect();updateElementStyle(t.value,{position:"absolute",display:"block",border:"0",top:n+"px",left:r+"px",width:i+"px",height:o+"px"})}else updateElementStyle(t.value,{width:(null==(r=e.value)?void 0:r.style.width)||"300px",height:(null==(i=e.value)?void 0:i.style.height)||"150px"})}}let index$b=0,maps;function getJSONP(e,t,n,r){var i,o=document.createElement("script"),s=t.callback||"callback",a="__uni_jsonp_callback_"+index$b++,c=t.timeout||3e4;function l(){clearTimeout(i),delete window[a],o.remove()}window[a]=e=>{isFunction$2(n)&&n(e),l()},o.onerror=()=>{isFunction$2(r)&&r(),l()},i=setTimeout(function(){isFunction$2(r)&&r(),l()},c),o.src=e+(e.indexOf("?")>=0?"&":"?")+s+"="+a,document.body.appendChild(o)}function createCallout(e){function t(){const e=this.div;this.getPanes().floatPane.appendChild(e)}function n(){const e=this.div.parentNode;e&&e.removeChild(this.div)}function r(){const t=this.option;this.Text=new e.Text({text:t.content,anchor:"bottom-center",offset:new e.Pixel(0,t.offsetY-16),style:{padding:(t.padding||8)+"px","line-height":(t.fontSize||14)+"px","border-radius":(t.borderRadius||0)+"px","border-color":`${t.bgColor||"#fff"} transparent transparent`,"background-color":t.bgColor||"#fff","box-shadow":"0 2px 6px 0 rgba(114, 124, 245, .5)","text-align":"center","font-size":(t.fontSize||14)+"px",color:t.color||"#000"},position:t.position});(e.event||e.Event).addListener(this.Text,"click",()=>{this.callback()}),this.Text.setMap(t.map)}function i(){}function o(){this.Text&&this.option.map.remove(this.Text)}function s(){this.Text&&this.option.map.remove(this.Text)}class a{constructor(e={},a){this.createAMapText=r,this.removeAMapText=o,this.createBMapText=i,this.removeBMapText=s,this.onAdd=t,this.construct=t,this.onRemove=n,this.destroy=n,this.option=e||{};const c=this.visible=this.alwaysVisible="ALWAYS"===e.display;if(getIsAMap())this.callback=a,this.visible&&this.createAMapText();else if(getIsBMap())this.visible&&this.createBMapText();else{const t=e.map;this.position=e.position,this.index=1;const n=this.div=document.createElement("div"),r=n.style;r.position="absolute",r.whiteSpace="nowrap",r.transform="translateX(-50%) translateY(-100%)",r.zIndex="1",r.boxShadow=e.boxShadow||"none",r.display=c?"block":"none";const i=this.triangle=document.createElement("div");i.setAttribute("style","position: absolute;white-space: nowrap;border-width: 4px;border-style: solid;border-color: #fff transparent transparent;border-image: initial;font-size: 12px;padding: 0px;background-color: transparent;width: 0px;height: 0px;transform: translate(-50%, 100%);left: 50%;bottom: 0;"),this.setStyle(e),n.appendChild(i),t&&this.setMap(t)}}set onclick(e){this.div.onclick=e}get onclick(){return this.div.onclick}setOption(e){this.option=e,"ALWAYS"===e.display?this.alwaysVisible=this.visible=!0:this.alwaysVisible=!1,getIsAMap()?this.visible&&this.createAMapText():getIsBMap()?this.visible&&this.createBMapText():(this.setPosition(e.position),this.setStyle(e))}setStyle(e){const t=this.div,n=t.style;t.innerText=e.content||"",n.lineHeight=(e.fontSize||14)+"px",n.fontSize=(e.fontSize||14)+"px",n.padding=(e.padding||8)+"px",n.color=e.color||"#000",n.borderRadius=(e.borderRadius||0)+"px",n.backgroundColor=e.bgColor||"#fff",n.marginTop="-"+((e.top||0)+5)+"px",this.triangle.style.borderColor=`${e.bgColor||"#fff"} transparent transparent`}setPosition(e){this.position=e,this.draw()}draw(){const e=this.getProjection();if(!this.position||!this.div||!e)return;const t=e.fromLatLngToDivPixel(this.position),n=this.div.style;n.left=t.x+"px",n.top=t.y+"px"}changed(){this.div.style.display=this.visible?"block":"none"}}if(!getIsAMap()&&!getIsBMap()){const t=new(e.OverlayView||e.Overlay);a.prototype.setMap=t.setMap,a.prototype.getMap=t.getMap,a.prototype.getPanes=t.getPanes,a.prototype.getProjection=t.getProjection,a.prototype.map_changed=t.map_changed,a.prototype.set=t.set,a.prototype.get=t.get,a.prototype.setOptions=t.setValues,a.prototype.bindTo=t.bindTo,a.prototype.bindsTo=t.bindsTo,a.prototype.notify=t.notify,a.prototype.setValues=t.setValues,a.prototype.unbind=t.unbind,a.prototype.unbindAll=t.unbindAll,a.prototype.addListener=t.addListener}return a}const callbacksMap={},GOOGLE_MAP_CALLBACKNAME="__map_callback__";function loadMaps(e,t){const n=getMapInfo();if(!n.key)return void console.error("Map key not configured.");const r=callbacksMap[n.type]=callbacksMap[n.type]||[];if(maps)t(maps);else if(window[n.type]&&window[n.type].maps)maps=getIsAMap()||getIsBMap()?window[n.type]:window[n.type].maps,maps.Callout=maps.Callout||createCallout(maps),t(maps);else if(r.length)r.push(t);else{r.push(t);const i=window,o=GOOGLE_MAP_CALLBACKNAME+n.type;i[o]=function(){delete i[o],maps=getIsAMap()||getIsBMap()?window[n.type]:window[n.type].maps,maps.Callout=createCallout(maps),r.forEach(e=>e(maps)),r.length=0},getIsAMap()&&handleAMapSecurityPolicy(n);const s=document.createElement("script");let a=getScriptBaseUrl(n.type);n.type===MapType.QQ&&e.push("geometry"),e.length&&(a+=`libraries=${e.join("%2C")}&`),n.type===MapType.BMAP?s.src=`${a}ak=${n.key}&callback=${o}`:s.src=`${a}key=${n.key}&callback=${o}`,s.onerror=function(){console.error("Map load failed.")},document.body.appendChild(s)}}const getScriptBaseUrl=e=>({qq:"https://map.qq.com/api/js?v=2.exp&",google:"https://maps.googleapis.com/maps/api/js?",AMap:"https://webapi.amap.com/maps?v=2.0&",BMapGL:"https://api.map.baidu.com/api?type=webgl&v=1.0&"}[e]);function handleAMapSecurityPolicy(e){window._AMapSecurityConfig={securityJsCode:e.securityJsCode||"",serviceHost:e.serviceHost||""}}const ICON_PATH_LOCTAION="M13.3334375 16 q0.033125 1.1334375 0.783125 1.8834375 q0.75 0.75 1.8834375 0.75 q1.1334375 0 1.8834375 -0.75 q0.75 -0.75 0.75 -1.8834375 q0 -1.1334375 -0.75 -1.8834375 q-0.75 -0.75 -1.8834375 -0.75 q-1.1334375 0 -1.8834375 0.75 q-0.75 0.75 -0.783125 1.8834375 ZM30.9334375 14.9334375 l-1.1334375 0 q-0.5 -5.2 -4.0165625 -8.716875 q-3.516875 -3.5165625 -8.716875 -4.0165625 l0 -1.1334375 q0 -0.4665625 -0.3 -0.7665625 q-0.3 -0.3 -0.7665625 -0.3 q-0.4665625 0 -0.7665625 0.3 q-0.3 0.3 -0.3 0.7665625 l0 1.1334375 q-5.2 0.5 -8.716875 4.0165625 q-3.5165625 3.516875 -4.0165625 8.716875 l-1.1334375 0 q-0.4665625 0 -0.7665625 0.3 q-0.3 0.3 -0.3 0.7665625 q0 0.4665625 0.3 0.7665625 q0.3 0.3 0.7665625 0.3 l1.1334375 0 q0.5 5.2 4.0165625 8.716875 q3.516875 3.5165625 8.716875 4.0165625 l0 1.1334375 q0 0.4665625 0.3 0.7665625 q0.3 0.3 0.7665625 0.3 q0.4665625 0 0.7665625 -0.3 q0.3 -0.3 0.3 -0.7665625 l0 -1.1334375 q5.2 -0.5 8.716875 -4.0165625 q3.5165625 -3.516875 4.0165625 -8.716875 l1.1334375 0 q0.4665625 0 0.7665625 -0.3 q0.3 -0.3 0.3 -0.7665625 q0 -0.4665625 -0.3 -0.7665625 q-0.3 -0.3 -0.7665625 -0.3 ZM17.0665625 27.6665625 l0 -2.0665625 q0 -0.4665625 -0.3 -0.7665625 q-0.3 -0.3 -0.7665625 -0.3 q-0.4665625 0 -0.7665625 0.3 q-0.3 0.3 -0.3 0.7665625 l0 2.0665625 q-4.3 -0.4665625 -7.216875 -3.383125 q-2.916875 -2.916875 -3.3834375 -7.216875 l2.0665625 0 q0.4665625 0 0.7665625 -0.3 q0.3 -0.3 0.3 -0.7665625 q0 -0.4665625 -0.3 -0.7665625 q-0.3 -0.3 -0.7665625 -0.3 l-2.0665625 0 q0.4665625 -4.3 3.3834375 -7.216875 q2.9165625 -2.916875 7.216875 -3.3834375 l0 2.0665625 q0 0.4665625 0.3 0.7665625 q0.3 0.3 0.7665625 0.3 q0.4665625 0 0.7665625 -0.3 q0.3 -0.3 0.3 -0.7665625 l0 -2.0665625 q4.3 0.4665625 7.216875 3.3834375 q2.9165625 2.9165625 3.383125 7.216875 l-2.0665625 0 q-0.4665625 0 -0.7665625 0.3 q-0.3 0.3 -0.3 0.7665625 q0 0.4665625 0.3 0.7665625 q0.3 0.3 0.7665625 0.3 l2.0665625 0 q-0.4665625 4.3 -3.383125 7.216875 q-2.916875 2.9165625 -7.216875 3.383125 Z",ICON_PATH_ORIGIN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAACECAMAAABmmnOVAAAC01BMVEUAAAAAef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef8Aef96quGStdqStdpbnujMzMzCyM7Gyc7Ky83MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMwAef8GfP0yjfNWnOp0qOKKsdyYt9mju9aZt9mMstx1qeJYnekyjvIIfP0qivVmouaWttnMzMyat9lppOUujPQKffxhoOfNzc3Y2Njh4eHp6enu7u7y8vL19fXv7+/i4uLZ2dnOzs6auNgOf/sKff15quHR0dHx8fH9/f3////j4+N6quFdn+iywdPb29vw8PD+/v7c3NyywtLa2tr29vbS0tLd3d38/Pzf39/o6Ojc7f+q0v+HwP9rsf9dqv9Hnv9Vpv/q6urj8P+Vx/9Am/8Pgf8Iff/z8/OAvP95uf/n5+c5l//V6f+52v+y1//7+/vt7e0rkP/09PTQ0NDq9P8Whf+cy//W1tbe3t7A3v/m5ubs7OxOov/r6+vk5OQiaPjKAAAAknRSTlMACBZ9oB71/jiqywJBZATT6hBukRXv+zDCAVrkDIf4JbQsTb7eVeJLbwfa8Rh4G/OlPS/6/kxQ9/xdmZudoJxNVhng7B6wtWdzAtQOipcF1329wS44doK/BAkyP1pvgZOsrbnGXArAg34G2IsD1eMRe7bi7k5YnqFT9V0csyPedQyYD3p/Fje+hDpskq/MwpRBC6yKp2MAAAQdSURBVHja7Zn1exMxGIAPHbrhDsPdneHuNtzd3d3dIbjLh93o2o4i7TpgG1Jk0g0mMNwd/gTa5rq129reHnK5e/bk/TFNk/dJ7r5894XjGAwGg8GgTZasCpDIll1+hxw5vXLJLpEboTx5ZXbIhyzkl9fB28cqUaCgrBKFkI3CcjoUKYolihWXUSI7EihRUjaHXF52CVRKLoe8eZIdUOkyMknkRw6UlcehYAFHiXK+skgURk6Ul8OhQjFnCVRRBolKqRxQ5SzUHaqgNGSj7VCmalqJnDkoS5RF6ZCbroNvufQkUD6qEuXTdUA+3hQdqiEXVKfnUKOmK4latalJ1EEuoZZ6162HJ9x/4OChw0eOHj12/MTJU6dxG7XUu751tjNnz4ET5y9ctLZTSr0beKFLl89bpuUDrqgC1RqNWqsKuqqzNFw7e51S6u3tc+OmZUJ9kCHY6ECwOkRvab51iUrqXej2HYDQsHBjWgx3Ae7dppB6N2wEcF9jdMGDUIDGTaR2aNoM9FqjG7QmaN5CWgc/gIePjG559BigpZQOrYB/4jBfRGRUtDkmJjY6KjLCofkpD62lc2gDfMpWPIuLdwyV8XEpHgaddBZ+wBuSFcwJqSN2ovmZ/dfnOvCTxqGtwzq8SEjv4EhISn48eWgnhUP7DvDSvgzxrs6vV6+FLiro2EkCic4QKkzwJsH1KYreCp0eQhfyDl1B/w4P/xa5JVJ4U03QjbRD9x7wXlgH5IE3wmMBHXoSlugFAcI6f/AkkSi8q6HQm6xDn77wEQ8djTwSj3tqAMguRTe4ikeOQyJ4YV+KfkQl+oNW5GbY4gWOWgbwJ+kwAD6Fi90MK2ZsrIeBBCUGwRXbqJ+/iJMQliIEBhOU6AJhtlG/IpHE2bqrYQg5h6HA4yQiRqwEfkGCdTCMmMRw+IbPDCQaHCsCYAQxiZHw3TbmD/ESOHgHwShiEqPhp/gggYkSztIxxCRawy/bmEniJaJtfwiEscQkxkFgRqJESqQwwHhiEuMBp3Vm8RK/cZoHEzKXhCK2QxEPpiJe0YlKCFaKCNv/cYBNUsBRPlkJSc0U+dM7E9H0ThGJbgZT/iR7yj+VqMS06Qr4+OFm2JdCxIa8lugzkJs5K6MfxAaYPUcBpYG5khZJEkUUSb7DPCnKRfPBXj6M8FwuegoLpCgXcQszVjhbJFUJUee2hBhLoYTIcYtB57KY+opSMdVqwatSlZVj05aV//CwJLMX2DluaUcwhXm4ali2XOoLjxUrPV26zFtF4f5p0Gp310+z13BUWNvbehEXona6iAtX/zVZmtfN4WixfsNky4S6gCCVVq3RPLdfSfpv3MRRZfPoLc6Xs/5bt3EyMGzE9h07/Xft2t15z6i9+zgGg8FgMBgMBoPBYDAYDAYj8/APG67Rie8pUDsAAAAASUVORK5CYII=",ICON_PATH_TARGET="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAACcCAMAAAC3Fl5oAAAB3VBMVEVMaXH/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/EhL/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/Dw//AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/GRn/NTX/Dw//Fhb/AAD/AAD/AAD/GRn/GRn/Y2P/AAD/AAD/ExP/Ghr/AAD/AAD/MzP/GRn/AAD/Hh7/AAD/RUX/AAD/AAD/AAD/AAD/AAD/AAD/Dg7/AAD/HR3/Dw//FRX/SUn/AAD/////kJD/DQ3/Zmb/+/v/wMD/mJj/6en/vb3/1NT//Pz/ODj/+fn/3Nz/nJz/j4//9/f/7e3/9vb/7Oz/2Nj/x8f/Ozv/+Pj/3d3/nZ3/2dn//f3/6Oj/2tr/v7//09P/vr7/mZn/l5cdSvP3AAAAe3RSTlMAAhLiZgTb/vztB/JMRhlp6lQW86g8mQ4KFPs3UCH5U8huwlesWtTYGI7RsdVeJGfTW5rxnutLsvXWF8vQNdo6qQbuz7D4hgVIx2xtw8GC1TtZaIw0i84P98tU0/fsj7PKaAgiZZxeVfo8Z52eg1P0nESrENnjXVPUgw/uuSmDAAADsUlEQVR42u3aZ3cTRxgF4GtbYleSLdnGcsENG2ODjbExEHrvhAQCIb1Bem+QdkeuuFMNBBJIfmuOckzZI8/srHYmH3Lm+QNXK632LTvQ03Tu/IWeU/tTGTKT2n+q58L5c00wpXJd47DHEt5w47pKxLbhdLdPKb/7dBYxVLxw1GcI/2h1BcpzKNFHLX2JQ4gumaiitqpEEhEdOMJI9h5AFC3feYzI+7IF2tpSLEOqDXpObPRYFm/jCWho/4Ble7MdoT7fzhhq9yHEz28wltU1UPrJZ0wd66HwicfYvEFIfePTAP8tSLTupBHvtGJFH9bSkNrNWEHzERrT34xSH9Ogr1CijkbVAUH1KRqVqkdQAw07iIAaGlcTqI+/0LjeJJ5J0IIEnkpXMdzs4sTtW9dnZq7fuj2xOMtwVWk88RHDjBYejYvnjD8qjOpfQsUqhvj7oSjxcJIhVj3pyKqpNjYvVjQ/RrXq5YABKi3MCYm5BSrtWO5v11DlmlC4RpU1WRS9SJU7QukOVbpQ9JLu549+Dd0AUOlTbkGEuk85vxLAK5QbuytC3R2j3HoAjZSbFxrmKTcCoJdSk0LLJKV6gSaPMqNTQsvUKGW8JrxKqUWhaZFSeWyh1LTQNE2pHF6mzOy40DQ+S5mLimJcENoKlOnBWsr8KbRNUGYt5LXgd6HtD3lNQIoyN4S2G5RJIUOZm0LbTcqsBqVmhLYZSlkPsP4VWf+Rrd+m1v9o9h8Vv5p42C1R5qL1x7WRglOgVN52yfwNOBu76P+lLPoYidu23KPciIHGa07ZeIW1jvcNtI7q5vexCPGYCmf+m/Y9a3sAwQ5bI9T7ukPgPcn9GToEao+xk1OixJT+GIsvNAbx6eAgPq0xiF+KtkpYKhRXCQ8eFFcJhSWGu3rZ8jJkCM8kz9K4TUnrC6mAgzTsB9tLwQ2W15qfosQ2GrQNpZr7aczbzVjBZsvLcaC1g0bsbIVEnU8DOr6H1KDH2LwtUBi0/JII6Dxm9zUXkH+XMWzfh1Dte1i2Pe3QkC77Zel7aehpO8wyHG6Dtt0NjKxhN6I4uSli/TqJiJJDUQ4NDCURXTrXRy1XcumyD24M+AzhD1RXIIZsl/LoyZmurJHDM7s8lvB2FQ/PmPJ6PseAXP5HGMYAAC7ABbgAF+ACXIALcAEuwAW4ABfgAlyAC3ABLsAFuID/d8Cx4NEt8/byOf0wLnis8zjMq9/Kp7bWw4JOj8u8TlhRl+G/Mp2wpOX48GffvvZ1CyL4B53LAS6zb08EAAAAAElFTkSuQmCC";var MapType=(e=>(e.QQ="qq",e.GOOGLE="google",e.AMAP="AMap",e.BMAP="BMapGL",e.UNKNOWN="",e))(MapType||{});function getMapInfo(){return __uniConfig.bMapKey?{type:"BMapGL",key:__uniConfig.bMapKey}:__uniConfig.qqMapKey?{type:"qq",key:__uniConfig.qqMapKey}:__uniConfig.googleMapKey?{type:"google",key:__uniConfig.googleMapKey}:__uniConfig.aMapKey?{type:"AMap",key:__uniConfig.aMapKey,securityJsCode:__uniConfig.aMapSecurityJsCode,serviceHost:__uniConfig.aMapServiceHost}:{type:"",key:""}}let IS_AMAP=!1,hasGetIsAMap=!1;const getIsAMap=()=>hasGetIsAMap?IS_AMAP:(hasGetIsAMap=!0,IS_AMAP="AMap"===getMapInfo().type),getIsBMap=()=>"BMapGL"===getMapInfo().type;function translateCoordinateSystem(e,t,n){const r=getMapInfo();return e&&"WGS84"===e.toUpperCase()||["google"].includes(r.type)||n?Promise.resolve(t):"qq"===r.type?new Promise(e=>{getJSONP(`https://apis.map.qq.com/ws/coord/v1/translate?type=1&locations=${t.latitude},${t.longitude}&key=${r.key}&output=jsonp`,{callback:"callback"},n=>{if("locations"in n&&n.locations.length){const{lng:r,lat:i}=n.locations[0];e({longitude:r,latitude:i,altitude:t.altitude,accuracy:t.accuracy,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,speed:t.speed})}else e(t)},()=>e(t))}):"AMap"===r.type?new Promise(e=>{loadMaps([],()=>{window.AMap.convertFrom([t.longitude,t.latitude],"gps",(n,r)=>{if("ok"===r.info&&r.locations.length){const{lat:n,lng:i}=r.locations[0];e({longitude:i,latitude:n,altitude:t.altitude,accuracy:t.accuracy,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,speed:t.speed})}else e(t)})})}):Promise.reject(new Error("translate coordinate system faild, map provider not configured or not supported"))}const props$e={id:{type:[Number,String],default:""},latitude:{type:[Number,String],require:!0},longitude:{type:[Number,String],require:!0},title:{type:String,default:""},iconPath:{type:String,require:!0},rotate:{type:[Number,String],default:0},alpha:{type:[Number,String],default:1},width:{type:[Number,String],default:""},height:{type:[Number,String],default:""},callout:{type:Object,default:null},label:{type:Object,default:null},anchor:{type:Object,default:null},clusterId:{type:[Number,String],default:""},customCallout:{type:Object,default:null},ariaLabel:{type:String,default:""}};function useMarkerLabelStyle(e){const t="uni-map-marker-label-"+e,n=document.createElement("style");return n.id=t,document.head.appendChild(n),onUnmounted(()=>{n.remove()}),function(e){const r=Object.assign({},e,{position:"absolute",top:"70px",borderStyle:"solid"}),i=document.createElement("div");return Object.keys(r).forEach(e=>{i.style[e]=r[e]||""}),n.innerText=`.${t}{${i.getAttribute("style")}}`,t}}const MapMarker=defineSystemComponent({name:"MapMarker",props:props$e,setup(e){const t=String(isNaN(Number(e.id))?"":e.id),n=inject("onMapReady"),r=useMarkerLabelStyle(t);let i;function o(e){getIsAMap()?e.removeAMapText():e.setMap(null)}if(n((n,s,a)=>{function c(e){const c=e.title;let l;l=getIsAMap()?new s.LngLat(e.longitude,e.latitude):getIsBMap()?new s.Point(e.longitude,e.latitude):new s.LatLng(e.latitude,e.longitude);const d=new Image;let u=0;d.onload=()=>{const p=e.anchor||{};let h,g,m,f,v="number"==typeof p.x?p.x:.5,y="number"==typeof p.y?p.y:1;e.iconPath&&(e.width||e.height)?(g=e.width||d.width/d.height*e.height,m=e.height||d.height/d.width*e.width):(g=d.width/2,m=d.height/2),u=m,f=m-(m-y*m),h="MarkerImage"in s?new s.MarkerImage(d.src,null,null,new s.Point(v*g,y*m),new s.Size(g,m)):"Icon"in s?new s.Icon({image:d.src,size:new s.Size(g,m),imageSize:new s.Size(g,m),imageOffset:new s.Pixel(v*g,y*m)}):{url:d.src,anchor:new s.Point(v,y),size:new s.Size(g,m)},getIsBMap()?(i=new s.Marker(new s.Point(l.lng,l.lat)),n.addOverlay(i)):(i.setPosition(l),i.setIcon(h)),"setRotation"in i&&i.setRotation(e.rotate||0);const _=e.label||{};let I;if("label"in i&&(i.label.setMap(null),delete i.label),_.content){const e={borderColor:_.borderColor,borderWidth:(Number(_.borderWidth)||0)+"px",padding:(Number(_.padding)||0)+"px",borderRadius:(Number(_.borderRadius)||0)+"px",backgroundColor:_.bgColor,color:_.color,fontSize:(_.fontSize||14)+"px",lineHeight:(_.fontSize||14)+"px",marginLeft:(Number(_.anchorX||_.x)||0)+"px",marginTop:(Number(_.anchorY||_.y)||0)+"px"};if("Label"in s)I=new s.Label({position:l,map:n,clickable:!1,content:_.content,style:e}),i.label=I;else if("setLabel"in i)if(getIsAMap()){const t=`<div style="\n                  margin-left:${e.marginLeft};\n                  margin-top:${e.marginTop};\n                  padding:${e.padding};\n                  background-color:${e.backgroundColor};\n                  border-radius:${e.borderRadius};\n                  line-height:${e.lineHeight};\n                  color:${e.color};\n                  font-size:${e.fontSize};\n\n                  ">\n                  ${_.content}\n                <div>`;i.setLabel({content:t,direction:"bottom-right"})}else{const t=r(e);i.setLabel({text:_.content,color:e.color,fontSize:e.fontSize,className:t})}}const T=e.callout||{};let S,E=i.callout;if(T.content||c){getIsAMap()&&T.content&&(T.content=T.content.replaceAll("\n","<br/>"));const r="0px 0px 3px 1px rgba(0,0,0,0.5)";let o=-u/2;if((e.width||e.height)&&(o+=14-u/2),S=T.content?{position:l,map:n,top:f,offsetY:o,content:T.content,color:T.color,fontSize:T.fontSize,borderRadius:T.borderRadius,bgColor:T.bgColor,padding:T.padding,boxShadow:T.boxShadow||r,display:T.display}:{position:l,map:n,top:f,offsetY:o,content:c,boxShadow:r},E)E.setOption(S);else if(getIsAMap()){const e=()=>{""!==t&&a("callouttap",{},{markerId:Number(t)})};E=i.callout=new s.Callout(S,e)}else E=i.callout=new s.Callout(S),E.div.onclick=function(e){""!==t&&a("callouttap",e,{markerId:Number(t)}),e.stopPropagation(),e.preventDefault()},getMapInfo().type===MapType.GOOGLE&&(E.div.ontouchstart=function(e){e.stopPropagation()},E.div.onpointerdown=function(e){e.stopPropagation()})}else E&&(o(E),delete i.callout)},e.iconPath?d.src=getRealPath(e.iconPath):console.error("Marker.iconPath is required.")}!function(e){getIsBMap()||(i=new s.Marker({map:n,flat:!0,autoRotation:!1})),c(e);const r=s.event||s.Event;getIsBMap()||r.addListener(i,"click",()=>{const n=i.callout;if(n&&!n.alwaysVisible)if(getIsAMap())n.visible=!n.visible,n.visible?i.callout.createAMapText():i.callout.removeAMapText();else if(n.set("visible",!n.visible),n.visible){const e=n.div,t=e.parentNode;t.removeChild(e),t.appendChild(e)}t&&a("markertap",{},{markerId:Number(t),latitude:e.latitude,longitude:e.longitude})})}(e),watch(e,c)}),t){const e=inject("addMapChidlContext"),r=inject("removeMapChidlContext"),o={id:t,translate(e){n((t,n,r)=>{const o=e.destination,s=e.duration,a=!!e.autoRotate;let c=Number(e.rotate)||0,l=0;"getRotation"in i&&(l=i.getRotation());const d=i.getPosition(),u=new n.LatLng(o.latitude,o.longitude),p=n.geometry.spherical.computeDistanceBetween(d,u)/1e3/(("number"==typeof s?s:1e3)/36e5),h=n.event||n.Event,g=h.addListener(i,"moving",e=>{const t=e.latLng,n=i.label;n&&n.setPosition(t);const r=i.callout;r&&r.setPosition(t)}),m=h.addListener(i,"moveend",()=>{m.remove(),g.remove(),i.lastPosition=d,i.setPosition(u);const t=i.label;t&&t.setPosition(u);const n=i.callout;n&&n.setPosition(u);const r=e.animationEnd;isFunction$2(r)&&r()});let f=0;a&&(i.lastPosition&&(f=n.geometry.spherical.computeHeading(i.lastPosition,d)),c=n.geometry.spherical.computeHeading(d,u)-f),"setRotation"in i&&i.setRotation(l+c),"moveTo"in i?i.moveTo(u,p):(i.setPosition(u),h.trigger(i,"moveend",{}))})}};e(o),onUnmounted(()=>r(o))}return onUnmounted(function(){i&&(i.label&&"setMap"in i.label&&i.label.setMap(null),i.callout&&o(i.callout),i.setMap(null))}),()=>null}});function hexToRgba(e){if(!e)return{r:0,g:0,b:0,a:0};let t=e.slice(1);const n=t.length;if(![3,4,6,8].includes(n))return{r:0,g:0,b:0,a:0};3!==n&&4!==n||(t=t.replace(/(\w{1})/g,"$1$1"));let[r,i,o,s]=t.match(/(\w{2})/g);const a=parseInt(r,16),c=parseInt(i,16),l=parseInt(o,16);return s?{r:a,g:c,b:l,a:(`0x100${s}`-65536)/255}:{r:a,g:c,b:l,a:1}}const props$d={points:{type:Array,require:!0},color:{type:String,default:"#000000"},width:{type:[Number,String],default:""},dottedLine:{type:[Boolean,String],default:!1},arrowLine:{type:[Boolean,String],default:!1},arrowIconPath:{type:String,default:""},borderColor:{type:String,default:"#000000"},borderWidth:{type:[Number,String],default:""},colorList:{type:Array,default:()=>[]},level:{type:String,default:""}},MapPolyline=defineSystemComponent({name:"MapPolyline",props:props$d,setup(e){let t,n;function r(){t&&t.setMap(null),n&&n.setMap(null)}return inject("onMapReady")((i,o)=>{function s(e){const r=[];e.points.forEach(e=>{let t;t=getIsAMap()?[e.longitude,e.latitude]:getIsBMap()?new o.Point(e.longitude,e.latitude):new o.LatLng(e.latitude,e.longitude),r.push(t)});const s=Number(e.width)||1,{r:a,g:c,b:l,a:d}=hexToRgba(e.color),{r:u,g:p,b:h,a:g}=hexToRgba(e.borderColor),m={map:i,clickable:!1,path:r,strokeWeight:s,strokeColor:e.color||void 0,strokeDashStyle:e.dottedLine?"dash":"solid"},f=Number(e.borderWidth)||0,v={map:i,clickable:!1,path:r,strokeWeight:s+2*f,strokeColor:e.borderColor||void 0,strokeDashStyle:e.dottedLine?"dash":"solid"};"Color"in o?(m.strokeColor=new o.Color(a,c,l,d),v.strokeColor=new o.Color(u,p,h,g)):(m.strokeColor=`rgb(${a}, ${c}, ${l})`,m.strokeOpacity=d,v.strokeColor=`rgb(${u}, ${p}, ${h})`,v.strokeOpacity=g),f&&(n=new o.Polyline(v)),getIsBMap()?(t=new o.Polyline(m.path,m),i.addOverlay(t)):t=new o.Polyline(m)}s(e),watch(e,function(e){r(),s(e)})}),onUnmounted(r),()=>null}}),props$c={latitude:{type:[Number,String],require:!0},longitude:{type:[Number,String],require:!0},color:{type:String,default:"#000000"},fillColor:{type:String,default:"#00000000"},radius:{type:[Number,String],require:!0},strokeWidth:{type:[Number,String],default:""},level:{type:String,default:""}},MapCircle=defineSystemComponent({name:"MapCircle",props:props$c,setup(e){let t;function n(){t&&t.setMap(null)}return inject("onMapReady")((r,i)=>{function o(e){const n=getIsAMap()||getIsBMap()?[e.longitude,e.latitude]:new i.LatLng(e.latitude,e.longitude),o={map:r,center:n,clickable:!1,radius:e.radius,strokeWeight:Number(e.strokeWidth)||1,strokeDashStyle:"solid"};if(getIsBMap())o.strokeColor=e.color,o.fillColor=e.fillColor||"#000",o.fillOpacity=1;else{const{r:t,g:n,b:r,a:s}=hexToRgba(e.fillColor),{r:a,g:c,b:l,a:d}=hexToRgba(e.color);"Color"in i?(o.fillColor=new i.Color(t,n,r,s),o.strokeColor=new i.Color(a,c,l,d)):(o.fillColor=`rgb(${t}, ${n}, ${r})`,o.fillOpacity=s,o.strokeColor=`rgb(${a}, ${c}, ${l})`,o.strokeOpacity=d)}if(getIsBMap()){let e=new i.Point(o.center[0],o.center[1]);t=new i.Circle(e,o.radius,o),r.addOverlay(t)}else t=new i.Circle(o),getIsAMap()&&r.add(t)}o(e),watch(e,function(e){n(),o(e)})}),onUnmounted(n),()=>null}}),props$b={id:{type:[Number,String],default:""},position:{type:Object,required:!0},iconPath:{type:String,required:!0},clickable:{type:[Boolean,String],default:""},trigger:{type:Function,required:!0}},MapControl=defineSystemComponent({name:"MapControl",props:props$b,setup(e){const t=computed$2(()=>getRealPath(e.iconPath)),n=computed$2(()=>{let t=`top:${e.position.top||0}px;left:${e.position.left||0}px;`;return e.position.width&&(t+=`width:${e.position.width}px;`),e.position.height&&(t+=`height:${e.position.height}px;`),t}),r=t=>{e.clickable&&e.trigger("controltap",t,{controlId:e.id})};return()=>createVNode("div",{class:"uni-map-control"},[createVNode("img",{src:t.value,style:n.value,class:"uni-map-control-icon",onClick:r},null,12,["src","onClick"])])}}),initInnerAudioContextEventOnce=once$1(()=>{innerAudioContextEventNames.forEach(e=>{InnerAudioContext.prototype[e]=function(t){isFunction$2(t)&&this._events[e].push(t)}}),innerAudioContextOffEventNames.forEach(e=>{InnerAudioContext.prototype[e]=function(t){var n=this._events[e.replace("off","on")],r=n.indexOf(t);r>=0&&n.splice(r,1)}})});class InnerAudioContext{constructor(){this._src="";var e=this._audio=new Audio;this._stoping=!1;["src","autoplay","loop","duration","currentTime","paused","volume"].forEach(t=>{Object.defineProperty(this,t,{set:"src"===t?t=>(e.src=getRealPath(t),this._src=t,t):n=>(e[t]=n,n),get:"src"===t?()=>this._src:()=>e[t]})}),this.startTime=0,Object.defineProperty(this,"obeyMuteSwitch",{set:()=>!1,get:()=>!1}),Object.defineProperty(this,"buffered",{get(){var t=e.buffered;return t.length?t.end(t.length-1):0}}),this._events={},innerAudioContextEventNames.forEach(e=>{this._events[e]=[]}),e.addEventListener("loadedmetadata",()=>{var t=Number(this.startTime)||0;t>0&&(e.currentTime=t)});var t=["canplay","pause","seeking","seeked","timeUpdate"];t.concat(["play","ended","error","waiting"]).forEach(n=>{e.addEventListener(n.toLowerCase(),()=>{if(this._stoping&&t.indexOf(n)>=0)return;const e=`on${n.slice(0,1).toUpperCase()}${n.slice(1)}`;this._events[e].forEach(e=>{e()})},!1)}),initInnerAudioContextEventOnce()}play(){this._stoping=!1,this._audio.play()}pause(){this._audio.pause()}stop(){this._stoping=!0,this._audio.pause(),this._audio.currentTime=0,this._events.onStop.forEach(e=>{e()})}seek(e){this._stoping=!1,"number"!=typeof(e=Number(e))||isNaN(e)||(this._audio.currentTime=e)}destroy(){this.stop()}}const createInnerAudioContext=defineSyncApi(API_CREATE_INNER_AUDIO_CONTEXT,()=>new InnerAudioContext),makePhoneCall=defineAsyncApi(API_MAKE_PHONE_CALL,({phoneNumber:e},{resolve:t})=>(window.location.href=`tel:${e}`,t())),UUID_KEY="__DC_STAT_UUID",storage=navigator.cookieEnabled&&(window.localStorage||window.sessionStorage)||{};let deviceId;function deviceId$1(){if(deviceId=deviceId||storage[UUID_KEY],!deviceId){deviceId=Date.now()+""+Math.floor(1e7*Math.random());try{storage[UUID_KEY]=deviceId}catch(e){}}return deviceId}function IEVersion(){const e=navigator.userAgent,t=e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1,n=e.indexOf("Edge")>-1&&!t,r=e.indexOf("Trident")>-1&&e.indexOf("rv:11.0")>-1;if(t){new RegExp("MSIE (\\d+\\.\\d+);").test(e);const t=parseFloat(RegExp.$1);return t>6?t:6}return n?-1:r?11:-1}function getTheme(){if(!0!==__uniConfig.darkmode)return isString$1(__uniConfig.darkmode)?__uniConfig.darkmode:"light";try{return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}catch(e){return"light"}}function getBrowserInfo(){let e,t="0",n="",r="phone";const i=navigator.language;if(isIOS){e="iOS";const r=ua.match(/OS\s([\w_]+)\slike/);r&&(t=r[1].replace(/_/g,"."));const i=ua.match(/\(([a-zA-Z]+);/);i&&(n=i[1])}else if(isAndroid){e="Android";const r=ua.match(/Android[\s/]([\w\.]+)[;\s]/);r&&(t=r[1]);const i=ua.match(/\((.+?)\)/),o=i?i[1].split(";"):ua.split(" "),s=[/\bAndroid\b/i,/\bLinux\b/i,/\bU\b/i,/^\s?[a-z][a-z]$/i,/^\s?[a-z][a-z]-[a-z][a-z]$/i,/\bwv\b/i,/\/[\d\.,]+$/,/^\s?[\d\.,]+$/,/\bBrowser\b/i,/\bMobile\b/i];for(let e=0;e<o.length;e++){const t=o[e];if(t.indexOf("Build")>0){n=t.split("Build")[0].trim();break}let r;for(let e=0;e<s.length;e++)if(s[e].test(t)){r=!0;break}if(!r){n=t.trim();break}}}else if(isIPadOS){if(n="iPad",e="iOS",r="pad",t=isFunction$2(window.BigInt)?"14.0":"13.0",14===parseInt(t)){const e=ua.match(/Version\/(\S*)\b/);e&&(t=e[1])}}else if(isWindows||isMac||isLinux){n="PC",e="PC",r="pc",t="0";let i=ua.match(/\((.+?)\)/)[1];if(isWindows){switch(e="Windows",isWindows[1]){case"5.1":t="XP";break;case"6.0":t="Vista";break;case"6.1":t="7";break;case"6.2":t="8";break;case"6.3":t="8.1";break;case"10.0":t="10"}const n=i&&i.match(/[Win|WOW]([\d]+)/);n&&(t+=` x${n[1]}`)}else if(isMac){e="macOS";const n=i&&i.match(/Mac OS X (.+)/)||"";t&&(t=n[1].replace(/_/g,"."),-1!==t.indexOf(";")&&(t=t.split(";")[0]))}else if(isLinux){e="Linux";const n=i&&i.match(/Linux (.*)/)||"";n&&(t=n[1],-1!==t.indexOf(";")&&(t=t.split(";")[0]))}}else e="Other",t="0",r="unknown";const o=`${e} ${t}`,s=e.toLowerCase();let a="",c=String(IEVersion());if("-1"!==c)a="IE";else{const e=["Version","Firefox","Chrome","Edge{0,1}"],t=["Safari","Firefox","Chrome","Edge"];for(let n=0;n<e.length;n++){const r=e[n],i=new RegExp(`(${r})/(\\S*)\\b`);i.test(ua)&&(a=t[n],c=ua.match(i)[2])}}let l="portrait";const d=void 0===window.screen.orientation?window.orientation:window.screen.orientation.angle;return l=90===Math.abs(d)?"landscape":"portrait",{deviceBrand:void 0,brand:void 0,deviceModel:n,deviceOrientation:l,model:n,system:o,platform:s,browserName:a.toLowerCase(),browserVersion:c,language:i,deviceType:r,ua:ua,osname:e,osversion:t,theme:getTheme()}}const getWindowInfo=defineSyncApi("getWindowInfo",()=>{const e=window.devicePixelRatio,t=getScreenFix(),n=isLandscape(t),r=getScreenWidth(t,n),i=getScreenHeight(t,n),o=getWindowWidth(r);let s=window.innerHeight;const a=safeAreaInsets$1.top,c={left:safeAreaInsets$1.left,right:o-safeAreaInsets$1.right,top:safeAreaInsets$1.top,bottom:s-safeAreaInsets$1.bottom,width:o-safeAreaInsets$1.left-safeAreaInsets$1.right,height:s-safeAreaInsets$1.top-safeAreaInsets$1.bottom},{top:l,bottom:d}=getWindowOffset();return s-=l,s-=d,{windowTop:l,windowBottom:d,windowWidth:o,windowHeight:s,pixelRatio:e,screenWidth:r,screenHeight:i,statusBarHeight:a,safeArea:c,safeAreaInsets:{top:safeAreaInsets$1.top,right:safeAreaInsets$1.right,bottom:safeAreaInsets$1.bottom,left:safeAreaInsets$1.left},screenTop:i-s}});let browserInfo,_initBrowserInfo=!0;function initBrowserInfo(){_initBrowserInfo&&(browserInfo=getBrowserInfo())}const getDeviceInfo=defineSyncApi("getDeviceInfo",()=>{initBrowserInfo();const{deviceBrand:e,deviceModel:t,brand:n,model:r,platform:i,system:o,deviceOrientation:s,deviceType:a,osname:c,osversion:l}=browserInfo;return extend$2({brand:n,deviceBrand:e,deviceModel:t,devicePixelRatio:window.devicePixelRatio,deviceId:deviceId$1(),deviceOrientation:s,deviceType:a,model:r,platform:i,system:o,osName:c?c.toLowerCase():void 0,osVersion:l})}),getAppBaseInfo=defineSyncApi("getAppBaseInfo",()=>{initBrowserInfo();const{theme:e,language:t,browserName:n,browserVersion:r}=browserInfo;return extend$2({appId:__uniConfig.appId,appName:__uniConfig.appName,appVersion:__uniConfig.appVersion,appVersionCode:__uniConfig.appVersionCode,appLanguage:getLocale?getLocale():t,enableDebug:!1,hostSDKVersion:void 0,hostPackageName:void 0,hostFontSizeSetting:void 0,hostName:n,hostVersion:r,hostTheme:e,hostLanguage:t,language:t,SDKVersion:"",theme:e,version:"",uniPlatform:"web",isUniAppX:!1,uniCompileVersion:__uniConfig.compilerVersion,uniCompilerVersion:__uniConfig.compilerVersion,uniRuntimeVersion:__uniConfig.compilerVersion},{})}),getSystemInfoSync=defineSyncApi("getSystemInfoSync",()=>{_initBrowserInfo=!0,initBrowserInfo(),_initBrowserInfo=!1;const e=getWindowInfo(),t=getDeviceInfo(),n=getAppBaseInfo();_initBrowserInfo=!0;const{ua:r,browserName:i,browserVersion:o,osname:s,osversion:a}=browserInfo,c=extend$2(e,t,n,{ua:r,browserName:i,browserVersion:o,uniPlatform:"web",uniCompileVersion:__uniConfig.compilerVersion,uniRuntimeVersion:__uniConfig.compilerVersion,fontSizeSetting:void 0,osName:s.toLowerCase(),osVersion:a,osLanguage:void 0,osTheme:void 0});return delete c.screenTop,delete c.enableDebug,__uniConfig.darkmode||delete c.theme,sortObject(c)}),getSystemInfo=defineAsyncApi("getSystemInfo",(e,{resolve:t})=>t(getSystemInfoSync())),API_ON_NETWORK_STATUS_CHANGE="onNetworkStatusChange";function networkListener(){getNetworkType().then(({networkType:e})=>{UniServiceJSBridge$1.invokeOnCallback(API_ON_NETWORK_STATUS_CHANGE,{isConnected:"none"!==e,networkType:e})})}function getConnection(){return navigator.connection||navigator.webkitConnection||navigator.mozConnection}const onNetworkStatusChange=defineOnApi(API_ON_NETWORK_STATUS_CHANGE,()=>{const e=getConnection();e?e.addEventListener("change",networkListener):(window.addEventListener("offline",networkListener),window.addEventListener("online",networkListener))}),offNetworkStatusChange=defineOffApi("offNetworkStatusChange",()=>{const e=getConnection();e?e.removeEventListener("change",networkListener):(window.removeEventListener("offline",networkListener),window.removeEventListener("online",networkListener))}),getNetworkType=defineAsyncApi("getNetworkType",(e,{resolve:t})=>{const n=getConnection();let r="unknown";return n?(r=n.type,"cellular"===r&&n.effectiveType?r=n.effectiveType.replace("slow-",""):!r&&n.effectiveType?r=n.effectiveType:["none","wifi"].includes(r)||(r="unknown")):!1===navigator.onLine&&(r="none"),t({networkType:r})});let listener$1=null;const onAccelerometerChange=defineOnApi(API_ON_ACCELEROMETER,()=>{startAccelerometer()}),offAccelerometerChange=defineOffApi(API_OFF_ACCELEROMETER,()=>{stopAccelerometer()}),startAccelerometer=defineAsyncApi(API_START_ACCELEROMETER,(e,{resolve:t,reject:n})=>{if(window.DeviceMotionEvent){if(!listener$1){if(DeviceMotionEvent.requestPermission)return void DeviceMotionEvent.requestPermission().then(e=>{"granted"===e?(r(),t()):n(`${e}`)}).catch(e=>{n(`${e}`)});r()}t()}else n();function r(){listener$1=function(e){const t=e.acceleration||e.accelerationIncludingGravity;UniServiceJSBridge$1.invokeOnCallback(API_ON_ACCELEROMETER,{x:t&&t.x||0,y:t&&t.y||0,z:t&&t.z||0})},window.addEventListener("devicemotion",listener$1,!1)}}),stopAccelerometer=defineAsyncApi(API_STOP_ACCELEROMETER,(e,{resolve:t})=>{listener$1&&(window.removeEventListener("devicemotion",listener$1,!1),listener$1=null),t()});let listener=null;const onCompassChange=defineOnApi(API_ON_COMPASS,()=>{startCompass()}),offCompassChange=defineOffApi(API_OFF_COMPASS,()=>{stopCompass()}),startCompass=defineAsyncApi(API_START_COMPASS,(e,{resolve:t,reject:n})=>{if(window.DeviceOrientationEvent){if(!listener){if(DeviceOrientationEvent.requestPermission)return void DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e?(r(),t()):n(`${e}`)}).catch(e=>{n(`${e}`)});r()}t()}else n();function r(){listener=function(e){const t=360-(null!==e.alpha?e.alpha:360);UniServiceJSBridge$1.invokeOnCallback(API_ON_COMPASS,{direction:t})},window.addEventListener("deviceorientation",listener,!1)}}),stopCompass=defineAsyncApi(API_STOP_COMPASS,(e,{resolve:t})=>{listener&&(window.removeEventListener("deviceorientation",listener,!1),listener=null),t()}),_isSupport=!!window.navigator.vibrate,vibrateShort=defineAsyncApi(API_VIBRATE_SHORT,(e,{resolve:t,reject:n})=>{_isSupport&&window.navigator.vibrate(15)?t():n("vibrateLong:fail")}),vibrateLong=defineAsyncApi(API_VIBRATE_LONG,(e,{resolve:t,reject:n})=>{_isSupport&&window.navigator.vibrate(400)?t():n("vibrateLong:fail")});var __async=(e,t,n)=>new Promise((r,i)=>{var o=e=>{try{a(n.next(e))}catch(t){i(t)}},s=e=>{try{a(n.throw(e))}catch(t){i(t)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())});const getClipboardData=defineAsyncApi(API_GET_CLIPBOARD_DATA,(e,t)=>__async(void 0,[e,t],function*(e,{resolve:t,reject:n}){initI18nGetClipboardDataMsgsOnce();const{t:r}=useI18n();try{t({data:yield navigator.clipboard.readText()})}catch(i){_getClipboardData(t,()=>{n(`${i} ${r("uni.getClipboardData.fail")}`)})}})),setClipboardData=defineAsyncApi(API_SET_CLIPBOARD_DATA,(e,t)=>__async(void 0,[e,t],function*({data:e},{resolve:t,reject:n}){try{yield navigator.clipboard.writeText(e),t()}catch(r){_setClipboardData(e,t,n)}}),SetClipboardDataProtocol,SetClipboardDataOptions);function _getClipboardData(e,t){const n=document.getElementById("#clipboard"),r=n?n.value:void 0;r?e({data:r}):t()}function _setClipboardData(e,t,n){const r=document.getElementById("#clipboard");r&&r.remove();const i=document.createElement("textarea");i.setAttribute("inputmode","none"),i.id="#clipboard",i.style.position="fixed",i.style.top="-9999px",i.style.zIndex="-9999",document.body.appendChild(i),i.value=e,i.select(),i.setSelectionRange(0,i.value.length);const o=document.execCommand("Copy",!1);i.blur(),o?t():n()}const themeChangeCallBack=e=>{UniServiceJSBridge$1.invokeOnCallback(ON_THEME_CHANGE,e)},onThemeChange$1=defineOnApi(ON_THEME_CHANGE,()=>{UniServiceJSBridge$1.on(ON_THEME_CHANGE,themeChangeCallBack)}),offThemeChange$1=defineOffApi(OFF_THEME_CHANGE,()=>{UniServiceJSBridge$1.off(ON_THEME_CHANGE,themeChangeCallBack)}),STORAGE_KEYS="uni-storage-keys";function parseValue(e){const t=["object","string","number","boolean","undefined"];try{const n=isString$1(e)?JSON.parse(e):e,r=n.type;if(t.indexOf(r)>=0){const e=Object.keys(n);if(2===e.length&&"data"in n){if(typeof n.data===r)return n.data;if("object"===r&&/^\d{4}-\d{2}-\d{2}T\d{2}\:\d{2}\:\d{2}\.\d{3}Z$/.test(n.data))return new Date(n.data)}else if(1===e.length)return""}}catch(n){}}const setStorageSync=defineSyncApi(API_SET_STORAGE_SYNC,(e,t)=>{const n=typeof t,r="string"===n?t:JSON.stringify({type:n,data:t});localStorage.setItem(e,r)}),setStorage=defineAsyncApi(API_SET_STORAGE,({key:e,data:t},{resolve:n,reject:r})=>{try{setStorageSync(e,t),n()}catch(i){r(i.message)}});function getStorageOrigin(e){const t=localStorage&&localStorage.getItem(e);if(!isString$1(t))throw new Error("data not found");let n=t;try{const e=parseValue(JSON.parse(t));void 0!==e&&(n=e)}catch(r){}return n}const getStorageSync=defineSyncApi(API_GET_STORAGE_SYNC,e=>{try{return getStorageOrigin(e)}catch(t){return""}}),getStorage=defineAsyncApi(API_GET_STORAGE,({key:e},{resolve:t,reject:n})=>{try{t({data:getStorageOrigin(e)})}catch(r){n(r.message)}}),removeStorageSync=defineSyncApi(API_REMOVE_STORAGE,e=>{localStorage&&localStorage.removeItem(e)}),removeStorage=defineAsyncApi(API_REMOVE_STORAGE,({key:e},{resolve:t})=>{removeStorageSync(e),t()}),clearStorageSync=defineSyncApi("clearStorageSync",()=>{localStorage&&localStorage.clear()}),clearStorage=defineAsyncApi("clearStorage",(e,{resolve:t})=>{clearStorageSync(),t()}),getStorageInfoSync=defineSyncApi("getStorageInfoSync",()=>{const e=localStorage&&localStorage.length||0,t=[];let n=0;for(let r=0;r<e;r++){const e=localStorage.key(r),i=localStorage.getItem(e)||"";n+=e.length+i.length,e!==STORAGE_KEYS&&t.push(e)}return{keys:t,currentSize:Math.ceil(2*n/1024),limitSize:Number.MAX_VALUE}}),getStorageInfo=defineAsyncApi("getStorageInfo",(e,{resolve:t})=>{t(getStorageInfoSync())}),getFileInfo=defineAsyncApi(API_GET_FILE_INFO,({filePath:e},{resolve:t,reject:n})=>{urlToFile(e).then(e=>{t({size:e.size})}).catch(e=>{n(String(e))})},GetFileInfoProtocol,GetFileInfoOptions),openDocument=defineAsyncApi(API_OPEN_DOCUMENT,({filePath:e},{resolve:t})=>(window.open(e),t()),OpenDocumentProtocol,OpenDocumentOptions),hideKeyboard=defineAsyncApi(API_HIDE_KEYBOARD,(e,{resolve:t,reject:n})=>{const r=document.activeElement;!r||"TEXTAREA"!==r.tagName&&"INPUT"!==r.tagName||(r.blur(),t())});function getServiceAddress(){return window.location.protocol+"//"+window.location.host}const getImageInfo=defineAsyncApi(API_GET_IMAGE_INFO,({src:e},{resolve:t,reject:n})=>{const r=new Image;r.onload=function(){t({width:r.naturalWidth,height:r.naturalHeight,path:0===e.indexOf("/")?getServiceAddress()+e:e})},r.onerror=function(){n()},r.src=e},GetImageInfoProtocol,GetImageInfoOptions),getVideoInfo=defineAsyncApi(API_GET_VIDEO_INFO,({src:e},{resolve:t,reject:n})=>{urlToFile(e,!0).then(e=>e).catch(()=>null).then(r=>{const i=document.createElement("video");if(void 0!==i.onloadedmetadata){const o=setTimeout(()=>{i.onloadedmetadata=null,i.onerror=null,n()},e.startsWith("data:")||e.startsWith("blob:")?300:3e3);i.onloadedmetadata=function(){clearTimeout(o),i.onerror=null,t({size:Math.ceil((r?r.size:0)/1024),duration:i.duration||0,width:i.videoWidth||0,height:i.videoHeight||0})},i.onerror=function(){clearTimeout(o),i.onloadedmetadata=null,n()},i.src=e}else n()})},GetVideoInfoProtocol,GetVideoInfoOptions),MIMEType={image:{jpg:"jpeg",jpe:"jpeg",pbm:"x-portable-bitmap",pgm:"x-portable-graymap",pnm:"x-portable-anymap",ppm:"x-portable-pixmap",psd:"vnd.adobe.photoshop",pic:"x-pict",rgb:"x-rgb",svg:"svg+xml",svgz:"svg+xml",tif:"tiff",xif:"vnd.xiff",wbmp:"vnd.wap.wbmp",wdp:"vnd.ms-photo",xbm:"x-xbitmap",ico:"x-icon"},video:{"3g2":"3gpp2","3gp":"3gpp",avi:"x-msvideo",f4v:"x-f4v",flv:"x-flv",jpgm:"jpm",jpgv:"jpeg",m1v:"mpeg",m2v:"mpeg",mpe:"mpeg",mpg:"mpeg",mpg4:"mpeg",m4v:"x-m4v",mkv:"x-matroska",mov:"quicktime",qt:"quicktime",movie:"x-sgi-movie",mp4v:"mp4",ogv:"ogg",smv:"x-smv",wm:"x-ms-wm",wmv:"x-ms-wmv",wmx:"x-ms-wmx",wvx:"x-ms-wvx"}},ALL="all";function isWXEnv(){const e=window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i);return!(!e||"micromessenger"!==e[0])}function _createInput({count:e,sourceType:t,type:n,extension:r}){addInteractListener();const i=document.createElement("input");return i.type="file",updateElementStyle(i,{position:"absolute",visibility:"hidden",zIndex:"-999",width:"0",height:"0",top:"0",left:"0"}),i.accept=r.map(e=>{if(n!==ALL){const t=e.replace(".","");return`${n}/${MIMEType[n][t]||t}`}return isWXEnv()?".":0===e.indexOf(".")?e:`.${e}`}).join(","),e&&e>1&&(i.multiple=!0),n!==ALL&&t instanceof Array&&1===t.length&&"camera"===t[0]&&i.setAttribute("capture","camera"),i}let fileInput=null;const chooseFile=defineAsyncApi(API_CHOOSE_FILE,({count:e,sourceType:t,type:n,extension:r},{resolve:i,reject:o})=>{initI18nChooseFileMsgsOnce();const{t:s}=useI18n();fileInput&&(document.body.removeChild(fileInput),fileInput=null),fileInput=_createInput({count:e,sourceType:t,type:n,extension:r}),document.body.appendChild(fileInput),fileInput.addEventListener("cancel",()=>{o("chooseFile:fail cancel")}),fileInput.addEventListener("change",function(t){const n=t.target,r=[];if(n&&n.files){const t=n.files.length;for(let i=0;i<t;i++){const t=n.files[i];let o;Object.defineProperty(t,"path",{get:()=>(o=o||fileToUrl(t),o)}),i<e&&r.push(t)}}i({get tempFilePaths(){return r.map(({path:e})=>e)},tempFiles:r})}),fileInput.click(),getInteractStatus()||console.warn(s("uni.chooseFile.notUserActivation"))},ChooseFileProtocol,ChooseFileOptions);let imageInput=null;const chooseImage=defineAsyncApi(API_CHOOSE_IMAGE,({count:e,sourceType:t,extension:n},{resolve:r,reject:i})=>{initI18nChooseFileMsgsOnce();const{t:o}=useI18n();imageInput&&(document.body.removeChild(imageInput),imageInput=null),imageInput=_createInput({count:e,sourceType:t,extension:n,type:"image"}),document.body.appendChild(imageInput),imageInput.addEventListener("cancel",()=>{i("chooseImage:fail cancel")}),imageInput.addEventListener("change",function(t){const n=t.target,i=[];if(n&&n.files){const t=n.files.length;for(let r=0;r<t;r++){const t=n.files[r];let o;Object.defineProperty(t,"path",{get:()=>(o=o||fileToUrl(t),o)}),r<e&&i.push(t)}}r({get tempFilePaths(){return i.map(({path:e})=>e)},tempFiles:i})}),imageInput.click(),getInteractStatus()||console.warn(o("uni.chooseFile.notUserActivation"))},ChooseImageProtocol,ChooseImageOptions),KEY_MAPS={esc:["Esc","Escape"],enter:["Enter"]},KEYS=Object.keys(KEY_MAPS);function useKeyboard(){const e=ref(""),t=ref(!1),n=n=>{if(t.value)return;const r=KEYS.find(e=>-1!==KEY_MAPS[e].indexOf(n.key));r&&(e.value=r),nextTick(()=>e.value="")};return onMounted(()=>{document.addEventListener("keyup",n)}),onBeforeUnmount(()=>{document.removeEventListener("keyup",n)}),{key:e,disable:t}}const VNODE_MASK=createVNode("div",{class:"uni-mask"},null,-1);function createRootApp(e,t,n){return t.onClose=(...e)=>(t.visible=!1,n.apply(null,e)),createApp$1(defineComponent({setup:()=>()=>(openBlock(),createBlock(e,t,null,16))}))}function ensureRoot(e){let t=document.getElementById(e);return t||(t=document.createElement("div"),t.id=e,document.body.append(t)),t}function usePopup(e,{onEsc:t,onEnter:n}){const r=ref(e.visible),{key:i,disable:o}=useKeyboard();return watch(()=>e.visible,e=>r.value=e),watch(()=>r.value,e=>o.value=!e),watchEffect(()=>{const{value:e}=i;"esc"===e?t&&t():"enter"===e&&n&&n()}),r}let index$a=0,overflow="";function preventScroll(e){let t=index$a;index$a+=e?1:-1,index$a=Math.max(0,index$a),index$a>0?0===t&&(overflow=document.body.style.overflow,document.body.style.overflow="hidden"):(document.body.style.overflow=overflow,overflow="")}function usePreventScroll(){onMounted(()=>preventScroll(!0)),onUnmounted(()=>preventScroll(!1))}const props$a={src:{type:String,default:""}},ImageView=defineSystemComponent({name:"ImageView",props:props$a,setup(e){const t=reactive({direction:"none"});let n=1,r=0,i=0,o=0,s=0;function a({detail:e}){n=e.scale}function c(e){const t=e.target.getBoundingClientRect();r=t.width,i=t.height}function l(e){const t=e.target.getBoundingClientRect();o=t.width,s=t.height,u(e)}function d(e){const a=n*r>o,c=n*i>s;t.direction=a&&c?"all":a?"horizontal":c?"vertical":"none",u(e)}function u(e){"all"!==t.direction&&"horizontal"!==t.direction||e.stopPropagation()}return()=>{const n={position:"absolute",left:"0",top:"0",width:"100%",height:"100%"};return createVNode(MovableArea,{style:n,onTouchstart:withWebEvent(l),onTouchmove:withWebEvent(u),onTouchend:withWebEvent(d)},{default:()=>[createVNode(MovableView,{style:n,direction:t.direction,inertia:!0,scale:!0,"scale-min":"1","scale-max":"4",onScale:a},{default:()=>[createVNode("img",{src:e.src,style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",maxHeight:"100%",maxWidth:"100%"},onLoad:c},null,40,["src","onLoad"])]},8,["style","direction","inertia","scale","onScale"])]},8,["style","onTouchstart","onTouchmove","onTouchend"])}}});function _isSlot$2(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!isVNode(e)}const props$9={urls:{type:Array,default:()=>[]},current:{type:[Number,String],default:0}};function getIndex(e){let t="number"==typeof e.current?e.current:e.urls.indexOf(e.current);return t=t<0?0:t,t}const ImagePreview=defineSystemComponent({name:"ImagePreview",props:props$9,emits:["close"],setup(e,{emit:t}){usePreventScroll();const{key:n}=useKeyboard(),r=ref(null),i=ref(getIndex(e));let o;function s(){o||nextTick(()=>{t("close")})}function a(e){i.value=e.detail.current}watch(()=>e.current,()=>i.value=getIndex(e)),watch(()=>n.value,e=>{"esc"===e&&s()}),onMounted(()=>{const e=r.value;let t=0,n=0;e.addEventListener("mousedown",e=>{o=!1,t=e.clientX,n=e.clientY}),e.addEventListener("mouseup",e=>{(Math.abs(e.clientX-t)>20||Math.abs(e.clientY-n)>20)&&(o=!0)})});const c={position:"absolute","box-sizing":"border-box",top:"0",right:"0",width:"60px",height:"44px",padding:"6px","line-height":"32px","font-size":"26px",color:"white","text-align":"center",cursor:"pointer"};return()=>{let t;return createVNode("div",{ref:r,style:{display:"block",position:"fixed",left:"0",top:"0",width:"100%",height:"100%",zIndex:999,background:"rgba(0,0,0,0.8)"},onClick:s},[createVNode(Swiper,{navigation:"auto",current:i.value,onChange:a,"indicator-dots":!1,autoplay:!1,style:{position:"absolute",left:"0",top:"0",width:"100%",height:"100%"}},_isSlot$2(t=e.urls.map(e=>createVNode(SwiperItem,null,{default:()=>[createVNode(ImageView,{src:e},null,8,["src"])]})))?t:{default:()=>[t],_:1},8,["current","onChange"]),createVNode("div",{style:c},[createSvgIconVNode(ICON_PATH_CLOSE,"#ffffff",26)],4)],8,["onClick"])}}});let state$2=null,imagePreviewInstance;const closePreviewImageView=()=>{state$2=null,nextTick(()=>{null==imagePreviewInstance||imagePreviewInstance.unmount(),imagePreviewInstance=null})},previewImage=defineAsyncApi(API_PREVIEW_IMAGE,(e,{resolve:t})=>{state$2?extend$2(state$2,e):(state$2=reactive(e),nextTick(()=>{imagePreviewInstance=createRootApp(ImagePreview,state$2,closePreviewImageView),imagePreviewInstance.mount(ensureRoot("u-a-p"))})),t()},PreviewImageProtocol,PreviewImageOptions),closePreviewImage=defineAsyncApi(API_CLOSE_PREVIEW_IMAGE,(e,{resolve:t,reject:n})=>{imagePreviewInstance?(closePreviewImageView(),t()):n()});let videoInput=null;const chooseVideo=defineAsyncApi(API_CHOOSE_VIDEO,({sourceType:e,extension:t},{resolve:n,reject:r})=>{initI18nChooseFileMsgsOnce();const{t:i}=useI18n();videoInput&&(document.body.removeChild(videoInput),videoInput=null),videoInput=_createInput({sourceType:e,extension:t,type:"video"}),document.body.appendChild(videoInput),videoInput.addEventListener("cancel",()=>{r("chooseVideo:fail cancel")}),videoInput.addEventListener("change",function(e){const t=e.target.files[0];let r="";const i={tempFilePath:r,tempFile:t,size:t.size,duration:0,width:0,height:0,name:t.name};Object.defineProperty(i,"tempFilePath",{get(){return r=r||fileToUrl(this.tempFile),r}});const o=document.createElement("video");if(void 0!==o.onloadedmetadata){const e=fileToUrl(t);o.onloadedmetadata=function(){revokeObjectURL(e),n(extend$2(i,{duration:o.duration||0,width:o.videoWidth||0,height:o.videoHeight||0}))},setTimeout(()=>{o.onloadedmetadata=null,revokeObjectURL(e),n(i)},300),o.src=e}else n(i)}),videoInput.click(),getInteractStatus()||console.warn(i("uni.chooseFile.notUserActivation"))},ChooseVideoProtocol,ChooseVideoOptions),request$2=defineTaskApi(API_REQUEST,({url:e,data:t,header:n={},method:r,dataType:i,responseType:o,enableChunked:s,withCredentials:a,timeout:c=__uniConfig.networkTimeout.request},{resolve:l,reject:d})=>{let u=null;const p=normalizeContentType(n);if("GET"!==r)if(isString$1(t)||t instanceof ArrayBuffer)u=t;else if("json"===p)try{u=JSON.stringify(t)}catch(g){u=t.toString()}else if("urlencoded"===p){const e=[];for(const n in t)hasOwn$1(t,n)&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));u=e.join("&")}else u=t.toString();let h;if(s){if(void 0===typeof window.fetch||void 0===typeof window.AbortController)throw new Error("fetch or AbortController is not supported in this environment");const t=new AbortController,s=t.signal;h=new RequestTask(t);const p={method:r,headers:n,body:u,signal:s,credentials:a?"include":"same-origin"},g=setTimeout(function(){h.abort(),d("timeout",{errCode:5})},c);p.signal.addEventListener("abort",function(){clearTimeout(g),d("abort",{errCode:600003})}),window.fetch(e,p).then(e=>{const t=e.status,n=e.headers,r=e.body,s={};n.forEach((e,t)=>{s[t]=e});const a=cookiesParse(s);if(h._emitter.emit("headersReceived",{header:s,statusCode:t,cookies:a}),!r)return void l({data:"",statusCode:t,header:s,cookies:a});const c=r.getReader(),d=[],u=()=>{c.read().then(({done:e,value:n})=>{if(e){const e=concatArrayBuffers(d);let n="text"===o?(new TextDecoder).decode(e):e;return"text"===o&&(n=parseResponseText(n,o,i)),void l({data:n,statusCode:t,header:s,cookies:a})}const r=n;d.push(r),h._emitter.emit("chunkReceived",{data:r}),u()})};u()},e=>{d(e,{errCode:5})})}else{const t=new XMLHttpRequest;h=new RequestTask(t),t.open(r,e);for(const e in n)hasOwn$1(n,e)&&t.setRequestHeader(e,n[e]);const s=setTimeout(function(){t.onload=t.onabort=t.onerror=null,h.abort(),d("timeout",{errCode:5})},c);t.responseType=o,t.onload=function(){clearTimeout(s);const e=t.status;let n="text"===o?t.responseText:t.response;"text"===o&&(n=parseResponseText(n,o,i)),l({data:n,statusCode:e,header:parseHeaders$1(t.getAllResponseHeaders()),cookies:[]})},t.onabort=function(){clearTimeout(s),d("abort",{errCode:600003})},t.onerror=function(){clearTimeout(s),d(void 0,{errCode:5})},t.withCredentials=a,t.send(u)}return h},RequestProtocol,RequestOptions),cookiesParse=e=>{let t=e["Set-Cookie"]||e["set-cookie"],n=[];if(!t)return[];"["===t[0]&&"]"===t[t.length-1]&&(t=t.slice(1,-1));const r=t.split(";");for(let i=0;i<r.length;i++)-1!==r[i].indexOf("Expires=")||-1!==r[i].indexOf("expires=")?n.push(r[i].replace(",","")):n.push(r[i]);return n=n.join(";").split(","),n};function concatArrayBuffers(e){const t=e.reduce((e,t)=>e+t.byteLength,0),n=new Uint8Array(t);let r=0;for(const i of e)n.set(new Uint8Array(i),r),r+=i.byteLength;return n.buffer}function normalizeContentType(e){const t=Object.keys(e).find(e=>"content-type"===e.toLowerCase());if(!t)return;const n=e[t];return 0===n.indexOf("application/json")?"json":0===n.indexOf("application/x-www-form-urlencoded")?"urlencoded":"string"}class RequestTask{constructor(e){this._requestOnChunkReceiveCallbackId=0,this._requestOnChunkReceiveCallbacks=new Map,this._requestOnHeadersReceiveCallbackId=0,this._requestOnHeadersReceiveCallbacks=new Map,this._emitter=new E$1$1,this._controller=e}abort(){this._controller&&(this._controller.abort(),delete this._controller)}onHeadersReceived(e){return this._emitter.on("headersReceived",e),this._requestOnHeadersReceiveCallbackId++,this._requestOnHeadersReceiveCallbacks.set(this._requestOnHeadersReceiveCallbackId,e),this._requestOnHeadersReceiveCallbackId}offHeadersReceived(e){if(null==e)return void this._emitter.off("headersReceived");if("function"==typeof e)return void this._requestOnHeadersReceiveCallbacks.forEach((t,n)=>{t===e&&(this._requestOnHeadersReceiveCallbacks.delete(n),this._emitter.off("headersReceived",e))});const t=this._requestOnHeadersReceiveCallbacks.get(e);t&&(this._requestOnHeadersReceiveCallbacks.delete(e),this._emitter.off("headersReceived",t))}onChunkReceived(e){return this._emitter.on("chunkReceived",e),this._requestOnChunkReceiveCallbackId++,this._requestOnChunkReceiveCallbacks.set(this._requestOnChunkReceiveCallbackId,e),this._requestOnChunkReceiveCallbackId}offChunkReceived(e){if(null==e)return void this._emitter.off("chunkReceived");if("function"==typeof e)return void this._requestOnChunkReceiveCallbacks.forEach((t,n)=>{t===e&&(this._requestOnChunkReceiveCallbacks.delete(n),this._emitter.off("chunkReceived",e))});const t=this._requestOnChunkReceiveCallbacks.get(e);t&&(this._requestOnChunkReceiveCallbacks.delete(e),this._emitter.off("chunkReceived",t))}}function parseHeaders$1(e){const t={};return e.split(LINEFEED).forEach(e=>{const n=e.match(/(\S+\s*):\s*(.*)/);n&&3===n.length&&(t[n[1]]=n[2])}),t}function parseResponseText(e,t,n){let r=e;if("text"===t&&"json"===n)try{r=JSON.parse(r)}catch(i){}return r}class DownloadTask{constructor(e){this._callbacks=[],this._xhr=e}onProgressUpdate(e){isFunction$2(e)&&this._callbacks.push(e)}offProgressUpdate(e){const t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)}abort(){this._xhr&&(this._xhr.abort(),delete this._xhr)}onHeadersReceived(e){throw new Error("Method not implemented.")}offHeadersReceived(e){throw new Error("Method not implemented.")}}const downloadFile=defineTaskApi(API_DOWNLOAD_FILE,({url:e,header:t={},timeout:n=__uniConfig.networkTimeout.downloadFile},{resolve:r,reject:i})=>{var o,s=new XMLHttpRequest,a=new DownloadTask(s);return s.open("GET",e,!0),Object.keys(t).forEach(e=>{s.setRequestHeader(e,t[e])}),s.responseType="blob",s.onload=function(){clearTimeout(o);const t=s.status,n=this.response;let i;const a=s.getResponseHeader("content-disposition");if(a){const e=a.match(/filename="?(\S+)"?\b/);e&&(i=e[1])}n.name=i||getFileName(e),r({statusCode:t,tempFilePath:fileToUrl(n)})},s.onabort=function(){clearTimeout(o),i("abort",{errCode:600003})},s.onerror=function(){clearTimeout(o),i("",{errCode:602001})},s.onprogress=function(e){a._callbacks.forEach(t=>{var n=e.loaded,r=e.total;t({progress:Math.round(n/r*100),totalBytesWritten:n,totalBytesExpectedToWrite:r})})},s.send(),o=setTimeout(function(){s.onprogress=s.onload=s.onabort=s.onerror=null,a.abort(),i("timeout",{errCode:5})},n),a},DownloadFileProtocol,DownloadFileOptions);class UploadTask{constructor(e){this._callbacks=[],this._xhr=e}onProgressUpdate(e){isFunction$2(e)&&this._callbacks.push(e)}offProgressUpdate(e){const t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)}abort(){this._isAbort=!0,this._xhr&&(this._xhr.abort(),delete this._xhr)}onHeadersReceived(e){throw new Error("Method not implemented.")}offHeadersReceived(e){throw new Error("Method not implemented.")}}const uploadFile=defineTaskApi(API_UPLOAD_FILE,({url:e,file:t,filePath:n,name:r,files:i,header:o={},formData:s={},timeout:a=__uniConfig.networkTimeout.uploadFile},{resolve:c,reject:l})=>{var d=new UploadTask;return isArray$3(i)&&i.length||(i=[{name:r,file:t,uri:n}]),Promise.all(i.map(({file:e,uri:t})=>e instanceof Blob?Promise.resolve(blobToFile(e)):urlToFile(t))).then(function(t){var n,r=new XMLHttpRequest,u=new FormData;Object.keys(s).forEach(e=>{u.append(e,s[e])}),Object.values(i).forEach(({name:e},n)=>{const r=t[n];u.append(e||"file",r,r.name||`file-${Date.now()}`)}),r.open("POST",e),Object.keys(o).forEach(e=>{r.setRequestHeader(e,o[e])}),r.upload.onprogress=function(e){d._callbacks.forEach(t=>{var n=e.loaded,r=e.total;t({progress:Math.round(n/r*100),totalBytesSent:n,totalBytesExpectedToSend:r})})},r.onerror=function(){clearTimeout(n),l("",{errCode:602001})},r.onabort=function(){clearTimeout(n),l("abort",{errCode:600003})},r.onload=function(){clearTimeout(n);const e=r.status;c({statusCode:e,data:r.responseText||r.response})},d._isAbort?l("abort",{errCode:600003}):(n=setTimeout(function(){r.upload.onprogress=r.onload=r.onabort=r.onerror=null,d.abort(),l("timeout",{errCode:5})},a),r.send(u),d._xhr=r)}).catch(()=>{setTimeout(()=>{l("file error")},0)}),d},UploadFileProtocol,UploadFileOptions),socketTasks=[],globalEvent={open:"",close:"",error:"",message:""};class SocketTask{constructor(e,t,n){let r;this._callbacks={open:[],close:[],error:[],message:[]};try{const n=this._webSocket=new WebSocket(e,t);n.binaryType="arraybuffer";["open","close","error","message"].forEach(e=>{this._callbacks[e]=[],n.addEventListener(e,t=>{const{data:n,code:r,reason:i}=t,o="message"===e?{data:n}:"close"===e?{code:r,reason:i}:{};if(this._callbacks[e].forEach(t=>{try{t(o)}catch(n){console.error(`thirdScriptError\n${n};at socketTask.on${capitalize(e)} callback function\n`,n)}}),this===socketTasks[0]&&globalEvent[e]&&UniServiceJSBridge$1.invokeOnCallback(globalEvent[e],o),"error"===e||"close"===e){const e=socketTasks.indexOf(this);e>=0&&socketTasks.splice(e,1)}})});["CLOSED","CLOSING","CONNECTING","OPEN","readyState"].forEach(e=>{Object.defineProperty(this,e,{get:()=>n[e]})})}catch(i){r=i}n&&n(r,this)}send(e){const t=(e||{}).data,n=this._webSocket;try{if(n.readyState!==n.OPEN)throw callOptions(e,{errMsg:"sendSocketMessage:fail SocketTask.readyState is not OPEN",errCode:10002}),new Error("SocketTask.readyState is not OPEN");n.send(t),callOptions(e,"sendSocketMessage:ok")}catch(r){callOptions(e,{errMsg:`sendSocketMessage:fail ${r}`,errCode:602001})}}close(e={}){const t=this._webSocket;try{const n=e.code||1e3,r=e.reason;isString$1(r)?t.close(n,r):t.close(n),callOptions(e,"closeSocket:ok")}catch(n){callOptions(e,`closeSocket:fail ${n}`)}}onOpen(e){this._callbacks.open.push(e)}onMessage(e){this._callbacks.message.push(e)}onError(e){this._callbacks.error.push(e)}onClose(e){this._callbacks.close.push(e)}}const connectSocket=defineTaskApi(API_CONNECT_SOCKET,({url:e,protocols:t},{resolve:n,reject:r})=>new SocketTask(e,t,(e,t)=>{e?r(e.toString(),{errCode:600009}):(socketTasks.push(t),n())}),ConnectSocketProtocol,ConnectSocketOptions);function callSocketTask(e,t,n,r,i){const o=e[t];isFunction$2(o)&&o.call(e,extend$2({},n,{success(){r()},fail({errMsg:e}){i(e.replace("sendSocketMessage:fail ",""))},complete:void 0}))}const sendSocketMessage=defineAsyncApi(API_SEND_SOCKET_MESSAGE,(e,{resolve:t,reject:n})=>{const r=socketTasks[0];r&&r.readyState===r.OPEN?callSocketTask(r,"send",e,t,n):n("WebSocket is not connected")}),closeSocket=defineAsyncApi(API_CLOSE_SOCKET,(e,{resolve:t,reject:n})=>{const r=socketTasks[0];r?callSocketTask(r,"close",e,t,n):n("WebSocket is not connected")});function on(e){const t=`onSocket${capitalize(e)}`;return defineOnApi(t,()=>{globalEvent[e]=t})}const onSocketOpen=on("open"),onSocketError=on("error"),onSocketMessage=on("message"),onSocketClose=on("close"),getLocation=defineAsyncApi(API_GET_LOCATION,({type:e,altitude:t,highAccuracyExpireTime:n,isHighAccuracy:r},{resolve:i,reject:o})=>{const s=getMapInfo();new Promise((e,i)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>e({coords:t.coords}),i,{enableHighAccuracy:r||t,timeout:n||1e5}):i(new Error("device nonsupport geolocation"))}).catch(e=>new Promise((t,n)=>{s.type===MapType.QQ?getJSONP(`https://apis.map.qq.com/ws/location/v1/ip?output=jsonp&key=${s.key}`,{callback:"callback"},e=>{if("result"in e&&e.result.location){const n=e.result.location;t({coords:{latitude:n.lat,longitude:n.lng},skip:!0})}else n(new Error(e.message||JSON.stringify(e)))},()=>n(new Error("network error"))):s.type===MapType.GOOGLE?request$2({method:"POST",url:`https://www.googleapis.com/geolocation/v1/geolocate?key=${s.key}`,success(e){const r=e.data;"location"in r?t({coords:{latitude:r.location.lat,longitude:r.location.lng,accuracy:r.accuracy},skip:!0}):n(new Error(r.error&&r.error.message||JSON.stringify(e)))},fail(){n(new Error("network error"))}}):s.type===MapType.AMAP?loadMaps([],()=>{window.AMap.plugin("AMap.Geolocation",()=>{new window.AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4}).getCurrentPosition((e,r)=>{"complete"===e?t({coords:{latitude:r.position.lat,longitude:r.position.lng,accuracy:r.accuracy},skip:!0}):n(new Error(r.message))})})}):n(e)})).then(({coords:t,skip:n})=>{translateCoordinateSystem(e,t,n).then(e=>{i({latitude:e.latitude,longitude:e.longitude,accuracy:e.accuracy,speed:e.altitude||0,altitude:e.altitude||0,verticalAccuracy:e.altitudeAccuracy||0,horizontalAccuracy:e.accuracy||0})}).catch(e=>{o(e.message)})}).catch(e=>{o(e.message||JSON.stringify(e))})},GetLocationProtocol,GetLocationOptions),ICON_PATH_NAV="M28 17c-6.49396875 0-12.13721875 2.57040625-15 6.34840625V5.4105l6.29859375 6.29859375c0.387875 0.387875 1.02259375 0.387875 1.4105 0 0.387875-0.387875 0.387875-1.02259375 0-1.4105L12.77853125 2.36803125a0.9978125 0.9978125 0 0 0-0.0694375-0.077125c-0.1944375-0.1944375-0.45090625-0.291375-0.70721875-0.290875l-0.00184375-0.0000625-0.00184375 0.0000625c-0.2563125-0.0005-0.51278125 0.09640625-0.70721875 0.290875a0.9978125 0.9978125 0 0 0-0.0694375 0.077125l-7.930625 7.9305625c-0.387875 0.387875-0.387875 1.02259375 0 1.4105 0.387875 0.387875 1.02259375 0.387875 1.4105 0L11 5.4105V29c0 0.55 0.45 1 1 1s1-0.45 1-1c0-5.52284375 6.71571875-10 15-10 0.55228125 0 1-0.44771875 1-1 0-0.55228125-0.44771875-1-1-1z",props$8={latitude:{type:Number},longitude:{type:Number},scale:{type:Number,default:18},name:{type:String,default:""},address:{type:String,default:""}};function useState$2(e){const t=reactive({center:{latitude:0,longitude:0},marker:{id:1,latitude:0,longitude:0,iconPath:ICON_PATH_TARGET,width:32,height:52},location:{id:2,latitude:0,longitude:0,iconPath:ICON_PATH_ORIGIN,width:44,height:44}});function n(){e.latitude&&e.longitude&&(t.center.latitude=e.latitude,t.center.longitude=e.longitude,t.marker.latitude=e.latitude,t.marker.longitude=e.longitude)}return watch([()=>e.latitude,()=>e.longitude],n),n(),t}const LocationView=defineSystemComponent({name:"LocationView",props:props$8,emits:["close"],setup(e,{emit:t}){const n=useState$2(e);function r(e){const t=e.detail.centerLocation;t&&(n.center.latitude=t.latitude,n.center.longitude=t.longitude)}function i(){const t=getMapInfo();let r="";if(t.type===MapType.GOOGLE){r=`https://www.google.com/maps/dir/?api=1${n.location.latitude?`&origin=${n.location.latitude}%2C${n.location.longitude}`:""}&destination=${e.latitude}%2C${e.longitude}`}else if(t.type===MapType.QQ){r=`https://apis.map.qq.com/uri/v1/routeplan?type=drive${n.location.latitude?`&fromcoord=${n.location.latitude}%2C${n.location.longitude}&from=${encodeURIComponent("我的位置")}`:""}&tocoord=${e.latitude}%2C${e.longitude}&to=${encodeURIComponent(e.name||"目的地")}&ref=${t.key}`}else if(t.type===MapType.AMAP){r=`https://uri.amap.com/navigation?${n.location.latitude?`from=${n.location.longitude},${n.location.latitude},${encodeURIComponent("我的位置")}&`:""}to=${e.longitude},${e.latitude},${encodeURIComponent(e.name||"目的地")}`}window.open(r)}function o(){t("close")}function s({latitude:e,longitude:t}){n.center.latitude=e,n.center.longitude=t}return usePreventScroll(),getLocation({type:"gcj02",success:({latitude:e,longitude:t})=>{n.location.latitude=e,n.location.longitude=t}}),()=>createVNode("div",{class:"uni-system-open-location"},[createVNode(Map$1,{latitude:n.center.latitude,longitude:n.center.longitude,class:"map",markers:[n.marker,n.location],onRegionchange:r},{default:()=>[createVNode("div",{class:"map-move",onClick:()=>s(n.location)},[createSvgIconVNode(ICON_PATH_LOCTAION,"#000000",24)],8,["onClick"])]},8,["latitude","longitude","markers","onRegionchange"]),createVNode("div",{class:"info"},[createVNode("div",{class:"name",onClick:()=>s(n.marker)},[e.name],8,["onClick"]),createVNode("div",{class:"address",onClick:()=>s(n.marker)},[e.address],8,["onClick"]),createVNode("div",{class:"nav",onClick:i},[createSvgIconVNode(ICON_PATH_NAV,"#ffffff",26)],8,["onClick"])]),createVNode("div",{class:"nav-btn-back",onClick:o},[createSvgIconVNode(ICON_PATH_BACK,"#ffffff",26)],8,["onClick"])])}});let state$1=null;const openLocation=defineAsyncApi(API_OPEN_LOCATION,(e,{resolve:t})=>{state$1?extend$2(state$1,e):(state$1=reactive(e),nextTick(()=>{const e=createRootApp(LocationView,state$1,()=>{state$1=null,nextTick(()=>{e.unmount()})});e.mount(ensureRoot("u-a-o"))})),t()},OpenLocationProtocol,OpenLocationOptions);function _isSlot$1(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!isVNode(e)}const props$7={latitude:{type:Number},longitude:{type:Number}};function distance(e){return e>100?`${e>1e3?(e/1e3).toFixed(1)+"k":e.toFixed(0)}m | `:e>0?"<100m | ":""}function useState$1(e){const t=reactive({latitude:0,longitude:0,keyword:"",searching:!1});function n(){e.latitude&&e.longitude&&(t.latitude=e.latitude,t.longitude=e.longitude)}return watch([()=>e.latitude,()=>e.longitude],n),n(),t}function useList(e){const t=__uniConfig.qqMapKey,n=reactive([]),r=ref(-1),i=computed$2(()=>n[r.value]),o=reactive({loading:!0,pageSize:20,pageIndex:1,hasNextPage:!0,nextPage:null,selectedIndex:r,selected:i}),s=ref(""),a=computed$2(()=>s.value?`region(${s.value},1,${e.latitude},${e.longitude})`:`nearby(${e.latitude},${e.longitude},5000)`);function c(e){e.forEach(e=>{n.push({name:e.title||e.name,address:e.address,distance:e._distance||e.distance,latitude:e.location.lat,longitude:e.location.lng})})}function l(){o.loading=!0;const r=getMapInfo();if(r.type===MapType.GOOGLE){if(o.pageIndex>1&&o.nextPage)return void o.nextPage();new google.maps.places.PlacesService(document.createElement("div"))[e.searching?"textSearch":"nearbySearch"]({location:{lat:e.latitude,lng:e.longitude},query:e.keyword,radius:5e3},(e,t,r)=>{o.loading=!1,e&&e.length&&e.forEach(e=>{n.push({name:e.name||"",address:e.vicinity||e.formatted_address||"",distance:0,latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng()})}),r&&(r.hasNextPage?o.nextPage=()=>{r.nextPage()}:o.hasNextPage=!1)})}else if(r.type===MapType.QQ){getJSONP(e.searching?`https://apis.map.qq.com/ws/place/v1/search?output=jsonp&key=${t}&boundary=${a.value}&keyword=${e.keyword}&page_size=${o.pageSize}&page_index=${o.pageIndex}`:`https://apis.map.qq.com/ws/geocoder/v1/?output=jsonp&key=${t}&location=${e.latitude},${e.longitude}&get_poi=1&poi_options=page_size=${o.pageSize};page_index=${o.pageIndex}`,{callback:"callback"},t=>{if(o.loading=!1,e.searching&&"data"in t&&t.data.length)c(t.data);else if("result"in t){const e=t.result;s.value=e.ad_info?e.ad_info.adcode:"",e.pois&&c(e.pois)}n.length===o.pageSize*o.pageIndex&&(o.hasNextPage=!1)},()=>{o.loading=!1})}else r.type===MapType.AMAP&&window.AMap.plugin("AMap.PlaceSearch",function(){const t=new window.AMap.PlaceSearch({city:"全国",pageSize:10,pageIndex:o.pageIndex}),n=e.searching?e.keyword:"",r=e.searching?5e4:5e3;t.searchNearBy(n,[e.longitude,e.latitude],r,function(e,t){"error"===e?console.error(t):"no_data"===e?o.hasNextPage=!1:c(t.poiList.pois)}),o.loading=!1})}return{listState:o,list:n,loadMore:function(){!o.loading&&o.hasNextPage&&(o.pageIndex++,l())},reset:function(){o.selectedIndex=-1,o.pageIndex=1,o.hasNextPage=!0,o.nextPage=null,n.splice(0,n.length)},getList:l}}const LoctaionPicker=defineSystemComponent({name:"LoctaionPicker",props:props$7,emits:["close"],setup(e,{emit:t}){usePreventScroll(),initI18nChooseLocationMsgsOnce();const{t:n}=useI18n(),r=useState$1(e),{list:i,listState:o,loadMore:s,reset:a,getList:c}=useList(r),l=debounce$1(()=>{a(),r.keyword&&c()},1e3,{setTimeout:setTimeout,clearTimeout:clearTimeout});function d(e){r.keyword=e.detail.value,l()}function u(){t("close",extend$2({},o.selected))}function p(){t("close")}function h(e){const t=e.detail.centerLocation;t&&m(t)}function g(){getLocation({type:"gcj02",success:m,fail:()=>{}})}function m({latitude:e,longitude:t}){r.latitude=e,r.longitude=t,r.searching||(a(),c())}return watch(()=>r.searching,e=>{a(),e||c()}),r.latitude&&r.longitude||g(),()=>{const e=i.map((e,t)=>createVNode("div",{key:t,class:{"list-item":!0,selected:o.selectedIndex===t},onClick:()=>{o.selectedIndex=t,r.latitude=e.latitude,r.longitude=e.longitude}},[createSvgIconVNode(ICON_PATH_CONFIRM,"#007aff",24),createVNode("div",{class:"list-item-title"},[e.name]),createVNode("div",{class:"list-item-detail"},[distance(e.distance),e.address])],10,["onClick"]));return o.loading&&e.unshift(createVNode("div",{class:"list-loading"},[createVNode("i",{class:"uni-loading"},null)])),createVNode("div",{class:"uni-system-choose-location"},[createVNode(Map$1,{latitude:r.latitude,longitude:r.longitude,class:"map","show-location":!0,libraries:["places"],onUpdated:c,onRegionchange:h},{default:()=>[createVNode("div",{class:"map-location",style:`background-image: url("${ICON_PATH_TARGET}")`},null),createVNode("div",{class:"map-move",onClick:g},[createSvgIconVNode(ICON_PATH_LOCTAION,"#000000",24)],8,["onClick"])],_:1},8,["latitude","longitude","show-location","onUpdated","onRegionchange"]),createVNode("div",{class:"nav"},[createVNode("div",{class:"nav-btn back",onClick:p},[createSvgIconVNode(ICON_PATH_CLOSE,"#ffffff",26)],8,["onClick"]),createVNode("div",{class:{"nav-btn":!0,confirm:!0,disable:!o.selected},onClick:u},[createSvgIconVNode(ICON_PATH_CONFIRM,"#ffffff",26)],10,["onClick"])]),createVNode("div",{class:"menu"},[createVNode("div",{class:"search"},[createVNode(Input,{value:r.keyword,class:"search-input",placeholder:n("uni.chooseLocation.search"),onFocus:()=>r.searching=!0,onInput:d},null,8,["value","placeholder","onFocus","onInput"]),r.searching&&createVNode("div",{class:"search-btn",onClick:()=>{r.searching=!1,r.keyword=""}},[n("uni.chooseLocation.cancel")],8,["onClick"])]),createVNode(ScrollView,{"scroll-y":!0,class:"list",onScrolltolower:s},_isSlot$1(e)?e:{default:()=>[e],_:2},8,["scroll-y","onScrolltolower"])])])}}});let state=null;const chooseLocation=defineAsyncApi(API_CHOOSE_LOCATION,(e,{resolve:t,reject:n})=>{state?n("cancel"):(state=reactive(e),nextTick(()=>{const e=createRootApp(LoctaionPicker,state,r=>{state=null,nextTick(()=>{e.unmount()}),r?t(r):n("cancel")});e.mount(ensureRoot("u-a-c"))}))});let started=!1,watchId=0;const startLocationUpdate=defineAsyncApi(API_START_LOCATION_UPDATE,(e,{resolve:t,reject:n})=>{navigator.geolocation?(watchId=watchId||navigator.geolocation.watchPosition(n=>{started=!0,translateCoordinateSystem(null==e?void 0:e.type,n.coords).then(e=>{UniServiceJSBridge$1.invokeOnCallback(API_ON_LOCATION_CHANGE,e),t()}).catch(e=>{UniServiceJSBridge$1.invokeOnCallback(API_ON_LOCATION_CHANGE_ERROR,{errMsg:`onLocationChange:fail ${e.message}`})})},e=>{started||(n(e.message),started=!0),UniServiceJSBridge$1.invokeOnCallback(API_ON_LOCATION_CHANGE_ERROR,{errMsg:`onLocationChange:fail ${e.message}`})}),setTimeout(t,100)):n()},StartLocationUpdateProtocol,StartLocationUpdateOptions),stopLocationUpdate=defineAsyncApi(API_STOP_LOCATION_UPDATE,(e,{resolve:t})=>{watchId&&(navigator.geolocation.clearWatch(watchId),started=!1,watchId=0),t()}),onLocationChange=defineOnApi(API_ON_LOCATION_CHANGE,()=>{}),offLocationChange=defineOffApi(API_OFF_LOCATION_CHANGE,()=>{}),onLocationChangeError=defineOnApi(API_ON_LOCATION_CHANGE_ERROR,()=>{}),offLocationChangeError=defineOffApi(API_OFF_LOCATION_CHANGE_ERROR,()=>{}),navigateBack=defineAsyncApi(API_NAVIGATE_BACK,(e,{resolve:t,reject:n})=>{let r=!0;return!0===invokeHook(ON_BACK_PRESS,{from:e.from||"navigateBack"})&&(r=!1),r?(getApp$1().$router.go(-e.delta),t()):n(ON_BACK_PRESS)},NavigateBackProtocol,NavigateBackOptions),navigateTo=defineAsyncApi(API_NAVIGATE_TO,({url:e,events:t,isAutomatedTesting:n},{resolve:r,reject:i})=>{if(entryPageState.handledBeforeEntryPageRoutes)return navigate({type:API_NAVIGATE_TO,url:e,events:t,isAutomatedTesting:n}).then(r).catch(i);navigateToPagesBeforeEntryPages.push({args:{type:API_NAVIGATE_TO,url:e,events:t,isAutomatedTesting:n},resolve:r,reject:i})},NavigateToProtocol,NavigateToOptions),preloadPage=defineAsyncApi(API_PRELOAD_PAGE,({url:e},{resolve:t,reject:n})=>{const r=getRouteOptions(e.split("?")[0]);r?r.loader&&r.loader().then(()=>{t({url:e,errMsg:"preloadPage:ok"})}).catch(t=>{n(`${e} ${String(t)}`)}):n(`${e}}`)});function onThemeChange(e){__uniConfig.darkmode&&UniServiceJSBridge$1.on(ON_THEME_CHANGE,e)}function offThemeChange(e){UniServiceJSBridge$1.off(ON_THEME_CHANGE,e)}function parseTheme(e){let t={};return __uniConfig.darkmode&&(t=normalizeStyles(e,__uniConfig.themeConfig,getTheme())),__uniConfig.darkmode?t:e}function useTheme(e,t){const n=isReactive(e),r=n?reactive(parseTheme(e)):parseTheme(e);return __uniConfig.darkmode&&n&&watch(e,e=>{const t=parseTheme(e);for(const n in t)r[n]=t[n]}),t&&onThemeChange(t),r}const ModalTheme={light:{cancelColor:"#000000"},dark:{cancelColor:"rgb(170, 170, 170)"}},setCancelColor=(e,t)=>t.value=ModalTheme[e].cancelColor,props$6={title:{type:String,default:""},content:{type:String,default:""},showCancel:{type:Boolean,default:!0},cancelText:{type:String,default:"Cancel"},cancelColor:{type:String,default:"#000000"},confirmText:{type:String,default:"OK"},confirmColor:{type:String,default:"#007aff"},visible:{type:Boolean},editable:{type:Boolean,default:!1},placeholderText:{type:String,default:""}},modal=defineComponent({props:props$6,setup(e,{emit:t}){const n=ref(""),r=()=>s.value=!1,i=()=>(r(),t("close","cancel")),o=()=>(r(),t("close","confirm",n.value)),s=usePopup(e,{onEsc:i,onEnter:()=>{!e.editable&&o()}}),a=useOnThemeChange$1(e);return()=>{const{title:t,content:r,showCancel:c,confirmText:l,confirmColor:d,editable:u,placeholderText:p}=e;return n.value=r,createVNode(Transition,{name:"uni-fade"},{default:()=>[withDirectives(createVNode("uni-modal",{onTouchmove:onEventPrevent},[VNODE_MASK,createVNode("div",{class:"uni-modal"},[t?createVNode("div",{class:"uni-modal__hd"},[createVNode("strong",{class:"uni-modal__title",textContent:t||""},null,8,["textContent"])]):null,u?createVNode("textarea",{class:"uni-modal__textarea",rows:"1",placeholder:p,value:r,onInput:e=>n.value=e.target.value},null,40,["placeholder","value","onInput"]):createVNode("div",{class:"uni-modal__bd",onTouchmovePassive:onEventStop,textContent:r},null,40,["onTouchmovePassive","textContent"]),createVNode("div",{class:"uni-modal__ft"},[c&&createVNode("div",{style:{color:a.value},class:"uni-modal__btn uni-modal__btn_default",onClick:i},[e.cancelText],12,["onClick"]),createVNode("div",{style:{color:d},class:"uni-modal__btn uni-modal__btn_primary",onClick:o},[l],12,["onClick"])])])],40,["onTouchmove"]),[[vShow,s.value]])]})}}});function useOnThemeChange$1(e){const t=ref(e.cancelColor),n=({theme:e})=>{setCancelColor(e,t)};return watchEffect(()=>{e.visible?(t.value=e.cancelColor,"#000"===e.cancelColor&&("dark"===getTheme()&&n({theme:"dark"}),onThemeChange(n))):offThemeChange(n)}),t}let showModalState;const onHidePopupOnce$1=once$1(()=>{UniServiceJSBridge$1.on("onHidePopup",()=>showModalState.visible=!1)});let currentShowModalResolve;function onModalClose(e,t){const n="confirm"===e,r={confirm:n,cancel:"cancel"===e};n&&showModalState.editable&&(r.content=t),currentShowModalResolve&&currentShowModalResolve(r)}const hideModal=()=>{showModalState&&(showModalState.visible=!1)},showModal=defineAsyncApi(API_SHOW_MODAL,(e,{resolve:t})=>{onHidePopupOnce$1(),currentShowModalResolve=t,showModalState?(extend$2(showModalState,e),showModalState.visible=!0):(showModalState=reactive(e),nextTick(()=>(createRootApp(modal,showModalState,onModalClose).mount(ensureRoot("u-a-m")),nextTick(()=>showModalState.visible=!0))))},ShowModalProtocol,ShowModalOptions),props$5={title:{type:String,default:""},icon:{default:"success",validator:e=>-1!==SHOW_TOAST_ICON.indexOf(e)},image:{type:String,default:""},duration:{type:Number,default:1500},mask:{type:Boolean,default:!1},visible:{type:Boolean}},ToastIconClassName="uni-toast__icon",ICONCOLOR={light:"#fff",dark:"rgba(255,255,255,0.9)"},getIconColor=e=>ICONCOLOR[e],Toast$1=defineComponent({name:"Toast",props:props$5,setup(e){initI18nShowToastMsgsOnce(),initI18nShowLoadingMsgsOnce();const{Icon:t}=useToastIcon(e),n=usePopup(e,{});return()=>{const{mask:r,duration:i,title:o,image:s}=e;return createVNode(Transition,{name:"uni-fade"},{default:()=>[withDirectives(createVNode("uni-toast",{"data-duration":i},[r?createVNode("div",{class:"uni-mask",style:"background: transparent;",onTouchmove:onEventPrevent},null,40,["onTouchmove"]):"",s||t.value?createVNode("div",{class:"uni-toast"},[s?createVNode("img",{src:s,class:ToastIconClassName},null,10,["src"]):t.value,createVNode("p",{class:"uni-toast__content"},[o])]):createVNode("div",{class:"uni-sample-toast"},[createVNode("p",{class:"uni-simple-toast__text"},[o])])],8,["data-duration"]),[[vShow,n.value]])]})}}});function useToastIcon(e){const t=ref(getIconColor(getTheme())),n=({theme:e})=>t.value=getIconColor(e);watchEffect(()=>{e.visible?onThemeChange(n):offThemeChange(n)});return{Icon:computed$2(()=>{switch(e.icon){case"success":return createVNode(createSvgIconVNode(ICON_PATH_SUCCESS_NO_CIRCLE,t.value,38),{class:ToastIconClassName});case"error":return createVNode(createSvgIconVNode(ICON_PATH_WARN,t.value,38),{class:ToastIconClassName});case"loading":return createVNode("i",{class:[ToastIconClassName,"uni-loading"]},null,2);default:return null}})}}let showToastState,showType="",timeoutId;const scope=effectScope();function watchVisible(){scope.run(()=>{watch([()=>showToastState.visible,()=>showToastState.duration],([e,t])=>{if(e){if(timeoutId&&clearTimeout(timeoutId),"onShowLoading"===showType)return;timeoutId=setTimeout(()=>{hidePopup("onHideToast")},t)}else timeoutId&&clearTimeout(timeoutId)})})}function createToast(e){showToastState?extend$2(showToastState,e):(showToastState=reactive(extend$2(e,{visible:!1})),nextTick(()=>{watchVisible(),UniServiceJSBridge$1.on("onHidePopup",()=>hidePopup("onHidePopup")),createRootApp(Toast$1,showToastState,()=>{}).mount(ensureRoot("u-a-t"))})),setTimeout(()=>{showToastState.visible=!0},10)}const showToast=defineAsyncApi(API_SHOW_TOAST,(e,{resolve:t,reject:n})=>{createToast(e),showType="onShowToast",t()},ShowToastProtocol,ShowToastOptions),showLoadingDefaultState={icon:"loading",duration:1e8,image:""},showLoading=defineAsyncApi(API_SHOW_LOADING,(e,{resolve:t,reject:n})=>{extend$2(e,showLoadingDefaultState),createToast(e),showType="onShowLoading",t()},ShowLoadingProtocol,ShowLoadingOptions),hideToast=defineAsyncApi(API_HIDE_TOAST,(e,{resolve:t,reject:n})=>{hidePopup("onHideToast"),t()}),hideLoading=defineAsyncApi(API_HIDE_LOADING,(e,{resolve:t,reject:n})=>{hidePopup("onHideLoading"),t()});function hidePopup(e){const{t:t}=useI18n();if(!showType)return;let n="";if("onHideToast"===e&&"onShowToast"!==showType?n=t("uni.showToast.unpaired"):"onHideLoading"===e&&"onShowLoading"!==showType&&(n=t("uni.showLoading.unpaired")),n)return console.warn(n);showType="",setTimeout(()=>{showToastState.visible=!1},10)}function usePopupStyle(e){const t=ref(0),n=ref(0),r=computed$2(()=>t.value>=500&&n.value>=500),i=computed$2(()=>{const t={content:{transform:"",left:"",top:"",bottom:""},triangle:{left:"",top:"",bottom:"","border-width":"","border-color":""}},i=t.content,o=t.triangle,s=e.popover;function a(e){return Number(e)||0}if(r.value&&s){extend$2(o,{position:"absolute",width:"0",height:"0","margin-left":"-6px","border-style":"solid"});const e=a(s.left),t=a(s.width?s.width:300),r=a(s.top),c=a(s.height),l=e+t/2;i.transform="none !important";const d=Math.max(0,l-t/2);i.left=`${d}px`,s.width&&(i.width=`${t}px`);let u=Math.max(12,l-d);u=Math.min(t-12,u),o.left=`${u}px`;const p=n.value/2;r+c-p>p-r?(i.top="auto",i.bottom=n.value-r+6+"px",o.bottom="-6px",o["border-width"]="6px 6px 0 6px",o["border-color"]="#fcfcfd transparent transparent transparent"):(i.top=`${r+c+6}px`,o.top="-6px",o["border-width"]="0 6px 6px 6px",o["border-color"]="transparent transparent #fcfcfd transparent")}return t});return onMounted(()=>{const e=()=>{const{windowWidth:e,windowHeight:r,windowTop:i}=uni.getSystemInfoSync();t.value=e,n.value=r+(i||0)};window.addEventListener("resize",e),e(),onUnmounted(()=>{window.removeEventListener("resize",e)})}),{isDesktop:r,popupStyle:i}}const ACTION_SHEET_THEME={light:{listItemColor:"#000000",cancelItemColor:"#000000"},dark:{listItemColor:"rgba(255, 255, 255, 0.8)",cancelItemColor:"rgba(255, 255, 255)"}};function setActionSheetTheme(e,t){["listItemColor","cancelItemColor"].forEach(n=>{t[n]=ACTION_SHEET_THEME[e][n]})}const props$4={title:{type:String,default:""},itemList:{type:Array,default:()=>[]},itemColor:{type:String,default:"#000000"},popover:{type:Object,default:null},visible:{type:Boolean,default:!1}},actionSheet=defineComponent({name:"ActionSheet",props:props$4,emits:["close"],setup(e,{emit:t}){initI18nShowActionSheetMsgsOnce();const n=ref(260),r=ref(0),i=ref(0),o=ref(0),s=ref(0),a=ref(null),c=ref(null),{t:l}=useI18n(),{_close:d}=useActionSheetLoader(e,t),{popupStyle:u}=usePopupStyle(e);let p;function h(e){const t=o.value+e.deltaY;Math.abs(t)>10?(s.value+=t/3,s.value=s.value>=r.value?r.value:s.value<=0?0:s.value,p.scrollTo(s.value)):o.value=t,e.preventDefault()}onMounted(()=>{const{scroller:e,handleTouchStart:t,handleTouchMove:n,handleTouchEnd:r}=useScroller(a.value,{enableY:!0,friction:new Friction(1e-4),spring:new Spring(2,90,20),onScroll:e=>{s.value=e.target.scrollTop}});p=e,useTouchtrack(a.value,i=>{if(e)switch(i.detail.state){case"start":t(i);break;case"move":n(i);break;case"end":case"cancel":r(i)}},!0)}),watch(()=>e.visible,()=>{nextTick(()=>{e.title&&(i.value=document.querySelector(".uni-actionsheet__title").offsetHeight),p.update(),a.value&&(r.value=a.value.clientHeight-n.value),document.querySelectorAll(".uni-actionsheet__cell").forEach(e=>{initClick(e)})})});const g=useOnThemeChange(e);return()=>createVNode("uni-actionsheet",{onTouchmove:onEventPrevent},[createVNode(Transition,{name:"uni-fade"},{default:()=>[withDirectives(createVNode("div",{class:"uni-mask uni-actionsheet__mask",onClick:()=>d(-1)},null,8,["onClick"]),[[vShow,e.visible]])]}),createVNode("div",{class:["uni-actionsheet",{"uni-actionsheet_toggle":e.visible}],style:u.value.content},[createVNode("div",{ref:c,class:"uni-actionsheet__menu",onWheel:h},[e.title?createVNode(Fragment,null,[createVNode("div",{class:"uni-actionsheet__cell",style:{height:`${i.value}px`}},null),createVNode("div",{class:"uni-actionsheet__title"},[e.title])]):"",createVNode("div",{style:{maxHeight:`${n.value}px`,overflow:"hidden"}},[createVNode("div",{ref:a},[e.itemList.map((e,t)=>createVNode("div",{key:t,style:{color:g.listItemColor},class:"uni-actionsheet__cell",onClick:()=>d(t)},[e],12,["onClick"]))],512)])],40,["onWheel"]),createVNode("div",{class:"uni-actionsheet__action"},[createVNode("div",{style:{color:g.cancelItemColor},class:"uni-actionsheet__cell",onClick:()=>d(-1)},[l("uni.showActionSheet.cancel")],12,["onClick"])]),createVNode("div",{style:u.value.triangle},null,4)],6)],40,["onTouchmove"])}});function useActionSheetLoader(e,t){function n(e){t("close",e)}const{key:r,disable:i}=useKeyboard();return watch(()=>e.visible,e=>i.value=!e),watchEffect(()=>{const{value:e}=r;"esc"===e&&n&&n(-1)}),{_close:n}}function initClick(e){let t=0,n=0;e.addEventListener("touchstart",e=>{const r=e.changedTouches[0];t=r.clientX,n=r.clientY}),e.addEventListener("touchend",e=>{const r=e.changedTouches[0];if(Math.abs(r.clientX-t)<20&&Math.abs(r.clientY-n)<20){const t=e.target,n=e.currentTarget,i=new CustomEvent("click",{bubbles:!0,cancelable:!0,target:t,currentTarget:n});["screenX","screenY","clientX","clientY","pageX","pageY"].forEach(e=>{i[e]=r[e]}),e.target.dispatchEvent(i)}})}function useOnThemeChange(e){const t=reactive({listItemColor:"#000",cancelItemColor:"#000"}),n=({theme:e})=>{setActionSheetTheme(e,t)};return watchEffect(()=>{e.visible?(t.listItemColor=t.cancelItemColor=e.itemColor,"#000"===e.itemColor&&(n({theme:getTheme()}),onThemeChange(n))):offThemeChange(n)}),t}let resolveAction,rejectAction,showActionSheetState;const onHidePopupOnce=once$1(()=>{UniServiceJSBridge$1.on("onHidePopup",()=>showActionSheetState.visible=!1)});function onActionSheetClose(e){-1===e?rejectAction&&rejectAction("cancel"):resolveAction&&resolveAction({tapIndex:e})}const hideActionSheet=()=>{showActionSheetState&&(showActionSheetState.visible=!1)},showActionSheet=defineAsyncApi(API_SHOW_ACTION_SHEET,(e,{resolve:t,reject:n})=>{onHidePopupOnce(),resolveAction=t,rejectAction=n,showActionSheetState?(extend$2(showActionSheetState,e),showActionSheetState.visible=!0):(showActionSheetState=reactive(e),nextTick(()=>(createRootApp(actionSheet,showActionSheetState,onActionSheetClose).mount(ensureRoot("u-s-a-s")),nextTick(()=>showActionSheetState.visible=!0))))},ShowActionSheetProtocol,ShowActionSheetOptions),loadFontFace=defineAsyncApi(API_LOAD_FONT_FACE,({family:e,source:t,desc:n},{resolve:r,reject:i})=>{addFont(e,t=t.startsWith('url("')||t.startsWith("url('")?`url('${getRealPath(t.substring(5,t.length-2))}')`:t.startsWith("url(")?`url('${getRealPath(t.substring(4,t.length-1))}')`:getRealPath(t),n).then(()=>{r()}).catch(e=>{i(`loadFontFace:fail ${e}`)})});function updateDocumentTitle(e){document.title=e,UniServiceJSBridge$1.emit(ON_NAVIGATION_BAR_CHANGE,{titleText:e})}function useDocumentTitle(e){function t(){updateDocumentTitle(e.navigationBar.titleText)}watchEffect(t),onActivated(t)}function setNavigationBar(e,t,n,r,i){if(!e)return i("page not found");const{navigationBar:o}=e;switch(t){case API_SET_NAVIGATION_BAR_COLOR:const{frontColor:e,backgroundColor:t,animation:r}=n,{duration:i,timingFunc:s}=r;e&&(o.titleColor="#000000"===e?"#000000":"#ffffff"),t&&(o.backgroundColor=t),o.duration=i+"ms",o.timingFunc=s;break;case API_SHOW_NAVIGATION_BAR_LOADING:o.loading=!0;break;case API_HIDE_NAVIGATION_BAR_LOADING:o.loading=!1;break;case API_SET_NAVIGATION_BAR_TITLE:const{title:a}=n;o.titleText=a}r()}const setNavigationBarColor=defineAsyncApi(API_SET_NAVIGATION_BAR_COLOR,(e,{resolve:t,reject:n})=>{setNavigationBar(getCurrentPageMeta(),API_SET_NAVIGATION_BAR_COLOR,e,t,n)},SetNavigationBarColorProtocol,SetNavigationBarColorOptions),showNavigationBarLoading=defineAsyncApi(API_SHOW_NAVIGATION_BAR_LOADING,(e,{resolve:t,reject:n})=>{setNavigationBar(getCurrentPageMeta(),API_SHOW_NAVIGATION_BAR_LOADING,e||{},t,n)}),hideNavigationBarLoading=defineAsyncApi(API_HIDE_NAVIGATION_BAR_LOADING,(e,{resolve:t,reject:n})=>{setNavigationBar(getCurrentPageMeta(),API_HIDE_NAVIGATION_BAR_LOADING,e||{},t,n)}),setNavigationBarTitle=defineAsyncApi(API_SET_NAVIGATION_BAR_TITLE,(e,{resolve:t,reject:n})=>{setNavigationBar(getCurrentPageMeta(),API_SET_NAVIGATION_BAR_TITLE,e,t,n)}),pageScrollTo=defineAsyncApi(API_PAGE_SCROLL_TO,({scrollTop:e,selector:t,duration:n},{resolve:r})=>{scrollTo(t||e||0,n),r()},PageScrollToProtocol,PageScrollToOptions),startPullDownRefresh=defineAsyncApi(API_START_PULL_DOWN_REFRESH,(e,{resolve:t})=>{UniServiceJSBridge$1.invokeViewMethod(API_START_PULL_DOWN_REFRESH,{},getCurrentPageId()),t()}),stopPullDownRefresh=defineAsyncApi(API_STOP_PULL_DOWN_REFRESH,(e,{resolve:t})=>{UniServiceJSBridge$1.invokeViewMethod(API_STOP_PULL_DOWN_REFRESH,{},getCurrentPageId()),t()}),setTabBarItemProps=["text","iconPath","iconfont","selectedIconPath","visible"],setTabBarStyleProps=["color","selectedColor","backgroundColor","borderStyle","borderColor","midButton"],setTabBarBadgeProps=["badge","redDot"];function setProperties(e,t,n){t.forEach(function(t){hasOwn$1(n,t)&&(e[t]=n[t])})}function setTabBar(e,t,n,r){var i;let o=!1;const s=getCurrentBasePages();if(s.length&&getPage$BasePage(s[s.length-1]).meta.isTabBar&&(o=!0),!o)return r("not TabBar page");const{index:a}=t;if("number"==typeof a){const e=null==(i=null==__uniConfig?void 0:__uniConfig.tabBar)?void 0:i.list.length;if(!e||a>=e)return r("tabbar item not found")}const c=useTabBar();switch(e){case API_SHOW_TAB_BAR:c.shown=!0;break;case API_HIDE_TAB_BAR:c.shown=!1;break;case API_SET_TAB_BAR_ITEM:const e=c.list[a],n=e.pagePath;setProperties(e,setTabBarItemProps,t);const{pagePath:r}=t;if(r){const e=addLeadingSlash(r);e!==n&&normalizeTabBarRoute(a,n,e)}break;case API_SET_TAB_BAR_STYLE:setProperties(c,setTabBarStyleProps,t);break;case API_SHOW_TAB_BAR_RED_DOT:setProperties(c.list[a],setTabBarBadgeProps,{badge:"",redDot:!0});break;case API_SET_TAB_BAR_BADGE:setProperties(c.list[a],setTabBarBadgeProps,{badge:t.text,redDot:!0});break;case API_HIDE_TAB_BAR_RED_DOT:case API_REMOVE_TAB_BAR_BADGE:setProperties(c.list[a],setTabBarBadgeProps,{badge:"",redDot:!1})}n()}const setTabBarItem=defineAsyncApi(API_SET_TAB_BAR_ITEM,(e,{resolve:t,reject:n})=>{setTabBar(API_SET_TAB_BAR_ITEM,e,t,n)},SetTabBarItemProtocol,SetTabBarItemOptions),setTabBarStyle=defineAsyncApi(API_SET_TAB_BAR_STYLE,(e,{resolve:t,reject:n})=>{setTabBar(API_SET_TAB_BAR_STYLE,e,t,n)},SetTabBarStyleProtocol,SetTabBarStyleOptions),hideTabBar=defineAsyncApi(API_HIDE_TAB_BAR,(e,{resolve:t,reject:n})=>{setTabBar(API_HIDE_TAB_BAR,e||{},t,n)}),showTabBar=defineAsyncApi(API_SHOW_TAB_BAR,(e,{resolve:t,reject:n})=>{setTabBar(API_SHOW_TAB_BAR,e||{},t,n)}),hideTabBarRedDot=defineAsyncApi(API_HIDE_TAB_BAR_RED_DOT,(e,{resolve:t,reject:n})=>{setTabBar(API_HIDE_TAB_BAR_RED_DOT,e,t,n)},HideTabBarRedDotProtocol,HideTabBarRedDotOptions),showTabBarRedDot=defineAsyncApi(API_SHOW_TAB_BAR_RED_DOT,(e,{resolve:t,reject:n})=>{setTabBar(API_SHOW_TAB_BAR_RED_DOT,e,t,n)},ShowTabBarRedDotProtocol,ShowTabBarRedDotOptions),removeTabBarBadge=defineAsyncApi(API_REMOVE_TAB_BAR_BADGE,(e,{resolve:t,reject:n})=>{setTabBar(API_REMOVE_TAB_BAR_BADGE,e,t,n)},RemoveTabBarBadgeProtocol,RemoveTabBarBadgeOptions),setTabBarBadge=defineAsyncApi(API_SET_TAB_BAR_BADGE,(e,{resolve:t,reject:n})=>{setTabBar(API_SET_TAB_BAR_BADGE,e,t,n)},SetTabBarBadgeProtocol,SetTabBarBadgeOptions),UNI_TABBAR_ICON_FONT="UniTabbarIconFont",TabBar=defineSystemComponent({name:"TabBar",setup(){const e=ref([]),t=useTabBar(),n=useTheme(t,()=>{const e=parseTheme(t);n.backgroundColor=e.backgroundColor,n.borderStyle=e.borderStyle,n.color=e.color,n.selectedColor=e.selectedColor,n.blurEffect=e.blurEffect,n.midButton=e.midButton,e.list&&e.list.length&&e.list.forEach((e,t)=>{n.list[t].iconPath=e.iconPath,n.list[t].selectedIconPath=e.selectedIconPath})});useVisibleList(n,e),useTabBarCssVar(n);const r=useSwitchTab(useRoute(),n,e),{style:i,borderStyle:o,placeholderStyle:s}=useTabBarStyle(n);return onMounted(()=>{n.iconfontSrc&&loadFontFace({family:UNI_TABBAR_ICON_FONT,source:`url("${n.iconfontSrc}")`})}),()=>{const t=createTabBarItemsTsx(n,r,e);return createVNode("uni-tabbar",{class:"uni-tabbar-"+n.position},[createVNode("div",{class:"uni-tabbar",style:i.value},[createVNode("div",{class:"uni-tabbar-border",style:o.value},null,4),t],4),createVNode("div",{class:"uni-placeholder",style:s.value},null,4)],2)}}});function useTabBarCssVar(e){watch(()=>e.shown,t=>{updatePageCssVar({"--window-bottom":normalizeWindowBottom(t?parseInt(e.height):0)})})}function useVisibleList(e,t){ref(extend$2({type:"midButton"},e.midButton)),watchEffect(function(){let n=[];n=e.list.filter(e=>!1!==e.visible),t.value=n})}function useSwitchTab(e,t,n){return watchEffect(()=>{const r=e.meta;if(r.isTabBar){const e=r.route,i=n.value.findIndex(t=>t.pagePath===e);t.selectedIndex=i}}),(t,n)=>()=>{const{pagePath:r,text:i}=t;let o=addLeadingSlash(r);o===__uniRoutes[0].alias&&(o="/"),e.path!==o?uni.switchTab({from:"tabBar",url:o,tabBarText:i}):invokeHook("onTabItemTap",{index:n,text:i,pagePath:r})}}const DEFAULT_BG_COLOR="#f7f7fa",BLUR_EFFECT_COLOR_DARK="rgb(0, 0, 0, 0.8)",BLUR_EFFECT_COLOR_LIGHT="rgb(250, 250, 250, 0.8)",BLUR_EFFECT_COLORS={dark:BLUR_EFFECT_COLOR_DARK,light:BLUR_EFFECT_COLOR_LIGHT,extralight:BLUR_EFFECT_COLOR_LIGHT},BORDER_COLORS={white:"rgba(255, 255, 255, 0.33)",black:"rgba(0, 0, 0, 0.33)"};function useTabBarStyle(e){return{style:computed$2(()=>{let t=e.backgroundColor;const n=e.blurEffect;return t||cssBackdropFilter&&n&&"none"!==n&&(t=BLUR_EFFECT_COLORS[n]),{backgroundColor:t||DEFAULT_BG_COLOR,backdropFilter:"none"!==n?"blur(10px)":n}}),borderStyle:computed$2(()=>{const{borderStyle:t,borderColor:n}=e;return n&&isString$1(n)?{backgroundColor:n}:{backgroundColor:BORDER_COLORS[t]||BORDER_COLORS.black}}),placeholderStyle:computed$2(()=>({height:e.height}))}}function createTabBarItemsTsx(e,t,n){const{selectedIndex:r,selectedColor:i,color:o}=e;return n.value.map((n,s)=>{const a=r===s;return createTabBarItemTsx(a?i:o,a&&n.selectedIconPath||n.iconPath||"",n.iconfont?a&&n.iconfont.selectedText||n.iconfont.text:void 0,n.iconfont?a&&n.iconfont.selectedColor||n.iconfont.color:void 0,n,e,s,t)})}function createTabBarItemTsx(e,t,n,r,i,o,s,a){return createVNode("div",{key:s,class:"uni-tabbar__item",onClick:a(i,s)},[createTabBarItemBdTsx(e,t||"",n,r,i,o)],8,["onClick"])}function createTabBarItemBdTsx(e,t,n,r,i,o){const{height:s}=o;return createVNode("div",{class:"uni-tabbar__bd",style:{height:s}},[n?createTabBarItemIconfontTsx(n,r||BLUR_EFFECT_COLOR_DARK,i,o):t&&createTabBarItemIconTsx(t,i,o),i.text&&createTabBarItemTextTsx(e,i,o),i.redDot&&createTabBarItemRedDotTsx(i.badge)],4)}function createTabBarItemIconTsx(e,t,n){const{type:r,text:i}=t,{iconWidth:o}=n;return createVNode("div",{class:"uni-tabbar__icon"+(i?" uni-tabbar__icon__diff":""),style:{width:o,height:o}},["midButton"!==r&&createVNode("img",{src:getRealPath(e)},null,8,["src"])],6)}function createTabBarItemIconfontTsx(e,t,n,r){var i;const{type:o,text:s}=n,{iconWidth:a}=r,c="uni-tabbar__icon"+(s?" uni-tabbar__icon__diff":""),l={width:a,height:a},d={fontSize:(null==(i=n.iconfont)?void 0:i.fontSize)||a,color:t};return createVNode("div",{class:c,style:l},["midButton"!==o&&createVNode("div",{class:"uni-tabbar__iconfont",style:d},[e],4)],6)}function createTabBarItemTextTsx(e,t,n){const{iconPath:r,text:i}=t,{fontSize:o,spacing:s}=n;return createVNode("div",{class:"uni-tabbar__label",style:{color:e,fontSize:o,lineHeight:r?"normal":1.8,marginTop:r?s:"inherit"}},[i],4)}function createTabBarItemRedDotTsx(e){return createVNode("div",{class:"uni-tabbar__reddot"+(e?" uni-tabbar__badge":"")},[e],2)}const DEFAULT_CSS_VAR_VALUE="0px";let globalLayoutState;function getLayoutState(){return globalLayoutState}const LayoutComponent=defineSystemComponent({name:"Layout",setup(e,{emit:t}){const n=ref(null);initCssVar();const r=useKeepAliveRoute(),{layoutState:i,windowState:o}=useState();useMaxWidth(i,n);const s=useShowTabBar(),a=useAppClass(s);return globalLayoutState=i,()=>{const e=createLayoutTsx(r),t=createTabBarTsx(s);return createVNode("uni-app",{ref:n,class:a.value},[e,t],2)}}});function useAppClass(e){const t=ref(!1);return computed$2(()=>({"uni-app--showtabbar":e&&e.value,"uni-app--maxwidth":t.value}))}function initCssVar(){updateCssVar({"--status-bar-height":DEFAULT_CSS_VAR_VALUE,"--top-window-height":DEFAULT_CSS_VAR_VALUE,"--window-left":DEFAULT_CSS_VAR_VALUE,"--window-right":DEFAULT_CSS_VAR_VALUE,"--window-margin":DEFAULT_CSS_VAR_VALUE,"--tab-bar-height":DEFAULT_CSS_VAR_VALUE})}function useMaxWidth(e,t){const n=usePageRoute();function r(){const r=document.body.clientWidth,i=getCurrentBasePages();let o={};if(i.length>0){o=getPage$BasePage(i[i.length-1]).meta}else{const e=getRouteOptions(n.path,!0);e&&(o=e.meta)}const s=parseInt(String((hasOwn$1(o,"maxWidth")?o.maxWidth:__uniConfig.globalStyle.maxWidth)||Number.MAX_SAFE_INTEGER));let a=!1;a=r>s,a&&s?(e.marginWidth=(r-s)/2,nextTick(()=>{const e=t.value;e&&e.setAttribute("style","max-width:"+s+"px;margin:0 auto;")})):(e.marginWidth=0,nextTick(()=>{const e=t.value;e&&e.removeAttribute("style")}))}watch([()=>n.path],r),onMounted(()=>{r(),window.addEventListener("resize",r)})}function useState(){usePageRoute();{const e=reactive({marginWidth:0,leftWindowWidth:0,rightWindowWidth:0});return watch(()=>e.marginWidth,e=>updateCssVar({"--window-margin":e+"px"})),watch(()=>e.leftWindowWidth+e.marginWidth,e=>{updateCssVar({"--window-left":e+"px"})}),watch(()=>e.rightWindowWidth+e.marginWidth,e=>{updateCssVar({"--window-right":e+"px"})}),{layoutState:e,windowState:computed$2(()=>({}))}}}function createLayoutTsx(e,t,n,r,i,o){return createRouterViewVNode(e)}function useShowTabBar(e){const t=usePageRoute(),n=useTabBar(),r=computed$2(()=>t.meta.isTabBar&&n.shown);return updateCssVar({"--tab-bar-height":n.height}),r}function createTabBarTsx(e){return withDirectives(createVNode(TabBar,null,null,512),[[vShow,e.value]])}function createRouterViewVNode({routeKey:e,isTabBar:t,routeCache:n}){return createVNode(RouterView,null,{default:withCtx(({Component:r})=>[(openBlock(),createBlock(KeepAlive,{matchBy:"key",cache:n},[(openBlock(),createBlock(resolveDynamicComponent(r),{type:t.value?"tabBar":"",key:e.value}))],1032,["cache"]))]),_:1})}const showTopWindow=defineAsyncApi("showTopWindow",(e,{resolve:t,reject:n})=>{const r=getLayoutState();r?(r.apiShowTopWindow=!0,nextTick(t)):n()}),hideTopWindow=defineAsyncApi("hideTopWindow",(e,{resolve:t,reject:n})=>{const r=getLayoutState();r?(r.apiShowTopWindow=!1,nextTick(t)):n()}),showLeftWindow=defineAsyncApi("showLeftWindow",(e,{resolve:t,reject:n})=>{const r=getLayoutState();r?(r.apiShowLeftWindow=!0,nextTick(t)):n()}),hideLeftWindow=defineAsyncApi("hideLeftWindow",(e,{resolve:t,reject:n})=>{const r=getLayoutState();r?(r.apiShowLeftWindow=!1,nextTick(t)):n()}),showRightWindow=defineAsyncApi("showRightWindow",(e,{resolve:t,reject:n})=>{const r=getLayoutState();r?(r.apiShowRightWindow=!0,nextTick(t)):n()}),hideRightWindow=defineAsyncApi("hideRightWindow",(e,{resolve:t,reject:n})=>{const r=getLayoutState();r?(r.apiShowRightWindow=!1,nextTick(t)):n()}),getTopWindowStyle=defineSyncApi("getTopWindowStyle",()=>{const e=getLayoutState();return extend$2({},e&&e.topWindowStyle)}),setTopWindowStyle=defineSyncApi("setTopWindowStyle",e=>{const t=getLayoutState();t&&(t.topWindowStyle=e)}),getLeftWindowStyle=defineSyncApi("getLeftWindowStyle",()=>{const e=getLayoutState();return extend$2({},e&&e.leftWindowStyle)}),setLeftWindowStyle=defineSyncApi("setLeftWindowStyle",e=>{const t=getLayoutState();t&&(t.leftWindowStyle=e)}),getRightWindowStyle=defineSyncApi("getRightWindowStyle",()=>{const e=getLayoutState();return extend$2({},e&&e.rightWindowStyle)}),setRightWindowStyle=defineSyncApi("setRightWindowStyle",e=>{const t=getLayoutState();t&&(t.rightWindowStyle=e)}),getElementById=defineSyncApi("getElementById",e=>{const t=document.querySelector("uni-page-body");return t?t.querySelector(`#${e}`):null}),saveImageToPhotosAlbum=defineAsyncApi(API_SAVE_IMAGE_TO_PHOTOS_ALBUM,createUnsupportedAsyncApi(API_SAVE_IMAGE_TO_PHOTOS_ALBUM)),API_GET_RECORDER_MANAGER="getRecorderManager",getRecorderManager=defineSyncApi(API_GET_RECORDER_MANAGER,createUnsupportedSyncApi(API_GET_RECORDER_MANAGER)),saveVideoToPhotosAlbum=defineAsyncApi(API_SAVE_VIDEO_TO_PHOTOS_ALBUM,createUnsupportedAsyncApi(API_SAVE_VIDEO_TO_PHOTOS_ALBUM)),API_CREATE_CAMERA_CONTEXT="createCameraContext",createCameraContext=defineSyncApi(API_CREATE_CAMERA_CONTEXT,createUnsupportedSyncApi(API_CREATE_CAMERA_CONTEXT)),API_CREATE_LIVE_PLAYER_CONTEXT="createLivePlayerContext",createLivePlayerContext=defineSyncApi(API_CREATE_LIVE_PLAYER_CONTEXT,createUnsupportedSyncApi(API_CREATE_LIVE_PLAYER_CONTEXT)),API_SAVE_FILE="saveFile",saveFile=defineAsyncApi(API_SAVE_FILE,createUnsupportedAsyncApi(API_SAVE_FILE)),API_GET_SAVED_FILE_LIST="getSavedFileList",getSavedFileList=defineAsyncApi(API_GET_SAVED_FILE_LIST,createUnsupportedAsyncApi(API_GET_SAVED_FILE_LIST)),API_GET_SAVED_FILE_INFO="getSavedFileInfo",getSavedFileInfo=defineAsyncApi(API_GET_SAVED_FILE_INFO,createUnsupportedAsyncApi(API_GET_SAVED_FILE_INFO)),API_REMOVE_SAVED_FILE="removeSavedFile",removeSavedFile=defineAsyncApi(API_REMOVE_SAVED_FILE,createUnsupportedAsyncApi(API_REMOVE_SAVED_FILE)),API_ON_MEMORY_WARNING="onMemoryWarning",onMemoryWarning=defineOnApi(API_ON_MEMORY_WARNING,createUnsupportedOnApi(API_ON_MEMORY_WARNING)),API_ON_GYROSCOPE_CHANGE="onGyroscopeChange",onGyroscopeChange=defineOnApi(API_ON_GYROSCOPE_CHANGE,createUnsupportedOnApi(API_ON_GYROSCOPE_CHANGE)),API_START_GYROSCOPE="startGyroscope",startGyroscope=defineAsyncApi(API_START_GYROSCOPE,createUnsupportedAsyncApi(API_START_GYROSCOPE)),API_STOP_GYROSCOPE="stopGyroscope",stopGyroscope=defineAsyncApi(API_STOP_GYROSCOPE,createUnsupportedAsyncApi(API_STOP_GYROSCOPE)),API_SCAN_CODE="scanCode",scanCode=defineAsyncApi(API_SCAN_CODE,createUnsupportedAsyncApi(API_SCAN_CODE)),API_SET_SCREEN_BRIGHTNESS="setScreenBrightness",setScreenBrightness=defineAsyncApi(API_SET_SCREEN_BRIGHTNESS,createUnsupportedAsyncApi(API_SET_SCREEN_BRIGHTNESS)),API_GET_SCREEN_BRIGHTNESS="getScreenBrightness",getScreenBrightness=defineAsyncApi(API_GET_SCREEN_BRIGHTNESS,createUnsupportedAsyncApi(API_GET_SCREEN_BRIGHTNESS)),API_SET_KEEP_SCREEN_ON="setKeepScreenOn",setKeepScreenOn=defineAsyncApi(API_SET_KEEP_SCREEN_ON,createUnsupportedAsyncApi(API_SET_KEEP_SCREEN_ON)),API_ON_USER_CAPTURE_SCREEN="onUserCaptureScreen",onUserCaptureScreen=defineOnApi(API_ON_USER_CAPTURE_SCREEN,createUnsupportedOnApi(API_ON_USER_CAPTURE_SCREEN)),API_ADD_PHONE_CONTACT="addPhoneContact",addPhoneContact=defineAsyncApi(API_ADD_PHONE_CONTACT,createUnsupportedAsyncApi(API_ADD_PHONE_CONTACT)),API_LOGIN="login",login=defineAsyncApi(API_LOGIN,createUnsupportedAsyncApi(API_LOGIN)),API_GET_PROVIDER="getProvider",getProvider=defineAsyncApi(API_GET_PROVIDER,createUnsupportedAsyncApi(API_GET_PROVIDER)),api=Object.defineProperty({__proto__:null,$emit:$emit,$off:$off,$on:$on,$once:$once,__f__:__f__,addInterceptor:addInterceptor,addPhoneContact:addPhoneContact,arrayBufferToBase64:arrayBufferToBase64,base64ToArrayBuffer:base64ToArrayBuffer,canIUse:canIUse,canvasGetImageData:canvasGetImageData,canvasPutImageData:canvasPutImageData,canvasToTempFilePath:canvasToTempFilePath,chooseFile:chooseFile,chooseImage:chooseImage,chooseLocation:chooseLocation,chooseVideo:chooseVideo,clearStorage:clearStorage,clearStorageSync:clearStorageSync,closePreviewImage:closePreviewImage,closeSocket:closeSocket,connectSocket:connectSocket,createAnimation:createAnimation$1,createCameraContext:createCameraContext,createCanvasContext:createCanvasContext,createInnerAudioContext:createInnerAudioContext,createIntersectionObserver:createIntersectionObserver,createLivePlayerContext:createLivePlayerContext,createMapContext:createMapContext,createMediaQueryObserver:createMediaQueryObserver,createSelectorQuery:createSelectorQuery,createVideoContext:createVideoContext,cssBackdropFilter:cssBackdropFilter,cssConstant:cssConstant,cssEnv:cssEnv,cssVar:cssVar,downloadFile:downloadFile,getAppBaseInfo:getAppBaseInfo,getClipboardData:getClipboardData,getDeviceInfo:getDeviceInfo,getElementById:getElementById,getEnterOptionsSync:getEnterOptionsSync,getFileInfo:getFileInfo,getImageInfo:getImageInfo,getLaunchOptionsSync:getLaunchOptionsSync,getLeftWindowStyle:getLeftWindowStyle,getLocale:getLocale,getLocation:getLocation,getNetworkType:getNetworkType,getProvider:getProvider,getPushClientId:getPushClientId,getRecorderManager:getRecorderManager,getRightWindowStyle:getRightWindowStyle,getSavedFileInfo:getSavedFileInfo,getSavedFileList:getSavedFileList,getScreenBrightness:getScreenBrightness,getSelectedTextRange:getSelectedTextRange$1,getStorage:getStorage,getStorageInfo:getStorageInfo,getStorageInfoSync:getStorageInfoSync,getStorageSync:getStorageSync,getSystemInfo:getSystemInfo,getSystemInfoSync:getSystemInfoSync,getTabBarPageId:getTabBarPageId,getTopWindowStyle:getTopWindowStyle,getVideoInfo:getVideoInfo,getWindowInfo:getWindowInfo,hideActionSheet:hideActionSheet,hideKeyboard:hideKeyboard,hideLeftWindow:hideLeftWindow,hideLoading:hideLoading,hideModal:hideModal,hideNavigationBarLoading:hideNavigationBarLoading,hideRightWindow:hideRightWindow,hideTabBar:hideTabBar,hideTabBarRedDot:hideTabBarRedDot,hideToast:hideToast,hideTopWindow:hideTopWindow,interceptors:interceptors,invokePushCallback:invokePushCallback,loadFontFace:loadFontFace,login:login,makePhoneCall:makePhoneCall,navigateBack:navigateBack,navigateTo:navigateTo,offAccelerometerChange:offAccelerometerChange,offAppHide:offAppHide,offAppShow:offAppShow,offCompassChange:offCompassChange,offError:offError,offLocationChange:offLocationChange,offLocationChangeError:offLocationChangeError,offNetworkStatusChange:offNetworkStatusChange,offPageNotFound:offPageNotFound,offPushMessage:offPushMessage,offThemeChange:offThemeChange$1,offUnhandledRejection:offUnhandledRejection,offWindowResize:offWindowResize,onAccelerometerChange:onAccelerometerChange,onAppHide:onAppHide,onAppShow:onAppShow,onCompassChange:onCompassChange,onCreateVueApp:onCreateVueApp,onError:onError,onGyroscopeChange:onGyroscopeChange,onLocaleChange:onLocaleChange,onLocationChange:onLocationChange,onLocationChangeError:onLocationChangeError,onMemoryWarning:onMemoryWarning,onNetworkStatusChange:onNetworkStatusChange,onPageNotFound:onPageNotFound,onPushMessage:onPushMessage,onSocketClose:onSocketClose,onSocketError:onSocketError,onSocketMessage:onSocketMessage,onSocketOpen:onSocketOpen,onTabBarMidButtonTap:onTabBarMidButtonTap,onThemeChange:onThemeChange$1,onUnhandledRejection:onUnhandledRejection,onUserCaptureScreen:onUserCaptureScreen,onWindowResize:onWindowResize,openDocument:openDocument,openLocation:openLocation,pageScrollTo:pageScrollTo,preloadPage:preloadPage,previewImage:previewImage,reLaunch:reLaunch,redirectTo:redirectTo,removeAllPages:removeAllPages,removeInterceptor:removeInterceptor,removeLastPage:removeLastPage,removeNonTabBarPages:removeNonTabBarPages,removeSavedFile:removeSavedFile,removeStorage:removeStorage,removeStorageSync:removeStorageSync,removeTabBarBadge:removeTabBarBadge,request:request$2,rpx2px:upx2px,saveFile:saveFile,saveImageToPhotosAlbum:saveImageToPhotosAlbum,saveVideoToPhotosAlbum:saveVideoToPhotosAlbum,scanCode:scanCode,sendSocketMessage:sendSocketMessage,setClipboardData:setClipboardData,setKeepScreenOn:setKeepScreenOn,setLeftWindowStyle:setLeftWindowStyle,setLocale:setLocale,setNavigationBarColor:setNavigationBarColor,setNavigationBarTitle:setNavigationBarTitle,setPageMeta:setPageMeta,setRightWindowStyle:setRightWindowStyle,setScreenBrightness:setScreenBrightness,setStorage:setStorage,setStorageSync:setStorageSync,setTabBarBadge:setTabBarBadge,setTabBarItem:setTabBarItem,setTabBarStyle:setTabBarStyle,setTopWindowStyle:setTopWindowStyle,showActionSheet:showActionSheet,showLeftWindow:showLeftWindow,showLoading:showLoading,showModal:showModal,showNavigationBarLoading:showNavigationBarLoading,showRightWindow:showRightWindow,showTabBar:showTabBar,showTabBarRedDot:showTabBarRedDot,showToast:showToast,showTopWindow:showTopWindow,startAccelerometer:startAccelerometer,startCompass:startCompass,startGyroscope:startGyroscope,startLocationUpdate:startLocationUpdate,startPullDownRefresh:startPullDownRefresh,stopAccelerometer:stopAccelerometer,stopCompass:stopCompass,stopGyroscope:stopGyroscope,stopLocationUpdate:stopLocationUpdate,stopPullDownRefresh:stopPullDownRefresh,switchTab:switchTab,uploadFile:uploadFile,upx2px:upx2px,vibrateLong:vibrateLong,vibrateShort:vibrateShort},Symbol.toStringTag,{value:"Module"}),CONTEXT_ID="MAP_LOCATION",MapLocation=defineSystemComponent({name:"MapLocation",setup(){const e=reactive({latitude:0,longitude:0,rotate:0});{let t=function(t){e.rotate=t.direction},n=function(){getLocation({type:"gcj02",success:t=>{e.latitude=t.latitude,e.longitude=t.longitude},complete:()=>{o=setTimeout(n,3e4)}})},r=function(){o&&clearTimeout(o),offCompassChange(t)};const i=inject("onMapReady");let o;onCompassChange(t),i(n),onUnmounted(r);const s=inject("addMapChidlContext"),a=inject("removeMapChidlContext"),c={id:CONTEXT_ID,state:e};s(c),onUnmounted(()=>a(c))}return()=>e.latitude?createVNode(MapMarker,mergeProps({anchor:{x:.5,y:.5},width:"44",height:"44",iconPath:ICON_PATH_ORIGIN},e),null,16,["iconPath"]):null}}),props$3={dashArray:{type:Array,default:()=>[0,0]},points:{type:Array,required:!0},strokeWidth:{type:Number,default:1},strokeColor:{type:String,default:"#000000"},fillColor:{type:String,default:"#00000000"},zIndex:{type:Number,default:0}},MapPolygon=defineSystemComponent({name:"MapPolygon",props:props$3,setup(e){let t;return inject("onMapReady")((n,r,i)=>{function o(){const{points:i,strokeWidth:o,strokeColor:s,dashArray:a,fillColor:c,zIndex:l}=e,d=i.map(e=>{const{latitude:t,longitude:n}=e;return getIsAMap()?[n,t]:getIsBMap()?new r.Point(n,t):new r.LatLng(t,n)}),{r:u,g:p,b:h,a:g}=hexToRgba(c),{r:m,g:f,b:v,a:y}=hexToRgba(s),_={clickable:!0,cursor:"crosshair",editable:!1,map:n,fillColor:"",path:d,strokeColor:"",strokeDashStyle:a.some(e=>e>0)?"dash":"solid",strokeWeight:o,visible:!0,zIndex:l};r.Color?(_.fillColor=new r.Color(u,p,h,g),_.strokeColor=new r.Color(m,f,v,y)):(_.fillColor=`rgb(${u}, ${p}, ${h})`,_.fillOpacity=g,_.strokeColor=`rgb(${m}, ${f}, ${v})`,_.strokeOpacity=y),t?t.setOptions(_):getIsBMap()?(t=new r.Polygon(_.path,_),n.addOverlay(t)):t=new r.Polygon(_)}o(),watch(e,o)}),onUnmounted(()=>{t.setMap(null)}),()=>null}}),props$2={id:{type:String,default:""},latitude:{type:[String,Number],default:0},longitude:{type:[String,Number],default:0},scale:{type:[String,Number],default:16},markers:{type:Array,default:()=>[]},includePoints:{type:Array,default:()=>[]},polyline:{type:Array,default:()=>[]},circles:{type:Array,default:()=>[]},controls:{type:Array,default:()=>[]},showLocation:{type:[Boolean,String],default:!1},libraries:{type:Array,default:()=>[]},polygons:{type:Array,default:()=>[]}};function getPoints(e){const t=[];return isArray$3(e)&&e.forEach(e=>{e&&e.latitude&&e.longitude&&t.push({latitude:e.latitude,longitude:e.longitude})}),t}function getAMapPosition(e,t,n){return new e.LngLat(n,t)}function getBMapPosition(e,t,n){return new e.Point(n,t)}function getGoogleOrQQMapPosition(e,t,n){return new e.LatLng(t,n)}function getMapPosition(e,t,n){return getIsBMap()?getBMapPosition(e,t,n):getIsAMap()?getAMapPosition(e,t,n):getGoogleOrQQMapPosition(e,t,n)}function getLat(e){return"getLat"in e?e.getLat():getIsBMap()?e.lat:e.lat()}function getLng(e){return"getLng"in e?e.getLng():getIsBMap()?e.lng:e.lng()}function useMap(e,t,n){const r=useCustomEvent(t,n),i=ref(null);let o,s;const a=reactive({latitude:Number(e.latitude),longitude:Number(e.longitude),includePoints:getPoints(e.includePoints)}),c=[];let l,d;function u(e){l?e(s,o,r):c.push(e)}const p=[];function h(e){d?e():c.push(e)}const g={};function m(){const e=s.getCenter();return{scale:s.getZoom(),centerLocation:{latitude:getLat(e),longitude:getLng(e)}}}function f(){if(getIsAMap()){const e=[];a.includePoints.forEach(t=>{e.push([t.longitude,t.latitude])});const t=new o.Bounds(...e);s.setBounds(t)}else if(getIsBMap());else{const e=new o.LatLngBounds;a.includePoints.forEach(({latitude:t,longitude:n})=>{const r=new o.LatLng(t,n);e.extend(r)}),s.fitBounds(e)}}function v(){const t=i.value,c=getMapPosition(o,a.latitude,a.longitude),l=o.event||o.Event,u=new o.Map(t,{center:c,zoom:Number(e.scale),disableDoubleClickZoom:!0,mapTypeControl:!1,zoomControl:!1,scaleControl:!1,panControl:!1,fullscreenControl:!1,streetViewControl:!1,keyboardShortcuts:!1,minZoom:5,maxZoom:18,draggable:!0});if(getIsBMap()&&(u.centerAndZoom(c,Number(e.scale)),u.enableScrollWheelZoom(),u._printLog&&u._printLog("uniapp")),watch(()=>e.scale,e=>{u.setZoom(Number(e)||16)}),h(()=>{a.includePoints.length&&(f(),function(){const e=getMapPosition(o,a.latitude,a.longitude);s.setCenter(e)}())}),getIsBMap())u.addEventListener("click",()=>{r("tap",{},{}),r("click",{},{})}),u.addEventListener("dragstart",()=>{r("regionchange",{},{type:"begin",causedBy:"gesture"})}),u.addEventListener("dragend",()=>{r("regionchange",{},extend$2({type:"end",causedBy:"drag"},m()))});else{const e=l.addListener(u,"bounds_changed",()=>{e.remove(),d=!0,p.forEach(e=>e()),p.length=0});l.addListener(u,"click",()=>{r("tap",{},{}),r("click",{},{})}),l.addListener(u,"dragstart",()=>{r("regionchange",{},{type:"begin",causedBy:"gesture"})}),l.addListener(u,"dragend",()=>{r("regionchange",{},extend$2({type:"end",causedBy:"drag"},m()))});const t=()=>{n("update:scale",u.getZoom()),r("regionchange",{},extend$2({type:"end",causedBy:"scale"},m()))};l.addListener(u,"zoom_changed",t),l.addListener(u,"zoomend",t),l.addListener(u,"center_changed",()=>{const e=u.getCenter(),t=getLat(e),r=getLng(e);n("update:latitude",t),n("update:longitude",r)})}return u}watch([()=>e.latitude,()=>e.longitude],([e,t])=>{const n=Number(e),r=Number(t);if((n!==a.latitude||r!==a.longitude)&&(a.latitude=n,a.longitude=r,s)){const e=getMapPosition(o,a.latitude,a.longitude);s.setCenter(e)}}),watch(()=>e.includePoints,e=>{a.includePoints=getPoints(e),d&&f()},{deep:!0});try{useSubscribe((e,t={})=>{switch(e){case"getCenterLocation":u(()=>{const n=s.getCenter();callOptions(t,{latitude:getLat(n),longitude:getLng(n),errMsg:`${e}:ok`})});break;case"moveToLocation":{let n=Number(t.latitude),r=Number(t.longitude);if(!n||!r){const e=g[CONTEXT_ID];e&&(n=e.state.latitude,r=e.state.longitude)}if(n&&r){if(a.latitude=n,a.longitude=r,s){const e=getMapPosition(o,n,r);s.setCenter(e)}u(()=>{callOptions(t,`${e}:ok`)})}else callOptions(t,`${e}:fail`)}break;case"translateMarker":u(()=>{const n=g[t.markerId];if(n){try{n.translate(t)}catch(r){callOptions(t,`${e}:fail ${r.message}`)}callOptions(t,`${e}:ok`)}else callOptions(t,`${e}:fail not found`)});break;case"includePoints":a.includePoints=getPoints(t.includePoints),(d||getIsAMap())&&f(),h(()=>{callOptions(t,`${e}:ok`)});break;case"getRegion":h(()=>{const n=s.getBounds(),r=n.getSouthWest(),i=n.getNorthEast();callOptions(t,{southwest:{latitude:getLat(r),longitude:getLng(r)},northeast:{latitude:getLat(i),longitude:getLng(i)},errMsg:`${e}:ok`})});break;case"getScale":u(()=>{callOptions(t,{scale:s.getZoom(),errMsg:`${e}:ok`})})}},useContextInfo(),!0)}catch(y){}return onMounted(()=>{loadMaps(e.libraries,e=>{o=e,s=v(),l=!0,c.forEach(e=>e(s,o,r)),c.length=0,r("updated",{},{})})}),provide("onMapReady",u),provide("addMapChidlContext",function(e){g[e.id]=e}),provide("removeMapChidlContext",function(e){delete g[e.id]}),{state:a,mapRef:i,trigger:r}}const Map$1=defineBuiltInComponent({name:"Map",props:props$2,emits:["markertap","labeltap","callouttap","controltap","regionchange","tap","click","updated","update:scale","update:latitude","update:longitude"],setup(e,{emit:t,slots:n}){const r=ref(null),{mapRef:i,trigger:o}=useMap(e,r,t);return()=>createVNode("uni-map",{ref:r,id:e.id},[createVNode("div",{ref:i,style:"width: 100%; height: 100%; position: relative; overflow: hidden"},null,512),e.markers.map(e=>createVNode(MapMarker,mergeProps({key:e.id},e),null,16)),e.polyline.map(e=>createVNode(MapPolyline,e,null,16)),e.circles.map(e=>createVNode(MapCircle,e,null,16)),e.controls.map(e=>createVNode(MapControl,mergeProps(e,{trigger:o}),null,16,["trigger"])),e.showLocation&&createVNode(MapLocation,null,null),e.polygons.map(e=>createVNode(MapPolygon,e,null,16)),createVNode("div",{style:"position: absolute;top: 0;width: 100%;height: 100%;overflow: hidden;pointer-events: none;"},[n.default&&n.default()])],8,["id"])}});function _isSlot(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!isVNode(e)}function getDefaultStartValue(e){if(e.mode===mode.TIME)return"00:00";if(e.mode===mode.DATE){const t=(new Date).getFullYear()-150;switch(e.fields){case fields.YEAR:return t.toString();case fields.MONTH:return t+"-01";default:return t+"-01-01"}}return""}function getDefaultEndValue(e){if(e.mode===mode.TIME)return"23:59";if(e.mode===mode.DATE){const t=(new Date).getFullYear()+150;switch(e.fields){case fields.YEAR:return t.toString();case fields.MONTH:return t+"-12";default:return t+"-12-31"}}return""}function getDateValueArray(e,t,n,r){const i=e.mode===mode.DATE?"-":":",o=e.mode===mode.DATE?t.dateArray:t.timeArray;let s;if(e.mode===mode.TIME)s=2;else switch(e.fields){case fields.YEAR:s=1;break;case fields.MONTH:s=2;break;default:s=3}const a=String(n).split(i);let c=[];for(let l=0;l<s;l++){const e=a[l];c.push(o[l].indexOf(e))}return c.indexOf(-1)>=0&&(c=r?getDateValueArray(e,t,r):c.map(()=>0)),c}const mode={SELECTOR:"selector",MULTISELECTOR:"multiSelector",TIME:"time",DATE:"date"},fields={YEAR:"year",MONTH:"month",DAY:"day"},selectorType={PICKER:"picker",SELECT:"select"},props={name:{type:String,default:""},range:{type:Array,default:()=>[]},rangeKey:{type:String,default:""},value:{type:[Number,String,Array],default:0},mode:{type:String,default:mode.SELECTOR,validator:e=>Object.values(mode).includes(e)},fields:{type:String,default:""},start:{type:String,default:e=>getDefaultStartValue(e)},end:{type:String,default:e=>getDefaultEndValue(e)},disabled:{type:[Boolean,String],default:!1},selectorType:{type:String,default:""}},index$7=defineBuiltInComponent({name:"Picker",compatConfig:{MODE:3},props:props,emits:["change","cancel","columnchange"],setup(e,{emit:t,slots:n}){initI18nPickerMsgsOnce();const{t:r}=useI18n(),i=ref(null),o=ref(null),s=ref(null),a=ref(null),c=ref(!1),{state:l,rangeArray:d}=usePickerState(e),u=useCustomEvent(i,t),{system:p,selectorTypeComputed:h,_show:g,_l10nColumn:m,_l10nItem:f,_input:v,_fixInputPosition:y,_pickerViewChange:_,_cancel:I,_change:T,_resetFormData:S,_getFormData:E,_createTime:M,_createDate:b,_setValueSync:C}=usePickerMethods(e,l,u,i,o,s,a);usePickerWatch(l,I,T),usePickerForm(S,E),M(),b(),C();const A=usePopupStyle(l);return watchEffect(()=>{l.isDesktop=A.isDesktop.value,l.popupStyle=A.popupStyle.value}),onBeforeUnmount(()=>{o.value&&o.value.remove()}),onMounted(()=>{c.value=!0}),()=>{let t;const{visible:u,contentVisible:S,valueArray:E,popupStyle:M,valueSync:b}=l,{rangeKey:C,mode:A,start:O,end:R}=e,N=useBooleanAttr(e,"disabled");return createVNode("uni-picker",mergeProps({ref:i},N,{onClick:withWebEvent(g)}),[c.value?createVNode("div",{ref:o,class:["uni-picker-container",`uni-${A}-${h.value}`],onWheel:onEventPrevent,onTouchmove:onEventPrevent},[createVNode(Transition,{name:"uni-fade"},{default:()=>[withDirectives(createVNode("div",{class:"uni-mask uni-picker-mask",onClick:withWebEvent(I),onMousemove:y},null,40,["onClick","onMousemove"]),[[vShow,u]])]}),p.value?null:createVNode("div",{class:[{"uni-picker-toggle":u},"uni-picker-custom"],style:M.content},[createVNode("div",{class:"uni-picker-header",onClick:onEventStop},[createVNode("div",{class:"uni-picker-action uni-picker-action-cancel",onClick:withWebEvent(I)},[r("uni.picker.cancel")],8,["onClick"]),createVNode("div",{class:"uni-picker-action uni-picker-action-confirm",onClick:T},[r("uni.picker.done")],8,["onClick"])],8,["onClick"]),S?createVNode(PickerView,{value:m(E),class:"uni-picker-content",onChange:_},_isSlot(t=renderList(m(d.value),(e,t)=>{let n;return createVNode(PickerViewColumn,{key:t},_isSlot(n=renderList(e,(e,n)=>createVNode("div",{key:n,class:"uni-picker-item"},["object"==typeof e?e[C]||"":f(e,t)])))?n:{default:()=>[n],_:1})}))?t:{default:()=>[t],_:1},8,["value","onChange"]):null,createVNode("div",{ref:s,class:"uni-picker-select",onWheel:onEventStop,onTouchmove:onEventStop},[renderList(d.value[0],(e,t)=>createVNode("div",{key:t,class:["uni-picker-item",{selected:E[0]===t}],onClick:()=>{E[0]=t,T()}},["object"==typeof e?e[C]||"":e],10,["onClick"]))],40,["onWheel","onTouchmove"]),createVNode("div",{style:M.triangle},null,4)],6)],40,["onWheel","onTouchmove"]):null,createVNode("div",null,[n.default&&n.default()]),p.value?createVNode("div",{class:"uni-picker-system",onMousemove:withWebEvent(y)},[createVNode("input",{class:["uni-picker-system_input",p.value],ref:a,value:b,type:A,tabindex:"-1",min:O,max:R,onChange:e=>{v(e),onEventStop(e)}},null,42,["value","type","min","max","onChange"])],40,["onMousemove"]):null],16,["onClick"])}}});function usePickerState(e){const t=reactive({valueSync:void 0,visible:!1,contentVisible:!1,popover:null,valueChangeSource:"",timeArray:[],dateArray:[],valueArray:[],oldValueArray:[],isDesktop:!1,popupStyle:{content:{},triangle:{}}}),n=computed$2(()=>{let n=e.range;switch(e.mode){case mode.SELECTOR:return[n];case mode.MULTISELECTOR:return n;case mode.TIME:return t.timeArray;case mode.DATE:{const n=t.dateArray;switch(e.fields){case fields.YEAR:return[n[0]];case fields.MONTH:return[n[0],n[1]];default:return[n[0],n[1],n[2]]}}}return[]});return{state:t,rangeArray:n}}const getiPadFlag=()=>0===String(navigator.vendor).indexOf("Apple")&&navigator.maxTouchPoints>0;function useIsiPad(){const e=ref(!1);return e.value=getiPadFlag(),e}const getSystem=()=>{if(/win|mac/i.test(navigator.platform)){if("Google Inc."===navigator.vendor)return"chrome";if(/Firefox/.test(navigator.userAgent))return"firefox"}return""};function useSystem(){const e=ref("");return e.value=getSystem(),e}let __contentVisibleDelay;function usePickerMethods(e,t,n,r,i,o,s){const a=useIsiPad(),c=useSystem(),l=computed$2(()=>{const t=e.selectorType;return Object.values(selectorType).includes(t)?t:a.value?selectorType.PICKER:selectorType.SELECT}),d=computed$2(()=>e.mode===mode.DATE&&!Object.values(fields).includes(e.fields)&&t.isDesktop?c.value:""),u=computed$2(()=>getDateValueArray(e,t,e.start,getDefaultStartValue(e))),p=computed$2(()=>getDateValueArray(e,t,e.end,getDefaultEndValue(e)));function h(e){return 60*e[0]+e[1]}function g(e){return 31*e[0]*12+31*(e[1]||0)+(e[2]||0)}function m(e,t){for(let n=0;n<e.length&&n<t.length;n++)e[n]=t[n]}function f(){let n=e.value;switch(e.mode){case mode.MULTISELECTOR:{isArray$3(n)||(n=t.valueArray),isArray$3(t.valueSync)||(t.valueSync=[]);const r=t.valueSync.length=Math.max(n.length,e.range.length);for(let i=0;i<r;i++){const r=Number(n[i]),o=Number(t.valueSync[i]),s=isNaN(r)?isNaN(o)?0:o:r,a=e.range[i]?e.range[i].length-1:0;t.valueSync.splice(i,1,s<0||s>a?0:s)}}break;case mode.TIME:case mode.DATE:t.valueSync=String(n);break;default:{const e=Number(n);t.valueSync=e<0?0:e;break}}}function v(){y(),t.valueChangeSource="click";const r=function(){let n=t.valueArray;switch(e.mode){case mode.SELECTOR:return n[0];case mode.MULTISELECTOR:return n.map(e=>e);case mode.TIME:return t.valueArray.map((e,n)=>t.timeArray[n][e]).join(":");case mode.DATE:return t.valueArray.map((e,n)=>t.dateArray[n][e]).join("-")}}();t.valueSync=isArray$3(r)?r.map(e=>e):r,n("change",{},{value:r})}function y(){t.visible=!1,setTimeout(()=>{let e=i.value;e.remove(),r.value.prepend(e),e.style.display="none"},260)}function _(t,n){const{getLocale:r}=useI18n();if(e.mode===mode.DATE){const i=r();if(!i.startsWith("zh"))switch(e.fields){case fields.YEAR:return t;case fields.MONTH:return[t[1],t[0]];default:switch(i){case"es":case"fr":return[t[2],t[1],t[0]];default:return n?[t[2],t[0],t[1]]:[t[1],t[2],t[0]]}}}return t}return watch(()=>t.visible,n=>{n?(clearTimeout(__contentVisibleDelay),t.contentVisible=n,e.mode===mode.SELECTOR&&l.value===selectorType.SELECT&&(o.value.scrollTop=34*t.valueArray[0])):__contentVisibleDelay=setTimeout(()=>{t.contentVisible=n},300)}),watch([()=>e.mode,()=>e.value,()=>e.range],f,{deep:!0}),watch(()=>t.valueSync,function(){let n,r=t.valueSync;switch(e.mode){case mode.MULTISELECTOR:n=[...r];break;case mode.TIME:n=getDateValueArray(e,t,r,formatDateTime({mode:mode.TIME}));break;case mode.DATE:n=getDateValueArray(e,t,r,formatDateTime({mode:mode.DATE}));break;default:n=[r]}t.oldValueArray=[...n],t.valueArray=[...n]},{deep:!0}),watch(()=>t.valueArray,r=>{if(e.mode===mode.TIME||e.mode===mode.DATE){const n=e.mode===mode.TIME?h:g,r=t.valueArray,i=u.value,o=p.value;if(e.mode===mode.DATE){const e=t.dateArray,n=e[2].length,i=Number(e[2][r[2]])||1,o=new Date(`${e[0][r[0]]}/${e[1][r[1]]}/${i}`).getDate();o<i&&(r[2]-=o+n-i)}n(r)<n(i)?m(r,i):n(r)>n(o)&&m(r,o)}r.forEach((r,i)=>{r!==t.oldValueArray[i]&&(t.oldValueArray[i]=r,e.mode===mode.MULTISELECTOR&&n("columnchange",{},{column:i,value:r}))})}),{selectorTypeComputed:l,system:d,_show:function(n){if(e.disabled)return;t.valueChangeSource="";let r=i.value,o=n.currentTarget;r.remove(),(document.querySelector("uni-app")||document.body).appendChild(r),r.style.display="block";const s=o.getBoundingClientRect();t.popover={top:s.top,left:s.left,width:s.width,height:s.height},setTimeout(()=>{t.visible=!0},20)},_cancel:function(e){if("firefox"===d.value&&e){const{top:n,left:r,width:i,height:o}=t.popover,{pageX:s,pageY:a}=e;if(s>r&&s<r+i&&a>n&&a<n+o)return}y(),n("cancel",{},{})},_change:v,_l10nColumn:_,_l10nItem:function(t,n){const{getLocale:r}=useI18n();if(e.mode===mode.DATE){const i=r();if(i.startsWith("zh")){return t+["年","月","日"][n]}if(e.fields!==fields.YEAR&&n===(e.fields===fields.MONTH||"es"!==i&&"fr"!==i?0:1)){let e;switch(i){case"es":e=["enero","febrero","marzo","abril","mayo","junio","​​julio","agosto","septiembre","octubre","noviembre","diciembre"];break;case"fr":e=["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"];break;default:e=["January","February","March","April","May","June","July","August","September","October","November","December"]}return e[Number(t)-1]}}return t},_input:function(e){const n=e.target;t.valueSync=n.value,nextTick(()=>{v()})},_resetFormData:function(){switch(e.mode){case mode.SELECTOR:t.valueSync=0;break;case mode.MULTISELECTOR:t.valueSync=e.value.map(e=>0);break;case mode.DATE:case mode.TIME:t.valueSync=""}},_getFormData:function(){return{value:t.valueSync,key:e.name}},_createTime:function(){let e=[],n=[];for(let t=0;t<24;t++)e.push((t<10?"0":"")+t);for(let t=0;t<60;t++)n.push((t<10?"0":"")+t);t.timeArray.push(e,n)},_createDate:function(){let n=[];const r=function(){let t=(new Date).getFullYear(),n=t-150,r=t+150;if(e.start){const t=new Date(e.start).getFullYear();!isNaN(t)&&t<n&&(n=t)}if(e.end){const t=new Date(e.end).getFullYear();!isNaN(t)&&t>r&&(r=t)}return{start:n,end:r}}();for(let e=r.start,t=r.end;e<=t;e++)n.push(String(e));let i=[];for(let e=1;e<=12;e++)i.push((e<10?"0":"")+e);let o=[];for(let e=1;e<=31;e++)o.push((e<10?"0":"")+e);t.dateArray.push(n,i,o)},_setValueSync:f,_fixInputPosition:function(e){if("chrome"===d.value){const t=r.value.getBoundingClientRect(),n=32;s.value.style.left=e.clientX-t.left-1.5*n+"px",s.value.style.top=e.clientY-t.top-.5*n+"px"}},_pickerViewChange:function(e){t.valueArray=_(e.detail.value,!0)}}}function usePickerWatch(e,t,n){const{key:r,disable:i}=useKeyboard();watchEffect(()=>{i.value=!e.visible}),watch(r,e=>{"esc"===e?t():"enter"===e&&n()})}function usePickerForm(e,t){const n=inject(uniFormKey,!1);if(n){const r={reset:e,submit:()=>{const e=["",null],{key:n,value:r}=t();return""!==n&&(e[0]=n,e[1]=r),e}};n.addField(r),onBeforeUnmount(()=>{n.removeField(r)})}}const UniViewJSBridge$1=extend$2(ViewJSBridge,{publishHandler(e,t,n){UniServiceJSBridge$1.subscribeHandler(e,t,n)}}),uni$1=api,UniServiceJSBridge$1=extend$2(ServiceJSBridge,{publishHandler(e,t,n){UniViewJSBridge$1.subscribeHandler(e,t,n)}}),PageBody=defineSystemComponent({name:"PageBody",setup(e,t){const n=!1,r=ref(null),i=ref(null);return watch(()=>n.enablePullDownRefresh,()=>{i.value=null},{immediate:!0}),()=>createVNode(Fragment,null,[!1,createVNode("uni-page-wrapper",mergeProps({ref:r},i.value),[createVNode("uni-page-body",null,[renderSlot(t.slots,"default")]),null],16)])}}),index=defineSystemComponent({name:"Page",setup(e,t){let n=providePageMeta(getStateId());n.navigationBar;const r={};return useDocumentTitle(n),()=>createVNode("uni-page",{"data-page":n.route,style:r},[createPageBodyVNode(t),null])}});function createPageBodyVNode(e){return openBlock(),createBlock(PageBody,{key:0},{default:withCtx(()=>[renderSlot(e.slots,"page")]),_:3})}const appId="__UNI__6B333E2",appName="云信IM",appVersion="10.4.0",appVersionCode=1030,debug=!1,nvue={"flex-direction":"column"},networkTimeout={request:6e4,connectSocket:6e4,uploadFile:6e4,downloadFile:6e4},router={mode:"hash",base:"./",assets:"assets",routerBase:"/"},async={loading:"AsyncLoading",error:"AsyncError",delay:200,timeout:6e4,suspensible:!0},qqMapKey=void 0,bMapKey=void 0,googleMapKey=void 0,aMapKey=void 0,aMapSecurityJsCode=void 0,aMapServiceHost=void 0,sdkConfigs={},locale="",fallbackLocale="zh-Hans",darkmode=!1,themeConfig={};window.getApp=getApp$1,window.getCurrentPages=getCurrentPages$1,window.wx=uni$1,window.uni=uni$1,window.UniViewJSBridge=UniViewJSBridge$1,window.UniServiceJSBridge=UniServiceJSBridge$1,window.rpx2px=upx2px,window.__setupPage=e=>setupPage(e);const locales=Object.assign({"./locale/en.json":__vite_glob_0_0,"./locale/zh-Hans.json":__vite_glob_0_1}),extend$1=Object.assign;window.__uniConfig=extend$1({globalStyle:{navigationBar:{type:"default",titleColor:"#000000"},isNVue:!1},h5:{optimization:{treeShaking:{enable:!0,exclude:["cshaptx4869-scancode"]}}},tabBar:{position:"bottom",color:"#000000",selectedColor:"#DBB077",borderStyle:"black",blurEffect:"none",fontSize:"10px",iconWidth:"24px",spacing:"3px",height:"60px",list:[{text:"%messageText%",iconPath:"/static/tabbar/home.png",selectedIconPath:"/static/tabbar/home-a.png",pagePath:"pages/Conversation/index"},{text:"%cantactsText%",iconPath:"/static/tabbar/user.png",selectedIconPath:"/static/tabbar/user-a.png",pagePath:"pages/Contact/index"},{text:"保险产品",iconPath:"/static/tabbar/baoxian.png",selectedIconPath:"/static/tabbar/baoxian-a.png",pagePath:"pages/Bao/index"},{text:"%mineText%",pagePath:"pages/User/my/index",iconPath:"/static/tabbar/my.png",selectedIconPath:"/static/tabbar/my-a.png"}],backgroundColor:"#FFFFFF",selectedIndex:0,shown:!0},compilerVersion:"4.76"},{appId:appId,appName:appName,appVersion:appVersion,appVersionCode:appVersionCode,async:async,debug:debug,networkTimeout:networkTimeout,sdkConfigs:sdkConfigs,qqMapKey:qqMapKey,bMapKey:bMapKey,googleMapKey:googleMapKey,aMapKey:aMapKey,aMapSecurityJsCode:aMapSecurityJsCode,aMapServiceHost:aMapServiceHost,nvue:nvue,locale:locale,fallbackLocale:fallbackLocale,locales:Object.keys(locales).reduce((e,t)=>{const n=t.replace(/\.\/locale\/(uni-app.)?(.*).json/,"$2");return extend$1(e[n]||(e[n]={}),locales[t].default),e},{}),router:router,darkmode:darkmode,themeConfig:themeConfig}),window.__uniLayout=window.__uniLayout||{};const AsyncComponentOptions={delay:async.delay,timeout:async.timeout,suspensible:async.suspensible};async.loading&&(AsyncComponentOptions.loadingComponent={name:"SystemAsyncLoading",render:()=>createVNode(resolveComponent(async.loading))}),async.error&&(AsyncComponentOptions.errorComponent={name:"SystemAsyncError",props:["error"],render(){return createVNode(resolveComponent(async.error),{error:this.error})}});const PagesConversationIndexLoader=()=>__vitePreload(()=>import("./pages-Conversation-index.C7VpNxJ5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url).then(e=>setupPage(e.default||e)),PagesConversationIndex=defineAsyncComponent(extend$1({loader:PagesConversationIndexLoader},AsyncComponentOptions)),PagesIndexIndexLoader=()=>__vitePreload(()=>import("./pages-index-index.CI_0cHw_.js"),__vite__mapDeps([18,3,19]),import.meta.url).then(e=>setupPage(e.default||e)),PagesIndexIndex=defineAsyncComponent(extend$1({loader:PagesIndexIndexLoader},AsyncComponentOptions)),PagesBaoIndexLoader=()=>__vitePreload(()=>import("./pages-Bao-index.CWsrEzZ5.js"),__vite__mapDeps([20,21,14,3,15,22,1,23]),import.meta.url).then(e=>setupPage(e.default||e)),PagesBaoIndex=defineAsyncComponent(extend$1({loader:PagesBaoIndexLoader},AsyncComponentOptions)),PagesBaoMyOrderLoader=()=>__vitePreload(()=>import("./pages-Bao-my-order.CZJ8FQxY.js"),__vite__mapDeps([24,25,14,3,15,26,27]),import.meta.url).then(e=>setupPage(e.default||e)),PagesBaoMyOrder=defineAsyncComponent(extend$1({loader:PagesBaoMyOrderLoader},AsyncComponentOptions)),PagesBaoTeamLoader=()=>__vitePreload(()=>import("./pages-Bao-team.Ck3_-uz9.js"),__vite__mapDeps([28,25,14,3,15,26,29]),import.meta.url).then(e=>setupPage(e.default||e)),PagesBaoTeam=defineAsyncComponent(extend$1({loader:PagesBaoTeamLoader},AsyncComponentOptions)),PagesBaoDetailLoader=()=>__vitePreload(()=>import("./pages-Bao-detail.CK3h8CBh.js"),__vite__mapDeps([30,25,14,3,15,26,1,31]),import.meta.url).then(e=>setupPage(e.default||e)),PagesBaoDetail=defineAsyncComponent(extend$1({loader:PagesBaoDetailLoader},AsyncComponentOptions)),PagesBaoPayDetailLoader=()=>__vitePreload(()=>import("./pages-Bao-pay-detail.B0rQwBUL.js"),__vite__mapDeps([32,25,14,3,15,26,33,34,1,35,36,37]),import.meta.url).then(e=>setupPage(e.default||e)),PagesBaoPayDetail=defineAsyncComponent(extend$1({loader:PagesBaoPayDetailLoader},AsyncComponentOptions)),PagesBaoCertificationLoader=()=>__vitePreload(()=>import("./pages-Bao-certification.JE9ZAn_b.js"),__vite__mapDeps([38,21,14,3,15,22,39,40,41]),import.meta.url).then(e=>setupPage(e.default||e)),PagesBaoCertification=defineAsyncComponent(extend$1({loader:PagesBaoCertificationLoader},AsyncComponentOptions)),PagesConversationConversationSearchIndexLoader=()=>__vitePreload(()=>import("./pages-Conversation-conversation-search-index.FIGbChhe.js"),__vite__mapDeps([42,5,3,6,2,4,21,14,15,22,43,44,45]),import.meta.url).then(e=>setupPage(e.default||e)),PagesConversationConversationSearchIndex=defineAsyncComponent(extend$1({loader:PagesConversationConversationSearchIndexLoader},AsyncComponentOptions)),PagesLoginLoginFormLoader=()=>__vitePreload(()=>import("./pages-Login-login-form.DfV4PO49.js"),__vite__mapDeps([46,47,48,39,3,40,49,50,51]),import.meta.url).then(e=>setupPage(e.default||e)),PagesLoginLoginForm=defineAsyncComponent(extend$1({loader:PagesLoginLoginFormLoader},AsyncComponentOptions)),PagesLoginChangePasswordLoader=()=>__vitePreload(()=>import("./pages-Login-changePassword.BbUhA4ZP.js"),__vite__mapDeps([52,48,39,3,40,49,21,14,15,22,53]),import.meta.url).then(e=>setupPage(e.default||e)),PagesLoginChangePassword=defineAsyncComponent(extend$1({loader:PagesLoginChangePasswordLoader},AsyncComponentOptions)),PagesLoginRegisterLoader=()=>__vitePreload(()=>import("./pages-Login-register.Dmuxk_RP.js"),__vite__mapDeps([54,47,48,39,3,40,49,21,14,15,22,55]),import.meta.url).then(e=>setupPage(e.default||e)),PagesLoginRegister=defineAsyncComponent(extend$1({loader:PagesLoginRegisterLoader},AsyncComponentOptions)),PagesChatIndexLoader=()=>__vitePreload(()=>import("./pages-Chat-index.CgZg0YlL.js"),__vite__mapDeps([56,57,3,1,12,5,6,8,9,11,58,59,60,61,7,62,35,36,14,15,63,64]),import.meta.url).then(e=>setupPage(e.default||e)),PagesChatIndex=defineAsyncComponent(extend$1({loader:PagesChatIndexLoader},AsyncComponentOptions)),PagesChatVideoPlayLoader=()=>__vitePreload(()=>import("./pages-Chat-video-play.BVMV33u8.js"),__vite__mapDeps([65,1,66,8,3,9,67,68]),import.meta.url).then(e=>setupPage(e.default||e)),PagesChatVideoPlay=defineAsyncComponent(extend$1({loader:PagesChatVideoPlayLoader},AsyncComponentOptions)),PagesOtherScanLoader=()=>__vitePreload(()=>import("./pages-Other-scan.gKkHyVJ7.js"),__vite__mapDeps([69,1,3,70]),import.meta.url).then(e=>setupPage(e.default||e)),PagesOtherScan=defineAsyncComponent(extend$1({loader:PagesOtherScanLoader},AsyncComponentOptions)),PagesOtherWebviewLoader=()=>__vitePreload(()=>import("./pages-Other-webview.BQ4gRVi5.js"),__vite__mapDeps([71,1,21,14,3,15,22,72]),import.meta.url).then(e=>setupPage(e.default||e)),PagesOtherWebview=defineAsyncComponent(extend$1({loader:PagesOtherWebviewLoader},AsyncComponentOptions)),PagesOtherVideoCallLoader=()=>__vitePreload(()=>import("./pages-Other-video-call.B3O55wRa.js"),__vite__mapDeps([73,74,1,5,3,6,14,15,50,75]),import.meta.url).then(e=>setupPage(e.default||e)),PagesOtherVideoCall=defineAsyncComponent(extend$1({loader:PagesOtherVideoCallLoader},AsyncComponentOptions)),PagesOtherTeamVideoCallLoader=()=>__vitePreload(()=>import("./pages-Other-team-video-call.CTNtitIo.js"),__vite__mapDeps([76,5,3,6,14,15,1,74,50,77]),import.meta.url).then(e=>setupPage(e.default||e)),PagesOtherTeamVideoCall=defineAsyncComponent(extend$1({loader:PagesOtherTeamVideoCallLoader},AsyncComponentOptions)),PagesOtherSelectCallUserLoader=()=>__vitePreload(()=>import("./pages-Other-select-call-user.CA773i42.js"),__vite__mapDeps([78,1,79,5,3,6,7,2,4,80,66,8,9,67,81]),import.meta.url).then(e=>setupPage(e.default||e)),PagesOtherSelectCallUser=defineAsyncComponent(extend$1({loader:PagesOtherSelectCallUserLoader},AsyncComponentOptions)),PagesChatMessageP2pSetLoader=()=>__vitePreload(()=>import("./pages-Chat-message-p2p-set.EouS19yr.js"),__vite__mapDeps([82,66,8,3,9,67,5,6,1,83]),import.meta.url).then(e=>setupPage(e.default||e)),PagesChatMessageP2pSet=defineAsyncComponent(extend$1({loader:PagesChatMessageP2pSetLoader},AsyncComponentOptions)),PagesChatMessageAddNoteLoader=()=>__vitePreload(()=>import("./pages-Chat-message-add-note.DcUK7p9k.js"),__vite__mapDeps([84,21,14,3,15,22,1,85]),import.meta.url).then(e=>setupPage(e.default||e)),PagesChatMessageAddNote=defineAsyncComponent(extend$1({loader:PagesChatMessageAddNoteLoader},AsyncComponentOptions)),PagesChatMessagePinListLoader=()=>__vitePreload(()=>import("./pages-Chat-message-pin-list.C_K-4mps.js"),__vite__mapDeps([86,1,66,8,3,9,67,5,6,7,10,59,11,60,58,61,2,4,87]),import.meta.url).then(e=>setupPage(e.default||e)),PagesChatMessagePinList=defineAsyncComponent(extend$1({loader:PagesChatMessagePinListLoader},AsyncComponentOptions)),PagesChatForwardLoader=()=>__vitePreload(()=>import("./pages-Chat-forward.Dd_OktAg.js"),__vite__mapDeps([88,57,3,1,66,8,9,67,5,6,89,2,4,90]),import.meta.url).then(e=>setupPage(e.default||e)),PagesChatForward=defineAsyncComponent(extend$1({loader:PagesChatForwardLoader},AsyncComponentOptions)),PagesChatMessageReadInfoLoader=()=>__vitePreload(()=>import("./pages-Chat-message-read-info.R8zk9OCE.js"),__vite__mapDeps([91,1,3,8,9,5,6,7,2,4,92]),import.meta.url).then(e=>setupPage(e.default||e)),PagesChatMessageReadInfo=defineAsyncComponent(extend$1({loader:PagesChatMessageReadInfoLoader},AsyncComponentOptions)),PagesTeamTeamSetIndexLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-index.DiD0TgHx.js"),__vite__mapDeps([93,66,8,3,9,67,5,6,1,94]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetIndex=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetIndexLoader},AsyncComponentOptions)),PagesTeamTeamSetTeamQrcodeLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-team-qrcode.BNXlPR2l.js"),__vite__mapDeps([95,96,1,21,14,3,15,22,97]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetTeamQrcode=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetTeamQrcodeLoader},AsyncComponentOptions)),PagesTeamTeamSetTeamInfoEditLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-team-info-edit.B_OqjccM.js"),__vite__mapDeps([98,66,8,3,9,67,5,6,1,99]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetTeamInfoEdit=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetTeamInfoEditLoader},AsyncComponentOptions)),PagesTeamTeamSetTeamNameEditLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-team-name-edit.BueML1Jw.js"),__vite__mapDeps([100,33,3,34,1,21,14,15,22,101]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetTeamNameEdit=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetTeamNameEditLoader},AsyncComponentOptions)),PagesTeamTeamSetTeamIntroEditLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-team-intro-edit.DHRgonQq.js"),__vite__mapDeps([102,1,33,3,34,21,14,15,22,103]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetTeamIntroEdit=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetTeamIntroEditLoader},AsyncComponentOptions)),PagesTeamTeamSetTeamAvatarEditLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-team-avatar-edit.e9V7yJ35.js"),__vite__mapDeps([104,66,8,3,9,67,1,63,105]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetTeamAvatarEdit=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetTeamAvatarEditLoader},AsyncComponentOptions)),PagesTeamTeamSetNickInTeamLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-nick-in-team.frWg4DaK.js"),__vite__mapDeps([106,1,21,14,3,15,22,33,34,107]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetNickInTeam=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetNickInTeamLoader},AsyncComponentOptions)),PagesTeamTeamSetTeamManageLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-team-manage.eciKHBmc.js"),__vite__mapDeps([108,66,8,3,9,67,1,109]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetTeamManage=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetTeamManageLoader},AsyncComponentOptions)),PagesTeamTeamSetTransformTeamLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-transform-team.DgzsPAQl.js"),__vite__mapDeps([110,5,3,6,7,66,8,9,67,1,111]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetTransformTeam=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetTransformTeamLoader},AsyncComponentOptions)),PagesTeamTeamSetTeamManagerListLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-team-manager-list.C2FPL2lI.js"),__vite__mapDeps([112,5,3,6,66,8,9,67,1,7,2,4,113]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetTeamManagerList=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetTeamManagerListLoader},AsyncComponentOptions)),PagesTeamTeamSetAddTeamManagerLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-add-team-manager.KbygS5q2.js"),__vite__mapDeps([114,79,5,3,6,7,2,4,80,66,8,9,67,1,115]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetAddTeamManager=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetAddTeamManagerLoader},AsyncComponentOptions)),PagesTeamTeamMemberIndexLoader=()=>__vitePreload(()=>import("./pages-Team-team-member-index.BSiKoRIP.js"),__vite__mapDeps([116,5,3,6,66,8,9,67,1,7,2,4,117]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamMemberIndex=defineAsyncComponent(extend$1({loader:PagesTeamTeamMemberIndexLoader},AsyncComponentOptions)),PagesTeamTeamCreateIndexLoader=()=>__vitePreload(()=>import("./pages-Team-team-create-index.CwZ8DahQ.js"),__vite__mapDeps([118,79,5,3,6,7,2,4,80,66,8,9,67,1,119]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamCreateIndex=defineAsyncComponent(extend$1({loader:PagesTeamTeamCreateIndexLoader},AsyncComponentOptions)),PagesTeamTeamAddIndexLoader=()=>__vitePreload(()=>import("./pages-Team-team-add-index.BVIFHXP3.js"),__vite__mapDeps([120,79,5,3,6,7,2,4,80,66,8,9,67,1,121]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamAddIndex=defineAsyncComponent(extend$1({loader:PagesTeamTeamAddIndexLoader},AsyncComponentOptions)),PagesContactIndexLoader=()=>__vitePreload(()=>import("./pages-Contact-index.CkCJy8cu.js"),__vite__mapDeps([122,3,1,89,2,4,5,6,12,13,14,15,8,9,16,123]),import.meta.url).then(e=>setupPage(e.default||e)),PagesContactIndex=defineAsyncComponent(extend$1({loader:PagesContactIndexLoader},AsyncComponentOptions)),PagesContactContactListGroupListLoader=()=>__vitePreload(()=>import("./pages-Contact-contact-list-group-list.S0JDRtrb.js"),__vite__mapDeps([124,2,3,4,5,6,66,8,9,67,1,125]),import.meta.url).then(e=>setupPage(e.default||e)),PagesContactContactListGroupList=defineAsyncComponent(extend$1({loader:PagesContactContactListGroupListLoader},AsyncComponentOptions)),PagesContactContactListValidListLoader=()=>__vitePreload(()=>import("./pages-Contact-contact-list-valid-list.CNvO1CZ2.js"),__vite__mapDeps([126,2,3,4,5,6,66,8,9,67,7,127]),import.meta.url).then(e=>setupPage(e.default||e)),PagesContactContactListValidList=defineAsyncComponent(extend$1({loader:PagesContactContactListValidListLoader},AsyncComponentOptions)),PagesContactContactListBlackListLoader=()=>__vitePreload(()=>import("./pages-Contact-contact-list-black-list.BNEPb3sO.js"),__vite__mapDeps([128,2,3,4,5,6,7,66,8,9,67,129]),import.meta.url).then(e=>setupPage(e.default||e)),PagesContactContactListBlackList=defineAsyncComponent(extend$1({loader:PagesContactContactListBlackListLoader},AsyncComponentOptions)),PagesUserFriendAddFriendLoader=()=>__vitePreload(()=>import("./pages-User-friend-add-friend.BzbBphTr.js"),__vite__mapDeps([130,5,3,6,2,4,21,14,15,22,43,44,131]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserFriendAddFriend=defineAsyncComponent(extend$1({loader:PagesUserFriendAddFriendLoader},AsyncComponentOptions)),PagesUserFriendFriendEditLoader=()=>__vitePreload(()=>import("./pages-User-friend-friend-edit.DRJMakca.js"),__vite__mapDeps([132,66,8,3,9,67,33,34,1,133]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserFriendFriendEdit=defineAsyncComponent(extend$1({loader:PagesUserFriendFriendEditLoader},AsyncComponentOptions)),PagesUserFriendIndexLoader=()=>__vitePreload(()=>import("./pages-User-friend-index.D0JS-6zH.js"),__vite__mapDeps([134,1,135,5,3,6,14,15,63,136,21,22,137]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserFriendIndex=defineAsyncComponent(extend$1({loader:PagesUserFriendIndexLoader},AsyncComponentOptions)),PagesUserMyIndexLoader=()=>__vitePreload(()=>import("./pages-User-my-index.Bs-PbgDz.js"),__vite__mapDeps([138,14,3,15,21,22,5,6,1,139]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMyIndex=defineAsyncComponent(extend$1({loader:PagesUserMyIndexLoader},AsyncComponentOptions)),PagesUserMyAboutLoader=()=>__vitePreload(()=>import("./pages-User-my-about.CClTslkE.js"),__vite__mapDeps([140,21,14,3,15,22,141]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMyAbout=defineAsyncComponent(extend$1({loader:PagesUserMyAboutLoader},AsyncComponentOptions)),PagesUserMySettingLoader=()=>__vitePreload(()=>import("./pages-User-my-setting.Df4Oysie.js"),__vite__mapDeps([142,66,8,3,9,67,143]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMySetting=defineAsyncComponent(extend$1({loader:PagesUserMySettingLoader},AsyncComponentOptions)),PagesUserMyMyDetailLoader=()=>__vitePreload(()=>import("./pages-User-my-my-detail.DIJ_qwXA.js"),__vite__mapDeps([144,135,5,3,6,1,14,15,63,136,21,22,145]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMyMyDetail=defineAsyncComponent(extend$1({loader:PagesUserMyMyDetailLoader},AsyncComponentOptions)),PagesUserMyDetailChangeNameLoader=()=>__vitePreload(()=>import("./pages-User-my-detail-change-name.B4UQlkDf.js"),__vite__mapDeps([146,21,14,3,15,22,1,147]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMyDetailChangeName=defineAsyncComponent(extend$1({loader:PagesUserMyDetailChangeNameLoader},AsyncComponentOptions)),PagesUserMyDetailChangeMobileLoader=()=>__vitePreload(()=>import("./pages-User-my-detail-change-mobile.B7VjY4Xg.js"),__vite__mapDeps([148,21,14,3,15,22,1,149]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMyDetailChangeMobile=defineAsyncComponent(extend$1({loader:PagesUserMyDetailChangeMobileLoader},AsyncComponentOptions)),PagesUserMyDetailMyQrcodeLoader=()=>__vitePreload(()=>import("./pages-User-my-detail-my-qrcode.Cq_Oy0e1.js"),__vite__mapDeps([150,21,14,3,15,22,96,1,151]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMyDetailMyQrcode=defineAsyncComponent(extend$1({loader:PagesUserMyDetailMyQrcodeLoader},AsyncComponentOptions)),PagesUserMyDetailChangeSignLoader=()=>__vitePreload(()=>import("./pages-User-my-detail-change-sign.Dh0UIA-w.js"),__vite__mapDeps([152,21,14,3,15,22,1,153]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMyDetailChangeSign=defineAsyncComponent(extend$1({loader:PagesUserMyDetailChangeSignLoader},AsyncComponentOptions)),PagesUserMyCollectionCardLoader=()=>__vitePreload(()=>import("./pages-User-my-collection-card.KuMIzsdM.js"),__vite__mapDeps([154,59,11,8,3,9,1,60,10,155]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMyCollectionCard=defineAsyncComponent(extend$1({loader:PagesUserMyCollectionCardLoader},AsyncComponentOptions)),PagesUserMyCollectionListLoader=()=>__vitePreload(()=>import("./pages-User-my-collection-list.zaoFwLxo.js"),__vite__mapDeps([156,1,2,3,4,66,8,9,67,154,59,11,60,10,155,157]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMyCollectionList=defineAsyncComponent(extend$1({loader:PagesUserMyCollectionListLoader},AsyncComponentOptions)),PagesUserMyDetailIndexLoader=()=>__vitePreload(()=>import("./pages-User-my-detail-index.D2ctjji1.js"),__vite__mapDeps([158,5,3,6,8,9,66,67,62,63,159]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserMyDetailIndex=defineAsyncComponent(extend$1({loader:PagesUserMyDetailIndexLoader},AsyncComponentOptions)),PagesUserDetailItemIndexLoader=()=>__vitePreload(()=>import("./pages-User-detail-item-index.G33k98N6.js"),__vite__mapDeps([160,1,8,3,9,66,67,161]),import.meta.url).then(e=>setupPage(e.default||e)),PagesUserDetailItemIndex=defineAsyncComponent(extend$1({loader:PagesUserDetailItemIndexLoader},AsyncComponentOptions)),PagesTeamTeamSetChangeIntroLoader=()=>__vitePreload(()=>import("./pages-Team-team-set-change-intro.XrELGhEs.js"),__vite__mapDeps([162,21,14,3,15,22,1,163]),import.meta.url).then(e=>setupPage(e.default||e)),PagesTeamTeamSetChangeIntro=defineAsyncComponent(extend$1({loader:PagesTeamTeamSetChangeIntroLoader},AsyncComponentOptions));function renderPage(e,t){return openBlock(),createBlock(index,null,{page:withCtx(()=>[createVNode(e,extend$1({},t,{ref:"page"}),null,512)]),_:1})}window.__uniRoutes=[{path:"/",alias:"/pages/Conversation/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesConversationIndex,t)}},loader:PagesConversationIndexLoader,meta:{isQuit:!0,isEntry:!0,isTabBar:!0,tabBarIndex:0,titleNView:!1,navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/index/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesIndexIndex,t)}},loader:PagesIndexIndexLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Bao/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesBaoIndex,t)}},loader:PagesBaoIndexLoader,meta:{isQuit:!0,isTabBar:!0,tabBarIndex:2,navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Bao/my-order",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesBaoMyOrder,t)}},loader:PagesBaoMyOrderLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Bao/team",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesBaoTeam,t)}},loader:PagesBaoTeamLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Bao/detail",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesBaoDetail,t)}},loader:PagesBaoDetailLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Bao/pay-detail",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesBaoPayDetail,t)}},loader:PagesBaoPayDetailLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Bao/certification",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesBaoCertification,t)}},loader:PagesBaoCertificationLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Conversation/conversation-search/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesConversationConversationSearchIndex,t)}},loader:PagesConversationConversationSearchIndexLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Login/login-form",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesLoginLoginForm,t)}},loader:PagesLoginLoginFormLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Login/changePassword",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesLoginChangePassword,t)}},loader:PagesLoginChangePasswordLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Login/register",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesLoginRegister,t)}},loader:PagesLoginRegisterLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Chat/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesChatIndex,t)}},loader:PagesChatIndexLoader,meta:{enablePullDownRefresh:!1,softinputNavBar:"none",bounce:"none",navigationBar:{backgroundColor:"#F6F8FA",style:"custom",type:"default",titleColor:"#000000"},isNVue:!1}},{path:"/pages/Chat/video-play",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesChatVideoPlay,t)}},loader:PagesChatVideoPlayLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Other/scan",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesOtherScan,t)}},loader:PagesOtherScanLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Other/webview",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesOtherWebview,t)}},loader:PagesOtherWebviewLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Other/video-call",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesOtherVideoCall,t)}},loader:PagesOtherVideoCallLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Other/team-video-call",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesOtherTeamVideoCall,t)}},loader:PagesOtherTeamVideoCallLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Other/select-call-user",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesOtherSelectCallUser,t)}},loader:PagesOtherSelectCallUserLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Chat/message/p2p-set",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesChatMessageP2pSet,t)}},loader:PagesChatMessageP2pSetLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Chat/message/add-note",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesChatMessageAddNote,t)}},loader:PagesChatMessageAddNoteLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Chat/message/pin-list",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesChatMessagePinList,t)}},loader:PagesChatMessagePinListLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Chat/forward",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesChatForward,t)}},loader:PagesChatForwardLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Chat/message-read-info",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesChatMessageReadInfo,t)}},loader:PagesChatMessageReadInfoLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetIndex,t)}},loader:PagesTeamTeamSetIndexLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/team-qrcode",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetTeamQrcode,t)}},loader:PagesTeamTeamSetTeamQrcodeLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/team-info-edit",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetTeamInfoEdit,t)}},loader:PagesTeamTeamSetTeamInfoEditLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/team-name-edit",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetTeamNameEdit,t)}},loader:PagesTeamTeamSetTeamNameEditLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/team-intro-edit",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetTeamIntroEdit,t)}},loader:PagesTeamTeamSetTeamIntroEditLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/team-avatar-edit",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetTeamAvatarEdit,t)}},loader:PagesTeamTeamSetTeamAvatarEditLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/nick-in-team",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetNickInTeam,t)}},loader:PagesTeamTeamSetNickInTeamLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/team-manage",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetTeamManage,t)}},loader:PagesTeamTeamSetTeamManageLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/transform-team",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetTransformTeam,t)}},loader:PagesTeamTeamSetTransformTeamLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/team-manager-list",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetTeamManagerList,t)}},loader:PagesTeamTeamSetTeamManagerListLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/add-team-manager",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetAddTeamManager,t)}},loader:PagesTeamTeamSetAddTeamManagerLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-member/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamMemberIndex,t)}},loader:PagesTeamTeamMemberIndexLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-create/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamCreateIndex,t)}},loader:PagesTeamTeamCreateIndexLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-add/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamAddIndex,t)}},loader:PagesTeamTeamAddIndexLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Contact/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesContactIndex,t)}},loader:PagesContactIndexLoader,meta:{isQuit:!0,isTabBar:!0,tabBarIndex:1,titleNView:!1,navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Contact/contact-list/group-list",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesContactContactListGroupList,t)}},loader:PagesContactContactListGroupListLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Contact/contact-list/valid-list",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesContactContactListValidList,t)}},loader:PagesContactContactListValidListLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Contact/contact-list/black-list",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesContactContactListBlackList,t)}},loader:PagesContactContactListBlackListLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/friend/add-friend",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserFriendAddFriend,t)}},loader:PagesUserFriendAddFriendLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/friend/friend-edit",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserFriendFriendEdit,t)}},loader:PagesUserFriendFriendEditLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/friend/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserFriendIndex,t)}},loader:PagesUserFriendIndexLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMyIndex,t)}},loader:PagesUserMyIndexLoader,meta:{isQuit:!0,isTabBar:!0,tabBarIndex:3,navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my/about",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMyAbout,t)}},loader:PagesUserMyAboutLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my/setting",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMySetting,t)}},loader:PagesUserMySettingLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my/my-detail",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMyMyDetail,t)}},loader:PagesUserMyMyDetailLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my-detail/change-name",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMyDetailChangeName,t)}},loader:PagesUserMyDetailChangeNameLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my-detail/change-mobile",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMyDetailChangeMobile,t)}},loader:PagesUserMyDetailChangeMobileLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my-detail/my-qrcode",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMyDetailMyQrcode,t)}},loader:PagesUserMyDetailMyQrcodeLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my-detail/change-sign",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMyDetailChangeSign,t)}},loader:PagesUserMyDetailChangeSignLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my/collection-card",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMyCollectionCard,t)}},loader:PagesUserMyCollectionCardLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my/collection-list",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMyCollectionList,t)}},loader:PagesUserMyCollectionListLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/my-detail/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserMyDetailIndex,t)}},loader:PagesUserMyDetailIndexLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/User/detail-item/index",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesUserDetailItemIndex,t)}},loader:PagesUserDetailItemIndexLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}},{path:"/pages/Team/team-set/change-intro",component:{setup(){const e=getApp$1(),t=e&&e.$route&&e.$route.query||{};return()=>renderPage(PagesTeamTeamSetChangeIntro,t)}},loader:PagesTeamTeamSetChangeIntroLoader,meta:{navigationBar:{style:"custom",type:"default"},isNVue:!1}}].map(e=>(e.meta.route=(e.alias||e.path).slice(1),e));var t$1="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule$1(e){var t={exports:{}};return e(t,t.exports),t.exports}var o,a,m,u,h,g,I,M,_,E,S,T,C,N,A,O,R,b,V,k,P,L,w,D,U,x,B,$,j,G,q,H,z,Y,K,W,J,X,Q,Z,ee,te,re,ie,oe,se,ne,ae,ce,de,le,pe,me,ue,he,ge,ve=createCommonjsModule$1(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,o||e,s),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var c,l,d=this._events[a],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,i),!0;case 5:return d.fn.call(d.context,t,r,i,o),!0;case 6:return d.fn.call(d.context,t,r,i,o,s),!0}for(l=1,c=new Array(u-1);l<u;l++)c[l-1]=arguments[l];d.fn.apply(d.context,c)}else{var p,h=d.length;for(l=0;l<h;l++)switch(d[l].once&&this.removeListener(e,d[l].fn,void 0,!0),u){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,t);break;case 3:d[l].fn.call(d[l].context,t,r);break;case 4:d[l].fn.call(d[l].context,t,r,i);break;default:if(!c)for(p=1,c=new Array(u-1);p<u;p++)c[p-1]=arguments[p];d[l].fn.apply(d[l].context,c)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var c=0,l=[],d=a.length;c<d;c++)(a[c].fn!==t||i&&!a[c].once||r&&a[c].context!==r)&&l.push(a[c]);l.length?this._events[o]=1===l.length?l[0]:l:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a}),fe=createCommonjsModule$1(function(e,t){e.exports=function(){function e(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
e=function(){return t};var t={},n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(A){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,o=Object.create(i.prototype),s=new M(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=T(s,n);if(a){if(a===u)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,s),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}t.wrap=l;var u={};function p(){}function h(){}function g(){}var m={};c(m,o,function(){return this});var f=Object.getPrototypeOf,v=f&&f(f(b([])));v&&v!==n&&r.call(v,o)&&(m=v);var y=g.prototype=p.prototype=Object.create(m);function _(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function I(e,t){function n(i,o,s,a){var c=d(e[i],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then(function(e){n("next",e,s,a)},function(e){n("throw",e,s,a)}):t.resolve(u).then(function(e){l.value=e,s(l)},function(e){return n("throw",e,s,a)})}a(c.arg)}var i;this._invoke=function(e,r){function o(){return new t(function(t,i){n(e,r,t,i)})}return i=i?i.then(o,o):o()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=d(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function b(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:C}}function C(){return{value:void 0,done:!0}}return h.prototype=g,c(y,"constructor",g),c(g,"constructor",h),h.displayName=c(g,a,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},t.awrap=function(e){return{__await:e}},_(I.prototype),c(I.prototype,s,function(){return this}),t.AsyncIterator=I,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var s=new I(l(e,n,r,i),o);return t.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})},_(y),c(y,a,"Generator"),c(y,o,function(){return this}),c(y,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=b,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:b(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})}var i={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:72e5},o=function(){},s=function(){function s(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,s),this.isUploadEnable=!0,this.serverAllowUpload=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=i,this.configPath="dispatcher/req",this.dataReportPath="statics/report/common/form",this.traceMsgCache={},this.reqRetryCount=0,this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Date.now(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(e),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return a=s,c=[{key:"setConfig",value:function(e){var t=Object.assign({},this.reportConfig.common,e.common);this.reportConfig=Object.assign({},this.reportConfig,e),this.reportConfig.common=t,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function(e,t){var n=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(e,Object.assign({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},t)).catch(function(e){var t,r;null===(r=null===(t=n.reportConfig)||void 0===t?void 0:t.logger)||void 0===r||r.warn("Reporter immediately upload failed",e)})}},{key:"report",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.priority||(n.priority=this.getEventPriority(e,t)),this.reportConfig.isDataReportEnable&&e){if("login"===e&&!1===t.succeed&&t.process_id){var r=t.extension&&t.extension.find(function(e){return"TCP"===e.operation_type}),o=r&&r.target||"",s=t.process_id+o,a=this.lastFailLogin[s]||0;if(t.start_time-a<i.loginFailIgnoreInterval)return;this.lastFailLogin[s]=t.start_time}var c=Date.now();"HIGH"===n.priority?this.highPriorityMsgList.push({module:e,msg:t,createTime:c}):"NORMAL"===n.priority?this.msgList.push({module:e,msg:t,createTime:c}):"LOW"===n.priority&&this.lowPriorityMsgList.push({module:e,msg:t,createTime:c}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(e,t){if(this.reportConfig.isDataReportEnable&&e&&!this.traceMsgCache[e]){var n=Object.assign(Object.assign({start_time:Date.now()},t),{extension:[]});this.traceMsgCache[e]=n}}},{key:"reportTraceUpdate",value:function(e){}},{key:"reportTraceUpdateV2",value:function(e,t,n){var r,i=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e]){var o=this.traceMsgCache[e].extension,s=o.length,a=(new Date).getTime();0===s?t.duration=a-this.traceMsgCache[e].start_time:o[s-1].end_time?t.duration=a-o[s-1].end_time:t.duration=a-this.traceMsgCache[e].start_time,o.push(Object.assign({end_time:a},t));var c=o.length-1;(null==n?void 0:n.asyncParams)&&((r=this.traceMsgCache[e]).asyncPromiseArray||(r.asyncPromiseArray=[]),this.traceMsgCache[e].asyncPromiseArray.push(n.asyncParams.then(function(t){i.traceMsgCache[e]&&i.traceMsgCache[e].extension[c]&&Object.assign(i.traceMsgCache[e].extension[c],t)})))}}},{key:"reportTraceEnd",value:function(e){var t,n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e])if("nos"!==e||!1===r){"boolean"==typeof r?this.traceMsgCache[e].succeed=!!r:this.traceMsgCache[e].state=r,this.traceMsgCache[e].duration=Date.now()-this.traceMsgCache[e].start_time,this.traceMsgCache[e].extension.forEach(function(e){delete e.end_time});var i=this.traceMsgCache[e];if(this.traceMsgCache[e]=null,i.asyncPromiseArray){(t=this.endedAsyncMsgByModule)[e]||(t[e]=[]),this.endedAsyncMsgByModule[e].push(i);var o=function(){n.endedAsyncMsgByModule[e]&&n.endedAsyncMsgByModule[e].includes(i)&&(delete i.asyncPromiseArray,n.report(e,i,{priority:n.getEventPriority(e,i)}))};Promise.all(i.asyncPromiseArray).then(o).catch(o)}else this.report(e,i,{priority:this.getEventPriority(e,i)})}else this.traceMsgCache[e]=null}},{key:"getEventPriority",value:function(e,t){if("exceptions"===e){if(0===t.action)return"HIGH";if(2===t.action)return"HIGH";if(1===t.action&&0!==t.exception_service)return"HIGH"}else{if("msgReceive"===e)return"LOW";if("nim_api_trace"===e)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function(e){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[e]=[],this.traceMsgCache[e]=null)}},{key:"pause",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function(){var e=this;this.reportConfig.isDataReportEnable&&(Object.keys(this.traceMsgCache).forEach(function(t){e.reportTraceEnd(t,1)}),null!==this.timer&&clearTimeout(this.timer),this.setConfig=o,this.report=o,this.reportTraceStart=o,this.reportTraceUpdate=o,this.reportTraceEnd=o,this.pause=o,this.restore=o,this.destroy=o,this.reqRetryCount=0,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function(){var n,i;return r(this,void 0,void 0,e().mark(function r(){var o,s,a,c,l,d=this;return e().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.loading){r.next=2;break}return r.abrupt("return");case 2:this.loading=!0,o=this.reportConfig.common||{},s=this.reportConfig.compassDataEndpoint.split(",").map(function(e){return"".concat(e,"/").concat(d.configPath)}),a=e().mark(function t(r){return e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!d.initConfigLoaded&&!d.isDestroyed){e.next=2;break}return e.abrupt("return","break");case 2:return e.prev=2,e.next=5,d.reportConfig.request(s[r],{method:"GET",dataType:"json",params:{deviceId:o.dev_id,sdkVer:o.sdk_ver,platform:o.platform,hostEnv:o.host_env,appkey:o.app_key},timeout:d.reportConfig.timeout}).then(function(e){var t,n;if(!d.isDestroyed){if(200===e.status&&e.data&&200===e.data.code){d.initConfigLoaded=!0;var i=e.data.data||{};d.reportConfig.maxSize=i.maxSize>1e3?1e3:i.maxSize,d.reportConfig.maxInterval=i.maxInterval>1e4?1e4:i.maxInterval,d.reportConfig.maxInterval=i.maxInterval<10?10:i.maxInterval,d.reportConfig.minInterval=i.minInterval<2?2:i.minInterval,d.reportConfig.maxDelay=i.maxDelay||300,d.reportConfig.maxInterval=1e3*d.reportConfig.maxInterval,d.reportConfig.minInterval=1e3*d.reportConfig.minInterval,d.reportConfig.maxDelay=1e3*d.reportConfig.maxDelay,i.endpoint?d.dataReportEndpoint=i.endpoint:d.dataReportEndpoint=s[r],d.serverAllowUpload=!0,d.loading=!1,d.reportHeartBeat()}else 200===e.status&&(d.initConfigLoaded=!0);null===(n=null===(t=d.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.log("Get reporter upload config success")}}).catch(function(e){var t,n;d.isDestroyed||(d.loading=!1,null===(n=null===(t=d.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.error("Get reporter upload config failed",e),d.reqRetryCount<12&&(d.reqRetryCount++,setTimeout(function(){d.isDestroyed||d.initUploadConfig()},8e3)))});case 5:e.next=14;break;case 7:if(e.prev=7,e.t0=e.catch(2),!d.isDestroyed){e.next=11;break}return e.abrupt("return",{v:void 0});case 11:d.loading=!1,null===(i=null===(n=d.reportConfig)||void 0===n?void 0:n.logger)||void 0===i||i.error("Exec reporter request failed",e.t0),d.reqRetryCount<12&&(d.reqRetryCount++,setTimeout(function(){d.isDestroyed||d.initUploadConfig()},8e3));case 14:case"end":return e.stop()}},t,null,[[2,7]])}),c=0;case 7:if(!(c<s.length)){r.next=17;break}return r.delegateYield(a(c),"t0",9);case 9:if("break"!==(l=r.t0)){r.next=12;break}return r.abrupt("break",17);case 12:if("object"!==t(l)){r.next=14;break}return r.abrupt("return",l.v);case 14:c++,r.next=7;break;case 17:case"end":return r.stop()}},r,this)}))}},{key:"reportHeartBeat",value:function(){var e=this;this.isDestroyed||(this.timer=setTimeout(function(){e.reportHeartBeat()},this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function(){if(!this.isDestroyed){var e=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Date.now()-this.lastReportTime>=e&&this.upload()}}},{key:"getUploadMsg",value:function(){var e=this,t={},n=Date.now();this.highPriorityMsgList=this.highPriorityMsgList.filter(function(t){return n-t.createTime<e.reportConfig.maxDelay}),this.msgList=this.msgList.filter(function(t){return n-t.createTime<e.reportConfig.maxDelay}),this.lowPriorityMsgList=this.lowPriorityMsgList.filter(function(t){return n-t.createTime<e.reportConfig.maxDelay}),this.cacheMsgList=this.cacheMsgList.filter(function(t){return n-t.createTime<e.reportConfig.maxDelay});var r=this.highPriorityMsgList.slice(0,this.reportConfig.maxSize);if(this.highPriorityMsgList=this.highPriorityMsgList.slice(r.length),r.length<this.reportConfig.maxSize){var i=this.reportConfig.maxSize-r.length;r=r.concat(this.msgList.slice(0,i)),this.msgList=this.msgList.slice(i)}if(r.length<this.reportConfig.maxSize){var o=this.reportConfig.maxSize-r.length;r=r.concat(this.lowPriorityMsgList.slice(0,o)),this.lowPriorityMsgList=this.lowPriorityMsgList.slice(o)}if(r.length<this.reportConfig.maxSize){var s=this.reportConfig.maxSize-r.length;r=r.concat(this.cacheMsgList.slice(0,s)),this.cacheMsgList=this.cacheMsgList.slice(s)}return r.forEach(function(e){t[e.module]?t[e.module].push(e.msg):t[e.module]=[e.msg]}),{uploadMsgArr:r,uploadMsg:t}}},{key:"upload",value:function(){var e,t,n=this;if(this.isUploadEnable&&this.serverAllowUpload&&!(this.lastReportTime&&Date.now()-this.lastReportTime<this.reportConfig.minInterval)){var r=this.getUploadMsg(),i=r.uploadMsgArr,o=r.uploadMsg;if(i.length){this.lastReportTime=Date.now();try{var s="".concat(this.dataReportEndpoint,"/").concat(this.dataReportPath);this.reportConfig.request(s,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:o},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch(function(e){var t,r;n.cacheMsgList=n.cacheMsgList.concat(i).slice(0,n.reportConfig.cacheMaxSize),null===(r=null===(t=n.reportConfig)||void 0===t?void 0:t.logger)||void 0===r||r.warn("Reporter upload failed",e)})}catch(a){null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.warn("Exec reporter request failed",a)}clearTimeout(this.timer),this.reportHeartBeat()}}}}],c&&n(a.prototype,c),l&&n(a,l),Object.defineProperty(a,"prototype",{writable:!1}),s;var a,c,l}();return s}()}),t2;t2=o||(o={}),t2[t2.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",t2[t2.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC",function(e){e[e.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",e[e.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",e[e.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(a||(a={})),function(e){e[e.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",e[e.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",e[e.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(m||(m={})),function(e){e[e.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",e[e.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",e[e.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",e[e.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(u||(u={})),function(e){e[e.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",e[e.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",e[e.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(h||(h={})),function(e){e[e.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",e[e.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(g||(g={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(I||(I={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(M||(M={})),function(e){e[e.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",e[e.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(_||(_={})),function(e){e[e.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",e[e.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",e[e.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",e[e.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(E||(E={})),function(e){e[e.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",e[e.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",e[e.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(S||(S={})),function(e){e[e.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",e[e.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",e[e.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",e[e.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(T||(T={})),function(e){e[e.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",e[e.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",e[e.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",e[e.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",e[e.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",e[e.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",e[e.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",e[e.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",e[e.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(C||(C={})),function(e){e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",e[e.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(N||(N={})),function(e){e[e.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(A||(A={})),function(e){e[e.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",e[e.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(O||(O={})),function(e){e[e.NIM_MESSAGE_AI_STREAM_STATUS_STREAMING=-1]="NIM_MESSAGE_AI_STREAM_STATUS_STREAMING",e[e.NIM_MESSAGE_AI_STREAM_STATUS_NONE=0]="NIM_MESSAGE_AI_STREAM_STATUS_NONE",e[e.NIM_MESSAGE_AI_STREAM_STATUS_PLACEHOLDER=1]="NIM_MESSAGE_AI_STREAM_STATUS_PLACEHOLDER",e[e.NIM_MESSAGE_AI_STREAM_STATUS_CANCEL=2]="NIM_MESSAGE_AI_STREAM_STATUS_CANCEL",e[e.NIM_MESSAGE_AI_STREAM_STATUS_UPDATE=3]="NIM_MESSAGE_AI_STREAM_STATUS_UPDATE",e[e.NIM_MESSAGE_AI_STREAM_STATUS_COMPLETE=4]="NIM_MESSAGE_AI_STREAM_STATUS_COMPLETE",e[e.NIM_MESSAGE_AI_STREAM_STATUS_EXCEPTION=5]="NIM_MESSAGE_AI_STREAM_STATUS_EXCEPTION"}(R||(R={})),function(e){e[e.V2NIM_MESSAGE_AI_STREAM_STOP_OP_DEFAULT=0]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_DEFAULT",e[e.V2NIM_MESSAGE_AI_STREAM_STOP_OP_REVOKE=1]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_REVOKE",e[e.V2NIM_MESSAGE_AI_STREAM_STOP_OP_UPDATE=2]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_UPDATE"}(b||(b={})),function(e){e[e.V2NIM_MESSAGE_AI_REGEN_OP_UPDATE=1]="V2NIM_MESSAGE_AI_REGEN_OP_UPDATE",e[e.V2NIM_MESSAGE_AI_REGEN_OP_NEW=2]="V2NIM_MESSAGE_AI_REGEN_OP_NEW"}(V||(V={})),function(e){e[e.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",e[e.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",e[e.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}(k||(k={})),function(e){e[e.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",e[e.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",e[e.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",e[e.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",e[e.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",e[e.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",e[e.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",e[e.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",e[e.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",e[e.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",e[e.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",e[e.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",e[e.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(P||(P={})),function(e){e[e.V2NIM_SEARCH_KEYWORD_MATCH_TYPE_OR=0]="V2NIM_SEARCH_KEYWORD_MATCH_TYPE_OR",e[e.V2NIM_SEARCH_KEYWORD_MATCH_TYPE_AND=1]="V2NIM_SEARCH_KEYWORD_MATCH_TYPE_AND"}(L||(L={})),function(e){e[e.V2NIM_SEARCH_DIRECTION_BACKWARD=0]="V2NIM_SEARCH_DIRECTION_BACKWARD",e[e.V2NIM_SEARCH_DIRECTION_FORWARD=1]="V2NIM_SEARCH_DIRECTION_FORWARD"}(w||(w={})),function(e){e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(D||(D={})),function(e){e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(U||(U={})),function(e){e[e.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",e[e.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",e[e.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(x||(x={})),function(e){e[e.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",e[e.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(B||(B={})),function(e){e[e.V2NIM_CLEAR_HISTORY_MODE_ALL=0]="V2NIM_CLEAR_HISTORY_MODE_ALL",e[e.V2NIM_CLEAR_HISTORY_MODE_LOCAL=1]="V2NIM_CLEAR_HISTORY_MODE_LOCAL",e[e.V2NIM_CLEAR_HISTORY_MODE_LOCAL_IRREPARABLY=2]="V2NIM_CLEAR_HISTORY_MODE_LOCAL_IRREPARABLY"}($||($={})),function(e){e[e.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(j||(j={})),function(e){e[e.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(G||(G={})),function(e){e[e.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",e[e.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(q||(q={})),function(e){e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(H||(H={})),function(e){e[e.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",e[e.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(z||(z={})),function(e){e[e.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",e[e.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",e[e.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",e[e.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",e[e.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",e[e.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",e[e.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",e[e.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(Y||(Y={})),function(e){e[e.NIM_MESSAGE_STREAM_STATUS_STREAMING=-1]="NIM_MESSAGE_STREAM_STATUS_STREAMING",e[e.NIM_MESSAGE_STREAM_STATUS_NONE=0]="NIM_MESSAGE_STREAM_STATUS_NONE",e[e.NIM_MESSAGE_STREAM_STATUS_PLACEHOLDER=1]="NIM_MESSAGE_STREAM_STATUS_PLACEHOLDER",e[e.NIM_MESSAGE_STREAM_STATUS_CANCEL=2]="NIM_MESSAGE_STREAM_STATUS_CANCEL",e[e.NIM_MESSAGE_AI_STREAM_STATUS_UPDATE=3]="NIM_MESSAGE_AI_STREAM_STATUS_UPDATE",e[e.NIM_MESSAGE_STREAM_STATUS_COMPLETE=4]="NIM_MESSAGE_STREAM_STATUS_COMPLETE",e[e.NIM_MESSAGE_STREAM_STATUS_EXCEPTION=5]="NIM_MESSAGE_STREAM_STATUS_EXCEPTION"}(K||(K={})),function(e){e[e.V2NIM_MESSAGE_SOURCE_UNKNOWN=0]="V2NIM_MESSAGE_SOURCE_UNKNOWN",e[e.V2NIM_MESSAGE_SOURCE_ONLINE=1]="V2NIM_MESSAGE_SOURCE_ONLINE",e[e.V2NIM_MESSAGE_SOURCE_OFFLINE=2]="V2NIM_MESSAGE_SOURCE_OFFLINE",e[e.V2NIM_MESSAGE_SOURCE_ROAMING=3]="V2NIM_MESSAGE_SOURCE_ROAMING"}(W||(W={})),function(e){e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(J||(J={})),function(e){e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(X||(X={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(Q||(Q={})),function(e){e[e.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",e[e.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",e[e.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(Z||(Z={})),function(e){e[e.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",e[e.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",e[e.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(ee||(ee={})),function(e){e[e.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",e[e.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(te||(te={})),function(e){e[e.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",e[e.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(re||(re={})),function(e){e[e.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(ie||(ie={})),function(e){e[e.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=3]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(oe||(oe={})),function(e){e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(se||(se={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",e[e.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(ne||(ne={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(ae||(ae={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(ce||(ce={})),function(e){e[e.teamApply=0]="teamApply",e[e.teamApplyReject=1]="teamApplyReject",e[e.teamInvite=2]="teamInvite",e[e.teamInviteReject=3]="teamInviteReject",e[e.tlistUpdate=4]="tlistUpdate",e[e.superTeamApply=15]="superTeamApply",e[e.superTeamApplyReject=16]="superTeamApplyReject",e[e.superTeamInvite=17]="superTeamInvite",e[e.superTeamInviteReject=18]="superTeamInviteReject"}(de||(de={})),function(e){e[e.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",e[e.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",e[e.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",e[e.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}(le||(le={})),function(e){e[e.V2NIM_AI_MODEL_STREAM_CALL_STATUS_NONE=0]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_NONE",e[e.V2NIM_AI_MODEL_STREAM_CALL_STATUS_CANCEL=2]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_CANCEL",e[e.V2NIM_AI_MODEL_STREAM_CALL_STATUS_COMPLETE=4]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_COMPLETE",e[e.V2NIM_AI_MODEL_STREAM_CALL_STATUS_EXCEPTION=5]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_EXCEPTION"}(pe||(pe={})),function(e){e.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",e.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",e.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}(me||(me={})),function(e){e[e.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL",e[e.V2NIM_SIGNALLING_EVENT_TYPE_KICK=9]="V2NIM_SIGNALLING_EVENT_TYPE_KICK"}(ue||(ue={})),function(e){e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(he||(he={})),function(e){e[e.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",e[e.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",e[e.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",e[e.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(ge||(ge={}));var Ie={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failed，use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_IS_NOT_STICK_TOP:{code:110305,message:"conversation is not stick top"},V2NIM_ERROR_CODE_STICK_TOP_DISABLED:{code:110306,message:"conversation stick top disabled"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"},V2NIM_ERROR_CODE_STREAM_OUTPUT_STOPPED:{code:189318,message:"Streaming text response stopped"},V2NIM_ERROR_CODE_STREAM_OUTPUT_GENERATED:{code:189319,message:"Streaming text response generated"},V2NIM_ERROR_CODE_STREAM_OUTPUT_ABORTED:{code:189320,message:"Streaming text response aborted due to exception"},V2NIM_ERROR_CODE_INTERRUPTION_REJECTED:{code:189321,message:"Non-streaming messages cannot be interrupted"}},ye=Object.keys(Ie),Me=ye.reduce(function(e,t){var n=Ie[t];return e[t]=n.code,e},{}),_e=ye.reduce(function(e,t){var n=Ie[t];return e[n.code]=n.message,e},{}),Ee=Object.freeze({__proto__:null,V2NIMErrorCode:Me,V2NIMErrorDesc:_e,get V2NIMDataSyncLevel(){return o},get V2NIMDataSyncType(){return a},get V2NIMDataSyncState(){return m},get V2NIMConversationType(){return u},get V2NIMLastMessageState(){return h},get V2NIMFriendAddMode(){return g},get V2NIMFriendAddApplicationType(){return I},get V2NIMFriendAddApplicationStatus(){return M},get V2NIMFriendDeletionType(){return _},get V2NIMFriendVerifyType(){return E},get V2NIMLoginAuthType(){return S},get V2NIMLoginStatus(){return T},get V2NIMLoginClientType(){return C},get V2NIMKickedOfflineReason(){return N},get V2NIMLoginClientChange(){return A},get V2NIMConnectStatus(){return O},get V2NIMMessageType(){return P},get V2NIMMessageNotificationType(){return D},get V2NIMMessageAttachmentUploadState(){return U},get V2NIMMessageSendingState(){return x},get V2NIMQueryDirection(){return B},get V2NIMMessageRevokeType(){return j},get V2NIMMessagePinState(){return G},get V2NIMMessageQuickCommentType(){return q},get V2NIMClientAntispamOperateType(){return H},get V2NIMSortOrder(){return z},get V2NIMSystemMessageType(){return Y},get V2NIMMessageAIStreamStatus(){return R},get V2NIMMessageAIStreamStopOpType(){return b},get V2NIMMessageAIRegenOpType(){return V},get V2NIMMessageAIStatus(){return k},get V2NIMSearchKeywordMatchType(){return L},get V2NIMClearHistoryMode(){return $},get V2NIMMessageStreamStatus(){return K},get V2NIMTeamMessageMuteMode(){return J},get V2NIMP2PMessageMuteMode(){return X},get V2NIMTeamMemberRoleQueryType(){return Q},get V2NIMTeamType(){return Z},get V2NIMTeamJoinMode(){return ee},get V2NIMTeamAgreeMode(){return te},get V2NIMTeamInviteMode(){return re},get V2NIMTeamUpdateInfoMode(){return ie},get V2NIMTeamChatBannedMode(){return oe},get V2NIMTeamUpdateExtensionMode(){return se},get V2NIMTeamJoinActionType(){return ae},get V2NIMTeamJoinActionStatus(){return ce},get V2NIMTeamNotificationType(){return de},get V2NIMTeamMemberRole(){return ne},get V2NIMAIModelRoleType(){return me},get V2NIMAIModelType(){return le},get V2NIMAIModelStreamCallStatus(){return pe},get V2NIMSignallingChannelType(){return he},get V2NIMSignallingEventType(){return ue},get V2NIMUserStatusType(){return ge}});class V2NIMErrorImpl extends Error{constructor(e){super(e.desc),this.name="V2NIMError",this.code=e.code||0,this.desc=e.desc||_e[this.code]||Se[this.code]||"",this.message=this.desc,this.detail=e.detail||{}}toString(){var e,t=`${this.name}\n code: ${this.code}\n message: "${this.message}"\n detail: ${this.detail?JSON.stringify(this.detail):""}`;return(null===(e=null==this?void 0:this.detail)||void 0===e?void 0:e.rawError)&&(t+=`\n rawError: ${this.detail.rawError.message}`),t}}class ValidateError extends V2NIMErrorImpl{constructor(e,t={},n){super({code:Me.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:e,rules:n,data:t}}),this.name="validateError",this.message=this.message+"\n"+JSON.stringify(this.detail,null,2),this.data=t,this.rules=n}}class ValidateErrorV2 extends V2NIMErrorImpl{constructor(e){var t,n,r;super({code:Me.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(t=e.detail)||void 0===t?void 0:t.reason,rules:null===(n=e.detail)||void 0===n?void 0:n.rules,data:null===(r=e.detail)||void 0===r?void 0:r.data}}),this.name="ValidateErrorV2"}}var Se={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"};function replacer(e,t){return t instanceof RegExp?"__REGEXP "+t.toString():t}function validate(e,t={},n,r=!1){var i={};return Object.keys(e).forEach(o=>{var s=e[o].type,a=n?`In ${n}, `:"";if(null==t){var c=`${a}param is null or undefined`;throw r?new ValidateErrorV2({detail:{reason:c,data:{key:o},rules:"required"}}):new ValidateError(c,{key:o},"required")}if(void 0===t[o]){if(!1===e[o].required)return void(i[o]=t[o]);var l=`${a}param '${o}' is required`;throw r?new ValidateErrorV2({detail:{reason:l,data:{key:o},rules:"required"}}):new ValidateError(l,{key:o},"required")}var d=Te[s];if(d&&!d(t,o,e[o],r)){var u=`${a}param '${o}' unexpected`,p={key:o,value:t[o]};throw r?new ValidateErrorV2({detail:{reason:u,data:p,rules:JSON.stringify(e[o],replacer)}}):new ValidateError(u,p,JSON.stringify(e[o],replacer))}i[o]=t[o]}),i}var Te={string:function(e,t,n){var r,{allowEmpty:i,max:o,min:s,regExp:a}=n,c=e[t];return!("string"!=typeof c||!1===i&&""===c||"number"==typeof o&&c.length>o||"number"==typeof s&&c.length<s||(r=a,"[object RegExp]"===Object.prototype.toString.call(r)&&!a.test(c)))},number:function(e,t,n){var{min:r,max:i}=n,o=e[t];return!("number"!=typeof o||"number"==typeof r&&o<r||"number"==typeof i&&o>i)},boolean:function(e,t){return"boolean"==typeof e[t]},file:function(e,t){return!0},enum:function(e,t,n){var{values:r}=n,i=e[t];return!r||r.indexOf(i)>-1},jsonstr:function(e,t){try{var n=JSON.parse(e[t]);return"object"==typeof n&&null!==n}catch(r){return!1}},func:function(e,t){return"function"==typeof e[t]},array:function(e,t,n,r=!1){var i,o,{itemType:s,itemRules:a,rules:c,min:l,max:d,values:u}=n,p=e[t];if(!Array.isArray(p))return!1;if("number"==typeof d&&p.length>d)return!1;if("number"==typeof l&&p.length<l)return!1;if(a)p.forEach((e,n)=>{validate({[n]:a},{[n]:e},`${t}[${n}]`,r)});else if(c)p.forEach((e,n)=>validate(c,e,`${t}[${n}]`,r));else if("enum"===s){if(u&&(i=p,o=u,o=o||[],(i=i||[]).filter(e=>-1===o.indexOf(e))).length)return!1}else if(s&&!p.every(e=>typeof e===s))return!1;return!0},object:function(e,t,n,r=!1){var{rules:i,allowEmpty:o}=n,s=e[t];if("object"!=typeof s||null===s)return!1;if(i){var a=Object.keys(i),c=Object.keys(s).filter(e=>a.indexOf(e)>-1);if(!1===o&&0===c.length)return!1;validate(i,s,t,r)}return!0}};class TimerManager{constructor(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}addTimer(e,t=0,n=1){var r=(new Date).getTime(),i=this.id;return this.timerList.push({id:i,loop:n,count:0,timeout:r+t,interval:t,callback:e}),this.id++,this.checkTimer(r),i}checkTimer(e=(new Date).getTime()){if(this.removeFinished(),0!==this.timerList.length||null==this.timer){var t=0;for(var n of this.timerList)(0===t||t>n.timeout)&&(t=n.timeout);0!==this.timerList.length&&(null===this.timer||t<this.timeout||this.timeout<e)&&(this.timer=setTimeout(this.nowTime.bind(this),t-e),this.timeout=t)}}nowTime(){var e=(new Date).getTime();for(var t of this.timerList)e>=t.timeout&&(t.callback(),t.count++,t.timeout=e+t.interval);this.clerTime(),this.checkTimer(e)}clerTime(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}deleteTimer(e){for(var t=this.timerList.length-1;t>=0;t--)this.timerList[t].id===e&&this.timerList.splice(t,1)}removeFinished(){for(var e=this.timerList.length-1;e>=0;e--){var t=this.timerList[e];t.loop>=0&&t.count>=t.loop&&this.timerList.splice(e,1)}}destroy(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null}}function __rest$1(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function __awaiter$2(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})}function isPlainObject$2(e){return null!=e&&"object"==typeof e&&Object.getPrototypeOf(e)==Object.prototype}var Ce={getNetworkStatus:()=>Promise.resolve({net_type:0,net_connect:!0}),onNetworkStatusChange(e){},offNetworkStatusChange(){}},Ne={isActive:()=>!0,getStatus:()=>0,setStatus(e){},destroy(){}},Ae={setLogger:function(e){throw new Error("setLogger not implemented.")},platform:"",WebSocket:class{constructor(e,t){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}close(e,t){throw new Error("Method not implemented.")}send(e){throw new Error("Method not implemented.")}onclose(e){throw new Error("Method not implemented.")}onerror(e){throw new Error("Method not implemented.")}onmessage(e){throw new Error("Method not implemented.")}onopen(e){throw new Error("Method not implemented.")}},localStorage:{},request:function(e,t){throw new Error("request not implemented.")},uploadFile:function(e){throw new Error("uploadFile not implemented.")},getSystemInfo:function(){throw new Error("getSystemInfo not implemented.")},getFileUploadInformation(e){throw new Error("getFileUploadInformation not implemented.")},envPayload:{},net:Ce,powerMonitor:Ne,logStorage:class{constructor(e){}open(){return Promise.resolve()}close(){}addLogs(e){return Promise.resolve()}extractLogs(){return Promise.resolve()}afterUpload(){return Promise.resolve()}}},Oe=["error","warn","log","debug"],emptyFunc$1=function(){},Re=["off","error","warn","log","debug"];class Logger{constructor(e,t={}){this.storageArr=[],this.debugLevel="off",this.timer=0,this.strategies={debug:{name:"debg",func:console.log},log:{name:"info",func:console.log},warn:{name:"warn",func:console.warn},error:{name:"erro",func:console.error}},this.debug=emptyFunc$1,this.log=emptyFunc$1,this.warn=emptyFunc$1,this.error=emptyFunc$1,this.iid=Math.round(1e3*Math.random()),this.debugLevel=Re.includes(e)?e:"off",t.debugLevel&&(this.debugLevel=Re.includes(t.debugLevel)?t.debugLevel:this.debugLevel),this.logStorage=!1===t.storageEnable?null:new Ae.logStorage(null==t?void 0:t.storageName),this.setOptions(t),this.setLogFunc(this.debugLevel),this.setTimer(),Ae.setLogger(this),this.open()}getDebugMode(){return"debug"===this.debugLevel}open(){this.logStorage&&this.logStorage.open().then(()=>{this.log("Logger::open success")}).catch(e=>{this.warn("Logger::open failed",e)})}setOptions(e){if(e&&e.logFunc){var t=e.logFunc;for(var n in t){var r=n,i=t[r];i&&(this.strategies[r].func=i)}}}setLogFunc(e,t="log"){var n=Oe.findIndex(t=>t===e),r=Oe.findIndex(e=>e===t);Oe.forEach((e,t)=>{this[e]=function(){if(!(t>n&&t>r)){var i=Array.prototype.slice.call(arguments),o=this.strategies[e],s=this.formatArgs(i,o.name);t<=r&&this.logStorage&&this.prepareSaveLog(s,e),t<=n&&o.func(s)}}})}extractLogs(){var e;return this.logStorage?null===(e=this.logStorage)||void 0===e?void 0:e.extractLogs():Promise.resolve("")}afterUpload(){var e;return this.logStorage?null===(e=this.logStorage)||void 0===e?void 0:e.afterUpload():Promise.resolve("")}prepareSaveLog(e,t){this.storageArr.push({text:e,level:t,time:Date.now(),iid:this.iid}),this.timer||this.setTimer(),this.storageArr.length>=100&&(this.triggerTimer(),this.storageArr=[])}saveLogs(){return __awaiter$2(this,void 0,void 0,function*(){if(this.logStorage){var e=this.storageArr;this.storageArr=[];try{yield this.logStorage.addLogs(e)}catch(t){}}})}clearTimer(){this.timer&&clearTimeout(this.timer),this.timer=0}setTimer(){this.clearTimer(),this.timer=setTimeout(this.triggerTimer.bind(this),5e3)}triggerTimer(){this.clearTimer(),this.saveLogs()}formatArgs(e,t){var n=new Date;return`[NIM ${this.iid} ${t} ${n.getMonth()+1}-${n.getDate()} ${n.getHours()}:${n.getMinutes()}:${n.getSeconds()}:${n.getMilliseconds()}] `+e.map(e=>e instanceof V2NIMErrorImpl?e.toString():e instanceof Error?e&&e.message?e.message:e:"object"==typeof e?JSON.stringify(e):e).join(" ")}destroy(){this.debug=emptyFunc$1,this.log=emptyFunc$1,this.warn=emptyFunc$1,this.error=emptyFunc$1,this.saveLogs(),this.clearTimer(),this.storageArr=[],this.logStorage&&this.logStorage.close()}}function get(e,t){if("object"!=typeof e||null===e)return e;for(var n=(t=t||"").split("."),r=0;r<n.length;r++){var i=n[r],o=e[i],s=i.indexOf("["),a=i.indexOf("]");if(-1!==s&&-1!==a&&s<a){var c=i.slice(0,s),l=parseInt(i.slice(s+1,a));o=e[c],o=Array.isArray(o)?o[l]:void 0}if(null==o)return o;e=o}return e}var be,Ve=(be=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return be()+be()+be()+be()+be()+be()+be()+be()});function pendingIsMiniappEnv(){var{hostEnvEnum:e}=Ae.getSystemInfo();return 6===e||102===e||103===e||104===e}function assignOptions(e,t){return function(e,t,n,r){for(var i in e=e||{},n=n||{},r=r||(()=>{}),t=t||{}){var o=r(e[i],t[i]);e[i]=void 0===o?t[i]:o}for(var s in n){var a=r(e[s],n[s]);e[s]=void 0===a?n[s]:a}return e}({},e,t,function(e,t){return void 0===t?e:t})}function emptyFuncWithPromise(){return Promise.resolve()}function emptyFunc(){}class CoreAdapters{constructor(e){this.lastSuccUploadHost="",this.core=e}getFileUploadInformation(e){return Ae.getFileUploadInformation(e)}request(e,t,n){var r=(new Date).getTime(),i=(null==n?void 0:n.exception_service)||0;return Ae.request(e,t).catch(n=>{var o,s,a,c,l=n;throw this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(s=null===(o=this.core)||void 0===o?void 0:o.auth)||void 0===s?void 0:s.account),trace_id:null===(c=null===(a=this.core.clientSocket)||void 0===a?void 0:a.socket)||void 0===c?void 0:c.sessionId,start_time:r,action:1,exception_service:i}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof l.code?l.code:0,description:l.message||`${l.code}`,operation_type:0,target:e,context:t?JSON.stringify(t):""},{asyncParams:Ae.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),n})}uploadFile(e){var t,n,r,i;return __awaiter$2(this,void 0,void 0,function*(){for(var o="BROWSER"===Ae.platform,s=o?e.chunkUploadHostBackupList:e.commonUploadHostBackupList,a=o?e.chunkUploadHost:e.commonUploadHost,c=s.indexOf(a),l=-1===c?[a,...s]:[a,...s.slice(0,c),...s.slice(c+1)],d=Math.max(l.indexOf(this.lastSuccUploadHost),0),u=null,p=0;p<l.length;p++){var h=(new Date).getTime(),g=l[(p+d)%l.length];try{var m=yield Ae.uploadFile(Object.assign(Object.assign({},e),o?{chunkUploadHost:g}:{commonUploadHost:g}));return this.lastSuccUploadHost=g,"string"==typeof m.size&&(m.size=parseInt(m.size)),"string"==typeof m.dur&&(m.dur=parseInt(m.dur)),"string"==typeof m.w&&(m.w=parseInt(m.w)),"string"==typeof m.h&&(m.h=parseInt(m.h)),m}catch(v){this.core.cloudStorage.nos.nosErrorCount--,u=v;var f=v;this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(n=null===(t=this.core)||void 0===t?void 0:t.auth)||void 0===n?void 0:n.account),trace_id:null===(i=null===(r=this.core.clientSocket)||void 0===r?void 0:r.socket)||void 0===i?void 0:i.sessionId,start_time:h,action:1,exception_service:3}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof f.code?f.code:0,description:f.message||`${f.code}`,operation_type:1,target:g},{asyncParams:Ae.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),this._uploadFileErrHanler(v)}}throw u})}_uploadFileErrHanler(e){if(e&&(e.code>200||e.errCode>200))throw e}}var ke="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo";class ABTest{constructor(e,t){this.abtInfo={},this.core=e,this.config=assignOptions({isAbtestEnable:!0,abtestUrl:ke,abtestProjectKey:"imElite_sdk_abtest_web"},t)}setOptions(e){this.config=assignOptions(this.config,e)}abtRequest(){var e,t;return __awaiter$2(this,void 0,void 0,function*(){if(this.config.isAbtestEnable&&!this.abtInfo.experiments&&this.config.abtestUrl){var n;try{n=yield this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.9.41",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7})}catch(r){this.core.logger.warn("ABTest request failed")}this.abtInfo=(null===(t=null===(e=null==n?void 0:n.data)||void 0===e?void 0:e.data)||void 0===t?void 0:t.abtInfo)||{}}})}}class PromiseManager{constructor(){this.abortFns=[]}add(e){var t,n,r,i=(t=e,n={},r=new Promise(function(e,t){n.abort=t}),n.promise=Promise.race([t,r]),n);return this.abortFns.push(i.abort),i.promise}clear(e){this.abortFns.forEach(t=>t(e||new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))),this.abortFns=[]}destroy(){this.clear()}}var Pe={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},Le={timestamp:0,rtt:0,baseClock:0,baseTime:0};class TimeOrigin{constructor(e,t,n="getServerTime"){this.serverOrigin=Le,this.config=Pe,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=e,this.logger=e.logger,this.promiseManager=new PromiseManager,this.cmdName=n,t&&this.setOptions(t)}setOptions(e){this.config=Object.assign({},Pe,this.config,e)}reset(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=Le,this.currentChance=0}setOriginTimetick(){return __awaiter$2(this,void 0,void 0,function*(){if(this.config.enable&&!(this.isSettingNTP||this.currentChance>=this.config.maxChances)){var e=get(this.core,"auth.status"),t=get(this.core,"status"),n=get(this.core,"V2NIMLoginService.lifeCycle.loginStatus");if("logined"===e||"logined"===t||1===n){this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0;var r,i="TimeOrigin::setOriginTimetick:",o=Date.now();this.core.logger.debug(`${i} getServerTime start, times ${this.currentChance}`);try{r=get(yield this.promiseManager.add(this.core.sendCmd(this.cmdName)),"content.time"),this.isSettingNTP=!1}catch(c){var s=c;return this.isSettingNTP=!1,this.logger.warn(`${i} Calculate Delay time, getServerTime error`,s),void(s.code!==Me.V2NIM_ERROR_CODE_CANCELLED&&(clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)))}if(!r)return this.core.logger.warn(`${i} Calculate Delay time incorrect format`),void(this.config.enable=!1);var a=Date.now()-o;this.doSet(r,a)}}})}doSet(e,t){var n="TimeOrigin::setOriginTimetick:";t>this.config.tolerantRTT?(this.logger.warn(`${n} denied RTT:${t}`),clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)):t>this.config.bestRTT?(this.serverOrigin.rtt&&t>=this.serverOrigin.rtt?this.logger.warn(`${n} ignore RTT:${t}`):(this.setServerOrigin(t,e),this.logger.log(`${n} accept reluctantly RTT:${t}`)),clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)):(this.setServerOrigin(t,e),this.logger.debug(`${n} accept best RTT:${t}`),this.currentChance=0,clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.successDelay))}getNTPTime(e){if(void 0===e&&(e=this.getTimeNode()),this.checkNodeReliable(e)){var t=Math.floor(e.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+t}return Date.now()}checkNodeReliable(e){if(void 0===e&&(e=this.getTimeNode()),this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var t=e.clock-this.serverOrigin.baseClock,n=e.time-this.serverOrigin.baseTime;return Math.abs(n-t)<500}return!1}checkPerformance(){return"BROWSER"===Ae.platform}static checkPerformance(){return"BROWSER"===Ae.platform}getTimeNode(){return{clock:this.checkPerformance()?performance.now():0,time:Date.now()}}static getTimeNode(){return{clock:0,time:Date.now()}}setServerOrigin(e,t){this.serverOrigin={timestamp:t+Math.floor(e/2),rtt:e,baseClock:this.checkPerformance()?performance.now():0,baseTime:Date.now()}}}var we={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]};class ReporterHookLinkKeep{constructor(e,t){this.traceData=we,this.core=e,this.traceData=Object.assign({},we,t),this.traceData.extension=[]}reset(){this.traceData=Object.assign({},we),this.traceData.extension=[]}start(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time=(new Date).getTime()}update(e){return __awaiter$2(this,void 0,void 0,function*(){var{net_type:t,net_connect:n}=yield Ae.net.getNetworkStatus();this.traceData.extension.push(Object.assign({code:0,foreground:!0,foreg_backg_switch:!1,net_type:t,net_connect:n},e))})}end(e){var t=this.traceData.extension[0],n=this.traceData.extension[1];if(t&&0===t.operation_type&&n&&1===n.operation_type){var r=t.net_type!==n.net_type||t.net_connect!==n.net_connect;if(e||!r)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()}}var De={user_id:"",trace_id:"",net_connect:!0,net_type:0,duration:0,start_time:0,history:[],succeed:!1};class ReporterHookLBS{constructor(e){this.traceData=De,this.core=e,this.reset()}reset(){this.traceData=Object.assign({},De),this.traceData.history=[]}start(e){this.reset(),this.traceData.user_id=e,this.traceData.start_time=Date.now()}updateBegin(e){this.traceData.history.push(Object.assign({head:"",body:"",start_time:Date.now(),httpdns:!1,index:0},e))}updateComplete(e){this.traceData.history.forEach(t=>{t.target===e.target&&(Object.assign(t,e),t.duration=Date.now()-t.start_time)})}end(e){return __awaiter$2(this,void 0,void 0,function*(){if(this.traceData.succeed=e,this.traceData.history=this.traceData.history.filter(e=>void 0!==e.code),0!==this.traceData.history.length){this.traceData.duration=Date.now()-this.traceData.start_time;var{net_type:t,net_connect:n}=yield Ae.net.getNetworkStatus();this.traceData.net_type=t,this.traceData.net_connect=n,this.core.reporter.report("nim_sdk_lbs_records",this.traceData),this.reset()}else this.reset()})}}function getIsDataReportEnable(e){var t,n,r=!0;return"boolean"==typeof(null===(t=null==e?void 0:e.reporterConfig)||void 0===t?void 0:t.enableCompass)?r=e.reporterConfig.enableCompass:"boolean"==typeof(null===(n=null==e?void 0:e.reporterConfig)||void 0===n?void 0:n.isDataReportEnable)&&(r=e.reporterConfig.isDataReportEnable),r}var Ue={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},xe="ReporterHook::setMonitorForResources:";class ReporterHookCloudStorage{constructor(e,t){this.traceData=Ue,this.core=e,this.traceData=Object.assign({},Ue,t)}reset(){this.traceData=Object.assign({},Ue)}start(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Date.now()}update(e){return __awaiter$2(this,void 0,void 0,function*(){this.traceData.user_id&&(this.core.logger.log(`${xe} upload update`,e),Object.assign(this.traceData,e))})}end(e){this.traceData.user_id&&(this.core.logger.log(`${xe} upload end cause of ${e}`),this.traceData.state=e,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Date.now())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=Ue)}}var Fe={},Be={},$e={},je={apiVersion:"v1",debugLevel:"off",needReconnect:!0,reconnectionAttempts:Number.MAX_SAFE_INTEGER,lbsUrls:["https://lbs.netease.im/lbs/webconf.jsp"],linkUrl:"weblink.netease.im:443",abtestUrl:ke,isAbtestEnable:!0};class NIM$1 extends ve{constructor(e,t={}){if(super(),this.instanceName="NIM",this.pluginMap={},this.eventBus=new ve,this.options={},this.V2NIMConversationIdUtil={},this.V2NIMMessageCreator={},this.V2NIMMessageAttachmentCreator={},this.V2NIMClientAntispamUtil={},this.DataStructureConverter={},this.V2NIMMessageConverter={},this.V2NIMMessageLogUtil={},this.V2NIMMessageExtendUtil={},this.V2NIMStorageUtil={},this.V2NIMNotificationService={},this.V2NIMStorageService={},this.auth={},this.V1NIMLoginService={},this.V2NIMLoginService={},this.clientSocket={},this.V2NIMSyncService={},this.V2NIMLocalConversationService={},this.V2NIMConversationService={},this.V2NIMConversationGroupService={},this.V2NIMMessageService={},this.V2NIMTeamService={},this.V2NIMUserService={},this.V2NIMFriendService={},this.V2NIMSettingService={},this.V2NIMAIService={},this.V2NIMSignallingService={},this.V2NIMSubscriptionService={},this.V2NIMPassthroughService={},this.YSFService={},this.offlinePush={},this.sync={},this.msg={},this.msgLog={},this.session={},this.cloudSession={},this.misc={},this.user={},this.friend={},this.systemMessage={},this.team={},this.event={},this.msgExtend={},this.cloudStorage={},this.passThrough={},this.superTeam={},this.plugin={},this.signaling={},this.qchatChannel={},this.qchatMedia={},this.qchatMsg={},this.qchatRole={},this.qchatServer={},this.pluginMap=$e,this.logger=new Logger(e.debugLevel,t.loggerConfig),t.privateConf){var{authConfig:n,cloudStorageConfig:r,reporterConfig:i}=this.getConfigFromPrivate(t.privateConf);Object.assign(e,n),this.setInitOptions(e),this.otherOptions=Object.assign(Object.assign({},t),{cloudStorageConfig:Object.assign(Object.assign({storageKeyPrefix:"NIM"},t.cloudStorageConfig),r),reporterConfig:Object.assign(Object.assign({},t.reporterConfig),i),V1NIMLoginServiceConfig:Object.assign(Object.assign(Object.assign({},e),t.V1NIMLoginServiceConfig),n),V2NIMLoginServiceConfig:Object.assign(Object.assign({},t.V2NIMLoginServiceConfig),n)})}else this.setInitOptions(e),this.otherOptions=Object.assign(Object.assign({},t),{V1NIMLoginServiceConfig:Object.assign(Object.assign({},e),t.V1NIMLoginServiceConfig),cloudStorageConfig:Object.assign({storageKeyPrefix:"NIM"},t.cloudStorageConfig)});this.timerManager=new TimerManager,this.timeOrigin=new TimeOrigin(this),this.adapters=new CoreAdapters(this),this.abtest=new ABTest(this,Object.assign(Object.assign({isAbtestEnable:this.options.isAbtestEnable,abtestUrl:this.options.abtestUrl},this.otherOptions.abtestConfig),{abtestProjectKey:"imElite_sdk_abtest_web"}));var o=Ae.getSystemInfo(),s=function(e,t){var n,r,i=null===(n=null==t?void 0:t.reporterConfig)||void 0===n?void 0:n.compassDataEndpoint,o=null===(r=null==t?void 0:t.reporterConfig)||void 0===r?void 0:r.reportConfigUrl;if(i)return i;if(o){var s=o.match(/^https:\/\/([^/]+)\/*/);if(Array.isArray(s)&&s.length>=1)return`https://${s[1]}`;e.error(`Invalid reportConfigUrl: ${o}`)}return pendingIsMiniappEnv()?"https://statistic.live.126.net":"https://statistic.live.126.net,https://statistic-overseas.yunxinfw.com"}(this.logger,this.otherOptions);this.reporter=new fe(Object.assign(Object.assign({},s?{compassDataEndpoint:s}:{}),{isDataReportEnable:getIsDataReportEnable(this.otherOptions),common:{app_key:e.appkey,dev_id:"",platform:"Web",sdk_ver:"10.9.41",env:"online",os_name:o.os,os_ver:o.osVer,lib_env:o.libEnv,host_env:o.hostEnv,host_env_ver:o.hostEnvVer,manufactor:o.manufactor,model:o.model,v2:"v1"!==this.options.apiVersion},request:Ae.request,logger:this.logger,autoStart:!0})),this.reporterHookLinkKeep=new ReporterHookLinkKeep(this),this.reporterHookCloudStorage=new ReporterHookCloudStorage(this),this.reporterHookLBS=new ReporterHookLBS(this),this.getServiceKeys(Object.keys(Fe)).forEach(e=>{if(!this[e]||!this[e].name){var t=Fe[e];this[e]=new t(this)}}),Object.keys(Fe).forEach(e=>{this.callSetOptions(e)}),Object.keys(Be).forEach(e=>{var t=Be[e];void 0!==t&&(this[e]=new t(this))}),NIM$1.instance=this,this.logger.log(`NIM init, version:10.9.41, sdk version:100941, appkey:${e.appkey}`)}getServiceKeys(e){var t=e.findIndex(e=>"V1NIMLoginService"===e);if(t>-1){var n=e[t];e.splice(t,1),"v1"===this.options.apiVersion&&e.unshift(n)}var r=e.findIndex(e=>"V2NIMLoginService"===e);if(r>-1){var i=e[r];e.splice(r,1),"v2"===this.options.apiVersion&&e.unshift(i)}var o=e.findIndex(e=>"sync"===e);if(o>-1){var s=e[o];e.splice(o,1),"v1"===this.options.apiVersion&&e.push(s)}var a=e.findIndex(e=>"V2NIMSyncService"===e);if(a>-1){var c=e[a];e.splice(a,1),"v2"===this.options.apiVersion&&e.push(c)}return e}static getInstance(e,t){if(!NIM$1.instance){if(e)return new NIM$1(e,t);throw new Error("Instance not exist, please input options")}if(e){if(NIM$1.instance.options.account===e.account&&NIM$1.instance.options.appkey===e.appkey)return NIM$1.instance.setOptions(e),NIM$1.instance;throw new Error("Unexpected login")}return NIM$1.instance}setInitOptions(e){validate({appkey:{type:"string"},apiVersion:{type:"enum",values:["v1","v2"],required:!1},binaryWebsocket:{type:"boolean",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.options=Object.assign(Object.assign({},je),e)}getConfigFromPrivate(e){var t;return e?{authConfig:JSON.parse(JSON.stringify({appkey:e.appkey||void 0,lbsUrls:e.weblbsUrl?[e.weblbsUrl]:void 0,linkUrl:e.link_web||void 0,linkSSL:null!==(t=e.websdkSsl)&&void 0!==t?t:void 0})),cloudStorageConfig:JSON.parse(JSON.stringify({chunkUploadHost:e.nos_uploader||void 0,commonUploadHost:e.nos_uploader||void 0,commonUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,chunkUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,uploadReplaceFormat:e.nos_downloader_v2?`${e.nosSsl?"https://":"http://"}${e.nos_downloader_v2}`:void 0,downloadUrl:void 0!==e.nos_accelerate?e.nos_accelerate:void 0,downloadHostList:""===e.nos_accelerate_host?[]:"string"==typeof e.nos_accelerate_host?[e.nos_accelerate_host]:Array.isArray(e.nos_accelerate_host)?e.nos_accelerate_host:void 0})),reporterConfig:JSON.parse(JSON.stringify({enableCompass:"boolean"==typeof e.enableCompass?e.enableCompass:void 0,compassDataEndpoint:e.compassDataEndpoint||void 0}))}:{authConfig:{},cloudStorageConfig:{},reporterConfig:{}}}connect(e={}){return this.V1NIMLoginService.login(e)}setOptions(e){if("object"==typeof e&&null!==e){if(Object.prototype.hasOwnProperty.call(e,"account")&&e.account!==this.options.account||Object.prototype.hasOwnProperty.call(e,"appkey")&&e.appkey!==this.options.appkey)throw new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions account and appkey is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"apiVersion")&&e.apiVersion!==this.options.apiVersion)throw new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions apiVersion is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"binaryWebsocket")&&e.binaryWebsocket!==this.options.binaryWebsocket)throw new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions binaryWebsocket is not allowed to reset"}});validate({token:{type:"string",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.logger.log("NIM::setOptions options is",e),this.options=Object.assign(Object.assign({},this.options),e),this.V1NIMLoginService.setOptions&&this.V1NIMLoginService.setOptions(this.options)}}getOptions(){return this.options}disconnect(){return this.V1NIMLoginService.logout()}_disconnect(){return"v1"===this.options.apiVersion?this.V1NIMLoginService.logout():"v2"===this.options.apiVersion?0===get(this.V2NIMLoginService,"lifeCycle.connectStatus")&&0===get(this.V2NIMLoginService,"lifeCycle.loginStatus")?Promise.resolve():this.V2NIMLoginService.logout():Promise.resolve()}destroy(){return NIM$1.instance=void 0,this._disconnect().then(()=>{this.status="destroyed",this.removeAllListeners(),this.eventBus.removeAllListeners(),this.logger.destroy(),this.reporter.destroy(),this.timerManager.destroy(),this._clearModuleData("destroy"),this._removeAllModuleListeners(),this.connect=emptyFuncWithPromise,this.disconnect=emptyFuncWithPromise,this._disconnect=emptyFuncWithPromise,this.destroy=emptyFuncWithPromise})}_clearModuleData(e="logout"){Object.values(this).forEach(t=>{t&&"function"==typeof t.reset&&t.reset(e)})}_removeAllModuleListeners(){Object.values(this).forEach(e=>{e&&"function"==typeof e.removeAllListeners&&e.removeAllListeners()})}kick(e){return this.V1NIMLoginService.kick(e)}sendCmd(e,t,n){return this.clientSocket.sendCmd(e,t,n)}emit(e,...t){try{var n=Date.now(),r=super.emit(e,...t),i=Date.now()-n;return i>=10&&this.logger.warn(`Core::emit event: ${e} process takes: ${i}ms`),r}catch(o){return this.logger.error(`Core::emit event: ${e}. Error: ${o}`),setTimeout(()=>{throw this.logger.error(`Core::emit throw error in setTimeout. event: ${e}. Error: ${o}`),o},0),!1}}get account(){return this.auth.account}get status(){return this.V1NIMLoginService.status}set status(e){this.V1NIMLoginService.status=e}get config(){return{timeout:8e3,deviceId:this.auth.deviceId}}_registerDep(e,t){this[t]&&this[t].name||(this[t]=new e(this),this.callSetOptions(t))}callSetOptions(e){var t=`${e}Config`,n=`${e}Options`,r=this.otherOptions[t]||this.otherOptions[n]||{},i=get(this,`${e}.setOptions`);"function"==typeof i&&("cloudStorage"===e&&(r=this.otherOptions[t]||this.otherOptions.serverConfig||{}),i.call(this[e],r))}static registerService(e,t){Fe[t]=e}static registerPrivateService(e,t){Be[t]=e}static registerPlugin(e,t){$e[t]=e}}NIM$1.sdkVersion=100941,NIM$1.sdkVersionFormat="10.9.41";var Ge={},qe={};function createCmd(e,t,n,r){var i=Ge[e];if(!i)return n.error("createCmd:: can not find cmd config: ",e),null;var o={SER:t,SID:i.sid,CID:i.cid,Q:[]};return i.params&&r&&i.params.forEach(function(e){var t=r[e.name];if(null!=t){var n=e.type,{reflectMapper:i,select:s}=e;switch(e.type){case"PropertyArray":n="ArrayMable",t=t.map(e=>({t:"Property",v:i?serialize(e,i,s):e}));break;case"Property":t=i?serialize(t,i,s):t;break;case"Bool":t=t?"true":"false"}o.Q.push({t:n,v:t})}}),{packet:o,hasPacketResponse:"boolean"!=typeof i.hasPacketResponse||i.hasPacketResponse,hasPacketTimer:"boolean"!=typeof i.hasPacketTimer||i.hasPacketTimer}}function parseCmd(e,t){var n;try{n=JSON.parse(e)}catch(l){return void t.error(`Parse command error:"${e}"`)}var r=n.sid+"_"+n.cid,i=n.r;if(["4_1","4_2","4_10","4_11"].includes(r)){var o=n.r[1].headerPacket;r=`${o.sid}_${o.cid}`,n.sid=o.sid,n.cid=o.cid,i=n.r[1].body}var s=qe[r],a=[];if(s&&s.length>0){for(var c of s)a.push(parseEachCmd(n,c.config,c.cmd,i,t));return a}t.error("parseCmd:: mapper not exist",r,n.code)}function parseEachCmd(e,t,n,r,i){var o,s={cmd:n,raw:e,error:null,service:null==t?void 0:t.service,content:{},__receiveTimeNode:TimeOrigin.getTimeNode()};(18===t.sid||t.sid>=26&&t.sid<100)&&(e.code=function(e){if("number"!=typeof e||e!=e)throw new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:`${e}`}});if(e<0||e>=0&&e<1e3||e>=2e4&&e<=20099)return e;var t=(65535&e)>>9;return 1e5+1e3*(t-=t<=38?1:2)+(511&e)}(e.code));var a,c,l,d,u=(a=e.code,c=n,l=_e[a],null===(d=Se[a])?null:new V2NIMErrorImpl({code:a,desc:l||d||a,detail:{cmd:c,timetag:Date.now()}}));if(s.error=u,s.error){if(s.error.detail.cmd=n,!(null===(o=null==t?void 0:t.ignoreErrCodes)||void 0===o?void 0:o.includes(e.code)))return s;i.warn("parseCmd:: ignore error ",s.error),s.error.detail.ignore=!0}return t.response&&t.response.forEach((e,t)=>{var n=r[t],i=e.type,o=e.name,a=e.reflectMapper;if(void 0!==n)switch(i){case"Property":s.content[o]=a?deserialize(n,a):n;break;case"PropertyArray":s.content[o]=n.map(e=>a?deserialize(e,a):e);break;case"Int":case"Long":case"Byte":s.content[o]=+n;break;case"Bool":s.content[o]="true"===n||!0===n||1===n;break;default:s.content[o]=n}}),s}function serialize(e,t,n){var r={};for(var i in e=function(e,t){var n={};for(var r in t){var i=t[r],o="number"==typeof i?r:i.access?i.access:r,s=o.split("."),a=e;for(var c of s){if(void 0===a[c]||null===a[c]){a=void 0;break}a=a[c]}void 0!==a&&(n[o]=a)}return n}(e,t),t){var o=t[i],s="number"==typeof o?i:o.access?o.access:i;if(!n||n.includes(i))if(s in e){if("number"==typeof o)r[o]=e[s];else if("object"==typeof o)if(o.converter){var a=o.converter(e[s],e);void 0!==a&&(r[o.id]=a)}else r[o.id]=e[s]}else"object"==typeof o&&o.def&&("function"==typeof o.def?r[o.id]=o.def(e):r[o.id]=o.def)}return r}function deserialize(e,t){var n={};for(var r in e){var i=t[r];if("string"==typeof i)n[i]=e[r];else if("object"==typeof i&&"prop"in i){var o=i.access?i.access:i.prop;if(i.converter){var s=i.converter(e[r],e);void 0!==s&&(n[o]=s)}else i.type&&"number"===i.type?n[o]=+e[r]:i.type&&"boolean"===i.type?n[o]=!("0"===e[r]||!e[r]):n[o]=e[r]}}for(var a in t){var c=t[a];if(c&&void 0!==c.def){var l=c.access?c.access:c.prop;l in n||("function"==typeof c.def?n[l]=c.def(e):n[l]=c.def)}}return n=function(e){var t={},n=function(n){var r=n.split(".");r.reduce(function(t,i,o){return t[i]||(t[i]=isNaN(Number(r[o+1]))?r.length-1==o?e[n]:{}:[])},t)};for(var r in e)n(r);return t}(n)}function registerParser(e){for(var t in Object.assign(Ge,e.cmdConfig),e.cmdMap){var n=e.cmdMap[t],r=e.cmdConfig[n];if(r)if(Array.isArray(qe[t])){var i=!1;for(var o of qe[t])if(o.cmd===n&&o.config.service===r.service){i=!0;break}i||qe[t].push({config:r,cmd:n})}else qe[t]=[{config:r,cmd:n}]}}function invertSerializeItem(e){var t={};for(var n in e){var r=e[n];"number"==typeof r?t[r]=n:"object"==typeof r&&(t[r.id]={prop:n,type:r.retType,access:r.retAccess?r.retAccess:r.access?r.access:n,def:r.retDef,converter:r.retConverter})}return t}function boolToInt(e){return e?1:0}function intToBool(e){return 1===parseInt(e)}function objectToJSONString(e){if(e&&"object"==typeof e)try{return JSON.stringify(e)}catch(t){return}}function stringToJSONObject(e){if(e&&"string"==typeof e)try{return JSON.parse(e)}catch(t){return}}function format(e,t){if(!isPlainObject$2(t))return{};var n=JSON.parse(JSON.stringify(t)),r=doFormat(e,n);return JSON.parse(JSON.stringify(Object.assign(Object.assign({},n),r)))}function doFormat(e,t){if(!isPlainObject$2(t))return{};var n={};return Object.keys(e).forEach(r=>{var i=e[r].type;if("string"!=typeof i){var o=doFormat(e[r],t);Object.keys(o).length>0&&(n[r]=o)}else{var s=e[r],a=s.rawKey||r,c=He[i](t,a,s);void 0!==c&&(t[a]=void 0,n[r]=c)}}),n}var He={number:function(e,t){if(void 0!==e[t])return+e[t]},string:function(e,t){if(void 0!==e[t])return e[t]},boolean:function(e,t){return+e[t]>0||0!=+e[t]&&void 0},enum:function(e,t,n){return n.values[e[t]]},object:function(e,t){if(void 0!==e[t])try{return JSON.parse(e[t])}catch(n){return{}}}};function formatLoginInfo(e){return format({type:{type:"number"},port:{type:"number"},customClientType:{type:"number"},timestamp:{type:"number"},loginType:{type:"number"}},e)}var ze={"26_3":"v2Login","26_5":"v2Logout","26_8":"v2KickOffline","26_9":"v2BeKicked","26_10":"v2LoginClientChange","36_1":"v2GetChatroomLinkAddress"},Ye={"1_2":"heartbeat","2_7":"nimLoginClientChange","24_8":"qchatLoginClientChange"},Ke={webLoginReqTag:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,clientId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,thirdPartyExtension:116,env:119,isRoutable:120,token:1e3},mixAuthRepTag:{clientId:1,consid:2,clientIP:3,port:4,type:5,customClientType:6,timestamp:7,customTag:8,os:9,pushType:10,hasTokenPreviously:11,loginType:12},nimAuthRepTag:{type:3,os:4,mac:5,clientId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,consid:102,clientIP:103,port:104,timestamp:109,pushType:110,hasTokenPreviously:111},qchatAuthRepTag:{clientId:8,consid:102,clientIP:103,port:104,type:6,customClientType:13,timestamp:105,os:30,pushType:100,hasTokenPreviously:101}},We={v2Login:{sid:26,cid:3,service:"auth",params:[{type:"Property",name:"tag",reflectMapper:Ke.webLoginReqTag}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Ke.mixAuthRepTag)},{type:"PropertyArray",name:"loginClients",reflectMapper:invertSerializeItem(Ke.mixAuthRepTag)}]},v2Logout:{sid:26,cid:5,service:"auth"},v2KickOffline:{sid:26,cid:8,service:"auth",params:[{type:"StrArray",name:"clientIds"}],response:[{type:"StrArray",name:"clientIds"}]},v2BeKicked:{sid:26,cid:9,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"reasonDesc"},{type:"Int",name:"customClientType"}]},v2LoginClientChange:{sid:26,cid:10,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Ke.mixAuthRepTag)}]},v2GetChatroomLinkAddress:{sid:36,cid:1,service:"auth",params:[{type:"Long",name:"roomId"},{type:"Bool",name:"miniProgram"}],response:[{type:"StrArray",name:"linkAddress"}]}},Je={heartbeat:{sid:1,cid:2,service:"auth"},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Ke.nimAuthRepTag)}]},qchatLoginClientChange:{sid:24,cid:8,service:"auth",response:[{type:"Byte",name:"state"},{type:"Property",name:"data",reflectMapper:invertSerializeItem(Ke.qchatAuthRepTag)}]}},Xe=Backoff;function Backoff(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(e){this.ms=e},Backoff.prototype.setMax=function(e){this.max=e},Backoff.prototype.setJitter=function(e){this.jitter=e};var abs=function(e){var t;if(void 0!==e)return(t=BigNumber(e)).sign=1,t},isArray$1=function(e){return"[object Array]"===Object.prototype.toString.call(e)},isValidType=function(e){return["number"==typeof e,"string"==typeof e&&e.length>0,isArray$1(e)&&e.length>0,e instanceof BigNumber].some(function(e){return!0===e})},Qe="Invalid Number",Ze="Invalid Number - Division By Zero";function BigNumber(e){var t;if(!(this instanceof BigNumber))return new BigNumber(e);if(this.number=[],this.sign=1,this.rest=0,isValidType(e)){if(isArray$1(e)){for((e.length&&"-"===e[0]||"+"===e[0])&&(this.sign="+"===e[0]?1:-1,e.shift(0)),t=e.length-1;t>=0;t--)if(!this.addDigit(e[t]))return}else for("-"!==(e=e.toString()).charAt(0)&&"+"!==e.charAt(0)||(this.sign="+"===e.charAt(0)?1:-1,e=e.substring(1)),t=e.length-1;t>=0;t--)if(!this.addDigit(parseInt(e.charAt(t),10)))return}else this.number=Qe}BigNumber.prototype.addDigit=function(e){return/^\d$/.test(e)?(this.number.push(e),this):(this.number=Qe,!1)},BigNumber.prototype._compare=function(e){var t,n;if(!isValidType(e))return null;if(t=BigNumber(e),this.sign!==t.sign)return this.sign;if(this.number.length>t.number.length)return this.sign;if(this.number.length<t.number.length)return-1*this.sign;for(n=this.number.length-1;n>=0;n--){if(this.number[n]>t.number[n])return this.sign;if(this.number[n]<t.number[n])return-1*this.sign}return 0},BigNumber.prototype.gt=function(e){return this._compare(e)>0},BigNumber.prototype.gte=function(e){return this._compare(e)>=0},BigNumber.prototype.equals=function(e){return 0===this._compare(e)},BigNumber.prototype.lte=function(e){return this._compare(e)<=0},BigNumber.prototype.lt=function(e){return this._compare(e)<0},BigNumber.prototype.subtract=function(e){var t;return void 0===e?this:(t=BigNumber(e),this.sign!==t.sign?(this.number=BigNumber._add(this,t),this):(this.sign=this.lt(t)?-1:1,this.number=abs(this).lt(abs(t))?BigNumber._subtract(t,this):BigNumber._subtract(this,t),this))},BigNumber._add=function(e,t){var n,r=0,i=Math.max(e.number.length,t.number.length);for(n=0;n<i||r>0;n++)e.number[n]=(r+=(e.number[n]||0)+(t.number[n]||0))%10,r=Math.floor(r/10);return e.number},BigNumber._subtract=function(e,t){var n,r=0,i=e.number.length;for(n=0;n<i;n++)e.number[n]-=(t.number[n]||0)+r,e.number[n]+=10*(r=e.number[n]<0?1:0);for(n=0,i=e.number.length-1;0===e.number[i-n]&&i-n>0;)n++;return n>0&&e.number.splice(-n),e.number},BigNumber.prototype.multiply=function(e){if(void 0===e)return this;var t,n,r=BigNumber(e),i=0,o=[];if(this.isZero()||r.isZero())return BigNumber(0);for(this.sign*=r.sign,t=0;t<this.number.length;t++)for(i=0,n=0;n<r.number.length||i>0;n++)o[t+n]=(i+=(o[t+n]||0)+this.number[t]*(r.number[n]||0))%10,i=Math.floor(i/10);return this.number=o,this},BigNumber.prototype.divide=function(e){if(void 0===e)return this;var t,n,r=BigNumber(e),i=[],o=BigNumber(0);if(r.isZero())return this.number=Ze,this;if(this.isZero())return this.rest=BigNumber(0),this;if(this.sign*=r.sign,r.sign=1,1===r.number.length&&1===r.number[0])return this.rest=BigNumber(0),this;for(t=this.number.length-1;t>=0;t--)for(o.multiply(10),o.number[0]=this.number[t],i[t]=0;r.lte(o);)i[t]++,o.subtract(r);for(t=0,n=i.length-1;0===i[n-t]&&n-t>0;)t++;return t>0&&i.splice(-t),this.rest=o,this.number=i,this},BigNumber.prototype.mod=function(e){return this.divide(e).rest},BigNumber.prototype.isZero=function(){var e;for(e=0;e<this.number.length;e++)if(0!==this.number[e])return!1;return!0},BigNumber.prototype.toString=function(){var e,t="";if("string"==typeof this.number)return this.number;for(e=this.number.length-1;e>=0;e--)t+=this.number[e];return this.sign>0?t:"-"+t};var et,rt=Math.pow(2,32);function varintToBytes(e){for(var t=new Uint8Array(5),n=new DataView(t.buffer),r=0;4294967168&e;)n.setUint8(r++,127&e|128),e>>>=7;return n.setUint8(r++,127&e),t.slice(0,r)}function decodeText(e){return"function"==typeof TextDecoder?new TextDecoder("utf-8").decode(e):function(e){for(var t="",n=0;n<e.length;){var r=e[n],i=0,o=0;if(r<=127?(i=0,o=255&r):r<=223?(i=1,o=31&r):r<=239?(i=2,o=15&r):r<=244&&(i=3,o=7&r),e.length-n-i>0)for(var s=0;s<i;)o=o<<6|63&(r=e[n+s+1]),s+=1;else o=65533,i=e.length-n;t+=String.fromCodePoint(o),n+=i+1}return t}(e)}class Unpack{constructor(e){this.offset=0,this.buffer=new Uint8Array(e),this.view=new DataView(e)}checkBufferBoundaryAccess(){return this.offset>=this.buffer.byteLength}length(){var e;return(null===(e=this.view)||void 0===e?void 0:e.byteLength)||0}getBuffer(){return this.view.buffer}getOffset(){return this.offset}popRaw(e){try{var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}catch(n){throw new Error(`UnpackException raw ${n&&n.message}`)}}popByte(){try{var e=this.view.getUint8(this.offset);return this.offset+=1,e}catch(t){throw new Error(`UnpackException byte ${t&&t.message}`)}}popVarbin(){return this.popRaw(this.popVarInt())}popString(){try{return decodeText(this.popVarbin())}catch(t2){throw new Error(`UnpackException string ${t2&&t2.message}`)}}popInt(){try{var e=this.view.getUint32(this.offset,!0);return this.offset+=4,e}catch(t){throw new Error(`UnpackException int ${t&&t.message}`)}}popVarInt(){var e=1,t=0,n=0,r=0;do{if(t+=(127&(n=this.popByte()))*e,e*=128,(r+=1)>5)throw new Error("Variable length quantity is too long")}while(128&n);return t}popLong(){try{var e=function(e,t=!1){var n=new DataView(e.buffer),[r,i]=t?[4,0]:[0,4],o=n.getUint32(r,t),s=n.getUint32(i,t);return o>0?o*rt+s:s}(this.buffer.slice(this.offset,this.offset+8),!0);return this.offset+=8,Number(e)}catch(t){throw new Error(`UnpackException long ${t&&t.message}`)}}popShort(){try{var e=this.view.getUint16(this.offset,!0);return this.offset+=2,e}catch(t){throw new Error(`UnpackException short ${t&&t.message}`)}}popBoolean(){return this.popByte()>0}toString(){return Array.from(new Uint8Array(this.buffer)).toString()}reset(){this.offset=0,this.buffer=null,this.view=null}}class PacketDecoder{constructor(e){this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.resCode=200,this.innerHeader=null,this.msgId=0,this.bodyArr=[],this.unpack=new Unpack(e)}reset(){this.innerHeader=null,this.bodyArr=[],this.unpack.reset()}getBodyDetail(){return this.bodyArr.join("")}unmarshalHeader(){var e=this._unmarshalHeader();this.packetLength=e.packetLength,this.serviceId=e.serviceId,this.commandId=e.commandId,this.serialId=e.serialId,this.tag=e.tag,this.resCode=e.resCode,4===e.serviceId&&[1,2,10,11].includes(e.commandId)&&(this.msgId=this.unmarshalLong(),this.innerHeader=this._unmarshalHeader())}_unmarshalHeader(){var e=this.unpack.popVarInt(),t=this.unpack.popByte(),n=this.unpack.popByte(),r=this.unpack.popShort(),i=this.unpack.popByte(),o=200;return this.hasRescode(i)&&(o=this.unpack.popShort()),{packetLength:e,serviceId:t,commandId:n,serialId:r,tag:i,resCode:o}}hasRescode(e){return 0!=((e=e||this.tag)&PacketDecoder.RES_CODE)}getHeader(){return{packetLength:this.packetLength,sid:this.serviceId,cid:this.commandId,ser:this.serialId,code:this.resCode}}getInnerHeader(){return this.innerHeader?{sid:this.innerHeader.serviceId,cid:this.innerHeader.commandId}:null}unmarshalProperty(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push(`\nProperty(${e}) {`);for(var n=0;n<e;n++){var r=this.unpack.popVarInt();this.bodyArr.push(`${r}:`);var i=this.unpack.popString();this.bodyArr.push(`"${i.length} ${this.unpack.getOffset()}",`),t[r]=i}return this.bodyArr.push("},"),t}unmarshalPropertyArray(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push(`\nPropertyArray(${e}) [`);for(var n=0;n<e;n++)t.push(this.unmarshalProperty());return this.bodyArr.push("],"),t}unmarshalLong(){var e=this.unpack.popLong();return this.bodyArr.push(`\nLong:${e}`),e}unmarshalLongArray(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push(`\nLongArray ${e}:`);for(var n=0;n<e;n++){var r=this.unpack.popLong();this.bodyArr.push(`${r},`),t.push(r)}return t}unmarshalStrArray(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push(`\nStrArray ${e}:`);for(var n=0;n<e;n++){var r=this.unpack.popString();this.bodyArr.push(`${r},`),t.push(r)}return t}unmarshalStrLongMap(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push(`\nStrLongMap ${e}:`);for(var n=0;n<e;n++){var r=this.unpack.popString();this.bodyArr.push(`${r},`);var i=this.unpack.popLong();this.bodyArr.push(`${i};`),t[r]=i}return t}unmarshalStrStrMap(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push(`\nStrStrMap ${e}:`);for(var n=0;n<e;n++){var r=this.unpack.popString();this.bodyArr.push(`${r},`);var i=this.unpack.popString();this.bodyArr.push(`${i};`),t[r]=i}return t}unmarshalLongLongMap(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push(`\nStrLongLongMap ${e}:`);for(var n=0;n<e;n++){var r=this.unpack.popLong();this.bodyArr.push(`${r},`);var i=this.unpack.popLong();this.bodyArr.push(`${i};`),t[r]=i}return{m_map:t}}unmarshalKVArray(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push(`\nKVArray ${e}:`);for(var n=0;n<e;n++)t.push(this.unmarshalStrStrMap());return t}unmarshal(e){var t=Object.assign(Object.assign({},this.getHeader()),{r:[]});if(this.innerHeader&&(t.r[0]=this.msgId,t.r[1]={body:[],headerPacket:this.getInnerHeader()}),![200,406,808,810,7101].includes(t.code))return JSON.stringify(t);if(this.packetLength>0&&this.packetLength>this.unpack.length())throw new Error(`UnpackException packetLength(${this.packetLength}) greater than bufferLength(${this.unpack.length()})`);var n=[];return e&&e.forEach(e=>{if(!this.unpack.checkBufferBoundaryAccess())switch(e.type){case"PropertyArray":n.push(this.unmarshalPropertyArray());break;case"Property":n.push(this.unmarshalProperty());break;case"Byte":n.push(this.unpack.popByte());break;case"Int":n.push(this.unpack.popInt());break;case"Bool":n.push(this.unpack.popBoolean());break;case"Long":n.push(this.unmarshalLong());break;case"LongArray":n.push(this.unmarshalLongArray());break;case"String":n.push(this.unpack.popString());break;case"StrArray":n.push(this.unmarshalStrArray());break;case"StrStrMap":n.push(this.unmarshalStrStrMap());break;case"StrLongMap":n.push(this.unmarshalStrLongMap());break;case"LongLongMap":n.push(this.unmarshalLongLongMap());break;case"KVArray":n.push(this.unmarshalKVArray())}}),this.innerHeader?t.r[1].body=n:t.r=n,JSON.stringify(t)}}PacketDecoder.RES_CODE=2;class Pack{constructor(){this.offset=0,this.pageSize=1024,this.capacity=1048576,this.buffer=new Uint8Array(this.pageSize),this.view=new DataView(this.buffer.buffer)}reset(){this.offset=0,this.buffer=null,this.view=null}size(){return this.offset}getBuffer(){return this.buffer.slice(0,this.offset).buffer}ensureCapacity(e){var t=this.offset+e;if(t>this.capacity)throw new Error("PackException over limit");if(t>this.buffer.byteLength){var n=Math.ceil(t/this.pageSize)*this.pageSize,r=new Uint8Array(n);r.set(this.buffer),this.buffer=r,this.view=new DataView(this.buffer.buffer)}}putRaw(e){this.ensureCapacity(e.length);try{this.buffer.set(e,this.offset),this.offset+=e.length}catch(t){throw new Error("PackException raw")}}putByte(e){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,e)}catch(t){throw new Error("PackException byte")}}putString(e){try{var t=function(e){if("function"==typeof TextEncoder)return(new TextEncoder).encode(e);var t=function(e){for(var t=[],n=e.length,r=0;r<n;){var i=e.codePointAt(r),o=0,s=0;for(i<=127?(o=0,s=0):i<=2047?(o=6,s=192):i<=65535?(o=12,s=224):i<=2097151&&(o=18,s=240),t.push(s|i>>o),o-=6;o>=0;)t.push(128|i>>o&63),o-=6;r+=i>=65536?2:1}return t}(e);return new Uint8Array(t)}(e);this.putVarbin(t)}catch(n){throw new Error("PackException string")}}putInt(e){this.ensureCapacity(4);try{this.view.setInt32(this.offset,e,!0),this.offset+=4}catch(t){throw new Error("PackException int")}}putVarInt(e){var t=varintToBytes(e);this.putRaw(t)}putBoolean(e){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,e?1:0)}catch(t){throw new Error("PackException boolean")}}putLong(e){this.ensureCapacity(8);try{var t=function(e,t=!1){var n=new Uint8Array(8),r=new DataView(n.buffer),i=Number(e>rt-1?e/rt:0),o=Number(4294967295&e),[s,a]=t?[4,0]:[0,4];return r.setUint32(s,i,t),r.setUint32(a,o,t),n}(e,!0);this.buffer.set(t,this.offset),this.offset+=8}catch(n){throw new Error("PackException long")}}putStringAsLong(e){this.ensureCapacity(8);try{var t=function(e,t=!1){var n=new Uint8Array(8),r=new DataView(n.buffer),i=BigNumber(e).divide(rt).number.reverse().join(""),o=BigNumber(e).mod(rt).number.reverse().join(""),s=Number(i),a=Number(o),[c,l]=t?[4,0]:[0,4];return r.setUint32(c,s,t),r.setUint32(l,a,t),n}(e,!0);this.buffer.set(t,this.offset),this.offset+=8}catch(n){throw new Error("PackException stringAsLong")}}putShort(e){this.ensureCapacity(2);try{this.view.setInt16(this.offset,e,!0),this.offset+=2}catch(t){throw new Error("PackException short")}}putVarbin(e){if(!e)return this.ensureCapacity(1),this.putVarInt(0);if(e.byteLength>Math.pow(2,31)-2)throw new Error("PackException varbin. too long");var t=varintToBytes(e.length);this.ensureCapacity(t.length+e.length);try{this.buffer.set(t,this.offset),this.offset+=t.length,this.buffer.set(e,this.offset),this.offset+=e.length}catch(n){throw new Error("PackException varbin")}}}function isConvertibleToNumber(e){if("number"!=typeof e){if(null==e)return!1;e=Number(e)}if(isNaN(e))throw new Error("Number type conversion error");return!0}function isUndefinedOrNull(e){return null==e}class PacketEncoder{constructor(e,t,n){this.pack=new Pack,this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.serviceId=e,this.commandId=t,this.serialId=n}marshalHeader(){this.pack.putVarInt(this.packetLength),this.pack.putByte(this.serviceId),this.pack.putByte(this.commandId),this.pack.putShort(this.serialId),this.pack.putByte(this.tag)}marshalProperty(e){var t=Object.keys(e).filter(e=>!isUndefinedOrNull(e));this.pack.putVarInt(t.length),t.forEach(t=>{this.pack.putVarInt(Number(t)),Array.isArray(e[t])||"[object Object]"===Object.prototype.toString.call(e[t])?this.pack.putString(JSON.stringify(e[t])):this.pack.putString(String(e[t]))})}marshalPropertyArray(e){var t=e.length;this.pack.putVarInt(t),e.forEach(e=>{this.marshalProperty(null==e?void 0:e.v)})}marshalStrArray(e){var t=e.filter(e=>!isUndefinedOrNull(e)),n=t.length;this.pack.putVarInt(n),t.forEach(e=>{this.pack.putString(String(e))})}marshalLongArray(e){var t=e.filter(e=>isConvertibleToNumber(e)),n=t.length;this.pack.putVarInt(n),t.forEach(e=>{this.putLong(e)})}marshalStrStrMap(e){var t=Object.keys(e).filter(t=>!isUndefinedOrNull(e[t])&&!isUndefinedOrNull(t));this.pack.putVarInt(t.length),t.forEach(t=>{this.pack.putString(String(t)),this.pack.putString(String(e[t]))})}marshalStrLongMap(e){var t=Object.keys(e).filter(t=>isConvertibleToNumber(e[t])&&!isUndefinedOrNull(t));this.pack.putVarInt(t.length),t.forEach(t=>{this.pack.putString(String(t)),this.putLong(e[t])})}marshalLongLongMap(e){var t=Object.keys(e).filter(t=>{var n=Number(t);return isConvertibleToNumber(n)&&isConvertibleToNumber(e[n])});this.pack.putVarInt(t.length),t.forEach(t=>{var n=Number(t);this.putLong(n),this.putLong(e[n])})}marshalKVArray(e){var t=e.length;this.pack.putVarInt(t),e.forEach(e=>{this.marshalStrStrMap(e)})}putLong(e){"string"==typeof e&&e.length>15?this.pack.putStringAsLong(e):this.pack.putLong(Number(e))}marshal(e,t){return this.marshalHeader(),t&&t.forEach((t,n)=>{var r,i=t.type,o=null===(r=e[n])||void 0===r?void 0:r.v;if(!isUndefinedOrNull(o))switch(i){case"PropertyArray":this.marshalPropertyArray(o);break;case"Property":this.marshalProperty(o);break;case"Byte":if(!isConvertibleToNumber(o))return;this.pack.putByte(Number(o));break;case"Int":if(!isConvertibleToNumber(o))return;this.pack.putInt(Number(o));break;case"Bool":"false"===o?o=!1:"true"===o&&(o=!0),this.pack.putBoolean(o);break;case"Long":if(!isConvertibleToNumber(o))return;this.putLong(o);break;case"LongArray":this.marshalLongArray(o);break;case"String":this.pack.putString(String(o));break;case"StrArray":this.marshalStrArray(o);break;case"StrStrMap":this.marshalStrStrMap(o);break;case"StrLongMap":this.marshalStrLongMap(o);break;case"LongLongMap":this.marshalLongLongMap(o);break;case"KVArray":this.marshalKVArray(o)}}),this.pack.getBuffer()}reset(){this.pack.reset()}}class BaseWebsocket$1 extends ve{constructor(e,t,n){super(),this.websocket=null,this.socketConnectTimer=0,this.linkSSL=!0,this.url="",this.core=e,this.url=t,this.linkSSL=n,this.status="disconnected",this.logger=e.logger,this.connect()}connect(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this._createWebsocket(`${this.linkSSL?"wss":"ws"}://${this.url}/websocket`)):this.logger.warn("imsocket::socket is connecting or connected",this.status)}close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.close()}catch(t2){this.logger.warn("imsocket::attempt to close websocket error",t2)}this.clean(),this.emit("disconnect")}}clean(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)}onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)}_createWebsocket(e){this.socketConnectTimer=setTimeout(()=>{this.logger.error("imsocket::Websocket connect timeout. url: ",e),this.emit("connectFailed",new V2NIMErrorImpl({code:"v2"===get(this.core,"options.apiVersion")?Me.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:`imsocket::Websocket connect timeout. url: ${e}`}}))},this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new Ae.WebSocket(e),this.websocket.binaryType="arraybuffer",this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onclose=e=>{e=e||{},this.logger.log(`imsocket::Websocket onclose done ${e.wasClean}/${e.code}/${e.reason}`),"connected"===this.status?(this.clean(),this.emit("disconnect")):(this.clean(),this.emit("connectFailed",new V2NIMErrorImpl({code:"v2"===get(this.core,"options.apiVersion")?Me.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onclose done"}})))},this.websocket.onerror=e=>{this.logger.error("imsocket::Websocket onerror",e),"connected"===this.status?(this.clean(),this.emit("disconnect")):(this.clean(),this.emit("connectFailed",new V2NIMErrorImpl({code:"v2"===get(this.core,"options.apiVersion")?Me.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onerror."}})))},this.websocket.onopen=()=>{this.onConnect()}}onMessage(e){if(e.data){var t=new PacketDecoder(e.data),n={sid:-1,cid:-1,ser:-1,packetLength:-1},r=null;try{t.unmarshalHeader(),n=t.getHeader(),r=t.getInnerHeader()}catch(p){this.reportBinaryError({err:p,sid:r?r.sid:null==n?void 0:n.sid,cid:r?r.cid:null==n?void 0:n.cid,rawBuf:e.data,type:"decode"})}var i=r?r.sid:n.sid,o=r?r.cid:n.cid,s=`${i}_${o}`,a=qe[s];if(a&&a.length>0){var c,l=a[0].config;try{c=t.unmarshal(l.response)}catch(h){var d=t.getBodyDetail();this.reportBinaryError({err:h,rawBuf:e.data,sid:i,cid:o,parseDetail:d,type:"decode"}),t.reset();var u=Object.assign(Object.assign({},n),{sid:i,cid:o,code:Me.V2NIM_ERROR_CODE_UNPACK_ERROR});return this.logger.error(`imsocket::onMessage "${u.sid}_${u.cid}", ser ${u.ser}, packetLength ${u.packetLength} unmarshal error. ${d} \n`,h),void this.emit("message",JSON.stringify(u))}this.emit("message",c)}else this.core.logger.warn("imsocket::onMessage cmd not found",s);t.reset()}}send(e,t,n,r,i){var o,s,a=new PacketEncoder(e,t,n),c=Ge[r],l="";try{l=JSON.stringify(i),s=a.marshal(JSON.parse(l),c.params)}catch(d){throw this.reportBinaryError({err:d,sid:e,cid:t,rawStr:l,type:"encode"}),a.reset(),new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_PACK_ERROR,detail:{reason:`${e}-${t}, ser ${n} marshal error`,rawError:d}})}null===(o=this.websocket)||void 0===o||o.send(s),a.reset()}reportBinaryError(e){var t,n,r,{err:i,rawStr:o,sid:s,cid:a,type:c,parseDetail:l}=e,d=e.rawBuf;if(d){try{r=function(e){if("function"!=typeof btoa)return"";for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return n=null,btoa(t)}(d)}catch(p){r=`reportBinaryError::arrayBufferToBase64 parsing failed, error: ${null==p?void 0:p.message}, sid: ${s}, cid: ${a}`,this.core.logger.error(r)}d=null}this.core.reporter.reportTraceStart("exceptions",{user_id:null===(t=this.core.auth)||void 0===t?void 0:t.account,trace_id:null===(n=this.core.clientSocket.socket)||void 0===n?void 0:n.sessionId,start_time:Date.now(),action:2,exception_service:9});var u=i?(`${i.message};;;`||`${i.code};;;`)+(l?`parseDetail: ${l};;;`:"")+(o?` rawStr: ${o}`:"")+(r?` rawBuf: ${r}`:""):"";this.core.reporter.reportTraceUpdateV2("exceptions",{code:"encode"===c?Me.V2NIM_ERROR_CODE_PACK_ERROR:Me.V2NIM_ERROR_CODE_UNPACK_ERROR,description:u,operation_type:"encode"===c?3:4,target:`${s}-${a}`},{asyncParams:Ae.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)}}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(et||(et={}));class V2BinaryClientSocket{constructor(e){this.isReconnect=!1,this.packetTimeout=8e3,this.linkSSL=!0,this.packetSer=1,this.backoff=new Xe({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Map,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,this.auth=e.auth,this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager,this.eventBus=e.eventBus,this.setListener()}setListener(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.isReconnect=!0})}setSessionId(e){this.socket&&(this.socket.sessionId=e)}setLinkSSL(e){this.linkSSL=e}connect(e,t=!1){var n,r;return __awaiter$2(this,void 0,void 0,function*(){this.isReconnect=t;var i=this.core.auth.getConnectStatus();if(1===i){var o=`clientSocket::connect status is ${i}, and would not repeat connect`,s=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:o}});return this.logger.warn(o),Promise.reject(s)}this.auth.lifeCycle.processEvent("connect");try{yield this.auth.doLoginStepsManager.add(this.doConnect(e)),this.logger.log(`clientSocketV2:: connect success with link url: ${e}, isReconnect: ${t}`),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:200,mixlink:!0,succeed:!0},{asyncParams:Ae.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc")}catch(c){var a=c;if(this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:a.code||0,description:`connectFailed:${a.message}`,mixlink:!0,succeed:!1},{asyncParams:Ae.net.getNetworkStatus()}),a.code===Me.V2NIM_ERROR_CODE_CANCELLED||a.code===Me.V2NIM_ERROR_CODE_TIMEOUT)throw null===(n=this.socket)||void 0===n||n.close(),null===(r=this.socket)||void 0===r||r.removeAllListeners(),this.socket=void 0,c;throw this.logger.warn(`clientSocketV2::connect failed with link url: ${e}`,a),this.auth.lifeCycle.processEvent("connectFail",a),c}})}doConnect(e){var t=!1;return new Promise((n,r)=>{this.socket=new BaseWebsocket$1(this.core,e,this.linkSSL),this.socket.on("connect",()=>{this.logger.log("clientSocketV2::socket on connect",e),this.core.reporterHookLinkKeep.start(),this.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e}),t=!0,n()}),this.socket.on("message",this.onMessage.bind(this)),this.socket.on("disconnect",n=>__awaiter$2(this,void 0,void 0,function*(){t=!0,this.logger.log(`clientSocketV2::socket on disconnect ${e}`,n),yield this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e}),this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(et.OFFLINE,"SocketOnDisconnect")})),this.socket.on("connectFailed",n=>{t?this.ping():(this.logger.error(`clientSocketV2::connectFailed:${e}, reason:${n&&n.message}`),this.cleanSocket()),t=!0,r(n)})})}cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)}resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()}doDisconnect(e,t){if(this.logger.log(`clientSocketV2::doDisconnect:type:${e},reason:`,t),0!==this.core.auth.getConnectStatus()){var n={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:n}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),e===et.ACTIVE||e===et.KICKED?this.destroyOnlineListener():e===et.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log(`clientSocketV2::doDisconnect: pending reconnect ${this.isReconnect}`),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect:already disconnected")}sendCmd(e,t,n){var r=this.core.auth.getLoginStatus(),i={cmd:e};if(1!==r&&!["v2Login","login","chatroomLogin","v2ChatroomLogin"].includes(e))return this.logger.warn(`clientSocketV2::NIM login status is ${r}, so can not sendCmd ${e}`),Promise.reject(new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:Object.assign({reason:"Can not sendCmd due to no logined"},i)}));var o="heartbeat"!==e,s=o?this.packetSer++:0,a=createCmd(e,s,this.logger,t);if(!a){var c=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_INTERNAL,detail:Object.assign(Object.assign({},i),{reason:`SendCmd::createCmd error: ${s} ${e}`})});return this.logger.error(c),Promise.reject(c)}var{packet:l,hasPacketResponse:d,hasPacketTimer:u}=a,p=JSON.stringify(l);o&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::sendCmd: ${l.SID}_${l.CID},${e},ser:${s}`,p):this.logger.log(`clientSocketV2::sendCmd: ${l.SID}_${l.CID},${e},ser:${s}`));var h=(new Date).getTime();return new Promise((r,o)=>{d&&this.sendingCmdMap.set(s,{cmd:e,params:t,callback:[r,o],timer:u?setTimeout(()=>{var t=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:Object.assign({ser:s,reason:`Packet Timeout: ser ${s} cmd ${e}`,timetag:(new Date).getTime()},i)});this.markCmdInvalid(s,t,e)},n&&n.timeout?n.timeout:this.packetTimeout):null});try{this.socket.send(l.SID,l.CID,s,e,l.Q),d||r(l)}catch(c){var a=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:Object.assign({ser:s,reason:"Unable to send packet"+(c&&c.message?": "+c.message:""),timetag:(new Date).getTime(),rawError:c},i)});this.markCmdInvalid(s,a,e),o(a)}}).catch(e=>__awaiter$2(this,void 0,void 0,function*(){var t=e;return[Me.V2NIM_ERROR_CODE_DISCONNECT,Me.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,Me.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED].includes(t.code)?(this.reportSendCmdFailed(t,{sid:l.SID,cid:l.CID,ser:s},h),Promise.reject(t)):Promise.reject(t)}))}reportSendCmdFailed(e,t,n){var r;this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(r=this.socket)||void 0===r?void 0:r.sessionId,start_time:n,action:2,exception_service:6});var i=get(e,"detail.disconnect_reason")||"",o=e.code===Me.V2NIM_ERROR_CODE_DISCONNECT?JSON.stringify({disconnect_reason:i}):e.detail.reason;this.reporter.reportTraceUpdateV2("exceptions",{code:e.code,description:o,operation_type:1,target:`${t.sid}-${t.cid}`,context:`${t.ser}`},{asyncParams:Ae.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1)}onMessage(e){var t=parseCmd(e,this.logger);if(t&&t.length>0){var n=t[0],r=n.raw.ser;for(var i of(n.error&&(this.logger.error("clientSocketV2::onMessage packet error",`${n.raw.sid}_${n.raw.cid}, ser:${r},`,n.error),n.error.code===Me.V2NIM_ERROR_CODE_UNPACK_ERROR&&this.core.eventBus.emit("BinaryClientSocket/unpackError")),"heartbeat"!==n.cmd&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::recvCmd ${n.raw.sid}_${n.raw.cid},${n.cmd},ser:${r}`,e):this.logger.log(`clientSocketV2::recvCmd ${n.raw.sid}_${n.raw.cid},${n.cmd},ser:${r},code:${n.raw.code}`)),t))this.packetHandler(i)}}packetHandler(e){var t,n,r,i;if(e){var o=e.raw.ser,s=this.sendingCmdMap.get(o);if(s&&s.cmd===e.cmd){var{callback:a,timer:c,params:l}=s;if(clearTimeout(c),e.params=l,this.sendingCmdMap.delete(o),"heartbeat"===e.cmd)return void a[0]();var d=null===(n=null===(t=this.core[e.service])||void 0===t?void 0:t.process)||void 0===n?void 0:n.call(t,e);d&&"function"==typeof d.then?d.then(e=>{a[0](e)}).catch(e=>{a[1](e)}):(this.logger.log("clientSocketV2::handlerFn without promise",e.service,e.cmd),a[0](e))}else{var u=null===(i=null===(r=this.core[e.service])||void 0===r?void 0:r.process)||void 0===i?void 0:i.call(r,e);u&&"function"==typeof u.then&&u.catch(e=>{this.logger.error("clientSocketV2::no obj cache, no process handler",e)})}}}markCmdInvalid(e,t,n){var r=this.sendingCmdMap.get(e);if(r){var{callback:i,timer:o}=r;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn(`clientSocketV2::packet ${e}, ${n} is invalid:`,t),i[1](t)}}markAllCmdInvaild(e){this.logger.log("markAllCmdInvaild",e),this.sendingCmdMap.forEach(t=>{var{callback:n,timer:r,cmd:i}=t;this.logger.log(`clientSocketV2::markAllCmdInvaild:cmd ${i}`),r&&clearTimeout(r),n[1](e)}),this.sendingCmdMap.clear()}ping(){var e;return __awaiter$2(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);try{yield this.sendCmd("heartbeat")}catch(t){if(t.code===Me.V2NIM_ERROR_CODE_DISCONNECT)return;if(yield this.testHeartBeat5Timeout())return yield this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url}),this.core.reporterHookLinkKeep.end(!0),void this.doDisconnect(et.OFFLINE,"PingError")}this.pingTimer=setTimeout(()=>{this.ping()},3e4)})}testHeartBeat5Timeout(){return __awaiter$2(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);for(var e=0;e<5;e++)try{return yield this.sendCmd("heartbeat",{},{timeout:3e3}),!1}catch(t){this.logger.log(`clientSocketV2::test heartbeat ${e} Timeout`)}return!0})}initOnlineListener(){this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,Ae.net.onNetworkStatusChange(e=>{this.logger.log("clientSocketV2::onlineListener:network change",e);var t=this.auth.getLoginStatus();e.isConnected&&1===t?this.ping():e.isConnected&&3===t?(this.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),this.auth.reconnect.clearReconnectTimer(),this.auth.reconnect.doReLogin()):e.isConnected||this.doDisconnect(et.OFFLINE,"OfflineListener")}))}destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),this.hasNetworkListener=!1}}var it,ot=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],st=["transport not supported","client not handshaken","unauthorized"],nt=["reconnect"];class BaseWebsocket extends ve{constructor(e,t,n){super(),this.websocket=null,this.socketConnectTimer=0,this.url="",this.linkSSL=!0,this.core=e,this.url=t,this.linkSSL=n,this.status="disconnected",this.logger=e.logger,this.connect()}connect(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request(`${this.linkSSL?"https":"http"}://${this.url}/socket.io/1/?t=${Date.now()}`,{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then(e=>{if("connecting"===this.status){var[t,n]=e.data.split(":");return this.sessionId=t,this.logger.log(`imsocket::XHR success. status ${this.status}, ${"connecting"===this.status?"continue websocket connection":"stop websocket connection"}`),this._createWebsocket(`${this.linkSSL?"wss":"ws"}://${this.url}/socket.io/1/websocket/${t}`)}}).catch(e=>{if("connecting"===this.status){var t=`imsocket::XHR fail. raw message: "${(e=e||{}).message}", code: "${e.code}"`,n=e.code;n="v2"===get(this.core,"options.apiVersion")?e.code===Me.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?Me.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:Me.V2NIM_ERROR_CODE_CONNECT_FAILED:408===e.code?408:415;var r=new V2NIMErrorImpl({code:n,detail:{reason:t,rawError:e}});this.logger.error(t),this.status="disconnected",this.emit("handshakeFailed",r)}})):this.logger.warn("imsocket::socket is connecting or connected",this.status)}close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(t2){this.logger.warn("imsocket::attempt to send encodePacket error",t2)}try{this.websocket.close()}catch(t2){this.logger.warn("imsocket::attempt to close websocket error",t2)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}}clean(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)}onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)}_createWebsocket(e){this.socketConnectTimer=setTimeout(()=>{this.logger.error("imsocket::Websocket connect timeout. url: ",this.socketUrl),this.emit("handshakeFailed",new V2NIMErrorImpl({code:"v2"===get(this.core,"options.apiVersion")?Me.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:`imsocket::Websocket connect timeout. url: ${this.socketUrl}`}}))},this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new Ae.WebSocket(e),this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onclose=e=>{e=e||{},this.logger.log(`imsocket::Websocket onclose done ${e.wasClean}/${e.code}/${e.reason}`),this.clean(),this.emit("disconnect",{code:e.code||0,reason:e.reason})},this.websocket.onerror=e=>{this.logger.error("imsocket::Websocket onerror",e),"logined"===this.core.status&&this.core.clientSocket.ping()}}onMessage(e){var t,n=this.decodePacket(e.data);if(n)switch(n.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",n.data);break;case"event":n.name&&this.emit(n.name,n.args);break;case"error":"unauthorized"===n.reason?this.emit("connect_failed",n.reason):this.emit("error",n.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new V2NIMErrorImpl({code:"v2"===get(this.core,"options.apiVersion")?Me.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:`imsocket::Websocket connect failed, onMessage socket error. url: ${this.socketUrl}`}}));break;case"heartbeat":null===(t=this.websocket)||void 0===t||t.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",n.type)}}encodePacket(e){var t,n,{type:r,id:i="",endpoint:o="",ack:s}=e,a=null;if(!r)return"";switch(r){case"error":t=e.reason?st.indexOf(e.reason):"",n=e.advice?nt.indexOf(e.advice):"",""===t&&""===n||(a=t+(""!==n?"+"+n:""));break;case"message":""!==e.data&&(a=e.data);break;case"event":t={name:e.name},t=e.args&&e.args.length?{name:e.name,args:e.args}:{name:e.name},a=JSON.stringify(t);break;case"json":a=JSON.stringify(e.data);break;case"connect":e.qs&&(a=e.qs);break;case"ack":a=e.ackId+(e.args&&e.args.length?"+"+JSON.stringify(e.args):"")}var c=[ot.indexOf(r),i+("data"===s?"+":""),o];return null!=a&&c.push(a),c.join(":")}decodePacket(e){if(e)if("�"!=e.charAt(0)){var t=e.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(t){var n,[,r,i,o,s,a]=t,c={type:ot[+r],endpoint:s};switch(i&&(c.id=i,c.ack=!o||"data"),c.type){case"error":n=a.split("+"),c.reason=st[+n[0]]||"";break;case"message":c.data=a||"";break;case"connect":c.qs=a||"";break;case"event":try{var l=JSON.parse(a);c.name=l.name,c.args=l.args}catch(d){this.logger.error("imsocket::parseData::type::event error",d)}c.args=c.args||[];break;case"json":try{c.data=JSON.parse(a)}catch(d){this.logger.error("imsocket::parseData::type::json error",d)}break;case"ack":if((n=a.match(/^([0-9]+)(\+)?(.*)/))&&(c.ackId=n[1],c.args=[],n[3]))try{c.args=n[3]?JSON.parse(n[3]):[]}catch(d){this.logger.error("imsocket::parseData::type::ack error",d)}}return c}}else this.logger.error("imsocket::unrecognize dataStr",e.slice(0,20))}send(e){var t,n={data:e,type:"message",endpoint:""};null===(t=this.websocket)||void 0===t||t.send(this.encodePacket(n))}}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(it||(it={}));class V2ClientSocket{constructor(e){this.isReconnect=!1,this.packetTimeout=8e3,this.linkSSL=!0,this.packetSer=1,this.backoff=new Xe({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Map,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,this.auth=e.auth,this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager,this.eventBus=e.eventBus,this.setListener()}setListener(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.isReconnect=!0})}setSessionId(e){this.socket&&(this.socket.sessionId=e)}setLinkSSL(e){this.linkSSL=e}connect(e,t=!1){var n,r;return __awaiter$2(this,void 0,void 0,function*(){this.isReconnect=t;var i=this.core.auth.getConnectStatus();if(1===i){var o=`clientSocket::connect status is ${i}, and would not repeat connect`,s=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:o}});return this.logger.warn(o),Promise.reject(s)}this.auth.lifeCycle.processEvent("connect");try{yield this.auth.doLoginStepsManager.add(this.doConnect(e)),this.logger.log(`clientSocketV2:: connect success with link url: ${e}, isReconnect: ${t}`),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:200,mixlink:!0,succeed:!0},{asyncParams:Ae.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc")}catch(c){var a=c;if(this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:a.code||0,description:`connectFailed:${a.message}`,mixlink:!0,succeed:!1},{asyncParams:Ae.net.getNetworkStatus()}),a.code===Me.V2NIM_ERROR_CODE_CANCELLED||a.code===Me.V2NIM_ERROR_CODE_TIMEOUT)throw null===(n=this.socket)||void 0===n||n.close(),null===(r=this.socket)||void 0===r||r.removeAllListeners(),this.socket=void 0,c;throw this.logger.warn(`clientSocketV2::connect failed with link url: ${e}`,a),this.auth.lifeCycle.processEvent("connectFail",a),c}})}doConnect(e){var t=!1;return new Promise((n,r)=>{this.socket=new BaseWebsocket(this.core,e,this.linkSSL),this.socket.on("connect",()=>{this.logger.log("clientSocketV2::socket on connect",e),this.core.reporterHookLinkKeep.start(),this.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e}),t=!0,n()}),this.socket.on("message",this.onMessage.bind(this)),this.socket.on("disconnect",n=>__awaiter$2(this,void 0,void 0,function*(){t=!0,this.logger.log("clientSocketV2::socket on disconnect",n),yield this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e}),this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(it.OFFLINE,"SocketOnDisconnect")})),this.socket.on("handshakeFailed",e=>{t?this.ping():(this.logger.error(`clientSocketV2::handshake failed: "${e&&e.message}"`),this.cleanSocket()),t=!0,r(e)})})}cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)}resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()}doDisconnect(e,t){if(this.logger.log(`clientSocketV2::doDisconnect:type:${e},reason:`,t),0!==this.core.auth.getConnectStatus()){var n={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:n}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),e===it.ACTIVE||e===it.KICKED?this.destroyOnlineListener():e===it.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log(`clientSocketV2::doDisconnect: pending reconnect ${this.isReconnect}`),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect:already disconnected")}sendCmd(e,t,n){var r=this.core.auth.getLoginStatus(),i={cmd:e};if(1!==r&&!["v2Login","login","chatroomLogin","v2ChatroomLogin"].includes(e))return this.logger.warn(`clientSocketV2::NIM login status is ${r}, so can not sendCmd ${e}`),Promise.reject(new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:Object.assign({reason:"Can not sendCmd due to no logined"},i)}));var o="heartbeat"!==e,s=o?this.packetSer++:0,a=createCmd(e,s,this.logger,t);if(!a){var c=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_INTERNAL,detail:Object.assign(Object.assign({},i),{reason:`SendCmd::createCmd error: ${s} ${e}`})});return this.logger.error(c),Promise.reject(c)}var{packet:l,hasPacketResponse:d,hasPacketTimer:u}=a,p=JSON.stringify(l);o&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::sendCmd: ${l.SID}_${l.CID},${e},ser:${s}`,p):this.logger.log(`clientSocketV2::sendCmd: ${l.SID}_${l.CID},${e},ser:${s}`));var h=(new Date).getTime();return new Promise((r,o)=>{d&&this.sendingCmdMap.set(s,{cmd:e,params:t,callback:[r,o],timer:u?setTimeout(()=>{var t=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:Object.assign({ser:s,reason:`Packet Timeout: ser ${s} cmd ${e}`,timetag:(new Date).getTime()},i)});this.markCmdInvalid(s,t,e)},n&&n.timeout?n.timeout:this.packetTimeout):null});try{this.socket.send(p),d||r(l)}catch(c){var a=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:Object.assign({ser:s,reason:"Unable to send packet"+(c&&c.message?": "+c.message:""),timetag:(new Date).getTime(),rawError:c},i)});this.markCmdInvalid(s,a,e),o(a)}}).catch(e=>__awaiter$2(this,void 0,void 0,function*(){var t,n=e;if(![Me.V2NIM_ERROR_CODE_DISCONNECT,Me.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,Me.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED].includes(n.code))return Promise.reject(n);this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(t=this.socket)||void 0===t?void 0:t.sessionId,start_time:h,action:2,exception_service:6});var r=get(n,"detail.disconnect_reason")||"",i=n.code===Me.V2NIM_ERROR_CODE_DISCONNECT?JSON.stringify({disconnect_reason:r}):n.detail.reason;return this.reporter.reportTraceUpdateV2("exceptions",{code:n.code,description:i,operation_type:1,target:`${l.SID}-${l.CID}`,context:`${l.SER}`},{asyncParams:Ae.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),Promise.reject(n)}))}onMessage(e){var t=parseCmd(e,this.logger);if(t&&t.length>0){var n=t[0],r=n.raw.ser;for(var i of(n.error&&this.logger.error("clientSocketV2::onMessage packet error",`${n.raw.sid}_${n.raw.cid}, ser:${r},`,n.error),"heartbeat"!==n.cmd&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::recvCmd ${n.raw.sid}_${n.raw.cid},${n.cmd},ser:${r}`,n.content):this.logger.log(`clientSocketV2::recvCmd ${n.raw.sid}_${n.raw.cid},${n.cmd},ser:${r};code:${n.raw.code}`)),t))this.packetHandler(i)}}packetHandler(e){var t,n,r,i;if(e){var o=e.raw.ser,s=this.sendingCmdMap.get(o);if(s&&s.cmd===e.cmd){var{callback:a,timer:c,params:l}=s;if(clearTimeout(c),e.params=l,this.sendingCmdMap.delete(o),"heartbeat"===e.cmd)return void a[0]();var d=null===(n=null===(t=this.core[e.service])||void 0===t?void 0:t.process)||void 0===n?void 0:n.call(t,e);d&&"function"==typeof d.then?d.then(e=>{a[0](e)}).catch(e=>{a[1](e)}):(this.logger.log("clientSocketV2::handlerFn without promise",e.service,e.cmd),a[0](e))}else{var u=null===(i=null===(r=this.core[e.service])||void 0===r?void 0:r.process)||void 0===i?void 0:i.call(r,e);u&&"function"==typeof u.then&&u.catch(e=>{this.logger.error("clientSocketV2::no obj cache, no process handler",e)})}}}markCmdInvalid(e,t,n){var r=this.sendingCmdMap.get(e);if(r){var{callback:i,timer:o}=r;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn(`clientSocketV2::packet ${e}, ${n} is invalid:`,t),i[1](t)}}markAllCmdInvaild(e){this.logger.log("markAllCmdInvaild",e),this.sendingCmdMap.forEach(t=>{var{callback:n,timer:r,cmd:i}=t;this.logger.log(`clientSocketV2::markAllCmdInvaild:cmd ${i}`),r&&clearTimeout(r),n[1](e)}),this.sendingCmdMap.clear()}ping(){var e;return __awaiter$2(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);try{yield this.sendCmd("heartbeat")}catch(t){if(t.code===Me.V2NIM_ERROR_CODE_DISCONNECT)return;if(yield this.testHeartBeat5Timeout())return yield this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url}),this.core.reporterHookLinkKeep.end(!0),void this.doDisconnect(it.OFFLINE,"PingError")}this.pingTimer=setTimeout(()=>{this.ping()},3e4)})}testHeartBeat5Timeout(){return __awaiter$2(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);for(var e=0;e<5;e++)try{return yield this.sendCmd("heartbeat",{},{timeout:3e3}),!1}catch(t){this.logger.log(`clientSocketV2::test heartbeat ${e} Timeout`)}return!0})}initOnlineListener(){this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,Ae.net.onNetworkStatusChange(e=>{this.logger.log("clientSocketV2::onlineListener:network change",e);var t=this.auth.getConnectStatus(),n=this.auth.getLoginStatus();e.isConnected&&1===n?this.ping():e.isConnected&&3===t?(this.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),this.auth.reconnect.clearReconnectTimer(),this.auth.reconnect.doReLogin()):e.isConnected||this.doDisconnect(it.OFFLINE,"OfflineListener")}))}destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),this.hasNetworkListener=!1}}class V2NIMLoginReconnect{constructor(e){var t,n;this.currenRetryCount=0,this.backoff=new Xe({max:8e3,min:1600,jitter:.01}),this.reconnectTimer=0,this.core=e,this.auth=e.V2NIMLoginService,null===(n=(t=Ae.powerMonitor).on)||void 0===n||n.call(t,"onPowerMonitorTurnActive",()=>{this.core.logger.debug("reconnect::powerMonitor turn active"),3===this.auth.getLoginStatus()&&(this.core.logger.log("reconnect::powerMonitor turn active, try to reconnect"),this.auth.reconnect.clearReconnectTimer(),this.auth.reconnect.doReLogin())})}reset(){this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer)}destroy(){var e,t;this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer),Ae.powerMonitor.destroy(),null===(t=(e=Ae.powerMonitor).off)||void 0===t||t.call(e,"onPowerMonitorTurnActive")}clearReconnectTimer(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)}attempToReLogin(){var e=this.backoff.duration();if("function"==typeof this.reconnectDelayProvider)try{var t=this.reconnectDelayProvider(e);"number"==typeof t&&t>=0&&(e=t>=1e3?t:t+200+Math.ceil(300*Math.random()))}catch(n){this.core.logger.error("reconnect::connectDelayProvider excute failed,",n)}return this.currenRetryCount++,this.core.logger.log(`reconnect::reconnect timer is about to be set, delay ${e} ms, current retry count is ${this.currenRetryCount}`),this.core.reporter.reportTraceStart("login",{user_id:this.auth.getLoginUser(),action:"auto_login",binary_websocket:this.auth.binaryWebsocket}),this.clearReconnectTimer(),this.reconnectTimer=setTimeout(()=>{this.core.logger.log("reconnect::reconnect timer is now triggered");var e=this.auth.getConnectStatus();3===e?this.doReLogin():this.core.logger.warn(`reconnect::reconnect timer is over because connect status now is ${e}`)},e),!0}doReLogin(){if(!Ae.powerMonitor.isActive())return this.core.logger.log("reconnect::reLogin skip, cause app powerMonitor is not active"),void this.auth.lifeCycle.processEvent("waiting");this.auth.loginOption.forceMode=!1,this.auth.originLoginPromise=this.auth.doLogin(!0);var e=this.auth.previousLoginManager.add(this.auth.originLoginPromise);return e.then(()=>{this.core.reporter.reportTraceEnd("login",!0)}).catch(e=>{var t=e;if(this.core.logger.warn("reconnect::try login but failed due to",t),this.core.reporter.reportTraceEnd("login",!1),this.auth.checkLoginTerminalCode(t&&t.code))return this.auth.clientSocket.doDisconnect(et.ACTIVE,"ReloginTerminated"),void this.auth.lifeCycle.processEvent("exited",t);t&&399===t.code&&this.auth.lbs.reset(),this.auth.lifeCycle.processEvent("waiting")}),e}_setReconnectDelayProvider(e){this.reconnectDelayProvider=e}}function uniq(e){e=e||[];for(var t=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}class V2NIMLoginLbs{constructor(e){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=e,this.auth=e.V2NIMLoginService}getLbsInfos(){return __awaiter$2(this,void 0,void 0,function*(){if(this.socketLinkUrls.length>0){var e=this.socketLinkUrls.shift();return this.core.logger.log("V2NIMLoginService::getLbsInfos:use cache link",e),Promise.resolve(e)}this.auth.lifeCycle.processEvent("addressing"),this.core.reporterHookLBS.start(this.core.account);var t=uniq(this.auth.config.lbsUrls);try{var n=yield this.ladderLoad(t);if(200!==n.status||!n.data)throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",n.status,n),new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:`V2NIMLoginService::getLbsInfos failed, status ${n.status}`}});this.success(n)}catch(i){var r=i;if(this.core.logger.error(`V2NIMLoginService::lbs getLbsInfos error, use default link: ${this.auth.config.linkUrl}. error:`,i),this.reportForFail(t[0],r.code,r.message),this.checkTerminator(r.code))throw i;this.socketLinkUrls=[this.auth.config.linkUrl]}return this.socketLinkUrls.shift()})}checkTerminator(e){return e===Me.V2NIM_ERROR_CODE_CANCELLED||e===Me.V2NIM_ERROR_CODE_TIMEOUT}generateUrl(e){var t=(e=this.processLbsUrl(e)).indexOf("?")>-1?"&":"?";return e+t+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"}processLbsUrl(e){return pendingIsMiniappEnv()?e.replace("/webconf","/wxwebconf"):e}requstLbs(e){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(e),{method:"GET",dataType:"json",timeout:8e3}))}setLadderTimer(e,t,n,r){this.timer&&clearTimeout(this.timer);var i=e[t];this.timer=setTimeout(()=>{i&&(this.setLadderTimer(e,t+1,n,r),this.core.logger.log(`V2NIMLoginService::getLbsInfos ${t}:`,this.processLbsUrl(i)),this.reportForLbsStart(i,t),this.requstLbs(i).then(e=>{this.reset(),n(Object.assign(Object.assign({},e),{url:i}))}).catch(n=>{var o;if(this.core.logger.warn(`V2NIMLoginService::getLbsInfos ${t} failed:`,n),this.failedCount+=1,this.reportForFailOnce(i,n.code,(null===(o=n.detail)||void 0===o?void 0:o.reason)||n.message),this.failedCount>=e.length||this.checkTerminator(n.code))return this.reset(),void r(n)}))},2e3)}ladderLoad(e){return new Promise((t,n)=>{e.length>1&&this.setLadderTimer(e,1,t,n);var r=e[0];this.core.logger.log("V2NIMLoginService::getLbsInfos 0:",r),this.reportForLbsStart(r,0),this.requstLbs(r).then(e=>{this.reset(),t(Object.assign(Object.assign({},e),{url:r}))}).catch(t=>{var i;this.failedCount+=1,this.core.logger.warn("V2NIMLoginService::getLbsInfos 0 failed:",t),this.reportForFailOnce(r,t.code,(null===(i=t.detail)||void 0===i?void 0:i.reason)||t.message),(this.failedCount>=e.length||this.checkTerminator(t.code))&&(this.reset(),n(t))})})}success(e){var t,n,r=e.data.common,i=r["mix.link"]||[],o=r["link.default"]||[];this.socketLinkUrls=i.concat(o).concat(this.auth.config.linkUrl),e.data["nos-chunk"]&&(null===(t=this.core.cloudStorage)||void 0===t?void 0:t.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nos-chunk",e.data["nos-chunk"]),this.core.cloudStorage.setOptions({chunkUploadHost:e.data["nos-chunk"]})),Array.isArray(e.data.nosup)&&e.data.nosup.length>0&&(null===(n=this.core.cloudStorage)||void 0===n?void 0:n.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nosup",e.data.nosup),this.core.cloudStorage.setOptions({commonUploadHostBackupList:e.data.nosup,commonUploadHost:e.data.nosup[0]})),this.core.logger.log("V2NIMLoginService::getLbsInfos success, socket link:",this.socketLinkUrls.slice(0),"chunkUploadHost: ",e.data["nos-chunk"]),this.reportForLbsSuccess(e.url,e.data)}reportForLbsStart(e,t){this.core.reporterHookLBS.updateBegin({target:e,index:t})}reportForLbsSuccess(e,t){this.core.reporterHookLBS.updateComplete({target:e,code:200,body:JSON.stringify(t)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,code:200,succeed:!0},{asyncParams:Ae.net.getNetworkStatus()})}reportForFailOnce(e,t,n){this.core.reporterHookLBS.updateComplete({target:e,code:t,body:n})}reportForFail(e,t,n){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,description:n,code:t,succeed:!1},{asyncParams:Ae.net.getNetworkStatus()})}reset(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)}}class V2NIMLoginAuthenticator{constructor(e){this.lastLoginClientKey="__NIM_LAST_LOGIN_CLIENT__",this.loginClients=[],this.loginClientOfThisConnection={},this.core=e,this.auth=e.V2NIMLoginService}verifyAuthentication(e){var t,n;return __awaiter$2(this,void 0,void 0,function*(){var r=yield this.auth.doLoginStepsManager.add(this.refreshLoginToken(this.auth.account)),i=yield this.auth.doLoginStepsManager.add(this.refreshThirdPartyExt(this.auth.account));this.auth.token=r;var o,s=Ae.getSystemInfo(),a={appkey:this.core.options.appkey,account:this.auth.account,token:r,authType:this.auth.loginOption.authType,appLogin:e?0:1,clientType:16,clientSession:this.auth.clientSession,clientId:this.auth.deviceId,sdkVersion:100941,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.9.41":s.userAgent.replace("{{appkey}}",this.core.options.appkey).slice(0,299),libEnv:this.core.options.flutterSdkVersion?"FLUTTER":this.core.options.loginSDKTypeParamCompat?void 0:s.libEnv,hostEnv:this.core.options.flutterSdkVersion?4:this.core.options.loginSDKTypeParamCompat?0:s.hostEnvEnum,sdkHumanVersion:this.core.options.flutterSdkVersion||"10.9.41",os:s.os,browser:s.browser,protocolVersion:1,customClientType:this.auth.config.customClientType,customTag:this.auth.config.customTag,thirdPartyExtension:i,isRoutable:!1===(null===(t=this.auth.loginOption.routeConfig)||void 0===t?void 0:t.routeEnabled)?0:1,env:null===(n=this.auth.loginOption.routeConfig)||void 0===n?void 0:n.routeEnvironment};s.os.toLowerCase(),s.hostEnvEnum,this.core.logger.log(`V2NIMLoginService::do login,accid:${a.account};clientSession:${a.clientSession};appLogin:${a.appLogin}`);try{o=yield this.auth.doLoginStepsManager.add(this.auth.clientSocket.sendCmd("v2Login",{tag:a}))}catch(u){var c=u;if(this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:c.code||0,succeed:!1,description:c.message},{asyncParams:Ae.net.getNetworkStatus()}),c.code===Me.V2NIM_ERROR_CODE_CANCELLED||c.code===Me.V2NIM_ERROR_CODE_TIMEOUT)throw c;throw this.processLoginFailed(c),c}var{data:l,loginClients:d}=o.content;return this.changeLoginClient(1,d),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:200,succeed:!0},{asyncParams:Ae.net.getNetworkStatus()}),this.loginClientOfThisConnection=formatLoginInfo(l),this.core.clientSocket.setSessionId(l.consid),Ae.localStorage.setItem(this.lastLoginClientKey,JSON.stringify(Object.assign({account:this.auth.account},this.loginClientOfThisConnection))),this.loginClientOfThisConnection})}refreshLoginToken(e){return __awaiter$2(this,void 0,void 0,function*(){if(0===this.auth.loginOption.authType)return this.auth.token;if("function"!=typeof this.auth.loginOption.tokenProvider)return this.auth.token;try{var t=yield this.auth.loginOption.tokenProvider(e);if("string"==typeof t)return t;throw this.core.logger.error("V2NIMLoginService::excute tokenProvider complete but got Unexpected value:",t),new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute tokenProvider complete but got Unexpected value",rawData:t}})}catch(i){var n=i,r=n;throw n.code!==Me.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute tokenProvider error:",n),r=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_CALLBACK_FAILED,desc:"Excute tokenProvider error",detail:{rawError:i}})),this.processLoginFailed(n),r}})}refreshThirdPartyExt(e){return __awaiter$2(this,void 0,void 0,function*(){if("function"!=typeof this.auth.loginOption.loginExtensionProvider)return"";try{var t=yield this.auth.loginOption.loginExtensionProvider(e);if("string"==typeof t)return t;throw this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider complete but got Unexpected value:",t),new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider complete but got Unexpected value",rawData:t}})}catch(i){var n=i,r=n;if(n.code!==Me.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider error:",n),r=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider error",rawError:i}})),2===this.auth.loginOption.authType)throw this.processLoginFailed(n),r;return""}})}processLoginFailed(e){this.auth.clientSocket.doDisconnect(et.ACTIVE,e),this.checkLoginTerminalCode(e.code)&&(this.auth.authenticator.reset(),this.auth.authenticator.clearLastLoginClient()),this.auth.lifeCycle.processEvent("loginFail",e)}changeLoginClient(e,t){var n=t.map(e=>formatLoginInfo(e));if(1===e)this.loginClients=n,this.auth.emit("onLoginClientChanged",e,this.loginClients);else if(2===e){var r=n.filter(e=>{var t=this.loginClients.filter(t=>t.clientId===e.clientId);return this.loginClients.push(e),0===t.length});r.length>0&&this.auth.emit("onLoginClientChanged",e,r)}else if(3===e){var i=n.filter(e=>(function(e,t){t=t||(()=>!0);for(var n=[],r=(e=e||[]).length,i=0,o=0;o<r;o++)t(e[o-i])&&(n.push(e.splice(o-i,1)[0]),i+=1)}(this.loginClients,t=>t.clientId===e.clientId&&t.consid===e.consid),0===this.loginClients.filter(t=>t.clientId===e.clientId).length));i.length>0&&this.auth.emit("onLoginClientChanged",e,i)}}checkAutoLogin(e){if(e)return!1;var t=Ae.localStorage.getItem(this.lastLoginClientKey);if(!t)return!1;var n="",r="";try{var i=JSON.parse(t);n=get(i,"clientId"),r=get(i,"account")}catch(o){return!1}return n===this.auth.deviceId&&r===this.auth.account}checkLoginTerminalCode(e){return[Me.V2NIM_ERROR_CODE_CANCELLED,Me.V2NIM_ERROR_CODE_TIMEOUT,Me.V2NIM_ERROR_CODE_HANDSHAKE,302,317,Me.V2NIM_ERROR_CODE_FORBIDDEN,Me.V2NIM_ERROR_CODE_NOT_FOUND,Me.V2NIM_ERROR_CODE_PARAMETER_ERROR,Me.V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN,422,Me.V2NIM_ERROR_CODE_IM_DISABLED,Me.V2NIM_ERROR_CODE_APPKEY_NOT_EXIST,Me.V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED,Me.V2NIM_ERROR_CODE_APPKEY_BLOCKED,Me.V2NIM_ERROR_CODE_INVALID_TOKEN,Me.V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED,Me.V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST,Me.V2NIM_ERROR_CODE_ACCOUNT_BANNED,Me.V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST].includes(e)}reset(){this.loginClients=[],this.loginClientOfThisConnection={}}clearLastLoginClient(){Ae.localStorage.removeItem(this.lastLoginClientKey)}}class V2Service extends ve{constructor(e,t){super(),this.name=e,this.logger=t.logger,this.core=t}checkV2(){var e=this.core.options.apiVersion;if("v2"===e)return!0;throw new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_MISUSE,detail:{reason:`The version "${e}" of client is not supported.`}})}checkLogin(){if(0===this.core.V2NIMLoginService.getLoginStatus())throw new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Client logout."}})}emit(e,...t){this.logger.debug(`${this.name}::emit event: '${e.toString()}',`,void 0!==t[0]?t[0]:"",void 0!==t[1]?t[1]:"",void 0!==t[2]?t[2]:"");try{return super.emit(e,...t)}catch(n){return setTimeout(()=>{throw this.logger.error(`${this.name}::emit throw error in setTimeout. event: ${e.toString()}. Error`,n),n},0),!1}}process(e){var t=this[e.cmd+"Handler"],n=this.handler&&this.handler[e.cmd+"Handler"];if("function"==typeof t||"function"==typeof n){if(e.error)return this.logger.error(`${e.cmd}::recvError`,e.error),Promise.reject(e.error);try{var r=t?t.call(this,e):n.call(this.handler,e);return Promise.resolve(r)}catch(o){return Promise.reject(o)}}var i=get(e,"error.detail.ignore");return e.error&&!i?Promise.reject(e.error):Promise.resolve(e)}}class V2NIMLoginLifeCycle{constructor(e){this.name="V2NIMLoginLifeCycle",this.loginStatus=0,this.connectStatus=0,this.core=e,this.auth=e.V2NIMLoginService,this.logger=e.logger}processEvent(e,t,n){var r=this.getConnectStatus();switch(e){case"addressing":this.logger.log(`${this.name}::addressing`),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connect":this.logger.log(`${this.name}::connecting`),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connectSucc":this.logger.log(`${this.name}::connect success`),this.setLoginStatus(2),this.setConnectStatus(1);break;case"connectFail":this.logger.log(`${this.name}::connect fail`,t),this.setLoginStatus(3),this.setConnectStatus(0,t);break;case"connectionBroken":this.logger.log(`${this.name}::connectionBroken:`,t),this.setLoginStatus(3),this.setConnectStatus(0,t),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleDisconnected",t);break;case"loginSucc":this.logger.log(`${this.name}::login success, verify authentication success`),this.setLoginStatus(1),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLoginSucc",n);break;case"loginFail":if(this.logger.log(`${this.name}::login fail due to verify authentication failed:`,t),!t)return;this.setLoginStatus(this.auth.authenticator.checkLoginTerminalCode(t.code)?0:3),this.setConnectStatus(0,t),this.auth.emit("onLoginFailed",t);break;case"logout":this.logger.log(`${this.name}::logout`),this.setLoginStatus(0),this.setConnectStatus(0),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"kicked":this.logger.log(`${this.name}::kicked`,n),this.setLoginStatus(0),this.setConnectStatus(0,t),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleKicked");break;case"exited":this.logger.log(`${this.name}::exited`,t),this.setLoginStatus(0),this.setConnectStatus(0,t);break;case"waiting":this.logger.log(`${this.name}::waiting to reconnect`),this.setLoginStatus(3),this.setConnectStatus(3),2!==r&&this.auth.reconnect.attempToReLogin()}}getConnectStatus(){return this.connectStatus}getLoginStatus(){return this.loginStatus}setLoginStatus(e){e!==this.loginStatus&&(this.loginStatus=e,this.auth.emit("onLoginStatus",e))}setConnectStatus(e,t){if(e!==this.connectStatus){var n=this.connectStatus;this.connectStatus=e,this.auth.emit("onConnectStatus",e),this.delegateConnectEvent(n,e,t)}}delegateConnectEvent(e,t,n){1===e&&0===t&&n&&this.auth.emit("onDisconnected",n),2===e&&0===t&&n&&this.auth.emit("onConnectFailed",n)}}class V2NIMLoginDataSync{constructor(e){this.core=e,this.auth=e.V2NIMLoginService,this.datas=[]}switchDataSync(e){return __awaiter$2(this,void 0,void 0,function*(){var{type:t,state:n,error:r,subType:i}=e,o=this.datas.filter(e=>e.type===t&&e.subType===i);o.length>0?(o[0].state=n,o[0].error=r):this.datas.push({type:t,state:n,subType:i});var s=this.datas.every(e=>3===e.state);1===t&&(2===n&&"mainSync"===i?(this.core.eventBus.emit("V2NIMLoginService/syncing"),this.auth.emit("onDataSync",t,n)):3===n&&s&&(this.core.eventBus.emit("V2NIMLoginService/syncDone",r),this.auth.emit("onDataSync",t,n,r)))})}checkSyncing(){return this.datas.some(e=>"mainSync"===e.subType&&2===e.state)}reset(){this.datas=[]}}var at={"6_3":"notifylog","6_4":"uploadLog","6_23":"getServerTime","6_31":"notifyDetect","6_32":"uploadDetect","6_37":"wsDetect"},ct={type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},dt={k1:1,k2:2,k3:3,k4:4,k5:5,k6:6,k7:7,k8:8,k9:9,k10:10},lt={notifylog:{sid:6,cid:3,service:"misc"},uploadLog:{sid:6,cid:4,service:"misc",hasPacketResponse:!1,params:[{type:"String",name:"url"},{type:"Property",name:"data",reflectMapper:{type:1,content:2}}]},getServerTime:{sid:6,cid:23,service:"misc",response:[{type:"Long",name:"time"}]},notifyDetect:{sid:6,cid:31,service:"misc",response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(ct)}]},uploadDetect:{sid:6,cid:32,service:"misc",hasPacketResponse:!1,params:[{type:"Property",name:"data",reflectMapper:ct}]},wsDetect:{sid:6,cid:37,service:"misc",params:[{type:"Property",name:"tag",reflectMapper:dt}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(dt)}]}},pt={type:{type:"number"},t1:{type:"number"},t2:{type:"number"},t3:{type:"number"},t4:{type:"number"},t5:{type:"number"},t6:{type:"number"}};class MiscService extends class{constructor(e,t){this.name=e,this.core=t,this.name=e,this.logger=t.logger,this.core=t}process(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e);var n=get(e,"error.detail.ignore");return e.error&&!n?Promise.reject(e.error):Promise.resolve(e)}}{constructor(e){super("misc",e),this.logLock=!1,this.core=e,registerParser({cmdMap:at,cmdConfig:lt}),this.setListener()}setListener(){this.core.eventBus.on("BinaryClientSocket/unpackError",this.wsDetect.bind(this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.core.timeOrigin.setOriginTimetick()}),this.core.eventBus.on("logined",()=>{this.core.timeOrigin.setOriginTimetick()})}getServerTime(){return __awaiter$2(this,void 0,void 0,function*(){var e=yield this.core.clientSocket.sendCmd("getServerTime");return parseInt(e.content.time)})}wsDetect(e){return __awaiter$2(this,void 0,void 0,function*(){var t=Object.assign({k1:"val1",k2:"val2"},e),n=null;try{n=(yield this.core.clientSocket.sendCmd("wsDetect",{tag:t})).content.data}catch(i){var r=i;return void(r.code===Me.V2NIM_ERROR_CODE_UNPACK_ERROR?(this.logger.warn("misc::wsDetect:998"),this.wsDetectUnreliable(),this.reportBinarySocketDetectResult("packet 998")):this.logger.warn(`misc::wsDetect:failed ${r.code}`))}n&&JSON.stringify(n)!==JSON.stringify(t)?(this.logger.warn("misc::wsDetect:content unreliable"),this.wsDetectUnreliable(),this.reportBinarySocketDetectResult("content unreliable")):this.logger.log("misc::wsDetect:success")})}wsDetectUnreliable(){this.core.clientSocket.doDisconnect(3,"WSDetectUnreliable")}reportBinarySocketDetectResult(e){var t;this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.account,trace_id:null===(t=this.core.clientSocket.socket)||void 0===t?void 0:t.sessionId,start_time:Date.now(),action:2,exception_service:9}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:998,description:`wsDetect::reconnect cause: ${e}`,operation_type:"5",target:"6-37"}),this.core.reporter.reportTraceEnd("exceptions",1)}notifyDetectHandler(e){return __awaiter$2(this,void 0,void 0,function*(){var t,n=(t=e.content.data,format(pt,t));n.t3=e.__receiveTimeNode.time,n.t4=Date.now();try{yield this.core.clientSocket.sendCmd("uploadDetect",{data:n})}catch(t){this.core.logger.warn("misc::notifyDetectHandler:upload failed",t)}})}notifylogHandler(){return __awaiter$2(this,void 0,void 0,function*(){var e=void 0;if(this.logLock)this.core.logger.warn("misc::notifylogHandler:locked");else{this.logLock=!0;try{e=yield this.core.logger.extractLogs()}catch(n){return void(this.logLock=!1)}if(e){var t="";try{t=(yield this.core.cloudStorage.uploadFile("string"==typeof e?{type:"file",filePath:e}:{type:"file",file:e})).url}catch(n){return void(this.logLock=!1)}if(t){t+=(t.indexOf("?")>0?"&":"?")+"download="+(new Date).getTime()+"_web.log";try{yield this.core.clientSocket.sendCmd("uploadLog",{url:t})}catch(n){return void(this.logLock=!1)}try{yield this.logger.afterUpload()}catch(n){}this.logLock=!1}else this.logLock=!1}else this.logLock=!1}})}}function pick(e,t){e=e||{};var n={};return(t=t||[]).forEach(t=>{void 0!==e[t]&&(n[t]=e[t])}),n}var mt={retryCount:{type:"number",min:0,required:!1},forceMode:{type:"boolean",required:!1},authType:{type:"enum",values:[0,1,2],required:!1},syncLevel:{type:"enum",values:[1,0],required:!1},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}}},ut=["https://lbs.netease.im/lbs/webconf.jsp"],ht={retryCount:3,timeout:6e4,forceMode:!1,authType:0,syncLevel:0},gt={"27_1":"v2NIMSync","27_10":"v2QChatSync"},vt={v2NIMSync:{sid:27,cid:1,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,p2pTeamModifyMessage:30,superTeamModifyMessage:31,filterMsgs:100}}],response:[{type:"Long",name:"timetag"}]},v2QChatSync:{sid:27,cid:10,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Long",name:"timetag"}]}};createCommonjsModule$1(function(e,t){e.exports=function(){class e extends Error{constructor(e,t,n,r){super(n),this.source=e,this.code=t,this.desc=n,this.detail=r||{}}}return function(t,n={dataType:"json",method:"GET",timeout:5e3}){var r="text"===n.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",i="GET"===n.method?function(e){if(e){var t="";return Object.keys(e).forEach(function(n,r){t+=0===r?"?":"&",t+=`${n}=${e[n]}`}),t}return""}(n.params):"";return new Promise(function(o,s){if(window.XMLHttpRequest){var a,c=new XMLHttpRequest;if(c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){try{a=JSON.parse(c.response||"{}")}catch(t){a=c.response}o({status:c.status,data:a})}else setTimeout(()=>{s(new e(1,c.status,`readyState: ${c.readyState}; statusText: ${c.statusText}`))},0)},c.open(n.method,`${t}${i}`),c.timeout=n.timeout||5e3,c.setRequestHeader("Content-Type",r),n.headers)for(var l in n.headers)c.setRequestHeader(l,n.headers[l]);c.ontimeout=function(t){s(new e(1,408,t&&t.message?t.message:"request timeout"))},c.send(JSON.stringify(n.data))}else s(new e(2,10400,"request no suppout"))})}}()}),createCommonjsModule$1(function(e,t){e.exports=function(){var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return _}});var n=function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(e){},this.onProgress=function(e){},this.onUploadProgress=function(e){},this.onComplete=function(e){},t)this[n]=t[n]};function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o={privateObj:{},setItem:function(e,t){o.privateObj[e]=t},getItem:function(e){return o.privateObj[e]},removeItem:function(e){delete o.privateObj[e]},getKeys:function(){return Object.keys(o.privateObj)}},s={getFileKey:function(e){var t=e.size.toString(),n=e.lastModified.toString();return"_NosUploader_"+e.name+t.slice(t.length-5)+n.slice(n.length-5)},getFileInfo:function(e){var t=o.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(n){return null}},initFile:function(e,t,n){s.clearExpiredInfo();var r=this.getFileKey(t),i={ctx:void 0!==e.ctx?e.ctx:"",bucket:e.bucketName,obj:e.objectName,token:e.token,modifyAt:Date.now(),end:!1};return e.payload&&(i.payload=e.payload),n&&o.setItem(r,JSON.stringify(i)),r},setUploadContext:function(e,t,n){var r=this.getFileInfo(e);r&&(r.ctx=t,n&&o.setItem(e,JSON.stringify(r)))},setComplete:function(e,t){var n=this.getFileInfo(e);n&&(n.modifyAt=Date.now(),n.end=!0,t&&o.setItem(e,JSON.stringify(n)))},getUploadContext:function(e){var t=this.getFileInfo(e);return t?t.ctx:""},removeFileInfo:function(e){0===e.indexOf("_NosUploader_")&&o.removeItem(e)},clearExpiredInfo:function(){var e,t="function"==typeof o.getKeys?o.getKeys():Object.keys(o),n=Date.now(),i=[],a=r(t);try{for(a.s();!(e=a.n()).done;){var c=e.value;if(0===c.indexOf("_NosUploader_")){var l=s.getFileInfo(c);null===l||n-l.modifyAt>_.expireTime?o.removeItem(c):i.push({fileInfo:l,key:c})}}}catch(h){a.e(h)}finally{a.f()}if(i.length>_.maxFileCache){var d,u=r(i.sort(function(e,t){return t.fileInfo.modifyAt-e.fileInfo.modifyAt}).slice(_.maxFileCache));try{for(u.s();!(d=u.n()).done;){var p=d.value;0===p.key.indexOf("_NosUploader_")&&o.removeItem(p.key)}}catch(h){u.e(h)}finally{u.f()}}}},a=s;function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return d(e,arguments,h(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),p(r,e)})(e)}function d(e,t,n){return(d=u()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&p(i,n.prototype),i}).apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(i,e);var t,n,r=(t=i,n=u(),function(){var e,r=h(t);if(n){var i=h(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(n=r.call(this,"NosUploadError:"+e)).errCode=t,n.errMsg=e,n}return i}(l(Error)),m=function e(t,n,r){if("uploading"===t.uploadState){var i=t.config,o=t.param,s=a.getUploadContext(t.fileKey);if(!s)return r(0);var c=new XMLHttpRequest,l=i.directUploadAddr+"/".concat(o.bucketName)+"/".concat(encodeURIComponent(o.objectName))+"?uploadContext"+"&context=".concat(s)+"&version=".concat(i.version);c.onreadystatechange=function(){var o;if("abort"!==t.uploadState&&4===c.readyState){var s;try{s=JSON.parse(c.responseText)}catch(d){s={errMsg:"JsonParseError in getOffset. xhr.status = "+c.status+". xhr.responseText: "+c.responseText,errCode:500}}200===c.status?s.errCode?t.config.onError(new g(s.errMsg,s.errCode)):r(s.offset):c.status.toString().match(/^5/)?e(t,n-1,r):n>0?("function"==typeof(null===(o=i.logger)||void 0===o?void 0:o.error)&&i.logger.error("getOffset(".concat(l,") error. retry after 3 seconds. ").concat((new Date).toTimeString())),setTimeout(function(){e(t,n-1,r)},3500)):c.status?(a.removeFileInfo(t.fileKey),i.onError(new g("getOffset(".concat(l,") error: ").concat(c.status," ").concat(c.statusText)))):i.onError(new g("getOffset(".concat(l,") error. no Error Code")))}},c.open("get",l),c.setRequestHeader("x-nos-token",o.token),c.timeout=i.getOffsetTimeout,c.send()}},f=function e(t,n,r,i){if("uploading"===t.uploadState){var o=t.param,s=t.config,c=File.prototype.slice,l=void 0!==o.ctx?o.ctx:"",d=n+s.trunkSize>=t.file.size,u=d?t.file.size:n+s.trunkSize,p=new XMLHttpRequest,h=s.directUploadAddr+"/".concat(o.bucketName)+"/".concat(encodeURIComponent(o.objectName));if(p.upload.onprogress=function(e){if("abort"!==t.uploadState){var r=0;e.lengthComputable?(r=(n+e.loaded)/t.file.size,s.onProgress(r),s.onUploadProgress({loaded:e.loaded,total:t.file.size,percentage:r,percentageText:(100*r).toFixed(2)+"%"})):s.onError(new g("browser does not support query upload progress"))}},p.onreadystatechange=function(){var o,c;if("abort"!==t.uploadState&&4===p.readyState){var l;try{l=JSON.parse(p.responseText)}catch(u){"function"==typeof(null===(o=s.logger)||void 0===o?void 0:o.error)&&s.logger.error("JsonParseError in uploadTrunk. xhr.status = "+p.status+". xhr.responseText: "+p.responseText,u),l={errMsg:"JsonParseError in uploadTrunk. xhr.status = "+p.status+". xhr.responseText: "+p.responseText}}200===p.status?(t.setContext(l.context),d?(i(),t.setComplete()):e(t,l.offset,s.retryCount,i)):p.status.toString().match(/^5/)?r>0?e(t,n,r-1,i):(a.removeFileInfo(t.fileKey),s.onError(new g(l.errMsg,l.errCode))):r>0?("function"==typeof(null===(c=s.logger)||void 0===c?void 0:c.error)&&s.logger.error("uploadTrunk(".concat(h,") error. retry after 3 seconds. ").concat((new Date).toTimeString())),setTimeout(function(){e(t,n,r-1,i)},3500)):p.status?(a.removeFileInfo(t.fileKey),s.onError(new g("uploadTrunk(".concat(h,") error: ").concat(p.status," ").concat(p.statusText)))):s.onError(new g("uploadTrunk(".concat(h,") error. no Error Code. Please check your network")))}},p.open("post",h+"?offset=".concat(n)+"&complete=".concat(d)+"&context=".concat(l)+"&version=".concat(s.version)),p.setRequestHeader("x-nos-token",o.token),o.md5&&p.setRequestHeader("content-md5",o.md5),t.file.type&&p.setRequestHeader("content-type",t.file.type),p.timeout=s.trunkUploadTimeout,"undefined"!=typeof FileReader){var m=new FileReader;m.addEventListener("load",function(e){var t;(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)instanceof ArrayBuffer&&e.target.result.byteLength>0?p.send(e.target.result):s.onError(new g("Read ArrayBuffer failed",194003))}),m.addEventListener("error",function(e){var t=e.target.error;s.onError(new g("Read ArrayBuffer error. ".concat(t.toString()),194003))}),m.readAsArrayBuffer(c.call(t.file,n,u))}else p.send(c.call(t.file,n,u))}};var v=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=r,this.file=t,this.param=n,this.fileKey=a.initFile(n,t,this.config.enableCache),this.resume()}var t;return(t=[{key:"resume",value:function(){var e=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var t=this.config;m(this,t.retryCount,function(n){f(e,n,t.retryCount,function(){e.setUploadState("ended"),"function"==typeof t.onComplete&&t.onComplete(e.param)})})}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){"ended"!==this.uploadState&&"abort"!==this.uploadState&&(this.setUploadState("abort"),this.config.onError(new g("Upload Aborted",10499)))}},{key:"setUploadState",value:function(e){e!==this.uploadState&&(this.uploadState=e)}},{key:"setContext",value:function(e){a.setUploadContext(this.fileKey,e,this.config.enableCache),this.param.ctx=e}},{key:"setComplete",value:function(){a.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}(),y={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function(e){var t=a.getFileKey(e),n=a.getFileInfo(t);return null===n?null:Date.now()-n.modifyAt>y.expireTime?(a.removeFileInfo(t),null):{uploadInfo:Object.assign({bucketName:n.bucket,objectName:n.obj,token:n.token,ctx:n.ctx},n.payload?{payload:n.payload}:{}),complete:n.end}},setMaxFileCache:function(e){y.maxFileCache=e},setExpireTime:function(e){y.expireTime=e},printCaches:function(){if("undefined"!=typeof localStorage)for(var e=0,t=Object.keys(localStorage);e<t.length;e++){var n=t[e],r=a.getFileInfo(n);r&&console.log(r,"modifiedAt",new Date(r.modifyAt).toTimeString())}},createConfig:function(e){return new n(e)},createTask:function(e,t,n){return new v(e,t,n)}},_=y;return t.default}()}),
/*!
* Platform.js v1.3.6
* Copyright 2014-2020 Benjamin Tan
* Copyright 2011-2013 John-David Dalton
* Available under MIT license
*/
createCommonjsModule$1(function(e,t){(function(){var n={function:!0,object:!0}[typeof window]&&window||this,r=t,i=e&&!e.nodeType&&e,o=r&&i&&"object"==typeof t$1&&t$1;!o||o.global!==o&&o.window!==o&&o.self!==o||(n=o);var s=Math.pow(2,53)-1,a=/\bOpera/,c=Object.prototype,l=c.hasOwnProperty,d=c.toString;function u(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function p(e){return e=v(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:u(e)}function h(e,t){for(var n in e)l.call(e,n)&&t(e[n],n,e)}function g(e){return null==e?u(e):d.call(e).slice(8,-1)}function m(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function f(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=s)for(;++n<r;)t(e[n],n,e);else h(e,t)}(e,function(r,i){n=t(n,r,i,e)}),n}function v(e){return String(e).replace(/^ +| +$/g,"")}var y=function e(t){var r=n,i=t&&"object"==typeof t&&"String"!=g(t);i&&(r=t,t=null);var o=r.navigator||{},s=o.userAgent||"";t||(t=s);var c,l,u=i?!!o.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(d.toString()),y="Object",_=i?y:"ScriptBridgingProxyObject",I=i?y:"Environment",T=i&&r.java?"JavaPackage":g(r.java),S=i?y:"RuntimeObject",E=/\bJava/.test(T)&&r.java,M=E&&g(r.environment)==I,b=E?"a":"α",C=E?"b":"β",A=r.document||{},O=r.operamini||r.opera,R=a.test(R=i&&O?O["[[Class]]"]:g(O))?R:O=null,N=t,w=[],P=null,k=t==s,L=k&&O&&"function"==typeof O.version&&O.version(),x=f([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(e,n){return e||RegExp("\\b"+(n.pattern||m(n))+"\\b","i").exec(t)&&(n.label||n)}),V=function(e){return f(e,function(e,n){return e||RegExp("\\b"+(n.pattern||m(n))+"\\b","i").exec(t)&&(n.label||n)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),D=B([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),U=function(e){return f(e,function(e,n,r){return e||(n[D]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(D)]||RegExp("\\b"+m(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r})}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),$=function(e){return f(e,function(e,n){var r,i,o,s,a=n.pattern||m(n);return!e&&(e=RegExp("\\b"+a+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(r=e,i=a,o=n.label||n,s={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"},i&&o&&/^Win/i.test(r)&&!/^Windows Phone /i.test(r)&&(s=s[/[\d.]+$/.exec(r)])&&(r="Windows "+s),r=String(r),i&&o&&(r=r.replace(RegExp(i,"i"),o)),e=p(r.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])),e})}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function B(e){return f(e,function(e,n){var r=n.pattern||m(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=p(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e})}function F(e){return f(e,function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null})}if(x&&(x=[x]),/\bAndroid\b/.test($)&&!D&&(c=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(D=v(c[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),U&&!D?D=B([U]):U&&D&&(D=D.replace(RegExp("^("+m(U)+")[-_.\\s]","i"),U+" ").replace(RegExp("^("+m(U)+")[-_.]?(\\w)","i"),U+" $2")),(c=/\bGoogle TV\b/.exec(D))&&(D=c[0]),/\bSimulator\b/i.test(t)&&(D=(D?D+" ":"")+"Simulator"),"Opera Mini"==V&&/\bOPiOS\b/.test(t)&&w.push("running in Turbo/Uncompressed mode"),"IE"==V&&/\blike iPhone OS\b/.test(t)?(U=(c=e(t.replace(/like iPhone OS/,""))).manufacturer,D=c.product):/^iP/.test(D)?(V||(V="Safari"),$="iOS"+((c=/ OS ([\d_]+)/i.exec(t))?" "+c[1].replace(/_/g,"."):"")):"Konqueror"==V&&/^Linux\b/i.test($)?$="Kubuntu":U&&"Google"!=U&&(/Chrome/.test(V)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(D))||/\bAndroid\b/.test($)&&/^Chrome/.test(V)&&/\bVersion\//i.test(t)?(V="Android Browser",$=/\bAndroid\b/.test($)?$:"Android"):"Silk"==V?(/\bMobi/i.test(t)||($="Android",w.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&w.unshift("accelerated")):"UC Browser"==V&&/\bUCWEB\b/.test(t)?w.push("speed mode"):"PaleMoon"==V&&(c=/\bFirefox\/([\d.]+)\b/.exec(t))?w.push("identifying as Firefox "+c[1]):"Firefox"==V&&(c=/\b(Mobile|Tablet|TV)\b/i.exec(t))?($||($="Firefox OS"),D||(D=c[1])):!V||(c=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(V))?(V&&!D&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(c+"/")+8))&&(V=null),(c=D||U||$)&&(D||U||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test($))&&(V=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test($)?$:c)+" Browser")):"Electron"==V&&(c=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&w.push("Chromium "+c),L||(L=F(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",m(V),"(?:Firefox|Minefield|NetFront)"])),(c=("iCab"==x&&parseFloat(L)>3?"WebKit":/\bOpera\b/.test(V)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(x)&&"WebKit"||!x&&/\bMSIE\b/i.test(t)&&("Mac OS"==$?"Tasman":"Trident")||"WebKit"==x&&/\bPlayStation\b(?! Vita\b)/i.test(V)&&"NetFront")&&(x=[c]),"IE"==V&&(c=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(V+=" Mobile",$="Windows Phone "+(/\+$/.test(c)?c:c+".x"),w.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(V="IE Mobile",$="Windows Phone 8.x",w.unshift("desktop mode"),L||(L=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=V&&"Trident"==x&&(c=/\brv:([\d.]+)/.exec(t))&&(V&&w.push("identifying as "+V+(L?" "+L:"")),V="IE",L=c[1]),k){if(function(e,t){var n=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}(r,"global"))if(E&&(N=(c=E.lang.System).getProperty("os.arch"),$=$||c.getProperty("os.name")+" "+c.getProperty("os.version")),M){try{L=r.require("ringo/engine").version.join("."),V="RingoJS"}catch(q){(c=r.system)&&c.global.system==r.system&&(V="Narwhal",$||($=c[0].os||null))}V||(V="Rhino")}else"object"==typeof r.process&&!r.process.browser&&(c=r.process)&&("object"==typeof c.versions&&("string"==typeof c.versions.electron?(w.push("Node "+c.versions.node),V="Electron",L=c.versions.electron):"string"==typeof c.versions.nw&&(w.push("Chromium "+L,"Node "+c.versions.node),V="NW.js",L=c.versions.nw)),V||(V="Node.js",N=c.arch,$=c.platform,L=(L=/[\d.]+/.exec(c.version))?L[0]:null));else g(c=r.runtime)==_?(V="Adobe AIR",$=c.flash.system.Capabilities.os):g(c=r.phantom)==S?(V="PhantomJS",L=(c=c.version||null)&&c.major+"."+c.minor+"."+c.patch):"number"==typeof A.documentMode&&(c=/\bTrident\/(\d+)/i.exec(t))?(L=[L,A.documentMode],(c=+c[1]+4)!=L[1]&&(w.push("IE "+L[1]+" mode"),x&&(x[1]=""),L[1]=c),L="IE"==V?String(L[1].toFixed(1)):L[0]):"number"==typeof A.documentMode&&/^(?:Chrome|Firefox)\b/.test(V)&&(w.push("masking as "+V+" "+L),V="IE",L="11.0",x=["Trident"],$="Windows");$=$&&p($)}if(L&&(c=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(L)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(k&&o.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(P=/b/i.test(c)?"beta":"alpha",L=L.replace(RegExp(c+"\\+?$"),"")+("beta"==P?C:b)+(/\d+\+?/.exec(c)||"")),"Fennec"==V||"Firefox"==V&&/\b(?:Android|Firefox OS|KaiOS)\b/.test($))V="Firefox Mobile";else if("Maxthon"==V&&L)L=L.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(D))"Xbox 360"==D&&($=null),"Xbox 360"==D&&/\bIEMobile\b/.test(t)&&w.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(V)&&(!V||D||/Browser|Mobi/.test(V))||"Windows CE"!=$&&!/Mobi/i.test(t))if("IE"==V&&k)try{null===r.external&&w.unshift("platform preview")}catch(q){w.unshift("embedded")}else(/\bBlackBerry\b/.test(D)||/\bBB10\b/.test(t))&&(c=(RegExp(D.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||L)?($=((c=[c,/BB10/.test(t)])[1]?(D=null,U="BlackBerry"):"Device Software")+" "+c[0],L=null):this!=h&&"Wii"!=D&&(k&&O||/Opera/.test(V)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==V&&/\bOS X (?:\d+\.){2,}/.test($)||"IE"==V&&($&&!/^Win/.test($)&&L>5.5||/\bWindows XP\b/.test($)&&L>8||8==L&&!/\bTrident\b/.test(t)))&&!a.test(c=e.call(h,t.replace(a,"")+";"))&&c.name&&(c="ing as "+c.name+((c=c.version)?" "+c:""),a.test(V)?(/\bIE\b/.test(c)&&"Mac OS"==$&&($=null),c="identify"+c):(c="mask"+c,V=R?p(R.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(c)&&($=null),k||(L=null)),x=["Presto"],w.push(c));else V+=" Mobile";(c=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(c=[parseFloat(c.replace(/\.(\d)$/,".0$1")),c],"Safari"==V&&"+"==c[1].slice(-1)?(V="WebKit Nightly",P="alpha",L=c[1].slice(0,-1)):L!=c[1]&&L!=(c[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(L=null),c[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==c[0]&&537.36==c[2]&&parseFloat(c[1])>=28&&"WebKit"==x&&(x=["Blink"]),k&&(u||c[1])?(x&&(x[1]="like Chrome"),c=c[1]||((c=c[0])<530?1:c<532?2:c<532.05?3:c<533?4:c<534.03?5:c<534.07?6:c<534.1?7:c<534.13?8:c<534.16?9:c<534.24?10:c<534.3?11:c<535.01?12:c<535.02?"13+":c<535.07?15:c<535.11?16:c<535.19?17:c<536.05?18:c<536.1?19:c<537.01?20:c<537.11?"21+":c<537.13?23:c<537.18?24:c<537.24?25:c<537.36?26:"Blink"!=x?"27":"28")):(x&&(x[1]="like Safari"),c=(c=c[0])<400?1:c<500?2:c<526?3:c<533?4:c<534?"4+":c<535?5:c<537?6:c<538?7:c<601?8:c<602?9:c<604?10:c<606?11:c<608?12:"12"),x&&(x[1]+=" "+(c+="number"==typeof c?".x":/[.+]/.test(c)?"":"+")),"Safari"==V&&(!L||parseInt(L)>45)?L=c:"Chrome"==V&&/\bHeadlessChrome/i.test(t)&&w.unshift("headless")),"Opera"==V&&(c=/\bzbov|zvav$/.exec($))?(V+=" ",w.unshift("desktop mode"),"zvav"==c?(V+="Mini",L=null):V+="Mobile",$=$.replace(RegExp(" *"+c+"$"),"")):"Safari"==V&&/\bChrome\b/.exec(x&&x[1])?(w.unshift("desktop mode"),V="Chrome Mobile",L=null,/\bOS X\b/.test($)?(U="Apple",$="iOS 4.3+"):$=null):/\bSRWare Iron\b/.test(V)&&!L&&(L=F("Chrome")),L&&0==L.indexOf(c=/[\d.]+$/.exec($))&&t.indexOf("/"+c+"-")>-1&&($=v($.replace(c,""))),$&&-1!=$.indexOf(V)&&!RegExp(V+" OS").test($)&&($=$.replace(RegExp(" *"+m(V)+" *"),"")),x&&!/\b(?:Avant|Nook)\b/.test(V)&&(/Browser|Lunascape|Maxthon/.test(V)||"Safari"!=V&&/^iOS/.test($)&&/\bSafari\b/.test(x[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(V)&&x[1])&&(c=x[x.length-1])&&w.push(c),w.length&&(w=["("+w.join("; ")+")"]),U&&D&&D.indexOf(U)<0&&w.push("on "+U),D&&w.push((/^on /.test(w[w.length-1])?"":"on ")+D),$&&(c=/ ([\d.+]+)$/.exec($),l=c&&"/"==$.charAt($.length-c[0].length-1),$={architecture:32,family:c&&!l?$.replace(c[0],""):$,version:c?c[1]:null,toString:function(){var e=this.version;return this.family+(e&&!l?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(c=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(N))&&!/\bi686\b/i.test(N)?($&&($.architecture=64,$.family=$.family.replace(RegExp(" *"+c),"")),V&&(/\bWOW64\b/i.test(t)||k&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(t))&&w.unshift("32-bit")):$&&/^OS X/.test($.family)&&"Chrome"==V&&parseFloat(L)>=39&&($.architecture=64),t||(t=null);var j={};return j.description=t,j.layout=x&&x[0],j.manufacturer=U,j.name=V,j.prerelease=P,j.product=D,j.ua=t,j.version=V&&L,j.os=$||{architecture:null,family:null,version:null,toString:function(){return"null"}},j.parse=e,j.toString=function(){return this.description||""},j.version&&w.unshift(L),j.name&&w.unshift(V),$&&V&&($!=String($).split(" ")[0]||$!=V.split(" ")[0]&&!D)&&w.push(D?"("+$+")":"on "+$),w.length&&(j.description=w.join(" ")),j}();r&&i?h(y,function(e,t){r[t]=e}):n.platform=y}).call(t$1)});var Lt={accountId:{type:"string",allowEmpty:!1},content:{type:"object",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number",allowEmpty:!1}}},messages:{type:"array",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number"},role:{type:"enum",values:["assistant","user","system"]}}},promptVariables:{type:"jsonstr",required:!1},modelConfigParams:{type:"object",required:!1,rules:{prompt:{type:"string",required:!1},maxTokens:{type:"number",required:!1},topP:{type:"number",required:!1},temperature:{type:"number",required:!1}}},aiStream:{type:"boolean",required:!1}};Object.assign({requestId:{type:"string",allowEmpty:!1}},Lt);var mr={sceneName:{type:"string",required:!1},name:{type:"string",required:!1}},ur=Object.assign(Object.assign({},mr),{duration:{type:"number",required:!1}});Object.assign(Object.assign({},ur),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),Object.assign(Object.assign({},mr),{width:{type:"number",required:!1},height:{type:"number",required:!1}});var Sr={antispamBusinessId:1},Tr="V2NIMTeamService",Cr={teamId:1,name:3,teamType:{id:4,retConverter:e=>0==+e?1:+e},ownerAccountId:5,memberLimit:{id:6,retType:"number"},isValidTeam:{id:8,retConverter:(e,t)=>1==+e&&(void 0===t[13]||1==+t[13])},memberCount:{id:9,retType:"number"},memberUpdateTime:{id:10,retType:"number"},createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},intro:14,announcement:15,joinMode:{id:16,retType:"number"},serverExtension:18,customerExtension:19,avatar:20,agreeMode:{id:21,retType:"number"},inviteMode:{id:22,retType:"number"},updateInfoMode:{id:23,retType:"number"},updateExtensionMode:{id:24,retType:"number"},chatBannedMode:{id:101,retType:"number"}},Nr={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},joinTime:{id:10,retType:"number"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,followAccountIds:{id:16,retConverter:e=>{try{return JSON.parse(e)}catch(t){return[]}}}},Ar={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,joinTime:{id:15,retType:"number"},followAccountIds:{id:17,retConverter:e=>{try{return JSON.parse(e)}catch(t){return[]}}}},Or={accountIds:{id:1,converter:e=>JSON.stringify(e)},operation:2},Rr={teamId:1,teamType:2,roleQueryType:3,onlyChatBanned:{id:4,converter:e=>+e},nextToken:5,limit:6,direction:7};function attachmentToRaw(e,t){if(!t)return"";switch(e){case 100:return t.raw||"";case 1:case 3:case 2:case 6:return function(e){var t=e,{width:n,height:r,duration:i,path:o,file:s,raw:a,ctx:c,payload:l,bucketName:d,objectName:u,token:p,ext:h}=t,g=__rest$1(t,["width","height","duration","path","file","raw","ctx","payload","bucketName","objectName","token","ext"]),m="string"==typeof h&&"."===h[0]?h.slice(1):h;return JSON.stringify(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},g),void 0===h?{}:{ext:m}),void 0===n?{}:{w:n}),void 0===r?{}:{h:r}),void 0===i?{}:{dur:i}))}(t);case 4:return n=t,JSON.stringify({lat:n.latitude,lng:n.longitude,title:n.address});case 12:return function(e){var t=__rest$1(e,["raw"]);try{return JSON.stringify(Object.assign(Object.assign({},t),{durations:e.durations.map(e=>({accid:e.accountId,duration:e.duration}))}))}catch(n){return JSON.stringify(e)}}(t);default:return t.raw||JSON.stringify(t)}var n}function rawToAttachment(e,t){var n,r,i;try{switch(n=JSON.parse(e),t){case 100:return{raw:e};case 4:return r=e,{latitude:(i=n).lat,longitude:i.lng,address:i.title,raw:r};case 2:case 3:case 1:case 6:return function(e,t){var{w:n,h:r,dur:i,ext:o}=t,s=__rest$1(t,["w","h","dur","ext"]),a="string"==typeof o&&"."!==o[0]?`.${o}`:o;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},s),void 0===o?{}:{ext:a}),void 0===n?{}:{width:n}),void 0===r?{}:{height:r}),void 0===i?{}:{duration:i}),{raw:e})}(e,n);case 12:return function(e,t){return Object.assign(Object.assign({},t),{durations:t.durations.map(e=>({accountId:e.accid,duration:e.duration})),raw:e})}(e,n);default:return"object"==typeof n&&n?Object.assign(Object.assign({},n),{raw:e}):{raw:e}}}catch(i){return"object"==typeof n&&n?Object.assign(Object.assign({},n),{raw:e}):{raw:e}}}invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Nr),invertSerializeItem(Ar),invertSerializeItem(Nr),invertSerializeItem(Ar),invertSerializeItem(Nr),invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Nr),invertSerializeItem(Nr),invertSerializeItem(Cr),invertSerializeItem(Cr),invertSerializeItem(Ar),invertSerializeItem(Ar);var Vr="V2NIMMessageService",Pr={conversationType:{id:0,converter:conversationTypeV2ToV1,retConverter:conversationTypeV1ToV2},receiverId:1,senderId:2,fromClientType:4,fromDeviceId:5,fromNick:6,createTime:{id:7,retType:"number"},messageType:{id:8,retType:"number"},text:9,attachment:{id:10,converter:(e,t)=>attachmentToRaw(t.messageType,e),retConverter:(e,t)=>rawToAttachment(e,Number(t[8]))},messageClientId:11,messageServerId:12,resend:{id:13,converter:boolToInt,retType:"boolean"},userUpdateTime:{id:14,retType:"number"},serverExtension:15,pushPayload:{id:16,access:"pushConfig.pushPayload"},pushContent:{id:17,access:"pushConfig.pushContent"},forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:e=>{if(e["pushConfig.forcePush"])return"#%@all@%#"},converter:(e,t)=>{if(t["pushConfig.forcePush"])return e?JSON.stringify(e):"#%@all@%#"},retConverter(e){if("#%@all@%#"!==e&&e)try{return JSON.parse(e)}catch(t){return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,access:"pushConfig.forcePush",converter:boolToInt,retType:"boolean"},antispamCustomMessageEnabled:{id:21,def:e=>get(e,"antispamConfig.antispamCustomMessage")?1:void 0,retConverter:()=>{}},antispamCustomMessage:{id:22,access:"antispamConfig.antispamCustomMessage"},antispamBusinessId:{id:23,access:"antispamConfig.antispamBusinessId"},clientAntispamHit:{id:24,access:"clientAntispamHit",converter:boolToInt,retType:"boolean"},antispamEnabled:{id:25,access:"antispamConfig.antispamEnabled",converter:boolToInt,retType:"boolean"},needAck:{id:26,access:"messageConfig.readReceiptEnabled",converter:boolToInt,retType:"boolean"},lastMessageUpdateEnabled:{id:28,access:"messageConfig.lastMessageUpdateEnabled",converter:boolToInt,retType:"boolean"},threadReplySenderId:{id:29,access:"threadReply.senderId"},threadReplyReceiverId:{id:30,access:"threadReply.receiverId"},threadReplyTime:{id:31,access:"threadReply.createTime",retType:"number"},threadReplyServerId:{id:32,access:"threadReply.messageServerId"},threadReplyClientId:{id:33,access:"threadReply.messageClientId"},threadRootSenderId:{id:34,access:"threadRoot.senderId"},threadRootReceiverId:{id:35,access:"threadRoot.receiverId"},threadRootTime:{id:36,access:"threadRoot.createTime",retType:"number"},threadRootServerId:{id:37,access:"threadRoot.messageServerId"},threadRootClientId:{id:38,access:"threadRoot.messageClientId"},isDeleted:{id:39,converter:boolToInt,retType:"boolean"},callbackExtension:40,subType:{id:41,retType:"number"},antispamCheating:{id:42,access:"antispamConfig.antispamCheating"},routeEnvironment:{id:43,access:"routeConfig.routeEnvironment"},antispamExtension:{id:44,access:"antispamConfig.antispamExtension"},antispamResult:45,__clientExt:{id:46,converter:objectToJSONString,retConverter:stringToJSONObject},robotFunction:{id:47,access:"robotConfig.function"},robotTopic:{id:48,access:"robotConfig.topic"},robotCustomContent:{id:49,access:"robotConfig.customContent"},robotAccount:{id:50,access:"robotConfig.accountId"},_conversationOnlineSyncNotify:{id:51},_conversationOnlineSyncData:{id:52},aiAgentMsgDirection:{id:55,access:"aiConfig.aiStatus",retAccess:"aiConfig.aiStatus",retType:"number"},aiAgentAccount:{id:56,access:"aiConfig.accountId",retAccess:"aiConfig.accountId"},aiAgentContent:{id:57,access:"aiConfig.content",converter:objectToJSONString,retConverter:emptyFunc},aiAgentMessages:{id:58,access:"aiConfig.messages",converter:objectToJSONString,retConverter:emptyFunc},aiAgentPromptVariables:{id:59,access:"aiConfig.promptVariables",retConverter:emptyFunc},aiAgentModelConfigParams:{id:60,access:"aiConfig.modelConfigParams",converter:objectToJSONString,retConverter:emptyFunc},errorCode:{id:61,access:"messageStatus.errorCode",converter:emptyFunc,retType:"number"},modifyTime:{id:62,retType:"number"},modifyAccountId:63,aiStream:{id:65,access:"aiConfig.aiStream",retAccess:"streamConfig.isStream",converter:boolToInt,retConverter:intToBool},aiRAGs:{id:66,access:"aiConfig.aiRAGs",retConverter:function(e){try{var t=JSON.parse(e);return t&&t.length>0?t.map(e=>(e.description=e.desc,delete e.desc,e)):[]}catch(n){return[]}}},aiStreamStatus:{id:67,access:"streamConfig.status",retType:"number"},historyEnabled:{id:100,access:"messageConfig.historyEnabled",converter:boolToInt,retType:"boolean"},roamingEnabled:{id:101,access:"messageConfig.roamingEnabled",converter:boolToInt,retType:"boolean"},onlineSyncEnabled:{id:102,access:"messageConfig.onlineSyncEnabled",converter:boolToInt,retType:"boolean"},routeEnabled:{id:105,access:"routeConfig.routeEnabled",converter:boolToInt,retType:"boolean"},isInBlackList:{id:106,access:"isInBlackList",converter:boolToInt,retType:"boolean"},pushEnable:{id:107,access:"pushConfig.pushEnabled",converter:boolToInt,retType:"boolean"},offlineEnabled:{id:108,access:"messageConfig.offlineEnabled",converter:boolToInt,retType:"boolean"},unreadEnabled:{id:109,access:"messageConfig.unreadEnabled",converter:boolToInt,retType:"boolean"},pushNickEnabled:{id:110,access:"pushConfig.pushNickEnabled",converter:boolToInt,retType:"boolean"},msgAckSnapshot:{id:112,retType:"number"},receiverIds:{id:154,access:"targetConfig.receiverIds",converter:objectToJSONString,retConverter:()=>{}},inclusive:{id:155,access:"targetConfig.inclusive",converter:e=>e?1:2,retConverter:()=>{}},newMemberVisible:{id:156,access:"targetConfig.newMemberVisible",converter:e=>e?1:2,retConverter:()=>{}}};invertSerializeItem(Pr);var wr={conversationType:{id:1,access:"messageRefer.conversationType",retType:"number"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},messageServerId:{id:4,access:"messageRefer.messageServerId"},messageClientId:{id:5,access:"messageRefer.messageClientId"},createTime:{id:6,access:"messageRefer.createTime",retType:"number"},deleteTime:{id:7,retType:"number"},serverExtension:8};invertSerializeItem(wr);var Dr={version:1,md5:2,nosurl:3,thesaurus:4},Ur={createTime:{id:0,retType:"number"},sysMsgType:1,receiverId:2,senderId:3,postscript:4,attach:5,pushContent:8,pushPayload:9,messageClientId:10,messageServerId:11,deleteMsgCreatetime:{id:14,retType:"number"},opeAccount:16,env:21,callbackExtension:22},xr={receiverId:0,messageServerId:1,readCount:{id:100,retType:"number"},unreadCount:{id:101,retType:"number"},messageClientId:102,latestReadAccount:103};function conversationTypeV2ToV1(e){return 1===e?0:2===e?1:3===e?5:void 0}function conversationTypeV1ToV2(e){var t=parseInt(e);return 0===t?1:1===t?2:5===t?3:0}invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(xr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(xr),invertSerializeItem(xr),invertSerializeItem(xr),invertSerializeItem(Ur),invertSerializeItem(Ur),invertSerializeItem(wr),invertSerializeItem(wr),invertSerializeItem(wr),invertSerializeItem(Dr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr);var Br="V2NIMNotificationService",jr={timestamp:{id:0,retType:"number"},type:{id:1,retType:"number"},receiverId:2,senderId:3,postscript:4,content:5,idServer:6,offlineEnabled:{id:7,converter:boolToInt,retConverter:function(e,t){return"0"!==t[6]&&!!parseInt(e)},access:"notificationConfig.offlineEnabled"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"},deletedIdClient:10,deletedIdServer:11,antispamEnabled:{id:12,converter:boolToInt,retType:"boolean",access:"antispamConfig.antispamEnabled"},antispamCustomNotification:{id:13,access:"antispamConfig.antispamCustomNotification"},deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:e=>{if(101===e.type&&e["pushConfig.forcePush"])return"#%@all@%#"},converter:(e,t)=>{if(t["pushConfig.forcePush"])return e?JSON.stringify(e):"#%@all@%#"},retConverter(e){if("#%@all@%#"!==e&&e)try{return JSON.parse(e)}catch(t){return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,converter:boolToInt,retType:"boolean",access:"pushConfig.forcePush"},routeEnvironment:{id:21,access:"routeConfig.routeEnvironment"},callbackExt:22,clientNotificationId:{id:23,access:"notificationConfig.clientNotificationId"},conversationOnlineSyncNotify:24,conversationOnlineSyncData:25,routeEnabled:{id:105,converter:boolToInt,retType:"boolean",access:"routeConfig.routeEnabled"},pushEnabled:{id:107,converter:boolToInt,retType:"boolean",access:"pushConfig.pushEnabled"},unreadEnabled:{id:109,converter:boolToInt,retType:"boolean",access:"notificationConfig.unreadEnabled"},pushNickEnabled:{id:110,converter:boolToInt,retType:"boolean",access:"pushConfig.pushNickEnabled"}},Gr={id:1,senderId:2,timestamp:{id:4,retType:"number"},content:5},Wr,Jr;invertSerializeItem(jr),invertSerializeItem(Gr),invertSerializeItem(Gr),invertSerializeItem(jr),invertSerializeItem(jr),invertSerializeItem(jr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(jr),invertSerializeItem(jr),function(e){e[e.nos=1]="nos",e[e.s3=2]="s3"}(Wr||(Wr={})),function(e){e[e.dontNeed=-1]="dontNeed",e[e.time=2]="time",e[e.urls=3]="urls"}(Jr||(Jr={}));var ti={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4,policyVersion:5},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4,policyVersion:5},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}};ti.nosToken,invertSerializeItem(ti.nosToken),ti.nosSafeUrlTag,invertSerializeItem(ti.nosSafeUrlTag),invertSerializeItem(ti.nosConfigTag),invertSerializeItem(ti.grayConfigTag),invertSerializeItem(ti.mixStorePolicyTag),ti.mixStoreTokenReqTag,invertSerializeItem(ti.mixStoreTokenResTag),ti.mixStoreAuthTokenReqTag,invertSerializeItem(ti.mixStoreAuthTokenResTag),ti.nosAccessTokenTag,invertSerializeItem(ti.nosAccessTokenTag),ti.nosAccessTokenTag;var ai="V2NIMLocalConversationService",ci={id:1,ext:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},di={scene:1,to:2,timetag:3},ui;invertSerializeItem(ci),invertSerializeItem(ci),invertSerializeItem(ci),invertSerializeItem(ci),invertSerializeItem(ci),function(e){e[e.createConversation=1]="createConversation",e[e.deleteConversation=2]="deleteConversation",e[e.updateConversation=3]="updateConversation",e[e.setConversationTop=4]="setConversationTop",e[e.clearConversationUnread=5]="clearConversationUnread",e[e.addConversationToGroup=6]="addConversationToGroup",e[e.removeConversationFromGroup=7]="removeConversationFromGroup",e[e.modifyConversationOnSendMessage=8]="modifyConversationOnSendMessage",e[e.modifyConversationOnDeleteMessage=9]="modifyConversationOnDeleteMessage",e[e.modifyConversationOnRecallMessage=10]="modifyConversationOnRecallMessage",e[e.modifyConversationOnClearMessage=11]="modifyConversationOnClearMessage",e[e.oneClickClearConversationUnread=12]="oneClickClearConversationUnread",e[e.modifyConversationOnUpdateMessage=13]="modifyConversationOnUpdateMessage"}(ui||(ui={}));var vi="V2NIMConversationService",fi={conversationId:1,type:{id:2,retType:"number"},serverExtension:3,groupIds:{id:4,retConverter:e=>e?JSON.parse(e):void 0},lastMessage:5,lastMessageState:{id:6,retType:"number"},unreadCount:{id:7,retType:"number"},stickTop:{id:8,retType:"boolean"},sortOrder:{id:9,retType:"number"},version:{id:10,retType:"number"},deleteFlag:{id:11,retType:"boolean"},createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"},lastReadTime:{id:14,retType:"number"}},Ii={type:{id:1,retType:"number"},oneClickClearUnreadType:{id:2,retType:"number"},oneClickClearUnreadConversationType:{id:3,retConverter:stringToJSONObject},oneClickClearUnreadGroupId:{id:4,retType:"string"},oneClickClearUnreadVersion:{id:5,retType:"number"},oneClickClearUnreadLastReadTime:{id:6,retType:"number"}},_i;invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(Ii),invertSerializeItem(fi),invertSerializeItem(Ii),invertSerializeItem(Ii),invertSerializeItem(Ii),function(e){e[e.createConversationGroup=1]="createConversationGroup",e[e.deleteConversationGroup=2]="deleteConversationGroup",e[e.updateConversationGroup=3]="updateConversationGroup",e[e.addConversationToGroup=4]="addConversationToGroup",e[e.removeConversationFromGroup=5]="removeConversationFromGroup"}(_i||(_i={}));var Ti="V2NIMConversationGroupService",Ci={groupId:1,name:2,serverExtension:3,createTime:4,updateTime:5};invertSerializeItem(Ci),invertSerializeItem(fi),invertSerializeItem(Ci),invertSerializeItem(Ci),invertSerializeItem(Ci),invertSerializeItem(Ci),invertSerializeItem(fi),invertSerializeItem(fi),invertSerializeItem(Ci);var Ai="V2NIMMessageLogUtil",Ri={conversationType:{id:0,retType:"number"},receiverId:1,deleteRoam:{id:2,converter:boolToInt},teamId:3,onlineSync:{id:4,converter:boolToInt},deleteTime:{id:6,retType:"number"},serverExtension:7},bi=[{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"direction"},{type:"LongArray",name:"msgTypes"}];invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Ri),invertSerializeItem(Ri);var ki="V2NIMMessageExtendUtil",Li={conversationType:{id:1,converter:conversationTypeV2ToV1,retConverter:conversationTypeV1ToV2,access:"messageRefer.conversationType"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},createTime:{id:4,retType:"number",access:"messageRefer.createTime"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},detail:7,modify:{id:8,retType:"number"}},wi={conversationType:{id:1,access:"messageRefer.conversationType",retConverter:conversationTypeV1ToV2},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},time:{id:4,access:"messageRefer.createTime",converter:boolToInt,retType:"number"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},operatorId:7,serverExtension:8,createTime:{id:9,converter:boolToInt,retType:"number"},updateTime:{id:10,converter:boolToInt,retType:"number"}},Di={operatorId:1,index:{id:2,retType:"number"},createTime:{id:3,retType:"number"},serverExtension:4,pushEnabled:{id:5,access:"pushConfig.pushEnabled",converter:boolToInt},needBadge:{id:6,access:"pushConfig.needBadge",converter:boolToInt},title:{id:7,access:"pushConfig.title"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"}},Ui={accid:1,serverExtension:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},xi={collectionId:1,collectionType:{id:2,retType:"number"},collectionData:3,serverExtension:4,uniqueId:5,createTime:{id:6,retType:"number"},updateTime:{id:7,retType:"number"}},Fi={keyword:1,beginTime:2,endTime:3,messageLimit:5,sortOrder:{id:6,converter:e=>0===e?2:1},p2pAccountIds:{id:7,converter:e=>e.join(",")},teamIds:{id:8,converter:e=>e.join(",")},senderAccountIds:{id:9,converter:e=>e.join(",")},messageTypes:{id:10,converter:e=>e.join(",")},messageSubtypes:{id:11,converter:e=>e.join(",")}},Bi={keywordList:{id:1,converter:e=>objectToJSONString(e)},keywordMatchType:2,searchStartTime:3,searchTimePeriod:4,pageToken:5,limit:7,direction:8,conversationId:9,senderAccountIds:{id:12,converter:e=>e.join(",")},messageTypes:{id:13,converter:e=>e.join(",")},messageSubtypes:{id:14,converter:e=>e.join(",")}},$i=Object.assign(Object.assign({},Fi),{conversationLimit:4});invertSerializeItem(wi),invertSerializeItem(Pr),invertSerializeItem(Di),invertSerializeItem(Pr),invertSerializeItem(Di),invertSerializeItem(Li),invertSerializeItem(Pr),invertSerializeItem(Ui),invertSerializeItem(Pr),invertSerializeItem(Ui),invertSerializeItem(Pr),invertSerializeItem(Ui),invertSerializeItem(xi),invertSerializeItem(xi),invertSerializeItem(xi),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem(Pr),invertSerializeItem({total:{id:1,retType:"number"},timestamp:{id:2,retType:"number"}}),invertSerializeItem(Pr);var Gi,qi={joinMode:{type:"enum",values:[1,0,2],required:!1},agreeMode:{type:"enum",values:[0,1],required:!1},inviteMode:{type:"enum",values:[1,0],required:!1},updateInfoMode:{type:"enum",values:[1,0],required:!1},updateExtensionMode:{type:"enum",values:[1,0],required:!1},chatBannedMode:{type:"enum",values:[0,1],required:!1}};Object.assign({name:{type:"string",allowEmpty:!1},teamType:{type:"enum",values:[1,2]},memberLimit:{type:"number",min:1,required:!1}},qi);var zi={type:"array",min:1,itemType:"string"},Ki={type:"string"};Object.assign(Object.assign({},Ki),{required:!1}),Object.assign(Object.assign({},Ki),{required:!1}),Object.assign({name:{type:"string",allowEmpty:!1,required:!1},memberLimit:{type:"number",min:1,required:!1}},qi),function(e){e[e.TEAM_INVITATION=0]="TEAM_INVITATION",e[e.TEAM_KICK=1]="TEAM_KICK",e[e.TEAM_LEAVE=2]="TEAM_LEAVE",e[e.TEAM_UPDATED=3]="TEAM_UPDATED",e[e.TEAM_DISMISS=4]="TEAM_DISMISS",e[e.TEAM_APPLY_ACCEPT=5]="TEAM_APPLY_ACCEPT",e[e.TEAM_TRANSFER_OWNER=6]="TEAM_TRANSFER_OWNER",e[e.TEAM_ADD_MANAGER=7]="TEAM_ADD_MANAGER",e[e.TEAM_REMOVE_MANAGER=8]="TEAM_REMOVE_MANAGER",e[e.TEAM_INVITE_ACCEPT=9]="TEAM_INVITE_ACCEPT",e[e.TEAM_MEMBER_MUTE=10]="TEAM_MEMBER_MUTE",e[e.SUPER_TEAM_INVITATION=401]="SUPER_TEAM_INVITATION",e[e.SUPER_TEAM_KICK=402]="SUPER_TEAM_KICK",e[e.SUPER_TEAM_LEAVE=403]="SUPER_TEAM_LEAVE",e[e.SUPER_TEAM_UPDATE=404]="SUPER_TEAM_UPDATE",e[e.SUPER_TEAM_DISMISS=405]="SUPER_TEAM_DISMISS",e[e.SUPER_TEAM_TRANSFER_OWNER=406]="SUPER_TEAM_TRANSFER_OWNER",e[e.SUPER_TEAM_ADD_MANAGER=407]="SUPER_TEAM_ADD_MANAGER",e[e.SUPER_TEAM_REMOVE_MANAGER=408]="SUPER_TEAM_REMOVE_MANAGER",e[e.SUPER_TEAM_MEMBER_MUTE=409]="SUPER_TEAM_MEMBER_MUTE",e[e.SUPER_TEAM_APPLY_ACCEPT=410]="SUPER_TEAM_APPLY_ACCEPT",e[e.SUPER_TEAM_INVITE_ACCEPT=411]="SUPER_TEAM_INVITE_ACCEPT"}(Gi||(Gi={}));var go="V2NIMUserService",fo={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"}};invertSerializeItem(fo),invertSerializeItem(fo),invertSerializeItem({accountId:0,isMute:{id:1,retType:"boolean"},isBlock:{id:2,retType:"boolean"}}),invertSerializeItem(fo);var Eo="V2NIMFriendService",To={accountId:4,relationShip:{id:5,retType:"number"},source:{id:7,retType:"number"},alias:8,serverExtension:10,createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},customerExtension:13};invertSerializeItem({serverExt:1}),invertSerializeItem(To),invertSerializeItem(To),invertSerializeItem(fo),invertSerializeItem(To);var wo="V2NIMSettingService",Uo={need:{id:1,converter:e=>e?2:1,retConverter:e=>"2"===e}};invertSerializeItem(Uo),invertSerializeItem(Uo);var Fo=Fo||function(e){var t;"undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(t=globalThis.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&"undefined"!=typeof global&&global.crypto&&(t=global.crypto);var n=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},o=i.lib={},s=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new a.init(t,e)}}),c=i.enc={},l=c.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(n,t/2)}},d=c.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(n,t)}},u=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},p=o.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,o=r.sigBytes,s=this.blockSize,c=o/(4*s),l=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*s,d=e.min(4*l,o);if(l){for(var u=0;u<l;u+=s)this._doProcessBlock(i,u);n=i.splice(0,l),r.sigBytes-=d}return new a.init(n,d)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=p.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=i.algo={};return i}(Math);Fo.enc.Utf8;var $o=Fo,jo=$o.lib,Go=jo.Base,qo=jo.WordArray,Ho=$o.algo,zo=Ho.MD5,Yo=Ho.EvpKDF=Go.extend({cfg:Go.extend({keySize:4,hasher:zo,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,r=this.cfg,i=r.hasher.create(),o=qo.create(),s=o.words,a=r.keySize,c=r.iterations;s.length<a;){n&&i.update(n),n=i.update(e).finalize(t),i.reset();for(var l=1;l<c;l++)n=i.finalize(n),i.reset();o.concat(n)}return o.sigBytes=4*a,o}});$o.EvpKDF=function(e,t,n){return Yo.create(n).compute(e,t)},Fo.EvpKDF;var Ko=Fo,Wo=Ko.lib.WordArray;Ko.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],o=0;o<n;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<n;a++)i.push(r.charAt(s>>>6*(3-a)&63));var c=r.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var i=0;i<n.length;i++)r[n.charCodeAt(i)]=i}var o=n.charAt(64);if(o){var s=e.indexOf(o);-1!==s&&(t=s)}return function(e,t,n){for(var r=[],i=0,o=0;o<t;o++)if(o%4){var s=n[e.charCodeAt(o-1)]<<o%4*2|n[e.charCodeAt(o)]>>>6-o%4*2;r[i>>>2]|=s<<24-i%4*8,i++}return Wo.create(r,i)}(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},Fo.enc.Base64,function(e){e.lib.Cipher||function(){var t=e,n=t.lib,r=n.Base,i=n.WordArray,o=n.BufferedBlockAlgorithm,s=t.enc;s.Utf8;var a=s.Base64,c=t.algo.EvpKDF,l=n.Cipher=o.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?y:f}return function(t){return{encrypt:function(n,r,i){return e(r).encrypt(t,n,r,i)},decrypt:function(n,r,i){return e(r).decrypt(t,n,r,i)}}}}()});n.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=t.mode={},u=n.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=d.CBC=function(){var e=u.extend();function t(e,t,n){var r,i=this._iv;i?(r=i,this._iv=void 0):r=this._prevBlock;for(var o=0;o<n;o++)e[t+o]^=r[o]}return e.Encryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize;t.call(this,e,n,i),r.encryptBlock(e,n),this._prevBlock=e.slice(n,n+i)}}),e.Decryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize,o=e.slice(n,n+i);r.decryptBlock(e,n),t.call(this,e,n,i),this._prevBlock=o}}),e}(),h=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,r=n-e.sigBytes%n,o=r<<24|r<<16|r<<8|r,s=[],a=0;a<r;a+=4)s.push(o);var c=i.create(s,r);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};n.BlockCipher=l.extend({cfg:l.cfg.extend({mode:p,padding:h}),reset:function(){var e;l.reset.call(this);var t=this.cfg,n=t.iv,r=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(r,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var g=n.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),m=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;return(n?i.create([1398893684,1701076831]).concat(n).concat(t):t).toString(a)},parse:function(e){var t,n=a.parse(e),r=n.words;return 1398893684==r[0]&&1701076831==r[1]&&(t=i.create(r.slice(2,4)),r.splice(0,4),n.sigBytes-=16),g.create({ciphertext:n,salt:t})}},f=n.SerializableCipher=r.extend({cfg:r.extend({format:m}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r),o=i.finalize(t),s=i.cfg;return g.create({ciphertext:o,key:n,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(t.kdf={}).OpenSSL={execute:function(e,t,n,r){r||(r=i.random(8));var o=c.create({keySize:t+n}).compute(e,r),s=i.create(o.words.slice(t),4*n);return o.sigBytes=4*t,g.create({key:o,iv:s,salt:r})}},y=n.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:v}),encrypt:function(e,t,n,r){var i=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize);r.iv=i.iv;var o=f.encrypt.call(this,e,t,i.key,r);return o.mixIn(i),o},decrypt:function(e,t,n,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var i=r.kdf.execute(n,e.keySize,e.ivSize,t.salt);return r.iv=i.iv,f.decrypt.call(this,e,t,i.key,r)}})}()}(Fo);var Jo=Fo,Xo=Jo.lib.StreamCipher,Qo=Jo.algo,Zo=Qo.RC4=Xo.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,r=this._S=[],i=0;i<256;i++)r[i]=i;i=0;for(var o=0;i<256;i++){var s=i%n,a=t[s>>>2]>>>24-s%4*8&255;o=(o+r[i]+a)%256;var c=r[i];r[i]=r[o],r[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=generateKeystreamWord.call(this)},keySize:8,ivSize:0});function generateKeystreamWord(){for(var e=this._S,t=this._i,n=this._j,r=0,i=0;i<4;i++){n=(n+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[n],e[n]=o,r|=e[(e[t]+e[n])%256]<<24-8*i}return this._i=t,this._j=n,r}Jo.RC4=Xo._createHelper(Zo);var es=Qo.RC4Drop=Zo.extend({cfg:Zo.cfg.extend({drop:192}),_doReset:function(){Zo._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)generateKeystreamWord.call(this)}});Jo.RC4Drop=Xo._createHelper(es),Fo.RC4;var is={accountId:1,messages:{id:2,converter:objectToJSONString,retConverter:stringToJSONObject},requestId:3,content:{id:4,converter:objectToJSONString,retConverter:stringToJSONObject},promptVariables:5,modelConfigParams:{id:6,converter:objectToJSONString,retConverter:stringToJSONObject},antispamBusinessId:7,antispamEnabled:{id:8,converter:boolToInt},aiStream:{id:9,converter:boolToInt}},os={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,modelType:{id:11,retType:"number"},modelConfig:{id:12,retConverter:e=>{if(e=stringToJSONObject(e)){var t=Object.keys(e).reduce((t,n)=>{return t[(r=n,(r=r||"").split("_").map((e,t)=>0===t?e:e[0].toUpperCase()+e.slice(1)).join(""))]=e[n],t;var r},{});if("string"==typeof t.promptKeys)try{t.promptKeys=JSON.parse(t.promptKeys)}catch(n){}return t}}},yunxinConfig:{id:13,retConverter:e=>{if(e=stringToJSONObject(e))return e}},valid:{id:14,retType:"boolean"},createTime:{id:15,retType:"number"},updateTime:{id:16,retType:"number"}};function aiAgentStreamContentRetConverter(e){try{var t=JSON.parse(e);return"number"==typeof t.index?{msg:t.msg||"",type:t.type,lastChunk:{content:t.msg,chunkTime:parseInt(t.timestamp),type:t.type,index:parseInt(t.index)}}:t}catch(n){return}}function aiAgentStreamAIRAGsRetConverter(e){try{var t=JSON.parse(e);return t&&t.length>0?t.map(e=>(e.description=e.desc,delete e.desc,e)):[]}catch(n){return[]}}var ss={code:{id:1,retType:"number"},accountId:2,requestId:3,content:{id:4,retConverter:aiAgentStreamContentRetConverter},aiRAGs:{id:5,retConverter:aiAgentStreamAIRAGsRetConverter},timestamp:{id:6,retType:"number"},aiStreamStatus:{id:7,retType:"number"},aiStream:{id:8,retType:"boolean"}},ns={serverId:1,clientId:2,type:{id:3,retType:"number"},from:4,to:5,aiAccount:6,startIndex:{id:7,retType:"number"},endIndex:{id:8,retType:"number"},excludeIndex:{id:9,converter:objectToJSONString}},as={serverId:1,clientId:2,type:{id:3,retType:"number"},content:{id:4,retConverter:aiAgentStreamContentRetConverter},aiRAGs:{id:6,retConverter:aiAgentStreamAIRAGsRetConverter}};invertSerializeItem(ss),invertSerializeItem(os),invertSerializeItem({hasMore:{id:16,retType:"boolean"},nextToken:2}),invertSerializeItem(Pr),invertSerializeItem(ss),invertSerializeItem(as);var ls="V2NIMSignallingService",ps={accountId:1,uid:{id:2,retType:"number"},joinTime:{id:3,retType:"number"},expireTime:{id:4,retType:"number"},deviceId:5},ms={channelType:{id:1,retType:"number",retAccess:"channelInfo.channelType"},channelName:{id:2,retAccess:"channelInfo.channelName"},channelId:{id:3,retAccess:"channelInfo.channelId"},createTime:{id:4,retType:"number",retAccess:"channelInfo.createTime"},expireTime:{id:5,retType:"number",retAccess:"channelInfo.expireTime"},creatorAccountId:{id:6,retAccess:"channelInfo.creatorAccountId"},channelExtension:{id:7,retAccess:"channelInfo.channelExtension"},channelValid:{id:8,retDef:!0,retAccess:"channelInfo.channelValid",retConverter:e=>1!==parseInt(e)},fromAccid:10,toAccid:11,requestId:12,pushEnabled:{id:13,access:"pushConfig.pushEnabled",converter:boolToInt,retType:"boolean"},pushTitle:{id:14,access:"pushConfig.pushTitle"},pushContent:{id:15,access:"pushConfig.pushContent"},pushPayload:{id:16,access:"pushConfig.pushPayload"},unreadEnabled:{id:17,access:"signallingConfig.unreadEnabled",converter:boolToInt,retType:"boolean",def:1},members:{id:18,retAccess:"members",retConverter:e=>{try{return JSON.parse(e).map(e=>deserialize(e,invertSerializeItem(ps)))}catch(t){return}}},attach:{id:19,retConverter:stringToJSONObject},serverExtension:{id:20,retDef:""},offlineEnabled:{id:21,converter:boolToInt,retType:"boolean",def:1},msgId:22,selfUid:{id:23,retType:"number",access:"signallingConfig.selfUid"},time:{id:24,retType:"number"},rtcChannelName:{id:25,access:"rtcConfig.rtcChannelName"},rtcTokenTtl:{id:26,retType:"number",access:"rtcConfig.rtcTokenTtl",retAccess:"rtcInfo.rtcTokenTtl"},rtcToken:{id:27,retAccess:"rtcInfo.rtcToken"},rtcParams:{id:28,access:"rtcConfig.rtcParams",retAccess:"rtcInfo.rtcParams"},callStatus:{id:30,retType:"number"}};invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms),invertSerializeItem(ms);var Cs,As="V2NIMSubscriptionService",Os={eventType:{id:1,retType:"number"},statusType:{id:2,retType:"number"},uniqueId:3,extension:4,duration:{id:5,retType:"number"},onlineOnly:{id:6,retType:"boolean",converter:e=>e?1:2},multiSync:{id:7,retType:"boolean",converter:boolToInt},publishTime:{id:10,retType:"number"},serverId:11,clientType:{id:12,retType:"number"},serverExtension:13,extensionReceived:14,accountId:103},Rs={eventType:{id:1,retType:"number"},duration:{id:2,retType:"number"},immediateSync:{id:3,retType:"number",converter:boolToInt},accountId:102,subscribeTime:{id:105,retType:"number"}};invertSerializeItem(Os),invertSerializeItem(Os),invertSerializeItem(Rs),invertSerializeItem(Rs),invertSerializeItem(Os),function(e){e[e.V2NIM_PROXY_REQUEST_METHOD_GET=1]="V2NIM_PROXY_REQUEST_METHOD_GET",e[e.V2NIM_PROXY_REQUEST_METHOD_POST=2]="V2NIM_PROXY_REQUEST_METHOD_POST",e[e.V2NIM_PROXY_REQUEST_METHOD_PUT=3]="V2NIM_PROXY_REQUEST_METHOD_PUT",e[e.V2NIM_PROXY_REQUEST_METHOD_DELETE=4]="V2NIM_PROXY_REQUEST_METHOD_DELETE"}(Cs||(Cs={}));var ws={zone:1,path:2,method:3,header:4,body:5};invertSerializeItem(ws),invertSerializeItem({fromAccountId:1,body:2,time:{id:3,retType:"number"}}),Cs.V2NIM_PROXY_REQUEST_METHOD_DELETE,Cs.V2NIM_PROXY_REQUEST_METHOD_GET,Cs.V2NIM_PROXY_REQUEST_METHOD_POST,Cs.V2NIM_PROXY_REQUEST_METHOD_PUT;var xs=NIM$1;xs.registerService(class extends V2Service{constructor(e,t={}){var n;super("V2NIMLoginService",e),this.account="",this.previousLoginAccount="",this.token="",this.deviceId="",this.clientSession="",this.processId="",this.kickedDetail=null,this.binaryWebsocket=!0,this.core._registerDep(MiscService,"misc"),registerParser({cmdMap:ze,cmdConfig:We}),"v2"===e.options.apiVersion&&(registerParser({cmdMap:Ye,cmdConfig:Je}),this.core.auth=this),this.previousLoginManager=new PromiseManager,this.doLoginStepsManager=new PromiseManager,this.loginTimerManager=new TimerManager,this.loginOption=Object.assign({},ht),this.config={lbsUrls:ut,linkUrl:"weblink.netease.im:443",linkSSL:!0},this.setOptions(t),e.V2NIMLoginService=this,!1!==this.core.options.binaryWebsocket&&"function"==typeof Uint8Array?(this.binaryWebsocket=!0,n=new V2BinaryClientSocket(this.core)):(this.binaryWebsocket=!1,n=new V2ClientSocket(this.core)),this.clientSocket=n,"v2"===this.core.options.apiVersion&&(this.core.clientSocket=n),this.lifeCycle=new V2NIMLoginLifeCycle(e),this.reconnect=new V2NIMLoginReconnect(e),this.lbs=new V2NIMLoginLbs(e),this.authenticator=new V2NIMLoginAuthenticator(e),this.dataSync=new V2NIMLoginDataSync(e)}get hasSettingService(){var e;return!!(null===(e=this.core.V2NIMSettingService)||void 0===e?void 0:e.name)}setOptions(e){var t,n,r;validate({lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e,"",!0),this.config=assignOptions(this.config,e),null===(n=null===(t=this.core.clientSocket)||void 0===t?void 0:t.setLinkSSL)||void 0===n||n.call(t,null===(r=this.config.linkSSL)||void 0===r||r);var i="",o="";this.config.isFixedDeviceId?(i=Ae.localStorage.getItem("__NIM_DEVC_ID__")||Ve(),o=Ae.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||Ve(),Ae.localStorage.setItem("__NIM_DEVC_ID__",i),Ae.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",o)):(i=Ve(),o=Ve()),this.deviceId=i,this.clientSession=o,this.core.reporter.setConfig({common:{dev_id:i}})}reset(){this.account="",this.token="",this.processId="",this.lbs.reset(),this.reconnect.destroy(),this.authenticator.reset(),this.authenticator.clearLastLoginClient(),this.dataSync.reset()}login(e,t,n={}){return __awaiter$2(this,void 0,void 0,function*(){this._checkApiVersion();var r=Ae.getSystemInfo()||{};if(r.os&&r.os.toLowerCase(),"string"!=typeof e||""===e.trim())throw new ValidateErrorV2({detail:{reason:"Account must be string"}});if(validate(mt,n,"",!0),0===(n=assignOptions(ht,n)).authType&&!t)throw new ValidateErrorV2({detail:{reason:"When authType is 0, token cannot be empty"}});if(""!==this.previousLoginAccount&&this.previousLoginAccount!==e&&this.core._clearModuleData(),0===this.getLoginStatus())this.logger.log(`V2NIMLoginService::login:allowLogin:${e}`,n);else{if(1===this.getLoginStatus())return this.smoothForLogined(e,t,n);if(2===this.getLoginStatus())return this.smoothForLogining(e,t,n)}this.account=e,this.previousLoginAccount=e,this.token=t,this.processId=Ve(),this.loginOption=assignOptions(ht,n),this.kickedDetail=null,this.loginTimerManager.destroy(),this.loginTimerManager.addTimer(()=>{var e=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_TIMEOUT,detail:{reason:"Login API timeout"}});this.doLoginStepsManager.clear(e),this.previousLoginManager.clear(e),this.originLoginPromise=void 0,this.lifeCycle.processEvent("exited",e)},this.loginOption.timeout>0?this.loginOption.timeout:6e4,1);try{yield this.multiTryDoLogin(),this.loginTimerManager.destroy()}catch(i){throw this.loginTimerManager.destroy(),i}})}setAppVisibility(){this.logger.warn("V2NIMLoginService::setAppVisibility is deprecated @v10.9.40")}getChatroomLinkAddress(e,t){return __awaiter$2(this,void 0,void 0,function*(){return validate({roomId:{type:"string",regExp:/^\d+$/,required:!0,allowEmpty:!1},miniProgram:{type:"boolean",required:!1}},{roomId:e,miniProgram:t},"",!0),t=void 0===t?pendingIsMiniappEnv():t,(yield this.clientSocket.sendCmd("v2GetChatroomLinkAddress",{roomId:e,miniProgram:t})).content.linkAddress})}multiTryDoLogin(e){return __awaiter$2(this,void 0,void 0,function*(){for(var t=new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"loginFailed"}}),n=0;n<=this.loginOption.retryCount;n++){var r=`V2NIMLoginService::times of login try: ${n}`;n>0?this.logger.warn(r):this.logger.log(r);try{this.originLoginPromise=e||this.doLogin(!1),e=void 0;var i=yield this.previousLoginManager.add(this.originLoginPromise);return this.core.reporter.reportTraceEnd("login",!0),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.originLoginPromise=void 0,i}catch(o){if(t=o||t,this.logger.error(`V2NIMLoginService::login failed, times of login try: ${n}, err.code: ${null==t?void 0:t.code}, err.message: "${null==t?void 0:t.message}"`),t.code!==Me.V2NIM_ERROR_CODE_CANCELLED&&this.core.reporter.reportTraceEnd("login",!1),this.reconnect.clearReconnectTimer(),this.checkLoginTerminalCode(t&&t.code))throw this.lifeCycle.processEvent("exited",t),t;t&&399===t.code&&this.lbs.reset()}}throw this.lifeCycle.processEvent("exited",t),t})}doLogin(e){var t,n;return __awaiter$2(this,void 0,void 0,function*(){var r=!!e||this.authenticator.checkAutoLogin(this.loginOption.forceMode);this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",r?{user_id:this.account,action:"auto_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}:{user_id:this.account,action:"manual_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:JSON.stringify(this.loginOption),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:Ae.net.getNetworkStatus()});var i=yield this.doLoginStepsManager.add(this.lbs.getLbsInfos());yield this.doLoginStepsManager.add(this.clientSocket.connect(i,e));var o=yield this.doLoginStepsManager.add(this.authenticator.verifyAuthentication(r));if(this.processId=Ve(),this.clientSocket.resetSocketConfig(),this.reconnect.reset(),this.dataSync.reset(),this.lifeCycle.processEvent("loginSucc",void 0,Object.assign(Object.assign({},o),{isReconnect:e})),this.clientSocket.ping(),this.core.abtest.abtRequest(),"function"==typeof(null===(t=this.core.V2NIMClientAntispamUtil)||void 0===t?void 0:t.downloadLocalAntiSpamVocabs)&&this.core.V2NIMClientAntispamUtil.downloadLocalAntiSpamVocabs(),"function"==typeof(null===(n=this.core.cloudStorage)||void 0===n?void 0:n.init))try{yield this.core.cloudStorage.init(o.timestamp)}catch(s){this.logger.warn("doLogin::cloudStorage init error",s)}return o})}smoothForLogined(e,t,n){return __awaiter$2(this,void 0,void 0,function*(){var r=this.checkIsSameLogin(e,t,n);return this.logger.warn(`V2NIMLoginService::smoothForLogined:Logined, isSameLogin ${r}`),r?void 0:(yield this.logout(),this.login(e,t,n))})}smoothForLogining(e,t,n){return __awaiter$2(this,void 0,void 0,function*(){var r=this.checkIsSameLogin(e,t,n);if(this.logger.warn(`V2NIMLoginService::smoothForLogining:Logining progress exists, abort the previous login attempt and start next attempt, isSameLogin ${r}`),this.previousLoginManager.clear(),this.reconnect.reset(),this.account=e,this.previousLoginAccount=e,this.token=t,this.loginOption=assignOptions(this.loginOption,n),!r)return this.doLoginStepsManager.clear(),this.clientSocket.doDisconnect(et.ACTIVE,"Aborted"),this.reset(),this.lifeCycle.processEvent("logout"),yield Promise.resolve(),this.login(e,t,n);if(!this.originLoginPromise)throw new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"NoPreviousLoginExists"}});this.reconnect.reset(),yield Promise.resolve(),yield this.multiTryDoLogin(this.originLoginPromise)})}checkIsSameLogin(e,t,n){return this.account===e&&this.loginOption.authType===n.authType&&(0!==n.authType||this.token===t)}logout(){return __awaiter$2(this,void 0,void 0,function*(){this._checkApiVersion(),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.loginTimerManager.destroy(),this.originLoginPromise=void 0;var e=this.getConnectStatus(),t=this.getLoginStatus();switch(t){case 1:try{yield this.clientSocket.sendCmd("v2Logout",void 0,{timeout:1e3}),this.clientSocket.doDisconnect(et.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout")}catch(n){this.logger.error("Instance::disconnect sendCmd:logout error",n),this.clientSocket.doDisconnect(et.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout")}break;case 2:case 3:this.clientSocket.doDisconnect(et.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout");break;case 0:throw this.core._clearModuleData(),new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:`Illegal logout. loginStatus ${t}. connectStatus ${e}`}});default:throw this.core._clearModuleData(),new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:`Illegal logout. illegal status: loginStatus ${t}. connectStatus ${e}`}})}})}getConnectStatus(){return this.lifeCycle.getConnectStatus()}getLoginStatus(){return this.lifeCycle.getLoginStatus()}getLoginUser(){return this.account}getLoginClients(){return function(e,t){e=e||[],t=t||"";for(var n=[],r=[],i=0;i<e.length;i++){var o=e[i][t];-1===r.indexOf(o)&&(r.push(o),n.push(e[i]))}return n}(this.authenticator.loginClients,"clientId").map(e=>pick(e,["type","os","timestamp","customTag","customClientType","clientId","clientIP"]))}getCurrentLoginClient(){var e;if(null===(e=this.authenticator.loginClientOfThisConnection)||void 0===e?void 0:e.clientId)return pick(this.authenticator.loginClientOfThisConnection,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])}getDataSync(){var e=this.dataSync.datas;return e&&e.length>0?e.map(e=>({type:e.type,state:e.state})):null}setReconnectDelayProvider(e){this.reconnect._setReconnectDelayProvider(e)}kickOffline(e){return __awaiter$2(this,void 0,void 0,function*(){if(this._checkApiVersion(),validate({clientId:{type:"string",allowEmpty:!1}},e,"",!0),0===get(yield this.clientSocket.sendCmd("v2KickOffline",{clientIds:[e.clientId]}),"content.clientIds.length"))throw new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_REQUEST_FAILED})})}getKickedOfflineDetail(){return this.kickedDetail}checkLoginTerminalCode(e){return this.authenticator.checkLoginTerminalCode(e)}checkIllegalState(){if(!this.getLoginUser())throw new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_ILLEGAL_STATE})}_checkApiVersion(){if("v2"!==this.core.options.apiVersion)throw new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v2"'}})}v2LoginHandler(e){if(e.error)throw this.clientSocket.doDisconnect(et.ACTIVE,e.error),e.error;return e}v2LoginClientChangeHandler(e){this.authenticator.changeLoginClient(parseInt(e.content.state),e.content.datas)}nimLoginClientChangeHandler(e){this.authenticator.changeLoginClient(parseInt(e.content.state),e.content.datas)}qchatLoginClientChangeHandler(e){var t=parseInt(e.content.state);t=1===t?2:3,this.authenticator.changeLoginClient(t,[e.content.data])}v2BeKickedHandler(e){if(e.error)this.core.logger.error("v2BeKickedHandler error, ",e.error);else{var t=format({reason:{type:"number"},clientType:{type:"number"},customClientType:{type:"number"}},e.content);this.core.logger.warn("v2Bekicked::",t),this.kickedDetail=t,this.clientSocket.doDisconnect(et.KICKED,t),this.core._clearModuleData(),this.lifeCycle.processEvent("kicked",new V2NIMErrorImpl({code:Me.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to kicked"}}),t),this.emit("onKickedOffline",t)}}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;if("onLoginFailed"===e||"onDisconnected"===e||"onConnectFailed"===e){var r=t[0];this.logger.log(`${n}`,r.toString())}else if("onDataSync"===e){var i=t[2];this.logger.log(`${n}`,t[0],t[1],i&&i.toString())}else this.logger.log(`${n}`,...t);return super.emit(e,...t)}},"V2NIMLoginService"),xs.registerService(class extends V2Service{constructor(e){super("V2NIMSyncService",e),this.teamKey=["teams","superTeams","myTeamMembers","mySuperTeamMembers"],this.config={},this.timetags={},"v2"===this.core.options.apiVersion&&(this.initEventListeners(),registerParser({cmdMap:gt,cmdConfig:vt}),this.setListener())}reset(){this.timetags={}}setListener(){this.core.eventBus.on("V2NIMSync/updateTimetag",e=>{Object.keys(e).forEach(t=>{e[t]>(this.timetags[t]||0)&&(this.timetags[t]=e[t])})})}setOptions(e){var t=this.core,n=!(!t.V2NIMConversationService.name&&!t.V2NIMLocalConversationService.name);return this.config=Object.assign({myInfo:!!t.V2NIMUserService.name,offlineMsgs:!!t.V2NIMMessageService.name,roamingMsgs:!!t.V2NIMMessageService.name,relations:!!t.V2NIMUserService.name,friends:!!t.V2NIMFriendService.name,friendUsers:!!t.V2NIMUserService.name,msgReceipts:!!t.V2NIMMessageService.name,broadcastMsgs:!!t.V2NIMNotificationService.name,recallMsg:!!t.V2NIMMessageService.name,sessionAck:n,superTeamSessionAck:n,stickTopSessions:n,superTeamRoamingMsgs:!!t.V2NIMTeamService.name,deleteSuperTeamMsg:!!t.V2NIMTeamService.name,deleteSelfMsgs:!!t.V2NIMMessageService.name,sessionHistoryMsgsDelete:!!t.V2NIMMessageService.name,avSignal:!!t.V2NIMSignallingService.name,teams:!!t.V2NIMTeamService.name,superTeams:!!t.V2NIMTeamService.name,myTeamMembers:!!t.V2NIMTeamService.name,mySuperTeamMembers:!!t.V2NIMTeamService.name,donnop:!!t.V2NIMSettingService.name,p2pTeamModifyMessage:!!t.V2NIMMessageService.name,superTeamModifyMessage:!!t.V2NIMMessageService.name},e),this.config}doBasicSync(){return __awaiter$2(this,void 0,void 0,function*(){var e=Object.keys(this.config).filter(e=>!this.teamKey.includes(e)&&this.config[e]),t=this.genSyncParams(e);this.logger.log("V2Sync:basic",t);var n=(yield this.core.clientSocket.sendCmd("v2NIMSync",{tag:t})).content.timetag;this.setTimetags(n,e.filter(e=>"broadcastMsgs"!==e)),yield this.delaySyncDone(),yield this.handleImmediate(),this.core.logger.log("sync::basic sync complete in",n)})}doTeamSync(){return __awaiter$2(this,void 0,void 0,function*(){var e=this.teamKey.filter(e=>this.config[e]);if(0!==e.length){var t=this.genSyncParams(e);this.core.eventBus.emit("V2NIMTeamService/onSyncStarted"),this.logger.log("V2Sync:team",t);var n=null;try{n=yield this.core.clientSocket.sendCmd("v2NIMSync",{tag:t})}catch(i){throw this.core.eventBus.emit("V2NIMTeamService/onSyncFailed",i),i}this.core.eventBus.emit("V2NIMTeamService/onSyncFinished");var r=n.content.timetag;this.setTimetags(r,this.teamKey),this.core.logger.log("sync::team sync complete in",r)}})}doQchatSync(){return __awaiter$2(this,void 0,void 0,function*(){var e=yield this.core.clientSocket.sendCmd("v2QChatSync",{tag:{systemNotification:0}});this.core.logger.log("sync::qchat sync complete in",e.content.timetag)})}doSync(){return __awaiter$2(this,void 0,void 0,function*(){var e=get(this.core,"V2NIMLoginService.authenticator.loginClientOfThisConnection.loginType");if(void 0!==e){if(this.logger.log(`sync::doSync:type ${e}`),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:2,subType:"mainSync"}),1===e)try{yield this.doBasicSync(),yield this.doTeamSync()}catch(t){return void this.doSyncComplete(t)}else if(2===e)try{yield this.doQchatSync()}catch(t){return void this.doSyncComplete(t)}else{if(3!==e)return;try{yield this.doBasicSync(),yield this.doTeamSync(),yield this.doQchatSync()}catch(t){return void this.doSyncComplete(t)}}this.doSyncComplete()}else this.logger.warn("sync::doSync: no loginType, stop sync")})}doSyncComplete(e){e&&this.core.logger.log("sync::doSync complete but got error",e),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:e,subType:"mainSync"})}initEventListeners(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.doSync()})}genSyncParams(e){return e.reduce((e,t)=>{var n=t;return e[n]=this.timetags[n]||0,e},{})}setTimetags(e,t){t.forEach(t=>{this.timetags[t]=e})}handleImmediate(){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),Promise.resolve()}delaySyncDone(){var{hostEnvEnum:e}=Ae.getSystemInfo();return 102===e?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new Promise(e=>{setTimeout(()=>{e()},100)})):Promise.resolve()}},"V2NIMSyncService");const preUrl="";function customNavigateTo(e){uni.navigateTo({...e,url:preUrl+e.url})}function customRedirectTo(e){uni.redirectTo({...e,url:preUrl+e.url})}function customSwitchTab(e){uni.switchTab({...e,url:preUrl+e.url})}function customReLaunch(e){uni.reLaunch({...e,url:preUrl+e.url})}const en={appText:"NIM",messageText:"Message",contactText:"Contacts",mineText:"Me",logoutText:"Log out",commsEaseText:"About NIM",logoutConfirmText:"Are you sure you want to log out?",avatarText:"Avatar",accountText:"Account",name:"Nickname",genderText:"Gender",remark:"remark",mobile:"Phone",email:"Email",sign:"Signature",man:"Male",woman:"Female",unknow:"Unknown",birthText:"Birthday",userOnlineText:"Online",userOfflineText:"Offline",updateAvatarText:"Update Avatar",updateNameText:"Update Name",FriendPageText:"Friend Card",startConversationText:"Start Chat",addText:"Add",applyFriendSuccessText:"Request Sent",applyFriendFailText:"Request Failed",addFriendText:"Add Friend",addFriendFailText:"Add Friend Failed",deleteFriendText:"Delete Friend",deleteFriendConfirmText:"Are you sure you want to delete this friend?",deleteFriendSuccessText:"Delete Friend Success",deleteFriendFailText:"Delete Friend Failed",setBlackFailText:"Add to blacklist failed",removeBlackFailText:"Remove from blacklist failed",removeBlackSuccessText:"Remove from blacklist success",addPermissionText:"Please add relevant permissions in the system settings page",FailAvatarText:"Avatar upload failed",chooseDefaultImage:"Choose default image",chatButtonText:"Go to Chat",gotoChatFailText:"Go to chat failed",chatWithFriendText:"Chat",okText:"OK",updateText:"Update",cancelText:"Cancel",friendSelectText:"Select Friend",telErrorText:"Invalid phone number format",emailErrorText:"Invalid email format",createButtonText:"Create",createP2PText:"Start Chat",createTeamText:"Create Group",addTeamMemberText:"Add Group Member",discussionMemberText:"讨论组成员",addTeamMemberFailText:"Add Group Member Failed",teamTitlePlaceholder:"Enter Group Name",maxSelectedText:"You can only select up to 200 friends",createTeamSuccessText:"Create Group Success",createTeamFailedText:"Create Group Failed",PersonalPageText:"PersonalCard",deleteSessionText:"Delete",sessionMuteText:"Mute Notifications",sessionMuteFailText:"Mute Notifications Failed",sessionUnMuteFailText:"Unmute Notifications Failed",stickTopText:"Pin Chat",deleteStickTopText:"Unpin Chat",addStickTopText:"Pin",deleteSessionFailText:"Delete Conversation Failed",deleteStickTopFailText:"Unpin Chat Failed",addStickTopFailText:"Pin Message Failed",teamMemberText:"Group Members",saveText:"Save",setText:"Settings",failText:"Failed",saveSuccessText:"Save Success",saveFailedText:"Save Failed",searchTeamPlaceholder:"Enter Group Name",teamTitle:"Group Name",discussionTitle:"Discussion Group Name",teamInfoText:"Group Information",discussionInfoText:"Discussion Group Information",teamAvatar:"Group Avatar",discussionAvatarText:"Discussion Group Avatar",networkError:"Current network error",searchFailText:"Search Failed",offlineText:"Network is unavailable, please check network settings.",connectingText:"The current IM connection has been disconnected and is reconnecting…",teamMenuText:"My Groups",teamChooseText:"My Group Chats",chooseText:"Choose",friendSelect:"Please select a contact",getHistoryMsgFailedText:"Failed to get message history",deleteText:"Delete",recallText:"Recall",copyText:"Copy",forwardText:"Forward",forwardComment:"forward comment",replyText:"Reply",replyNotFindText:"Message has recalled or deleted",forwardToTeamText:"Forward to Group",forwardToFriendText:"Forward to Contact",sessionRecordText:"Conversation Record",chatInputPlaceHolder:"What would you like to say?",enableV2CloudConversationText:"Enable V2 Cloud Conversation",SwitchToEnglishText:"Switch to English",pinText:"Mark",pinFailedText:"Mark Failed",unpinText:"Unmark",unpinFailedText:"Unmark Failed",noPinListText:"No Mark",collectionText:"Collection",deleteCollectionText:"Delete collection",addCollectionSuccessText:"Add collection success",addCollectionFailedText:"Add collection Failed",deleteCollectionFailedText:"Delete collection Failed",noCollectionsText:"No collection",teamBannedText:"Message Banned",you:"You",pinThisText:"Marked this message",delete:"Delete this message",recall:"Recalled a message",recall2:"This message has been recalled",recall3:"Recall this message",recallMsgFailText:"Recall Message Failed",reeditText:"Edit",loadingMoreText:"Loading…",noMoreText:"No more",deleteMsgSuccessText:"Delete Success",deleteMsgFailText:"Delete Failed",conversationEmptyText:"No conversation",teamOwner:"Group Owner",teamManager:"Group Manager",teamEmptyText:"NoGroup Chats",blacklistEmptyText:"No Blocked Contacts",blacklistSubTitle:"You will not get messages from anyone on the list.    ",validEmptyText:"No Verification Messages",dismissTeamText:"Dismiss Group",dismissTeamConfirmText:"Are you sure you want to dismiss this group?",leaveTeamTitle:"Leave Group",leaveDiscussionTitle:"Leave Discussion Group",leaveTeamConfirmText:"Are you sure you want to leave this group?",leaveTeamSuccessText:"You have left this group",leaveTeamFailedText:"Failed to leave this group",leaveDiscussionSuccessText:"Successfully left the discussion group",leaveDiscussionFailedText:"Failed to leave the discussion group",dismissTeamSuccessText:"Dismiss Group Success",dismissTeamFailedText:"Dismiss Group Failed",updateTeamSuccessText:"Update Success",updateTeamFailedText:"Update Failed",teamTitleConfirmText:"Group name cannot be empty",teamIntroConfirmText:"Group introduction cannot be empty",aliasConfirmText:"Alias cannot be empty",sendImageFailedText:"Failed to send Image",sendVideoFailedText:"Failed to send Video",sendAudioFailedText:"Failed to send Audio",sendFileFailedText:"Failed to send File",sendMsgFailedText:"Failed to send Message",weekText:"Weeks ago",dayText:"Days ago",hourText:"Hours ago",minuteText:"Minutes ago",nowText:"Just now",sendText:"Send",sendToText:"Send to",textMsgText:"Text Message",audioMsgText:"Audio Message",videoMsgText:"Video Message",fileMsgText:"File Message",callMsgText:"Call Message",geoMsgText:"Location Message",imgMsgText:"Image Message",notiMsgText:"Notification Message",robotMsgText:"Robot Message",tipMsgText:"Tip Message",customMsgText:"Custom Message",unknowMsgText:"Unknown Message",noFriendText:"No Friends",onDismissTeamText:"This group has been dismissed",onRemoveTeamText:"You have left the group",selectSessionFailText:"Failed to select conversation",noExistUser:"This user does not exist",enterAccount:"Enter account",validMsgText:"Verification Message",blacklistText:"Blocked Contacts",applyTeamText:"Apply to Join Group",acceptResultText:"Accepted",rejectResultText:"Rejected",rejectTeamInviteText:"Rejected group invitation",beRejectResultText:"Rejected friend request",passResultText:"Accepted friend request",acceptedText:"This request has been accepted",acceptFailedText:"Failed to accept this request",rejectedText:"This request has been rejected",rejectFailedText:"Failed to reject this request",passFriendAskText:"I have accepted your friend request, let's start chatting!",applyFriendText:"Add you as a friend",rejectText:"Reject",acceptText:"Accept",inviteTeamText:"Invite to Group",addBlacklist:"Block",removeBlacklist:"Unblock",forwardSuccessText:"Forward Success",forwardFailText:"Forward Failed",getMessageFailed:"Fail to get message",getForwardMessageFailed:"Fail to get forward message",sendFailWithInBlackText:"The Other party has blocked you, message sending failed",sendFailWithDeleteText:"The relationship between both parties has been terminated, please reapply for contact",friendVerificationText:"Friend Verification",teamAll:"all",chooseMentionText:"Choose Mention",someoneText:"someone",meText:"mention",teamMutePlaceholder:"The current group owner has set the group to mute",viewMoreText:"View More",resendMsgFailText:"Resend Failed",audioBtnText:"Press and hold to speak",audioRemindText:"Release to send",audioErrorText:"Recording failed",videoPlayText:"Video Play",voiceCallText:"Voice Call",videoCallText:"Video Call",callDurationText:"call duration",callCancelText:"canceled",callRejectedText:"rejected",callTimeoutText:"Missed call",callBusyText:"busy line",callFailedText:"call failed",wxAppFileCopyText:"Please paste the URL in the mobile browser.",shootText:"shoot",albumText:"album",msgReadPageTitleText:"Message Reading Status",readText:"Read",unreadText:"Unread",fileText:"file",allUnReadText:"All Unread",msgRecallTimeErrorText:"Message recall time exceeded",allReadText:"All Read",searchText:"Search",searchTitleText:"Search",friendText:"Friend",teamText:"Group",discussionText:"Discussion Group",searchResultNullText:"User does not exist",conversationSendFailText:"[Send Failed]",conversationNotificationText:"[Notification]",fileMsgTitleText:"[File Message]",collectionFromText:"Collection from",copySuccessText:"Copy Success",openUrlText:"Copied. Open in browser.",teamManagerText:"Team Manager",teamManagerSettingText:"Team Manager Setting",updateTeamInfoText:"Who is allowed to edit group details",teamOwnerAndManagerText:"TeamOwnerAndManager",updateTeamInviteText:"Who is allowed to invite group members",updateTeamAtText:"Who is allowed to @",addMemberText:"Add Member",removeText:"remove",securityTipText:"For test only. Beware of money transfer, lottery winnings & strange call scams.",createDiscussionText:"Create Discussion",Laugh:"[Laugh]",Happy:"[Happy]",Sexy:"[Sexy]",Cool:"[Cool]",Mischievous:"[Mischievous]",Kiss:"[Kiss]",Spit:"[Spit]",Squint:"[Squint]",Cute:"[Cute]",Grimace:"[Grimace]",Snicker:"[Snicker]",Joy:"[Joy]",Ecstasy:"[Ecstasy]",Surprise:"[Surprise]",Tears:"[Tears]",Sweat:"[Sweat]",Angle:"[Angle]",Funny:"[Funny]",Awkward:"[Awkward]",Thrill:"[Thrill]",Cry:"[Cry]",Fretting:"[Fretting]",Terrorist:"[Terrorist]",Halo:"[Halo]",Shame:"[Shame]",Sleep:"[Sleep]",Tired:"[Tired]",Mask:"[Mask]",ok:"[ok]",AllRight:"[All right]",Despise:"[Despise]",Uncomfortable:"[Uncomfortable]",Disdain:"[Disdain]",ill:"[ill]",Mad:"[Mad]",Ghost:"[Ghost]",Angry:"[Angry]",Unhappy:"[Unhappy]",Frown:"[Frown]",Broken:"[Broken]",Beckoning:"[Beckoning]",Ok:"[Ok]",Low:"[Low]",Nice:"[Nice]",Applause:"[Applause]",GoodJob:"[Good job]",Hit:"[Hit]",Please:"[Please]",Bye:"[Bye]",First:"[First]",Fist:"[Fist]",GiveMeFive:"[Give me five]",Knife:"[Knife]",Hi:"[Hi]",No:"[No]",Hold:"[Hold]",Think:"[Think]",Pig:"[Pig]",NoListen:"[No listen]",NoLook:"[No look]",NoWords:"[No words]",Monkey:"[Monkey]",Bomb:"[Bomb]",Cloud:"[Cloud]",Rocket:"[Rocket]",Ambulance:"[Ambulance]",Poop:"[Poop]",190001:"internal error",190002:"illegal state",191001:"misuse",191002:"cancelled",191003:"callback failed",191004:"invalid parameter",191005:"timeout",191006:"resource not exist",191007:"resource already exist",192001:"connect failed",192002:"connect timeout",192003:"disconnected",192004:"protocol timeout",192005:"protocol send failed",192006:"request failed",107319:"PIN limit exceeded",107320:"PIN not exist",107322:"PIN already exist",107327:"PIN function disabled",189301:"collection limit exceeded",189302:"collection not exist",189449:"collection concurrent operation failed",109432:"no permission"},zh={appText:"云信IM",messageText:"消息",contactText:"通讯录",mineText:"我的",logoutText:"退出登录",commsEaseText:"关于云信",logoutConfirmText:"确定退出登录吗?",avatarText:"头像",updateAvatarText:"修改头像",updateNameText:"修改名称",accountText:"账号",name:"昵称",genderText:"性别",remarkText:"备注名",mobile:"手机",email:"邮箱",sign:"签名",man:"男",woman:"女",unknow:"未知",birthText:"生日",userOnlineText:"在线",userOfflineText:"离线",FriendPageText:"好友名片",startConversationText:"发起单聊",addText:"添加",removeText:"移除",addTeamManagerSuccessText:"添加管理员成功",addTeamManagerFailText:"添加管理员失败",confirmRemoveText:"是否移除？",removeManagerExplain:"移除后该成员将无管理权限",removeMemberExplain:"将移除该成员",removeSuccessText:"移除成功",removeFailText:"移除失败",userNotInTeam:"该用户不在群里",noTeamManager:"暂无群管理员",noTeamMember:"暂无群成员",applyFriendSuccessText:"好友申请已发送",applyFriendFailText:"发送申请失败",addFriendText:"添加好友",addMemberText:"添加成员",addFriendFailText:"添加好友失败",deleteFriendText:"删除好友",deleteFriendConfirmText:"是否确认删除好友",deleteFriendSuccessText:"删除好友成功",deleteFriendFailText:"删除好友失败",setBlackFailText:"加入黑名单失败",removeBlackFailText:"解除黑名单失败",removeBlackSuccessText:"解除黑名单成功",addPermissionText:"请在系统设置页添加相关权限",FailAvatarText:"上传头像失败",chooseDefaultImage:"选择默认图标",chatButtonText:"去聊天",gotoChatFailText:"去聊天失败",chatWithFriendText:"聊天",okText:"确定",updateText:"修改",cancelText:"取消",friendSelectText:"选择好友",telErrorText:"手机格式不正确",emailErrorText:"邮箱格式不正确",createButtonText:"创建",createP2PText:"发起单聊",createTeamText:"创建群聊",addTeamMemberText:"添加群成员",addTeamMemberFailText:"添加群成员失败",teamTitlePlaceholder:"请输入群名称",maxSelectedText:"最多只能选择200位好友",createTeamSuccessText:"创建群组成功",createDiscussionSuccessText:"创建讨论组成功",createTeamFailedText:"创建群组失败",createDiscussionFailedText:"创建讨论组失败",PersonalPageText:"个人名片",deleteSessionText:"删除",sessionMuteText:"开启消息提醒",sessionMuteFailText:"开启消息提醒失败",sessionUnMuteFailText:"关闭消息提醒失败",stickTopText:"聊天置顶",deleteStickTopText:"取消置顶",addStickTopText:"置顶",deleteSessionFailText:"删除会话失败",deleteStickTopFailText:"取消置顶失败",addStickTopFailText:"置顶消息失败",teamMemberText:"群成员",discussionMemberText:"讨论组成员",teamManagerText:"群管理",teamManagerSettingText:"管理管理员",updateTeamInfoText:"谁可以编辑群信息",updateTeamInviteText:"谁可以邀请新成员",updateTeamAtText:"谁可以@所有人",transformTeam:"转让群主",transformTeamContent:"确认转让群主给",doubt:"吗？",transformTeamSuccessText:"转让群主成功",transformTeamFailedText:"转让群主失败",transformTeamText:"选择转让成员",teamBannedText:"群禁言",saveText:"保存",setText:"设置",failText:"失败",saveSuccessText:"保存成功",saveFailedText:"保存失败",searchTeamPlaceholder:"请输入群名称",nickInTeamEmptyText:"请输入群昵称",teamTitle:"群名称",discussionTitle:"讨论组名称",teamInfoText:"群信息",discussionInfoText:"讨论组信息",teamIntro:"群介绍",teamAvatar:"群头像",discussionAvatarText:"讨论组头像",networkError:"当前网络错误",searchFailText:"查找失败",offlineText:"当前网络不可用，请检查你当前网络设置。",connectingText:"当前IM连接已断开，正在重连...",teamMenuText:"我的群组",teamChooseText:"我的群聊",chooseText:"选择",friendSelect:"请选择联系人",pleaseSelectMember:"请选择成员",teamMemebrSelect:"人员选择",getHistoryMsgFailedText:"获取失败",deleteText:"删除",recallText:"撤回",copyText:"复制",forwardText:"转发",forwardComment:"留言",forwardSuccessText:"转发成功",forwardFailedText:"转发失败",getMessageFailed:"获取消息失败",replyText:"回复",replyNotFindText:"该消息已撤回或删除",msgRecallTimeErrorText:"已超过时间无法撤回",enableV2CloudConversationText:"是否开启云端会话",SwitchToEnglish:"切换语言为英文",copySuccessText:"复制成功",forwardToTeamText:"转发到群组",forwardToFriendText:"转发到个人",sessionRecordText:"的会话记录",chatInputPlaceHolder:"说点什么呢~",pinText:"标记",pinFailedText:"标记失败",unpinText:"取消标记",unpinFailedText:"取消标记失败",noPinListText:"暂无标记消息",collectionText:"收藏",deleteCollectionText:"删除收藏",addCollectionSuccessText:"收藏成功",addCollectionFailedText:"添加收藏失败",deleteCollectionFailedText:"删除收藏失败",noCollectionsText:"暂无收藏",you:"你",pinThisText:"标记了这条消息",delete:"删除此消息",recall:"撤回了一条消息",recall2:"此消息已撤回",recall3:"撤回此消息",recallMsgFailText:"撤回消息失败",reeditText:"重新编辑",loadingMoreText:"加载更多……",noMoreText:"没有更多了",deleteMsgSuccessText:"删除成功",deleteMsgFailText:"删除失败",conversationEmptyText:"暂无会话",teamOwner:"群主",teamManager:"群管理员",manager:"管理员",teamEmptyText:"暂无群聊",blacklistEmptyText:"暂无黑名单",blacklistSubTitle:"你不会收到列表中任何联系人的消息",validEmptyText:"暂无验证消息",dismissTeamText:"解散群组",dismissTeamConfirmText:"是否确认解散该群组",leaveTeamTitle:"退出群聊",leaveDiscussionTitle:"退出讨论组",leaveTeamConfirmText:"是否确认退出该群组",leaveDiscussionConfirmText:"是否确认退出该讨论组",leaveTeamSuccessText:"已成功退出此群",leaveDiscussionSuccessText:"已成功退出此讨论组",leaveTeamFailedText:"退出此群失败",leaveDiscussionFailedText:"退出此讨论组失败",dismissTeamSuccessText:"群解散成功",dismissTeamFailedText:"群解散失败",updateTeamSuccessText:"修改成功",updateTeamFailedText:"修改失败",teamTitleConfirmText:"群名称不能为空",teamIntroConfirmText:"群介绍不能为空",aliasConfirmText:"备注名不能为空",sendImageFailedText:"发送图片失败",sendVideoFailedText:"发送视频失败",sendAudioFailedText:"发送音频失败",sendFileFailedText:"发送文件失败",sendMsgFailedText:"发送消息失败",weekText:"周前",dayText:"天前",hourText:"小时前",minuteText:"分钟前",nowText:"刚刚",sendText:"发送",sendToText:"发送给",textMsgText:"文本消息",audioMsgText:"音频消息",videoMsgText:"视频消息",fileMsgText:"文件消息",callMsgText:"话单消息",geoMsgText:"地理位置消息",imgMsgText:"图片消息",notiMsgText:"通知消息",robotMsgText:"机器消息",tipMsgText:"提示消息",customMsgText:"自定义消息",unknowMsgText:"未知消息体",noFriendText:"暂无好友",onDismissTeamText:"该群聊已解散",onRemoveTeamText:"您已离开群组",selectSessionFailText:"选择会话失败",noExistUser:"该用户不存在",enterAccount:"请输入账号",validMsgText:"验证消息",blacklistText:"黑名单",applyTeamText:"申请入群",acceptResultText:"已同意",rejectResultText:"已拒绝",rejectTeamInviteText:"拒绝了群邀请",beRejectResultText:"拒绝了好友申请",passResultText:"通过了好友申请",acceptedText:"已同意该申请",acceptFailedText:"同意该申请失败",rejectedText:"已拒绝该申请",rejectFailedText:"拒绝该申请失败",passFriendAskText:"我已经同意了你的申请，现在开始聊天吧~",applyFriendText:"添加您为好友",rejectText:"拒绝",acceptText:"同意",inviteTeamText:"邀请入群",addBlacklist:"加入黑名单",removeBlacklist:"解除",teamAll:"所有人",sendFailWithInBlackText:"对方已将你拉黑，消息发送失败",sendFailWithDeleteText:"双方关系已解除，如需沟通，请申请",friendVerificationText:"好友验证",chooseMentionText:"选择提醒",someoneText:"有人",meText:"我",teamMutePlaceholder:"当前群主已经设置为群禁言",noPermission:"您暂无权限操作",muteAllTeamFailedText:"全员禁言失败",unmuteAllTeamFailedText:"解除全员禁言失败",nickInTeam:"我在群里的昵称",viewMoreText:"查看更多",resendMsgFailText:"重发失败",audioBtnText:"按住说话",audioRemindText:"松开发送",audioErrorText:"录音失败，请检查是否开启权限",videoPlayText:"视频播放",updateTeamAvatar:"更新了群头像",updateTeamName:"更新群名称为",updateTeamIntro:"更新了群介绍",updateTeamInviteMode:"更新了群权限“邀请他人权限”为",updateTeamUpdateTeamMode:"更新了群权限“群资料修改权限”为",updateAllowAt:"更新了“@所有人权限”为",updateTeamMute:"更新了“群禁言”为",onlyTeamOwner:"仅群主",teamOwnerAndManagerText:"群主和管理员",closeText:"关闭",openText:"开启",joinTeamText:"加入群组",leaveTeamText:"离开了群组",beRemoveTeamText:"被移出群组",beAddTeamManagersText:"被任命为管理员",beRemoveTeamManagersText:"被移除管理员",newGroupOwnerText:"成为新群主",callDurationText:"通话时长",callCancelText:"已取消",callRejectedText:"已拒绝",callTimeoutText:"超时未接听",callBusyText:"忙线未接听",callFailedText:"呼叫失败",wxAppFileCopyText:"已自动复制网址，请在手机浏览器里粘贴该网址",shootText:"拍摄",albumText:"相册",voiceCallText:"语音通话",videoCallText:"视频通话",msgReadPageTitleText:"消息阅读状态",readText:"已读",unreadText:"未读",fileText:"文件",allUnReadText:"全部成员未读",allReadText:"全部成员已读",searchText:"请输入你要搜索的关键字",searchTitleText:"搜索",friendText:"好友",teamText:"群组",discussionText:"讨论组",searchResultNullText:"该用户不存在",conversationSendFailText:"[发送失败]",conversationNotificationText:"[通知消息]",getForwardMessageFailed:"该消息已撤回或删除",fileMsgTitleText:"[文件消息]",collectionFromText:"来自",openUrlText:"已复制链接，请在浏览器打开链接",SwitchToEnglishText:"是否切换为英文",securityTipText:"仅用于体验云信IM 产品功能，请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。",createDiscussionText:"创建讨论组",Laugh:"[大笑]",Happy:"[开心]",Sexy:"[色]",Cool:"[酷]",Mischievous:"[奸笑]",Kiss:"[亲]",Spit:"[伸舌头]",Squint:"[眯眼]",Cute:"[可爱]",Grimace:"[鬼脸]",Snicker:"[偷笑]",Joy:"[喜悦]",Ecstasy:"[狂喜]",Surprise:"[惊讶]",Tears:"[流泪]",Sweat:"[流汗]",Angle:"[天使]",Funny:"[笑哭]",Awkward:"[尴尬]",Thrill:"[惊恐]",Cry:"[大哭]",Fretting:"[烦躁]",Terrorist:"[恐怖]",Halo:"[两眼冒星]",Shame:"[害羞]",Sleep:"[睡着]",Tired:"[冒星]",Mask:"[口罩]",ok:"[OK]",AllRight:"[好吧]",Despise:"[鄙视]",Uncomfortable:"[难受]",Disdain:"[不屑]",ill:"[不舒服]",Mad:"[愤怒]",Ghost:"[鬼怪]",Angry:"[发怒]",Unhappy:"[不高兴]",Frown:"[皱眉]",Broken:"[心碎]",Beckoning:"[心动]",Ok:"[好的]",Low:"[低级]",Nice:"[赞]",Applause:"[鼓掌]",GoodJob:"[给力]",Hit:"[打你]",Please:"[阿弥陀佛]",Bye:"[拜拜]",First:"[第一]",Fist:"[拳头]",GiveMeFive:"[手掌]",Knife:"[剪刀]",Hi:"[招手]",No:"[不要]",Hold:"[举着]",Think:"[思考]",Pig:"[猪头]",NoListen:"[不听]",NoLook:"[不看]",NoWords:"[不说]",Monkey:"[猴子]",Bomb:"[炸弹]",Cloud:"[筋斗云]",Rocket:"[火箭]",Ambulance:"[救护车]",Poop:"[便便]",190001:"内部错误",190002:"非法状态",191001:"使用姿势错误",191002:"操作取消",191003:"回调失败",191004:"参数错误",191005:"请求超时",191006:"资源不存在",191007:"资源已存在",192001:"连接错误",192002:"连接超时",192003:"连接断开",192004:"协议超时",192005:"协议发送失败",192006:"请求失败",107319:"PIN 数量超限",107320:"PIN 消息不存在",107322:"重复 PIN",107327:"未开启 PIN 功能",189301:"收藏数量超限",189302:"收藏不存在",189449:"并发操作收藏失败",109432:"没有权限"},i18nData={en:en,zh:zh};let currentLanguage="zh";function setLanguage(e){currentLanguage=e}const t=e=>i18nData[currentLanguage][e]||e,events={SEND_MSG:"sendMsg",SEND_MSG_FAILED:"sendMsgFailed",ON_MSG:"onMsg",ON_LOAD_MORE:"onLoadMore",ON_CHAT_MOUNTED:"onChatMounted",ON_REEDIT_MSG:"onReEditMsg",ON_REACH_BOTTOM:"onReachBottom",ON_REACH_TOP:"onReactTop",REPLY_MSG:"replyMsg",ON_INPUT_FOCUS_CHANGE:"onInputFocusChange",ON_INPUT_BLUR:"onInputBlur",ON_SCROLL_BOTTOM:"onScrollBottom",AIT_TEAM_MEMBER:"aitTeamMember",EMOJI_AREA_CHANGE:"emojiAreaChange",GET_HISTORY_MSG:"getHistoryMsg",CANCEL_FORWARD_MSG:"cancelForwardMsg",CONFIRM_FORWARD_MSG:"confirmForwardMsg",HANDLE_AIT_MEMBER:"handleAitMember",CLOSE_AIT_POPUP:"closeAitPopup",EMOJI_CLICK:"emojiClick",EMOJI_DELETE:"emojiDelete",EMOJI_SEND:"emojiSend",FRIEND_SELECT:"friendSelect",HANDLE_MOVE_THROUGH:"handleMoveThrough",CLOSE_PANEL:"closePanel",AUDIO_URL_CHANGE:"audioUrlChange"},HISTORY_LIMIT$1=15,MSG_ID_FLAG="message-item-",AT_ALL_ACCOUNT$1="ait_all",ALLOW_AT="yxAllowAt",REPLY_MSG_TYPE_MAP={[Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE]:t("imgMsgText"),[Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO]:t("audioMsgText"),[Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO]:t("videoMsgText"),[Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE]:t("fileMsgText")},STORAGE_KEY="__yx_im_options__",g2StatusMap={1:t("callDurationText"),2:t("callCancelText"),3:t("callRejectedText"),4:t("callTimeoutText"),5:t("callBusyText")},msgRecallTime=12e4,getUniPlatform=()=>uni.getSystemInfoSync().uniPlatform,isAndroidApp="android"==uni.getSystemInfoSync().platform&&"app"==uni.getSystemInfoSync().uniPlatform;"ios"==uni.getSystemInfoSync().platform&&uni.getSystemInfoSync().uniPlatform;const isHarmonyOs="harmonyos"==uni.getSystemInfoSync().platform&&"app"===uni.getSystemInfoSync().uniPlatform,isAndroidOrIosApp="app"==uni.getSystemInfoSync().uniPlatform&&("android"==uni.getSystemInfoSync().platform||"ios"==uni.getSystemInfoSync().platform),isIosWeb="web"===uni.getSystemInfoSync().uniPlatform&&"ios"===uni.getSystemInfoSync().platform;uni.getSystemInfoSync().uniPlatform;const isWxApp="mp-weixin"==uni.getSystemInfoSync().uniPlatform,isWeb="web"===uni.getSystemInfoSync().uniPlatform;function stopAllAudio(){uni.$emit(events.AUDIO_URL_CHANGE,"")}const convertSecondsToTime=e=>{if(!e)return null;const t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),r=e-3600*t-60*n;let i="";return e>=3600&&(t<10&&(i+="0"),i+=t.toString()+":"),n<10&&(i+="0"),i+=n.toString()+":",r<10&&(i+="0"),i+=r.toString(),i},startCall=e=>{try{console.log(uni.$UIKitCallKit),uni.$UIKitCallKit.toCallPage({calledAccount:e.remoteUserAccid,type:e.type,calledShowName:e.remoteShowName},()=>{console.log("toCallPage: ",{remoteUserAccid:e.remoteUserAccid,currentUserAccid:e.currentUserAccid,type:e.type,remoteShowName:e.remoteShowName})})}catch(t){console.log("handleVideoCall error",t)}},EMOJI_ICON_MAP_CONFIG={"[大笑]":"icon-a-1","[开心]":"icon-a-2","[色]":"icon-a-3","[酷]":"icon-a-4","[奸笑]":"icon-a-5","[亲]":"icon-a-6","[伸舌头]":"icon-a-7","[眯眼]":"icon-a-8","[可爱]":"icon-a-9","[鬼脸]":"icon-a-10","[偷笑]":"icon-a-11","[喜悦]":"icon-a-12","[狂喜]":"icon-a-13","[惊讶]":"icon-a-14","[流泪]":"icon-a-15","[流汗]":"icon-a-16","[天使]":"icon-a-17","[笑哭]":"icon-a-18","[尴尬]":"icon-a-19","[惊恐]":"icon-a-20","[大哭]":"icon-a-21","[烦躁]":"icon-a-22","[恐怖]":"icon-a-23","[两眼冒星]":"icon-a-24","[害羞]":"icon-a-25","[睡着]":"icon-a-26","[冒星]":"icon-a-27","[口罩]":"icon-a-28","[OK]":"icon-a-29","[好吧]":"icon-a-30","[鄙视]":"icon-a-31","[难受]":"icon-a-32","[不屑]":"icon-a-33","[不舒服]":"icon-a-34","[愤怒]":"icon-a-35","[鬼怪]":"icon-a-36","[发怒]":"icon-a-37","[生气]":"icon-a-38","[不高兴]":"icon-a-39","[皱眉]":"icon-a-40","[心碎]":"icon-a-41","[心动]":"icon-a-42","[好的]":"icon-a-43","[低级]":"icon-a-44","[赞]":"icon-a-45","[鼓掌]":"icon-a-46","[给力]":"icon-a-47","[打你]":"icon-a-48","[阿弥陀佛]":"icon-a-49","[拜拜]":"icon-a-50","[第一]":"icon-a-51","[拳头]":"icon-a-52","[手掌]":"icon-a-53","[剪刀]":"icon-a-54","[招手]":"icon-a-55","[不要]":"icon-a-56","[举着]":"icon-a-57","[思考]":"icon-a-58","[猪头]":"icon-a-59","[不听]":"icon-a-60","[不看]":"icon-a-61","[不说]":"icon-a-62","[猴子]":"icon-a-63","[炸弹]":"icon-a-64","[睡觉]":"icon-a-65","[筋斗云]":"icon-a-66","[火箭]":"icon-a-67","[救护车]":"icon-a-68","[便便]":"icon-a-70"};function replaceEmoji(e,t){const n=t||{"[Laugh]":"[大笑]","[Happy]":"[开心]","[Sexy]":"[色]","[Cool]":"[酷]","[Mischievous]":"[奸笑]","[Kiss]":"[亲]","[Spit]":"[伸舌头]","[Squint]":"[眯眼]","[Cute]":"[可爱]","[Grimace]":"[鬼脸]","[Snicker]":"[偷笑]","[Joy]":"[喜悦]","[Ecstasy]":"[狂喜]","[Surprise]":"[惊讶]","[Tears]":"[流泪]","[Sweat]":"[流汗]","[Angle]":"[天使]","[Funny]":"[笑哭]","[Awkward]":"[尴尬]","[Thrill]":"[惊恐]","[Cry]":"[大哭]","[Fretting]":"[烦躁]","[Terrorist]":"[恐怖]","[Halo]":"[两眼冒星]","[Shame]":"[害羞]","[Sleep]":"[睡着]","[Tired]":"[睡觉]","[Mask]":"[口罩]","[Ok]":"[OK]","[All right]":"[好吧]","[Despise]":"[鄙视]","[Uncomfortable]":"[难受]","[Disdain]":"[不屑]","[ill]":"[不舒服]","[Mad]":"[愤怒]","[Ghost]":"[鬼怪]","[Huff]":"[发怒]","[Angry]":"[生气]","[Unhappy]":"[不高兴]","[Frown]":"[皱眉]","[Broken]":"[心碎]","[Beckoning]":"[心动]","[Low]":"[低级]","[Nice]":"[赞]","[Applause]":"[鼓掌]","[Good job]":"[给力]","[Hit]":"[打你]","[Please]":"[阿弥陀佛]","[Bye]":"[拜拜]","[First]":"[第一]","[Fist]":"[拳头]","[Give me five]":"[招手]","[Knife]":"[剪刀]","[Hi]":"[招手]","[No]":"[不要]","[Hold]":"[举着]","[Think]":"[思考]","[Pig]":"[猪头]","[No listen]":"[不听]","[No look]":"[不看]","[No words]":"[不说]","[Monkey]":"[猴子]","[Bomb]":"[炸弹]","[Sleeping]":"[睡觉]","[Cloud]":"[筋斗云]","[Rocket]":"[火箭]","[Ambulance]":"[救护车]","[Poop]":"[便便]"},r=new RegExp("("+Object.keys(n).map(e=>{const t=`\\${e.slice(0,1)}`,n=`\\${e.slice(-1)}`;return`${t}${e.slice(1,-1)}${n}`}).join("|")+")","g");return e.replace(r,function(e){return n[e]})}new RegExp("("+Object.keys(EMOJI_ICON_MAP_CONFIG).map(e=>{const t=`\\${e.slice(0,1)}`,n=`\\${e.slice(-1)}`;return`${t}${e.slice(1,-1)}${n}`}).join("|")+")","g");const isDiscussionFunc=e=>{try{return JSON.parse(e||"{}").im_ui_kit_group}catch(t){return console.warn("parse serverExtension error",t),!1}};var commonjsGlobal$1="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var NIM_UNIAPP_SDK={exports:{}};!function(e){function t(e){var t={exports:{}};return e(t,t.exports),t.exports}var n,r,i,o,s,a,c,l,d,u,p,h,g,m,f,v,y,_,I,T,S,E,M,b,C,A,O,R,N,w,P,k,L,x,V,D,U,$,B,F,j,q,G,H,W,z,K,Y,J,X,Q,Z,ee,te,ne,re,ie,oe=t(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,o||e,s),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var c,l,d=this._events[a],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,i),!0;case 5:return d.fn.call(d.context,t,r,i,o),!0;case 6:return d.fn.call(d.context,t,r,i,o,s),!0}for(l=1,c=new Array(u-1);l<u;l++)c[l-1]=arguments[l];d.fn.apply(d.context,c)}else{var p,h=d.length;for(l=0;l<h;l++)switch(d[l].once&&this.removeListener(e,d[l].fn,void 0,!0),u){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,t);break;case 3:d[l].fn.call(d[l].context,t,r);break;case 4:d[l].fn.call(d[l].context,t,r,i);break;default:if(!c)for(p=1,c=new Array(u-1);p<u;p++)c[p-1]=arguments[p];d[l].fn.apply(d[l].context,c)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var c=0,l=[],d=a.length;c<d;c++)(a[c].fn!==t||i&&!a[c].once||r&&a[c].context!==r)&&l.push(a[c]);l.length?this._events[o]=1===l.length?l[0]:l:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a}),se=t(function(e,t){e.exports=function(){function e(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
e=function(){return t};var t={},n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(A){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,o=Object.create(i.prototype),s=new M(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return C()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=T(s,n);if(a){if(a===u)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,s),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}t.wrap=l;var u={};function p(){}function h(){}function g(){}var m={};c(m,o,function(){return this});var f=Object.getPrototypeOf,v=f&&f(f(b([])));v&&v!==n&&r.call(v,o)&&(m=v);var y=g.prototype=p.prototype=Object.create(m);function _(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function I(e,t){function n(i,o,s,a){var c=d(e[i],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then(function(e){n("next",e,s,a)},function(e){n("throw",e,s,a)}):t.resolve(u).then(function(e){l.value=e,s(l)},function(e){return n("throw",e,s,a)})}a(c.arg)}var i;this._invoke=function(e,r){function o(){return new t(function(t,i){n(e,r,t,i)})}return i=i?i.then(o,o):o()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=d(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function b(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:C}}function C(){return{value:void 0,done:!0}}return h.prototype=g,c(y,"constructor",g),c(g,"constructor",h),h.displayName=c(g,a,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},t.awrap=function(e){return{__await:e}},_(I.prototype),c(I.prototype,s,function(){return this}),t.AsyncIterator=I,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var s=new I(l(e,n,r,i),o);return t.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})},_(y),c(y,a,"Generator"),c(y,o,function(){return this}),c(y,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=b,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:b(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){e.done?n(e.value):i(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())})}var s={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:72e5},a=12,c=8e3,l=function(){},d=function(){function r(e){n(this,r),this.isUploadEnable=!0,this.serverAllowUpload=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=s,this.configPath="dispatcher/req",this.dataReportPath="statics/report/common/form",this.traceMsgCache={},this.reqRetryCount=0,this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Date.now(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(e),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return i(r,[{key:"setConfig",value:function(e){var t=Object.assign({},this.reportConfig.common,e.common);this.reportConfig=Object.assign({},this.reportConfig,e),this.reportConfig.common=t,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function(e,t){var n=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(e,Object.assign({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},t)).catch(function(e){var t,r;null===(r=null===(t=n.reportConfig)||void 0===t?void 0:t.logger)||void 0===r||r.warn("Reporter immediately upload failed",e)})}},{key:"report",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.priority||(n.priority=this.getEventPriority(e,t)),this.reportConfig.isDataReportEnable&&e){if("login"===e&&!1===t.succeed&&t.process_id){var r=t.extension&&t.extension.find(function(e){return"TCP"===e.operation_type}),i=r&&r.target||"",o=t.process_id+i,a=this.lastFailLogin[o]||0;if(t.start_time-a<s.loginFailIgnoreInterval)return;this.lastFailLogin[o]=t.start_time}var c=Date.now();"HIGH"===n.priority?this.highPriorityMsgList.push({module:e,msg:t,createTime:c}):"NORMAL"===n.priority?this.msgList.push({module:e,msg:t,createTime:c}):"LOW"===n.priority&&this.lowPriorityMsgList.push({module:e,msg:t,createTime:c}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(e,t){if(this.reportConfig.isDataReportEnable&&e&&!this.traceMsgCache[e]){var n=Object.assign(Object.assign({start_time:Date.now()},t),{extension:[]});this.traceMsgCache[e]=n}}},{key:"reportTraceUpdate",value:function(e){}},{key:"reportTraceUpdateV2",value:function(e,t,n){var r,i=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e]){var o=this.traceMsgCache[e].extension,s=o.length,a=(new Date).getTime();0===s?t.duration=a-this.traceMsgCache[e].start_time:o[s-1].end_time?t.duration=a-o[s-1].end_time:t.duration=a-this.traceMsgCache[e].start_time,o.push(Object.assign({end_time:a},t));var c=o.length-1;(null==n?void 0:n.asyncParams)&&((r=this.traceMsgCache[e]).asyncPromiseArray||(r.asyncPromiseArray=[]),this.traceMsgCache[e].asyncPromiseArray.push(n.asyncParams.then(function(t){i.traceMsgCache[e]&&i.traceMsgCache[e].extension[c]&&Object.assign(i.traceMsgCache[e].extension[c],t)})))}}},{key:"reportTraceEnd",value:function(e){var t,n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e])if("nos"!==e||!1===r){"boolean"==typeof r?this.traceMsgCache[e].succeed=!!r:this.traceMsgCache[e].state=r,this.traceMsgCache[e].duration=Date.now()-this.traceMsgCache[e].start_time,this.traceMsgCache[e].extension.forEach(function(e){delete e.end_time});var i=this.traceMsgCache[e];if(this.traceMsgCache[e]=null,i.asyncPromiseArray){(t=this.endedAsyncMsgByModule)[e]||(t[e]=[]),this.endedAsyncMsgByModule[e].push(i);var o=function(){n.endedAsyncMsgByModule[e]&&n.endedAsyncMsgByModule[e].includes(i)&&(delete i.asyncPromiseArray,n.report(e,i,{priority:n.getEventPriority(e,i)}))};Promise.all(i.asyncPromiseArray).then(o).catch(o)}else this.report(e,i,{priority:this.getEventPriority(e,i)})}else this.traceMsgCache[e]=null}},{key:"getEventPriority",value:function(e,t){if("exceptions"===e){if(0===t.action)return"HIGH";if(2===t.action)return"HIGH";if(1===t.action&&0!==t.exception_service)return"HIGH"}else{if("msgReceive"===e)return"LOW";if("nim_api_trace"===e)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function(e){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[e]=[],this.traceMsgCache[e]=null)}},{key:"pause",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function(){var e=this;this.reportConfig.isDataReportEnable&&(Object.keys(this.traceMsgCache).forEach(function(t){e.reportTraceEnd(t,1)}),null!==this.timer&&clearTimeout(this.timer),this.setConfig=l,this.report=l,this.reportTraceStart=l,this.reportTraceUpdate=l,this.reportTraceEnd=l,this.pause=l,this.restore=l,this.destroy=l,this.reqRetryCount=0,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function(){var n,r;return o(this,void 0,void 0,e().mark(function i(){var o,s,l,d,u,p=this;return e().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this.loading){i.next=2;break}return i.abrupt("return");case 2:this.loading=!0,o=this.reportConfig.common||{},s=this.reportConfig.compassDataEndpoint.split(",").map(function(e){return"".concat(e,"/").concat(p.configPath)}),l=e().mark(function t(i){return e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!p.initConfigLoaded&&!p.isDestroyed){e.next=2;break}return e.abrupt("return","break");case 2:return e.prev=2,e.next=5,p.reportConfig.request(s[i],{method:"GET",dataType:"json",params:{deviceId:o.dev_id,sdkVer:o.sdk_ver,platform:o.platform,hostEnv:o.host_env,appkey:o.app_key},timeout:p.reportConfig.timeout}).then(function(e){var t,n;if(!p.isDestroyed){if(200===e.status&&e.data&&200===e.data.code){p.initConfigLoaded=!0;var r=e.data.data||{};p.reportConfig.maxSize=r.maxSize>1e3?1e3:r.maxSize,p.reportConfig.maxInterval=r.maxInterval>1e4?1e4:r.maxInterval,p.reportConfig.maxInterval=r.maxInterval<10?10:r.maxInterval,p.reportConfig.minInterval=r.minInterval<2?2:r.minInterval,p.reportConfig.maxDelay=r.maxDelay||300,p.reportConfig.maxInterval=1e3*p.reportConfig.maxInterval,p.reportConfig.minInterval=1e3*p.reportConfig.minInterval,p.reportConfig.maxDelay=1e3*p.reportConfig.maxDelay,r.endpoint?p.dataReportEndpoint=r.endpoint:p.dataReportEndpoint=s[i],p.serverAllowUpload=!0,p.loading=!1,p.reportHeartBeat()}else 200===e.status&&(p.initConfigLoaded=!0);null===(n=null===(t=p.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.log("Get reporter upload config success")}}).catch(function(e){var t,n;p.isDestroyed||(p.loading=!1,null===(n=null===(t=p.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.error("Get reporter upload config failed",e),p.reqRetryCount<a&&(p.reqRetryCount++,setTimeout(function(){p.isDestroyed||p.initUploadConfig()},c)))});case 5:e.next=14;break;case 7:if(e.prev=7,e.t0=e.catch(2),!p.isDestroyed){e.next=11;break}return e.abrupt("return",{v:void 0});case 11:p.loading=!1,null===(r=null===(n=p.reportConfig)||void 0===n?void 0:n.logger)||void 0===r||r.error("Exec reporter request failed",e.t0),p.reqRetryCount<a&&(p.reqRetryCount++,setTimeout(function(){p.isDestroyed||p.initUploadConfig()},c));case 14:case"end":return e.stop()}},t,null,[[2,7]])}),d=0;case 7:if(!(d<s.length)){i.next=17;break}return i.delegateYield(l(d),"t0",9);case 9:if("break"!==(u=i.t0)){i.next=12;break}return i.abrupt("break",17);case 12:if("object"!==t(u)){i.next=14;break}return i.abrupt("return",u.v);case 14:d++,i.next=7;break;case 17:case"end":return i.stop()}},i,this)}))}},{key:"reportHeartBeat",value:function(){var e=this;this.isDestroyed||(this.timer=setTimeout(function(){e.reportHeartBeat()},this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function(){if(!this.isDestroyed){var e=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Date.now()-this.lastReportTime>=e&&this.upload()}}},{key:"getUploadMsg",value:function(){var e=this,t={},n=Date.now();this.highPriorityMsgList=this.highPriorityMsgList.filter(function(t){return n-t.createTime<e.reportConfig.maxDelay}),this.msgList=this.msgList.filter(function(t){return n-t.createTime<e.reportConfig.maxDelay}),this.lowPriorityMsgList=this.lowPriorityMsgList.filter(function(t){return n-t.createTime<e.reportConfig.maxDelay}),this.cacheMsgList=this.cacheMsgList.filter(function(t){return n-t.createTime<e.reportConfig.maxDelay});var r=this.highPriorityMsgList.slice(0,this.reportConfig.maxSize);if(this.highPriorityMsgList=this.highPriorityMsgList.slice(r.length),r.length<this.reportConfig.maxSize){var i=this.reportConfig.maxSize-r.length;r=r.concat(this.msgList.slice(0,i)),this.msgList=this.msgList.slice(i)}if(r.length<this.reportConfig.maxSize){var o=this.reportConfig.maxSize-r.length;r=r.concat(this.lowPriorityMsgList.slice(0,o)),this.lowPriorityMsgList=this.lowPriorityMsgList.slice(o)}if(r.length<this.reportConfig.maxSize){var s=this.reportConfig.maxSize-r.length;r=r.concat(this.cacheMsgList.slice(0,s)),this.cacheMsgList=this.cacheMsgList.slice(s)}return r.forEach(function(e){t[e.module]?t[e.module].push(e.msg):t[e.module]=[e.msg]}),{uploadMsgArr:r,uploadMsg:t}}},{key:"upload",value:function(){var e,t,n=this;if(this.isUploadEnable&&this.serverAllowUpload&&!(this.lastReportTime&&Date.now()-this.lastReportTime<this.reportConfig.minInterval)){var r=this.getUploadMsg(),i=r.uploadMsgArr,o=r.uploadMsg;if(i.length){this.lastReportTime=Date.now();try{var s="".concat(this.dataReportEndpoint,"/").concat(this.dataReportPath);this.reportConfig.request(s,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:o},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch(function(e){var t,r;n.cacheMsgList=n.cacheMsgList.concat(i).slice(0,n.reportConfig.cacheMaxSize),null===(r=null===(t=n.reportConfig)||void 0===t?void 0:t.logger)||void 0===r||r.warn("Reporter upload failed",e)})}catch(a){null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.warn("Exec reporter request failed",a)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),r}();return d}()});(ie=n||(n={}))[ie.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",ie[ie.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC",function(e){e[e.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",e[e.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",e[e.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(r||(r={})),function(e){e[e.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",e[e.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",e[e.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(i||(i={})),function(e){e[e.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",e[e.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",e[e.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",e[e.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(o||(o={})),function(e){e[e.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",e[e.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",e[e.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(s||(s={})),function(e){e[e.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",e[e.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(a||(a={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(c||(c={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(l||(l={})),function(e){e[e.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",e[e.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(d||(d={})),function(e){e[e.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",e[e.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",e[e.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",e[e.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(u||(u={})),function(e){e[e.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",e[e.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",e[e.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(p||(p={})),function(e){e[e.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",e[e.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",e[e.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",e[e.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(h||(h={})),function(e){e[e.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",e[e.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",e[e.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",e[e.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",e[e.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",e[e.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",e[e.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",e[e.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",e[e.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(g||(g={})),function(e){e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",e[e.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(m||(m={})),function(e){e[e.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(f||(f={})),function(e){e[e.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",e[e.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(v||(v={})),function(e){e[e.NIM_MESSAGE_AI_STREAM_STATUS_STREAMING=-1]="NIM_MESSAGE_AI_STREAM_STATUS_STREAMING",e[e.NIM_MESSAGE_AI_STREAM_STATUS_NONE=0]="NIM_MESSAGE_AI_STREAM_STATUS_NONE",e[e.NIM_MESSAGE_AI_STREAM_STATUS_PLACEHOLDER=1]="NIM_MESSAGE_AI_STREAM_STATUS_PLACEHOLDER",e[e.NIM_MESSAGE_AI_STREAM_STATUS_CANCEL=2]="NIM_MESSAGE_AI_STREAM_STATUS_CANCEL",e[e.NIM_MESSAGE_AI_STREAM_STATUS_UPDATE=3]="NIM_MESSAGE_AI_STREAM_STATUS_UPDATE",e[e.NIM_MESSAGE_AI_STREAM_STATUS_COMPLETE=4]="NIM_MESSAGE_AI_STREAM_STATUS_COMPLETE",e[e.NIM_MESSAGE_AI_STREAM_STATUS_EXCEPTION=5]="NIM_MESSAGE_AI_STREAM_STATUS_EXCEPTION"}(y||(y={})),function(e){e[e.V2NIM_MESSAGE_AI_STREAM_STOP_OP_DEFAULT=0]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_DEFAULT",e[e.V2NIM_MESSAGE_AI_STREAM_STOP_OP_REVOKE=1]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_REVOKE",e[e.V2NIM_MESSAGE_AI_STREAM_STOP_OP_UPDATE=2]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_UPDATE"}(_||(_={})),function(e){e[e.V2NIM_MESSAGE_AI_REGEN_OP_UPDATE=1]="V2NIM_MESSAGE_AI_REGEN_OP_UPDATE",e[e.V2NIM_MESSAGE_AI_REGEN_OP_NEW=2]="V2NIM_MESSAGE_AI_REGEN_OP_NEW"}(I||(I={})),function(e){e[e.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",e[e.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",e[e.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}(T||(T={})),function(e){e[e.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",e[e.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",e[e.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",e[e.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",e[e.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",e[e.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",e[e.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",e[e.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",e[e.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",e[e.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",e[e.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",e[e.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",e[e.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(S||(S={})),function(e){e[e.V2NIM_SEARCH_KEYWORD_MATCH_TYPE_OR=0]="V2NIM_SEARCH_KEYWORD_MATCH_TYPE_OR",e[e.V2NIM_SEARCH_KEYWORD_MATCH_TYPE_AND=1]="V2NIM_SEARCH_KEYWORD_MATCH_TYPE_AND"}(E||(E={})),function(e){e[e.V2NIM_SEARCH_DIRECTION_BACKWARD=0]="V2NIM_SEARCH_DIRECTION_BACKWARD",e[e.V2NIM_SEARCH_DIRECTION_FORWARD=1]="V2NIM_SEARCH_DIRECTION_FORWARD"}(M||(M={})),function(e){e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(b||(b={})),function(e){e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(C||(C={})),function(e){e[e.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",e[e.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",e[e.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(A||(A={})),function(e){e[e.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",e[e.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(O||(O={})),function(e){e[e.V2NIM_CLEAR_HISTORY_MODE_ALL=0]="V2NIM_CLEAR_HISTORY_MODE_ALL",e[e.V2NIM_CLEAR_HISTORY_MODE_LOCAL=1]="V2NIM_CLEAR_HISTORY_MODE_LOCAL",e[e.V2NIM_CLEAR_HISTORY_MODE_LOCAL_IRREPARABLY=2]="V2NIM_CLEAR_HISTORY_MODE_LOCAL_IRREPARABLY"}(R||(R={})),function(e){e[e.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(N||(N={})),function(e){e[e.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(w||(w={})),function(e){e[e.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",e[e.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(P||(P={})),function(e){e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(k||(k={})),function(e){e[e.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",e[e.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(L||(L={})),function(e){e[e.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",e[e.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",e[e.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",e[e.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",e[e.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",e[e.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",e[e.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",e[e.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(x||(x={})),function(e){e[e.NIM_MESSAGE_STREAM_STATUS_STREAMING=-1]="NIM_MESSAGE_STREAM_STATUS_STREAMING",e[e.NIM_MESSAGE_STREAM_STATUS_NONE=0]="NIM_MESSAGE_STREAM_STATUS_NONE",e[e.NIM_MESSAGE_STREAM_STATUS_PLACEHOLDER=1]="NIM_MESSAGE_STREAM_STATUS_PLACEHOLDER",e[e.NIM_MESSAGE_STREAM_STATUS_CANCEL=2]="NIM_MESSAGE_STREAM_STATUS_CANCEL",e[e.NIM_MESSAGE_AI_STREAM_STATUS_UPDATE=3]="NIM_MESSAGE_AI_STREAM_STATUS_UPDATE",e[e.NIM_MESSAGE_STREAM_STATUS_COMPLETE=4]="NIM_MESSAGE_STREAM_STATUS_COMPLETE",e[e.NIM_MESSAGE_STREAM_STATUS_EXCEPTION=5]="NIM_MESSAGE_STREAM_STATUS_EXCEPTION"}(V||(V={})),function(e){e[e.V2NIM_MESSAGE_SOURCE_UNKNOWN=0]="V2NIM_MESSAGE_SOURCE_UNKNOWN",e[e.V2NIM_MESSAGE_SOURCE_ONLINE=1]="V2NIM_MESSAGE_SOURCE_ONLINE",e[e.V2NIM_MESSAGE_SOURCE_OFFLINE=2]="V2NIM_MESSAGE_SOURCE_OFFLINE",e[e.V2NIM_MESSAGE_SOURCE_ROAMING=3]="V2NIM_MESSAGE_SOURCE_ROAMING"}(D||(D={})),function(e){e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(U||(U={})),function(e){e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}($||($={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(B||(B={})),function(e){e[e.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",e[e.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",e[e.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(F||(F={})),function(e){e[e.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",e[e.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",e[e.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(j||(j={})),function(e){e[e.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",e[e.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(q||(q={})),function(e){e[e.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",e[e.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(G||(G={})),function(e){e[e.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(H||(H={})),function(e){e[e.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=3]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(W||(W={})),function(e){e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(z||(z={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",e[e.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(K||(K={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(Y||(Y={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(J||(J={})),function(e){e[e.teamApply=0]="teamApply",e[e.teamApplyReject=1]="teamApplyReject",e[e.teamInvite=2]="teamInvite",e[e.teamInviteReject=3]="teamInviteReject",e[e.tlistUpdate=4]="tlistUpdate",e[e.superTeamApply=15]="superTeamApply",e[e.superTeamApplyReject=16]="superTeamApplyReject",e[e.superTeamInvite=17]="superTeamInvite",e[e.superTeamInviteReject=18]="superTeamInviteReject"}(X||(X={})),function(e){e[e.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",e[e.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",e[e.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",e[e.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}(Q||(Q={})),function(e){e[e.V2NIM_AI_MODEL_STREAM_CALL_STATUS_NONE=0]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_NONE",e[e.V2NIM_AI_MODEL_STREAM_CALL_STATUS_CANCEL=2]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_CANCEL",e[e.V2NIM_AI_MODEL_STREAM_CALL_STATUS_COMPLETE=4]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_COMPLETE",e[e.V2NIM_AI_MODEL_STREAM_CALL_STATUS_EXCEPTION=5]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_EXCEPTION"}(Z||(Z={})),function(e){e.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",e.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",e.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}(ee||(ee={})),function(e){e[e.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL",e[e.V2NIM_SIGNALLING_EVENT_TYPE_KICK=9]="V2NIM_SIGNALLING_EVENT_TYPE_KICK"}(te||(te={})),function(e){e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(ne||(ne={})),function(e){e[e.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",e[e.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",e[e.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",e[e.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(re||(re={}));var ae={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failed，use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_IS_NOT_STICK_TOP:{code:110305,message:"conversation is not stick top"},V2NIM_ERROR_CODE_STICK_TOP_DISABLED:{code:110306,message:"conversation stick top disabled"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"},V2NIM_ERROR_CODE_STREAM_OUTPUT_STOPPED:{code:189318,message:"Streaming text response stopped"},V2NIM_ERROR_CODE_STREAM_OUTPUT_GENERATED:{code:189319,message:"Streaming text response generated"},V2NIM_ERROR_CODE_STREAM_OUTPUT_ABORTED:{code:189320,message:"Streaming text response aborted due to exception"},V2NIM_ERROR_CODE_INTERRUPTION_REJECTED:{code:189321,message:"Non-streaming messages cannot be interrupted"}},ce=Object.keys(ae),le=ce.reduce(function(e,t){var n=ae[t];return e[t]=n.code,e},{}),de=ce.reduce(function(e,t){var n=ae[t];return e[n.code]=n.message,e},{}),ue=Object.freeze({__proto__:null,V2NIMErrorCode:le,V2NIMErrorDesc:de,get V2NIMDataSyncLevel(){return n},get V2NIMDataSyncType(){return r},get V2NIMDataSyncState(){return i},get V2NIMConversationType(){return o},get V2NIMLastMessageState(){return s},get V2NIMFriendAddMode(){return a},get V2NIMFriendAddApplicationType(){return c},get V2NIMFriendAddApplicationStatus(){return l},get V2NIMFriendDeletionType(){return d},get V2NIMFriendVerifyType(){return u},get V2NIMLoginAuthType(){return p},get V2NIMLoginStatus(){return h},get V2NIMLoginClientType(){return g},get V2NIMKickedOfflineReason(){return m},get V2NIMLoginClientChange(){return f},get V2NIMConnectStatus(){return v},get V2NIMMessageType(){return S},get V2NIMMessageNotificationType(){return b},get V2NIMMessageAttachmentUploadState(){return C},get V2NIMMessageSendingState(){return A},get V2NIMQueryDirection(){return O},get V2NIMMessageRevokeType(){return N},get V2NIMMessagePinState(){return w},get V2NIMMessageQuickCommentType(){return P},get V2NIMClientAntispamOperateType(){return k},get V2NIMSortOrder(){return L},get V2NIMSystemMessageType(){return x},get V2NIMMessageAIStreamStatus(){return y},get V2NIMMessageAIStreamStopOpType(){return _},get V2NIMMessageAIRegenOpType(){return I},get V2NIMMessageAIStatus(){return T},get V2NIMSearchKeywordMatchType(){return E},get V2NIMClearHistoryMode(){return R},get V2NIMMessageStreamStatus(){return V},get V2NIMTeamMessageMuteMode(){return U},get V2NIMP2PMessageMuteMode(){return $},get V2NIMTeamMemberRoleQueryType(){return B},get V2NIMTeamType(){return F},get V2NIMTeamJoinMode(){return j},get V2NIMTeamAgreeMode(){return q},get V2NIMTeamInviteMode(){return G},get V2NIMTeamUpdateInfoMode(){return H},get V2NIMTeamChatBannedMode(){return W},get V2NIMTeamUpdateExtensionMode(){return z},get V2NIMTeamJoinActionType(){return Y},get V2NIMTeamJoinActionStatus(){return J},get V2NIMTeamNotificationType(){return X},get V2NIMTeamMemberRole(){return K},get V2NIMAIModelRoleType(){return ee},get V2NIMAIModelType(){return Q},get V2NIMAIModelStreamCallStatus(){return Z},get V2NIMSignallingChannelType(){return ne},get V2NIMSignallingEventType(){return te},get V2NIMUserStatusType(){return re}});class pe extends Error{constructor(e){super(e.desc),this.name="V2NIMError",this.code=e.code||0,this.desc=e.desc||de[this.code]||ye[this.code]||"",this.message=this.desc,this.detail=e.detail||{}}toString(){var e,t=`${this.name}\n code: ${this.code}\n message: "${this.message}"\n detail: ${this.detail?JSON.stringify(this.detail):""}`;return(null===(e=null==this?void 0:this.detail)||void 0===e?void 0:e.rawError)&&(t+=`\n rawError: ${this.detail.rawError.message}`),t}}class he extends pe{constructor(e,t={},n){super({code:le.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:e,rules:n,data:t}}),this.name="validateError",this.message=this.message+"\n"+JSON.stringify(this.detail,null,2),this.data=t,this.rules=n}}class ge extends pe{constructor(e){var t,n,r;super({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(t=e.detail)||void 0===t?void 0:t.reason,rules:null===(n=e.detail)||void 0===n?void 0:n.rules,data:null===(r=e.detail)||void 0===r?void 0:r.data}}),this.name="ValidateErrorV2"}}class me extends pe{constructor(e,t,n){super({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:e,key:t,rules:n}}),this.name="formatError"}}class fe extends pe{constructor(e){super(Object.assign({code:400},e)),this.desc=this.desc||"upload file error",this.message=this.desc,this.name="uploadError"}}class ve extends pe{constructor(e,t={},n=400){super({code:n,desc:e,detail:t}),this.name="customError",this.data=t}}var ye={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"};function _e(e,t){return t=t||[],(e=e||[]).filter(e=>-1===t.indexOf(e))}function Ie(e,t){return t instanceof RegExp?"__REGEXP "+t.toString():t}function Te(e,t={},n,r=!1){var i={};return Object.keys(e).forEach(o=>{var s=e[o].type,a=n?`In ${n}, `:"";if(null==t){var c=`${a}param is null or undefined`;throw r?new ge({detail:{reason:c,data:{key:o},rules:"required"}}):new he(c,{key:o},"required")}if(void 0===t[o]){if(!1===e[o].required)return void(i[o]=t[o]);var l=`${a}param '${o}' is required`;throw r?new ge({detail:{reason:l,data:{key:o},rules:"required"}}):new he(l,{key:o},"required")}var d=Se[s];if(d&&!d(t,o,e[o],r)){var u=`${a}param '${o}' unexpected`,p={key:o,value:t[o]};throw r?new ge({detail:{reason:u,data:p,rules:JSON.stringify(e[o],Ie)}}):new he(u,p,JSON.stringify(e[o],Ie))}i[o]=t[o]}),i}var Se={string:function(e,t,n){var r,{allowEmpty:i,max:o,min:s,regExp:a}=n,c=e[t];return!("string"!=typeof c||!1===i&&""===c||"number"==typeof o&&c.length>o||"number"==typeof s&&c.length<s||(r=a,"[object RegExp]"===Object.prototype.toString.call(r)&&!a.test(c)))},number:function(e,t,n){var{min:r,max:i}=n,o=e[t];return!("number"!=typeof o||"number"==typeof r&&o<r||"number"==typeof i&&o>i)},boolean:function(e,t){return"boolean"==typeof e[t]},file:function(e,t){return!0},enum:function(e,t,n){var{values:r}=n,i=e[t];return!r||r.indexOf(i)>-1},jsonstr:function(e,t){try{var n=JSON.parse(e[t]);return"object"==typeof n&&null!==n}catch(r){return!1}},func:function(e,t){return"function"==typeof e[t]},array:function(e,t,n,r=!1){var{itemType:i,itemRules:o,rules:s,min:a,max:c,values:l}=n,d=e[t];if(!Array.isArray(d))return!1;if("number"==typeof c&&d.length>c)return!1;if("number"==typeof a&&d.length<a)return!1;if(o)d.forEach((e,n)=>{Te({[n]:o},{[n]:e},`${t}[${n}]`,r)});else if(s)d.forEach((e,n)=>Te(s,e,`${t}[${n}]`,r));else if("enum"===i){if(l&&_e(d,l).length)return!1}else if(i&&!d.every(e=>typeof e===i))return!1;return!0},object:function(e,t,n,r=!1){var{rules:i,allowEmpty:o}=n,s=e[t];if("object"!=typeof s||null===s)return!1;if(i){var a=Object.keys(i),c=Object.keys(s).filter(e=>a.indexOf(e)>-1);if(!1===o&&0===c.length)return!1;Te(i,s,t,r)}return!0}};function Ee(e,t){if(!e)throw new pe({code:le.V2NIM_ERROR_CODE_ILLEGAL_STATE});Te({conversationId:{type:"string",allowEmpty:!1,regExp:new RegExp(`^${e}\\|[1-3]\\|`)}},{conversationId:t},"",!0)}class Me{constructor(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}addTimer(e,t=0,n=1){var r=(new Date).getTime(),i=this.id;return this.timerList.push({id:i,loop:n,count:0,timeout:r+t,interval:t,callback:e}),this.id++,this.checkTimer(r),i}checkTimer(e=(new Date).getTime()){if(this.removeFinished(),0!==this.timerList.length||null==this.timer){var t=0;for(var n of this.timerList)(0===t||t>n.timeout)&&(t=n.timeout);0!==this.timerList.length&&(null===this.timer||t<this.timeout||this.timeout<e)&&(this.timer=setTimeout(this.nowTime.bind(this),t-e),this.timeout=t)}}nowTime(){var e=(new Date).getTime();for(var t of this.timerList)e>=t.timeout&&(t.callback(),t.count++,t.timeout=e+t.interval);this.clerTime(),this.checkTimer(e)}clerTime(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}deleteTimer(e){for(var t=this.timerList.length-1;t>=0;t--)this.timerList[t].id===e&&this.timerList.splice(t,1)}removeFinished(){for(var e=this.timerList.length-1;e>=0;e--){var t=this.timerList[e];t.loop>=0&&t.count>=t.loop&&this.timerList.splice(e,1)}}destroy(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null}}function be(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function Ce(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})}function Ae(e){return null!=e&&"object"==typeof e&&Object.getPrototypeOf(e)==Object.prototype}function Oe(e,t){var n=Ae(e)||Array.isArray(e),r=Ae(t)||Array.isArray(t);if(n&&r){for(var i in t){var o=Oe(e[i],t[i]);void 0!==o&&(e[i]=o)}return e}return t}var Re={getNetworkStatus:()=>Promise.resolve({net_type:0,net_connect:!0}),onNetworkStatusChange(e){},offNetworkStatusChange(){}},Ne={isActive:()=>!0,getStatus:()=>0,setStatus(e){},destroy(){}},we={setLogger:function(e){throw new Error("setLogger not implemented.")},platform:"",WebSocket:class{constructor(e,t){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}close(e,t){throw new Error("Method not implemented.")}send(e){throw new Error("Method not implemented.")}onclose(e){throw new Error("Method not implemented.")}onerror(e){throw new Error("Method not implemented.")}onmessage(e){throw new Error("Method not implemented.")}onopen(e){throw new Error("Method not implemented.")}},localStorage:{},request:function(e,t){throw new Error("request not implemented.")},uploadFile:function(e){throw new Error("uploadFile not implemented.")},getSystemInfo:function(){throw new Error("getSystemInfo not implemented.")},getFileUploadInformation(e){throw new Error("getFileUploadInformation not implemented.")},envPayload:{},net:Re,powerMonitor:Ne,logStorage:class{constructor(e){}open(){return Promise.resolve()}close(){}addLogs(e){return Promise.resolve()}extractLogs(){return Promise.resolve()}afterUpload(){return Promise.resolve()}}},Pe=["error","warn","log","debug"],ke=function(){},Le=["off","error","warn","log","debug"];class xe{constructor(e,t={}){this.storageArr=[],this.debugLevel="off",this.timer=0,this.strategies={debug:{name:"debg",func:console.log},log:{name:"info",func:console.log},warn:{name:"warn",func:console.warn},error:{name:"erro",func:console.error}},this.debug=ke,this.log=ke,this.warn=ke,this.error=ke,this.iid=Math.round(1e3*Math.random()),this.debugLevel=Le.includes(e)?e:"off",t.debugLevel&&(this.debugLevel=Le.includes(t.debugLevel)?t.debugLevel:this.debugLevel),this.logStorage=!1===t.storageEnable?null:new we.logStorage(null==t?void 0:t.storageName),this.setOptions(t),this.setLogFunc(this.debugLevel),this.setTimer(),we.setLogger(this),this.open()}getDebugMode(){return"debug"===this.debugLevel}open(){this.logStorage&&this.logStorage.open().then(()=>{this.log("Logger::open success")}).catch(e=>{this.warn("Logger::open failed",e)})}setOptions(e){if(e&&e.logFunc){var t=e.logFunc;for(var n in t){var r=n,i=t[r];i&&(this.strategies[r].func=i)}}}setLogFunc(e,t="log"){var n=Pe.findIndex(t=>t===e),r=Pe.findIndex(e=>e===t);Pe.forEach((e,t)=>{this[e]=function(){if(!(t>n&&t>r)){var i=Array.prototype.slice.call(arguments),o=this.strategies[e],s=this.formatArgs(i,o.name);t<=r&&this.logStorage&&this.prepareSaveLog(s,e),t<=n&&o.func(s)}}})}extractLogs(){var e;return this.logStorage?null===(e=this.logStorage)||void 0===e?void 0:e.extractLogs():Promise.resolve("")}afterUpload(){var e;return this.logStorage?null===(e=this.logStorage)||void 0===e?void 0:e.afterUpload():Promise.resolve("")}prepareSaveLog(e,t){this.storageArr.push({text:e,level:t,time:Date.now(),iid:this.iid}),this.timer||this.setTimer(),this.storageArr.length>=100&&(this.triggerTimer(),this.storageArr=[])}saveLogs(){return Ce(this,void 0,void 0,function*(){if(this.logStorage){var e=this.storageArr;this.storageArr=[];try{yield this.logStorage.addLogs(e)}catch(t){}}})}clearTimer(){this.timer&&clearTimeout(this.timer),this.timer=0}setTimer(){this.clearTimer(),this.timer=setTimeout(this.triggerTimer.bind(this),5e3)}triggerTimer(){this.clearTimer(),this.saveLogs()}formatArgs(e,t){var n=new Date;return`[NIM ${this.iid} ${t} ${n.getMonth()+1}-${n.getDate()} ${n.getHours()}:${n.getMinutes()}:${n.getSeconds()}:${n.getMilliseconds()}] `+e.map(e=>e instanceof pe?e.toString():e instanceof Error?e&&e.message?e.message:e:"object"==typeof e?JSON.stringify(e):e).join(" ")}destroy(){this.debug=ke,this.log=ke,this.warn=ke,this.error=ke,this.saveLogs(),this.clearTimer(),this.storageArr=[],this.logStorage&&this.logStorage.close()}}function Ve(e,t){if("object"!=typeof e||null===e)return e;for(var n=(t=t||"").split("."),r=0;r<n.length;r++){var i=n[r],o=e[i],s=i.indexOf("["),a=i.indexOf("]");if(-1!==s&&-1!==a&&s<a){var c=i.slice(0,s),l=parseInt(i.slice(s+1,a));o=e[c],o=Array.isArray(o)?o[l]:void 0}if(null==o)return o;e=o}return e}var De,Ue=(De=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return De()+De()+De()+De()+De()+De()+De()+De()});function $e(e){return Object.keys(e).filter(e=>!(+e>=0))}function Be(e,t){var n=Object.keys(e).filter(n=>e[n]==t);return n.length>0?n[0]:void 0}function Fe(e,t="-"){if(!e)throw new ve("No sessionId",{},400);var n=e.indexOf(t);if(-1===n)throw new ve("Can not find conjunctions",{},400);var r=e.slice(0,n);return{accid:e.slice(n+1),scene:"super_team"===r?"superTeam":r}}function je(){var{hostEnvEnum:e}=we.getSystemInfo();return 6===e||102===e||103===e||104===e}function qe(e,t){return function(e,t,n,r){for(var i in e=e||{},n=n||{},r=r||(()=>{}),t=t||{}){var o=r(e[i],t[i]);e[i]=void 0===o?t[i]:o}for(var s in n){var a=r(e[s],n[s]);e[s]=void 0===a?n[s]:a}return e}({},e,t,function(e,t){return void 0===t?e:t})}function Ge(){return Promise.resolve()}function He(){}function We(e){var t=e.lastIndexOf("."),n=t>-1?e.slice(t+1):"";return/^\d+$/.test(n.trim())&&(n=""),n}function ze(e,t,n){return 0===e.length||e[0][t]<=n?0:e[e.length-1][t]>n?e.length:e.findIndex((r,i)=>{if(e[i-1]&&e[i-1][t]>n&&n>=r[t])return!0})}function Ke(e,t,n,r){var i="number"==typeof Ve(e,"raw.r[0]")?`${e.raw.r[0]}`:void 0;return t[n]=t[n]||i||r,t}class Ye{constructor(e){this.lastSuccUploadHost="",this.core=e}getFileUploadInformation(e){return we.getFileUploadInformation(e)}request(e,t,n){var r=(new Date).getTime(),i=(null==n?void 0:n.exception_service)||0;return we.request(e,t).catch(n=>{var o,s,a,c,l=n;throw this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(s=null===(o=this.core)||void 0===o?void 0:o.auth)||void 0===s?void 0:s.account),trace_id:null===(c=null===(a=this.core.clientSocket)||void 0===a?void 0:a.socket)||void 0===c?void 0:c.sessionId,start_time:r,action:1,exception_service:i}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof l.code?l.code:0,description:l.message||`${l.code}`,operation_type:0,target:e,context:t?JSON.stringify(t):""},{asyncParams:we.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),n})}uploadFile(e){var t,n,r,i;return Ce(this,void 0,void 0,function*(){for(var o="BROWSER"===we.platform,s=o?e.chunkUploadHostBackupList:e.commonUploadHostBackupList,a=o?e.chunkUploadHost:e.commonUploadHost,c=s.indexOf(a),l=-1===c?[a,...s]:[a,...s.slice(0,c),...s.slice(c+1)],d=Math.max(l.indexOf(this.lastSuccUploadHost),0),u=null,p=0;p<l.length;p++){var h=(new Date).getTime(),g=l[(p+d)%l.length];try{var m=yield we.uploadFile(Object.assign(Object.assign({},e),o?{chunkUploadHost:g}:{commonUploadHost:g}));return this.lastSuccUploadHost=g,"string"==typeof m.size&&(m.size=parseInt(m.size)),"string"==typeof m.dur&&(m.dur=parseInt(m.dur)),"string"==typeof m.w&&(m.w=parseInt(m.w)),"string"==typeof m.h&&(m.h=parseInt(m.h)),m}catch(v){this.core.cloudStorage.nos.nosErrorCount--,u=v;var f=v;this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(n=null===(t=this.core)||void 0===t?void 0:t.auth)||void 0===n?void 0:n.account),trace_id:null===(i=null===(r=this.core.clientSocket)||void 0===r?void 0:r.socket)||void 0===i?void 0:i.sessionId,start_time:h,action:1,exception_service:3}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof f.code?f.code:0,description:f.message||`${f.code}`,operation_type:1,target:g},{asyncParams:we.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),this._uploadFileErrHanler(v)}}throw u})}_uploadFileErrHanler(e){if(e&&(e.code>200||e.errCode>200))throw e}}var Je="weblink.netease.im:443",Xe=["https://lbs.netease.im/lbs/webconf.jsp"],Qe="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",Ze="imElite_sdk_abtest_web";class et{constructor(e,t){this.abtInfo={},this.core=e,this.config=qe({isAbtestEnable:!0,abtestUrl:Qe,abtestProjectKey:Ze},t)}setOptions(e){this.config=qe(this.config,e)}abtRequest(){var e,t;return Ce(this,void 0,void 0,function*(){if(this.config.isAbtestEnable&&!this.abtInfo.experiments&&this.config.abtestUrl){var n;try{n=yield this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.9.41",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7})}catch(r){this.core.logger.warn("ABTest request failed")}this.abtInfo=(null===(t=null===(e=null==n?void 0:n.data)||void 0===e?void 0:e.data)||void 0===t?void 0:t.abtInfo)||{}}})}}class nt{constructor(){this.abortFns=[]}add(e){var t,n,r,i=(t=e,n={},r=new Promise(function(e,t){n.abort=t}),n.promise=Promise.race([t,r]),n);return this.abortFns.push(i.abort),i.promise}clear(e){this.abortFns.forEach(t=>t(e||new pe({code:le.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))),this.abortFns=[]}destroy(){this.clear()}}var rt={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},it={timestamp:0,rtt:0,baseClock:0,baseTime:0};class ot{constructor(e,t,n="getServerTime"){this.serverOrigin=it,this.config=rt,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=e,this.logger=e.logger,this.promiseManager=new nt,this.cmdName=n,t&&this.setOptions(t)}setOptions(e){this.config=Object.assign({},rt,this.config,e)}reset(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=it,this.currentChance=0}setOriginTimetick(){return Ce(this,void 0,void 0,function*(){if(this.config.enable&&!(this.isSettingNTP||this.currentChance>=this.config.maxChances)){var e=Ve(this.core,"auth.status"),t=Ve(this.core,"status"),n=Ve(this.core,"V2NIMLoginService.lifeCycle.loginStatus");if("logined"===e||"logined"===t||1===n){this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0;var r,i="TimeOrigin::setOriginTimetick:",o=Date.now();this.core.logger.debug(`${i} getServerTime start, times ${this.currentChance}`);try{r=Ve(yield this.promiseManager.add(this.core.sendCmd(this.cmdName)),"content.time"),this.isSettingNTP=!1}catch(c){var s=c;return this.isSettingNTP=!1,this.logger.warn(`${i} Calculate Delay time, getServerTime error`,s),void(s.code!==le.V2NIM_ERROR_CODE_CANCELLED&&(clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)))}if(!r)return this.core.logger.warn(`${i} Calculate Delay time incorrect format`),void(this.config.enable=!1);var a=Date.now()-o;this.doSet(r,a)}}})}doSet(e,t){var n="TimeOrigin::setOriginTimetick:";t>this.config.tolerantRTT?(this.logger.warn(`${n} denied RTT:${t}`),clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)):t>this.config.bestRTT?(this.serverOrigin.rtt&&t>=this.serverOrigin.rtt?this.logger.warn(`${n} ignore RTT:${t}`):(this.setServerOrigin(t,e),this.logger.log(`${n} accept reluctantly RTT:${t}`)),clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)):(this.setServerOrigin(t,e),this.logger.debug(`${n} accept best RTT:${t}`),this.currentChance=0,clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.successDelay))}getNTPTime(e){if(void 0===e&&(e=this.getTimeNode()),this.checkNodeReliable(e)){var t=Math.floor(e.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+t}return Date.now()}checkNodeReliable(e){if(void 0===e&&(e=this.getTimeNode()),this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var t=e.clock-this.serverOrigin.baseClock,n=e.time-this.serverOrigin.baseTime;return Math.abs(n-t)<500}return!1}checkPerformance(){return"BROWSER"===we.platform&&!("undefined"==typeof performance||!performance.now)}static checkPerformance(){return"BROWSER"===we.platform&&!("undefined"==typeof performance||!performance.now)}getTimeNode(){return{clock:this.checkPerformance()?performance.now():0,time:Date.now()}}static getTimeNode(){return{clock:ot.checkPerformance()?performance.now():0,time:Date.now()}}setServerOrigin(e,t){this.serverOrigin={timestamp:t+Math.floor(e/2),rtt:e,baseClock:this.checkPerformance()?performance.now():0,baseTime:Date.now()}}}var st={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]};class at{constructor(e,t){this.traceData=st,this.core=e,this.traceData=Object.assign({},st,t),this.traceData.extension=[]}reset(){this.traceData=Object.assign({},st),this.traceData.extension=[]}start(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time=(new Date).getTime()}update(e){return Ce(this,void 0,void 0,function*(){var{net_type:t,net_connect:n}=yield we.net.getNetworkStatus();this.traceData.extension.push(Object.assign({code:0,foreground:!0,foreg_backg_switch:!1,net_type:t,net_connect:n},e))})}end(e){var t=this.traceData.extension[0],n=this.traceData.extension[1];if(t&&0===t.operation_type&&n&&1===n.operation_type){var r=t.net_type!==n.net_type||t.net_connect!==n.net_connect;if(e||!r)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()}}var ct={user_id:"",trace_id:"",net_connect:!0,net_type:0,duration:0,start_time:0,history:[],succeed:!1};class lt{constructor(e){this.traceData=ct,this.core=e,this.reset()}reset(){this.traceData=Object.assign({},ct),this.traceData.history=[]}start(e){this.reset(),this.traceData.user_id=e,this.traceData.start_time=Date.now()}updateBegin(e){this.traceData.history.push(Object.assign({head:"",body:"",start_time:Date.now(),httpdns:!1,index:0},e))}updateComplete(e){this.traceData.history.forEach(t=>{t.target===e.target&&(Object.assign(t,e),t.duration=Date.now()-t.start_time)})}end(e){return Ce(this,void 0,void 0,function*(){if(this.traceData.succeed=e,this.traceData.history=this.traceData.history.filter(e=>void 0!==e.code),0!==this.traceData.history.length){this.traceData.duration=Date.now()-this.traceData.start_time;var{net_type:t,net_connect:n}=yield we.net.getNetworkStatus();this.traceData.net_type=t,this.traceData.net_connect=n,this.core.reporter.report("nim_sdk_lbs_records",this.traceData),this.reset()}else this.reset()})}}function dt(e){var t,n,r=!0;return"boolean"==typeof(null===(t=null==e?void 0:e.reporterConfig)||void 0===t?void 0:t.enableCompass)?r=e.reporterConfig.enableCompass:"boolean"==typeof(null===(n=null==e?void 0:e.reporterConfig)||void 0===n?void 0:n.isDataReportEnable)&&(r=e.reporterConfig.isDataReportEnable),r}var ut={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},pt="ReporterHook::setMonitorForResources:";class ht{constructor(e,t){this.traceData=ut,this.core=e,this.traceData=Object.assign({},ut,t)}reset(){this.traceData=Object.assign({},ut)}start(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Date.now()}update(e){return Ce(this,void 0,void 0,function*(){this.traceData.user_id&&(this.core.logger.log(`${pt} upload update`,e),Object.assign(this.traceData,e))})}end(e){this.traceData.user_id&&(this.core.logger.log(`${pt} upload end cause of ${e}`),this.traceData.state=e,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Date.now())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=ut)}}var gt={},mt={},ft={},vt={apiVersion:"v1",debugLevel:"off",needReconnect:!0,reconnectionAttempts:Number.MAX_SAFE_INTEGER,lbsUrls:Xe,linkUrl:Je,abtestUrl:Qe,isAbtestEnable:!0};class yt extends oe{constructor(e,t={}){if(super(),this.instanceName="NIM",this.pluginMap={},this.eventBus=new oe,this.options={},this.V2NIMConversationIdUtil={},this.V2NIMMessageCreator={},this.V2NIMMessageAttachmentCreator={},this.V2NIMClientAntispamUtil={},this.DataStructureConverter={},this.V2NIMMessageConverter={},this.V2NIMMessageLogUtil={},this.V2NIMMessageExtendUtil={},this.V2NIMStorageUtil={},this.V2NIMNotificationService={},this.V2NIMStorageService={},this.auth={},this.V1NIMLoginService={},this.V2NIMLoginService={},this.clientSocket={},this.V2NIMSyncService={},this.V2NIMLocalConversationService={},this.V2NIMConversationService={},this.V2NIMConversationGroupService={},this.V2NIMMessageService={},this.V2NIMTeamService={},this.V2NIMUserService={},this.V2NIMFriendService={},this.V2NIMSettingService={},this.V2NIMAIService={},this.V2NIMSignallingService={},this.V2NIMSubscriptionService={},this.V2NIMPassthroughService={},this.YSFService={},this.offlinePush={},this.sync={},this.msg={},this.msgLog={},this.session={},this.cloudSession={},this.misc={},this.user={},this.friend={},this.systemMessage={},this.team={},this.event={},this.msgExtend={},this.cloudStorage={},this.passThrough={},this.superTeam={},this.plugin={},this.signaling={},this.qchatChannel={},this.qchatMedia={},this.qchatMsg={},this.qchatRole={},this.qchatServer={},this.pluginMap=ft,this.logger=new xe(e.debugLevel,t.loggerConfig),t.privateConf){var{authConfig:n,cloudStorageConfig:r,reporterConfig:i}=this.getConfigFromPrivate(t.privateConf);Object.assign(e,n),this.setInitOptions(e),this.otherOptions=Object.assign(Object.assign({},t),{cloudStorageConfig:Object.assign(Object.assign({storageKeyPrefix:"NIM"},t.cloudStorageConfig),r),reporterConfig:Object.assign(Object.assign({},t.reporterConfig),i),V1NIMLoginServiceConfig:Object.assign(Object.assign(Object.assign({},e),t.V1NIMLoginServiceConfig),n),V2NIMLoginServiceConfig:Object.assign(Object.assign({},t.V2NIMLoginServiceConfig),n)})}else this.setInitOptions(e),this.otherOptions=Object.assign(Object.assign({},t),{V1NIMLoginServiceConfig:Object.assign(Object.assign({},e),t.V1NIMLoginServiceConfig),cloudStorageConfig:Object.assign({storageKeyPrefix:"NIM"},t.cloudStorageConfig)});this.timerManager=new Me,this.timeOrigin=new ot(this),this.adapters=new Ye(this),this.abtest=new et(this,Object.assign(Object.assign({isAbtestEnable:this.options.isAbtestEnable,abtestUrl:this.options.abtestUrl},this.otherOptions.abtestConfig),{abtestProjectKey:Ze}));var o=we.getSystemInfo(),s=function(e,t){var n,r,i=null===(n=null==t?void 0:t.reporterConfig)||void 0===n?void 0:n.compassDataEndpoint,o=null===(r=null==t?void 0:t.reporterConfig)||void 0===r?void 0:r.reportConfigUrl;if(i)return i;if(o){var s=o.match(/^https:\/\/([^/]+)\/*/);if(Array.isArray(s)&&s.length>=1)return`https://${s[1]}`;e.error(`Invalid reportConfigUrl: ${o}`)}return je()?"https://statistic.live.126.net":"https://statistic.live.126.net,https://statistic-overseas.yunxinfw.com"}(this.logger,this.otherOptions);this.reporter=new se(Object.assign(Object.assign({},s?{compassDataEndpoint:s}:{}),{isDataReportEnable:dt(this.otherOptions),common:{app_key:e.appkey,dev_id:"",platform:"Web",sdk_ver:"10.9.41",env:"online",os_name:o.os,os_ver:o.osVer,lib_env:o.libEnv,host_env:o.hostEnv,host_env_ver:o.hostEnvVer,manufactor:o.manufactor,model:o.model,v2:"v1"!==this.options.apiVersion},request:we.request,logger:this.logger,autoStart:!0})),this.reporterHookLinkKeep=new at(this),this.reporterHookCloudStorage=new ht(this),this.reporterHookLBS=new lt(this),this.getServiceKeys(Object.keys(gt)).forEach(e=>{if(!this[e]||!this[e].name){var t=gt[e];this[e]=new t(this)}}),Object.keys(gt).forEach(e=>{this.callSetOptions(e)}),Object.keys(mt).forEach(e=>{var t=mt[e];void 0!==t&&(this[e]=new t(this))}),yt.instance=this,this.logger.log(`NIM init, version:10.9.41, sdk version:100941, appkey:${e.appkey}`)}getServiceKeys(e){var t=e.findIndex(e=>"V1NIMLoginService"===e);if(t>-1){var n=e[t];e.splice(t,1),"v1"===this.options.apiVersion&&e.unshift(n)}var r=e.findIndex(e=>"V2NIMLoginService"===e);if(r>-1){var i=e[r];e.splice(r,1),"v2"===this.options.apiVersion&&e.unshift(i)}var o=e.findIndex(e=>"sync"===e);if(o>-1){var s=e[o];e.splice(o,1),"v1"===this.options.apiVersion&&e.push(s)}var a=e.findIndex(e=>"V2NIMSyncService"===e);if(a>-1){var c=e[a];e.splice(a,1),"v2"===this.options.apiVersion&&e.push(c)}return e}static getInstance(e,t){if(!yt.instance){if(e)return new yt(e,t);throw new Error("Instance not exist, please input options")}if(e){if(yt.instance.options.account===e.account&&yt.instance.options.appkey===e.appkey)return yt.instance.setOptions(e),yt.instance;throw new Error("Unexpected login")}return yt.instance}setInitOptions(e){Te({appkey:{type:"string"},apiVersion:{type:"enum",values:["v1","v2"],required:!1},binaryWebsocket:{type:"boolean",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.options=Object.assign(Object.assign({},vt),e)}getConfigFromPrivate(e){var t;return e?{authConfig:JSON.parse(JSON.stringify({appkey:e.appkey||void 0,lbsUrls:e.weblbsUrl?[e.weblbsUrl]:void 0,linkUrl:e.link_web||void 0,linkSSL:null!==(t=e.websdkSsl)&&void 0!==t?t:void 0})),cloudStorageConfig:JSON.parse(JSON.stringify({chunkUploadHost:e.nos_uploader||void 0,commonUploadHost:e.nos_uploader||void 0,commonUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,chunkUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,uploadReplaceFormat:e.nos_downloader_v2?`${e.nosSsl?"https://":"http://"}${e.nos_downloader_v2}`:void 0,downloadUrl:void 0!==e.nos_accelerate?e.nos_accelerate:void 0,downloadHostList:""===e.nos_accelerate_host?[]:"string"==typeof e.nos_accelerate_host?[e.nos_accelerate_host]:Array.isArray(e.nos_accelerate_host)?e.nos_accelerate_host:void 0})),reporterConfig:JSON.parse(JSON.stringify({enableCompass:"boolean"==typeof e.enableCompass?e.enableCompass:void 0,compassDataEndpoint:e.compassDataEndpoint||void 0}))}:{authConfig:{},cloudStorageConfig:{},reporterConfig:{}}}connect(e={}){return this.V1NIMLoginService.login(e)}setOptions(e){if("object"==typeof e&&null!==e){if(Object.prototype.hasOwnProperty.call(e,"account")&&e.account!==this.options.account||Object.prototype.hasOwnProperty.call(e,"appkey")&&e.appkey!==this.options.appkey)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions account and appkey is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"apiVersion")&&e.apiVersion!==this.options.apiVersion)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions apiVersion is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"binaryWebsocket")&&e.binaryWebsocket!==this.options.binaryWebsocket)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions binaryWebsocket is not allowed to reset"}});Te({token:{type:"string",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.logger.log("NIM::setOptions options is",e),this.options=Object.assign(Object.assign({},this.options),e),this.V1NIMLoginService.setOptions&&this.V1NIMLoginService.setOptions(this.options)}}getOptions(){return this.options}disconnect(){return this.V1NIMLoginService.logout()}_disconnect(){return"v1"===this.options.apiVersion?this.V1NIMLoginService.logout():"v2"===this.options.apiVersion?0===Ve(this.V2NIMLoginService,"lifeCycle.connectStatus")&&0===Ve(this.V2NIMLoginService,"lifeCycle.loginStatus")?Promise.resolve():this.V2NIMLoginService.logout():Promise.resolve()}destroy(){return yt.instance=void 0,this._disconnect().then(()=>{this.status="destroyed",this.removeAllListeners(),this.eventBus.removeAllListeners(),this.logger.destroy(),this.reporter.destroy(),this.timerManager.destroy(),this._clearModuleData("destroy"),this._removeAllModuleListeners(),this.connect=Ge,this.disconnect=Ge,this._disconnect=Ge,this.destroy=Ge})}_clearModuleData(e="logout"){Object.values(this).forEach(t=>{t&&"function"==typeof t.reset&&t.reset(e)})}_removeAllModuleListeners(){Object.values(this).forEach(e=>{e&&"function"==typeof e.removeAllListeners&&e.removeAllListeners()})}kick(e){return this.V1NIMLoginService.kick(e)}sendCmd(e,t,n){return this.clientSocket.sendCmd(e,t,n)}emit(e,...t){try{var n=Date.now(),r=super.emit(e,...t),i=Date.now()-n;return i>=10&&this.logger.warn(`Core::emit event: ${e} process takes: ${i}ms`),r}catch(o){return this.logger.error(`Core::emit event: ${e}. Error: ${o}`),setTimeout(()=>{throw this.logger.error(`Core::emit throw error in setTimeout. event: ${e}. Error: ${o}`),o},0),!1}}get account(){return this.auth.account}get status(){return this.V1NIMLoginService.status}set status(e){this.V1NIMLoginService.status=e}get config(){return{timeout:8e3,deviceId:this.auth.deviceId}}_registerDep(e,t){this[t]&&this[t].name||(this[t]=new e(this),this.callSetOptions(t))}callSetOptions(e){var t=`${e}Config`,n=`${e}Options`,r=this.otherOptions[t]||this.otherOptions[n]||{},i=Ve(this,`${e}.setOptions`);"function"==typeof i&&("cloudStorage"===e&&(r=this.otherOptions[t]||this.otherOptions.serverConfig||{}),i.call(this[e],r))}static registerService(e,t){gt[t]=e}static registerPrivateService(e,t){mt[t]=e}static registerPlugin(e,t){ft[t]=e}}yt.sdkVersion=100941,yt.sdkVersionFormat="10.9.41";var _t={debug(...e){},log(...e){},warn(...e){},error(...e){}};function It(e){_t=e}function Tt(){return _t}function St(e){for(var t=function(e){var t=String(e).replace(/[=]+$/,"");if(t.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r="",i=0,o=0,s=0;n=t.charAt(s++);~n&&(o=i%4?64*o+n:n,i++%4)?r+=String.fromCharCode(255&o>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return r}(e),n=t.length,r=new Uint8Array(n),i=0;i<n;i++)r[i]=t.charCodeAt(i);return r.buffer}var Et={clear(){uni.clearStorageSync()},getItem:e=>uni.getStorageSync(e),setItem:(e,t)=>uni.setStorageSync(e,t),removeItem:e=>uni.removeStorageSync(e)};class Mt{constructor(e="nim_logs"){this.dirPath="",this.filePath="",this.copyFilePath="",this.enable=!1,this.maxCapacity=26214400,this.remainCapacity=8388608,this.count=0,this.maxCount=100,this.lastErrorMsg=void 0;var t=uni.getSystemInfoSync(),n="mp-weixin"===t.uniPlatform||"mp-alipay"===t.uniPlatform;if(this.enable=n,n){var r=this.getAPIEnv();r&&(this.dirPath=`${r.env.USER_DATA_PATH}/__nim`,this.filePath=`${this.dirPath}/${e}.log`,this.copyFilePath=`${this.dirPath}/${e}_copy.log`)}}getAPIEnv(){if(!("undefined"!=typeof tt&&tt.getSystemInfoSync||"undefined"!=typeof swan&&swan.getSystemInfoSync))return"undefined"!=typeof my&&my.getSystemInfoSync?my:"undefined"!=typeof wx&&wx.getAppBaseInfo?wx:void 0}makeDir(){if(this.enable){var e=this.getAPIEnv();if(e){var t=Tt(),n=e.getFileSystemManager();try{var r=n.accessSync(this.dirPath);t.log("logStorage::access dir:",r),("object"==typeof r&&null!==r?r.error||r.errno||r.errCode||r.errNo:0)>200&&n.mkdirSync(this.dirPath,!0)}catch(o){n.mkdirSync(this.dirPath,!0)}try{var i=n.accessSync(this.filePath);t.log("logStorage::access file:",i),("object"==typeof i&&null!==i?i.error||i.errno||i.errCode||i.errNo:0)>200&&n.writeFileSync(this.filePath,"===","utf8")}catch(o){n.writeFileSync(this.filePath,"===","utf8")}}}}open(){return Ce(this,void 0,void 0,function*(){if(this.enable){var e=Tt();try{this.makeDir(),e.log(`logStorage::open log file success:${this.filePath}`)}catch(t){e.warn(`logStorage::open log file failed:${this.filePath}`,t)}yield this.checkCapacity(this.remainCapacity)}})}checkCapacity(e){return Ce(this,void 0,void 0,function*(){if(this.enable){var t=this.getAPIEnv();if(t){var n=Tt(),r=t.getFileSystemManager(),i=this.getSize();if(i>this.maxCapacity){n.log(`logStorage::checksize:exceed,${i} byte`);var o="";try{o=yield this.readLogs(i-e)}catch(s){return void n.log("logStorage::checkCapacity:read failed",s)}n.log(`logStorage::checksize:read success ${i-e} byte`);try{r.unlinkSync(this.filePath)}catch(s){return void n.log("logStorage::checkCapacity:unlink failed",s)}try{r.writeFileSync(this.filePath,o,"utf8")}catch(s){return void n.log("logStorage::checkCapacity:write failed",s)}}else n.log(`logStorage::checkCapacity:not exceeding,${i} byte`)}}})}getSize(){var e;if(!this.enable)return 0;var t=this.getAPIEnv();if(!t)return 0;var n,r=Tt(),i=t.getFileSystemManager();try{n=i.statSync(this.filePath,!1)}catch(o){return r.warn("logStorage::stat failed",o),0}return n.size||(null===(e=n.stats)||void 0===e?void 0:e.size)}readLogs(e=0){if(!this.enable)return Promise.resolve("");var t=this.getAPIEnv();if(!t)return Promise.resolve("");var n=Tt(),r=t.getFileSystemManager();return new Promise((t,i)=>{r.readFile({filePath:this.filePath,encoding:"utf8",position:e,success:e=>{var r=e.data;"string"==typeof r?(n.warn(`logStorage::readLogs success ${r.length}`),t(r)):(n.warn("logStorage::readLogs empty"),i(new Error("logStorage::readLogs empty")))},fail:e=>{var t=e.errMsg||e.errorMessage||e.message;n.warn(`logStorage::readLogs failed ${t}`);var r={code:e.errCode||0,message:t};i(r)}})})}close(){}addLogs(e){if(!this.enable)return Promise.resolve();var t=this.getAPIEnv();if(!t)return Promise.resolve();var n=Tt(),r=e.map(e=>e.text).concat("").join("\n");try{t.getFileSystemManager().appendFileSync(this.filePath,r,"utf8")}catch(o){var i=o.errMsg||o.errorMessage||o.message;this.lastErrorMsg!==i&&n.warn("logStorage::append failed",o),this.lastErrorMsg=i}return this.count+=1,this.count>this.maxCount&&(this.count=0,this.checkCapacity(this.remainCapacity)),Promise.resolve()}extractLogs(){return Ce(this,void 0,void 0,function*(){if(this.enable){var e=this.getAPIEnv();if(e){var t=Tt(),n=e.getFileSystemManager();if(this.getSize()>0){try{n.copyFileSync(this.filePath,this.copyFilePath)}catch(r){return void t.warn("logStorage::copyFileSync failed",r)}return this.copyFilePath}t.warn("logStorage::extractLogs empty")}}})}afterUpload(){return Ce(this,void 0,void 0,function*(){if(this.enable){var e=this.getAPIEnv();if(e){var t=Tt(),n=e.getFileSystemManager();try{n.unlinkSync(this.copyFilePath)}catch(r){return void t.log("logStorage::delete copyFilePath failed",r)}}}})}}var bt={wifi:2,"2g":3,"3g":4,"4g":5,"5g":6,ethernet:1,unknown:0,none:0,notreachable:0,wwan:0},Ct={__onNetworkStatusChangeFn:null,getNetworkStatus(){var e=uni.getSystemInfoSync()||{};return"app"===e.uniPlatform&&"harmonyos"===e.osName?Promise.resolve({net_type:0,net_connect:!0}):new Promise((e,t)=>{uni.getNetworkType({success:function(t){var n=!1;n="boolean"==typeof t.networkAvailable?t.networkAvailable:"none"!==t.networkType.toLowerCase(),e({net_type:bt[t.networkType.toLowerCase()],net_connect:n})},fail:function(){t(new Error("getNetworkType failed"))}})})},onNetworkStatusChange(e){this.offNetworkStatusChange(),uni.onNetworkStatusChange&&(this.__onNetworkStatusChangeFn=function(t){var n=t.networkType.toLowerCase();e({isConnected:t.isConnected||"none"!==n,networkType:bt[n]})},uni.onNetworkStatusChange(this.__onNetworkStatusChangeFn))},offNetworkStatusChange(){uni.offNetworkStatusChange&&(this.__onNetworkStatusChangeFn&&uni.offNetworkStatusChange(this.__onNetworkStatusChangeFn),this.__onNetworkStatusChangeFn=null)}},At=Tt();class Ot extends oe{constructor(){super(),this.status=0,this.appShowListener=null,this.appHideListener=null,this.flag=!1,this._initAppLifecycleListener()}isActive(){return 0===this.status}getStatus(){return this.status}setStatus(e){var t=this.status;e!==t&&(this.status=e,0===e&&1===t&&this.emit("onPowerMonitorTurnActive"),At.log("Adapter powerMonitor::setStatus: ",e))}destroy(){this.status=0,this.flag=!1,this._canIUse()&&(this.appShowListener&&(uni.offAppShow(this.appShowListener),this.appShowListener=null),this.appHideListener&&(uni.offAppHide(this.appHideListener),this.appHideListener=null))}_initAppLifecycleListener(){this.flag||(!1!==this._canIUse()?(this.appShowListener=()=>{var e=this.status;this.status=0,1===e&&this.emit("onPowerMonitorTurnActive"),At.log("Adapter powerMonitor::onAppShow status:",this.status)},this.appHideListener=()=>{this.status=1,At.log("Adapter powerMonitor::onAppHide status:",this.status)},uni.onAppShow(this.appShowListener),uni.onAppHide(this.appHideListener),this.flag=!0,At.log("Adapter powerMonitor::_initAppLifecycleListener success")):At.warn("Adapter powerMonitor::_initAppLifecycleListener env.onAppShow/env.onAppHide not available"))}_canIUse(){return"undefined"!=typeof uni&&"function"==typeof uni.onAppShow&&"function"==typeof uni.onAppHide&&"function"==typeof uni.offAppShow&&"function"==typeof uni.offAppHide}}function Rt(e,t){return t&&(t.data=t.data||(null==t?void 0:t.params)||{}),new Promise((n,r)=>{uni.request(Object.assign(Object.assign({method:"GET",url:e},t),{success:function(t){"number"==typeof(t=t||{}).statusCode&&t.statusCode.toString().startsWith("2")?(t={data:t.data,status:t.statusCode,errMsg:t.errMsg,header:t.header},n(t)):r({code:t.statusCode||0,message:t.data||`uniApp request fail. url: ${e}`})},fail:function(t){var n=`uniApp request fail. url: ${e}`;r(t?{code:t.errCode||0,message:t.errMsg||n}:{code:0,message:n})}}))})}var Nt=function(){var e=uni.getSystemInfoSync()||{};if("mp-weixin"===e.uniPlatform&&"undefined"!=typeof wx&&wx.getAppBaseInfo){var t=wx.getAppBaseInfo();return`NIM/Web/UNIAPP(${e.uniRuntimeVersion})/WeChatMiniApp(${t.SDKVersion})/V10.9.41/{{appkey}}`}if("undefined"!=typeof tt&&tt.getSystemInfoSync){var n=tt.getSystemInfoSync();return`NIM/Web/UNIAPP(${e.uniRuntimeVersion})/TiktokMiniApp(${n.SDKVersion})/V10.9.41/{{appkey}}`}if("undefined"!=typeof swan&&swan.getSystemInfoSync){var r=swan.getSystemInfoSync();return`NIM/Web/UNIAPP(${e.uniRuntimeVersion})/BaiduMiniApp(${r.SDKVersion})/V10.9.41/{{appkey}}`}if("undefined"!=typeof my&&my.getSystemInfoSync){var i=my.getSystemInfoSync();return`NIM/Web/UNIAPP(${e.uniRuntimeVersion})/AliMiniApp(${i.SDKVersion})/V10.9.41/{{appkey}}`}if(navigator&&navigator.userAgent)return navigator.userAgent;if(e.ua)return e.ua;var o=uni.getSystemInfoSync();return`NIM/Web/UNIAPP(${o.uniRuntimeVersion})/${o.osName}(${o.osVersion})/V10.9.41/{{appkey}}`},wt=function(){var e=uni.getSystemInfoSync()||{};if("mp-weixin"===e.uniPlatform&&"undefined"!=typeof wx&&wx.getAppBaseInfo){var t=wx.getAppBaseInfo();return`${e.uniRuntimeVersion}/${t.version}`}if("undefined"!=typeof tt&&tt.getSystemInfoSync){var n=tt.getSystemInfoSync();return`${e.uniRuntimeVersion}/${n.version}`}if("undefined"!=typeof swan&&swan.getSystemInfoSync){var r=swan.getSystemInfoSync();return`${e.uniRuntimeVersion}/${r.version}`}if("undefined"!=typeof my&&my.getSystemInfoSync){var i=my.getSystemInfoSync();return`${e.uniRuntimeVersion}/${i.version}`}return`${e.uniRuntimeVersion}`},Pt=function(){var e=uni.getSystemInfoSync()||{};if("mp-weixin"===e.uniPlatform&&"undefined"!=typeof wx&&wx.getAppBaseInfo){var t=wx.getAppBaseInfo();return`${e.uniRuntimeVersion}/${t.SDKVersion}`}if("undefined"!=typeof tt&&tt.getSystemInfoSync){var n=tt.getSystemInfoSync();return`${e.uniRuntimeVersion}/${n.SDKVersion}`}if("undefined"!=typeof swan&&swan.getSystemInfoSync){var r=swan.getSystemInfoSync();return`${e.uniRuntimeVersion}/${r.SDKVersion}`}return"undefined"!=typeof my&&my.getSystemInfoSync?(my.getSystemInfoSync(),`${e.uniRuntimeVersion}/${my.SDKVersion}`):`${e.uniRuntimeVersion}`};function kt(){var e,t="app"===(e=(uni.getSystemInfoSync()||{}).uniPlatform)?[110,"APP"]:"web"===e||"h5"===e?[101,"H5"]:"mp-weixin"===e?[6,"WeiXin"]:"mp-alipay"===e?[102,"Ali"]:"mp-baidu"===e?[103,"Baidu"]:"mp-toutiao"===e?[104,"Tiktok"]:0===e.indexOf("mp-")||0===e.indexOf("quickapp")?[105,"OtherMiniProgram"]:[0,"Unset"],n=uni.getSystemInfoSync()||{};return{os:n.osName||"UNIAPP_UNKNOW",osVer:n.osVersion,browser:n.browserName||"",browserVer:n.browserVersion||"",libEnv:"UNIAPP",hostEnv:t[1],hostEnvEnum:t[0],hostEnvVer:wt(),userAgent:Nt(),model:Pt(),manufactor:t[1],pushDeviceInfo:{PRODUCT:n.model,DEVICE:n.model,MANUFACTURER:n.brand}}}function Lt(e){var t=Tt(),n=e.headers||{};return e.md5&&(n["Content-MD5"]=e.md5),new Promise((r,i)=>{var o=uni.uploadFile(Object.assign(Object.assign({url:`${e.commonUploadHost}/${e.nosToken.bucket}`},Object.keys(n).length>0?{header:n}:{}),{formData:{Object:decodeURIComponent(e.nosToken.objectName),"x-nos-token":e.nosToken.token,"x-nos-entity-type":"json"},name:"file",fileType:e.type,filePath:e.filePath,success(t){if(200==t.statusCode)try{var n;try{n=JSON.parse(t.data)}catch(o){n={}}n.name=e.filePath,n.ext=n.name.lastIndexOf(".")>-1?n.name.slice(n.name.lastIndexOf(".")+1).toLowerCase():"",r(n)}catch(o){i({code:t.statusCode,message:t.errMsg,rawData:t.data})}else i({code:t.statusCode,message:t.errMsg,rawData:t.data})},fail(e){"uploadFile:fail abort"===e.errMsg&&(e.code=le.V2NIM_ERROR_CODE_CANCELLED),e.message=e.errMsg,i(e)}}));try{e.onUploadStart&&e.onUploadStart(o)}catch(s){t.error("Adapter uploadFile: options.onUploadStart error",s&&s.message),o.abort(),i(s)}e.onUploadProgress&&o.onProgressUpdate(function(t){e.onUploadProgress&&e.onUploadProgress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percentage:parseFloat((t.totalBytesSent/t.totalBytesExpectedToSend).toFixed(2)),percentageText:t.progress+"%"})})})}function xt(e){return null}class Vt{constructor(e,t=""){if(this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",this.onclose=function(e){Tt().log("Adapter uniapp: sockets on close ",e)},this.onerror=function(e){Tt().error("Adapter uniapp: sockets error ",e)},this.onmessage=function(e){},this.onopen=function(){},!e)throw new Error("Failed to construct 'socket': url required");this.url=e.replace(/:443(\/|$)/,"$1"),this.protocol=t,this.readyState=this.CONNECTING;var n=this.protocol?{protocols:this.protocol}:{};this.socketTask=uni.connectSocket(Object.assign(Object.assign({url:this.url},n),{multiple:!0,fail:e=>{this.errorHandler(e)}})),this.socketTask.onOpen(e=>{Tt().log("Adapter uniapp:: onOpen. event: ",e),this.readyState=this.OPEN,this.binaryType?this.onopen():this.onmessage&&this.onmessage({type:"open",header:e})}),this.socketTask.onError(e=>{Tt().log("Adapter uniapp:: onError. event: ",e),this.errorHandler(e)}),this.socketTask.onClose(e=>{this.readyState=this.CLOSED,"function"==typeof this.onclose&&(this.onclose&&this.onclose(e),Tt().log("Adapter uniapp:: onClose. event: ",e)),this.socketTask=null}),this.socketTask.onMessage(e=>{var t;t="string"==typeof e.data||e.data instanceof ArrayBuffer?e.data:e.data.isBuffer&&"string"==typeof e.data.data?St(e.data.data):e.data.data,this.onmessage&&this.onmessage({data:t})})}close(){Tt().log("Adapter uniapp:: close uni socket actively"),this.socketTask.close({code:1e3,reason:"user force close websocket",complete:()=>{this.socketTask=null}})}send(e){if(this.readyState!==this.OPEN)throw new Error(`Adapter uniapp:: socket sendMsg when readyState=${this.readyState}`);if(!("string"==typeof e||e instanceof ArrayBuffer))throw new TypeError("Adapter uniapp:: socket sendMsg only String/ArrayBuffer supported");this.socketTask.send({data:e})}errorHandler(e){Tt().error("Adapter uniapp:: errorHandler. event: ",e),this.readyState=this.CLOSED,this.onerror&&this.onerror({type:"error",message:e&&e.errMsg}),e.errMsg&&"[object Array]"===Object.prototype.toString.call(e.errMsg)&&(e.errMsg.indexOf("断裂管道")>0||e.errMsg.indexOf("broken pipe")>0)&&this.onclose&&this.onclose(e)}}var Dt={},Ut={};function $t(e,t,n,r){var i=Dt[e];if(!i)return n.error("createCmd:: can not find cmd config: ",e),null;var o={SER:t,SID:i.sid,CID:i.cid,Q:[]};return i.params&&r&&i.params.forEach(function(e){var t=r[e.name];if(null!=t){var n=e.type,{reflectMapper:i,select:s}=e;switch(e.type){case"PropertyArray":n="ArrayMable",t=t.map(e=>({t:"Property",v:i?jt(e,i,s):e}));break;case"Property":t=i?jt(t,i,s):t;break;case"Bool":t=t?"true":"false"}o.Q.push({t:n,v:t})}}),{packet:o,hasPacketResponse:"boolean"!=typeof i.hasPacketResponse||i.hasPacketResponse,hasPacketTimer:"boolean"!=typeof i.hasPacketTimer||i.hasPacketTimer}}function Bt(e,t){var n;try{n=JSON.parse(e)}catch(l){return void t.error(`Parse command error:"${e}"`)}var r=n.sid+"_"+n.cid,i=n.r;if(["4_1","4_2","4_10","4_11"].includes(r)){var o=n.r[1].headerPacket;r=`${o.sid}_${o.cid}`,n.sid=o.sid,n.cid=o.cid,i=n.r[1].body}var s=Ut[r],a=[];if(s&&s.length>0){for(var c of s)a.push(Ft(n,c.config,c.cmd,i,t));return a}t.error("parseCmd:: mapper not exist",r,n.code)}function Ft(e,t,n,r,i){var o,s={cmd:n,raw:e,error:null,service:null==t?void 0:t.service,content:{},__receiveTimeNode:ot.getTimeNode()};(18===t.sid||t.sid>=26&&t.sid<100)&&(e.code=function(e){if("number"!=typeof e||e!=e)throw new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:`${e}`}});if(e<0||e>=0&&e<1e3||e>=2e4&&e<=20099)return e;var t=(65535&e)>>9;return 1e5+1e3*(t-=t<=38?1:2)+(511&e)}(e.code));var a,c,l,d,u=(a=e.code,c=n,l=de[a],null===(d=ye[a])?null:new pe({code:a,desc:l||d||a,detail:{cmd:c,timetag:Date.now()}}));if(s.error=u,s.error){if(s.error.detail.cmd=n,!(null===(o=null==t?void 0:t.ignoreErrCodes)||void 0===o?void 0:o.includes(e.code)))return s;i.warn("parseCmd:: ignore error ",s.error),s.error.detail.ignore=!0}return t.response&&t.response.forEach((e,t)=>{var n=r[t],i=e.type,o=e.name,a=e.reflectMapper;if(void 0!==n)switch(i){case"Property":s.content[o]=a?qt(n,a):n;break;case"PropertyArray":s.content[o]=n.map(e=>a?qt(e,a):e);break;case"Int":case"Long":case"Byte":s.content[o]=+n;break;case"Bool":s.content[o]="true"===n||!0===n||1===n;break;default:s.content[o]=n}}),s}function jt(e,t,n){var r={};for(var i in e=function(e,t){var n={};for(var r in t){var i=t[r],o="number"==typeof i?r:i.access?i.access:r,s=o.split("."),a=e;for(var c of s){if(void 0===a[c]||null===a[c]){a=void 0;break}a=a[c]}void 0!==a&&(n[o]=a)}return n}(e,t),t){var o=t[i],s="number"==typeof o?i:o.access?o.access:i;if(!n||n.includes(i))if(s in e){if("number"==typeof o)r[o]=e[s];else if("object"==typeof o)if(o.converter){var a=o.converter(e[s],e);void 0!==a&&(r[o.id]=a)}else r[o.id]=e[s]}else"object"==typeof o&&o.def&&("function"==typeof o.def?r[o.id]=o.def(e):r[o.id]=o.def)}return r}function qt(e,t){var n={};for(var r in e){var i=t[r];if("string"==typeof i)n[i]=e[r];else if("object"==typeof i&&"prop"in i){var o=i.access?i.access:i.prop;if(i.converter){var s=i.converter(e[r],e);void 0!==s&&(n[o]=s)}else i.type&&"number"===i.type?n[o]=+e[r]:i.type&&"boolean"===i.type?n[o]=!("0"===e[r]||!e[r]):n[o]=e[r]}}for(var a in t){var c=t[a];if(c&&void 0!==c.def){var l=c.access?c.access:c.prop;l in n||("function"==typeof c.def?n[l]=c.def(e):n[l]=c.def)}}return n=function(e){var t={},n=function(n){var r=n.split(".");r.reduce(function(t,i,o){return t[i]||(t[i]=isNaN(Number(r[o+1]))?r.length-1==o?e[n]:{}:[])},t)};for(var r in e)n(r);return t}(n)}function Gt(e){for(var t in Object.assign(Dt,e.cmdConfig),e.cmdMap){var n=e.cmdMap[t],r=e.cmdConfig[n];if(r)if(Array.isArray(Ut[t])){var i=!1;for(var o of Ut[t])if(o.cmd===n&&o.config.service===r.service){i=!0;break}i||Ut[t].push({config:r,cmd:n})}else Ut[t]=[{config:r,cmd:n}]}}function Ht(e){var t={};return Object.keys(e).forEach(n=>{t[n]=Wt(e[n])}),t}function Wt(e){var t={};for(var n in e){var r=e[n];"number"==typeof r?t[r]=n:"object"==typeof r&&(t[r.id]={prop:n,type:r.retType,access:r.retAccess?r.retAccess:r.access?r.access:n,def:r.retDef,converter:r.retConverter})}return t}function zt(e){return e?1:0}function Kt(e){return 1===parseInt(e)}function Yt(e){if(e&&"object"==typeof e)try{return JSON.stringify(e)}catch(t){return}}function Jt(e){if(e&&"string"==typeof e)try{return JSON.parse(e)}catch(t){return}}var Xt,Qt,Zt,en,tn,nn={"1_2":"heartbeat","2_3":"login","2_5":"kicked","2_6":"logout","2_7":"nimLoginClientChange","2_8":"kick"},rn={login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,loginTime:109,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,connectionId:102,ip:103,port:104,time:109,pushType:110,hasTokenPreviously:111},aosPushInfo:{pushType:110,hasTokenPreviously:111}},on=Ht(rn),sn={login:{sid:2,cid:3,service:"auth",params:[{type:"Property",name:"login",reflectMapper:rn.login}],response:[{type:"Property",name:"loginRes",reflectMapper:on.loginRes},{type:"PropertyArray",name:"loginPorts",reflectMapper:on.loginPort},{type:"Property",name:"aosPushInfo",reflectMapper:on.aosPushInfo}]},logout:{sid:2,cid:6,service:"auth"},heartbeat:{sid:1,cid:2,service:"auth"},kicked:{sid:2,cid:5,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"ext"},{type:"Int",name:"customClientType"}]},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:on.loginPort}]},kick:{sid:2,cid:8,service:"auth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]}};function an(e,t){if(!Ae(t))return{};var n=JSON.parse(JSON.stringify(t)),r=cn(e,n);return JSON.parse(JSON.stringify(Object.assign(Object.assign({},n),r)))}function cn(e,t){if(!Ae(t))return{};var n={};return Object.keys(e).forEach(r=>{var i=e[r].type;if("string"!=typeof i){var o=cn(e[r],t);Object.keys(o).length>0&&(n[r]=o)}else{var s=e[r],a=s.rawKey||r,c=ln[i](t,a,s);void 0!==c&&(t[a]=void 0,n[r]=c)}}),n}!function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(Xt||(Xt={})),function(e){e[e.p2p=0]="p2p",e[e.team=1]="team",e[e.superTeam=5]="superTeam"}(Qt||(Qt={})),function(e){e[e.Android=1]="Android",e[e.iOS=2]="iOS",e[e.PC=4]="PC",e[e.WindowsPhone=8]="WindowsPhone",e[e.Web=16]="Web",e[e.Server=32]="Server",e[e.Mac=64]="Mac",e[e.HarmonyOS=65]="HarmonyOS"}(Zt||(Zt={})),function(e){e[e.unread=1]="unread",e[e.read=2]="read",e[e.deleted=3]="deleted",e[e.sending=4]="sending",e[e.sendFailed=5]="sendFailed",e[e.sent=6]="sent",e[e.receipt=7]="receipt",e[e.refused=10]="refused"}(en||(en={})),function(e){e[e.default=0]="default",e[e.leave=1]="leave",e[e.roam=2]="roam"}(tn||(tn={}));var ln={number:function(e,t){if(void 0!==e[t])return+e[t]},string:function(e,t){if(void 0!==e[t])return e[t]},boolean:function(e,t){return+e[t]>0||0!=+e[t]&&void 0},enum:function(e,t,n){return n.values[e[t]]},object:function(e,t){if(void 0!==e[t])try{return JSON.parse(e[t])}catch(n){return{}}}};function dn(e,t){if(!Ae(t))return{};var n=JSON.parse(JSON.stringify(t)),r=un(e,n);return JSON.parse(JSON.stringify(Object.assign(Object.assign({},n),r)))}function un(e,t){if(!Ae(t))return Object.keys(e).reduce((t,n)=>(t[e[n].rawKey||n]=void 0,t),{});var n={};return Object.keys(e).forEach(r=>{var i=e[r].type;if("string"!=typeof i){var o=un(e[r],t[r]);return Object.assign(n,o),void(t[r]=void 0)}var s=e[r],a=s.rawKey||r,c=pn[i](t,r,s);t[a]=void 0,n[a]=c}),n}var pn={number:function(e,t){return e[t]},string:function(e,t){return e[t]},boolean:function(e,t){return!0===e[t]?1:!1===e[t]?0:void 0},enum:function(e,t,n){return n.values[e[t]]},object:function(e,t){if(void 0!==e[t])try{return JSON.stringify(e[t])}catch(n){return""}}},hn=pn;function gn(e,t){return e&&e.length>0?e.map(e=>Object.assign(Object.assign({},e),{account:e.account,connectionId:e.connectionId,deviceId:e.deviceId,ip:e.ip,mac:e.mac,os:e.os,type:Be(Zt,e.type)||e.type,time:parseInt(e.time),online:3!==t})):[]}var mn={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}},fn=vn;function vn(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}vn.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},vn.prototype.reset=function(){this.attempts=0},vn.prototype.setMin=function(e){this.ms=e},vn.prototype.setMax=function(e){this.max=e},vn.prototype.setJitter=function(e){this.jitter=e};var yn,_n=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],In=["transport not supported","client not handshaken","unauthorized"],Tn=["reconnect"];class Sn extends oe{constructor(e,t,n){super(),this.websocket=null,this.socketConnectTimer=0,this.url="",this.linkSSL=!0,this.core=e,this.url=t,this.linkSSL=n,this.status="disconnected",this.logger=e.logger,this.connect()}connect(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request(`${this.linkSSL?"https":"http"}://${this.url}/socket.io/1/?t=${Date.now()}`,{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then(e=>{if("connecting"===this.status){var[t,n]=e.data.split(":");return this.sessionId=t,this.logger.log(`imsocket::XHR success. status ${this.status}, ${"connecting"===this.status?"continue websocket connection":"stop websocket connection"}`),this._createWebsocket(`${this.linkSSL?"wss":"ws"}://${this.url}/socket.io/1/websocket/${t}`)}}).catch(e=>{if("connecting"===this.status){var t=`imsocket::XHR fail. raw message: "${(e=e||{}).message}", code: "${e.code}"`,n=e.code;n="v2"===Ve(this.core,"options.apiVersion")?e.code===le.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?le.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:le.V2NIM_ERROR_CODE_CONNECT_FAILED:408===e.code?408:415;var r=new pe({code:n,detail:{reason:t,rawError:e}});this.logger.error(t),this.status="disconnected",this.emit("handshakeFailed",r)}})):this.logger.warn("imsocket::socket is connecting or connected",this.status)}close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(ie){this.logger.warn("imsocket::attempt to send encodePacket error",ie)}try{this.websocket.close()}catch(ie){this.logger.warn("imsocket::attempt to close websocket error",ie)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}}clean(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)}onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)}_createWebsocket(e){this.socketConnectTimer=setTimeout(()=>{this.logger.error("imsocket::Websocket connect timeout. url: ",this.socketUrl),this.emit("handshakeFailed",new pe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:`imsocket::Websocket connect timeout. url: ${this.socketUrl}`}}))},this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new we.WebSocket(e),this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onclose=e=>{e=e||{},this.logger.log(`imsocket::Websocket onclose done ${e.wasClean}/${e.code}/${e.reason}`),this.clean(),this.emit("disconnect",{code:e.code||0,reason:e.reason})},this.websocket.onerror=e=>{this.logger.error("imsocket::Websocket onerror",e),"logined"===this.core.status&&this.core.clientSocket.ping()}}onMessage(e){var t,n=this.decodePacket(e.data);if(n)switch(n.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",n.data);break;case"event":n.name&&this.emit(n.name,n.args);break;case"error":"unauthorized"===n.reason?this.emit("connect_failed",n.reason):this.emit("error",n.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new pe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:`imsocket::Websocket connect failed, onMessage socket error. url: ${this.socketUrl}`}}));break;case"heartbeat":null===(t=this.websocket)||void 0===t||t.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",n.type)}}encodePacket(e){var t,n,{type:r,id:i="",endpoint:o="",ack:s}=e,a=null;if(!r)return"";switch(r){case"error":t=e.reason?In.indexOf(e.reason):"",n=e.advice?Tn.indexOf(e.advice):"",""===t&&""===n||(a=t+(""!==n?"+"+n:""));break;case"message":""!==e.data&&(a=e.data);break;case"event":t={name:e.name},t=e.args&&e.args.length?{name:e.name,args:e.args}:{name:e.name},a=JSON.stringify(t);break;case"json":a=JSON.stringify(e.data);break;case"connect":e.qs&&(a=e.qs);break;case"ack":a=e.ackId+(e.args&&e.args.length?"+"+JSON.stringify(e.args):"")}var c=[_n.indexOf(r),i+("data"===s?"+":""),o];return null!=a&&c.push(a),c.join(":")}decodePacket(e){if(e)if("�"!=e.charAt(0)){var t=e.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(t){var n,[,r,i,o,s,a]=t,c={type:_n[+r],endpoint:s};switch(i&&(c.id=i,c.ack=!o||"data"),c.type){case"error":n=a.split("+"),c.reason=In[+n[0]]||"";break;case"message":c.data=a||"";break;case"connect":c.qs=a||"";break;case"event":try{var l=JSON.parse(a);c.name=l.name,c.args=l.args}catch(d){this.logger.error("imsocket::parseData::type::event error",d)}c.args=c.args||[];break;case"json":try{c.data=JSON.parse(a)}catch(d){this.logger.error("imsocket::parseData::type::json error",d)}break;case"ack":if((n=a.match(/^([0-9]+)(\+)?(.*)/))&&(c.ackId=n[1],c.args=[],n[3]))try{c.args=n[3]?JSON.parse(n[3]):[]}catch(d){this.logger.error("imsocket::parseData::type::ack error",d)}}return c}}else this.logger.error("imsocket::unrecognize dataStr",e.slice(0,20))}send(e){var t,n={data:e,type:"message",endpoint:""};null===(t=this.websocket)||void 0===t||t.send(this.encodePacket(n))}}function En(e){e=e||[];for(var t=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(yn||(yn={}));class Mn{constructor(e,t){this.linkUrls=[],this.isAutoReconnect=!1,this.packetTimeout=3e4,this.linkSSL=!0,this.packetSer=1,this.retryCount=0,this.reconnectTimer=0,this.backoff=new fn({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Map,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,t&&(this.auth=t),this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager}setSessionId(e){}setLinkSSL(e){this.linkSSL=e}connect(e={},t){return Ce(this,void 0,void 0,function*(){if(Te({linkUrls:{type:"array",itemType:"string",required:!1}},e),!/^(unconnected|waitReconnect)$/.test(this.core.status)){var n=`Core socket status is ${this.core.status}, and would not connect`;return this.logger.warn(n),Promise.reject(n)}this.core.status="connecting",e.linkUrls&&e.linkUrls.length>0&&(this.linkUrls=e.linkUrls.concat(this.linkUrls),this.linkUrls=En(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push(Je);for(var r=0;r<this.linkUrls.length;r++){var i=this.linkUrls[r],o=(new Date).getTime();try{return yield this.doConnect(i),this.core.status="connected",this.logger.log(`clientsocketV1::connect success with url: ${i}`),i}catch(a){var s=a;t&&t(s,i),this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,start_time:o,action:0,exception_service:6}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof s.code?s.code:0,description:s.message||`${s.code}`,operation_type:0,target:i},{asyncParams:we.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn(`clientsocketV1::connect failed with url: ${i}`,a)}}throw 0===this.retryCount?this.doDisconnect(yn.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(yn.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("clientSocketV1::socket xhr or socket connect failed")})}doConnect(e){var t=!1;return new Promise((n,r)=>{this.socket=new Sn(this.core,e,this.linkSSL),this.socket.on("connect",()=>{this.logger.log("clientSocketV1::on connect",e),this.core.reporterHookLinkKeep&&(this.core.reporterHookLinkKeep.start(),this.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e})),t=!0,n()}),this.socket.on("message",this.onMessage.bind(this)),this.socket.on("disconnect",n=>Ce(this,void 0,void 0,function*(){this.logger.log("clientSocketV1::socket on disconnect",n),this.core.reporterHookLinkKeep&&(yield this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e}),this.core.reporterHookLinkKeep.end(!1)),t=!0,this.doDisconnect(yn.OFFLINE,"SocketOnDisconnect")})),this.socket.on("handshakeFailed",e=>{t?this.ping():(this.logger.error(`clientsocketV1::handshake failed: "${e&&e.message}"`),this.cleanSocket()),t=!0,r(e)})})}cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)}beforeConnect(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)}resetConnectStatus(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()}doDisconnect(e,t,n){var r,i,o,s,a;if(this.logger.log(`doDisconnect:type:${e},description:${t}`),"unconnected"!==this.core.status){var c={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new pe({code:415,desc:"Packet timeout due to instance disconnect",detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket();var l=!this.core.options.needReconnect||this.retryCount>=this.core.options.reconnectionAttempts;if(e===yn.ACTIVE||l)this.logger.log("doDisconnect: emit disconnect, type "+e,l),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(r=this.auth)||void 0===r||r.emit("disconnect"),this.destroyOnlineListener();else if(e===yn.KICKED){this.logger.log("doDisconnect: kicked"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var d="string"==typeof t?{reason:"unknow",message:t}:t;this.core.eventBus.emit("kicked",d),this.core.emit("kicked",d),null===(i=this.auth)||void 0===i||i.emit("kicked",d),this.destroyOnlineListener()}else e===yn.OFFLINE&&this.core.V1NIMLoginService.isManualLoginAttempt?(this.logger.log("doDisconnect: offline in manual login phase. no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener()):e===yn.OFFLINE&&(null===(s=null===(o=this.auth)||void 0===o?void 0:o.authenticator)||void 0===s?void 0:s.checkLoginTerminalCode(null==n?void 0:n.code))?(this.logger.log(`doDisconnect: login terminal code ${null==n?void 0:n.code}, no reconnect`),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener(),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(a=this.auth)||void 0===a||a.emit("disconnect")):e===yn.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect:already unconnected")}attempToReconnect(){var e,t;if("waitReconnect"!==this.core.status){0===this.retryCount&&(this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(e=this.auth)||void 0===e||e.emit("disconnect"));var n=this.backoff.duration();this.retryCount++,this.logger.log(`willReconnect ${this.retryCount} ${n}`),this.core.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:n}),this.core.emit("willReconnect",{retryCount:this.retryCount,duration:n}),null===(t=this.auth)||void 0===t||t.emit("willReconnect",{retryCount:this.retryCount,duration:n}),this.core.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout(()=>Ce(this,void 0,void 0,function*(){"waitReconnect"===this.core.status?!1===(yield we.net.getNetworkStatus()).net_connect?(this.logger.log("doDisconnect: skip this reconnection attempt because network is offline"),this.core.status="connecting",this.retryCount>=this.core.options.reconnectionAttempts?this.doDisconnect(yn.OFFLINE,"MaxReconnectionAttemptExceed"):this.attempToReconnect()):this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch(()=>{this.logger.error(`clientsocketV1::attempToReconnect failed ${this.retryCount}`)}):this.logger.warn(`doDisconnect: reconnectTimer status is ${this.core.status}, would not go on reconnecting`)}),n)}else this.logger.warn("doDisconnect: already is waiting reconnect")}sendCmd(e,t,n){if("logined"!==this.core.status&&"login"!==e&&"chatroomLogin"!==e&&"qchatLogin"!==e)return this.logger.warn(`instance status is ${this.core.status}, so can not sendCmd ${e}`),Promise.reject({cmd:e,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return Promise.reject("No_socket");var r="heartbeat"!==e,i=r?this.packetSer++:0,o=$t(e,i,this.logger,t);if(!o){var s=`SendCmd ${i} ${e} error`;return this.logger.error(s),Promise.reject(new Error(s))}var{packet:a,hasPacketResponse:c,hasPacketTimer:l}=o,d=JSON.stringify(a);r&&(this.logger.getDebugMode()?this.logger.debug("clientsocketV1::sendCmd",e,`ser:${i}`,d):this.logger.log("clientsocketV1::sendCmd",e,`ser:${i}`));var u=(new Date).getTime();return new Promise((r,o)=>{c&&this.sendingCmdMap.set(i,{cmd:e,params:t,callback:[r,o],timer:l?setTimeout(()=>{var t=new pe({code:408,desc:"Packet Timeout",detail:{reason:"Packet Timeout",cmd:e,ser:i,timetag:Date.now()}});this.markCmdInvalid(i,t,e)},n&&n.timeout?n.timeout:this.core.config.timeout):null});try{this.socket.send(d),c||r(a)}catch(u){var s=new pe({code:415,detail:{reason:u&&u.message||"Unable to send packet",cmd:e,ser:i,timetag:Date.now(),rawError:u}});this.markCmdInvalid(i,s,e),o(u)}}).catch(e=>{var t;if(![408,415].includes(e.code))return Promise.reject(e);this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,trace_id:null===(t=this.socket)||void 0===t?void 0:t.sessionId,start_time:u,action:2,exception_service:6});var n=Ve(e,"data.disconnect_reason")||"",r=408===e.code?"Send failed due to timeout":"Send failed. Reason unknown";return r=415===e.code?JSON.stringify({disconnect_reason:n}):r,this.reporter.reportTraceUpdateV2("exceptions",{code:e.code||415,description:r,operation_type:1,target:`${a.SID}-${a.CID}`,context:`${a.SER}`},{asyncParams:we.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),Promise.reject(e)})}onMessage(e){var t=Bt(e,this.logger);if(t&&t.length>0){var n=t[0],r=n.raw.ser;for(var i of(n.error&&this.logger.error("core:onMessage packet error",`${n.raw.sid}_${n.raw.cid}, ser:${r},`,n.error),"heartbeat"!==n.cmd&&(this.logger.getDebugMode()?this.logger.debug(`imsocket::recvCmd ser:${r}`,n.cmd,n.content):this.logger.log(`imsocket::recvCmd ser:${r}`,n.cmd)),t))this.packetHandler(i)}}packetHandler(e){var t,n,r,i;if(e){var o=e.raw.ser,s=this.sendingCmdMap.get(o);if(s&&s.cmd===e.cmd){var{callback:a,timer:c,params:l}=s;if(clearTimeout(c),e.params=l,this.sendingCmdMap.delete(o),"heartbeat"===e.cmd)return void a[0]();var d=null===(n=null===(t=this.core[e.service])||void 0===t?void 0:t.process)||void 0===n?void 0:n.call(t,e);d&&"function"==typeof d.then?d.then(e=>{a[0](e)}).catch(e=>{a[1](e)}):(this.logger.log("imsocket:: handlerFn without promise",e.service,e.cmd),a[0]())}else{var u=null===(i=null===(r=this.core[e.service])||void 0===r?void 0:r.process)||void 0===i?void 0:i.call(r,e);u&&"function"==typeof u.then&&u.catch(e=>{this.logger.error("imsocket::no obj cache, no process handler",e)})}}}markCmdInvalid(e,t,n){var r=this.sendingCmdMap.get(e);if(r){var{callback:i,timer:o}=r;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn(`packet ${e}, ${n} is invalid:`,t),i[1](t)}}markAllCmdInvaild(e){this.logger.log("markAllCmdInvaild",e),this.sendingCmdMap.forEach(t=>{var{callback:n,timer:r,cmd:i}=t;this.logger.log(`markAllCmdInvaild:: cmd "${i}"`),r&&clearTimeout(r),n[1](e)}),this.sendingCmdMap.clear()}ping(){var e;return Ce(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);try{yield this.sendCmd("heartbeat")}catch(t){if(yield this.testHeartBeat5Timeout())return this.core.reporterHookLinkKeep&&(yield this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url}),this.core.reporterHookLinkKeep.end(!0)),void this.doDisconnect(yn.OFFLINE,"PingError")}this.pingTimer=setTimeout(()=>{this.ping()},3e4)})}testHeartBeat5Timeout(){return Ce(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);for(var e=0;e<5;e++)try{return yield this.sendCmd("heartbeat",{},{timeout:3e3}),!1}catch(t){this.logger.log(`clientsocketV1:: test heartbeat ${e} Timeout`)}return!0})}initOnlineListener(){this.hasNetworkListener||(this.logger.log("clientsocketV1::onlineListener:init"),this.hasNetworkListener=!0,we.net.onNetworkStatusChange(e=>{this.logger.log("clientsocketV1::onlineListener:network change",e),e.isConnected&&"logined"===this.core.status?this.ping():e.isConnected&&"waitReconnect"===this.core.status?(this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch(()=>{this.logger.error(`clientsocketV1::attempToReconnect failed ${this.retryCount}`)})):e.isConnected||this.doDisconnect(yn.OFFLINE,"OfflineListener")}))}destroyOnlineListener(){this.logger.log("clientsocketV1::onlineListener:destroy"),we.net.offNetworkStatusChange(),this.hasNetworkListener=!1}disconnect(){switch(this.core.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(yn.ACTIVE,"UserActiveDisconnect"),Promise.resolve();default:return Promise.resolve()}}}class bn{constructor(e){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=e,this.auth=e.V1NIMLoginService,this.logger=this.core.logger}getLbsInfos(){return Ce(this,void 0,void 0,function*(){if(this.socketLinkUrls.length>0){var e=this.socketLinkUrls;return this.socketLinkUrls=[],this.core.logger.log("V1NIMLoginService::getLbsInfos:use cache link",e),Promise.resolve(e)}this.core.reporterHookLBS.start(this.core.account);var t=En(this.auth.config.lbsUrls);try{var n=yield this.ladderLoad(t);if(200!==n.status||!n.data)throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",n.status,n),new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:`V1NIMLoginService::getLbsInfos failed, status ${n.status}`}});this.success(n)}catch(i){var r=i;if(this.core.logger.error(`V1NIMLoginService::lbs getLbsInfos error, use default link: ${this.auth.config.linkUrl}. error:`,i),this.reportForFail(t[0],r.code,r.message),this.checkTerminator(r.code))throw i;this.socketLinkUrls=[this.auth.config.linkUrl]}return this.socketLinkUrls})}checkTerminator(e){return e===le.V2NIM_ERROR_CODE_CANCELLED||e===le.V2NIM_ERROR_CODE_TIMEOUT}generateUrl(e){var t=(e=this.processLbsUrl(e)).indexOf("?")>-1?"&":"?";return e+t+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"}processLbsUrl(e){return je()?e.replace("/webconf","/wxwebconf"):e}requstLbs(e){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(e),{method:"GET",dataType:"json",timeout:8e3}))}setLadderTimer(e,t,n,r){this.timer&&clearTimeout(this.timer);var i=e[t];this.timer=setTimeout(()=>{i&&(this.setLadderTimer(e,t+1,n,r),this.core.logger.log(`V1NIMLoginService::getLbsInfos ${t}:`,this.processLbsUrl(i)),this.reportForLbsStart(i,t),this.requstLbs(i).then(e=>{this.reset(),n(Object.assign(Object.assign({},e),{url:i}))}).catch(n=>{var o;if(this.core.logger.warn(`V1NIMLoginService::getLbsInfos ${t} failed:`,n),this.failedCount+=1,this.reportForFailOnce(i,n.code,(null===(o=n.detail)||void 0===o?void 0:o.reason)||n.message),this.failedCount>=e.length||this.checkTerminator(n.code))return this.reset(),void r(n)}))},2e3)}ladderLoad(e){return new Promise((t,n)=>{e.length>1&&this.setLadderTimer(e,1,t,n);var r=e[0];this.core.logger.log("V1NIMLoginService::getLbsInfos 0:",r),this.reportForLbsStart(r,0),this.requstLbs(r).then(e=>{this.reset(),t(Object.assign(Object.assign({},e),{url:r}))}).catch(t=>{var i;this.failedCount+=1,this.core.logger.warn("V1NIMLoginService::getLbsInfos 0 failed:",t),this.reportForFailOnce(r,t.code,(null===(i=t.detail)||void 0===i?void 0:i.reason)||t.message),(this.failedCount>=e.length||this.checkTerminator(t.code))&&(this.reset(),n(t))})})}success(e){var t,n,r=e.data,i=[this.auth.config.linkUrl];Ve(r,"common.link")&&(i=Ve(r,"common.link").concat(i)),Ve(r,'common["link.default"]')&&(i=i.concat(Ve(r,'common["link.default"]'))),this.socketLinkUrls=i,r["nos-chunk"]&&(this.logger.log("getLbsInfos success. lbs.nos-chunk",r["nos-chunk"]),null===(t=this.core.cloudStorage)||void 0===t||t.setOptions({chunkUploadHost:r["nos-chunk"]})),Array.isArray(r.nosup)&&r.nosup.length>0&&(this.logger.log("getLbsInfos success. lbs.nosup",r.nosup),null===(n=this.core.cloudStorage)||void 0===n||n.setOptions({commonUploadHostBackupList:r.nosup,commonUploadHost:r.nosup[0]})),this.core.logger.log("V1NIMLoginService::getLbsInfos success, socket link:",this.socketLinkUrls.slice(0),"chunkUploadHost: ",e.data["nos-chunk"]),this.reportForLbsSuccess(e.url,e.data)}reportForLbsStart(e,t){this.core.reporterHookLBS.updateBegin({target:e,index:t})}reportForLbsSuccess(e,t){this.core.reporterHookLBS.updateComplete({target:e,code:200,body:JSON.stringify(t)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,code:200,succeed:!0},{asyncParams:we.net.getNetworkStatus()})}reportForFailOnce(e,t,n){this.core.reporterHookLBS.updateComplete({target:e,code:t,body:n})}reportForFail(e,t,n){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,description:n,code:t,succeed:!1},{asyncParams:we.net.getNetworkStatus()})}reset(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)}}class Cn{constructor(e){this.core=e}verifyAuthentication(e=!1){var t,n,r;return Ce(this,void 0,void 0,function*(){var i=this.core.options,o=we.getSystemInfo(),s=Object.assign(Object.assign({},i),{appLogin:e?0:1,appkey:i.appkey,account:i.account,token:i.token,deviceId:this.core.auth.deviceId,clientSession:this.core.auth.clientSession,clientType:16,protocolVersion:1,sdkVersion:100941,sdkHumanVersion:"10.9.41",os:o.os,browser:o.browser,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.9.41":o.userAgent.replace("{{appkey}}",i.appkey).slice(0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:o.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:o.hostEnvEnum}),a=o.os.toLowerCase();if("UNIAPP"===we.platform&&("ios"===a||"android"===a)){s.isReactNative=1,s.clientType="ios"===a?2:1;var c=!!(null===(t=this.core.offlinePush.authConfig)||void 0===t?void 0:t.honorCertificateName);o.pushDeviceInfo&&o.pushDeviceInfo.MANUFACTURER&&(s.deviceInfo=JSON.stringify(Object.assign({IS_SUPPORT_HONOR:c},o.pushDeviceInfo)))}this.core.logger.log(`clientSocketV1::do login,accid:${i.account};clientSession:${null===(r=null===(n=this.core.clientSocket)||void 0===n?void 0:n.socket)||void 0===r?void 0:r.sessionId}`);var l=yield this.core.clientSocket.sendCmd("login",{login:s});if(l.error)throw l.error;var{loginRes:d,loginPorts:u,aosPushInfo:p}=l.content,h=gn(u,2);return(h=h.filter(e=>e.connectionId!==d.connectionId)).length>0&&this.core.emit("multiPortLogin",h),Object.assign(Object.assign({},d),{aosPushInfo:p})})}checkLoginTerminalCode(e){return void 0!==e&&[201,302,317,403,404,417,422].includes(e)}}class An extends oe{constructor(e,t){super(),this.name=e,this.logger=t.logger,this.core=t}checkV2(){var e=this.core.options.apiVersion;if("v2"===e)return!0;throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:`The version "${e}" of client is not supported.`}})}checkLogin(){if(0===this.core.V2NIMLoginService.getLoginStatus())throw new pe({code:le.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Client logout."}})}emit(e,...t){this.logger.debug(`${this.name}::emit event: '${e.toString()}',`,void 0!==t[0]?t[0]:"",void 0!==t[1]?t[1]:"",void 0!==t[2]?t[2]:"");try{return super.emit(e,...t)}catch(n){return setTimeout(()=>{throw this.logger.error(`${this.name}::emit throw error in setTimeout. event: ${e.toString()}. Error`,n),n},0),!1}}process(e){var t=this[e.cmd+"Handler"],n=this.handler&&this.handler[e.cmd+"Handler"];if("function"==typeof t||"function"==typeof n){if(e.error)return this.logger.error(`${e.cmd}::recvError`,e.error),Promise.reject(e.error);try{var r=t?t.call(this,e):n.call(this.handler,e);return Promise.resolve(r)}catch(o){return Promise.reject(o)}}var i=Ve(e,"error.detail.ignore");return e.error&&!i?Promise.reject(e.error):Promise.resolve(e)}}class On{constructor(e,t){this.name=e,this.core=t,this.name=e,this.logger=t.logger,this.core=t}process(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e);var n=Ve(e,"error.detail.ignore");return e.error&&!n?Promise.reject(e.error):Promise.resolve(e)}}var Rn={"6_3":"notifylog","6_4":"uploadLog","6_23":"getServerTime","6_31":"notifyDetect","6_32":"uploadDetect","6_37":"wsDetect"},Nn={type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},wn={k1:1,k2:2,k3:3,k4:4,k5:5,k6:6,k7:7,k8:8,k9:9,k10:10},Pn={notifylog:{sid:6,cid:3,service:"misc"},uploadLog:{sid:6,cid:4,service:"misc",hasPacketResponse:!1,params:[{type:"String",name:"url"},{type:"Property",name:"data",reflectMapper:{type:1,content:2}}]},getServerTime:{sid:6,cid:23,service:"misc",response:[{type:"Long",name:"time"}]},notifyDetect:{sid:6,cid:31,service:"misc",response:[{type:"Property",name:"data",reflectMapper:Wt(Nn)}]},uploadDetect:{sid:6,cid:32,service:"misc",hasPacketResponse:!1,params:[{type:"Property",name:"data",reflectMapper:Nn}]},wsDetect:{sid:6,cid:37,service:"misc",params:[{type:"Property",name:"tag",reflectMapper:wn}],response:[{type:"Property",name:"data",reflectMapper:Wt(wn)}]}},kn={type:{type:"number"},t1:{type:"number"},t2:{type:"number"},t3:{type:"number"},t4:{type:"number"},t5:{type:"number"},t6:{type:"number"}};class Ln extends On{constructor(e){super("misc",e),this.logLock=!1,this.core=e,Gt({cmdMap:Rn,cmdConfig:Pn}),this.setListener()}setListener(){this.core.eventBus.on("BinaryClientSocket/unpackError",this.wsDetect.bind(this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.core.timeOrigin.setOriginTimetick()}),this.core.eventBus.on("logined",()=>{this.core.timeOrigin.setOriginTimetick()})}getServerTime(){return Ce(this,void 0,void 0,function*(){var e=yield this.core.clientSocket.sendCmd("getServerTime");return parseInt(e.content.time)})}wsDetect(e){return Ce(this,void 0,void 0,function*(){var t=Object.assign({k1:"val1",k2:"val2"},e),n=null;try{n=(yield this.core.clientSocket.sendCmd("wsDetect",{tag:t})).content.data}catch(i){var r=i;return void(r.code===le.V2NIM_ERROR_CODE_UNPACK_ERROR?(this.logger.warn("misc::wsDetect:998"),this.wsDetectUnreliable(),this.reportBinarySocketDetectResult("packet 998")):this.logger.warn(`misc::wsDetect:failed ${r.code}`))}n&&JSON.stringify(n)!==JSON.stringify(t)?(this.logger.warn("misc::wsDetect:content unreliable"),this.wsDetectUnreliable(),this.reportBinarySocketDetectResult("content unreliable")):this.logger.log("misc::wsDetect:success")})}wsDetectUnreliable(){this.core.clientSocket.doDisconnect(3,"WSDetectUnreliable")}reportBinarySocketDetectResult(e){var t;this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.account,trace_id:null===(t=this.core.clientSocket.socket)||void 0===t?void 0:t.sessionId,start_time:Date.now(),action:2,exception_service:9}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:998,description:`wsDetect::reconnect cause: ${e}`,operation_type:"5",target:"6-37"}),this.core.reporter.reportTraceEnd("exceptions",1)}notifyDetectHandler(e){return Ce(this,void 0,void 0,function*(){var t,n=(t=e.content.data,an(kn,t));n.t3=e.__receiveTimeNode.time,n.t4=Date.now();try{yield this.core.clientSocket.sendCmd("uploadDetect",{data:n})}catch(t){this.core.logger.warn("misc::notifyDetectHandler:upload failed",t)}})}notifylogHandler(){return Ce(this,void 0,void 0,function*(){var e=void 0;if(this.logLock)this.core.logger.warn("misc::notifylogHandler:locked");else{this.logLock=!0;try{e=yield this.core.logger.extractLogs()}catch(n){return void(this.logLock=!1)}if(e){var t="";try{t=(yield this.core.cloudStorage.uploadFile("string"==typeof e?{type:"file",filePath:e}:{type:"file",file:e})).url}catch(n){return void(this.logLock=!1)}if(t){t+=(t.indexOf("?")>0?"&":"?")+"download="+(new Date).getTime()+"_web.log";try{yield this.core.clientSocket.sendCmd("uploadLog",{url:t})}catch(n){return void(this.logLock=!1)}try{yield this.logger.afterUpload()}catch(n){}this.logLock=!1}else this.logLock=!1}else this.logLock=!1}})}}var xn={needReconnect:!0,reconnectionAttempts:Number.MAX_SAFE_INTEGER,lbsUrls:Xe,linkUrl:Je,xhrConnectTimeout:8e3,socketConnectTimeout:8e3,linkSSL:!0};function Vn(e){return an({type:{type:"number"},port:{type:"number"},customClientType:{type:"number"},timestamp:{type:"number"},loginType:{type:"number"}},e)}var Dn={"26_3":"v2Login","26_5":"v2Logout","26_8":"v2KickOffline","26_9":"v2BeKicked","26_10":"v2LoginClientChange","36_1":"v2GetChatroomLinkAddress"},Un={"1_2":"heartbeat","2_7":"nimLoginClientChange","24_8":"qchatLoginClientChange"},$n={webLoginReqTag:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,clientId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,thirdPartyExtension:116,env:119,isRoutable:120,token:1e3},mixAuthRepTag:{clientId:1,consid:2,clientIP:3,port:4,type:5,customClientType:6,timestamp:7,customTag:8,os:9,pushType:10,hasTokenPreviously:11,loginType:12},nimAuthRepTag:{type:3,os:4,mac:5,clientId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,consid:102,clientIP:103,port:104,timestamp:109,pushType:110,hasTokenPreviously:111},qchatAuthRepTag:{clientId:8,consid:102,clientIP:103,port:104,type:6,customClientType:13,timestamp:105,os:30,pushType:100,hasTokenPreviously:101}},Bn={v2Login:{sid:26,cid:3,service:"auth",params:[{type:"Property",name:"tag",reflectMapper:$n.webLoginReqTag}],response:[{type:"Property",name:"data",reflectMapper:Wt($n.mixAuthRepTag)},{type:"PropertyArray",name:"loginClients",reflectMapper:Wt($n.mixAuthRepTag)}]},v2Logout:{sid:26,cid:5,service:"auth"},v2KickOffline:{sid:26,cid:8,service:"auth",params:[{type:"StrArray",name:"clientIds"}],response:[{type:"StrArray",name:"clientIds"}]},v2BeKicked:{sid:26,cid:9,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"reasonDesc"},{type:"Int",name:"customClientType"}]},v2LoginClientChange:{sid:26,cid:10,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Wt($n.mixAuthRepTag)}]},v2GetChatroomLinkAddress:{sid:36,cid:1,service:"auth",params:[{type:"Long",name:"roomId"},{type:"Bool",name:"miniProgram"}],response:[{type:"StrArray",name:"linkAddress"}]}},Fn={heartbeat:{sid:1,cid:2,service:"auth"},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Wt($n.nimAuthRepTag)}]},qchatLoginClientChange:{sid:24,cid:8,service:"auth",response:[{type:"Byte",name:"state"},{type:"Property",name:"data",reflectMapper:Wt($n.qchatAuthRepTag)}]}},jn=function(e){var t;if(void 0!==e)return(t=zn(e)).sign=1,t},qn=function(e){return"[object Array]"===Object.prototype.toString.call(e)},Gn=function(e){return["number"==typeof e,"string"==typeof e&&e.length>0,qn(e)&&e.length>0,e instanceof zn].some(function(e){return!0===e})},Hn="Invalid Number",Wn="Invalid Number - Division By Zero";function zn(e){var t;if(!(this instanceof zn))return new zn(e);if(this.number=[],this.sign=1,this.rest=0,Gn(e)){if(qn(e)){for((e.length&&"-"===e[0]||"+"===e[0])&&(this.sign="+"===e[0]?1:-1,e.shift(0)),t=e.length-1;t>=0;t--)if(!this.addDigit(e[t]))return}else for("-"!==(e=e.toString()).charAt(0)&&"+"!==e.charAt(0)||(this.sign="+"===e.charAt(0)?1:-1,e=e.substring(1)),t=e.length-1;t>=0;t--)if(!this.addDigit(parseInt(e.charAt(t),10)))return}else this.number=Hn}zn.prototype.addDigit=function(e){return/^\d$/.test(e)?(this.number.push(e),this):(this.number=Hn,!1)},zn.prototype._compare=function(e){var t,n;if(!Gn(e))return null;if(t=zn(e),this.sign!==t.sign)return this.sign;if(this.number.length>t.number.length)return this.sign;if(this.number.length<t.number.length)return-1*this.sign;for(n=this.number.length-1;n>=0;n--){if(this.number[n]>t.number[n])return this.sign;if(this.number[n]<t.number[n])return-1*this.sign}return 0},zn.prototype.gt=function(e){return this._compare(e)>0},zn.prototype.gte=function(e){return this._compare(e)>=0},zn.prototype.equals=function(e){return 0===this._compare(e)},zn.prototype.lte=function(e){return this._compare(e)<=0},zn.prototype.lt=function(e){return this._compare(e)<0},zn.prototype.subtract=function(e){var t;return void 0===e?this:(t=zn(e),this.sign!==t.sign?(this.number=zn._add(this,t),this):(this.sign=this.lt(t)?-1:1,this.number=jn(this).lt(jn(t))?zn._subtract(t,this):zn._subtract(this,t),this))},zn._add=function(e,t){var n,r=0,i=Math.max(e.number.length,t.number.length);for(n=0;n<i||r>0;n++)e.number[n]=(r+=(e.number[n]||0)+(t.number[n]||0))%10,r=Math.floor(r/10);return e.number},zn._subtract=function(e,t){var n,r=0,i=e.number.length;for(n=0;n<i;n++)e.number[n]-=(t.number[n]||0)+r,e.number[n]+=10*(r=e.number[n]<0?1:0);for(n=0,i=e.number.length-1;0===e.number[i-n]&&i-n>0;)n++;return n>0&&e.number.splice(-n),e.number},zn.prototype.multiply=function(e){if(void 0===e)return this;var t,n,r=zn(e),i=0,o=[];if(this.isZero()||r.isZero())return zn(0);for(this.sign*=r.sign,t=0;t<this.number.length;t++)for(i=0,n=0;n<r.number.length||i>0;n++)o[t+n]=(i+=(o[t+n]||0)+this.number[t]*(r.number[n]||0))%10,i=Math.floor(i/10);return this.number=o,this},zn.prototype.divide=function(e){if(void 0===e)return this;var t,n,r=zn(e),i=[],o=zn(0);if(r.isZero())return this.number=Wn,this;if(this.isZero())return this.rest=zn(0),this;if(this.sign*=r.sign,r.sign=1,1===r.number.length&&1===r.number[0])return this.rest=zn(0),this;for(t=this.number.length-1;t>=0;t--)for(o.multiply(10),o.number[0]=this.number[t],i[t]=0;r.lte(o);)i[t]++,o.subtract(r);for(t=0,n=i.length-1;0===i[n-t]&&n-t>0;)t++;return t>0&&i.splice(-t),this.rest=o,this.number=i,this},zn.prototype.mod=function(e){return this.divide(e).rest},zn.prototype.isZero=function(){var e;for(e=0;e<this.number.length;e++)if(0!==this.number[e])return!1;return!0},zn.prototype.toString=function(){var e,t="";if("string"==typeof this.number)return this.number;for(e=this.number.length-1;e>=0;e--)t+=this.number[e];return this.sign>0?t:"-"+t};var Kn,Yn,Jn=Math.pow(2,32);function Xn(e){for(var t=new Uint8Array(5),n=new DataView(t.buffer),r=0;4294967168&e;)n.setUint8(r++,127&e|128),e>>>=7;return n.setUint8(r++,127&e),t.slice(0,r)}function Qn(e){return"function"==typeof TextDecoder?new TextDecoder("utf-8").decode(e):function(e){for(var t="",n=0;n<e.length;){var r=e[n],i=0,o=0;if(r<=127?(i=0,o=255&r):r<=223?(i=1,o=31&r):r<=239?(i=2,o=15&r):r<=244&&(i=3,o=7&r),e.length-n-i>0)for(var s=0;s<i;)o=o<<6|63&(r=e[n+s+1]),s+=1;else o=65533,i=e.length-n;t+=String.fromCodePoint(o),n+=i+1}return t}(e)}class Zn{constructor(e){this.offset=0,this.buffer=new Uint8Array(e),this.view=new DataView(e)}checkBufferBoundaryAccess(){return this.offset>=this.buffer.byteLength}length(){var e;return(null===(e=this.view)||void 0===e?void 0:e.byteLength)||0}getBuffer(){return this.view.buffer}getOffset(){return this.offset}popRaw(e){try{var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}catch(n){throw new Error(`UnpackException raw ${n&&n.message}`)}}popByte(){try{var e=this.view.getUint8(this.offset);return this.offset+=1,e}catch(t){throw new Error(`UnpackException byte ${t&&t.message}`)}}popVarbin(){return this.popRaw(this.popVarInt())}popString(){try{return Qn(this.popVarbin())}catch(ie){throw new Error(`UnpackException string ${ie&&ie.message}`)}}popInt(){try{var e=this.view.getUint32(this.offset,!0);return this.offset+=4,e}catch(t){throw new Error(`UnpackException int ${t&&t.message}`)}}popVarInt(){var e=1,t=0,n=0,r=0;do{if(t+=(127&(n=this.popByte()))*e,e*=128,(r+=1)>5)throw new Error("Variable length quantity is too long")}while(128&n);return t}popLong(){try{var e=function(e,t=!1){var n=new DataView(e.buffer),[r,i]=t?[4,0]:[0,4],o=n.getUint32(r,t),s=n.getUint32(i,t);return o>0?o*Jn+s:s}(this.buffer.slice(this.offset,this.offset+8),!0);return this.offset+=8,Number(e)}catch(t){throw new Error(`UnpackException long ${t&&t.message}`)}}popShort(){try{var e=this.view.getUint16(this.offset,!0);return this.offset+=2,e}catch(t){throw new Error(`UnpackException short ${t&&t.message}`)}}popBoolean(){return this.popByte()>0}toString(){return Array.from(new Uint8Array(this.buffer)).toString()}reset(){this.offset=0,this.buffer=null,this.view=null}}class er{constructor(e){this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.resCode=200,this.innerHeader=null,this.msgId=0,this.bodyArr=[],this.unpack=new Zn(e)}reset(){this.innerHeader=null,this.bodyArr=[],this.unpack.reset()}getBodyDetail(){return this.bodyArr.join("")}unmarshalHeader(){var e=this._unmarshalHeader();this.packetLength=e.packetLength,this.serviceId=e.serviceId,this.commandId=e.commandId,this.serialId=e.serialId,this.tag=e.tag,this.resCode=e.resCode,4===e.serviceId&&[1,2,10,11].includes(e.commandId)&&(this.msgId=this.unmarshalLong(),this.innerHeader=this._unmarshalHeader())}_unmarshalHeader(){var e=this.unpack.popVarInt(),t=this.unpack.popByte(),n=this.unpack.popByte(),r=this.unpack.popShort(),i=this.unpack.popByte(),o=200;return this.hasRescode(i)&&(o=this.unpack.popShort()),{packetLength:e,serviceId:t,commandId:n,serialId:r,tag:i,resCode:o}}hasRescode(e){return 0!=((e=e||this.tag)&er.RES_CODE)}getHeader(){return{packetLength:this.packetLength,sid:this.serviceId,cid:this.commandId,ser:this.serialId,code:this.resCode}}getInnerHeader(){return this.innerHeader?{sid:this.innerHeader.serviceId,cid:this.innerHeader.commandId}:null}unmarshalProperty(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push(`\nProperty(${e}) {`);for(var n=0;n<e;n++){var r=this.unpack.popVarInt();this.bodyArr.push(`${r}:`);var i=this.unpack.popString();this.bodyArr.push(`"${i.length} ${this.unpack.getOffset()}",`),t[r]=i}return this.bodyArr.push("},"),t}unmarshalPropertyArray(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push(`\nPropertyArray(${e}) [`);for(var n=0;n<e;n++)t.push(this.unmarshalProperty());return this.bodyArr.push("],"),t}unmarshalLong(){var e=this.unpack.popLong();return this.bodyArr.push(`\nLong:${e}`),e}unmarshalLongArray(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push(`\nLongArray ${e}:`);for(var n=0;n<e;n++){var r=this.unpack.popLong();this.bodyArr.push(`${r},`),t.push(r)}return t}unmarshalStrArray(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push(`\nStrArray ${e}:`);for(var n=0;n<e;n++){var r=this.unpack.popString();this.bodyArr.push(`${r},`),t.push(r)}return t}unmarshalStrLongMap(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push(`\nStrLongMap ${e}:`);for(var n=0;n<e;n++){var r=this.unpack.popString();this.bodyArr.push(`${r},`);var i=this.unpack.popLong();this.bodyArr.push(`${i};`),t[r]=i}return t}unmarshalStrStrMap(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push(`\nStrStrMap ${e}:`);for(var n=0;n<e;n++){var r=this.unpack.popString();this.bodyArr.push(`${r},`);var i=this.unpack.popString();this.bodyArr.push(`${i};`),t[r]=i}return t}unmarshalLongLongMap(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push(`\nStrLongLongMap ${e}:`);for(var n=0;n<e;n++){var r=this.unpack.popLong();this.bodyArr.push(`${r},`);var i=this.unpack.popLong();this.bodyArr.push(`${i};`),t[r]=i}return{m_map:t}}unmarshalKVArray(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push(`\nKVArray ${e}:`);for(var n=0;n<e;n++)t.push(this.unmarshalStrStrMap());return t}unmarshal(e){var t=Object.assign(Object.assign({},this.getHeader()),{r:[]});if(this.innerHeader&&(t.r[0]=this.msgId,t.r[1]={body:[],headerPacket:this.getInnerHeader()}),![200,406,808,810,7101].includes(t.code))return JSON.stringify(t);if(this.packetLength>0&&this.packetLength>this.unpack.length())throw new Error(`UnpackException packetLength(${this.packetLength}) greater than bufferLength(${this.unpack.length()})`);var n=[];return e&&e.forEach(e=>{if(!this.unpack.checkBufferBoundaryAccess())switch(e.type){case"PropertyArray":n.push(this.unmarshalPropertyArray());break;case"Property":n.push(this.unmarshalProperty());break;case"Byte":n.push(this.unpack.popByte());break;case"Int":n.push(this.unpack.popInt());break;case"Bool":n.push(this.unpack.popBoolean());break;case"Long":n.push(this.unmarshalLong());break;case"LongArray":n.push(this.unmarshalLongArray());break;case"String":n.push(this.unpack.popString());break;case"StrArray":n.push(this.unmarshalStrArray());break;case"StrStrMap":n.push(this.unmarshalStrStrMap());break;case"StrLongMap":n.push(this.unmarshalStrLongMap());break;case"LongLongMap":n.push(this.unmarshalLongLongMap());break;case"KVArray":n.push(this.unmarshalKVArray())}}),this.innerHeader?t.r[1].body=n:t.r=n,JSON.stringify(t)}}er.RES_CODE=2;class tr{constructor(){this.offset=0,this.pageSize=1024,this.capacity=1048576,this.buffer=new Uint8Array(this.pageSize),this.view=new DataView(this.buffer.buffer)}reset(){this.offset=0,this.buffer=null,this.view=null}size(){return this.offset}getBuffer(){return this.buffer.slice(0,this.offset).buffer}ensureCapacity(e){var t=this.offset+e;if(t>this.capacity)throw new Error("PackException over limit");if(t>this.buffer.byteLength){var n=Math.ceil(t/this.pageSize)*this.pageSize,r=new Uint8Array(n);r.set(this.buffer),this.buffer=r,this.view=new DataView(this.buffer.buffer)}}putRaw(e){this.ensureCapacity(e.length);try{this.buffer.set(e,this.offset),this.offset+=e.length}catch(t){throw new Error("PackException raw")}}putByte(e){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,e)}catch(t){throw new Error("PackException byte")}}putString(e){try{var t=function(e){if("function"==typeof TextEncoder)return(new TextEncoder).encode(e);var t=function(e){for(var t=[],n=e.length,r=0;r<n;){var i=e.codePointAt(r),o=0,s=0;for(i<=127?(o=0,s=0):i<=2047?(o=6,s=192):i<=65535?(o=12,s=224):i<=2097151&&(o=18,s=240),t.push(s|i>>o),o-=6;o>=0;)t.push(128|i>>o&63),o-=6;r+=i>=65536?2:1}return t}(e);return new Uint8Array(t)}(e);this.putVarbin(t)}catch(n){throw new Error("PackException string")}}putInt(e){this.ensureCapacity(4);try{this.view.setInt32(this.offset,e,!0),this.offset+=4}catch(t){throw new Error("PackException int")}}putVarInt(e){var t=Xn(e);this.putRaw(t)}putBoolean(e){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,e?1:0)}catch(t){throw new Error("PackException boolean")}}putLong(e){this.ensureCapacity(8);try{var t=function(e,t=!1){var n=new Uint8Array(8),r=new DataView(n.buffer),i=Number(e>Jn-1?e/Jn:0),o=Number(4294967295&e),[s,a]=t?[4,0]:[0,4];return r.setUint32(s,i,t),r.setUint32(a,o,t),n}(e,!0);this.buffer.set(t,this.offset),this.offset+=8}catch(n){throw new Error("PackException long")}}putStringAsLong(e){this.ensureCapacity(8);try{var t=function(e,t=!1){var n=new Uint8Array(8),r=new DataView(n.buffer),i=zn(e).divide(Jn).number.reverse().join(""),o=zn(e).mod(Jn).number.reverse().join(""),s=Number(i),a=Number(o),[c,l]=t?[4,0]:[0,4];return r.setUint32(c,s,t),r.setUint32(l,a,t),n}(e,!0);this.buffer.set(t,this.offset),this.offset+=8}catch(n){throw new Error("PackException stringAsLong")}}putShort(e){this.ensureCapacity(2);try{this.view.setInt16(this.offset,e,!0),this.offset+=2}catch(t){throw new Error("PackException short")}}putVarbin(e){if(!e)return this.ensureCapacity(1),this.putVarInt(0);if(e.byteLength>Math.pow(2,31)-2)throw new Error("PackException varbin. too long");var t=Xn(e.length);this.ensureCapacity(t.length+e.length);try{this.buffer.set(t,this.offset),this.offset+=t.length,this.buffer.set(e,this.offset),this.offset+=e.length}catch(n){throw new Error("PackException varbin")}}}function nr(e){if("number"!=typeof e){if(null==e)return!1;e=Number(e)}if(isNaN(e))throw new Error("Number type conversion error");return!0}function rr(e){return null==e}class ir{constructor(e,t,n){this.pack=new tr,this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.serviceId=e,this.commandId=t,this.serialId=n}marshalHeader(){this.pack.putVarInt(this.packetLength),this.pack.putByte(this.serviceId),this.pack.putByte(this.commandId),this.pack.putShort(this.serialId),this.pack.putByte(this.tag)}marshalProperty(e){var t=Object.keys(e).filter(e=>!rr(e));this.pack.putVarInt(t.length),t.forEach(t=>{this.pack.putVarInt(Number(t)),Array.isArray(e[t])||"[object Object]"===Object.prototype.toString.call(e[t])?this.pack.putString(JSON.stringify(e[t])):this.pack.putString(String(e[t]))})}marshalPropertyArray(e){var t=e.length;this.pack.putVarInt(t),e.forEach(e=>{this.marshalProperty(null==e?void 0:e.v)})}marshalStrArray(e){var t=e.filter(e=>!rr(e)),n=t.length;this.pack.putVarInt(n),t.forEach(e=>{this.pack.putString(String(e))})}marshalLongArray(e){var t=e.filter(e=>nr(e)),n=t.length;this.pack.putVarInt(n),t.forEach(e=>{this.putLong(e)})}marshalStrStrMap(e){var t=Object.keys(e).filter(t=>!rr(e[t])&&!rr(t));this.pack.putVarInt(t.length),t.forEach(t=>{this.pack.putString(String(t)),this.pack.putString(String(e[t]))})}marshalStrLongMap(e){var t=Object.keys(e).filter(t=>nr(e[t])&&!rr(t));this.pack.putVarInt(t.length),t.forEach(t=>{this.pack.putString(String(t)),this.putLong(e[t])})}marshalLongLongMap(e){var t=Object.keys(e).filter(t=>{var n=Number(t);return nr(n)&&nr(e[n])});this.pack.putVarInt(t.length),t.forEach(t=>{var n=Number(t);this.putLong(n),this.putLong(e[n])})}marshalKVArray(e){var t=e.length;this.pack.putVarInt(t),e.forEach(e=>{this.marshalStrStrMap(e)})}putLong(e){"string"==typeof e&&e.length>15?this.pack.putStringAsLong(e):this.pack.putLong(Number(e))}marshal(e,t){return this.marshalHeader(),t&&t.forEach((t,n)=>{var r,i=t.type,o=null===(r=e[n])||void 0===r?void 0:r.v;if(!rr(o))switch(i){case"PropertyArray":this.marshalPropertyArray(o);break;case"Property":this.marshalProperty(o);break;case"Byte":if(!nr(o))return;this.pack.putByte(Number(o));break;case"Int":if(!nr(o))return;this.pack.putInt(Number(o));break;case"Bool":"false"===o?o=!1:"true"===o&&(o=!0),this.pack.putBoolean(o);break;case"Long":if(!nr(o))return;this.putLong(o);break;case"LongArray":this.marshalLongArray(o);break;case"String":this.pack.putString(String(o));break;case"StrArray":this.marshalStrArray(o);break;case"StrStrMap":this.marshalStrStrMap(o);break;case"StrLongMap":this.marshalStrLongMap(o);break;case"LongLongMap":this.marshalLongLongMap(o);break;case"KVArray":this.marshalKVArray(o)}}),this.pack.getBuffer()}reset(){this.pack.reset()}}class or extends oe{constructor(e,t,n){super(),this.websocket=null,this.socketConnectTimer=0,this.linkSSL=!0,this.url="",this.core=e,this.url=t,this.linkSSL=n,this.status="disconnected",this.logger=e.logger,this.connect()}connect(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this._createWebsocket(`${this.linkSSL?"wss":"ws"}://${this.url}/websocket`)):this.logger.warn("imsocket::socket is connecting or connected",this.status)}close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.close()}catch(ie){this.logger.warn("imsocket::attempt to close websocket error",ie)}this.clean(),this.emit("disconnect")}}clean(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)}onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)}_createWebsocket(e){this.socketConnectTimer=setTimeout(()=>{this.logger.error("imsocket::Websocket connect timeout. url: ",e),this.emit("connectFailed",new pe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:`imsocket::Websocket connect timeout. url: ${e}`}}))},this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new we.WebSocket(e),this.websocket.binaryType="arraybuffer",this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onclose=e=>{e=e||{},this.logger.log(`imsocket::Websocket onclose done ${e.wasClean}/${e.code}/${e.reason}`),"connected"===this.status?(this.clean(),this.emit("disconnect")):(this.clean(),this.emit("connectFailed",new pe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onclose done"}})))},this.websocket.onerror=e=>{this.logger.error("imsocket::Websocket onerror",e),"connected"===this.status?(this.clean(),this.emit("disconnect")):(this.clean(),this.emit("connectFailed",new pe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onerror."}})))},this.websocket.onopen=()=>{this.onConnect()}}onMessage(e){if(e.data){var t=new er(e.data),n={sid:-1,cid:-1,ser:-1,packetLength:-1},r=null;try{t.unmarshalHeader(),n=t.getHeader(),r=t.getInnerHeader()}catch(p){this.reportBinaryError({err:p,sid:r?r.sid:null==n?void 0:n.sid,cid:r?r.cid:null==n?void 0:n.cid,rawBuf:e.data,type:"decode"})}var i=r?r.sid:n.sid,o=r?r.cid:n.cid,s=`${i}_${o}`,a=Ut[s];if(a&&a.length>0){var c,l=a[0].config;try{c=t.unmarshal(l.response)}catch(h){var d=t.getBodyDetail();this.reportBinaryError({err:h,rawBuf:e.data,sid:i,cid:o,parseDetail:d,type:"decode"}),t.reset();var u=Object.assign(Object.assign({},n),{sid:i,cid:o,code:le.V2NIM_ERROR_CODE_UNPACK_ERROR});return this.logger.error(`imsocket::onMessage "${u.sid}_${u.cid}", ser ${u.ser}, packetLength ${u.packetLength} unmarshal error. ${d} \n`,h),void this.emit("message",JSON.stringify(u))}this.emit("message",c)}else this.core.logger.warn("imsocket::onMessage cmd not found",s);t.reset()}}send(e,t,n,r,i){var o,s,a=new ir(e,t,n),c=Dt[r],l="";try{l=JSON.stringify(i),s=a.marshal(JSON.parse(l),c.params)}catch(d){throw this.reportBinaryError({err:d,sid:e,cid:t,rawStr:l,type:"encode"}),a.reset(),new pe({code:le.V2NIM_ERROR_CODE_PACK_ERROR,detail:{reason:`${e}-${t}, ser ${n} marshal error`,rawError:d}})}null===(o=this.websocket)||void 0===o||o.send(s),a.reset()}reportBinaryError(e){var t,n,r,{err:i,rawStr:o,sid:s,cid:a,type:c,parseDetail:l}=e,d=e.rawBuf;if(d){try{r=function(e){if("function"!=typeof btoa)return"";for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return n=null,btoa(t)}(d)}catch(p){r=`reportBinaryError::arrayBufferToBase64 parsing failed, error: ${null==p?void 0:p.message}, sid: ${s}, cid: ${a}`,this.core.logger.error(r)}d=null}this.core.reporter.reportTraceStart("exceptions",{user_id:null===(t=this.core.auth)||void 0===t?void 0:t.account,trace_id:null===(n=this.core.clientSocket.socket)||void 0===n?void 0:n.sessionId,start_time:Date.now(),action:2,exception_service:9});var u=i?(`${i.message};;;`||`${i.code};;;`)+(l?`parseDetail: ${l};;;`:"")+(o?` rawStr: ${o}`:"")+(r?` rawBuf: ${r}`:""):"";this.core.reporter.reportTraceUpdateV2("exceptions",{code:"encode"===c?le.V2NIM_ERROR_CODE_PACK_ERROR:le.V2NIM_ERROR_CODE_UNPACK_ERROR,description:u,operation_type:"encode"===c?3:4,target:`${s}-${a}`},{asyncParams:we.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)}}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Kn||(Kn={}));class sr{constructor(e){this.isReconnect=!1,this.packetTimeout=8e3,this.linkSSL=!0,this.packetSer=1,this.backoff=new fn({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Map,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,this.auth=e.auth,this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager,this.eventBus=e.eventBus,this.setListener()}setListener(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.isReconnect=!0})}setSessionId(e){this.socket&&(this.socket.sessionId=e)}setLinkSSL(e){this.linkSSL=e}connect(e,t=!1){var n,r;return Ce(this,void 0,void 0,function*(){this.isReconnect=t;var i=this.core.auth.getConnectStatus();if(1===i){var o=`clientSocket::connect status is ${i}, and would not repeat connect`,s=new pe({code:le.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:o}});return this.logger.warn(o),Promise.reject(s)}this.auth.lifeCycle.processEvent("connect");try{yield this.auth.doLoginStepsManager.add(this.doConnect(e)),this.logger.log(`clientSocketV2:: connect success with link url: ${e}, isReconnect: ${t}`),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:200,mixlink:!0,succeed:!0},{asyncParams:we.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc")}catch(c){var a=c;if(this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:a.code||0,description:`connectFailed:${a.message}`,mixlink:!0,succeed:!1},{asyncParams:we.net.getNetworkStatus()}),a.code===le.V2NIM_ERROR_CODE_CANCELLED||a.code===le.V2NIM_ERROR_CODE_TIMEOUT)throw null===(n=this.socket)||void 0===n||n.close(),null===(r=this.socket)||void 0===r||r.removeAllListeners(),this.socket=void 0,c;throw this.logger.warn(`clientSocketV2::connect failed with link url: ${e}`,a),this.auth.lifeCycle.processEvent("connectFail",a),c}})}doConnect(e){var t=!1;return new Promise((n,r)=>{this.socket=new or(this.core,e,this.linkSSL),this.socket.on("connect",()=>{this.logger.log("clientSocketV2::socket on connect",e),this.core.reporterHookLinkKeep.start(),this.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e}),t=!0,n()}),this.socket.on("message",this.onMessage.bind(this)),this.socket.on("disconnect",n=>Ce(this,void 0,void 0,function*(){t=!0,this.logger.log(`clientSocketV2::socket on disconnect ${e}`,n),yield this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e}),this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Kn.OFFLINE,"SocketOnDisconnect")})),this.socket.on("connectFailed",n=>{t?this.ping():(this.logger.error(`clientSocketV2::connectFailed:${e}, reason:${n&&n.message}`),this.cleanSocket()),t=!0,r(n)})})}cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)}resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()}doDisconnect(e,t){if(this.logger.log(`clientSocketV2::doDisconnect:type:${e},reason:`,t),0!==this.core.auth.getConnectStatus()){var n={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new pe({code:le.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:n}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),e===Kn.ACTIVE||e===Kn.KICKED?this.destroyOnlineListener():e===Kn.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new pe({code:le.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log(`clientSocketV2::doDisconnect: pending reconnect ${this.isReconnect}`),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect:already disconnected")}sendCmd(e,t,n){var r=this.core.auth.getLoginStatus(),i={cmd:e};if(1!==r&&!["v2Login","login","chatroomLogin","v2ChatroomLogin"].includes(e))return this.logger.warn(`clientSocketV2::NIM login status is ${r}, so can not sendCmd ${e}`),Promise.reject(new pe({code:le.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:Object.assign({reason:"Can not sendCmd due to no logined"},i)}));var o="heartbeat"!==e,s=o?this.packetSer++:0,a=$t(e,s,this.logger,t);if(!a){var c=new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:Object.assign(Object.assign({},i),{reason:`SendCmd::createCmd error: ${s} ${e}`})});return this.logger.error(c),Promise.reject(c)}var{packet:l,hasPacketResponse:d,hasPacketTimer:u}=a,p=JSON.stringify(l);o&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::sendCmd: ${l.SID}_${l.CID},${e},ser:${s}`,p):this.logger.log(`clientSocketV2::sendCmd: ${l.SID}_${l.CID},${e},ser:${s}`));var h=(new Date).getTime();return new Promise((r,o)=>{d&&this.sendingCmdMap.set(s,{cmd:e,params:t,callback:[r,o],timer:u?setTimeout(()=>{var t=new pe({code:le.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:Object.assign({ser:s,reason:`Packet Timeout: ser ${s} cmd ${e}`,timetag:(new Date).getTime()},i)});this.markCmdInvalid(s,t,e)},n&&n.timeout?n.timeout:this.packetTimeout):null});try{this.socket.send(l.SID,l.CID,s,e,l.Q),d||r(l)}catch(c){var a=new pe({code:le.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:Object.assign({ser:s,reason:"Unable to send packet"+(c&&c.message?": "+c.message:""),timetag:(new Date).getTime(),rawError:c},i)});this.markCmdInvalid(s,a,e),o(a)}}).catch(e=>Ce(this,void 0,void 0,function*(){var t=e;return[le.V2NIM_ERROR_CODE_DISCONNECT,le.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,le.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED].includes(t.code)?(this.reportSendCmdFailed(t,{sid:l.SID,cid:l.CID,ser:s},h),Promise.reject(t)):Promise.reject(t)}))}reportSendCmdFailed(e,t,n){var r;this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(r=this.socket)||void 0===r?void 0:r.sessionId,start_time:n,action:2,exception_service:6});var i=Ve(e,"detail.disconnect_reason")||"",o=e.code===le.V2NIM_ERROR_CODE_DISCONNECT?JSON.stringify({disconnect_reason:i}):e.detail.reason;this.reporter.reportTraceUpdateV2("exceptions",{code:e.code,description:o,operation_type:1,target:`${t.sid}-${t.cid}`,context:`${t.ser}`},{asyncParams:we.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1)}onMessage(e){var t=Bt(e,this.logger);if(t&&t.length>0){var n=t[0],r=n.raw.ser;for(var i of(n.error&&(this.logger.error("clientSocketV2::onMessage packet error",`${n.raw.sid}_${n.raw.cid}, ser:${r},`,n.error),n.error.code===le.V2NIM_ERROR_CODE_UNPACK_ERROR&&this.core.eventBus.emit("BinaryClientSocket/unpackError")),"heartbeat"!==n.cmd&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::recvCmd ${n.raw.sid}_${n.raw.cid},${n.cmd},ser:${r}`,e):this.logger.log(`clientSocketV2::recvCmd ${n.raw.sid}_${n.raw.cid},${n.cmd},ser:${r},code:${n.raw.code}`)),t))this.packetHandler(i)}}packetHandler(e){var t,n,r,i;if(e){var o=e.raw.ser,s=this.sendingCmdMap.get(o);if(s&&s.cmd===e.cmd){var{callback:a,timer:c,params:l}=s;if(clearTimeout(c),e.params=l,this.sendingCmdMap.delete(o),"heartbeat"===e.cmd)return void a[0]();var d=null===(n=null===(t=this.core[e.service])||void 0===t?void 0:t.process)||void 0===n?void 0:n.call(t,e);d&&"function"==typeof d.then?d.then(e=>{a[0](e)}).catch(e=>{a[1](e)}):(this.logger.log("clientSocketV2::handlerFn without promise",e.service,e.cmd),a[0](e))}else{var u=null===(i=null===(r=this.core[e.service])||void 0===r?void 0:r.process)||void 0===i?void 0:i.call(r,e);u&&"function"==typeof u.then&&u.catch(e=>{this.logger.error("clientSocketV2::no obj cache, no process handler",e)})}}}markCmdInvalid(e,t,n){var r=this.sendingCmdMap.get(e);if(r){var{callback:i,timer:o}=r;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn(`clientSocketV2::packet ${e}, ${n} is invalid:`,t),i[1](t)}}markAllCmdInvaild(e){this.logger.log("markAllCmdInvaild",e),this.sendingCmdMap.forEach(t=>{var{callback:n,timer:r,cmd:i}=t;this.logger.log(`clientSocketV2::markAllCmdInvaild:cmd ${i}`),r&&clearTimeout(r),n[1](e)}),this.sendingCmdMap.clear()}ping(){var e;return Ce(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);try{yield this.sendCmd("heartbeat")}catch(t){if(t.code===le.V2NIM_ERROR_CODE_DISCONNECT)return;if(yield this.testHeartBeat5Timeout())return yield this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url}),this.core.reporterHookLinkKeep.end(!0),void this.doDisconnect(Kn.OFFLINE,"PingError")}this.pingTimer=setTimeout(()=>{this.ping()},3e4)})}testHeartBeat5Timeout(){return Ce(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);for(var e=0;e<5;e++)try{return yield this.sendCmd("heartbeat",{},{timeout:3e3}),!1}catch(t){this.logger.log(`clientSocketV2::test heartbeat ${e} Timeout`)}return!0})}initOnlineListener(){this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,we.net.onNetworkStatusChange(e=>{this.logger.log("clientSocketV2::onlineListener:network change",e);var t=this.auth.getLoginStatus();e.isConnected&&1===t?this.ping():e.isConnected&&3===t?(this.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),this.auth.reconnect.clearReconnectTimer(),this.auth.reconnect.doReLogin()):e.isConnected||this.doDisconnect(Kn.OFFLINE,"OfflineListener")}))}destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),we.net.offNetworkStatusChange(),this.hasNetworkListener=!1}}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Yn||(Yn={}));class ar{constructor(e){this.isReconnect=!1,this.packetTimeout=8e3,this.linkSSL=!0,this.packetSer=1,this.backoff=new fn({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Map,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,this.auth=e.auth,this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager,this.eventBus=e.eventBus,this.setListener()}setListener(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.isReconnect=!0})}setSessionId(e){this.socket&&(this.socket.sessionId=e)}setLinkSSL(e){this.linkSSL=e}connect(e,t=!1){var n,r;return Ce(this,void 0,void 0,function*(){this.isReconnect=t;var i=this.core.auth.getConnectStatus();if(1===i){var o=`clientSocket::connect status is ${i}, and would not repeat connect`,s=new pe({code:le.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:o}});return this.logger.warn(o),Promise.reject(s)}this.auth.lifeCycle.processEvent("connect");try{yield this.auth.doLoginStepsManager.add(this.doConnect(e)),this.logger.log(`clientSocketV2:: connect success with link url: ${e}, isReconnect: ${t}`),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:200,mixlink:!0,succeed:!0},{asyncParams:we.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc")}catch(c){var a=c;if(this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:a.code||0,description:`connectFailed:${a.message}`,mixlink:!0,succeed:!1},{asyncParams:we.net.getNetworkStatus()}),a.code===le.V2NIM_ERROR_CODE_CANCELLED||a.code===le.V2NIM_ERROR_CODE_TIMEOUT)throw null===(n=this.socket)||void 0===n||n.close(),null===(r=this.socket)||void 0===r||r.removeAllListeners(),this.socket=void 0,c;throw this.logger.warn(`clientSocketV2::connect failed with link url: ${e}`,a),this.auth.lifeCycle.processEvent("connectFail",a),c}})}doConnect(e){var t=!1;return new Promise((n,r)=>{this.socket=new Sn(this.core,e,this.linkSSL),this.socket.on("connect",()=>{this.logger.log("clientSocketV2::socket on connect",e),this.core.reporterHookLinkKeep.start(),this.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e}),t=!0,n()}),this.socket.on("message",this.onMessage.bind(this)),this.socket.on("disconnect",n=>Ce(this,void 0,void 0,function*(){t=!0,this.logger.log("clientSocketV2::socket on disconnect",n),yield this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e}),this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Yn.OFFLINE,"SocketOnDisconnect")})),this.socket.on("handshakeFailed",e=>{t?this.ping():(this.logger.error(`clientSocketV2::handshake failed: "${e&&e.message}"`),this.cleanSocket()),t=!0,r(e)})})}cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)}resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()}doDisconnect(e,t){if(this.logger.log(`clientSocketV2::doDisconnect:type:${e},reason:`,t),0!==this.core.auth.getConnectStatus()){var n={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new pe({code:le.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:n}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),e===Yn.ACTIVE||e===Yn.KICKED?this.destroyOnlineListener():e===Yn.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new pe({code:le.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log(`clientSocketV2::doDisconnect: pending reconnect ${this.isReconnect}`),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect:already disconnected")}sendCmd(e,t,n){var r=this.core.auth.getLoginStatus(),i={cmd:e};if(1!==r&&!["v2Login","login","chatroomLogin","v2ChatroomLogin"].includes(e))return this.logger.warn(`clientSocketV2::NIM login status is ${r}, so can not sendCmd ${e}`),Promise.reject(new pe({code:le.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:Object.assign({reason:"Can not sendCmd due to no logined"},i)}));var o="heartbeat"!==e,s=o?this.packetSer++:0,a=$t(e,s,this.logger,t);if(!a){var c=new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:Object.assign(Object.assign({},i),{reason:`SendCmd::createCmd error: ${s} ${e}`})});return this.logger.error(c),Promise.reject(c)}var{packet:l,hasPacketResponse:d,hasPacketTimer:u}=a,p=JSON.stringify(l);o&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::sendCmd: ${l.SID}_${l.CID},${e},ser:${s}`,p):this.logger.log(`clientSocketV2::sendCmd: ${l.SID}_${l.CID},${e},ser:${s}`));var h=(new Date).getTime();return new Promise((r,o)=>{d&&this.sendingCmdMap.set(s,{cmd:e,params:t,callback:[r,o],timer:u?setTimeout(()=>{var t=new pe({code:le.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:Object.assign({ser:s,reason:`Packet Timeout: ser ${s} cmd ${e}`,timetag:(new Date).getTime()},i)});this.markCmdInvalid(s,t,e)},n&&n.timeout?n.timeout:this.packetTimeout):null});try{this.socket.send(p),d||r(l)}catch(c){var a=new pe({code:le.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:Object.assign({ser:s,reason:"Unable to send packet"+(c&&c.message?": "+c.message:""),timetag:(new Date).getTime(),rawError:c},i)});this.markCmdInvalid(s,a,e),o(a)}}).catch(e=>Ce(this,void 0,void 0,function*(){var t,n=e;if(![le.V2NIM_ERROR_CODE_DISCONNECT,le.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,le.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED].includes(n.code))return Promise.reject(n);this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(t=this.socket)||void 0===t?void 0:t.sessionId,start_time:h,action:2,exception_service:6});var r=Ve(n,"detail.disconnect_reason")||"",i=n.code===le.V2NIM_ERROR_CODE_DISCONNECT?JSON.stringify({disconnect_reason:r}):n.detail.reason;return this.reporter.reportTraceUpdateV2("exceptions",{code:n.code,description:i,operation_type:1,target:`${l.SID}-${l.CID}`,context:`${l.SER}`},{asyncParams:we.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),Promise.reject(n)}))}onMessage(e){var t=Bt(e,this.logger);if(t&&t.length>0){var n=t[0],r=n.raw.ser;for(var i of(n.error&&this.logger.error("clientSocketV2::onMessage packet error",`${n.raw.sid}_${n.raw.cid}, ser:${r},`,n.error),"heartbeat"!==n.cmd&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::recvCmd ${n.raw.sid}_${n.raw.cid},${n.cmd},ser:${r}`,n.content):this.logger.log(`clientSocketV2::recvCmd ${n.raw.sid}_${n.raw.cid},${n.cmd},ser:${r};code:${n.raw.code}`)),t))this.packetHandler(i)}}packetHandler(e){var t,n,r,i;if(e){var o=e.raw.ser,s=this.sendingCmdMap.get(o);if(s&&s.cmd===e.cmd){var{callback:a,timer:c,params:l}=s;if(clearTimeout(c),e.params=l,this.sendingCmdMap.delete(o),"heartbeat"===e.cmd)return void a[0]();var d=null===(n=null===(t=this.core[e.service])||void 0===t?void 0:t.process)||void 0===n?void 0:n.call(t,e);d&&"function"==typeof d.then?d.then(e=>{a[0](e)}).catch(e=>{a[1](e)}):(this.logger.log("clientSocketV2::handlerFn without promise",e.service,e.cmd),a[0](e))}else{var u=null===(i=null===(r=this.core[e.service])||void 0===r?void 0:r.process)||void 0===i?void 0:i.call(r,e);u&&"function"==typeof u.then&&u.catch(e=>{this.logger.error("clientSocketV2::no obj cache, no process handler",e)})}}}markCmdInvalid(e,t,n){var r=this.sendingCmdMap.get(e);if(r){var{callback:i,timer:o}=r;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn(`clientSocketV2::packet ${e}, ${n} is invalid:`,t),i[1](t)}}markAllCmdInvaild(e){this.logger.log("markAllCmdInvaild",e),this.sendingCmdMap.forEach(t=>{var{callback:n,timer:r,cmd:i}=t;this.logger.log(`clientSocketV2::markAllCmdInvaild:cmd ${i}`),r&&clearTimeout(r),n[1](e)}),this.sendingCmdMap.clear()}ping(){var e;return Ce(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);try{yield this.sendCmd("heartbeat")}catch(t){if(t.code===le.V2NIM_ERROR_CODE_DISCONNECT)return;if(yield this.testHeartBeat5Timeout())return yield this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url}),this.core.reporterHookLinkKeep.end(!0),void this.doDisconnect(Yn.OFFLINE,"PingError")}this.pingTimer=setTimeout(()=>{this.ping()},3e4)})}testHeartBeat5Timeout(){return Ce(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);for(var e=0;e<5;e++)try{return yield this.sendCmd("heartbeat",{},{timeout:3e3}),!1}catch(t){this.logger.log(`clientSocketV2::test heartbeat ${e} Timeout`)}return!0})}initOnlineListener(){this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,we.net.onNetworkStatusChange(e=>{this.logger.log("clientSocketV2::onlineListener:network change",e);var t=this.auth.getConnectStatus(),n=this.auth.getLoginStatus();e.isConnected&&1===n?this.ping():e.isConnected&&3===t?(this.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),this.auth.reconnect.clearReconnectTimer(),this.auth.reconnect.doReLogin()):e.isConnected||this.doDisconnect(Yn.OFFLINE,"OfflineListener")}))}destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),we.net.offNetworkStatusChange(),this.hasNetworkListener=!1}}class cr{constructor(e){var t,n;this.currenRetryCount=0,this.backoff=new fn({max:8e3,min:1600,jitter:.01}),this.reconnectTimer=0,this.core=e,this.auth=e.V2NIMLoginService,null===(n=(t=we.powerMonitor).on)||void 0===n||n.call(t,"onPowerMonitorTurnActive",()=>{this.core.logger.debug("reconnect::powerMonitor turn active"),3===this.auth.getLoginStatus()&&(this.core.logger.log("reconnect::powerMonitor turn active, try to reconnect"),this.auth.reconnect.clearReconnectTimer(),this.auth.reconnect.doReLogin())})}reset(){this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer)}destroy(){var e,t;this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer),we.powerMonitor.destroy(),null===(t=(e=we.powerMonitor).off)||void 0===t||t.call(e,"onPowerMonitorTurnActive")}clearReconnectTimer(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)}attempToReLogin(){var e=this.backoff.duration();if("function"==typeof this.reconnectDelayProvider)try{var t=this.reconnectDelayProvider(e);"number"==typeof t&&t>=0&&(e=t>=1e3?t:t+200+Math.ceil(300*Math.random()))}catch(n){this.core.logger.error("reconnect::connectDelayProvider excute failed,",n)}return this.currenRetryCount++,this.core.logger.log(`reconnect::reconnect timer is about to be set, delay ${e} ms, current retry count is ${this.currenRetryCount}`),this.core.reporter.reportTraceStart("login",{user_id:this.auth.getLoginUser(),action:"auto_login",binary_websocket:this.auth.binaryWebsocket}),this.clearReconnectTimer(),this.reconnectTimer=setTimeout(()=>{this.core.logger.log("reconnect::reconnect timer is now triggered");var e=this.auth.getConnectStatus();3===e?this.doReLogin():this.core.logger.warn(`reconnect::reconnect timer is over because connect status now is ${e}`)},e),!0}doReLogin(){if(!we.powerMonitor.isActive())return this.core.logger.log("reconnect::reLogin skip, cause app powerMonitor is not active"),void this.auth.lifeCycle.processEvent("waiting");this.auth.loginOption.forceMode=!1,this.auth.originLoginPromise=this.auth.doLogin(!0);var e=this.auth.previousLoginManager.add(this.auth.originLoginPromise);return e.then(()=>{this.core.reporter.reportTraceEnd("login",!0)}).catch(e=>{var t=e;if(this.core.logger.warn("reconnect::try login but failed due to",t),this.core.reporter.reportTraceEnd("login",!1),this.auth.checkLoginTerminalCode(t&&t.code))return this.auth.clientSocket.doDisconnect(Kn.ACTIVE,"ReloginTerminated"),void this.auth.lifeCycle.processEvent("exited",t);t&&399===t.code&&this.auth.lbs.reset(),this.auth.lifeCycle.processEvent("waiting")}),e}_setReconnectDelayProvider(e){this.reconnectDelayProvider=e}}class lr{constructor(e){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=e,this.auth=e.V2NIMLoginService}getLbsInfos(){return Ce(this,void 0,void 0,function*(){if(this.socketLinkUrls.length>0){var e=this.socketLinkUrls.shift();return this.core.logger.log("V2NIMLoginService::getLbsInfos:use cache link",e),Promise.resolve(e)}this.auth.lifeCycle.processEvent("addressing"),this.core.reporterHookLBS.start(this.core.account);var t=En(this.auth.config.lbsUrls);try{var n=yield this.ladderLoad(t);if(200!==n.status||!n.data)throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",n.status,n),new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:`V2NIMLoginService::getLbsInfos failed, status ${n.status}`}});this.success(n)}catch(i){var r=i;if(this.core.logger.error(`V2NIMLoginService::lbs getLbsInfos error, use default link: ${this.auth.config.linkUrl}. error:`,i),this.reportForFail(t[0],r.code,r.message),this.checkTerminator(r.code))throw i;this.socketLinkUrls=[this.auth.config.linkUrl]}return this.socketLinkUrls.shift()})}checkTerminator(e){return e===le.V2NIM_ERROR_CODE_CANCELLED||e===le.V2NIM_ERROR_CODE_TIMEOUT}generateUrl(e){var t=(e=this.processLbsUrl(e)).indexOf("?")>-1?"&":"?";return e+t+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"}processLbsUrl(e){return je()?e.replace("/webconf","/wxwebconf"):e}requstLbs(e){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(e),{method:"GET",dataType:"json",timeout:8e3}))}setLadderTimer(e,t,n,r){this.timer&&clearTimeout(this.timer);var i=e[t];this.timer=setTimeout(()=>{i&&(this.setLadderTimer(e,t+1,n,r),this.core.logger.log(`V2NIMLoginService::getLbsInfos ${t}:`,this.processLbsUrl(i)),this.reportForLbsStart(i,t),this.requstLbs(i).then(e=>{this.reset(),n(Object.assign(Object.assign({},e),{url:i}))}).catch(n=>{var o;if(this.core.logger.warn(`V2NIMLoginService::getLbsInfos ${t} failed:`,n),this.failedCount+=1,this.reportForFailOnce(i,n.code,(null===(o=n.detail)||void 0===o?void 0:o.reason)||n.message),this.failedCount>=e.length||this.checkTerminator(n.code))return this.reset(),void r(n)}))},2e3)}ladderLoad(e){return new Promise((t,n)=>{e.length>1&&this.setLadderTimer(e,1,t,n);var r=e[0];this.core.logger.log("V2NIMLoginService::getLbsInfos 0:",r),this.reportForLbsStart(r,0),this.requstLbs(r).then(e=>{this.reset(),t(Object.assign(Object.assign({},e),{url:r}))}).catch(t=>{var i;this.failedCount+=1,this.core.logger.warn("V2NIMLoginService::getLbsInfos 0 failed:",t),this.reportForFailOnce(r,t.code,(null===(i=t.detail)||void 0===i?void 0:i.reason)||t.message),(this.failedCount>=e.length||this.checkTerminator(t.code))&&(this.reset(),n(t))})})}success(e){var t,n,r=e.data.common,i=r["mix.link"]||[],o=r["link.default"]||[];this.socketLinkUrls=i.concat(o).concat(this.auth.config.linkUrl),e.data["nos-chunk"]&&(null===(t=this.core.cloudStorage)||void 0===t?void 0:t.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nos-chunk",e.data["nos-chunk"]),this.core.cloudStorage.setOptions({chunkUploadHost:e.data["nos-chunk"]})),Array.isArray(e.data.nosup)&&e.data.nosup.length>0&&(null===(n=this.core.cloudStorage)||void 0===n?void 0:n.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nosup",e.data.nosup),this.core.cloudStorage.setOptions({commonUploadHostBackupList:e.data.nosup,commonUploadHost:e.data.nosup[0]})),this.core.logger.log("V2NIMLoginService::getLbsInfos success, socket link:",this.socketLinkUrls.slice(0),"chunkUploadHost: ",e.data["nos-chunk"]),this.reportForLbsSuccess(e.url,e.data)}reportForLbsStart(e,t){this.core.reporterHookLBS.updateBegin({target:e,index:t})}reportForLbsSuccess(e,t){this.core.reporterHookLBS.updateComplete({target:e,code:200,body:JSON.stringify(t)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,code:200,succeed:!0},{asyncParams:we.net.getNetworkStatus()})}reportForFailOnce(e,t,n){this.core.reporterHookLBS.updateComplete({target:e,code:t,body:n})}reportForFail(e,t,n){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,description:n,code:t,succeed:!1},{asyncParams:we.net.getNetworkStatus()})}reset(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)}}class dr{constructor(e){this.lastLoginClientKey="__NIM_LAST_LOGIN_CLIENT__",this.loginClients=[],this.loginClientOfThisConnection={},this.core=e,this.auth=e.V2NIMLoginService}verifyAuthentication(e){var t,n;return Ce(this,void 0,void 0,function*(){var r=yield this.auth.doLoginStepsManager.add(this.refreshLoginToken(this.auth.account)),i=yield this.auth.doLoginStepsManager.add(this.refreshThirdPartyExt(this.auth.account));this.auth.token=r;var o,s=we.getSystemInfo(),a={appkey:this.core.options.appkey,account:this.auth.account,token:r,authType:this.auth.loginOption.authType,appLogin:e?0:1,clientType:16,clientSession:this.auth.clientSession,clientId:this.auth.deviceId,sdkVersion:100941,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.9.41":s.userAgent.replace("{{appkey}}",this.core.options.appkey).slice(0,299),libEnv:this.core.options.flutterSdkVersion?"FLUTTER":this.core.options.loginSDKTypeParamCompat?void 0:s.libEnv,hostEnv:this.core.options.flutterSdkVersion?4:this.core.options.loginSDKTypeParamCompat?0:s.hostEnvEnum,sdkHumanVersion:this.core.options.flutterSdkVersion||"10.9.41",os:s.os,browser:s.browser,protocolVersion:1,customClientType:this.auth.config.customClientType,customTag:this.auth.config.customTag,thirdPartyExtension:i,isRoutable:!1===(null===(t=this.auth.loginOption.routeConfig)||void 0===t?void 0:t.routeEnabled)?0:1,env:null===(n=this.auth.loginOption.routeConfig)||void 0===n?void 0:n.routeEnvironment},c=s.os.toLowerCase(),l=110===s.hostEnvEnum;"UNIAPP"===we.platform&&l?(a.isReactNative=1,a.clientType="ios"===c?2:"android"===c?1:65,s.pushDeviceInfo&&s.pushDeviceInfo.MANUFACTURER&&(a.deviceInfo=JSON.stringify(Object.assign({IS_SUPPORT_HONOR:!0},s.pushDeviceInfo)))):"React Native"===we.platform&&(this.core.logger.log("V2NIMLoginService deviceInfo",this.core.V2NIMLoginService.deviceInfo,"os",c),a.isReactNative=1,a.clientType="ios"===c?2:1,a.deviceInfo=JSON.stringify(Object.assign({IS_SUPPORT_HONOR:!0},this.core.V2NIMLoginService.deviceInfo))),this.core.logger.log(`V2NIMLoginService::do login,accid:${a.account};clientSession:${a.clientSession};appLogin:${a.appLogin}`);try{o=yield this.auth.doLoginStepsManager.add(this.auth.clientSocket.sendCmd("v2Login",{tag:a}))}catch(h){var d=h;if(this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:d.code||0,succeed:!1,description:d.message},{asyncParams:we.net.getNetworkStatus()}),d.code===le.V2NIM_ERROR_CODE_CANCELLED||d.code===le.V2NIM_ERROR_CODE_TIMEOUT)throw d;throw this.processLoginFailed(d),d}var{data:u,loginClients:p}=o.content;return this.changeLoginClient(1,p),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:200,succeed:!0},{asyncParams:we.net.getNetworkStatus()}),this.loginClientOfThisConnection=Vn(u),this.core.clientSocket.setSessionId(u.consid),we.localStorage.setItem(this.lastLoginClientKey,JSON.stringify(Object.assign({account:this.auth.account},this.loginClientOfThisConnection))),this.loginClientOfThisConnection})}refreshLoginToken(e){return Ce(this,void 0,void 0,function*(){if(0===this.auth.loginOption.authType)return this.auth.token;if("function"!=typeof this.auth.loginOption.tokenProvider)return this.auth.token;try{var t=yield this.auth.loginOption.tokenProvider(e);if("string"==typeof t)return t;throw this.core.logger.error("V2NIMLoginService::excute tokenProvider complete but got Unexpected value:",t),new pe({code:le.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute tokenProvider complete but got Unexpected value",rawData:t}})}catch(i){var n=i,r=n;throw n.code!==le.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute tokenProvider error:",n),r=new pe({code:le.V2NIM_ERROR_CODE_CALLBACK_FAILED,desc:"Excute tokenProvider error",detail:{rawError:i}})),this.processLoginFailed(n),r}})}refreshThirdPartyExt(e){return Ce(this,void 0,void 0,function*(){if("function"!=typeof this.auth.loginOption.loginExtensionProvider)return"";try{var t=yield this.auth.loginOption.loginExtensionProvider(e);if("string"==typeof t)return t;throw this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider complete but got Unexpected value:",t),new pe({code:le.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider complete but got Unexpected value",rawData:t}})}catch(i){var n=i,r=n;if(n.code!==le.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider error:",n),r=new pe({code:le.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider error",rawError:i}})),2===this.auth.loginOption.authType)throw this.processLoginFailed(n),r;return""}})}processLoginFailed(e){this.auth.clientSocket.doDisconnect(Kn.ACTIVE,e),this.checkLoginTerminalCode(e.code)&&(this.auth.authenticator.reset(),this.auth.authenticator.clearLastLoginClient()),this.auth.lifeCycle.processEvent("loginFail",e)}changeLoginClient(e,t){var n=t.map(e=>Vn(e));if(1===e)this.loginClients=n,this.auth.emit("onLoginClientChanged",e,this.loginClients);else if(2===e){var r=n.filter(e=>{var t=this.loginClients.filter(t=>t.clientId===e.clientId);return this.loginClients.push(e),0===t.length});r.length>0&&this.auth.emit("onLoginClientChanged",e,r)}else if(3===e){var i=n.filter(e=>(function(e,t){t=t||(()=>!0);for(var n=[],r=(e=e||[]).length,i=0,o=0;o<r;o++)t(e[o-i])&&(n.push(e.splice(o-i,1)[0]),i+=1)}(this.loginClients,t=>t.clientId===e.clientId&&t.consid===e.consid),0===this.loginClients.filter(t=>t.clientId===e.clientId).length));i.length>0&&this.auth.emit("onLoginClientChanged",e,i)}}checkAutoLogin(e){if(e)return!1;var t=we.localStorage.getItem(this.lastLoginClientKey);if(!t)return!1;var n="",r="";try{var i=JSON.parse(t);n=Ve(i,"clientId"),r=Ve(i,"account")}catch(o){return!1}return n===this.auth.deviceId&&r===this.auth.account}checkLoginTerminalCode(e){return[le.V2NIM_ERROR_CODE_CANCELLED,le.V2NIM_ERROR_CODE_TIMEOUT,le.V2NIM_ERROR_CODE_HANDSHAKE,302,317,le.V2NIM_ERROR_CODE_FORBIDDEN,le.V2NIM_ERROR_CODE_NOT_FOUND,le.V2NIM_ERROR_CODE_PARAMETER_ERROR,le.V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN,422,le.V2NIM_ERROR_CODE_IM_DISABLED,le.V2NIM_ERROR_CODE_APPKEY_NOT_EXIST,le.V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED,le.V2NIM_ERROR_CODE_APPKEY_BLOCKED,le.V2NIM_ERROR_CODE_INVALID_TOKEN,le.V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED,le.V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST,le.V2NIM_ERROR_CODE_ACCOUNT_BANNED,le.V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST].includes(e)}reset(){this.loginClients=[],this.loginClientOfThisConnection={}}clearLastLoginClient(){we.localStorage.removeItem(this.lastLoginClientKey)}}class ur{constructor(e){this.name="V2NIMLoginLifeCycle",this.loginStatus=0,this.connectStatus=0,this.core=e,this.auth=e.V2NIMLoginService,this.logger=e.logger}processEvent(e,t,n){var r=this.getConnectStatus();switch(e){case"addressing":this.logger.log(`${this.name}::addressing`),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connect":this.logger.log(`${this.name}::connecting`),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connectSucc":this.logger.log(`${this.name}::connect success`),this.setLoginStatus(2),this.setConnectStatus(1);break;case"connectFail":this.logger.log(`${this.name}::connect fail`,t),this.setLoginStatus(3),this.setConnectStatus(0,t);break;case"connectionBroken":this.logger.log(`${this.name}::connectionBroken:`,t),this.setLoginStatus(3),this.setConnectStatus(0,t),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleDisconnected",t);break;case"loginSucc":this.logger.log(`${this.name}::login success, verify authentication success`),this.setLoginStatus(1),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLoginSucc",n);break;case"loginFail":if(this.logger.log(`${this.name}::login fail due to verify authentication failed:`,t),!t)return;this.setLoginStatus(this.auth.authenticator.checkLoginTerminalCode(t.code)?0:3),this.setConnectStatus(0,t),this.auth.emit("onLoginFailed",t);break;case"logout":this.logger.log(`${this.name}::logout`),this.setLoginStatus(0),this.setConnectStatus(0),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"kicked":this.logger.log(`${this.name}::kicked`,n),this.setLoginStatus(0),this.setConnectStatus(0,t),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleKicked");break;case"exited":this.logger.log(`${this.name}::exited`,t),this.setLoginStatus(0),this.setConnectStatus(0,t);break;case"waiting":this.logger.log(`${this.name}::waiting to reconnect`),this.setLoginStatus(3),this.setConnectStatus(3),2!==r&&this.auth.reconnect.attempToReLogin()}}getConnectStatus(){return this.connectStatus}getLoginStatus(){return this.loginStatus}setLoginStatus(e){e!==this.loginStatus&&(this.loginStatus=e,this.auth.emit("onLoginStatus",e))}setConnectStatus(e,t){if(e!==this.connectStatus){var n=this.connectStatus;this.connectStatus=e,this.auth.emit("onConnectStatus",e),this.delegateConnectEvent(n,e,t)}}delegateConnectEvent(e,t,n){1===e&&0===t&&n&&this.auth.emit("onDisconnected",n),2===e&&0===t&&n&&this.auth.emit("onConnectFailed",n)}}class pr{constructor(e){this.core=e,this.auth=e.V2NIMLoginService,this.datas=[]}switchDataSync(e){return Ce(this,void 0,void 0,function*(){var{type:t,state:n,error:r,subType:i}=e,o=this.datas.filter(e=>e.type===t&&e.subType===i);o.length>0?(o[0].state=n,o[0].error=r):this.datas.push({type:t,state:n,subType:i});var s=this.datas.every(e=>3===e.state);1===t&&(2===n&&"mainSync"===i?(this.core.eventBus.emit("V2NIMLoginService/syncing"),this.auth.emit("onDataSync",t,n)):3===n&&s&&(this.core.eventBus.emit("V2NIMLoginService/syncDone",r),this.auth.emit("onDataSync",t,n,r)))})}checkSyncing(){return this.datas.some(e=>"mainSync"===e.subType&&2===e.state)}reset(){this.datas=[]}}function hr(e,t){e=e||{};var n={};return(t=t||[]).forEach(t=>{void 0!==e[t]&&(n[t]=e[t])}),n}var gr={retryCount:{type:"number",min:0,required:!1},forceMode:{type:"boolean",required:!1},authType:{type:"enum",values:[0,1,2],required:!1},syncLevel:{type:"enum",values:[1,0],required:!1},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}}},mr=["https://lbs.netease.im/lbs/webconf.jsp"],fr={retryCount:3,timeout:6e4,forceMode:!1,authType:0,syncLevel:0};function vr(e){e=e||{};var t={};for(var n in e)t[e[n]]=n;return t}var yr,_r=vr({none:0,normal:1,all:3}),Ir={normal:0,advanced:1},Tr=vr(Ir),Sr=vr({normal:0,owner:1,manager:2}),Er={noVerify:0,needVerify:1,rejectAll:2},Mr=vr(Er),br={needVerify:0,noVerify:1},Cr=vr(br),Ar={manager:0,all:1},Or=vr(Ar),Rr={manager:0,all:1},Nr=vr(Rr),wr={manager:0,all:1},Pr=vr(wr);function kr(e){var t={type:Tr,muteType:_r,joinMode:Mr,beInviteMode:Cr,inviteMode:Or,updateTeamMode:Nr,updateExtMode:Pr},n=be(e,["bits"]);return["teamId"].forEach(e=>{n[e]&&(n[e]=n[e].toString())}),["level","memberNum","memberUpdateTime","createTime","updateTime"].forEach(e=>{void 0!==n[e]&&(n[e]=parseInt(n[e]))}),["valid","validToCurrentUser","mute"].forEach(e=>{void 0!==n[e]&&(n[e]=1===parseInt(n[e]))}),Object.keys(t).forEach(e=>{void 0!==n[e]&&(n[e]=t[e][n[e]]||n[e])}),n}function Lr(e){return e&&e.length>0?e.map(e=>kr(e)):[]}function xr(e){var t=Object.assign({},e),n={type:Ir,joinMode:Er,beInviteMode:br,inviteMode:Ar,updateTeamMode:Rr,updateExtMode:wr};return["avatar","name","intro","announcement","ext"].forEach(e=>{void 0!==t[e]&&(t[e]=t[e].toString())}),Object.keys(n).forEach(e=>{void 0!==t[e]&&(t[e]=n[e][t[e]])}),t}function Vr(e){var t={};return void 0!==e.bitConfigMask&&(t.bits=parseInt(e.bitConfigMask)),["teamId","ext","account","nickInTeam"].forEach(n=>{e[n]&&(t[n]=e[n].toString())}),Object.prototype.hasOwnProperty.call(e,"nickInTeam")&&(t.nickInTeam=e.nickInTeam),t}function Dr(e){var t={type:Sr},{bits:n}=e,r=be(e,["bits"]);return void 0!==n&&(r.muteTeam=1===parseInt(n),r.bitConfigMask=n),r.id=`${r.teamId}-${r.account}`,["teamId"].forEach(e=>{r[e]&&(r[e]=r[e].toString())}),["joinTime","updateTime","bitConfigMask"].forEach(e=>{void 0!==r[e]&&(r[e]=parseInt(r[e]))}),["active","valid","mute"].forEach(e=>{void 0!==r[e]&&(r[e]=1===parseInt(r[e]))}),Object.keys(t).forEach(e=>{void 0!==r[e]&&(r[e]=t[e][r[e]]||r[e])}),r}function Ur(e){return e&&e.length>0?e.map(e=>Dr(e)):[]}function $r(e,t,n="normal"){return{id:`${e.teamId}-${t}`,teamId:e.teamId,account:t,type:n,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}}function Br(e,t,n="normal"){return t&&t.length>0?t.map(t=>$r(e,t,n)):[]}function Fr(e){var t=Object.assign({},e);return t.createTime&&(t.createTime=+t.createTime),t.updateTime&&(t.updateTime=+t.updateTime),t.gender&&(t.gender=yr[+t.gender]),t}!function(e){e[e.unknown=0]="unknown",e[e.male=1]="male",e[e.female=2]="female"}(yr||(yr={}));var jr={"8_1":"createTeam","8_5":"addTeamMembers","8_6":"removeTeamMembers","8_7":"updateTeamInfo","8_8":"leaveTeam","8_9":"getTeamInfo","8_10":"getTeams","8_11":"getTeamMembers","8_12":"dismissTeam","8_13":"applyTeam","8_14":"passTeamApply","8_15":"rejectTeamApply","8_16":"addTeamManagers","8_17":"removeTeamManagers","8_18":"transferTeam","8_19":"updateMyMemberInfo","8_20":"updateNickInTeam","8_21":"acceptTeamInvite","8_22":"rejectTeamInvite","8_25":"muteTeamMember","8_27":"getMutedTeamMembers","8_28":"sendTeamMsgReceipt","8_29":"getTeamMsgReads","8_30":"getTeamMsgReadAccounts","8_31":"notifyTeamMsgReceipts","8_32":"muteTeam","8_33":"getTeamMemberInvitorAccid","8_34":"getTeamsById","8_101":"syncCreateTeam","8_109":"syncTeams","8_119":"syncUpdateTeamMember","8_126":"syncMyTeamMembers"},qr={team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},teamMsgReceiptTag:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,ext:12,mute:13,invitorAccid:14}},Gr=Ht(qr),Hr={getTeamInfo:{sid:8,cid:9,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Gr.team}]},getTeams:{sid:8,cid:10,service:"team",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Gr.team},{type:"Long",name:"timetag"}],ignoreErrCodes:[803]},createTeam:{sid:8,cid:1,service:"team",params:[{type:"Property",name:"team",reflectMapper:qr.team},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Gr.team},{type:"StrArray",name:"abortedAccidList"}]},sendTeamMsgReceipt:{sid:8,cid:28,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:qr.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Gr.teamMsgReceiptTag}]},getTeamMsgReads:{sid:8,cid:29,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:qr.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Gr.teamMsgReceiptTag}]},getTeamMsgReadAccounts:{sid:8,cid:30,service:"team",params:[{type:"Property",name:"teamMsgReceiptTag",reflectMapper:qr.teamMsgReceiptTag}],response:[{type:"Property",name:"teamMsgReceipt",reflectMapper:Gr.teamMsgReceiptTag},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},notifyTeamMsgReceipts:{sid:8,cid:31,service:"team",response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Gr.teamMsgReceiptTag}]},dismissTeam:{sid:8,cid:12,service:"team",params:[{type:"Long",name:"teamId"}]},leaveTeam:{sid:8,cid:8,service:"team",params:[{type:"Long",name:"teamId"}]},transferTeam:{sid:8,cid:18,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},updateTeamInfo:{sid:8,cid:7,service:"team",params:[{type:"Property",name:"team",reflectMapper:qr.team}],response:[{type:"Long",name:"id"},{type:"Long",name:"time"}]},getTeamsById:{sid:8,cid:34,service:"team",params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Gr.team},{type:"LongArray",name:"tids"}],ignoreErrCodes:[816]},getTeamMembers:{sid:8,cid:11,service:"team",params:[{type:"Long",name:"teamId"},{type:"Long",name:"timetag"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:Gr.teamMember},{type:"Long",name:"timetag"}]},getMutedTeamMembers:{sid:8,cid:27,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:Gr.teamMember}]},addTeamMembers:{sid:8,cid:5,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},removeTeamMembers:{sid:8,cid:6,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applyTeam:{sid:8,cid:13,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Gr.team}]},addTeamManagers:{sid:8,cid:16,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:8,cid:17,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateMyMemberInfo:{sid:8,cid:19,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:qr.teamMember}]},updateNickInTeam:{sid:8,cid:20,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:qr.teamMember}]},muteTeamMember:{sid:8,cid:25,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:8,cid:33,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},muteTeam:{sid:8,cid:32,service:"team",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},passTeamApply:{sid:8,cid:14,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:8,cid:15,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptTeamInvite:{sid:8,cid:21,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:8,cid:22,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncTeams:{sid:8,cid:109,service:"team",response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"teams",reflectMapper:Gr.team}]},syncCreateTeam:{sid:8,cid:101,service:"team",response:[{type:"Property",name:"team",reflectMapper:Gr.team}]},syncUpdateTeamMember:{sid:8,cid:119,service:"team",response:[{type:"Property",name:"teamMember",reflectMapper:Gr.teamMember}]},syncMyTeamMembers:{sid:8,cid:126,ext:"sync",service:"team",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember",reflectMapper:Gr.teamMember},{type:"Long",name:"timetag"}]}},Wr={"3_7":"getUsersNameCardFromServer","3_10":"updateMyNameCard","3_109":"syncMyNameCard","3_110":"onUpdateMyNameCard","3_3":"setBlack","3_103":"onUpdateBlackList","3_5":"setMute","3_105":"onUpdateMuteList","3_8":"syncRelations"},zr={user:{account:1,nick:3,avatar:4,signature:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13},relationMember:{account:0,isMuted:1,isBlack:2,createTime:3,updateTime:4}},Kr=Ht(zr),Yr={syncMyNameCard:{sid:3,cid:109,service:"user",response:[{type:"Property",name:"user",reflectMapper:Kr.user},{type:"Long",name:"timetag"}]},setBlack:{service:"user",sid:3,cid:3,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateBlackList:{service:"user",sid:3,cid:103,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},setMute:{service:"user",sid:3,cid:5,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateMuteList:{service:"user",sid:3,cid:105,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},syncRelations:{service:"user",sid:3,cid:8,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"list",reflectMapper:Kr.relationMember},{type:"Long",name:"timetag"}]},getUsersNameCardFromServer:{service:"user",sid:3,cid:7,params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"users",reflectMapper:Kr.user}]},updateMyNameCard:{service:"user",sid:3,cid:10,params:[{type:"Property",name:"user",reflectMapper:zr.user}],response:[{type:"Long",name:"timetag"}]},onUpdateMyNameCard:{service:"user",sid:3,cid:110,response:[{type:"Property",name:"user",reflectMapper:Kr.user}]}},Jr={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needForcePush:{type:"boolean",required:!1},forcePushIDsList:{type:"string",allowEmpty:!1,required:!1},forcePushContent:{type:"string",allowEmpty:!1,required:!1}},Xr={function:{type:"string",required:!1},topic:{type:"string",required:!1},customContent:{type:"string",required:!1},account:{type:"string",required:!1}},Qr={subType:{type:"string"},setting:{resendFlag:{type:"boolean"},envConfig:{type:"string"},needSaveHistory:{type:"boolean"},needRoaming:{type:"boolean"},needOffline:{type:"boolean"},needSelfSync:{type:"boolean"},needRouted:{type:"boolean"},needUpdateSession:{type:"boolean"},isMuted:{type:"boolean"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBIZID:{type:"string"},clientAntispamHitting:{type:"boolean"},antiSpamUsingYidun:{type:"boolean"},yidunCallbackURL:{type:"string"},yidunAntiCheating:{type:"string"},yidunAntiSpamExtension:{type:"string"},yidunAntiSpamResult:{type:"string"}},pushInfo:Jr,robotInfo:Xr,teamSpecializationInfo:{needACK:{type:"boolean"},isACKSent:{type:"boolean"},ackSnapshot:{type:"number"}},threadMessageInfo:{replyMsgFromAccount:{type:"string"},replyMsgToAccount:{type:"string"},replyMsgTime:{type:"number"},replyMsgIdServer:{type:"string"},replyMsgIdClient:{type:"string"},threadMsgFromAccount:{type:"string"},threadMsgToAccount:{type:"string"},threadMsgTime:{type:"number"},threadMsgIdServer:{type:"string"},threadMsgIdClient:{type:"string"}}},Zr={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMemberMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function ei(e,t){return`${Qt[e.scene]}-${e.to===t?e.from:e.to}`}function ti(e,t){return e.from===t?e.to===t?"in":"out":"in"}function ni(e,t){var{account:n,featureValue:r,statusValue:i,sessionAck:o,msgReceiptTime:s}=t,a=Qt[e.scene],c=e.to===n?e.from:e.to,l=tn.default,d=en.unread;parseInt(e.isInBlackList)>0?(d=en.refused,delete e.isInBlackList):d=e.from===n?s&&s>=+e.time?en.receipt:en.sent:o&&o>=+e.time?en.read:en.unread;var u=Object.assign(Object.assign({},an(Qr,e)),{scene:a,type:Xt[e.type],fromClientType:Zt[e.fromClientType],flow:ti(e,n),target:c,to:e.to,from:e.from,time:e.time?+e.time:void 0,userUpdateTime:e.userUpdateTime?+e.userUpdateTime:void 0,idClient:e.idClient,sessionId:`${a}-${c}`,status:en[i||d],feature:tn[r||l]});if("string"==typeof u.attach)try{u.attach=JSON.parse(u.attach)}catch(p){}return"notification"===u.type&&(u.attach=u.attach?function(e){var t={};if(t.type=Zr[e.id]||e.id,!e.data)return t;var n={ids:"accounts",id:"account",attach:"custom",channel:"channelId",calltype:"netcallType",mute:"mute",duration:"duration",time:"time",from:"from",ext:"ext"},r=e.data;return Object.keys(n).forEach(e=>{void 0!==r[e]&&(t[n[e]]=r[e])}),r.tinfo&&(t.team=kr(qt(r.tinfo,Gr.team))),r.uinfos&&(t.users=r.uinfos.map(e=>Fr(qt(e,Kr.user)))),void 0!==r.mute&&(t.mute=1===parseInt(r.mute)),t}(u.attach):{}),u}function ri(e,t){return e&&e.length>0?ii(e.map(e=>ni(e,t))):[]}function ii(e){var t={};for(var n of e){var r=t[n.idClient];r&&r.time>n.time||(t[n.idClient]=n)}return Object.keys(t).map(e=>t[e])}function oi(e,t=!0){var n=Object.assign({},e);if(n.pushInfo&&t){for(var r in n.pushInfo)"boolean"==typeof n.pushInfo[r]?n[r]=n.pushInfo[r]?1:0:n[r]=n.pushInfo[r];delete n.pushInfo}return n.scene===Qt.team&&n.needForcePush&&(n.forcePushContent=n.forcePushContent||n.pushContent,n.forcePushIDsList=n.forcePushIDsList?n.forcePushIDsList:"#%@all@%#"),n}function si(e,t,n,r){var{onSendBefore:i,onUploadStart:o,onUploadDone:s,replyMsg:a}=e,c=be(e,["onSendBefore","onUploadStart","onUploadDone","replyMsg"]),l=Object.assign(Object.assign({},dn(Qr,c)),{scene:Qt[e.scene],type:Xt[e.type],from:t,fromClientType:16,fromDeviceId:n,fromNick:null==r?void 0:r.nick,userUpdateTime:null==r?void 0:r.updateTime,status:en[en.sending]});if(l.idClient=l.resendFlag?e.idClient:Ue(),!l.idClient)throw new me("idClient is required to resend a message","idClient","required");return l=oi(l,!1),a&&(l.replyMsgFromAccount=a.from,l.replyMsgToAccount=a.to,l.replyMsgTime=+a.time,l.replyMsgIdServer=a.idServer,l.replyMsgIdClient=a.idClient,l.threadMsgFromAccount=a.from,l.threadMsgToAccount=a.to,l.threadMsgTime=+a.time,l.threadMsgIdServer=a.idServer,l.threadMsgIdClient=a.idClient,a.threadMessageInfo&&a.threadMessageInfo.threadMsgIdServer&&(l.threadMsgFromAccount=a.threadMessageInfo.threadMsgFromAccount,l.threadMsgToAccount=a.threadMessageInfo.threadMsgToAccount,l.threadMsgTime=a.threadMessageInfo.threadMsgTime,l.threadMsgIdServer=a.threadMessageInfo.threadMsgIdServer,l.threadMsgIdClient=a.threadMessageInfo.threadMsgIdClient)),l}function ai(e,t){return e.map(e=>{var n;return n=t||(Number.isNaN(parseInt(e.scene))?e.scene:1===parseInt(e.scene)?"p2p":"team"),{deletedTime:parseInt(e.time),from:e.from,idClient:e.deletedIdClient||e.idClient,idServer:e.deletedIdServer||e.idServer,scene:n,time:parseInt(e.deletedMsgCreateTime),to:e.to,ext:"string"==typeof e.ext?e.ext:null}})}function ci(e){for(var t=[],n=(e=e||[]).length-1;n>=0;n--)t.push(e[n]);return t}class li{constructor(e){this.core=e}processBroadcastMsg(e){var t=e.map(e=>Object.assign(Object.assign({},e),{time:parseInt(e.time)}));return this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:t.map(e=>e.id)}),t}}var di,ui,pi,hi={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",allowEmpty:!1,required:!1},pushPayload:{type:"string",allowEmpty:!1,required:!1}},gi={pushContent:8,pushPayload:9,needPush:107,needPushBadge:109,needPushNick:110},mi={"4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","4_21":"syncDeleteSelfMsgs","7_1":"sendMsg","8_23":"getHistoryTeamMsgs","21_14":"getHistorySuperTeamMsgs","8_2":"sendTeamMsg","21_2":"sendSuperTeamMsg","7_11":"sendMsgReceipt","7_13":"recallMsg","7_24":"deleteSelfMsgs","21_17":"recallSuperTeamMsg","7_2":"onMsg","8_3":"onMsg","21_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_102":"onMsg","8_4":"nimOnTeamMsgs","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg","7_123":"onDeleteSelfMsg","7_124":"onDeleteSelfMsgs"},fi=Object.assign(Object.assign({scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resendFlag:13,userUpdateTime:14,ext:15,needAntiSpam:21,antiSpamContent:22,antiSpamBIZID:23,clientAntispamHitting:24,antiSpamUsingYidun:25,needACK:26,yidunCallbackURL:27,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,isDeleted:39,callbackExt:40,subType:41,yidunAntiCheating:42,envConfig:43,yidunAntiSpamExtension:44,yidunAntiSpamResult:45,__clientExt:{id:46,converter:Yt,retConverter:Jt},needSaveHistory:100,needRoaming:101,needSelfSync:102,isMuted:104,needRouted:105,isInBlackList:106,needOffline:108,isReplyMsg:111,ackSnapshot:112},{pushContent:17,pushPayload:16,forcePushIDsList:18,forcePushContent:19,needForcePush:20,needPush:107,needPushBadge:109,needPushNick:110}),{function:47,topic:48,customContent:49,account:50}),vi={msg:fi,recallMsgTag:Object.assign({time:0,type:1,to:2,from:3,ps:4,attach:5,deletedIdClient:10,deletedIdServer:11,deleteMsgCreatetime:14,opeAccount:16,env:21},gi),deleteSelfMsgTag:{scene:1,from:2,to:3,idServer:4,idClient:5,deletedMsgCreateTime:6,time:7,ext:8},msgReceiptTag:{to:1,from:2,time:7,idClient:11},broadcastMsg:{id:1,fromAccid:2,time:4,body:5}},yi=Ht(vi),_i={sendMsg:{sid:7,cid:1,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:vi.msg}],response:[{type:"Property",name:"msg",reflectMapper:yi.msg}],ignoreErrCodes:[7101]},sendTeamMsg:{sid:8,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:vi.msg}],response:[{type:"Property",name:"msg",reflectMapper:yi.msg}]},sendSuperTeamMsg:{sid:21,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:vi.msg}],response:[{type:"Property",name:"msg",reflectMapper:yi.msg}]},onMsg:{sid:7,cid:2,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:yi.msg}]},nimOnTeamMsgs:{sid:8,cid:4,service:"msg",response:[{type:"PropertyArray",name:"datas",reflectMapper:yi.msg}]},getHistoryTeamMsgs:{sid:8,cid:23,service:"msg",params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:yi.msg}]},getHistorySuperTeamMsgs:{sid:21,cid:14,params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:yi.msg}],service:"msg"},recallMsg:{sid:7,cid:13,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:vi.recallMsgTag}]},deleteSelfMsgs:{sid:7,cid:24,service:"msg",params:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:vi.deleteSelfMsgTag}],response:[{type:"Long",name:"timetag"}]},recallSuperTeamMsg:{sid:21,cid:17,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:vi.recallMsgTag}]},sendMsgReceipt:{sid:7,cid:11,service:"msg",params:[{type:"Property",name:"msgReceiptTag",reflectMapper:vi.msgReceiptTag}],response:[{type:"Property",name:"msgReceiptTag",reflectMapper:yi.msgReceiptTag}]},batchMarkRead:{sid:4,cid:5,service:"msg",hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},syncMsgReceipts:{sid:4,cid:12,service:"msg",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:yi.msgReceiptTag},{type:"Long",name:"timetag"}]},syncOfflineMsgs:{sid:4,cid:4,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:yi.msg}]},syncRoamingMsgs:{sid:4,cid:9,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:yi.msg}]},syncBroadcastMsg:{sid:4,cid:16,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:yi.broadcastMsg}]},onBroadcastMsg:{sid:7,cid:17,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:yi.broadcastMsg}]},onDeleteSelfMsg:{sid:7,cid:123,service:"msg",response:[{type:"Property",name:"deletedMsg",reflectMapper:yi.deleteSelfMsgTag}]},onDeleteSelfMsgs:{sid:7,cid:124,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:yi.deleteSelfMsgTag}]},syncDeleteSelfMsgs:{sid:4,cid:21,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:yi.deleteSelfMsgTag}]}};!function(e){e[e.none=0]="none",e[e.pass=1]="pass",e[e.decline=2]="decline",e[e.read=3]="read",e[e.deleted=4]="deleted",e[e.invalid=5]="invalid"}(di||(di={})),function(e){e[e.default=0]="default",e[e.leave=1]="leave",e[e.roam=2]="roam"}(ui||(ui={})),function(e){e[e.applyTeam=0]="applyTeam",e[e.rejectTeamApply=1]="rejectTeamApply",e[e.teamInvite=2]="teamInvite",e[e.rejectTeamInvite=3]="rejectTeamInvite",e[e.friendRequest=5]="friendRequest",e[e.deleteFriend=6]="deleteFriend",e[e.recallMsgP2p=7]="recallMsgP2p",e[e.recallMsgTeam=8]="recallMsgTeam",e[e.recallMsgSuperTeam=12]="recallMsgSuperTeam",e[e.deleteMsgP2pOneWay=13]="deleteMsgP2pOneWay",e[e.deleteMsgTeamOneWay=14]="deleteMsgTeamOneWay",e[e.applySuperTeam=15]="applySuperTeam",e[e.rejectSuperTeamApply=16]="rejectSuperTeamApply",e[e.superTeamInvite=17]="superTeamInvite",e[e.rejectSuperTeamInvite=18]="rejectSuperTeamInvite",e[e.customP2p=100]="customP2p",e[e.customTeam=101]="customTeam",e[e.customSuperTeam=103]="customSuperTeam"}(pi||(pi={}));var Ii={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},Ti={setting:{needSaveOffline:{type:"boolean"},isRoutable:{type:"boolean"},envConfig:{type:"string"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"boolean"}},pushInfo:hi,recallMessageInfo:{idClient:{type:"string",rawKey:"deletedIdClient"},idServer:{type:"string",rawKey:"deletedIdServer"},createTime:{type:"number",rawKey:"deletedMsgCreateTime"},fromNick:{type:"string",rawKey:"deletedMsgFromNick"},opeAccount:{type:"string"}}};function Si(e,t,n){var r=+e.type,i=Be(pi,r);n=n||ui.default;var o=Object.assign(Object.assign({},an(Ti,e)),{type:i,time:+e.time,to:e.to,from:e.from,idServer:e.idServer,state:di[di.none],feature:ui[n]});if("0"===o.idServer&&o.setting&&(o.setting.needSaveOffline=!1),"string"==typeof o.attach)try{o.attach=JSON.parse(o.attach)}catch(s){t.error(`formatSystemMessage: ${o.idServer} parse attach error`,s&&s.message)}return 5===r&&o.attach?(o.attach.type=Ii[+o.attach.vt],"passFriendApply"===o.attach.type?o.state=di[di.pass]:"rejectFriendApply"===o.attach.type&&(o.state=di[di.decline])):r<=3&&o.attach&&(o.attach=function(e){var{attach:t,tinfo:n}=e,r=be(e,["attach","tinfo"]);return r.ext=t,void 0!==n&&(r.team=kr(qt(e.tinfo,Gr.team))),r}(o.attach)),o}function Ei(e){var t=Object.assign({},e);return Object.assign(Object.assign({},dn(Ti,t)),{type:pi[t.type],to:t.to,attach:t.attach})}function Mi(e){return e===pi.recallMsgP2p?"p2p":e===pi.recallMsgTeam?"team":e===pi.recallMsgSuperTeam?"superTeam":""}var bi={"5_1":"sync"},Ci={sync:{sid:5,cid:1,service:"sync",hasPacketTimer:!1,params:[{type:"Property",name:"sync",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Long",name:"timetag"}]}},Ai={"4_12":"syncMsgReceipts","4_14":"syncSessionAck","4_20":"syncSuperTeamSessionAck","4_22":"nimSyncSessionsWithMoreRoaming","4_25":"syncSessionReliableInfo","7_12":"multiSyncMsgReceipt","7_16":"markSessionAck","7_25":"markMultSessionsAck","7_116":"syncMarkSessionAck","21_25":"markSuperTeamSessionAck","21_32":"markMultSuperTeamSessionsAck","21_125":"syncMarkSuperTeamSessionAck","4_23":"nimSyncStickTopSessions","23_12":"nimAddStickTopSession","23_13":"nimDeleteStickTopSession","23_14":"nimUpdateStickTopSession","23_112":"nimMultiSyncAddStickTopSession","23_113":"nimMultiSyncDeleteStickTopSession","23_114":"nimMultiSyncUpdateStickTopSession"},Oi={msgReceiptTag:{to:1,from:2,time:7,idClient:11},stickTopSessionTag:{id:1,ext:2,createTime:3,updateTime:4},sessionAckTag:{scene:1,to:2,timetag:3},sessionReliableSyncTag:{scene:1,sessionId:2,syncStatus:3,syncEndMsgId:4,syncEndMsgidClient:5,syncEndMsgTime:6,syncStartMsgid:7,syncStartMsgidClient:8,syncStartMsgTime:9,nextMsgid:10,nextMsgidClient:11,nextMsgTime:12,roamMsgSync:13,offlineMsgSync:14,netCallOfflineMsgSync:15}},Ri=Ht(Oi),Ni={syncMsgReceipts:{sid:4,cid:12,service:"session",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:Ri.msgReceiptTag},{type:"Long",name:"timetag"}]},syncSessionAck:{sid:4,cid:14,service:"session",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamSessionAck:{sid:4,cid:20,service:"session",response:[{type:"LongLongMap",name:"superTeam"},{type:"Long",name:"timetag"}]},multiSyncMsgReceipt:{sid:7,cid:12,service:"session",response:[{type:"Property",name:"msgReceiptTag",reflectMapper:Ri.msgReceiptTag}]},markSessionAck:{sid:7,cid:16,service:"session",params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSessionAck:{sid:7,cid:116,service:"session",response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSuperTeamSessionAck:{sid:21,cid:125,service:"session",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},markMultSessionsAck:{sid:7,cid:25,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:Oi.sessionAckTag}]},markSuperTeamSessionAck:{sid:21,cid:25,service:"session",params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},nimAddStickTopSession:{sid:23,cid:12,service:"session",params:[{type:"Property",name:"tag",reflectMapper:Oi.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:Ri.stickTopSessionTag}]},nimDeleteStickTopSession:{sid:23,cid:13,service:"session",params:[{type:"Property",name:"tag",reflectMapper:Oi.stickTopSessionTag}],response:[{type:"Long",name:"timetag"}]},nimUpdateStickTopSession:{sid:23,cid:14,service:"session",params:[{type:"Property",name:"tag",reflectMapper:Oi.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:Ri.stickTopSessionTag}]},nimMultiSyncAddStickTopSession:{sid:23,cid:112,service:"session",response:[{type:"Property",name:"data",reflectMapper:Ri.stickTopSessionTag}]},nimMultiSyncDeleteStickTopSession:{sid:23,cid:113,service:"session",response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:Ri.stickTopSessionTag}]},nimMultiSyncUpdateStickTopSession:{sid:23,cid:114,service:"session",response:[{type:"Property",name:"data",reflectMapper:Ri.stickTopSessionTag}]},nimSyncStickTopSessions:{sid:4,cid:23,service:"session",response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:Ri.stickTopSessionTag}]},markMultSuperTeamSessionsAck:{sid:21,cid:32,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:Oi.sessionAckTag}]},nimSyncSessionsWithMoreRoaming:{sid:4,cid:22,service:"session",response:[]},syncSessionReliableInfo:{sid:4,cid:25,service:"session",response:[]}},wi={id:{type:"string"},ext:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function Pi(e,t,n=!0){var r=an(wi,e);r.isStickOnTop=n,r.id=t.id,n||(r.ext="");var i=Object.assign(Object.assign({},t),{stickTopInfo:t.stickTopInfo?Object.assign({},t.stickTopInfo,r):r});return void 0===i.lastMsg&&(i.lastMsg=null),i}class ki{constructor(e){this.core=e}getSession(e){return this.core.session.getSessionWithUncomplete({id:e})||this.core.session.createSession(e)}addStickTopSession(e){return Ce(this,void 0,void 0,function*(){Te({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e);var{scene:t,accid:n}=Fe(e.id),r=yield this.core.sendCmd("nimAddStickTopSession",{tag:{id:`${"superTeam"===t?"super_team":t}|${n}`,ext:e.ext||""}}),i=this.getSession(e.id);return Pi(r.content.data,i)})}deleteStickTopSession(e){return Ce(this,void 0,void 0,function*(){Te({id:{type:"string",allowEmpty:!1}},e);var{scene:t,accid:n}=Fe(e.id),r=yield this.core.sendCmd("nimDeleteStickTopSession",{tag:{id:`${"superTeam"===t?"super_team":t}|${n}`}}),i=this.getSession(e.id);return Pi({updateTime:r.content.timetag,ext:""},i,!1)})}updateStickTopSession(e){return Ce(this,void 0,void 0,function*(){Te({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e);var{scene:t,accid:n}=Fe(e.id),r=yield this.core.sendCmd("nimUpdateStickTopSession",{tag:{id:`${"superTeam"===t?"super_team":t}|${n}`,ext:e.ext||""}}),i=this.getSession(e.id);return Pi(r.content.data,i)})}stickTopSessionHandler(e,t=!0){var{scene:n,accid:r}=Fe(e.id,"|"),i=`${n}-${r}`;return Pi(e,this.getSession(i),t)}}class Li{constructor(e){this.core=e,this.logger=e.logger}canSessionResetUnreadCount(e){var t=e.id;if(void 0===e.lastMsg)throw new Error(`Session::canSessionResetUnreadCount: session ${t} is not completly, lastMsg undefined`);return null!==e.lastMsg||e.unread>0?!(e.ack&&e.lastMsg&&e.ack>=e.lastMsg.time&&(this.logger.log(`Session::canSessionResetUnreadCount: session ${t} reset failed, ack time is greater than last message time`),1)):(this.logger.log(`Session::canSessionResetUnreadCount: session ${t} doesn't need to be updated, lastMsg null and unread 0`),!1)}filterSessionForResetUnreadCount(e){var t={cmd:"markMultSuperTeamSessionsAck",params:[]},n={cmd:"markMultSessionsAck",params:[]};return e.forEach(e=>{var r,i;try{if(!this.canSessionResetUnreadCount(e))return;var{accid:o,scene:s}=Fe(e.id),a={to:o,sessionId:e.id,timetag:(null===(r=null==e?void 0:e.lastMsg)||void 0===r?void 0:r.time)||e.updateTime||0},c=dn({scene:{type:"enum",values:Qt}},i={scene:s});"superTeam"===s?t.params.push(a):n.params.push(Object.assign(Object.assign({},a),c))}catch(i){this.logger.warn(i)}}),{superTeam:t,p2pOrTeam:n}}}function xi(e,t){e=e||[],t=t||1,t=Math.max(Math.floor(t),1);for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}class Vi{constructor(e){this.core=e}notifyAddTeamMembers(e,t){this.core.emit("addTeamMembers",{team:e,accounts:t,members:Br(e,t)})}notifyUpdateTeamManagers(e,t,n,r){this.core.emit("updateTeamManagers",{team:{teamId:e,memberUpdateTime:r},accounts:t,isManager:n,members:t.map(t=>({id:`${e}-${t}`,account:t,type:n?"manager":"normal",updateTime:r}))})}notifyRemoveTeamMembers(e,t){this.core.emit("removeTeamMembers",{team:e,accounts:t})}notifyTransferTeam(e,t,n){this.core.emit("transferTeam",{team:e,from:{id:`${e.teamId}-${t}`,type:"normal",account:t,updateTime:e.memberUpdateTime},to:{id:`${e.teamId}-${n}`,type:"owner",account:n,updateTime:e.memberUpdateTime}})}notifyUpdateTeamMembersMute(e,t,n){this.core.emit("updateTeamMembersMute",{team:e,accounts:t,members:t.map(function(t){return{id:`${e.teamId}-${t}`,account:t,teamId:e.teamId,mute:n,updateTime:e.memberUpdateTime}}),mute:n})}}function Di(e,t){if((t=new Map).get(e))return e;if(e instanceof RegExp)return new RegExp(e);if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e))return t.set(e,!0),e.map(e=>Di(e,t));if("object"==typeof e&&null!==e){t.set(e,!0);var n={};return Object.keys(e).forEach(r=>{n[r]=Di(e[r],t)}),n}return e}var Ui={"4_6":"syncOfflineSysMsgs","4_18":"syncOfflineSysMsgs","4_19":"syncRecallMsgOfflineAndRoaming","7_3":"onSysMsg","7_7":"sendCustomSysMsg","7_14":"onRecallMsg","21_18":"onRecallMsg","21_117":"onRecallMsg","7_15":"syncRecallMsgOfflineAndRoaming","21_19":"onSysMsg","21_16":"sendSuperTeamCustomSysMsg"},$i={sysMsg:Object.assign({time:0,type:1,to:2,from:3,content:4,attach:5,idServer:6,needSaveOffline:7,deletedIdClient:10,deletedIdServer:11,needcAntiSpam:12,antiSpamContent:13,deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,envConfig:21,callbackExt:22,isRoutable:105},gi)},Bi=Ht($i),Fi={onSysMsg:{service:"systemMessage",sid:7,cid:3,response:[{type:"Property",name:"sysMsg",reflectMapper:Bi.sysMsg}]},sendCustomSysMsg:{service:"systemMessage",sid:7,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:$i.sysMsg}]},sendSuperTeamCustomSysMsg:{service:"systemMessage",sid:21,cid:16,params:[{type:"Property",name:"sysMsg",reflectMapper:$i.sysMsg}]},sendFilterCustomSysMsg:{service:"systemMessage",sid:101,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:$i.sysMsg}]},batchMarkRead:{service:"systemMessage",sid:4,cid:5,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},onRecallMsg:{sid:7,cid:14,service:"systemMessage",response:[{type:"Property",name:"sysMsg",reflectMapper:Bi.sysMsg}]},syncRecallMsgOfflineAndRoaming:{sid:7,cid:15,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:Bi.sysMsg},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]},syncOfflineSysMsgs:{sid:4,cid:9,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:Bi.sysMsg}]}};function ji(e){var t=Object.assign({},e);return["bitsExtension","createTime","updateTime","passRelationShip","relationShip","source"].forEach(e=>{void 0!==t[e]&&(t[e]=parseInt(t[e]))}),void 0!==t.relationShip&&(t.valid=1===t.relationShip),t}var qi={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},Gi={"12_4":"getFriends","12_1":"friendReuqest","12_2":"deleteFriend","12_3":"updateFriend","12_5":"syncFriends","12_6":"syncFriendUsers","12_101":"syncFriendRequest","12_102":"syncDeleteFriend","12_103":"syncUpdateFriend"},Hi={updateFriendTag:{account:4,alias:8,ext:10},delFriendParams:{delAlias:1},friendTag:{account:4,relationShip:5,passRelationShip:6,source:7,alias:8,bitsExtension:9,ext:10,createTime:11,updateTime:12,serverex:13},userTag:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13}},Wi=Ht(Hi),zi={getFriends:{sid:12,cid:4,service:"friend",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:Wi.friendTag},{type:"Long",name:"timetag"}]},friendReuqest:{sid:12,cid:1,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:12,cid:2,service:"friend",params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams",reflectMapper:Hi.delFriendParams}]},updateFriend:{sid:12,cid:3,service:"friend",params:[{type:"Property",name:"updateFriendTag",reflectMapper:Hi.updateFriendTag}]},syncFriends:{sid:12,cid:5,service:"friend",response:[{type:"PropertyArray",name:"friends",entity:"friendTag",reflectMapper:Wi.friendTag},{type:"Long",name:"timetag"}]},syncFriendUsers:{sid:12,cid:6,service:"friend",response:[{type:"PropertyArray",name:"users",entity:"userTag",reflectMapper:Wi.userTag},{type:"Long",name:"timetag"}]},syncFriendRequest:{sid:12,cid:101,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}],response:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},syncDeleteFriend:{sid:12,cid:102,service:"friend",response:[{type:"String",name:"account"}]},syncUpdateFriend:{sid:12,cid:103,service:"friend",response:[{type:"Property",name:"friend",reflectMapper:Wi.friendTag}]}};function Ki(e){return e&&e.length>0?e.map(e=>{return t=e,n=Object.assign({},t),["subscribeTime","time"].forEach(e=>{n[e]&&(n[e]=parseInt(n[e]))}),n;var t,n}):[]}function Yi(e){if(!e)return e;var{serverExt:t}=e,n=be(e,["serverExt"]);if(["time","type","value"].forEach(e=>{n[e]&&(n[e]=parseInt(n[e]))}),n.clientType&&(n.clientType=Be(Zt,n.clientType)||""),t)try{n.ext=JSON.parse(t),"string"==typeof n.ext[0]&&(n.ext=n.ext[0])}catch(r){}return n}var Ji,Xi={"14_1":"publishEvent","14_2":"pushEvent","14_3":"subscribeEvent","14_4":"unSubscribeEventsByAccounts","14_5":"unSubscribeEventsByType","14_6":"querySubscribeEventsByAccounts","14_7":"querySubscribeEventsByType","14_9":"pushEvents"},Qi={msgEvent:{type:1,value:2,idClient:3,ext:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverExt:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105}},Zi=Ht(Qi),eo={publishEvent:{sid:14,cid:1,service:"event",params:[{type:"Property",name:"msgEvent",reflectMapper:Qi.msgEvent}],response:[{type:"Property",name:"msgEvent",reflectMapper:Zi.msgEvent}]},pushEvent:{sid:14,cid:2,service:"event",response:[{type:"Property",name:"msgEvent",reflectMapper:Zi.msgEvent}]},subscribeEvent:{sid:14,cid:3,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Qi.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:14,cid:4,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Qi.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:14,cid:5,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Qi.msgEventSubscribe}]},querySubscribeEventsByAccounts:{sid:14,cid:6,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Qi.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Zi.msgEventSubscribe}]},querySubscribeEventsByType:{sid:14,cid:7,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Qi.msgEventSubscribe}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Zi.msgEventSubscribe}]},pushEvents:{sid:14,cid:9,service:"event",response:[{type:"PropertyArray",name:"msgEvents",reflectMapper:Zi.msgEvent}]}},to={"23_1":"getThreadMsgs","23_2":"getMsgsByIdServer"},no={msg:fi,threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2}},ro=Ht(no),io={getThreadMsgs:{sid:23,cid:1,service:"msgExtend",params:[{type:"Property",name:"msg",reflectMapper:no.msg},{type:"Property",name:"threadMsgReq",reflectMapper:no.threadMsgReq}],response:[{type:"Property",name:"threadMsg",reflectMapper:ro.msg},{type:"Property",name:"threadMsgsMeta",reflectMapper:ro.threadMsgsMeta},{type:"PropertyArray",name:"msgs",reflectMapper:ro.msg}]},getMsgsByIdServer:{sid:23,cid:2,service:"msgExtend",params:[{type:"PropertyArray",name:"reqMsgs",reflectMapper:no.msg}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:ro.msg}]}};!function(e){e[e.ASC=1]="ASC",e[e.DESC=2]="DESC"}(Ji||(Ji={}));var oo,so={"7_6":"getHistoryMsgs","7_9":"deleteRoamingMsgs","4_24":"syncClearServerHistoryMsgs","7_18":"clearHistoryMsgsFromServer","7_118":"multiSyncClearServerHistoryMsgs","7_26":"nimFtsCloudMsgLogsAggWithSession","7_27":"nimFtsCloudMsgLogs"},ao={msg:fi,clearHistoryMsgsFromServerReqTag:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,time:6,ext:7},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},ftsReqTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msglogsLimit:5,orderRule:6,p2pSessionList:7,teamSessionList:8,senderList:9,msgTypeList:10,msgSubTypeList:11}},co=Ht(ao),lo={deleteRoamingMsgs:{sid:7,cid:9,service:"msgLog",params:[{type:"StrArray",name:"ids"}]},getHistoryMsgs:{sid:7,cid:6,params:[{type:"String",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:co.msg}],service:"msgLog"},clearHistoryMsgsFromServer:{sid:7,cid:18,params:[{type:"Property",name:"clearHistoryMsgsFromServerReqTag",reflectMapper:ao.clearHistoryMsgsFromServerReqTag}],response:[{type:"Long",name:"timetag"}],service:"msgLog"},multiSyncClearServerHistoryMsgs:{sid:7,cid:118,response:[{type:"Property",name:"data",reflectMapper:co.clearMsgsParamsWithSync}],service:"msgLog"},syncClearServerHistoryMsgs:{sid:4,cid:24,service:"msgLog",response:[{type:"PropertyArray",name:"datas",reflectMapper:co.clearMsgsParamsWithSync}]},nimFtsCloudMsgLogsAggWithSession:{sid:7,cid:26,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:ao.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:co.msg}]},nimFtsCloudMsgLogs:{sid:7,cid:27,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:ao.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:co.msg}]}};!function(e){e[e.p2p=1]="p2p",e[e.team=2]="team"}(oo||(oo={}));var uo={type:{type:"enum",values:oo},isDeleteRoam:{type:"boolean"},isSyncSelf:{type:"boolean"},time:{type:"number"}};function po(e){var t=an(uo,e);return{sessionId:"p2p"===t.type?`p2p-${t.otherAccid}`:`team-${t.toTid}`,time:t.time}}var ho,go,mo={orderRule:{type:"enum",values:Ji}},fo={"22_1":"requestProxy","22_2":"onRequestProxy"},vo={requestProxyTag:{zone:1,path:2,method:3,header:4,body:5},requestProxyMsgTag:{from:1,body:2,time:3}},yo=Ht(vo),_o={requestProxy:{sid:22,cid:1,service:"passThrough",params:[{type:"Property",name:"requestProxyTag",reflectMapper:vo.requestProxyTag}],response:[{type:"Property",name:"requestProxyTag",reflectMapper:yo.requestProxyTag}]},onRequestProxy:{sid:22,cid:2,service:"passThrough",response:[{type:"Property",name:"proxyMsg",reflectMapper:yo.requestProxyMsgTag}]}},Io={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},To={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function So(e="file"){var t=Io[e]||{};return JSON.stringify(t).replace(/"/gi,'\\"')}!function(e){e[e.nos=1]="nos",e[e.s3=2]="s3"}(ho||(ho={})),function(e){e[e.dontNeed=-1]="dontNeed",e[e.time=2]="time",e[e.urls=3]="urls"}(go||(go={}));var Eo={chunkUploadHost:"https://wannos-web.127.net",chunkUploadHostBackupList:["https://fileup.chatnos.com","https://oss.chatnos.com"],commonUploadHost:"https://fileup.chatnos.com",commonUploadHostBackupList:["https://oss.chatnos.com"],chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0};function Mo(e,t){e=e||{},t=t||(()=>!0);var n={};for(var r in e)t(e[r])&&(n[r]=e[r]);return n}class bo{constructor(e,t){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=e,this.cloudStorage=t}get config(){return this.cloudStorage.config}reset(){this.nosErrorCount=0}getNosAccessToken(e){return Ce(this,void 0,void 0,function*(){var t=Ve(yield this.core.sendCmd("getNosAccessToken",{tag:e}),"content.nosAccessTokenTag.token"),n=e.url;return{token:t,url:-1!==n.indexOf("?")?n+"&token="+t:n+"?token="+t}})}deleteNosAccessToken(e){return Ce(this,void 0,void 0,function*(){yield this.core.sendCmd("deleteNosAccessToken",{tag:e})})}nosUpload(e,t){var n,r,i,o,s,a,c,l;return Ce(this,void 0,void 0,function*(){var d=Ve(this.core,"config.cdn.bucket"),u={tag:e.nosScenes||d||"nim"};e.nosSurvivalTime&&(u.expireSec=e.nosSurvivalTime);var p,h=this.core.adapters.getFileUploadInformation(e);if(!t&&!h)try{p=yield this.core.sendCmd("getNosToken",{responseBody:So(e.type),nosToken:u})}catch(O){if(this.core.logger.error("uploadFile:: getNosToken error",O),O instanceof pe)throw O;throw new fe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:O,curProvider:1}})}var g=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",h?null===(n=h.uploadInfo)||void 0===n?void 0:n.objectName:t?null==t?void 0:t.objectName:p.content.nosToken.objectName),m="";t&&t.shortUrl&&(m=t.shortUrl),(null===(o=null===(i=null===(r=null==h?void 0:h.uploadInfo)||void 0===r?void 0:r.payload)||void 0===i?void 0:i.mixStoreToken)||void 0===o?void 0:o.shortUrl)&&(m=h.uploadInfo.payload.mixStoreToken.shortUrl);var f,v=m||g;try{var y=h?{token:null===(s=null==h?void 0:h.uploadInfo)||void 0===s?void 0:s.token,bucket:null===(a=null==h?void 0:h.uploadInfo)||void 0===a?void 0:a.bucketName,objectName:null===(c=null==h?void 0:h.uploadInfo)||void 0===c?void 0:c.objectName}:t||p.content.nosToken;this.core.logger.log("uploadFile:: uploadFile params",{nosToken:y,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,platform:we.platform});var _="BROWSER"===we.platform?this.config.chunkUploadHost:`${this.config.commonUploadHost}/${y&&y.bucket}`;this.core.reporterHookCloudStorage.update({remote_addr:_,operation_type:t?2:0}),f=yield this.core.adapters.uploadFile(Object.assign(Object.assign(Object.assign({},e),{nosToken:y,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,maxSize:e.maxSize||this.config.chunkMaxSize}),t?{payload:{mixStoreToken:t}}:{}))}catch(R){this.core.logger.error("uploadFile::nos uploadFile error:",R);var I="v2"===Ve(this.core,"options.apiVersion");if(R.code===le.V2NIM_ERROR_CODE_CANCELLED||10499===R.errCode)throw new fe({code:I?le.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:Ve(R,"message")||"Request abort",rawError:R,curProvider:1}});if(I&&R.errCode===le.V2NIM_ERROR_CODE_FILE_OPEN_FAILED)throw new pe({code:le.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:Ve(R,"message")||"Read file failed",rawError:R,curProvider:1}});var{net_connect:T}=yield we.net.getNetworkStatus();if(!1===T)throw new fe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:R,curProvider:1}});if(t){if(this.nosErrorCount<=0){try{this.cloudStorage.mixStorage._addCircuitTimer()}catch(N){throw new fe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:N,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:e.file||e.filePath}})}return this.nosErrorCount=Ve(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),this.cloudStorage._uploadFile(e)}return this.nosErrorCount--,this.nosUpload(e,t)}throw new fe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:R,curProvider:1}})}var S=null==f?void 0:f.type,E=S&&S.indexOf("/")>-1?S.slice(0,S.indexOf("/")):"";E||(E=e.type||"");var M,b={image:"imageInfo",video:"vinfo",audio:"vinfo"};if(!b[E])return Object.assign({url:v},f);try{M=yield this.core.adapters.request(`${g}?${b[E]}`,{method:"GET",dataType:"json",timeout:5e3},{exception_service:3})}catch(O){return this.core.logger.error("uploadFile:: fetch file info error",O),Object.assign({url:v},f)}if(M){var{data:C}=M,A="imageInfo"===b[E]?C:null===(l=null==C?void 0:C.GetVideoInfo)||void 0===l?void 0:l.VideoInfo;return Mo({url:v,name:f.name,size:f.size,ext:f.ext,w:null==A?void 0:A.Width,h:null==A?void 0:A.Height,orientation:null==A?void 0:A.Orientation,dur:null==A?void 0:A.Duration,audioCodec:null==A?void 0:A.AudioCodec,videoCodec:null==A?void 0:A.VideoCodec,container:null==A?void 0:A.Container},function(e){return void 0!==e})}return Object.assign({url:v},f)})}_getNosCdnHost(){var e;return Ce(this,void 0,void 0,function*(){var t;try{t=yield this.core.sendCmd("getNosCdnHost")}catch(i){return void this.core.logger.error("getNosCdnHost::error",i)}if(t){var n=null===(e=null==t?void 0:t.content)||void 0===e?void 0:e.nosConfigTag,r=parseInt(null==n?void 0:n.expire);0!==r&&n.cdnDomain?-1===r?(this.config.cdn.bucket=n.bucket,this.config.cdn.cdnDomain=n.cdnDomain,this.config.cdn.objectNamePrefix=n.objectNamePrefix):(this.config.cdn.bucket=n.bucket,this.config.cdn.cdnDomain=n.cdnDomain,this.config.cdn.objectNamePrefix=n.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer(()=>{this._getNosCdnHost()},1e3*r)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="")}})}}var Co={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},Ao={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4,policyVersion:5},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4,policyVersion:5},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},Oo={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:Ao.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:Wt(Ao.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Ao.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Wt(Ao.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:Wt(Ao.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:Wt(Ao.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:Wt(Ao.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:Ao.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:Wt(Ao.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:Ao.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:Wt(Ao.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Ao.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:Wt(Ao.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Ao.nosAccessTokenTag}]}};class Ro{constructor(e,t){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=e,this.cloudStorage=t,this.logger=e.logger}reset(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10}getGrayscaleConfig(e,t){var n;return Ce(this,void 0,void 0,function*(){if(we.localStorage)try{we.localStorage.getItem&&we.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(we.localStorage.getItem(this.GRAYKEY))[e])}catch(o){we.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",o)}if(!this.grayConfig||this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<t){var r=yield this.core.sendCmd("getGrayscaleConfig",{config:{}});if(r.content&&r.content.grayConfigTag){this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(r.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(r.content.grayConfigTag.ttl)}catch(o){this.logger.error("getGrayscaleConfig error",o)}if(!this.grayConfig)return;var i=we.localStorage.getItem(this.GRAYKEY)?JSON.parse(we.localStorage.getItem(this.GRAYKEY)):{};this.grayConfig.timeStamp=(new Date).getTime(),i[e]=this.grayConfig,we.localStorage.setItem(this.GRAYKEY,JSON.stringify(i))}else this.logger.log("uploadFile:: result grayConfig:",r.content)}(null===(n=this.grayConfig)||void 0===n?void 0:n.mixStoreEnable)&&(yield this._getMixStorePolicy(e))})}_getMixStorePolicy(e){return Ce(this,void 0,void 0,function*(){var t=(new Date).getTime();if(we.localStorage)try{if(this.mixStorePolicy=JSON.parse(we.localStorage.getItem(this.MIXSTOREKEY))[e],this.curProvider=parseInt(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>t){var n=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-t;this.core.timerManager.addTimer(this._getMixStorePolicy.bind(this,e),n)}}catch(o){we.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(we.localStorage.getItem(this.MIXSTOREKEY))[e]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",o)}if(!this.mixStorePolicy||this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=t)try{var r=(yield this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]})).content.mixStorePolicyTag;this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.mixStorePolicy.policyVersion=r.policyVersion,this.mixStorePolicy.ttl=Number(r.ttl),this.mixStorePolicy.providers=r.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=parseInt(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=r.nosPolicy?JSON.parse(r.nosPolicy):null,this.mixStorePolicy.s3Policy=r.s3Policy?JSON.parse(r.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(this._getMixStorePolicy.bind(this,e),1e3*this.mixStorePolicy.ttl);var i=we.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(we.localStorage.getItem(this.MIXSTOREKEY)):{};this.mixStorePolicy.timeStamp=(new Date).getTime(),i[e]=this.mixStorePolicy,we.localStorage.setItem(this.MIXSTOREKEY,JSON.stringify(i))}catch(o){if(this.logger.error("getMixStorePolicy error",o),0===this.mixStoreErrorCount)throw new Error("getMixStorePolicy all count error");this._getMixStorePolicy(e),this.mixStoreErrorCount--}this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry)})}_addCircuitTimer(){var e=this.mixStorePolicy.providers,t=e[(e.indexOf(String(this.curProvider))+1)%e.length];if(!t)throw new Error("uploadFile nextProvider error");if(t===e[0])throw new Error("uploadFile all policy fail");if(this.logger.log(`uploadFile:: upload policy will change,now policy:${this.curProvider} nextProvider:${t}`),this.curProvider=parseInt(t),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy){var n=this.mixStorePolicy[1===this.curProvider?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!n||0===n)throw new Error("uploadFile circuit error");this.circuitTimer=this.core.timerManager.addTimer(()=>{this.logger.log(`uploadFile:: upload policy will change,now policy:${this.curProvider} nextProvider:${parseInt(this.mixStorePolicy.providers[0])}`),this.curProvider=parseInt(this.mixStorePolicy.providers[0]),this.core.timerManager.deleteTimer(this.circuitTimer)},1e3*n)}throw new Error("uploadFile will not retry again")}getFileAuthToken(e){return Ce(this,void 0,void 0,function*(){return(yield this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:e})).content.mixStoreAuthTokenResTag})}}var No=-1;class wo{constructor(e,t){this.s3=null,this.core=e,this.cloudStorage=t,this.logger=e.logger}get mixStorePolicy(){return this.cloudStorage.mixStorage.mixStorePolicy}s3Upload(e,t){return Ce(this,void 0,void 0,function*(){var n;if(No+=1,e.file)n=e.file;else if("string"==typeof e.fileInput){this.logger.warn("fileInput will abandon,Please use file or filepath");var r=document.getElementById(e.fileInput);if(!(r&&r.files&&r.files[0]))throw new Error("Can not get file from fileInput");n=r.files[0]}else{if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0]))throw new Error(`Can not get file from fileInput ${e.fileInput}`);n=e.fileInput.files[0]}if(!this.mixStorePolicy.s3Policy)throw new Error("dont get s3 policy");var i={accessKeyId:t.accessKeyId,secretAccessKey:t.secretAccessKey,sessionToken:t.sessionToken,region:t.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},o=this.s3,s=decodeURIComponent(t.bucket),a=decodeURIComponent(t.objectName),c=n,l=`https://${s}.s3.amazonaws.com/${a}`,d={},u=this.mixStorePolicy.s3Policy;if(u&&u.uploadConfig&&Array.isArray(u.uploadConfig.uploadUrl)&&u.uploadConfig.uploadUrl.length>0){var p=u.uploadConfig.uploadUrl.length;No%=p,d.endpoint=u.uploadConfig.uploadUrl[No],d.s3ForcePathStyle=!0,l=`${d.endpoint}/${s}/${a}`}this.core.reporterHookCloudStorage.update({remote_addr:l,operation_type:1});var h=new o(d);h.config.update(i);var g={Bucket:s,Key:a,Body:c,Metadata:{token:t.token},ContentType:c.type||"application/octet-stream"};this.core.logger.log("uploadFile:: s3 upload params:",g);var m=h.upload(g);return m.on("httpUploadProgress",t=>{var n=parseFloat((t.loaded/t.total).toFixed(2));e.onUploadProgress&&e.onUploadProgress({total:t.total,loaded:t.loaded,percentage:n,percentageText:Math.round(100*n)+"%"})}),new Promise((n,r)=>{var i=(new Date).getTime();m.send((o,l)=>Ce(this,void 0,void 0,function*(){var d,u,p;if(o&&"RequestAbortedError"===o.code)this.logger.error("uploadFile:","api::s3:upload file abort.",o),r(new fe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:o,curProvider:2}}));else{if(!o){var h=this.mixStorePolicy.s3Policy.cdnSchema;h=(h=h.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn)).replace("{objectName}",l.Key);var g={size:c.size,name:c.name,url:t.shortUrl?t.shortUrl:h,ext:c.name.split(".")[1]||"unknown"},m=e.type||"",f={image:"imageInfo"};return n(f[m]?yield this.getS3FileInfo({url:h,infoSuffix:f[m],s3Result:g}):g)}this.logger.error("uploadFile:","api::s3:upload file failed.",o),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(u=null===(d=this.core)||void 0===d?void 0:d.auth)||void 0===u?void 0:u.account),trace_id:null===(p=this.core.clientSocket.socket)||void 0===p?void 0:p.sessionId,start_time:i,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof o.status?o.status:"number"==typeof o.code?o.code:0,description:o.message||`${o.code}`,operation_type:1,target:JSON.stringify({bucket:s,object:a})},{asyncParams:we.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1);var{net_connect:v}=yield we.net.getNetworkStatus();if(!1===v)return r(new fe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:o,curProvider:this.cloudStorage.mixStorage.curProvider}}));try{this.cloudStorage.mixStorage._addCircuitTimer()}catch(y){return r(new fe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:y,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:e.file||e.filePath}}))}n(this.cloudStorage._uploadFile(e))}})),e.onUploadStart&&e.onUploadStart(m)})})}getS3FileInfo(e){var t;return Ce(this,void 0,void 0,function*(){var n,{url:r,infoSuffix:i,s3Result:o}=e;try{n=yield this.core.adapters.request(`${r}?${i}`,{method:"GET",dataType:"text",timeout:5e3},{exception_service:3})}catch(c){return this.core.logger.error("uploadFile:: fetch file info error",c),o}if(n){var{data:s}=n,a="imageInfo"===i?s:null===(t=null==s?void 0:s.GetVideoInfo)||void 0===t?void 0:t.VideoInfo;return Mo(Object.assign(Object.assign({},o),{w:null==a?void 0:a.Width,h:null==a?void 0:a.Height,orientation:null==a?void 0:a.Orientation,dur:null==a?void 0:a.Duration,audioCodec:null==a?void 0:a.AudioCodec,videoCodec:null==a?void 0:a.VideoCodec,container:null==a?void 0:a.Container}),function(e){return void 0!==e})}return this.core.logger.error("uploadFile:: fetch s3 file info no result",`${r}?${i}`),o})}}class Po{constructor(e,t={}){this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=e.logger,this.core=e,this.nos=new bo(e,this),this.mixStorage=new Ro(e,this),this.aws=new wo(e,this),Gt({cmdMap:Co,cmdConfig:Oo}),this.setOptions(t),this.setListeners()}setOptions(e={}){var t=e.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=t+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=t+"-AllMixStorePolicy";var{s3:n}=e,r=be(e,["s3"]),i=Object.assign({},Eo,this.config);if(r&&Object.prototype.hasOwnProperty.call(r,"cdn")){var o=Object.assign(Object.assign({},i.cdn),r.cdn);this.config=Object.assign({},i,r),this.config.cdn=o}else this.config=Object.assign({},i,r);n&&(this.aws.s3=n)}setListeners(){this.core.eventBus.on("kicked",this._clearUnCompleteTask.bind(this)),this.core.eventBus.on("disconnect",this._clearUnCompleteTask.bind(this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",this._clearUnCompleteTask.bind(this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",this._clearUnCompleteTask.bind(this))}_clearUnCompleteTask(){Object.keys(this.uploadTaskMap).forEach(e=>{var t=this.uploadTaskMap[e];t&&t.abort&&t.abort()}),this.uploadTaskMap={}}init(e=Date.now()){return Ce(this,void 0,void 0,function*(){this.mixStorage.reset(),this.nos.reset(),this.config.isNeedToGetUploadPolicyFromServer&&(yield this.mixStorage.getGrayscaleConfig(this.core.options.appkey,e)),yield this.nos._getNosCdnHost()})}processCallback(e,t){var n=e.onUploadProgress,r=e.onUploadDone,i=e.onUploadStart;return{onUploadStart:"function"==typeof i?e=>{this.uploadTaskMap[t]=e;try{i(e)}catch(n){this.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",n)}}:e=>{this.uploadTaskMap[t]=e},onUploadProgress:"function"==typeof n?e=>{this.core.reporterHookCloudStorage.update({transferred_size:e.loaded,full_size:e.total});try{n(e)}catch(t){this.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",t)}}:e=>{this.core.reporterHookCloudStorage.update({transferred_size:e.loaded,full_size:e.total})},onUploadDone:"function"==typeof r?e=>{this.core.reporterHookCloudStorage.end(0);try{r(e)}catch(t){this.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",t)}}:()=>{this.core.reporterHookCloudStorage.end(0)},taskKey:t}}uploadFile(e){return Ce(this,void 0,void 0,function*(){if(Te({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},e),!e.fileInput&&!e.file&&!e.filePath)throw new Error("uploadFile needs target file object or a filePath");if(e.type&&"file"!==e.type){var t=Ve(e,"file.type");if(t&&"string"==typeof t&&-1===t.indexOf(e.type))throw new Error(`The meta type "${t}" does not match "${e.type}"`)}if(this.core.reporterHookCloudStorage.start(),e.file)this.core.reporterHookCloudStorage.update({full_size:e.file.size});else if("string"==typeof e.fileInput){var n=document.getElementById(e.fileInput);n&&n.files&&n.files[0]&&this.core.reporterHookCloudStorage.update({full_size:n.files[0].size})}else e.fileInput&&e.fileInput.files&&e.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:e.fileInput.files[0].size});var r=Ue(),{onUploadStart:i,onUploadProgress:o,onUploadDone:s}=this.processCallback(e,r);e.onUploadStart=i,e.onUploadProgress=o,e.onUploadDone=s;var a=null;try{a=yield this._uploadFile(e),e.md5&&(a.md5=e.md5),delete this.uploadTaskMap[r]}catch(c){throw delete this.uploadTaskMap[r],this.core.reporterHookCloudStorage.end((c&&c.code)===le.V2NIM_ERROR_CODE_CANCELLED?3:1),c}return a&&(a.size=void 0===a.size?void 0:Number(a.size),a.w=void 0===a.w?void 0:Number(a.w),a.h=void 0===a.h?void 0:Number(a.h),a.dur=void 0===a.dur?void 0:Number(a.dur)),a.url=decodeURIComponent(a.url),e.onUploadDone({size:a.size,name:a.name,url:a.url,ext:a.name.split(".")[1]||"unknown"}),a})}_uploadFile(e){var t,n;return Ce(this,void 0,void 0,function*(){if(!Ve(this.mixStorage,"grayConfig.mixStoreEnable")||!Ve(this.mixStorage,"mixStorePolicy.providers.length"))return this.logger.log("uploadFile:: uploadFile begin, use old nos"),this.nos.nosUpload(e);this.logger.log(`uploadFile::_uploadFile, grayConfig enable:${Ve(this.mixStorage,"grayConfig.mixStoreEnable")} curProvider:${Ve(this.mixStorage,"curProvider")}`);var r=this.core.adapters.getFileUploadInformation(e),i=!0;r?!1===r.complete&&2===this.mixStorage.curProvider&&(i=!1):i=!1,this.aws.s3||(this.mixStorage.curProvider=1);var o=To;if(!i)try{o=(yield this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:e.nosSurvivalTime,returnBody:So(e.type),policyVersion:this.mixStorage.mixStorePolicy.policyVersion}})).content.mixStoreTokenResTag}catch(s){if(this.core.logger.error("uploadFile:: getMixStoreToken error",s),s instanceof pe)throw s;throw new fe({code:"v2"===Ve(this.core,"options.apiVersion")?le.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:s,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}})}return i?this.nos.nosUpload(e,null===(n=null===(t=null==r?void 0:r.uploadInfo)||void 0===t?void 0:t.payload)||void 0===n?void 0:n.mixStoreToken):2===this.mixStorage.curProvider?this.aws.s3Upload(e,o):this.nos.nosUpload(e,o)})}getThumbUrl(e,t){var n,r,i,o,s;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),e;var[a,c,l,d,u,p,h,g]=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);if(null===(n=this.grayConfig)||void 0===n?void 0:n.mixStoreEnable){var m=this._getUrlType(e);if(2===m&&this.mixStorePolicy.s3Policy&&Ve(this.mixStorePolicy,"s3Policy.thumbPolicy.imagethumb"))return(null===(i=null===(r=this.mixStorePolicy.s3Policy)||void 0===r?void 0:r.thumbPolicy)||void 0===i?void 0:i.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",p).replace("{x}",t.width.toString()).replace("{y}",t.height.toString());if(1===m&&this.mixStorePolicy.nosPolicy&&Ve(this.mixStorePolicy,"nosPolicy.thumbPolicy.imagethumb"))return(null===(s=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.thumbPolicy)||void 0===s?void 0:s.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",p).replace("{x}",t.width.toString()).replace("{y}",t.height.toString())}return e.includes("?")?e+`&imageView&thumbnail=${t.width}x${t.height}`:e+`?imageView&thumbnail=${t.width}x${t.height}`}getVideoCoverUrl(e,t){var n,r,i,o,s;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),e;var[a,c,l,d,u,p,h,g]=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);if(null===(n=this.grayConfig)||void 0===n?void 0:n.mixStoreEnable){var m=this._getUrlType(e);if(2===m&&this.mixStorePolicy.s3Policy&&Ve(this.mixStorePolicy,"s3Policy.thumbPolicy.vframe"))return(null===(i=null===(r=this.mixStorePolicy.s3Policy)||void 0===r?void 0:r.thumbPolicy)||void 0===i?void 0:i.vframe).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",p).replace("{x}",t.width.toString()).replace("{y}",t.height.toString()).replace("{offset}","0").replace("{type}","png");if(1===m&&this.mixStorePolicy.nosPolicy&&Ve(this.mixStorePolicy,"nosPolicy.thumbPolicy.vframe"))return(null===(s=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.thumbPolicy)||void 0===s?void 0:s.vframe).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",p).replace("{x}",t.width.toString()).replace("{y}",t.height.toString()).replace("{offset}","0").replace("{type}","png")}return e.includes("?")?e+`&vframe&offset=0&resize=${t.width}x${t.height}&type=png`:e+`?vframe&offset=0&resize=${t.width}x${t.height}&type=png`}getPrivateUrl(e){var t;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),"";var[n,r,i,o,s,a,c,l]=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);if(null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable){var d=this._getUrlType(e);return 2===d&&this.mixStorePolicy.s3Policy&&(e=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",a)),1===d&&this.mixStorePolicy.nosPolicy&&(e=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",a)),e}var{downloadUrl:u,downloadHostList:p,nosCdnEnable:h}=this.config,g=this.config.cdn.cdnDomain,m=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",f=decodeURIComponent(a),v=f.indexOf(m);if(g&&v>-1&&h)return`${r}${g}/${f.slice(v)}`;if(p.includes(o)&&a.includes("/")){var y=a.indexOf("/"),_=a.substring(0,y),I=a.substring(y+1);return u.replace("{bucket}",_).replace("{object}",I)}var T=p.filter(e=>"string"==typeof o&&o.includes(e))[0],S=T?o.replace(T,"").replace(/\W/g,""):null;return S?u.replace("{bucket}",S).replace("{object}",a):e}getOriginUrl(e){return Ce(this,void 0,void 0,function*(){return"string"==typeof e&&e.includes("_im_url=1")?(yield this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:e}})).content.nosSafeUrlTag.originUrl:e})}getFileToken(e){return Ce(this,void 0,void 0,function*(){Te({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},e);var t=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,n=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null;if(t===String(-1)&&n===String(-1))throw this.logger.error("don't need token"),new Error("don't need token");if(2===e.type){if(t&&t.indexOf(String(2))>=0||n&&n.indexOf(String(2))>0)return this.mixStorage.getFileAuthToken(e);throw this.logger.error("don't support time token "),new Error("don't support type time token ")}if(!e.urls||!e.urls.length)throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");var r=[],i=[];if(e.urls.forEach(e=>{var t=this._getUrlType(e);1===t&&i.push(e),2===t&&r.push(e)}),(!n||0!==r.length&&n.indexOf(String(3))<0)&&(this.logger.warn("s3 url don't support url token"),r=[]),(!t||0!==i.length&&t.indexOf(String(3))<0)&&(this.logger.warn("nos url don't support url token"),i=[]),0===r.length&&0===i.length)throw this.logger.error("not support urls"),new Error("not support urls");if(0===r.length||0===i.length)return e.urls=JSON.stringify(e.urls),this.mixStorage.getFileAuthToken(e)})}_getUrlType(e){return this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.nosPolicy.dlcdns.some(t=>e.indexOf(t)>=0)?1:this.mixStorePolicy.s3Policy&&this.mixStorePolicy.s3Policy.dlcdns.some(t=>e.indexOf(t)>=0)?2:null}getNosAccessToken(e){return Te({url:{type:"string",allowEmpty:!1}},e),this.nos.getNosAccessToken(e)}deleteNosAccessToken(e){return Te({token:{type:"string",allowEmpty:!1}},e),this.nos.deleteNosAccessToken(e)}get grayConfig(){return this.mixStorage.grayConfig}get mixStorePolicy(){return this.mixStorage.mixStorePolicy}process(e){var t=Ve(e,"error.detail.ignore");return e.error&&!t?Promise.reject(e.error):Promise.resolve(e)}}var ko=vr({none:0,normal:1,all:3}),Lo=vr({normal:0,advanced:1}),xo=vr({normal:0,owner:1,manager:2}),Vo={noVerify:0,needVerify:1,rejectAll:2},Do=vr(Vo),Uo={needVerify:0,noVerify:1},$o=vr(Uo),Bo={manager:0,all:1},Fo=vr(Bo),jo={manager:0,all:1},qo=vr(jo),Go={manager:0,all:1},Ho=vr(Go);function Wo(e){var t={type:Lo,muteType:ko,joinMode:Do,beInviteMode:$o,inviteMode:Fo,updateTeamMode:qo,updateExtMode:Ho},n=be(e,["bits"]);return["teamId"].forEach(e=>{n[e]&&(n[e]=n[e].toString())}),["level","memberNum","memberUpdateTime","createTime","updateTime"].forEach(e=>{void 0!==n[e]&&(n[e]=parseInt(n[e]))}),["valid","validToCurrentUser","mute"].forEach(e=>{void 0!==n[e]&&(n[e]=1===parseInt(n[e]))}),Object.keys(t).forEach(e=>{void 0!==n[e]&&(n[e]=t[e][n[e]]||n[e])}),n}function zo(e){return e&&e.length>0?e.map(e=>Wo(e)):[]}function Ko(e){var t={};return void 0!==e.bitConfigMask&&(t.bits=parseInt(e.bitConfigMask)),["teamId","ext","account","nickInTeam"].forEach(n=>{e[n]&&(t[n]=e[n].toString())}),Object.prototype.hasOwnProperty.call(e,"nickInTeam")&&(t.nickInTeam=e.nickInTeam),t}function Yo(e){var t={type:xo},{bits:n}=e,r=be(e,["bits"]);return void 0!==n&&(r.muteTeam=1===parseInt(n),r.bitConfigMask=n),r.id=`${r.teamId}-${r.account}`,["teamId"].forEach(e=>{r[e]&&(r[e]=r[e].toString())}),["joinTime","updateTime","bitConfigMask"].forEach(e=>{void 0!==r[e]&&(r[e]=parseInt(r[e]))}),["active","valid","mute"].forEach(e=>{void 0!==r[e]&&(r[e]=1===parseInt(r[e]))}),Object.keys(t).forEach(e=>{void 0!==r[e]&&(r[e]=t[e][r[e]]||r[e])}),r}function Jo(e){return e&&e.length>0?e.map(e=>Yo(e)):[]}function Xo(e,t,n="normal"){return{id:`${e.teamId}-${t}`,teamId:e.teamId,account:t,type:n,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}}function Qo(e,t,n="normal"){return t&&t.length>0?t.map(t=>Xo(e,t,n)):[]}class Zo{constructor(e){this.core=e}notifyAddSuperTeamMembers(e,t){this.core.emit("addSuperTeamMembers",{team:e,accounts:t,members:Qo(e,t)})}notifyUpdateSuperTeamManagers(e,t,n,r){this.core.emit("updateSuperTeamManagers",{team:{teamId:e,memberUpdateTime:r},accounts:t,isManager:n,members:t.map(t=>({id:`${e}-${t}`,type:n?"manager":"normal",account:t,updateTime:r}))})}notifyRemoveSuperTeamMembers(e,t){this.core.emit("removeSuperTeamMembers",{team:e,accounts:t})}notifyTransferSuperTeam(e,t,n){this.core.emit("transferSuperTeam",{team:e,from:{id:`${e.teamId}-${t}`,account:t,type:"normal",updateTime:e.memberUpdateTime},to:{id:`${e.teamId}-${n}`,account:n,type:"owner",updateTime:e.memberUpdateTime}})}notifyUpdateSuperTeamMembersMute(e,t,n){this.core.emit("updateSuperTeamMembersMute",{team:e,accounts:t,members:t.map(function(t){return{id:`${e.teamId}-${t}`,account:t,teamId:e.teamId,mute:n,updateTime:e.memberUpdateTime}}),mute:n})}}var es={"21_5":"addSuperTeamMembers","21_6":"removeSuperTeamMembers","21_7":"leaveSuperTeam","21_8":"updateSuperTeamInfo","21_9":"getSuperTeamInfo","21_12":"getSuperTeams","21_15":"getSuperTeamMembers","21_10":"updateMySuperTeamMemberInfo","21_20":"applySuperTeam","21_21":"passSuperTeamApply","21_22":"rejectSuperTeamApply","21_23":"acceptSuperTeamInvite","21_24":"rejectSuperTeamInvite","21_26":"addSuperTeamManagers","21_27":"removeSuperTeamManagers","21_28":"muteSuperTeam","21_29":"muteSuperTeamMembers","21_30":"updateSuperTeamMemberNick","21_31":"transferSuperTeam","21_33":"getSuperTeamMembersByAccounts","21_34":"queryMuteSuperTeamMembers","21_101":"syncCreateSuperTeam","21_109":"syncSuperTeams","21_110":"syncUpdateSuperTeamMember","21_111":"syncMySuperTeamMembers"},ts={superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,updateTime:11,ext:12,mute:13,invitorAccid:14,joinTime:15}},ns=Ht(ts),rs={getSuperTeamInfo:{sid:21,cid:9,service:"superTeam",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"superTeam",reflectMapper:ns.superTeam}]},getSuperTeams:{sid:21,cid:12,service:"superTeam",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"superTeams",reflectMapper:ns.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},updateSuperTeamInfo:{sid:21,cid:8,service:"superTeam",params:[{type:"Property",name:"superTeam",reflectMapper:ts.superTeam}],response:[{type:"Long",name:"time"}]},addSuperTeamMembers:{sid:21,cid:5,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},removeSuperTeamMembers:{sid:21,cid:6,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},addSuperTeamManagers:{sid:21,cid:26,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:21,cid:27,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applySuperTeam:{sid:21,cid:20,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"superTeam",reflectMapper:ns.superTeam}]},transferSuperTeam:{sid:21,cid:31,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},muteSuperTeam:{sid:21,cid:28,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},muteSuperTeamMembers:{sid:21,cid:29,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"Int",name:"mute"}]},updateSuperTeamMemberNick:{sid:21,cid:30,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:ts.superTeamMember}]},updateMySuperTeamMemberInfo:{sid:21,cid:10,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:ts.superTeamMember}]},getSuperTeamMembersByAccounts:{sid:21,cid:33,service:"superTeam",params:[{type:"StrArray",name:"memberIds"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:ns.superTeamMember}]},getSuperTeamMembers:{sid:21,cid:15,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:ns.superTeamMember}]},queryMuteSuperTeamMembers:{sid:21,cid:34,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:ns.superTeamMember}]},leaveSuperTeam:{sid:21,cid:7,service:"superTeam",params:[{type:"Long",name:"teamId"}]},passSuperTeamApply:{sid:21,cid:21,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:21,cid:22,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:21,cid:23,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:21,cid:24,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncSuperTeams:{sid:21,cid:109,service:"superTeam",response:[{type:"PropertyArray",name:"teams",reflectMapper:ns.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},syncCreateSuperTeam:{sid:21,cid:101,service:"superTeam",response:[{type:"Property",name:"superTeam",reflectMapper:ns.superTeam}]},syncUpdateSuperTeamMember:{sid:21,cid:110,service:"superTeam",response:[{type:"Property",name:"teamMember",reflectMapper:ns.superTeamMember}]},syncMySuperTeamMembers:{sid:21,cid:111,ext:"sync",service:"superTeam",response:[{type:"PropertyArray",name:"teamMembers",reflectMapper:ns.superTeamMember},{type:"Long",name:"timetag"}]}},is={"13_1":"getChatroomAddress","24_1":"getQChatAddress"},os={getChatroomAddress:{sid:13,cid:1,service:"plugin",params:[{type:"Long",name:"chatroomId"},{type:"Bool",name:"isWeixinApp"},{type:"Int",name:"ipType"}],response:[{type:"StrArray",name:"address"}]},getQChatAddress:{sid:24,cid:1,service:"plugin",params:[{type:"Property",name:"getQChatAddressTag",reflectMapper:{ipType:1}}],response:[{type:"StrArray",name:"address"}]}},ss=ss||function(e){var t;"undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(t=globalThis.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==commonjsGlobal$1&&commonjsGlobal$1.crypto&&(t=commonjsGlobal$1.crypto);var n=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},o=i.lib={},s=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new a.init(t,e)}}),c=i.enc={},l=c.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(n,t/2)}},d=c.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(n,t)}},u=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},p=o.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,o=r.sigBytes,s=this.blockSize,c=o/(4*s),l=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*s,d=e.min(4*l,o);if(l){for(var u=0;u<l;u+=s)this._doProcessBlock(i,u);n=i.splice(0,l),r.sigBytes-=d}return new a.init(n,d)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=p.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=i.algo={};return i}(Math),as=ss.enc.Utf8,cs=ss,ls=cs.lib,ds=ls.Base,us=ls.WordArray,ps=cs.algo,hs=ps.MD5,gs=ps.EvpKDF=ds.extend({cfg:ds.extend({keySize:4,hasher:hs,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,r=this.cfg,i=r.hasher.create(),o=us.create(),s=o.words,a=r.keySize,c=r.iterations;s.length<a;){n&&i.update(n),n=i.update(e).finalize(t),i.reset();for(var l=1;l<c;l++)n=i.finalize(n),i.reset();o.concat(n)}return o.sigBytes=4*a,o}});cs.EvpKDF=function(e,t,n){return gs.create(n).compute(e,t)},ss.EvpKDF;var ms=ss,fs=ms.lib.WordArray;ms.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],o=0;o<n;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<n;a++)i.push(r.charAt(s>>>6*(3-a)&63));var c=r.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var i=0;i<n.length;i++)r[n.charCodeAt(i)]=i}var o=n.charAt(64);if(o){var s=e.indexOf(o);-1!==s&&(t=s)}return function(e,t,n){for(var r=[],i=0,o=0;o<t;o++)if(o%4){var s=n[e.charCodeAt(o-1)]<<o%4*2|n[e.charCodeAt(o)]>>>6-o%4*2;r[i>>>2]|=s<<24-i%4*8,i++}return fs.create(r,i)}(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},ss.enc.Base64,function(e){e.lib.Cipher||function(){var t=e,n=t.lib,r=n.Base,i=n.WordArray,o=n.BufferedBlockAlgorithm,s=t.enc;s.Utf8;var a=s.Base64,c=t.algo.EvpKDF,l=n.Cipher=o.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?y:f}return function(t){return{encrypt:function(n,r,i){return e(r).encrypt(t,n,r,i)},decrypt:function(n,r,i){return e(r).decrypt(t,n,r,i)}}}}()});n.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=t.mode={},u=n.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=d.CBC=function(){var e=u.extend();function t(e,t,n){var r,i=this._iv;i?(r=i,this._iv=void 0):r=this._prevBlock;for(var o=0;o<n;o++)e[t+o]^=r[o]}return e.Encryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize;t.call(this,e,n,i),r.encryptBlock(e,n),this._prevBlock=e.slice(n,n+i)}}),e.Decryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize,o=e.slice(n,n+i);r.decryptBlock(e,n),t.call(this,e,n,i),this._prevBlock=o}}),e}(),h=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,r=n-e.sigBytes%n,o=r<<24|r<<16|r<<8|r,s=[],a=0;a<r;a+=4)s.push(o);var c=i.create(s,r);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};n.BlockCipher=l.extend({cfg:l.cfg.extend({mode:p,padding:h}),reset:function(){var e;l.reset.call(this);var t=this.cfg,n=t.iv,r=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(r,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var g=n.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),m=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;return(n?i.create([1398893684,1701076831]).concat(n).concat(t):t).toString(a)},parse:function(e){var t,n=a.parse(e),r=n.words;return 1398893684==r[0]&&1701076831==r[1]&&(t=i.create(r.slice(2,4)),r.splice(0,4),n.sigBytes-=16),g.create({ciphertext:n,salt:t})}},f=n.SerializableCipher=r.extend({cfg:r.extend({format:m}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r),o=i.finalize(t),s=i.cfg;return g.create({ciphertext:o,key:n,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(t.kdf={}).OpenSSL={execute:function(e,t,n,r){r||(r=i.random(8));var o=c.create({keySize:t+n}).compute(e,r),s=i.create(o.words.slice(t),4*n);return o.sigBytes=4*t,g.create({key:o,iv:s,salt:r})}},y=n.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:v}),encrypt:function(e,t,n,r){var i=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize);r.iv=i.iv;var o=f.encrypt.call(this,e,t,i.key,r);return o.mixIn(i),o},decrypt:function(e,t,n,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var i=r.kdf.execute(n,e.keySize,e.ivSize,t.salt);return r.iv=i.iv,f.decrypt.call(this,e,t,i.key,r)}})}()}(ss);var vs=ss,ys=vs.lib.StreamCipher,_s=vs.algo,Is=_s.RC4=ys.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,r=this._S=[],i=0;i<256;i++)r[i]=i;i=0;for(var o=0;i<256;i++){var s=i%n,a=t[s>>>2]>>>24-s%4*8&255;o=(o+r[i]+a)%256;var c=r[i];r[i]=r[o],r[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=Ts.call(this)},keySize:8,ivSize:0});function Ts(){for(var e=this._S,t=this._i,n=this._j,r=0,i=0;i<4;i++){n=(n+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[n],e[n]=o,r|=e[(e[t]+e[n])%256]<<24-8*i}return this._i=t,this._j=n,r}vs.RC4=ys._createHelper(Is);var Ss=_s.RC4Drop=Is.extend({cfg:Is.cfg.extend({drop:192}),_doReset:function(){Is._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)Ts.call(this)}});vs.RC4Drop=ys._createHelper(Ss);var Es=ss.RC4,Ms={"3_1":"updatePushToken","3_2":"updateAppBackground"},bs={updatePushToken:{sid:3,cid:1,service:"user",params:[{type:"String",name:"tokenName"},{type:"String",name:"token"},{type:"Int",name:"pushkit"}]},updateAppBackground:{sid:3,cid:2,service:"user",params:[{type:"Bool",name:"isBackground"},{type:"Int",name:"badge"}]}},Cs={"7_19":"nimQueryCloudSessionList","7_20":"nimQueryCloudSession","7_21":"nimUpdateCloudSession","7_22":"nimDeleteCloudSessionList","7_121":"nimMultiSyncUpdateCloudSession"},As={sessionReqTag:{minTimestamp:1,maxTimestamp:2,includedLastMsg:3,limit:4,hasMore:5},sessionTag:{sessionId:1,updateTime:2,ext:3,lastMsg:4,lastMsgType:5}},Os=Ht(As),Rs={nimQueryCloudSessionList:{sid:7,cid:19,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:As.sessionReqTag}],response:[{type:"Property",name:"tag",reflectMapper:Os.sessionReqTag},{type:"PropertyArray",name:"sessions",reflectMapper:Os.sessionTag}]},nimQueryCloudSession:{sid:7,cid:20,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:As.sessionTag}],response:[{type:"Property",name:"session",reflectMapper:Os.sessionTag}]},nimUpdateCloudSession:{sid:7,cid:21,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:As.sessionTag}]},nimDeleteCloudSessionList:{sid:7,cid:22,service:"cloudSession",params:[{type:"PropertyArray",name:"tags",reflectMapper:As.sessionTag}]},nimMultiSyncUpdateCloudSession:{sid:7,cid:121,service:"cloudSession",response:[{type:"Property",name:"session",reflectMapper:Os.sessionTag}]}},Ns={sessionId:{type:"string"},updateTime:{type:"number"},ext:{type:"string"},lastMsg:{type:"object"},lastMsgType:{type:"number"}};function ws(e,t,n){var r=an(Ns,e),{accid:i,scene:o}=Fe(r.sessionId,"|");if(r.sessionId=`${o}-${i}`,r.lastMsg){var s=1===r.lastMsgType;r.lastMsgInfo=s?{isLastMsgRecalled:s,revokedMsg:Si(qt(r.lastMsg,Bi.sysMsg),n)}:{isLastMsgRecalled:s,lastMsg:ni(qt(r.lastMsg,yi.msg),{account:t})}}return delete r.lastMsg,delete r.lastMsgType,r}function Ps(e,t,n){return e&&e.length>0?e.map(e=>ws(e,t,n)):[]}var ks={needPush:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needPushBadge:{type:"boolean",required:!1}},Ls={"15_1":"signalingCreate","15_2":"signalingDelay","15_3":"signalingClose","15_4":"signalingJoin","15_5":"signalingLeave","15_6":"signalingInvite","15_7":"signalingCancelInvite","15_8":"signalingReject","15_9":"signalingAccept","15_10":"signalingSendCustomCommand","15_11":"signalingRecvNotification","15_12":"signalingMultiSyncNotification","15_13":"signalingSyncNotification","15_14":"singalingSyncChannels","15_15":"signalingQueryInfo","15_16":"signalingCallEx","15_17":"signalingJoinAndAccept"},xs={avSignalTag:Object.assign({type:1,name:2,channelId:3,createTime:4,expireTime:5,creatorAccid:6,ext:7,invalid:8,fromAccid:10,toAccid:11,requestId:12,members:18,attach:19,attachExt:20,needOffline:21,msgId:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},{needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needPushBadge:17})},Vs=Ht(xs),Ds={signalingCreate:{sid:15,cid:1,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Vs.avSignalTag}]},signalingDelay:{sid:15,cid:2,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Vs.avSignalTag}]},signalingClose:{sid:15,cid:3,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Vs.avSignalTag}]},signalingJoin:{sid:15,cid:4,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Vs.avSignalTag}]},signalingLeave:{sid:15,cid:5,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}]},signalingInvite:{sid:15,cid:6,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}]},signalingCancelInvite:{sid:15,cid:7,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}]},signalingReject:{sid:15,cid:8,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}]},signalingAccept:{sid:15,cid:9,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}]},signalingSendCustomCommand:{sid:15,cid:10,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}]},signalingRecvNotification:{sid:15,cid:11,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:Vs.avSignalTag}]},signalingMultiSyncNotification:{sid:15,cid:12,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:Vs.avSignalTag}]},signalingSyncNotification:{sid:15,cid:13,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:Vs.avSignalTag}]},singalingSyncChannels:{sid:15,cid:14,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:Vs.avSignalTag}]},signalingQueryInfo:{sid:15,cid:15,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Vs.avSignalTag}]},signalingCallEx:{sid:15,cid:16,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Vs.avSignalTag}]},signalingJoinAndAccept:{sid:15,cid:17,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:xs.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Vs.avSignalTag}]},signalingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:"signaling",params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},Us={type:{type:"number"},createTime:{type:"number"},expireTime:{type:"number"},invalid:{type:"boolean"},pushInfo:ks,pluginSetting:{nertcInfo:{nertcChannelName:{type:"string"},nertcTokenTtl:{type:"number"},nertcToken:{type:"string"},nertcJoinRoomQueryParamMap:{type:"string"},callStatus:{type:"number"}}},callStatus:{type:"number"},attach:{type:"object"},members:{type:"object"},needOffline:{type:"boolean"},uid:{type:"number"},time:{type:"number"}};function $s(e){return an(Us,qt(e,{1:"accid",2:"uid",3:"createTime",4:"expireTime"}))}function Bs(e){var t=an(Us,e),n=[];return t.members&&t.members.length>0&&(n=t.members.map(e=>$s(e)),delete t.members),n.length>0?{channelInfo:t,memberList:n}:{channelInfo:t}}function Fs(e){var t=an(Us,e),n=[];t.members&&t.members.length>0&&(n=t.members.map(e=>$s(e)),delete t.members);var r=200;return e.callStatus&&(r=Number(e.callStatus)),n.length>0?{channelInfo:t,memberList:n,callStatus:r}:{channelInfo:t,callStatus:r}}function js(e){return dn(Us,e)}class qs extends oe.EventEmitter{constructor(e){super(),this.timer=0,this.pollingInterval=12e4,this.name="signaling",this.logger=e.logger,this.core=e,this.channels={},Gt({cmdMap:Ls,cmdConfig:Ds})}callEx(e){var t;return Ce(this,void 0,void 0,function*(){Te({type:{type:"number"},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:ks},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},e);var n=yield this.core.sendCmd("signalingCallEx",{tag:js(e)}),r=Fs((null===(t=n.content)||void 0===t?void 0:t.data)||{});return this.channels[r.channelInfo.channelId]=Di(r.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(this.aotoDelay.bind(this),this.pollingInterval,-1)),r})}joinAndAccept(e){var t;return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},uid:{type:"number",required:!1},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},e);var{fromAccid:n}=e,r=be(e,["fromAccid"]);r.toAccid=n;var i=yield this.core.sendCmd("signalingJoinAndAccept",{tag:js(r)}),o=Fs((null===(t=i.content)||void 0===t?void 0:t.data)||{});return this.channels[o.channelInfo.channelId]=Di(o.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(this.aotoDelay.bind(this),this.pollingInterval,-1)),o})}create(e){var t;return Ce(this,void 0,void 0,function*(){Te({type:{type:"number"},ext:{type:"string",required:!1}},e);var n=yield this.core.sendCmd("signalingCreate",{tag:js(e)});return Bs((null===(t=n.content)||void 0===t?void 0:t.data)||{})})}close(e){return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),yield this.core.sendCmd("signalingClose",{tag:js(e)})})}queryInfo(e){var t;return Ce(this,void 0,void 0,function*(){Te({name:{type:"string",allowEmpty:!1}},e);var n=yield this.core.sendCmd("signalingQueryInfo",{tag:e});return Bs((null===(t=n.content)||void 0===t?void 0:t.data)||{})})}join(e){var t;return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},uid:{type:"number",min:0,required:!1},needOffline:{type:"boolean",required:!1}},e);var n=yield this.core.sendCmd("signalingJoin",{tag:js(e)}),r=Bs((null===(t=n.content)||void 0===t?void 0:t.data)||{});return this.channels[r.channelInfo.channelId]=Di(r.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(this.aotoDelay.bind(this),this.pollingInterval,-1)),r})}aotoDelay(){return Ce(this,void 0,void 0,function*(){var e=Object.keys(this.channels);if(0===e.length)return this.timer&&this.core.timerManager.deleteTimer(this.timer),void(this.timer=0);this.logger.log("signling:autoDelay",e);for(var t=0;t<e.length;t++){var n=e[t];try{var r=Bs((yield this.core.sendCmd("signalingDelay",{tag:{channelId:n}})).content.data);this.channels[n]=r.channelInfo}catch(i){this.logger.warn(`signling:autoDelay ${n} failed`,i),delete this.channels[n]}}})}leave(e){return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),yield this.core.sendCmd("signalingLeave",{tag:js(e)}),delete this.channels[e.channelId]})}invite(e){return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:ks}},e),yield this.core.sendCmd("signalingInvite",{tag:js(e)})})}cancelInvite(e){return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),yield this.core.sendCmd("signalingCancelInvite",{tag:js(e)})})}reject(e){return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e);var{fromAccid:t}=e,n=be(e,["fromAccid"]);n.toAccid=t,yield this.core.sendCmd("signalingReject",{tag:js(n)})})}accept(e){return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},autoJoin:{type:"boolean",required:!1},uid:{type:"number",min:0,required:!1},joinAttachExt:{type:"string",required:!1}},e);var{autoJoin:t,joinAttachExt:n,fromAccid:r}=e,i=be(e,["autoJoin","joinAttachExt","fromAccid"]);if(i.toAccid=r,yield this.core.sendCmd("signalingAccept",{tag:js(i)}),this.logger.log(`Signaling:accept, accept success, autoJoin ${e.autoJoin}`),t){var o={channelId:e.channelId,needOffline:e.needOffline,attachExt:n,uid:e.uid};yield this.join(o)}})}sendCustomCommand(e){return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},attachExt:{type:"string",required:!1}},e),yield this.core.sendCmd("signalingSendCustomCommand",{tag:js(e)})})}signalingRecvNotificationHandler(e){var t=Ke(e,e.content.data,"msgId","0"),n=t.msgId;this.doNotify(t),n&&parseInt(n)&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:[n]})}signalingMultiSyncNotificationHandler(e){this.doNotify(e.content.data,3)}doNotify(e,t=0){var{metaData:n,rawData:r}=function(e,t=0){var n=an(Us,e),{attach:r,attachExt:i,time:o,msgId:s,fromAccid:a,toAccid:c,members:l,requestId:d,pushInfo:u}=n,p=be(n,["attach","attachExt","time","msgId","fromAccid","toAccid","members","requestId","pushInfo"]);if(2===r.type)try{n.member={accid:n.attach.member[1],uid:Number(n.attach.member[2]),createTime:Number(n.attach.member[3]),expireTime:Number(n.attach.member[4])}}catch(g){delete n.member}var h=r.type;return delete n.attach,{metaData:{eventType:h,channelInfo:p,feature:t,ext:i||"",time:o,msgId:s},rawData:n}}(e,t),{fromAccid:i,toAccid:o,requestId:s,pushInfo:a,msgId:c,member:l}=r;switch(n.eventType){case 1:this.emit("signalingClose",{fromAccid:i,metaData:n});break;case 2:this.emit("signalingJoin",{fromAccid:i,metaData:n,member:l});break;case 3:this.emit("signalingInvite",{fromAccid:i,toAccid:o,requestId:s,pushInfo:a,metaData:n});break;case 4:this.emit("signalingCancelInvite",{fromAccid:i,toAccid:o,requestId:s,metaData:n});break;case 5:this.emit("signalingReject",{fromAccid:i,toAccid:o,requestId:s,metaData:n});break;case 6:this.emit("signalingAccept",{fromAccid:i,toAccid:o,requestId:s,metaData:n});break;case 7:this.emit("signalingLeave",{fromAccid:i,metaData:n});break;case 8:this.emit("signalingCustomCommand",{fromAccid:i,metaData:n});break;default:this.logger.warn(`signaling:notification, no such a type ${n.eventType}`,r)}return c}signalingSyncNotificationHandler(e){if(e.content.datas&&e.content.datas.length>0){var t=e.content.datas.map(e=>this.doNotify(e,1)).filter(e=>e);t.length>0&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:t})}}singalingSyncChannelsHandler(e){if(this.timer=0,this.channels={},e.content.datas&&e.content.datas.length>0){var t=e.content.datas.map(e=>Bs(e));t.forEach(e=>{var t=e.channelInfo.channelId;this.channels[t]=Di(e.channelInfo)}),this.emit("singalingSyncChannels",t)}}process(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e),Promise.resolve(e);var n=Ve(e,"error.detail.ignore");return e.error&&!n?Promise.reject(e.error):Promise.resolve(e)}}class Gs extends oe{constructor(e,t){super(),this.name=e,this.core=t,this.name=e,this.logger=t.logger,this.core=t}emit(e,...t){try{return super.emit(e,...t)}catch(n){return setTimeout(()=>{throw this.logger.error(`${this.name}::emit throw error in setTimeout. event: ${e.toString()}. Error`,n),n},0),!1}}process(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e);var n=Ve(e,"error.detail.ignore");return e.error&&!n?Promise.reject(e.error):Promise.resolve(e)}}var Hs,Ws,zs,Ks,Ys,Js,Xs,Qs={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage","24_95":"qchatChannelMemberSearch","25_8":"qchatGetRoleIdsByServerId","25_9":"qchatSubscribeAsVisitor","25_12":"qchatAutoSubscribe","25_13":"qchatAutoSubscribeNotification"},Zs={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},ea={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15,visitorMode:16},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:Zs,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12,visitorMode:16},serverRoles:{serverId:1,roleIds:2,timeTag:3},qchatChannelMemberSearchTag:{serverId:1,channelId:2,keyword:3,limit:4},qchatChannelMemberInfo:{serverId:1,channelId:2,avatar:3,accid:4,nick:5,createTime:6,updateTime:7}},ta=()=>Ht(ea),na=()=>{var e=ta();return{qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:ea.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:ea.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:ea.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:ea.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:e.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:ea.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:ea.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:ea.qchatUpdateWhiteBlackRoleTag}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:ea.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:ea.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:ea.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:ea.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:ea.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:ea.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:ea.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:e.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:ea.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:e.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:e.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:ea.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:ea.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:ea.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:ea.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:ea.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:ea.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:ea.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:ea.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:ea.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:ea.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:e.qchatChannelIdInfoTag}]},qchatAutoSubscribe:{sid:25,cid:12,service:"qchatChannel",hasPacketTimer:!1,params:[{type:"Property",name:"qchatAutoSubReqTag"}],response:[{type:"Property",name:"qchatAutoSubInfo",reflectMapper:{1:"time"}}]},qchatAutoSubscribeNotification:{service:"qchatChannel",sid:25,cid:13,response:[{type:"PropertyArray",name:"serverIds",reflectMapper:e.unreadInfo},{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:ea.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:ea.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatGetRoleIdsByServerId:{sid:25,cid:8,service:"qchatChannel",params:[{type:"Property",name:"qchatGetRoleIdsByServerIdTag",reflectMapper:{serverIdTimeTags:1}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRoles},{type:"String",name:"failServerIds"}]},qchatChannelMemberSearch:{sid:24,cid:95,service:"qchatChannel",params:[{type:"Property",name:"qchatChannelMemberSearchTag",reflectMapper:ea.qchatChannelMemberSearchTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.qchatChannelMemberInfo}]},qchatSubscribeAsVisitor:{sid:25,cid:9,service:"qchatChannel",params:[{type:"Property",name:"tag",reflectMapper:ea.qchatSubReqTag},{type:"PropertyArray",name:"datas",reflectMapper:ea.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"failedArr",reflectMapper:e.qchatChannelIdInfoTag}]}}};!function(e){e[e.reorderWeight=0]="reorderWeight",e[e.createTime=1]="createTime"}(Hs||(Hs={})),function(e){e[e.white=1]="white",e[e.black=2]="black"}(Ws||(Ws={})),function(e){e[e.add=1]="add",e[e.remove=2]="remove"}(zs||(zs={})),function(e){e[e.message=0]="message",e[e.media=1]="media",e[e.ext=100]="ext"}(Ks||(Ks={})),function(e){e[e.ASC=1]="ASC",e[e.DESC=2]="DESC"}(Ys||(Ys={})),function(e){e[e.reorderWeight=0]="reorderWeight",e[e.createTime=1]="createTime",e[e.totalMember=2]="totalMember"}(Js||(Js={})),function(e){e[e.square=1]="square",e[e.person=2]="person"}(Xs||(Xs={}));var ra={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:Ks},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},visitorMode:{type:"number"},reorderWeight:{type:"string"}},ia={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},oa={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Ws},opeType:{type:"enum",values:zs},toAccids:{type:"object"}},sa={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Ws},opeType:{type:"enum",values:zs},roleId:{type:"string"}},aa={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}},ca={serverId:{type:"string"},channelId:{type:"string"},accid:{type:"string"},avatar:{type:"string"},nick:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function la(e){return an(sa,e)}function da(e){return an(ra,e)}function ua(e){return Array.isArray(e)&&e.length>0?e.map(e=>da(e)):[]}function pa(e){return an(ia,e)}function ha(e){return Array.isArray(e)&&e.length>0?e.map(e=>pa(e)):[]}function ga(e){return an(aa,e)}function ma(e){return Array.isArray(e)&&e.length>0?e.map(e=>ga(e)):[]}function fa(e){return Array.isArray(e)&&e.length>0?e.map(e=>an(ca,e)):[]}function va(e){try{return JSON.parse(e)}catch(t){return[]}}var ya={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},categoryNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},_a={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},Ia={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function Ta(e){return an(ya,e)}function Sa(e){return Array.isArray(e)&&e.length>0?e.map(e=>Ta(e)):[]}function Ea(e){return an(_a,e)}function Ma(e){return Array.isArray(e)&&e.length>0?e.map(e=>Ea(e)):[]}function ba(e){return Array.isArray(e)&&e.length>0?e.map(e=>an(Ia,e)):[]}function Ca(e){var t,n,r;if(!e.antispamTag)return{};var i=Object.assign({},e.antispamTag);return(null===(t=e.antispamTag)||void 0===t?void 0:t.antiSpamBusinessId)&&"string"!=typeof(null===(n=e.antispamTag)||void 0===n?void 0:n.antiSpamBusinessId)&&(i.antiSpamBusinessId=JSON.stringify(null===(r=e.antispamTag)||void 0===r?void 0:r.antiSpamBusinessId)),i}var Aa={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function Oa(e){return an(Aa,e)}function Ra(e){return Array.isArray(e)&&e.length>0?e.map(e=>Oa(e)):[]}var Na,wa,Pa,ka,La={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function xa(e){return an(La,e)}!function(e){e[e.everyone=1]="everyone",e[e.custom=2]="custom"}(Na||(Na={})),function(e){e[e.normal=0]="normal",e[e.owner=1]="owner"}(wa||(wa={})),function(e){e[e.ignore=0]="ignore",e[e.deny=-1]="deny",e[e.allow=1]="allow"}(Pa||(Pa={})),function(e){e[e.manageServer=1]="manageServer",e[e.manageChannel=2]="manageChannel",e[e.manageRole=3]="manageRole",e[e.sendMsg=4]="sendMsg",e[e.accountInfoSelf=5]="accountInfoSelf",e[e.inviteServer=6]="inviteServer",e[e.kickServer=7]="kickServer",e[e.accountInfoOther=8]="accountInfoOther",e[e.recallMsg=9]="recallMsg",e[e.deleteMsg=10]="deleteMsg",e[e.remindOther=11]="remindOther",e[e.remindEveryone=12]="remindEveryone",e[e.manageBlackWhiteList=13]="manageBlackWhiteList",e[e.banServerMember=14]="banServerMember",e[e.RTCChannelConnect=15]="RTCChannelConnect",e[e.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",e[e.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",e[e.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",e[e.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",e[e.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",e[e.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",e[e.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",e[e.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",e[e.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",e[e.manageInviteApply=25]="manageInviteApply",e[e.manageInviteApplyHistory=26]="manageInviteApplyHistory",e[e.mentionedRole=27]="mentionedRole"}(ka||(ka={}));var Va,Da,Ua,$a,Ba,Fa,ja,qa,Ga={type:{type:"enum",values:Na},memberType:{type:"enum",values:wa},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},Ha={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:Na},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},Wa={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:wa},joinTime:{type:"number"},inviter:{type:"string"}};function za(e){var t,n,r=Object.assign({},e),i=dn(Ga,r);return i.auths&&(i.auths=(t=i.auths,n=Object.keys(t).reduce((e,n)=>{var r=ka[n];return r?e[r]=Pa[t[n]]:e[n]=Pa[t[n]],e},{}),JSON.stringify(n))),i}function Ka(e){return Object.keys(e).reduce((t,n)=>{var r=Be(ka,n);return r?t[r]=Pa[e[n]]:t[parseInt(n)]=Pa[e[n]],t},{})}function Ya(e){var t=an(Ga,e);return e.auths&&(t.auths=Ka(JSON.parse(t.auths))),t.isMember&&delete t.isMember,t}function Ja(e){return Array.isArray(e)&&e.length>0?e.map(e=>Ya(e)):[]}function Xa(e){return e.auths&&(e.auths=Ka(JSON.parse(e.auths))),an(Ha,e)}function Qa(e){return e.auths&&(e.auths=Ka(JSON.parse(e.auths))),an(Wa,e)}function Za(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}!function(e){e[e.default=1]="default",e[e.sync=2]="sync"}(Va||(Va={})),function(e){e[e.sendTime=1]="sendTime"}(Da||(Da={})),function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(Ua||(Ua={})),function(e){e[e.sending=1]="sending",e[e.success=2]="success",e[e.failed=3]="failed"}($a||($a={})),function(e){e[e.notifyAll=1]="notifyAll",e[e.notifySubscribe=2]="notifySubscribe"}(Ba||(Ba={})),function(e){e[e.unknown=0]="unknown",e[e.server=1]="server",e[e.channel=2]="channel",e[e.serverAccids=3]="serverAccids",e[e.channelAccids=4]="channelAccids",e[e.accids=5]="accids"}(Fa||(Fa={})),function(e){e[e.serverMemberInvite=1]="serverMemberInvite",e[e.serverMemberInviteReject=2]="serverMemberInviteReject",e[e.serverMemberApply=3]="serverMemberApply",e[e.serverMemberApplyReject=4]="serverMemberApplyReject",e[e.serverCreate=5]="serverCreate",e[e.serverRemove=6]="serverRemove",e[e.serverUpdate=7]="serverUpdate",e[e.serverMemberInviteDone=8]="serverMemberInviteDone",e[e.serverMemberInviteAccept=9]="serverMemberInviteAccept",e[e.serverMemberApplyDone=10]="serverMemberApplyDone",e[e.serverMemberApplyAccept=11]="serverMemberApplyAccept",e[e.serverMemberKick=12]="serverMemberKick",e[e.serverMemberLeave=13]="serverMemberLeave",e[e.serverMemberUpdate=14]="serverMemberUpdate",e[e.channelCreate=15]="channelCreate",e[e.channelRemove=16]="channelRemove",e[e.channelUpdate=17]="channelUpdate",e[e.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",e[e.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",e[e.updateQuickComment=20]="updateQuickComment",e[e.channelCategoryCreate=21]="channelCategoryCreate",e[e.channelCategoryRemove=22]="channelCategoryRemove",e[e.channelCategoryUpdate=23]="channelCategoryUpdate",e[e.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",e[e.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",e[e.serverIdentifyAdd=26]="serverIdentifyAdd",e[e.serverIdentifyRemove=27]="serverIdentifyRemove",e[e.serverIdentifyUpdate=28]="serverIdentifyUpdate",e[e.channelIdentifyUpdate=29]="channelIdentifyUpdate",e[e.userIdentifyUpdate=30]="userIdentifyUpdate",e[e.channelVisibilityUpdate=31]="channelVisibilityUpdate",e[e.serverEnterLeave=32]="serverEnterLeave",e[e.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",e[e.channelVisibilityToVisitorUpdate=34]="channelVisibilityToVisitorUpdate",e[e.myMemberInfoUpdated=35]="myMemberInfoUpdated",e[e.custom=100]="custom",e[e.msgTyping=101]="msgTyping"}(ja||(ja={})),function(e){e[e.reply=1]="reply",e[e.thread=2]="thread",e[e.all=3]="all"}(qa||(qa={}));var ec,tc=Math.max,nc=Math.min;function rc(e,t,n){var r,i,o,s,a,c,l=0,d=!1,u=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){var n=r,o=i;return r=i=void 0,l=t,s=e.apply(o,n)}function g(e){return l=e,a=setTimeout(f,t),d?h(e):s}function m(e){var n=e-c;return void 0===c||n>=t||n<0||u&&e-l>=o}function f(){var e,n,r=Date.now();if(m(r))return v(r);a=setTimeout(f,(n=t-((e=r)-c),u?nc(n,o-(e-l)):n))}function v(e){return a=void 0,p&&r?h(e):(r=i=void 0,s)}function y(){var e=Date.now(),n=m(e);if(r=arguments,i=this,c=e,n){if(void 0===a)return g(c);if(u)return clearTimeout(a),a=setTimeout(f,t),h(c)}return void 0===a&&(a=setTimeout(f,t)),s}return t=Number(t)||0,Za(n)&&(d=!!n.leading,o=(u="maxWait"in n)?tc(Number(n.maxWait)||0,t):o,p="trailing"in n?!!n.trailing:p),y.cancel=function(){void 0!==a&&clearTimeout(a),l=0,r=c=i=a=void 0},y.flush=function(){return void 0===a?s:v(Date.now())},y}function ic(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Za(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),rc(e,t,{leading:r,maxWait:t,trailing:i})}!function(e){e[e.sub=1]="sub",e[e.unSub=2]="unSub"}(ec||(ec={}));class oc{constructor(e){this.unreadCount={},this.manualSubscribeUnreadMap={},this.manualSubscribeServerMap={},this.manualSubscribeTypingMap={},this.unreadServerCount={},this.serverRoleIdsMap={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this._serverUnreadInfo=ic(e=>{this.core.emit("serverUnreadInfo",this.getServerUnreadInfo(e)),Ve(this.core,"qchatServer.emit")&&this.core.qchatServer.emit("serverUnreadInfo",this.getServerUnreadInfo(e))},100),this.core=e}changeCacheServerRoleIds(e){return Ce(this,void 0,void 0,function*(){var{serverId:t,roleId:n}=e.attach.serverIdentifyInfo;this.serverRoleIdsMap[t]||(yield this.getRoleIdsByServerId([t]));var r=this.serverRoleIdsMap[t];if(!(e.time<r.timeTag)){e.type===ja[ja.serverIdentifyAdd]?r.roleIds.add(n):r.roleIds.delete(n),this.core.logger.debug(`QChatChannel::qchatChannel/serverIdentifyChange::now ${t} roleIds is`,[...r.roleIds]);var i=this.unreadServerCount[t];i&&xi(Object.keys(i),100).forEach(e=>{this.core.qchatChannel.getChannelUnreadInfos({channels:e.map(e=>({serverId:t,channelId:e}))})})}})}getRoleIdsByServerId(e){return Ce(this,void 0,void 0,function*(){var t=e.filter(e=>!this.serverRoleIdsMap[e]);if(t.length){var n={serverIdTimeTags:t},r=yield this.core.sendCmd("qchatGetRoleIdsByServerId",{qchatGetRoleIdsByServerIdTag:n});this.core.logger.debug("QChatChannel:: getRoleIdsByServerId, params is ",n,"result is",r),r.content.serverRoles.forEach(e=>{try{e.roleIds=JSON.parse(e.roleIds)}catch(t){this.core.logger.error("QChatChannel:: getRoleIdsByServerId JSON parse roleIds error",t)}this.serverRoleIdsMap[e.serverId]={roleIds:new Set(e.roleIds),timeTag:e.timeTag}})}})}_unSubscribeChannel(e,t){return Ce(this,void 0,void 0,function*(){var n=`${e}_${t}`,r=[];if(this.manualSubscribeUnreadMap[n]?r.push(this.manualSubscribeUnreadMap[n]):this.autoSubscribeUnreadMap[n]&&r.push(this.autoSubscribeUnreadMap[n]),this.manualSubscribeTypingMap[n]&&r.push(this.manualSubscribeTypingMap[n]),0!==r.length){for(var i of r)this.subscribe({opeType:ec.unSub,type:i,channels:[{serverId:e,channelId:t}]});this.manualSubscribeUnreadMap[n]?this.manualSubscribeUnreadMap[n]=void 0:this.autoSubscribeUnreadMap[n]&&(this.autoSubscribeUnreadMap[n]=void 0),this.manualSubscribeTypingMap[n]&&(this.manualSubscribeTypingMap[n]=void 0)}})}_unSubscribeServer(e){return Ce(this,void 0,void 0,function*(){var t=e,n=this.manualSubscribeServerMap[t]||this.autoSubscribeServerMap[t];n&&(this.subscribe({opeType:ec.unSub,type:n,channels:[{serverId:e,channelId:""}]}),this.manualSubscribeServerMap[t]?this.manualSubscribeServerMap[t]=void 0:this.autoSubscribeServerMap[t]&&(this.autoSubscribeServerMap[t]=void 0))})}subscribe(e){return Ce(this,void 0,void 0,function*(){Te({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},e);var t=yield this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:e.type,opeType:e.opeType},channels:e.channels}),n=new Set;return e.channels.forEach(e=>Ce(this,void 0,void 0,function*(){this.serverRoleIdsMap[e.serverId]||n.add(e.serverId)})),xi(Array.from(n),10).forEach(e=>{this.getRoleIdsByServerId(e)}),t.content})}autoSubscribe(){return Ce(this,void 0,void 0,function*(){yield this.core.sendCmd("qchatAutoSubscribe",{qchatAutoSubReqTag:{}})})}resumeSubscribe(e){return Ce(this,void 0,void 0,function*(){if(this.serverRoleIdsMap={},!e)return this.unreadServerCount={},void(this.unreadCount={});var t={};Object.keys(this.manualSubscribeUnreadMap).forEach(e=>{var n=this.manualSubscribeUnreadMap[e];if(n){var[r,i]=e.split("_"),o={serverId:r,channelId:i};t[n]=t[n]||[],t[n].push(o)}}),t[5]=[],Object.keys(this.manualSubscribeTypingMap).forEach(e=>Ce(this,void 0,void 0,function*(){if(this.manualSubscribeTypingMap[e]){var[n,r]=e.split("_"),i={serverId:n,channelId:r};t[5].push(i)}})),t[4]=[],Object.keys(this.manualSubscribeServerMap).forEach(e=>Ce(this,void 0,void 0,function*(){if(this.manualSubscribeServerMap[e]){var n={serverId:e};t[4].push(n)}}));var n=[];Object.keys(t).forEach(e=>{var r=t[e];return r&&0===r.length?Promise.resolve():r.length>100?xi(r,100).forEach(t=>{n.push(this.createSubscribePromise(t,e))}):void n.push(this.createSubscribePromise(r,e))}),yield Promise.all(n)})}createSubscribePromise(e,t){var n={type:parseInt(t),opeType:1,channels:e};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",n),this.subscribe(n).then(({unreadInfos:e})=>{e&&e.length>0&&(e=ha(e),this.updateUnreads(e))}).catch(e=>{this.core.logger.error("qchatChannel:: autoSubscribeUnread error ",e)})}cacheSubscribe(e){e.channels.forEach(t=>{var n=t.channelId?`${t.serverId}_${t.channelId}`:`${t.serverId}`,r=5===e.type?this.manualSubscribeTypingMap:4===e.type?this.manualSubscribeServerMap:this.manualSubscribeUnreadMap;e.opeType===ec.sub?r[n]=e.type:e.opeType===ec.unSub&&(r[n]=void 0)})}cacheAutoSubscribe(e){e.channels.forEach(t=>{var n=t.channelId?`${t.serverId}_${t.channelId}`:`${t.serverId}`,r=4===e.type?this.autoSubscribeServerMap:this.autoSubscribeUnreadMap;e.opeType===ec.sub?r[n]=e.type:e.opeType===ec.unSub&&(r[n]=void 0)})}cacheUnreadCount(e){e.forEach(e=>{var t=`${e.serverId}_${e.channelId}`;this.unreadCount[t]=Object.assign({},e),this.unreadServerCount[e.serverId]||(this.unreadServerCount[e.serverId]={}),this.unreadServerCount[e.serverId][e.channelId]=!0})}getServerUnreadInfo(e){var t={serverId:e,unreadCount:0,mentionedCount:0,maxCount:0},n=this.unreadServerCount[e];return n&&(Object.keys(n).forEach(n=>{var r=`${e}_${n}`,i=this.unreadCount[r];t.unreadCount+=i.unreadCount,t.mentionedCount+=i.mentionedCount,void 0!==i.maxCount&&(t.maxCount=i.maxCount)}),t.unreadCount=t.unreadCount>t.maxCount?t.maxCount:t.unreadCount,t.mentionedCount=t.mentionedCount>t.maxCount?t.maxCount:t.mentionedCount),t}getUnreadInfo(e){Te({serverId:{type:"string"},channelId:{type:"string"}},e);var t=`${e.serverId}_${e.channelId}`;return this.unreadCount[t]?this.unreadCount[t]:null}shouldChangeUnread(e,t){if(!e.serverId||!e.channelId)return!1;if(this.core.qchatChannel.subscribeForVisitorService.isInSubscribeChannels(e.serverId,e.channelId))return!1;if(!1===e.historyEnable)return!1;if(!1===e.needBadge)return!1;if(e.fromAccount===this.core.account)return!1;if(t&&2!==(null==e?void 0:e.status))return!1;if(e.notifyReason&&e.notifyReason===Be(Ba,Ba.notifySubscribe)){if(!e.serverId||!e.channelId)return!1;var n=this.getUnreadInfo({serverId:e.serverId,channelId:e.channelId}),r=t?"ackTimestamp":"lastMsgTime";if(!n)return!1;if(e.time&&n[r]&&n[r]>e.time)return!1}return!0}shouldChangeMentionedUnread(e,t=!1){return Ce(this,void 0,void 0,function*(){if(e.accidsOfMentionedRoles&&e.accidsOfMentionedRoles.includes(this.core.account))return!0;if(e.mentionRoleIds&&e.serverId){if(!this.serverRoleIdsMap[e.serverId]){if(!t)return this.handledRoleMsg(e),!1;yield this.getRoleIdsByServerId([e.serverId])}for(var n=0;n<e.mentionRoleIds.length;n++)if(this.serverRoleIdsMap[e.serverId].roleIds.has(e.mentionRoleIds[n]))return!0}return!1})}handledRoleMsg(e){return Ce(this,void 0,void 0,function*(){if(e.mentionRoleIds)if(this.serverRoleIdsMap[e.serverId]||(yield this.getRoleIdsByServerId([e.serverId])),this.serverRoleIdsMap[e.serverId]){var t=!1;if(e.mentionRoleIds.forEach(n=>{this.serverRoleIdsMap[e.serverId].roleIds.has(n)&&(t=!0,this.core.logger.debug("QChatChannel::handledRoleMsg::will update message mentionedCount，message is ",e))}),t){var n=this.unreadCount[`${e.serverId}_${e.channelId}`],r=2===(null==e?void 0:e.status);if(n.mentionedCount=r?n.mentionedCount?n.mentionedCount-1:0:n.mentionedCount?n.mentionedCount+1:1,"number"==typeof n.maxCount){var i=n.mentionedCount;if((i=i>n.maxCount?n.maxCount:i)>n.maxCount)return void this.core.logger.debug("QChatChannel::handledRoleMsg::tempUnreadCount more than maxCount");this.core.emit("unreadInfo",Object.assign(Object.assign({},n),{mentionedCount:i})),this.core.emit("unreadInfos",[Object.assign(Object.assign({},n),{mentionedCount:i})]),this.core.qchatChannel.emit("unreadInfos",[Object.assign(Object.assign({},n),{mentionedCount:i})]),this._serverUnreadInfo(e.serverId)}}}else this.core.logger.warn("QChatChannel::handledRoleMsg::can not get serverRoleIds,server id",e.serverId)})}getMentionedFlag(e,t=!1){return Ce(this,void 0,void 0,function*(){return!!e.mentionAll||(e.mentionRoleIds||e.accidsOfMentionedRoles?yield this.shouldChangeMentionedUnread(e,t):!(!e.mentionAccids||!e.mentionAccids.includes(this.core.account)))})}changeUnread(e,t){return Ce(this,void 0,void 0,function*(){var n=e.serverId,r=e.channelId,i=`${n}_${r}`;if(this.shouldChangeUnread(e,t)){if(!this.unreadCount[i])return yield this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:n,channelId:r}]}),void(!this.serverRoleIdsMap[n]&&e.mentionRoleIds&&this.getRoleIdsByServerId([n]));var o=this.unreadCount[i],s=2===(null==e?void 0:e.status),a=yield this.getMentionedFlag(e);s?(o.unreadCount=o.unreadCount?o.unreadCount-1:0,a&&(o.mentionedCount=o.mentionedCount?o.mentionedCount-1:0),delete o.lastMsgTime,this.core.logger.debug(`changeUnread: ${i} unread reduce `,o)):(o.unreadCount=o.unreadCount?o.unreadCount+1:1,a&&(o.mentionedCount=o.mentionedCount?o.mentionedCount+1:1),e.time&&(o.lastMsgTime=e.time),this.core.logger.debug(`changeUnread: ${i} unread add `,o));var c="number"==typeof o.maxCount?o.maxCount:100;o.unreadCount>c?this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"):(this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",Object.assign(Object.assign({},o),{mentionedCount:o.mentionedCount>c?c:o.mentionedCount,unreadCount:o.unreadCount>c?c:o.unreadCount})),this.core.emit("unreadInfos",[Object.assign(Object.assign({},o),{mentionedCount:o.mentionedCount>c?c:o.mentionedCount,unreadCount:o.unreadCount>c?c:o.unreadCount})]),this.core.qchatChannel.emit("unreadInfos",[Object.assign(Object.assign({},o),{mentionedCount:o.mentionedCount>c?c:o.mentionedCount,unreadCount:o.unreadCount>c?c:o.unreadCount})]),this._serverUnreadInfo(n))}else this.core.logger.debug(`changeUnread: ${i} does not need to update unreadInfo`)})}updateUnreads(e){if(e&&e.length>0){var t=[],n=[],r=e.filter(e=>{var t=`${e.serverId}_${e.channelId}`,n=this.unreadCount[t],r=Ve(n,"ackTimestamp"),i=Ve(e,"ackTimestamp");return!(r&&i&&i<r||Ve(n,"unreadCount")===Ve(e,"unreadCount")&&Ve(n,"mentionedCount")===Ve(e,"mentionedCount"))}).map(e=>{t.push(this.getServerUnreadInfo(e.serverId)),n.push(this.unreadServerCount[e.serverId]);var r=e.serverId,i=e.channelId,o=`${r}_${i}`;return this.core.logger.debug("qchat channel updateUnread: ",e),this.unreadCount[o]=Object.assign({},e),this.unreadServerCount[r]||(this.unreadServerCount[r]={}),this.unreadServerCount[r][i]=!0,e});if(0!==r.length){this.core.emit("unreadInfos",r),this.core.qchatChannel.emit("unreadInfos",r);var i={};r.forEach((e,r)=>{this.core.emit("unreadInfo",e);var o=t[r],s=n[r],a=this.getServerUnreadInfo(e.serverId),c=this.unreadServerCount[e.serverId],l=o.unreadCount!==a.unreadCount,d=!s||0===Object.keys(s).length,u=c&&Object.keys(c).length>0,p=o.mentionedCount!==a.mentionedCount;(l||p||d&&u)&&(i[e.serverId]=!0)}),Object.keys(i).forEach(e=>{this.core.emit("serverUnreadInfo",this.getServerUnreadInfo(e)),Ve(this.core,"qchatServer.emit")&&this.core.qchatServer.emit("serverUnreadInfo",this.getServerUnreadInfo(e))})}}}clearUnreadCountByServers(e,t){var n=[];e.forEach(e=>{this.unreadServerCount[e]&&Object.keys(this.unreadServerCount[e]).forEach(t=>{n.push(`${e}_${t}`)})});var r=[];n.forEach(e=>{r.push(Object.assign(Object.assign({},this.unreadCount[e]),{unreadCount:0,mentionedCount:0,ackTimestamp:t}))}),this.updateUnreads(r)}}class sc{constructor(e){this.limitForBatchEnter=10,this.limitForBatchSubscribe=100,this.autoServers=new Set,this.autoVisitorSubscribeServer=new Set,this.autoVisitorSubscribeChannel=new Set,this.core=e}subscribeChannelAsVisitor(e){return Ce(this,void 0,void 0,function*(){var t=(yield this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:e.type||6,opeType:e.opeType},datas:e.channels})).content.failedArr;return e.channels.filter(e=>!t.some(t=>t.channelId===e.channelId&&t.serverId===e.serverId)).forEach(t=>{1===e.opeType?this.autoVisitorSubscribeChannel.add(`${t.serverId}&${t.channelId}`):this.autoVisitorSubscribeChannel.delete(`${t.serverId}&${t.channelId}`)}),{failedChannels:t}})}subscribeServerAsVisitor(e){return Ce(this,void 0,void 0,function*(){var t=yield this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:e.type||7,opeType:e.opeType},datas:e.serverIds.map(e=>({serverId:e}))}),n=t.content.failedArr;return e.serverIds.filter(e=>!n.some(t=>t.serverId===e)).forEach(t=>{1===e.opeType?this.autoVisitorSubscribeServer.add(t):this.autoVisitorSubscribeServer.delete(t)}),{failedServers:t.content.failedArr.map(e=>e.serverId)}})}deleteServer(e){this.autoServers.delete(e),this.autoVisitorSubscribeServer.has(e)&&this.subscribeServerAsVisitor({opeType:2,serverIds:[e]});var t=[];this.autoVisitorSubscribeChannel.forEach(n=>{if(0===n.indexOf(e)){var r=n.replace(`${e}&`,"");t.push({serverId:e,channelId:r})}}),t.length>0&&this.subscribeChannelAsVisitor({opeType:2,channels:t})}deleteAutoSetInServerId(e){this.autoServers.delete(e),this.autoVisitorSubscribeServer.delete(e),this.autoVisitorSubscribeChannel.forEach(t=>{0===t.indexOf(e)&&this.autoVisitorSubscribeChannel.delete(t)})}deleteAutoSetInChannel(e,t){this.autoVisitorSubscribeChannel.delete(`${e}&${t}`)}unSubscribeChannel(e,t){this.subscribeChannelAsVisitor({opeType:2,channels:[{serverId:e,channelId:t}]})}isInSubscribeChannels(e,t){return this.autoVisitorSubscribeChannel.has(`${e}&${t}`)}isInAutoServers(e){return this.autoServers.has(e)}doAutoSubscribe(){var e=[];return xi(Array.from(this.autoVisitorSubscribeServer),this.limitForBatchSubscribe).forEach(t=>{e.push(this.subscribeServerAsVisitor({opeType:1,serverIds:t}))}),xi(Array.from(this.autoVisitorSubscribeChannel),this.limitForBatchSubscribe).forEach(t=>{e.push(this.subscribeChannelAsVisitor({opeType:1,channels:t.map(e=>{var t=e.indexOf("&");return{serverId:e.slice(0,t),channelId:e.slice(t+1)}})}))}),Promise.all(e)}doAutoEnterServer(){return Ce(this,void 0,void 0,function*(){var e=xi(Array.from(this.autoServers),this.limitForBatchEnter),t=[];e.forEach(e=>{t.push(this.core.qchatServer.enterAsVisitor({serverIds:e}))}),(yield Promise.all(t)).forEach(e=>{e.failedServers.forEach(e=>{this.deleteAutoSetInServerId(e)})})})}resumeSubscribe(e){return Ce(this,void 0,void 0,function*(){e?(yield this.doAutoEnterServer(),yield this.doAutoSubscribe()):(this.autoServers.clear(),this.autoVisitorSubscribeChannel.clear(),this.autoVisitorSubscribeServer.clear())})}cacheServer(e){e.forEach(e=>this.autoServers.add(e))}}var ac={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},cc={limit:{type:"number"}};function lc(e){return Array.isArray(e)&&e.length>0?e.map(e=>an(ac,e)):[]}var dc,uc={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},pc={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},hc=()=>{var e=Ht(pc);return{qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:pc.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:e.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:pc.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:pc.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:e.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:pc.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:e.memberInfo}]}}},gc={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","24_127":"qchatGetMentionedMeMessages","25_6":"qchatMultiSyncServersMessageRead"},mc={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,mentionRoleIds:41,accidsOfMentionedRoles:42,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},qchatPageQueryTag:{hasMore:1,nextTimetag:2,cursor:3},unreadInfo:Zs},fc=()=>Ht(mc),vc=()=>{var e=fc();return{qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:mc.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:mc.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:mc.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:mc.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:mc.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:e.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:mc.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:e.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:e.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:mc.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:mc.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:e.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:e.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:mc.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:mc.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:e.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:e.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:mc.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:mc.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:e.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:mc.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:mc.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:mc.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:e.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:e.qchatMultiSyncServersMessageReadTag}]},qchatGetMentionedMeMessages:{service:"qchatMsg",sid:24,cid:127,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2,timestamp:3,limit:4}}],response:[{type:"Property",name:"page",reflectMapper:e.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:e.qchatMsgTag}]}}};!function(e){e[e.Android=1]="Android",e[e.iOS=2]="iOS",e[e.PC=4]="PC",e[e.WindowsPhone=8]="WindowsPhone",e[e.Web=16]="Web",e[e.Server=32]="Server",e[e.Mac=64]="Mac",e[e.HarmonyOS=65]="HarmonyOS"}(dc||(dc={}));var yc={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers","25_10":"qchatEnterAsVisitor","25_11":"qchatLeaveAsVisitor"},_c={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,categoryNumber:14,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:Zs},Ic=()=>Ht(_c),Tc=()=>{var e=Ic();return{qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:_c.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:_c.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:e.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:_c.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:_c.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:e.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:e.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:_c.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:e.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:_c.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:_c.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:e.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:_c.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:_c.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:_c.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:_c.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:e.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:_c.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:_c.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:e.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:e.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:_c.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:_c.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:_c.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:_c.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:_c.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.memberInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:e.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:e.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:e.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"Int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo},{type:"String",name:"failServerIds"}]},qchatEnterAsVisitor:{sid:25,cid:10,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]},qchatLeaveAsVisitor:{sid:25,cid:11,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]}}},Sc={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},Ec={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},Mc=()=>Ht(Ec),bc=()=>{var e=Mc();return{qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:Ec.serverRole},{type:"Property",name:"antispamTag",reflectMapper:Ec.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:e.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:Ec.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:e.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:Ec.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:e.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:e.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:e.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:Ec.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:e.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:Ec.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:e.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:e.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:e.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:e.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:Ec.checkPermissionTag}],response:[{type:"Bool",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:Ec.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:e.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:Ec.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:e.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:Ec.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:e.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:Ec.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:e.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:Ec.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:e.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:Ec.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:e.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:Ec.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}}},Cc=["image","audio","video","file"],Ac={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:ja},fromClientType:{type:"enum",values:dc},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function Oc(e,t){var n=Object.assign({},e),r=Object.assign({type:t||ja.custom},dn(Ac,n));return r.serverId&&r.channelId&&r.toAccids?r.toType=4:r.serverId&&r.toAccids?r.toType=3:r.serverId&&r.channelId?r.toType=2:r.serverId?r.toType=1:r.toAccids?r.toType=5:r.toType=0,r}var Rc={[ja.channelUpdateWhiteBlackIdentify]:function(e){var t=ta();return e.notify=la(qt(e.notify,t.qchatUpdateWhiteBlackRoleTag)),e},[ja.channelUpdateWhiteBlackIdentifyUser]:function(e){var t,n=ta();return e.notify=(t=qt(e.notify,n.qchatUpdateWhiteBlackMembersTag),an(oa,t)),e},[ja.updateQuickComment]:function(e){var t,n=fc();return e.notify=(t=qt(e.notify,n.qchatQuickCommentRequestTag),an(Dc,t)),e},[ja.channelCategoryCreate]:function(e){var t=ta();return e.categoryInfo=ga(qt(e.categoryInfo,t.QChatChannelCategoryInfo)),e},[ja.channelCategoryUpdate]:function(e){var t=ta();return e.categoryInfo=ga(qt(e.categoryInfo,t.QChatChannelCategoryInfo)),e},[ja.channelCategoryUpdateWhiteBlackIdentify]:function(e){var t=ta();return e.notify=la(qt(e.notify,t.qchatUpdateChannelCategoryWhiteBlackRoleTag)),e},[ja.channelCategoryUpdateWhiteBlackIdentifyUser]:function(e){var t=ta();return e.notify=la(qt(e.notify,t.qchatUpdateChannelCategoryWhiteBlackMembersTag)),e},[ja.serverIdentifyAdd]:function(e){var t=Mc();return e.serverIdentifyInfo=Ya(qt(e.serverIdentifyInfo,t.serverRole)),e},[ja.serverIdentifyRemove]:function(e){var t=Mc();return e.serverIdentifyInfo=Ya(qt(e.serverIdentifyInfo,t.serverRole)),e},[ja.serverIdentifyUpdate]:function(e){var t=Mc();return e.serverIdentifyInfo=Ya(qt(e.serverIdentifyInfo,t.serverRole)),e},[ja.channelIdentifyUpdate]:function(e){var t=Mc();return e.channelIdentifyInfo=Ya(qt(e.channelIdentifyInfo,t.channelRole)),e},[ja.userIdentifyUpdate]:function(e){var t=Mc();return e.userIdentifyInfo=Ya(qt(e.userIdentifyInfo,t.memberRole)),e},[ja.myMemberInfoUpdated]:function(e){var t=Ve(e,"userInfo.name"),n=Ve(e,"userInfo.icon");return e.updatedInfos=e.reuseServers.map(e=>{var r={serverId:e.serverId};return!(1&~e.bits)&&"string"==typeof t&&Object.assign(r,{nickChanged:!0,nick:t}),!(2&~e.bits)&&"string"==typeof n&&Object.assign(r,{avatarChanged:!0,avatar:n}),r}),delete e.userInfo,delete e.reuseServers,e}};function Nc(e,t){var n=an(Ac,e);if(!n.attach)return n;var r=Ic(),i=ta();if(n.attach.serverInfo&&(n.attach.serverInfo=Ta(qt(n.attach.serverInfo,r.serverInfo))),n.attach.channelInfo&&(n.attach.channelInfo=da(qt(n.attach.channelInfo,i.channelInfo))),n.attach.serverMember&&(n.attach.serverMember=Ea(qt(n.attach.serverMember,r.memberInfo))),Rc[n.attach.type]&&(n.attach=Rc[n.attach.type](n.attach)),n.attach.updateAuths)try{n.attach.updateAuths=Ka(JSON.parse(n.attach.updateAuths))}catch(o){t.error("formatSystemNotification:JSON parse updateAuths error: ",o)}return n.attach.type&&(n.attach.rawType=n.attach.type,n.attach.type=ja[n.attach.type]),n}var wc={type:{type:"enum",values:Ua},fromClientType:{type:"enum",values:dc},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:Ba},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},mentionRoleIds:{type:"object"},accidsOfMentionedRoles:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function Pc(e){var t=be(e,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),n=dn(wc,t);if(n.msgIdClient=e.resendFlag?e.msgIdClient:Ue(),!n.msgIdClient)throw new me("msgIdClient is required for resend a message","msgIdClient","required");return e.replyMessage&&e.replyMessage.msgIdServer&&(n.replyMsgFromAccount=e.replyMessage.fromAccount,n.replyMsgTime=+e.replyMessage.time,n.replyMsgIdServer=e.replyMessage.msgIdServer,n.replyMsgIdClient=e.replyMessage.msgIdClient,e.replyMessage.threadRefer&&e.replyMessage.threadRefer.msgIdServer?(n.threadMsgFromAccount=e.replyMessage.threadRefer.fromAccount,n.threadMsgTime=+e.replyMessage.threadRefer.time,n.threadMsgIdServer=e.replyMessage.threadRefer.msgIdServer,n.threadMsgIdClient=e.replyMessage.threadRefer.msgIdClient):(n.threadMsgFromAccount=e.replyMessage.fromAccount,n.threadMsgTime=+e.replyMessage.time,n.threadMsgIdServer=e.replyMessage.msgIdServer,n.threadMsgIdClient=e.replyMessage.msgIdClient),delete n.replyMessage),n}function kc(e){return an({operatorClientType:{type:"enum",values:dc},pushPayload:{type:"object"}},e)}function Lc(e,t={},n){var r,i;return Ce(this,void 0,void 0,function*(){var o=an(wc,e);o.deliveryStatus=t.deliveryStatus?$a[t.deliveryStatus]:$a[$a.success],t.time&&(o.time=t.time);var s=fc();if(o.updateContent){var a=JSON.parse(o.updateContent);a=an({status:{type:"number"}},a=qt(a,s.qchatMsgTag)),o.updateContent=a}if(o.updateOperatorInfo){var c=JSON.parse(o.updateOperatorInfo);c=kc(qt(c,s.qchatMsgUpdateTag)),o.updateOperatorInfo=c}return""===(null===(r=null==o?void 0:o.threadRefer)||void 0===r?void 0:r.fromAccount)&&delete o.threadRefer,""===(null===(i=null==o?void 0:o.replyRefer)||void 0===i?void 0:i.fromAccount)&&delete o.replyRefer,o.attach&&t.attachUrl&&(o.attach.url=t.attachUrl),yield function(e,t){return Ce(this,void 0,void 0,function*(){if(!(Cc.includes(e.type)&&e.attach&&e.attach.url))return e;if(!t||!t.cloudStorage||"function"!=typeof t.cloudStorage.getPrivateUrl||"function"!=typeof t.cloudStorage.getOriginUrl)return e;if(e.attach.url.indexOf("_im_url=1")<0)return e.attach.url=t.cloudStorage.getPrivateUrl(e.attach.url),e;try{e.attach.url=yield t.cloudStorage.getOriginUrl(e.attach.url)}catch(n){throw new me(`url "${e.attach.url}" parse error`,"message.attach.url","parse error")}return e})}(o,n)})}function xc(e,t={},n){return Ce(this,void 0,void 0,function*(){if(!(Array.isArray(e)&&e.length>0))return[];var r=e.map(e=>Lc(e,t,n));return yield Promise.all(r)})}var Vc={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}},Dc={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}},Uc={includeSelf:{type:"number"},order:{type:"enum",values:Ys},sort:{type:"enum",values:Da},msgTypes:{type:"object"},subTypes:{type:"object"}},$c={hasMore:{type:"boolean"},nextTimetag:{type:"number"},cursor:{type:"string"}},Bc={6:function(e){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInServerId(e.serverId),!0},16:function(e){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInChannel(e.serverId,e.channelId),!0},26:function(e){var t=Ve(e,"attach.addAccids");return t&&t.includes(this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",e),!0},27:function(e){var t=Ve(e,"attach.deleteAccids");return t&&t.includes(this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",e),!0},31:function(e){var t,n;return 1===e.attach.event?(null===(n=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===n?void 0:n.autoSubscribe)&&this.core.qchatChannel.subscribeChannel({type:1,opeType:1,channels:[{serverId:e.serverId,channelId:e.channelId}],isInternalTrigger:!0}):2===e.attach.event&&(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",e),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",e)),!0},32:function(e){var t,n;return 2===e.attach.event?(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",e),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",e)):1===e.attach.event&&(this.core.qchatChannel.subscribeForVisitorService.deleteServer(e.serverId),(null===(n=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===n?void 0:n.autoSubscribe)&&this.core.qchatServer.subscribeServer({type:4,opeType:1,servers:[{serverId:e.serverId}],isInternalTrigger:!0})),!0},34:function(e){return 2===e.attach.event&&this.core.qchatChannel.subscribeForVisitorService.unSubscribeChannel(e.serverId,e.channelId),!0},101:function(e){var t=hr(e,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",t),this.core.emit("recvTypingEvent",t),this.core.qchatMsg.emit("recvTypingEvent",t),!1}};class Fc{constructor(e){this.core=e,this.logger=e.logger}sendSystemNotification(e){return Ce(this,void 0,void 0,function*(){var t=Nc((yield this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:Oc(e)})).content.sysMsg,this.logger);return this.logger.getDebugMode()?this.logger.debug("sendCustomSysMsg success",t):this.logger.log("sendCustomSysMsg success",t.serverId,t.channelId,t.msgIdServer),t})}updateSystemNotification(e){return Ce(this,void 0,void 0,function*(){var{systemNotification:t}=e,n=be(e,["systemNotification"]),r=Oc(hr(t,["msgIdServer","type","body","ext","status"]));return Nc((yield this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:r,qchatMsgUpdateTag:Object.assign(Object.assign({},n),{operatorAccount:this.core.account,operatorClientType:dc.Web,pushPayload:JSON.stringify(e.pushPayload),routeEnable:hn.boolean(e,"routeEnable")})})).content.sysMsg,this.logger)})}markSystemNotificationsRead(e){return Ce(this,void 0,void 0,function*(){yield this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:e.systemNotifications.map(e=>{return t=hr(e,["msgIdServer","type"]),dn(Ac,t);var t})})})}onSysMsg(e){var t=e.content.sysMsg;if(t){var n=Nc(t,this.core.logger),r=Bc[ja[n.type]];if(r&&!1===r.call(this,n))return;var i={feature:"default",systemNotifications:[n]};this.logger.log("qchat on systemNotification: ",i),this.core.emit("systemNotification",i),this.core.qchatMsg.emit("systemNotification",i)}else this.core.logger.warn("No sysMsg in onSysMsg packet")}onMultiSysMsg(e){var t=e.content.sysMsg;if(t){var n=Nc(t,this.logger);this.core.emit("systemNotificationUpdate",n),this.core.qchatMsg.emit("systemNotificationUpdate",n)}}onSyncSysMsg(e){var t=e.content.systemNotifications;if(t&&t.length>0){var n=t.map(e=>Nc(e,this.logger));this.core.emit("systemNotification",{feature:"sync",systemNotifications:n}),this.core.qchatMsg.emit("systemNotification",{feature:"sync",systemNotifications:n})}else this.logger.warn("sync system notification not exist")}}var jc=["image","audio","video","file"];class qc{constructor(e){this.markMessageRead=ic(e=>Ce(this,void 0,void 0,function*(){var t=pa((yield this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:e})).content.unreadInfo);this.core.eventBus.emit("qchatChannel/updateUnreads",[t])}),200),this.core=e,this.logger=e.logger}sendMessage(e){var t,n,r,i;return Ce(this,void 0,void 0,function*(){jc.indexOf(e.type)>-1&&(e.attach=yield this.doSendFile(e));var o,s=Pc(Object.assign({fromAccount:this.core.account},e)),a=yield Lc(s,{time:(new Date).getTime(),deliveryStatus:$a.sending},this.core);try{e.onSendBefore&&e.onSendBefore(a)}catch(u){this.logger.error("sendMsg: options.onSendBefore error",u)}try{o=yield this.core.sendCmd("qchatSendMsg",{qchatMsg:s})}catch(u){var c=yield Lc(s,{time:(new Date).getTime(),deliveryStatus:$a.failed,attachUrl:null===(t=a.attach)||void 0===t?void 0:t.url},this.core);throw u.msg=c,u}var{content:l}=o,d=yield Lc(Object.assign({},l.qchatMsg),{deliveryStatus:$a.success,attachUrl:null===(n=a.attach)||void 0===n?void 0:n.url},this.core);if(d.isAntispam)throw{code:10403,msg:d,message:(null===(r=null==d?void 0:d.antiSpamInfo)||void 0===r?void 0:r.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(i=null==d?void 0:d.antiSpamInfo)||void 0===i?void 0:i.yidunAntiSpamRes)||""};return d})}doSendFile(e){return Ce(this,void 0,void 0,function*(){Te({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e);var t=e.attach;if(!t){if(!this.core.cloudStorage||!this.core.cloudStorage.uploadFile)throw new Error('Service "cloudStorage" does not exist');try{t=yield this.core.cloudStorage.uploadFile(e)}catch(n){throw this.logger.error("sendFile:: upload File error or abort.",n),n}}return t})}resendMessage(e){var t,n;return Ce(this,void 0,void 0,function*(){var r,i=Pc(Object.assign(Object.assign({},e),{resendFlag:!0}));i.deliveryStatus=$a.sending;try{r=yield this.core.sendCmd("qchatSendMsg",{qchatMsg:i})}catch(c){var o=yield Lc(i,{time:(new Date).getTime(),deliveryStatus:$a.failed},this.core);throw c.msg=o,c}var{content:s}=r,a=yield Lc(Object.assign({},s.qchatMsg),{deliveryStatus:$a.success},this.core);if(a.isAntispam)throw{code:10403,msg:a,message:(null===(t=null==a?void 0:a.antiSpamInfo)||void 0===t?void 0:t.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(n=null==a?void 0:a.antiSpamInfo)||void 0===n?void 0:n.yidunAntiSpamRes)||""};return a})}doUpdateMessage(e){var t,n;return Ce(this,void 0,void 0,function*(){var{message:r}=e,i=be(e,["message"]),o=Pc(r);o.msgIdClient=void 0,o.time=r.time;var s=yield this.core.sendCmd("qchatUpdateMessage",{qchatMsg:o,qchatMsgUpdateTag:Object.assign(Object.assign({},i),{operatorAccount:this.core.account,operatorClientType:dc.Web,pushPayload:JSON.stringify(e.pushPayload),routeEnable:hn.boolean(e,"routeEnable")})}),a=yield Lc(s.content.qchatMsg,{},this.core);if(this.core.eventBus.emit("qchatChannel/changeUnread",a,!0),s.content.qchatMsg.isAntispam)throw{code:10403,msg:o,message:(null===(t=s.content.qchatMsg)||void 0===t?void 0:t.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(n=s.content.qchatMsg)||void 0===n?void 0:n.yidunAntiSpamRes)||""};return a})}getHistoryMessage(e){return Ce(this,void 0,void 0,function*(){var t=yield this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:Object.assign(Object.assign({},e),{reverse:e.reverse?1:0})}),{content:n}=t;return yield Promise.all(n.qchatMsgs.map(e=>Lc(e,{},this.core)))})}getMentionedMeMessages(e){return Ce(this,void 0,void 0,function*(){var t,n=yield this.core.sendCmd("qchatGetMentionedMeMessages",{tag:e}),{content:r}=n;return{pageInfo:(t=r.page,an($c,t)),messages:yield Promise.all(r.datas.map(e=>Lc(e,{},this.core)))}})}areMentionedMeMessages(e){return Ce(this,void 0,void 0,function*(){for(var t={},n=0;n<e.length;n++){var r=e[n];r.fromAccount!==this.core.account?t[r.msgIdClient]=yield this.core.qchatChannel.subscribeModuleService.getMentionedFlag(r,!0):t[r.msgIdClient]=!1}return t})}getLastMessageOfChannels(e){return Ce(this,void 0,void 0,function*(){var t=(yield this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:e})).content.msgs;return(yield xc(t,{},this.core)).reduce((e,t)=>(e[t.channelId]=t,e),{})})}messageSearchByPage(e){return Ce(this,void 0,void 0,function*(){var t,n=yield this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:Object.assign(Object.assign({},(t=e,dn(Uc,t))),{includeSelf:e.includeSelf?1:""})}),{datas:r,listQueryTag:i}=n.content,o=yield xc(r,{},this.core);return{listQueryTag:{hasMore:1==+i.hasMore,nextTimetag:i.nextTimetag?parseInt(i.nextTimetag):0,cursor:i.cursor},datas:o}})}onMsg(e){return Ce(this,void 0,void 0,function*(){var t=e.content.qchatMsg;if(t){var n=yield Lc(t,{},this.core);this.core.eventBus.emit("qchatChannel/changeUnread",n,!1),this.core.emit("message",n),this.core.qchatMsg.emit("message",n)}else this.logger.warn("No qchatMsg in qchatMsg packet")})}onRecvUnreadInfo(e){return Ce(this,void 0,void 0,function*(){var t=e.content.qchatMsg;if(t){var n=yield Lc(t);this.core.eventBus.emit("qchatChannel/changeUnread",n,!1)}})}onMultiSyncRead(e){var t=e.content.unreadInfo;if(t){var n=pa(t);this.core.eventBus.emit("qchatChannel/updateUnreads",[n])}}onMultiSyncServersRead(e){var t=e.content.qchatMultiSyncServersMessageReadTag;if(t){var{successServerIds:n,ackTimestamp:r}=xa(t);this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",n,r)}}onRecvMsgUpdate(e){return Ce(this,void 0,void 0,function*(){var t=e.content.qchatMsg,n=e.content.qchatMsgUpdateInfo;if(t){var r=yield Lc(t,{},this.core),i=kc(n);this.core.eventBus.emit("qchatChannel/changeUnread",r,!0),this.core.emit("messageUpdate",r,i),this.core.qchatMsg.emit("messageUpdate",r,i)}})}}class Gc{constructor(e){this._sendTypingEvent=ic(e=>Ce(this,void 0,void 0,function*(){yield this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:Oc(Object.assign(Object.assign({},e),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),ja.msgTyping)})}),3e3),this.core=e,this.logger=e.logger,this.lastChannelIdInTyping=""}getMessageHistoryByIds(e){return Ce(this,void 0,void 0,function*(){var t=yield this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:e.serverId,channelId:e.channelId},messageReferList:e.messageReferList});return Promise.all(t.content.qchatMsgs.map(e=>Lc(e)))})}getReferMessages(e){var t,n;return Ce(this,void 0,void 0,function*(){if(!(null===(t=e.message.replyRefer)||void 0===t?void 0:t.msgIdServer)||!(null===(n=e.message.threadRefer)||void 0===n?void 0:n.msgIdServer))throw new Error("Message has no reply");var r=yield this.getMessageHistoryByIds({serverId:e.message.serverId,channelId:e.message.channelId,messageReferList:[e.message.replyRefer,e.message.threadRefer]});return e.referType===qa[qa.all]?{replyMessage:r[0],threadMessage:r[1]}:e.referType===qa[qa.reply]?{replyMessage:r[0]}:e.referType===qa[qa.thread]?{threadMessage:r[1]}:{replyMessage:r[0],threadMessage:r[1]}})}getThreadMessages(e){var t;return Ce(this,void 0,void 0,function*(){var n;n=(null===(t=e.message.threadRefer)||void 0===t?void 0:t.msgIdServer)?Object.assign({serverId:e.message.serverId,channelId:e.message.channelId},e.message.threadRefer):e.message;var r=yield this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:n,getThreadHistoryMsgTag:Object.assign(Object.assign({},e.messageQueryOption),{reverse:hn.boolean(e.messageQueryOption,"reverse")})}),i=yield Lc(r.content.thread),o=yield Promise.all(r.content.qchatMsgs.map(e=>Lc(e)));return{thread:i,threadInfo:{messageCount:+r.content.threadInfo.messageCount,lastMessageTimestamp:+r.content.threadInfo.lastMessageTimestamp},messages:o}})}getThreadRootMessagesMeta(e){return Ce(this,void 0,void 0,function*(){var{threadRootMessages:t}=e,n=be(e,["threadRootMessages"]),r=(yield this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:t,tag:n})).content.metas;return r&&r.length>0?r.map(e=>Object.assign(Object.assign({},e),{total:parseInt(e.total),timestamp:parseInt(e.timestamp),msgTime:parseInt(e.msgTime)})):[]})}getQuickComments(e){return Ce(this,void 0,void 0,function*(){var t,n,r=yield this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:e.serverId,channelId:e.channelId,msgIdServerList:JSON.stringify(e.msgList.map(e=>e.msgIdServer))}}),{quickCommentResponse:i}=r.content;return t=i.map(e=>{var t=an(Vc,e);return t.details=t.details.map(e=>{var t=e.createTime?parseInt(e.createTime):0;return t=isNaN(t)?0:t,{count:e.count,hasSelf:e.self,severalAccids:e.topN,type:e.type,createTime:t}}),t}),n={},t.forEach(e=>n[e.msgIdServer]=e),n})}updateQuickComment(e,t){return Ce(this,void 0,void 0,function*(){Te({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},e);var{serverId:n,channelId:r,fromAccount:i,msgIdServer:o,time:s}=e.commentMessage;yield this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:n,channelId:r,fromAccount:i,msgIdServer:o,time:s,type:e.type,opeType:t,opeAccid:this.core.account}})})}sendTypingEvent(e){return Ce(this,void 0,void 0,function*(){if(e.channelId===this.lastChannelIdInTyping)return this.logger.log("qchatMsg sendTypingEvent throttle"),void this._sendTypingEvent(e);this.lastChannelIdInTyping=e.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(e)})}}class Hc{constructor(e){this.core=e}addChannelCategoryRole(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},e),Xa((yield this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:e})).content.channelCategoryRole)})}removeChannelCategoryRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),yield this.core.sendCmd("qchatRemoveChannelCategoryRole",e)})}updateChannelCategoryRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},e);var t=yield this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:za(e)});if(406===t.raw.code)throw new ve("No update required",{},406);return Xa(t.content.channelCategoryRole)})}getChannelCategoryRole(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t=(yield this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:e})).content.list,Array.isArray(t)&&t.length>0?t.map(e=>Xa(e)):[];var t})}addChannelCategoryMemberRole(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),Qa((yield this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:e})).content.channelCategoryMemberRole)})}removeChannelCategoryMemberRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),yield this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",e)})}updateChannelCategoryMemberRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},e);var t=yield this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:za(e)});if(406===t.raw.code)throw new ve("No update required",{},406);return Qa(t.content.channelCategoryMemberRole)})}getChannelCategoryMemberRole(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t=(yield this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:e})).content.list,Array.isArray(t)&&t.length>0?t.map(e=>Qa(e)):[];var t})}}class Wc{constructor(e){this.name="V2NIMConversationIdUtil",this.core=e}conversationId(e,t){return`${this.core.account}|${e}|${t}`}p2pConversationId(e){return`${this.core.account}|1|${e}`}teamConversationId(e){return`${this.core.account}|2|${e}`}superTeamConversationId(e){return`${this.core.account}|3|${e}`}messageConversationId(e){return 1===e.conversationType?e.senderId===this.core.account?this.p2pConversationId(e.receiverId):this.p2pConversationId(e.senderId):2===e.conversationType?this.teamConversationId(e.receiverId):this.superTeamConversationId(e.receiverId)}parseConversationType(e){try{if(e&&e.startsWith(`${this.core.account}|`)){var t=e.replace(`${this.core.account}|`,"");return Number(t[0])}return this.core.logger.warn(`conversationId is not start with ${this.core.account}`),0}catch(n){return 0}}parseConversationTargetId(e){try{return e&&e.startsWith(`${this.core.account}|`)?e.replace(`${this.core.account}|`,"").slice(2):(this.core.logger.warn(`conversationId is not start with ${this.core.account}`),"")}catch(t){return""}}convertToV1ConversationId(e){var t=this.parseConversationType(e);return`${1===t?"p2p":2===t?"team":"superTeam"}|${this.parseConversationTargetId(e)}`}}class zc{constructor(){this.messages=new Map,this.capacity=1e4}reset(){this.messages.clear()}getMessageById(e){if(e)return this.messages.get(e)}getMessagesByConversationId(e){var t=[];return this.messages.forEach(n=>{n.conversationId===e&&t.push(n)}),t}getLastMessageOfConversation(e){var t=this.getMessagesByConversationId(e);if(0!==t.length)return t.reduce((e,t)=>t.createTime>e.createTime?t:e,t[0])}upsertMessages(e){e.forEach(e=>{this.setLRU(e.messageClientId,e)})}setLRU(e,t){if(this.messages.has(e))this.messages.delete(e);else if(this.messages.size>=this.capacity){var n=this.messages.keys().next().value;n&&this.messages.delete(n)}this.messages.set(e,t)}deleteMessage(e){this.messages.delete(e)}deleteMessages(e,t){this.messages.forEach(n=>{e===n.conversationId&&(!t||t&&n.createTime<t)&&this.messages.delete(n.messageClientId)})}}var Kc={accountId:{type:"string",allowEmpty:!1},content:{type:"object",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number",allowEmpty:!1}}},messages:{type:"array",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number"},role:{type:"enum",values:["assistant","user","system"]}}},promptVariables:{type:"jsonstr",required:!1},modelConfigParams:{type:"object",required:!1,rules:{prompt:{type:"string",required:!1},maxTokens:{type:"number",required:!1},topP:{type:"number",required:!1},temperature:{type:"number",required:!1}}},aiStream:{type:"boolean",required:!1}},Yc=Object.assign({requestId:{type:"string",allowEmpty:!1}},Kc),Jc={requestId:{type:"string",allowEmpty:!1},accountId:{type:"string",allowEmpty:!1}},Xc=[1,3,2,0],Qc=[2,7,12,100,6,1,-1,4,5,11,0,10,3],Zc={routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}},el={pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forceContent:{type:"string",required:!1},forcePushAccountIds:{type:"array",required:!1,itemType:"string"}},tl={antispamEnabled:{type:"boolean",required:!1},antispamBusinessId:{type:"string",required:!1},antispamCustomMessage:{type:"string",required:!1},antispamCheating:{type:"string",required:!1},antispamExtension:{type:"string",required:!1}},nl={messageConfig:{type:"object",required:!1,rules:{readReceiptEnabled:{type:"boolean",required:!1},lastMessageUpdateEnabled:{type:"boolean",required:!1},historyEnabled:{type:"boolean",required:!1},roamingEnabled:{type:"boolean",required:!1},onlineSyncEnabled:{type:"boolean",required:!1},offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},routeConfig:{type:"object",required:!1,rules:Zc},pushConfig:{type:"object",required:!1,rules:el},antiSpamConfig:{type:"object",required:!1,rules:tl},robotConfig:{type:"object",required:!1,rules:{accountId:{type:"string",required:!1},topic:{type:"string",required:!1},function:{type:"string",required:!1},customContent:{type:"string",required:!1}}},aiConfig:{type:"object",required:!1,rules:Kc},targetConfig:{type:"object",required:!1,rules:{receiverIds:{type:"array",itemType:"string"},inclusive:{type:"boolean"},newMemberVisible:{type:"boolean",required:!1}}},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},rl={message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:Qc},messageClientId:{type:"string",allowEmpty:!1}}},params:{type:"object",rules:nl,required:!1},replyMessage:{type:"object",rules:{conversationType:{type:"enum",values:[1,3,2,0]},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},il={conversationId:{type:"string",allowEmpty:!1},message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:Qc},messageClientId:{type:"string",allowEmpty:!1},attachment:{type:"object",required:!1,rules:{file:{type:"file",required:!1}}}}},params:{type:"object",required:!1,rules:nl}},ol={message:{type:"object",rules:{messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:Xc},createTime:{type:"number"}}},params:{type:"object",rules:{postscript:{type:"string",required:!1},serverExtension:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},env:{type:"string",required:!1}},required:!1}},sl={conversationId:{type:"string",allowEmpty:!1},messageTypes:{type:"array",required:!1,itemType:"enum",values:Qc},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[1,0],required:!1},anchorMessage:{type:"object",required:!1,rules:{messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},al={conversationType:{type:"enum",values:Xc},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1}},cl={messageRefers:{type:"array",required:!0,rules:al}},ll={conversationId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:Xc},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},dl={messages:{type:"array",rules:ll}},ul={conversationId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},onlineSync:{type:"boolean",required:!1},deleteRoam:{type:"boolean",required:!1},clearMode:{type:"enum",values:[0,1,2],required:!1}},pl={serverExtension:{type:"string",required:!1}},hl={messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[1]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},gl={messages:{type:"array",rules:{messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},min:1}},ml={voiceUrl:{type:"string",required:!1,allowEmpty:!1},file:{type:"file",required:!1},voicePath:{type:"string",required:!1,allowEmpty:!1},mimeType:{type:"string",required:!1,allowEmpty:!1},sampleRate:{type:"string",required:!1,allowEmpty:!1},duration:{type:"number",required:!0,min:0},sceneName:{type:"string",required:!1}},fl={message:{type:"object",rules:{conversationType:{type:"enum",values:Xc},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}},index:{type:"number",min:1},serverExtension:{type:"string",required:!1},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},needBadge:{type:"boolean",required:!1},title:{type:"string",required:!1,allowEmpty:!1},content:{type:"string",required:!1,allowEmpty:!1},pushPayload:{type:"string",required:!1,allowEmpty:!1}}}},vl={messages:{type:"array",rules:{conversationType:{type:"enum",values:[1,3,2,0]},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},yl={params:{type:"object",rules:{collectionType:{type:"number",min:1},collectionData:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},uniqueId:{type:"string",required:!1}}}},_l={collections:{type:"array",min:1,rules:{collectionId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Il={serverExtension:{type:"string",required:!1},collection:{type:"object",rules:{collectionId:{type:"string",allowEmpty:!1},collectionType:{type:"number"},createTime:{type:"number"}}}},Tl={beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",required:!1,values:[1,0]},collectionType:{type:"number",required:!1},anchorCollection:{type:"object",required:!1,rules:{collectionId:{type:"string",allowEmpty:!1,required:!1},createTime:{type:"number",required:!1}}}},Sl={keyword:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},sortOrder:{type:"enum",values:[1,0],required:!1},conversationLimit:{type:"number",min:0,required:!1},messageLimit:{type:"number",min:1,required:!1},p2pAccountIds:{type:"array",required:!1,itemType:"string"},teamIds:{type:"array",required:!1,itemType:"string"},senderAccountIds:{type:"array",required:!1,itemType:"string"},messageTypes:{type:"array",required:!1,itemType:"enum",values:Qc},messageSubtypes:{type:"array",required:!1,itemType:"number"}},El={conversationId:{type:"string",required:!1,allowEmpty:!1},keywordList:{type:"array",required:!1,itemType:"string"},keywordMatchType:{type:"enum",values:[1,0],required:!1},senderAccountIds:{type:"array",required:!1,itemType:"string"},messageTypes:{type:"array",required:!1,itemType:"enum",values:Qc},messageSubtypes:{type:"array",required:!1,itemType:"number"},searchStartTime:{type:"number",required:!1},searchTimePeriod:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[0,1],required:!1},pageToken:{type:"string",required:!1}},Ml={message:{type:"object",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]}}}},bl={messages:{type:"array",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]}},min:1}},Cl={sceneName:{type:"string",required:!1},name:{type:"string",required:!1}},Al=Object.assign(Object.assign({},Cl),{duration:{type:"number",required:!1}}),Ol=Object.assign(Object.assign({},Al),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),Rl=Object.assign(Object.assign({},Cl),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),Nl={messageRefer:{type:"object",required:!0,rules:al},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[1,0],required:!1},excludeMessageServerId:{type:"string",required:!1,allowEmpty:!1}},wl={senderId:{type:"string",allowEmpty:!1},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1}},Pl={subType:{type:"number",min:0,required:!1},text:{type:"string",required:!1},attachment:{type:"object",required:!1},serverExtension:{type:"string",required:!1},routeConfig:{type:"object",required:!1,rules:Zc},pushConfig:{type:"object",required:!1,rules:el},antiSpamConfig:{type:"object",required:!1,rules:tl},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},kl={messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"},aiConfig:{type:"object",rules:Kc}},Ll={operationType:{type:"enum",values:[0,1,2]},updateContent:{type:"string",allowEmpty:!0,required:!1}},xl={operationType:{type:"enum",values:[2,1],required:!0}};class Vl{constructor(e,t){this.p2pMessageReceipts={},this.core=e,this.service=t}reset(){this.p2pMessageReceipts={}}sendP2PMessageReceipt(e){return Ce(this,void 0,void 0,function*(){if(Te(hl,e,"",!0),e.senderId===this.core.account)throw new ge({detail:{reason:`sendP2PMessageReceipt. sender: ${e.senderId} is not allowed to send msg receipt`}});yield this.core.sendCmd("v2SendP2PMessageReceipt",{tag:{receiverId:e.senderId,messageClientId:e.messageClientId,createTime:e.createTime}})})}isPeerRead(e){if(1!==e.conversationType)return!1;if(e.senderId!==this.core.account)return!1;if(e.senderId===this.core.account&&e.receiverId===this.core.account)return!0;var t=this.core.V2NIMConversationIdUtil.messageConversationId(e),n=this.p2pMessageReceipts[t]||0;return e.createTime<=n}getP2PMessageReceipt(e){return Ce(this,void 0,void 0,function*(){if(Ee(this.core.account,e),1!==this.core.V2NIMConversationIdUtil.parseConversationType(e))throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getP2PMessageReceipt: conversationId is not p2p conversationId"}});return{conversationId:e,timestamp:this.p2pMessageReceipts[e]||0}})}getTeamMessageReceipts(e){return Ce(this,void 0,void 0,function*(){if(Te(bl,{messages:e},"",!0),e.some(e=>e.senderId!==this.core.account))throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});if(e.some(t=>t.receiverId!==e[0].receiverId))throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: exist messages receiverId is not same"}});return(yield this.core.sendCmd("v2GetTeamMessageReceipts",{tag:e})).content.data.map(e=>Object.assign(Object.assign({},e),{conversationId:this.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId)}))})}getTeamMessageReceiptDetail(e){return Ce(this,void 0,void 0,function*(){if(Te(Ml,{message:e},"",!0),e.senderId!==this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:`getTeamMessageReceiptDetail::senderId ${e.senderId} incorrect`}});var t=yield this.core.sendCmd("v2GetTeamMessageReceiptDetail",{tag:e});return{readReceipt:{conversationId:this.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId),messageClientId:e.messageClientId,messageServerId:e.messageServerId,readCount:t.content.readAccountList.length,unreadCount:t.content.unreadAccountList.length},readAccountList:t.content.readAccountList,unreadAccountList:t.content.unreadAccountList}})}sendTeamMessageReceipts(e){return Ce(this,void 0,void 0,function*(){if(e.some(t=>t.conversationId!==e[0].conversationId))throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: conversationId not same"}});if(Te(gl,{messages:e},"",!0),e.some(e=>e.senderId===this.core.account))throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});yield this.core.sendCmd("v2SendTeamMessageReceipts",{tag:e})})}syncP2PMessagReceiptsHandler(e){var t=e.content.data.map(e=>{var t=this.core.V2NIMConversationIdUtil.p2pConversationId(e.senderId),n=e.createTime;return this.p2pMessageReceipts[t]=n,{conversationId:t,timestamp:n}});this.service.emit("onReceiveP2PMessageReadReceipts",t)}onP2PMessageReceiptsHandler(e){var t=this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.data.senderId),n=e.content.data.createTime;this.p2pMessageReceipts[t]=n,this.service.emit("onReceiveP2PMessageReadReceipts",[{conversationId:t,timestamp:n}])}onTeamMessageReceiptsHandler(e){var t=e.content.data.map(e=>({conversationId:this.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId),messageServerId:e.messageServerId,messageClientId:e.messageClientId,readCount:e.readCount,unreadCount:e.unreadCount,latestReadAccount:e.latestReadAccount}));this.service.emit("onReceiveTeamMessageReadReceipts",t)}}var Dl={"31_1":"v2TeamCreate","32_1":"v2SuperTeamCreate","31_5":"v2TeamInviteMembers","32_5":"v2SuperTeamInviteMembers","31_6":"v2TeamKickMembers","32_6":"v2SuperTeamKickMembers","31_8":"v2TeamLeave","32_7":"v2SuperTeamLeave","31_7":"v2TeamUpdateInfo","32_8":"v2SuperTeamUpdateInfo","31_9":"v2TeamGetInfo","32_9":"v2SuperTeamGetInfo","31_12":"v2TeamDismiss","32_4":"v2SuperTeamDismiss","31_13":"v2TeamApplyToJoin","32_20":"v2SuperTeamApplyToJoin","31_14":"v2TeamAcceptJoinApplication","32_21":"v2SuperTeamAcceptJoinApplication","31_15":"v2TeamRejectJoinApplication","32_22":"v2SuperTeamRejectJoinApplication","31_16":"v2TeamAddManagers","32_26":"v2SuperTeamAddManagers","31_17":"v2TeamRemoveManagers","32_27":"v2SuperTeamRemoveManagers","31_18":"v2TeamTransferOwner","32_31":"v2SuperTeamTransferOwner","31_19":"v2TeamUpdateSelfMemberInfo","32_10":"v2SuperTeamUpdateSelfMemberInfo","31_20":"v2TeamUpdateMember","32_30":"v2SuperTeamUpdateMember","31_21":"v2TeamAcceptInvitation","32_23":"v2SuperTeamAcceptInvitation","31_22":"v2TeamRejectInvite","32_24":"v2SuperTeamRejectInvite","31_33":"v2TeamGetMemberInvitor","32_35":"v2SuperTeamGetMemberInvitor","31_25":"v2TeamMemberSetChatBannedStatus","32_29":"v2SuperTeamMemberSetChatBannedStatus","31_32":"v2TeamSetChatBannedMode","32_28":"v2SuperTeamSetChatBannedMode","31_34":"v2TeamGetByIds","32_36":"v2SuperTeamGetByIds","31_35":"v2TeamMemberGetListByIds","32_37":"v2SuperTeamMemberGetListByIds","31_36":"v2TeamMemberGetList","8_101":"v2TeamCreateMultiSync","8_109":"v2TeamSync","8_119":"v2TeamMemberUpdateMultiSync","8_126":"v2TeamMembersOfSelfInSync","21_101":"v2SuperTeamCreateMultiSync","21_109":"v2SuperTeamSync","21_110":"v2SuperTeamMemberUpdateMultiSync","21_111":"v2SuperTeamMembersOfSelfInSync"},Ul={antispamBusinessId:1},$l="V2NIMTeamService",Bl={teamId:1,name:3,teamType:{id:4,retConverter:e=>0==+e?1:+e},ownerAccountId:5,memberLimit:{id:6,retType:"number"},isValidTeam:{id:8,retConverter:(e,t)=>1==+e&&(void 0===t[13]||1==+t[13])},memberCount:{id:9,retType:"number"},memberUpdateTime:{id:10,retType:"number"},createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},intro:14,announcement:15,joinMode:{id:16,retType:"number"},serverExtension:18,customerExtension:19,avatar:20,agreeMode:{id:21,retType:"number"},inviteMode:{id:22,retType:"number"},updateInfoMode:{id:23,retType:"number"},updateExtensionMode:{id:24,retType:"number"},chatBannedMode:{id:101,retType:"number"}},Fl={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},joinTime:{id:10,retType:"number"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,followAccountIds:{id:16,retConverter:e=>{try{return JSON.parse(e)}catch(t){return[]}}}},jl={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,joinTime:{id:15,retType:"number"},followAccountIds:{id:17,retConverter:e=>{try{return JSON.parse(e)}catch(t){return[]}}}},ql={accountIds:{id:1,converter:e=>JSON.stringify(e)},operation:2},Gl={teamId:1,teamType:2,roleQueryType:3,onlyChatBanned:{id:4,converter:e=>+e},nextToken:5,limit:6,direction:7},Hl={v2TeamCreate:{sid:31,cid:1,service:$l,params:[{type:"Property",name:"team",reflectMapper:Bl},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:Ul}],response:[{type:"Property",name:"team",reflectMapper:Wt(Bl)},{type:"StrArray",name:"failedList"}]},v2SuperTeamCreate:{sid:32,cid:1,service:$l,params:[{type:"Property",name:"team",reflectMapper:Bl},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:Ul}],response:[{type:"Property",name:"team",reflectMapper:Wt(Bl)},{type:"StrArray",name:"failedList"}]},v2TeamInviteMembers:{sid:31,cid:5,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},v2SuperTeamInviteMembers:{sid:32,cid:5,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},v2TeamUpdateInfo:{sid:31,cid:7,service:$l,params:[{type:"Property",name:"team",reflectMapper:Bl},{type:"Property",name:"antispamConfig",reflectMapper:Ul}],response:[{type:"Long",name:"teamId"},{type:"Long",name:"timestamp"}]},v2SuperTeamUpdateInfo:{sid:32,cid:8,service:$l,params:[{type:"Property",name:"team",reflectMapper:Bl},{type:"Property",name:"antispamConfig",reflectMapper:Ul}],response:[{type:"Long",name:"timestamp"}]},v2TeamLeave:{sid:31,cid:8,service:$l,params:[{type:"Long",name:"teamId"}]},v2SuperTeamLeave:{sid:32,cid:7,service:$l,params:[{type:"Long",name:"teamId"}]},v2TeamGetInfo:{sid:31,cid:9,service:$l,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Wt(Bl)}]},v2SuperTeamGetInfo:{sid:32,cid:9,service:$l,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Wt(Bl)}]},v2TeamGetByIds:{sid:31,cid:34,service:$l,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Wt(Bl)},{type:"LongArray",name:"tids"}]},v2SuperTeamGetByIds:{sid:32,cid:36,service:$l,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Wt(Bl)},{type:"LongArray",name:"tids"}]},v2TeamDismiss:{sid:31,cid:12,service:$l,params:[{type:"Long",name:"teamId"}]},v2SuperTeamDismiss:{sid:32,cid:4,service:$l,params:[{type:"Long",name:"teamId"}]},v2TeamAcceptInvitation:{sid:31,cid:21,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:Wt(Bl)}]},v2SuperTeamAcceptInvitation:{sid:32,cid:23,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:Wt(Bl)}]},v2TeamRejectInvite:{sid:31,cid:22,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectInvite:{sid:32,cid:24,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamKickMembers:{sid:31,cid:6,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamKickMembers:{sid:32,cid:6,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamApplyToJoin:{sid:31,cid:13,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Wt(Bl)},{type:"Int",name:"isInTeam"}]},v2SuperTeamApplyToJoin:{sid:32,cid:20,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Wt(Bl)},{type:"Int",name:"isInTeam"}]},v2TeamAcceptJoinApplication:{sid:31,cid:14,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2SuperTeamAcceptJoinApplication:{sid:32,cid:21,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2TeamRejectJoinApplication:{sid:31,cid:15,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectJoinApplication:{sid:32,cid:22,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamAddManagers:{sid:31,cid:16,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamAddManagers:{sid:32,cid:26,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamRemoveManagers:{sid:31,cid:17,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamRemoveManagers:{sid:32,cid:27,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamTransferOwner:{sid:31,cid:18,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2SuperTeamTransferOwner:{sid:32,cid:31,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2TeamUpdateSelfMemberInfo:{sid:31,cid:19,service:$l,params:[{type:"Property",name:"teamMember",reflectMapper:Fl},{type:"Property",name:"specialFollowUpdate",reflectMapper:ql},{type:"Property",name:"antispam",reflectMapper:Ul}],response:[{type:"Property",name:"data",reflectMapper:Wt(Fl)}]},v2SuperTeamUpdateSelfMemberInfo:{sid:32,cid:10,service:$l,params:[{type:"Property",name:"teamMember",reflectMapper:jl},{type:"Property",name:"specialFollowUpdate",reflectMapper:ql},{type:"Property",name:"antispam",reflectMapper:Ul}],response:[{type:"Property",name:"data",reflectMapper:Wt(jl)}]},v2TeamUpdateMember:{sid:31,cid:20,service:$l,params:[{type:"Property",name:"teamMember",reflectMapper:Fl},{type:"Property",name:"antispam",reflectMapper:Ul}]},v2SuperTeamUpdateMember:{sid:32,cid:30,service:$l,params:[{type:"Property",name:"teamMember",reflectMapper:jl},{type:"Property",name:"antispam",reflectMapper:Ul}]},v2TeamGetMemberInvitor:{sid:31,cid:33,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2SuperTeamGetMemberInvitor:{sid:32,cid:35,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2TeamMemberSetChatBannedStatus:{sid:31,cid:25,service:$l,params:[{type:"Long",name:"teamId"},{type:"String",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2SuperTeamMemberSetChatBannedStatus:{sid:32,cid:29,service:$l,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2TeamSetChatBannedMode:{sid:31,cid:32,service:$l,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2SuperTeamSetChatBannedMode:{sid:32,cid:28,service:$l,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2TeamMemberGetListByIds:{sid:31,cid:35,service:$l,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Fl)}]},v2SuperTeamMemberGetListByIds:{sid:32,cid:37,service:$l,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(jl)}]},v2TeamMemberGetList:{sid:31,cid:36,service:$l,params:[{type:"Property",name:"tag",reflectMapper:Gl}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Fl)},{type:"Property",name:"pageInfo",reflectMapper:{1:"hasMore",2:"nextToken"}}]},v2TeamSync:{sid:8,cid:109,service:$l,response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"datas",reflectMapper:Wt(Bl)}]},v2TeamCreateMultiSync:{sid:8,cid:101,service:$l,response:[{type:"Property",name:"data",reflectMapper:Wt(Bl)}]},v2TeamMemberUpdateMultiSync:{sid:8,cid:119,service:$l,response:[{type:"Property",name:"data",reflectMapper:Wt(Fl)}]},v2TeamMembersOfSelfInSync:{sid:8,cid:126,service:$l,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Fl)},{type:"Long",name:"timetag"}]},v2SuperTeamSync:{sid:21,cid:109,service:$l,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Bl)},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},v2SuperTeamCreateMultiSync:{sid:21,cid:101,service:$l,response:[{type:"Property",name:"data",reflectMapper:Wt(Bl)}]},v2SuperTeamMemberUpdateMultiSync:{sid:21,cid:110,service:$l,response:[{type:"Property",name:"data",reflectMapper:Wt(jl)}]},v2SuperTeamMembersOfSelfInSync:{sid:21,cid:111,service:$l,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(jl)},{type:"Long",name:"timetag"}]}};function Wl(e,t){if(!e)return{};var n=e;return n.tinfo&&(n.tinfo=qt(n.tinfo,Wt(Bl)),n.tinfo.teamType=t),n.uinfos,void 0!==n.mute&&(n.mute=parseInt(n.mute)),n}function zl(e,t,n={}){return Object.assign({teamId:e,teamType:t,name:"",ownerAccountId:"",memberLimit:0,memberCount:0,createTime:0,updateTime:0,intro:"",announcement:"",avatar:"",joinMode:0,agreeMode:0,inviteMode:0,updateInfoMode:0,updateExtensionMode:0,chatBannedMode:0,isValidTeam:!0},n)}function Kl(e,t,n,r={}){return Object.assign({teamId:e,teamType:t,accountId:n,joinTime:0,inTeam:!0,memberRole:0,chatBanned:!1},r)}function Yl(e,t=1){return e.map(e=>function(e,t=1){return e.teamType=t,e.chatBanned=void 0!==e.chatBanned&&e.chatBanned,e}(e,t))}function Jl(e,t,n){var r,i=Object.assign(Object.assign({},t),{conversationId:e.V2NIMConversationIdUtil.messageConversationId(t),isSelf:t.senderId===e.account,sendingState:1,messageStatus:{errorCode:(null===(r=null==t?void 0:t.messageStatus)||void 0===r?void 0:r.errorCode)||200},messageSource:n||0});if(i.threadReply&&(i.threadReply=Object.assign(Object.assign({},i.threadReply),{conversationType:i.conversationType,conversationId:i.conversationId})),i.threadRoot&&(i.threadRoot=Object.assign(Object.assign({},i.threadRoot),{conversationType:i.conversationType,conversationId:i.conversationId})),i.isInBlackList&&(i.sendingState=2,i.messageStatus.errorCode=le.V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST,delete i.isInBlackList),i.streamConfig){var o=Ve(i.streamConfig,"isStream");if(!1===o)delete i.streamConfig;else if(!0===o&&void 0===i.streamConfig.status)delete i.streamConfig,t.aiConfig&&(t.aiConfig.aiStream=!0,t.aiConfig.aiStreamStatus=0);else if("number"==typeof i.streamConfig.status)return i.streamConfig={status:i.streamConfig.status},function(e){if(e.streamConfig&&e.aiConfig&&(e.aiConfig.aiStream=!0,e.aiConfig.aiStreamStatus=e.streamConfig.status),e.attachment&&e.streamConfig){var t=e.attachment;e.streamConfig.lastChunk={content:t.msg,messageTime:e.createTime,chunkTime:t.timestamp,type:t.type,index:t.index},e.aiConfig&&(e.aiConfig.aiStreamLastChunk=e.streamConfig.lastChunk),delete e.attachment}return e}(i)}return Xl(i,e)}function Xl(e,t){return 5===e.messageType?function(e,t){var n,r,i,o,s,a=t.attachment||{};if(t.attachment&&"type"in t.attachment)return t;var c=void 0;if(null===(n=a.data)||void 0===n?void 0:n.tinfo){var{id:l,data:d}=a,u=l>400?2:1,{tinfo:p}=Wl(Object.assign({},d),u);c={},c=be(p,["teamId"])}var h=Object.assign(Object.assign(Object.assign(Object.assign({raw:a.raw,type:nd(e,a.id)},c?{updatedTeamInfo:c}:{}),{targetIds:(null===(r=a.data)||void 0===r?void 0:r.ids)||((null===(i=a.data)||void 0===i?void 0:i.id)?[a.data.id]:[])}),"string"==typeof(null===(o=a.data)||void 0===o?void 0:o.attach)?{serverExtension:a.data.attach}:{}),"number"==typeof(null===(s=a.data)||void 0===s?void 0:s.mute)?{chatBanned:0!==a.data.mute}:{});return Object.assign(Object.assign({},t),{attachment:h})}(t,e):100===e.messageType?function(e,t){var n,r,i;if("string"==typeof(null===(n=t.attachment)||void 0===n?void 0:n.raw)&&(null===(i=null===(r=e.V2NIMMessageService)||void 0===r?void 0:r.customAttachmentParsers)||void 0===i?void 0:i.length)>0){var o=t.subType||0,s=e.V2NIMMessageService.customAttachmentParsers,a=t.attachment.raw;s.some(n=>{try{var r=n(o,a);if(Ae(r))return r.raw=a,t.attachment=r,!0}catch(i){return e.logger.warn(`customAttachmentParser: subType ${o}, raw: ${a}. parse error with ${i}`),!1}return!1})}return t}(t,e):e}function Ql(e,t){return Object.assign(Object.assign({},t),{conversationId:e.V2NIMConversationIdUtil.messageConversationId(t)})}function Zl(e,t){var{createTime:n,senderId:r,receiverId:i,conversationType:o}=t;return{conversationType:o,conversationId:e.V2NIMConversationIdUtil.messageConversationId({conversationType:o,senderId:r,receiverId:i}),senderId:t.senderId,receiverId:t.receiverId,messageServerId:t.messageServerId,createTime:n,messageClientId:t.messageClientId}}function ed(e,t){var n={7:1,8:2,12:3,13:1,14:2}[t.sysMsgType];return{postscript:t.postscript,revokeType:{7:1,8:2,12:3,13:4,14:5}[t.sysMsgType]||0,revokeAccountId:t.opeAccount||t.senderId,callbackExtension:t.callbackExtension,serverExtension:t.attach||"",messageRefer:{conversationType:n,conversationId:e.V2NIMConversationIdUtil.messageConversationId(Object.assign(Object.assign({},t),{conversationType:n,senderId:t.senderId,receiverId:t.receiverId})),senderId:t.senderId,receiverId:t.receiverId,messageServerId:t.messageServerId,createTime:t.deleteMsgCreatetime,messageClientId:t.messageClientId}}}function td(e,t){return{conversationId:1===t.conversationType?e.V2NIMConversationIdUtil.p2pConversationId(t.receiverId):2===t.conversationType?e.V2NIMConversationIdUtil.teamConversationId(t.teamId):e.V2NIMConversationIdUtil.superTeamConversationId(t.teamId),deleteTime:t.deleteTime,serverExtension:t.serverExtension}}function nd(e,t){var n={0:0,401:401,1:1,402:402,2:2,403:403,3:3,404:404,4:4,405:405,5:5,410:410,6:6,406:406,7:7,407:407,8:8,408:408,9:9,411:411,10:10,409:409};return void 0===n[t]&&e.logger.warn(`[V2NIMMessageService] undefined notification type: ${t}`),"number"==typeof n[t]?n[t]:-1}function rd(e,t){var n=[],r={};for(var i in t.forEach(e=>{var t=e.conversationId;r[t]||(r[t]={conversationId:t,messages:[],count:0}),r[t].messages.push(e),r[t].count++}),r){var o=r[i];n.push(o)}return n}function id(e,t){if(!t)return"";switch(e){case 100:return t.raw||"";case 1:case 3:case 2:case 6:return function(e){var t=e,{width:n,height:r,duration:i,path:o,file:s,raw:a,ctx:c,payload:l,bucketName:d,objectName:u,token:p,ext:h}=t,g=be(t,["width","height","duration","path","file","raw","ctx","payload","bucketName","objectName","token","ext"]),m="string"==typeof h&&"."===h[0]?h.slice(1):h;return JSON.stringify(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},g),void 0===h?{}:{ext:m}),void 0===n?{}:{w:n}),void 0===r?{}:{h:r}),void 0===i?{}:{dur:i}))}(t);case 4:return n=t,JSON.stringify({lat:n.latitude,lng:n.longitude,title:n.address});case 12:return function(e){var t=be(e,["raw"]);try{return JSON.stringify(Object.assign(Object.assign({},t),{durations:e.durations.map(e=>({accid:e.accountId,duration:e.duration}))}))}catch(n){return JSON.stringify(e)}}(t);default:return t.raw||JSON.stringify(t)}var n}function od(e,t){var n,r,i;try{switch(n=JSON.parse(e),t){case 100:return{raw:e};case 4:return r=e,{latitude:(i=n).lat,longitude:i.lng,address:i.title,raw:r};case 2:case 3:case 1:case 6:return function(e,t){var{w:n,h:r,dur:i,ext:o}=t,s=be(t,["w","h","dur","ext"]),a="string"==typeof o&&"."!==o[0]?`.${o}`:o;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},s),void 0===o?{}:{ext:a}),void 0===n?{}:{width:n}),void 0===r?{}:{height:r}),void 0===i?{}:{duration:i}),{raw:e})}(e,n);case 12:return function(e,t){return Object.assign(Object.assign({},t),{durations:t.durations.map(e=>({accountId:e.accid,duration:e.duration})),raw:e})}(e,n);default:return"object"==typeof n&&n?Object.assign(Object.assign({},n),{raw:e}):{raw:e}}}catch(i){return"object"==typeof n&&n?Object.assign(Object.assign({},n),{raw:e}):{raw:e}}}class sd{constructor(e){this.core=e}doSendFile(e,t){return Ce(this,void 0,void 0,function*(){var n=e.attachment;try{var[r,i]=yield this.core.V2NIMStorageService._uploadFile({taskId:e.messageClientId,uploadParams:{fileObj:(null==n?void 0:n.file)||(null==n?void 0:n.path),sceneName:null==n?void 0:n.sceneName}},t,{fileType:e.messageType}),o=Object.assign(Object.assign({},n),{uploadState:1});void 0!==i.w&&(o.width=o.width||i.w),void 0!==i.h&&(o.height=o.height||i.h),void 0!==i.dur&&(o.duration=o.duration||i.dur),o.ext=o.ext&&-1===o.ext.indexOf(".")?`.${o.ext}`:o.ext;var s=["w","h","dur","ext","name"];for(var a in i)s.includes(a)||(o[a]=i[a]);var{raw:c,file:l,path:d}=o,u=be(o,["raw","file","path"]);e.attachment=JSON.parse(JSON.stringify(u)),e.attachment&&(e.attachment.raw=id(e.messageType,e.attachment))}catch(p){throw e.attachment&&(e.attachment.uploadState=2),p}})}cancelMessageAttachmentUpload(e){return Ce(this,void 0,void 0,function*(){if(Te({messageClientId:{type:"string",allowEmpty:!1}},e,"",!0),![2,6,1,3].includes(e.messageType))throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:`cancelMessageAttachmentUpload: messageType ${e.messageType} incorrect`}});if(2===e.sendingState||1===e.sendingState)throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"cancelMessageAttachmentUpload: message is already failed or succeeded"}});yield this.core.V2NIMStorageService._cancelUploadFile(e.messageClientId)})}}var ad="V2NIMMessageService",cd={"30_1":"v2SendP2pMessage","31_2":"v2SendTeamMessage","30_31":"v2MessageP2pModify","31_37":"v2MessageTeamModify","32_38":"v2MessageSuperTeamModify","7_33":"v2MessageOnModified","4_27":"v2MessageSyncModified","4_28":"v2MessageSuperTeamSyncModified","4_5":"v2BatchMarkRead","4_12":"syncP2PMessagReceipts","30_11":"v2SendP2PMessageReceipt","31_28":"v2SendTeamMessageReceipts","32_2":"v2SendSuperTeamMessage","7_12":"onP2PMessageReceipts","8_31":"onTeamMessageReceipts","31_29":"v2GetTeamMessageReceipts","31_30":"v2GetTeamMessageReceiptDetail","7_2":"onMsg","8_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_3":"onMsg","21_102":"onMsg","4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","30_13":"v2RevokeMessage","32_17":"v2RevokeSuperTeamMessage","7_14":"onRevokeMessage","7_15":"syncRevokeMessage","21_18":"onRevokeMessage","21_117":"onRevokeMessage","30_23":"v2DeleteMessage","30_24":"v2DeleteMessages","4_21":"syncOnDeleteMessages","7_123":"onDeleteMessage","7_124":"onDeleteMessages","29_17":"v2DownloadLocalAntiSpamVocabs"},ld={conversationType:{id:0,converter:fd,retConverter:vd},receiverId:1,senderId:2,fromClientType:4,fromDeviceId:5,fromNick:6,createTime:{id:7,retType:"number"},messageType:{id:8,retType:"number"},text:9,attachment:{id:10,converter:(e,t)=>id(t.messageType,e),retConverter:(e,t)=>od(e,Number(t[8]))},messageClientId:11,messageServerId:12,resend:{id:13,converter:zt,retType:"boolean"},userUpdateTime:{id:14,retType:"number"},serverExtension:15,pushPayload:{id:16,access:"pushConfig.pushPayload"},pushContent:{id:17,access:"pushConfig.pushContent"},forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:e=>{if(e["pushConfig.forcePush"])return"#%@all@%#"},converter:(e,t)=>{if(t["pushConfig.forcePush"])return e?JSON.stringify(e):"#%@all@%#"},retConverter(e){if("#%@all@%#"!==e&&e)try{return JSON.parse(e)}catch(t){return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,access:"pushConfig.forcePush",converter:zt,retType:"boolean"},antispamCustomMessageEnabled:{id:21,def:e=>Ve(e,"antispamConfig.antispamCustomMessage")?1:void 0,retConverter:()=>{}},antispamCustomMessage:{id:22,access:"antispamConfig.antispamCustomMessage"},antispamBusinessId:{id:23,access:"antispamConfig.antispamBusinessId"},clientAntispamHit:{id:24,access:"clientAntispamHit",converter:zt,retType:"boolean"},antispamEnabled:{id:25,access:"antispamConfig.antispamEnabled",converter:zt,retType:"boolean"},needAck:{id:26,access:"messageConfig.readReceiptEnabled",converter:zt,retType:"boolean"},lastMessageUpdateEnabled:{id:28,access:"messageConfig.lastMessageUpdateEnabled",converter:zt,retType:"boolean"},threadReplySenderId:{id:29,access:"threadReply.senderId"},threadReplyReceiverId:{id:30,access:"threadReply.receiverId"},threadReplyTime:{id:31,access:"threadReply.createTime",retType:"number"},threadReplyServerId:{id:32,access:"threadReply.messageServerId"},threadReplyClientId:{id:33,access:"threadReply.messageClientId"},threadRootSenderId:{id:34,access:"threadRoot.senderId"},threadRootReceiverId:{id:35,access:"threadRoot.receiverId"},threadRootTime:{id:36,access:"threadRoot.createTime",retType:"number"},threadRootServerId:{id:37,access:"threadRoot.messageServerId"},threadRootClientId:{id:38,access:"threadRoot.messageClientId"},isDeleted:{id:39,converter:zt,retType:"boolean"},callbackExtension:40,subType:{id:41,retType:"number"},antispamCheating:{id:42,access:"antispamConfig.antispamCheating"},routeEnvironment:{id:43,access:"routeConfig.routeEnvironment"},antispamExtension:{id:44,access:"antispamConfig.antispamExtension"},antispamResult:45,__clientExt:{id:46,converter:Yt,retConverter:Jt},robotFunction:{id:47,access:"robotConfig.function"},robotTopic:{id:48,access:"robotConfig.topic"},robotCustomContent:{id:49,access:"robotConfig.customContent"},robotAccount:{id:50,access:"robotConfig.accountId"},_conversationOnlineSyncNotify:{id:51},_conversationOnlineSyncData:{id:52},aiAgentMsgDirection:{id:55,access:"aiConfig.aiStatus",retAccess:"aiConfig.aiStatus",retType:"number"},aiAgentAccount:{id:56,access:"aiConfig.accountId",retAccess:"aiConfig.accountId"},aiAgentContent:{id:57,access:"aiConfig.content",converter:Yt,retConverter:He},aiAgentMessages:{id:58,access:"aiConfig.messages",converter:Yt,retConverter:He},aiAgentPromptVariables:{id:59,access:"aiConfig.promptVariables",retConverter:He},aiAgentModelConfigParams:{id:60,access:"aiConfig.modelConfigParams",converter:Yt,retConverter:He},errorCode:{id:61,access:"messageStatus.errorCode",converter:He,retType:"number"},modifyTime:{id:62,retType:"number"},modifyAccountId:63,aiStream:{id:65,access:"aiConfig.aiStream",retAccess:"streamConfig.isStream",converter:zt,retConverter:Kt},aiRAGs:{id:66,access:"aiConfig.aiRAGs",retConverter:function(e){try{var t=JSON.parse(e);return t&&t.length>0?t.map(e=>(e.description=e.desc,delete e.desc,e)):[]}catch(n){return[]}}},aiStreamStatus:{id:67,access:"streamConfig.status",retType:"number"},historyEnabled:{id:100,access:"messageConfig.historyEnabled",converter:zt,retType:"boolean"},roamingEnabled:{id:101,access:"messageConfig.roamingEnabled",converter:zt,retType:"boolean"},onlineSyncEnabled:{id:102,access:"messageConfig.onlineSyncEnabled",converter:zt,retType:"boolean"},routeEnabled:{id:105,access:"routeConfig.routeEnabled",converter:zt,retType:"boolean"},isInBlackList:{id:106,access:"isInBlackList",converter:zt,retType:"boolean"},pushEnable:{id:107,access:"pushConfig.pushEnabled",converter:zt,retType:"boolean"},offlineEnabled:{id:108,access:"messageConfig.offlineEnabled",converter:zt,retType:"boolean"},unreadEnabled:{id:109,access:"messageConfig.unreadEnabled",converter:zt,retType:"boolean"},pushNickEnabled:{id:110,access:"pushConfig.pushNickEnabled",converter:zt,retType:"boolean"},msgAckSnapshot:{id:112,retType:"number"},receiverIds:{id:154,access:"targetConfig.receiverIds",converter:Yt,retConverter:()=>{}},inclusive:{id:155,access:"targetConfig.inclusive",converter:e=>e?1:2,retConverter:()=>{}},newMemberVisible:{id:156,access:"targetConfig.newMemberVisible",converter:e=>e?1:2,retConverter:()=>{}}},dd=Wt(ld),ud={conversationType:{id:1,access:"messageRefer.conversationType",retType:"number"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},messageServerId:{id:4,access:"messageRefer.messageServerId"},messageClientId:{id:5,access:"messageRefer.messageClientId"},createTime:{id:6,access:"messageRefer.createTime",retType:"number"},deleteTime:{id:7,retType:"number"},serverExtension:8};Wt(ud);var pd={version:1,md5:2,nosurl:3,thesaurus:4},hd={createTime:{id:0,retType:"number"},sysMsgType:1,receiverId:2,senderId:3,postscript:4,attach:5,pushContent:8,pushPayload:9,messageClientId:10,messageServerId:11,deleteMsgCreatetime:{id:14,retType:"number"},opeAccount:16,env:21,callbackExtension:22},gd={receiverId:0,messageServerId:1,readCount:{id:100,retType:"number"},unreadCount:{id:101,retType:"number"},messageClientId:102,latestReadAccount:103},md={v2BatchMarkRead:{sid:4,cid:5,service:ad,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},v2SendP2pMessage:{sid:30,cid:1,service:ad,params:[{type:"Property",name:"tag",reflectMapper:ld}],response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},onMsg:{sid:7,cid:2,service:ad,response:[{type:"Property",name:"msg",reflectMapper:Wt(ld)}]},syncOfflineMsgs:{sid:4,cid:4,service:ad,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(ld)}]},syncRoamingMsgs:{sid:4,cid:9,service:ad,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(ld)}]},v2SendP2PMessageReceipt:{sid:30,cid:11,service:ad,params:[{type:"Property",name:"tag",reflectMapper:ld}],response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},v2RevokeMessage:{sid:30,cid:13,service:ad,params:[{type:"Property",name:"tag",reflectMapper:hd}]},v2DeleteMessage:{sid:30,cid:23,service:ad,params:[{type:"Property",name:"tag",reflectMapper:ud}],response:[{type:"Long",name:"timetag"}]},v2DeleteMessages:{sid:30,cid:24,service:ad,params:[{type:"PropertyArray",name:"tag",reflectMapper:ud}],response:[{type:"Long",name:"timetag"}]},v2SendTeamMessage:{sid:31,cid:2,service:ad,params:[{type:"Property",name:"tag",reflectMapper:ld}],response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},v2SendTeamMessageReceipts:{sid:31,cid:28,service:ad,params:[{type:"PropertyArray",name:"tag",reflectMapper:gd}],response:[{type:"PropertyArray",name:"tag",reflectMapper:Wt(gd)}]},v2SendSuperTeamMessage:{sid:32,cid:2,service:ad,params:[{type:"Property",name:"tag",reflectMapper:ld}],response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},v2RevokeSuperTeamMessage:{sid:32,cid:17,service:ad,params:[{type:"Property",name:"tag",reflectMapper:hd}]},syncP2PMessagReceipts:{sid:4,cid:12,service:ad,response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(ld)}]},onP2PMessageReceipts:{sid:7,cid:12,service:ad,response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},v2GetTeamMessageReceipts:{sid:31,cid:29,service:ad,params:[{type:"PropertyArray",name:"tag",reflectMapper:gd}],response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(gd)}]},v2GetTeamMessageReceiptDetail:{sid:31,cid:30,service:ad,params:[{type:"Property",name:"tag",reflectMapper:gd,select:["receiverId","messageServerId"]}],response:[{type:"Property",name:"data",reflectMapper:Wt(gd)},{type:"StrArray",name:"readAccountList"},{type:"StrArray",name:"unreadAccountList"}]},onTeamMessageReceipts:{sid:8,cid:31,service:ad,response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(gd)}]},onRevokeMessage:{sid:7,cid:14,service:ad,response:[{type:"Property",name:"data",reflectMapper:Wt(hd)}]},syncRevokeMessage:{sid:7,cid:15,service:ad,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(hd)}]},syncOnDeleteMessages:{sid:4,cid:21,service:ad,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(ud)}]},onDeleteMessage:{sid:7,cid:123,service:ad,response:[{type:"Property",name:"data",reflectMapper:Wt(ud)}]},onDeleteMessages:{sid:7,cid:124,service:ad,response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(ud)}]},v2DownloadLocalAntiSpamVocabs:{sid:29,cid:17,service:ad,params:[{type:"Property",name:"tag",reflectMapper:pd}],response:[{type:"Property",name:"data",reflectMapper:Wt(pd)}]},v2MessageP2pModify:{sid:30,cid:31,service:ad,params:[{type:"Property",name:"tag",reflectMapper:ld}],response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},v2MessageTeamModify:{sid:31,cid:37,service:ad,params:[{type:"Property",name:"tag",reflectMapper:ld}],response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},v2MessageSuperTeamModify:{sid:32,cid:38,service:ad,params:[{type:"Property",name:"tag",reflectMapper:ld}],response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},v2MessageOnModified:{sid:7,cid:33,service:ad,response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},v2MessageSyncModified:{sid:4,cid:27,service:ad,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(ld)},{type:"Long",name:"time"}]},v2MessageSuperTeamSyncModified:{sid:4,cid:28,service:ad,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(ld)},{type:"Long",name:"time"}]}};function fd(e){return 1===e?0:2===e?1:3===e?5:void 0}function vd(e){var t=parseInt(e);return 0===t?1:1===t?2:5===t?3:0}var yd="V2NIMNotificationService",_d={"30_7":"v2SendCustomNotification","32_16":"v2SendCustomNotificationWithSuperTeam","7_3":"onSysNotification","21_19":"onSysNotification","4_6":"v2SyncOfflineSysNotifications","4_18":"v2SyncOfflineSysNotifications","7_14":"v2NotificationRevoke","21_18":"v2NotificationRevoke","21_117":"v2NotificationRevoke","4_19":"v2NotificationSyncRevoke","7_15":"v2NotificationSyncRevoke","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg"},Id={timestamp:{id:0,retType:"number"},type:{id:1,retType:"number"},receiverId:2,senderId:3,postscript:4,content:5,idServer:6,offlineEnabled:{id:7,converter:zt,retConverter:function(e,t){return"0"!==t[6]&&!!parseInt(e)},access:"notificationConfig.offlineEnabled"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"},deletedIdClient:10,deletedIdServer:11,antispamEnabled:{id:12,converter:zt,retType:"boolean",access:"antispamConfig.antispamEnabled"},antispamCustomNotification:{id:13,access:"antispamConfig.antispamCustomNotification"},deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:e=>{if(101===e.type&&e["pushConfig.forcePush"])return"#%@all@%#"},converter:(e,t)=>{if(t["pushConfig.forcePush"])return e?JSON.stringify(e):"#%@all@%#"},retConverter(e){if("#%@all@%#"!==e&&e)try{return JSON.parse(e)}catch(t){return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,converter:zt,retType:"boolean",access:"pushConfig.forcePush"},routeEnvironment:{id:21,access:"routeConfig.routeEnvironment"},callbackExt:22,clientNotificationId:{id:23,access:"notificationConfig.clientNotificationId"},conversationOnlineSyncNotify:24,conversationOnlineSyncData:25,routeEnabled:{id:105,converter:zt,retType:"boolean",access:"routeConfig.routeEnabled"},pushEnabled:{id:107,converter:zt,retType:"boolean",access:"pushConfig.pushEnabled"},unreadEnabled:{id:109,converter:zt,retType:"boolean",access:"notificationConfig.unreadEnabled"},pushNickEnabled:{id:110,converter:zt,retType:"boolean",access:"pushConfig.pushNickEnabled"}},Td={id:1,senderId:2,timestamp:{id:4,retType:"number"},content:5},Sd={v2SendCustomNotification:{sid:30,cid:7,service:yd,params:[{type:"Property",name:"tag",reflectMapper:Id}]},v2SendCustomNotificationWithSuperTeam:{sid:32,cid:16,service:yd,params:[{type:"Property",name:"tag",reflectMapper:Id}]},onSysNotification:{sid:7,cid:3,service:yd,response:[{type:"Property",name:"data",reflectMapper:Wt(Id)}]},syncBroadcastMsg:{sid:4,cid:16,service:yd,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Td)}]},onBroadcastMsg:{sid:7,cid:17,service:yd,response:[{type:"Property",name:"data",reflectMapper:Wt(Td)}]},v2SyncOfflineSysNotifications:{sid:4,cid:9,service:yd,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Id)}]},v2NotificationRevoke:{sid:7,cid:14,service:yd,response:[{type:"Property",name:"data",reflectMapper:Wt(Id)}]},v2NotificationSyncRevoke:{sid:7,cid:15,service:yd,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Id)},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]}},Ed="YSFService",Md={"4_5":"ysfBatchMarkRead","101_1":"ysfSendMessage","101_2":"ysfOnMsg","4_100":"ysfSyncOfflineMsgs","101_3":"ysfOnSysNotification","101_7":"ysfSendCustomNotification","4_101":"ysfSyncSysNotification"},bd={ysfBatchMarkRead:{sid:4,cid:5,service:Ed,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},ysfSendMessage:{sid:101,cid:1,service:Ed,params:[{type:"Property",name:"tag",reflectMapper:ld}],response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},ysfOnMsg:{sid:101,cid:2,service:Ed,response:[{type:"Property",name:"data",reflectMapper:Wt(ld)}]},ysfSyncOfflineMsgs:{sid:4,cid:100,service:Ed,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(ld)}]},ysfOnSysNotification:{sid:101,cid:3,service:Ed,response:[{type:"Property",name:"data",reflectMapper:Wt(Id)}]},ysfSendCustomNotification:{sid:101,cid:7,service:Ed,params:[{type:"Property",name:"tag",reflectMapper:Id}]},ysfSyncSysNotification:{sid:4,cid:101,service:Ed,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Id)}]}},Cd={content:{type:"string",allowEmpty:!1},params:{type:"object",required:!1,rules:{notificationConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forcePushContent:{type:"string",required:!1},forcePushAccountIds:{type:"array",required:!1,itemType:"string"}}},antispamConfig:{type:"object",required:!1,rules:{antispamEnabled:{type:"boolean",required:!1},antispamCustomNotification:{type:"string",required:!1}}},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}}}}};class Ad{constructor(e){this.core=e}generateNotificationTag(e,t,n={}){var r=this.core.V2NIMConversationIdUtil.parseConversationType(e),i=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),o=Date.now(),s={1:100,2:101,3:103};return Object.assign(Object.assign({},n),{notificationConfig:Object.assign({unreadEnabled:!0,offlineEnabled:!0},null==n?void 0:n.notificationConfig),pushConfig:Object.assign({pushEnabled:!0,pushNickEnabled:!0},null==n?void 0:n.pushConfig),antispamConfig:Object.assign({antispamEnabled:!0},null==n?void 0:n.antispamConfig),routeConfig:Object.assign({routeEnabled:!0},null==n?void 0:n.routeConfig),timestamp:o,type:s[r],receiverId:i,content:t})}}function Od(e){var t="object"==typeof e?e:void 0,n="string"==typeof e?e:void 0;if(!t&&!n)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect file and path"}});if("string"==typeof n)if(0===n.indexOf("nim-external")){var r=document.getElementById(n);if(!(r&&r.files&&r.files[0]))throw new pe({code:le.V2NIM_ERROR_CODE_FILE_NOT_FOUND,detail:{reason:`getFileOrPath::file not exist: ${n}`}});t=r.files[0]}else if("BROWSER"===we.platform)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:`getFileOrPath::incorrect path: ${n}`}});if("object"==typeof t&&void 0===t.size)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::file no size"}});return{file:t,path:n}}var Rd={attachment:{type:"object",rules:{url:{type:"string",allowEmpty:!1}}},thumbSize:{type:"object",rules:{width:{type:"number",required:!1,min:0},height:{type:"number",required:!1,min:0}}}};class Nd extends An{constructor(e){super("V2NIMStorageUtil",e),this.core=e}imageThumbUrl(e,t){return e+`?imageView&thumbnail=${t}z${t}`}videoCoverUrl(e,t){return e+`?vframe&offset=${t}`}getImageThumbUrl(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2();var n=e;Te(Rd,{attachment:n,thumbSize:t},"",!0),t.width=t.width||0,t.height=t.height||0,0===t.width&&0===t.height&&(t.width=150);var r=n.url;try{r=yield this.core.V2NIMStorageService.shortUrlToLong(n.url)}catch(i){this.core.logger.warn("shortUrlToLong error:",i)}return{url:this.core.cloudStorage.getThumbUrl(r,t)}})}getVideoCoverUrl(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2();var n=e;Te(Rd,{attachment:n,thumbSize:t},"",!0),t.width=t.width||0,t.height=t.height||0,0===t.width&&0===t.height&&(t.width=150);var r=n.url;try{r=yield this.core.V2NIMStorageService.shortUrlToLong(n.url)}catch(i){this.core.logger.warn("shortUrlToLong error:",i)}return{url:this.core.cloudStorage.getVideoCoverUrl(r,t)}})}}class wd extends An{constructor(e){super("V2NIMStorageService",e),this.sceneMap={nim_default_profile_icon:{sceneName:"nim_default_profile_icon",expireTime:0},nim_default_im:{sceneName:"nim_default_im",expireTime:0},nim_system_nos_scene:{sceneName:"nim_system_nos_scene",expireTime:0},nim_security:{sceneName:"nim_security",expireTime:0}},this.uploadingMessageInfo={},this.core=e,this.core._registerDep(Po,"cloudStorage"),this.core._registerDep(Nd,"V2NIMStorageUtil")}addCustomStorageScene(e,t){return this.checkV2(),Te({sceneName:{type:"string",allowEmpty:!1},expireTime:{type:"number",min:0}},{sceneName:e,expireTime:t},"",!0),this.sceneMap[e]={sceneName:e,expireTime:t},{sceneName:e,expireTime:t}}getStorageSceneList(){return this.checkV2(),Object.values(this.sceneMap)}getStorageScene(e){return e&&this.sceneMap[e]||this.sceneMap.nim_default_im}hasStorageScene(e){return void 0!==this.sceneMap[e]}createUploadFileTask(e){if(this.checkV2(),"string"==typeof e.fileObj&&0===e.fileObj.indexOf("nim-external")){var t=document.getElementById(e.fileObj);t&&t.files&&t.files[0]&&(e.fileObj=t.files[0])}return{taskId:Ue(),uploadParams:e}}uploadFile(e,t){return Ce(this,void 0,void 0,function*(){return this.checkV2(),Te({taskId:{type:"string",allowEmpty:!1}},e,"fileTask",!0),(yield this._uploadFile(e,t))[0]})}uploadFileWithMetaInfo(e,t){return Ce(this,void 0,void 0,function*(){return this.checkV2(),Te({taskId:{type:"string",allowEmpty:!1}},e,"fileTask",!0),function(e){var{url:t,name:n,size:r,ext:i,md5:o,h:s,w:a,orientation:c,dur:l,audioCodec:d,videoCodec:u,container:p}=e;return JSON.parse(JSON.stringify({url:t,name:n,size:r,ext:i,md5:o,height:s,width:a,orientation:c,duration:l,audioCodec:d,videoCodec:u,container:p}))}((yield this._uploadFile(e,t))[1])})}_uploadFile(e,t,n){var r;return Ce(this,void 0,void 0,function*(){if(!this.core.cloudStorage||!this.core.cloudStorage.uploadFile)throw new Error('Service "cloudStorage" does not exist');var{uploadParams:i,taskId:o}=e,{file:s,path:a}=Od(i.fileObj),{fileType:c}=n||{};if(this.uploadingMessageInfo[o])throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST,detail:{reason:"V2NIMStorageService.uploadFile: repeat upload"}});try{var l={};s?l.file=s:a&&(0===(null==a?void 0:a.indexOf("nim-external"))?l.fileInput=a:l.filePath=a);var d=this.getStorageScene(i.sceneName);if(l.nosScenes=d.sceneName,l.nosSurvivalTime=d.expireTime,l.type=1===c?"image":2===c?"audio":3===c?"video":"file",l.file&&this.core.pluginMap["browser-md5-file"]){var u=yield this.getFileMd5(this.core.pluginMap["browser-md5-file"],o,l.file);l.md5=u}l.onUploadProgress=e=>{"function"==typeof t&&t(Math.round(100*e.percentage))},l.onUploadStart=e=>{var t;if(null===(t=this.uploadingMessageInfo[o])||void 0===t?void 0:t.abort)return e.abort(),void delete this.uploadingMessageInfo[o];this.uploadingMessageInfo[o]={abort:!1,task:e}},this.uploadingMessageInfo[o]={abort:!1};var p=yield this.core.cloudStorage.uploadFile(l);if(null===(r=this.uploadingMessageInfo[o])||void 0===r?void 0:r.abort)throw new pe({code:le.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}});return delete this.uploadingMessageInfo[o],[p.url,p]}catch(h){throw delete this.uploadingMessageInfo[o],this.core.logger.error("sendFile:: upload File error or abort.",h),h}})}cancelUploadFile(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),yield this._cancelUploadFile(e.taskId)})}_cancelUploadFile(e){return Ce(this,void 0,void 0,function*(){this.checkV2();var t=this.uploadingMessageInfo[e];if(null==t?void 0:t.task)try{this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task exist"),yield t.task.abort(),delete this.uploadingMessageInfo[e]}catch(n){delete this.uploadingMessageInfo[e],this.core.logger.error("cancelMessageAttachmentUpload::abort error.",n)}else{if(!t)throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"V2NIMStorageService.cancelUploadFile: uploadInfo not exist"}});this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task not exist"),t.abort=!0}})}getFileMd5(e,t,n){return Ce(this,void 0,void 0,function*(){return new Promise((r,i)=>{var o,s=new e;(null===(o=this.uploadingMessageInfo[t])||void 0===o?void 0:o.abort)?i(new pe({code:le.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}})):this.uploadingMessageInfo[t]={abort:!1,task:s};try{s.md5(n,(e,t)=>{"aborted"===e?i(new pe({code:le.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:e}})):e?i(new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error in callback",rawError:e}})):r(t)})}catch(a){i(new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error",rawError:a}}))}})})}shortUrlToLong(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.core.cloudStorage.getOriginUrl(e)})}getImageThumbUrl(e,t){return Ce(this,void 0,void 0,function*(){return this.core.V2NIMStorageUtil.getImageThumbUrl(e,t)})}getVideoCoverUrl(e,t){return Ce(this,void 0,void 0,function*(){return this.core.V2NIMStorageUtil.getVideoCoverUrl(e,t)})}}class Pd extends An{constructor(e){super("V2NIMMessageCreator",e),this.name="V2NIMMessageCreator",this.defaultNosSceneName="nim_default_im",this.core=e}createMessage(e,t){return Object.assign(Object.assign(Object.assign({messageClientId:Ue(),messageType:e,createTime:this.core.timeOrigin.getNTPTime(),sendingState:0,messageStatus:{errorCode:200},messageSource:0,isSelf:!0},t),t.attachment?{attachment:Object.assign(Object.assign({},t.attachment),{raw:id(e,t.attachment)})}:{}),{senderId:"",receiverId:"",conversationType:0,conversationId:"",messageServerId:"",messageConfig:Object.assign({unreadEnabled:!0,roamingEnabled:!0,readReceiptEnabled:!1,lastMessageUpdateEnabled:!0,historyEnabled:!0,onlineSyncEnabled:!0,offlineEnabled:!0},t.messageConfig),pushConfig:Object.assign({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},t.pushConfig),routeConfig:Object.assign({routeEnabled:!0},t.routeConfig),antispamConfig:Object.assign({antispamEnabled:!0},t.antispamConfig)})}createTextMessage(e){return this.checkV2(),Te({text:{type:"string",allowEmpty:!1}},{text:e},"",!0),this.createMessage(0,{text:e})}createImageMessage(e,t,n,r,i){this.checkV2(),Te(Rl,{name:t,sceneName:n,width:r,height:i},"",!0);var o=this.createGenericFileMessageAttachment(e,t,n,void 0,r,i,"jpeg");return this.createMessage(1,{attachment:o,attachmentUploadState:0})}createAudioMessage(e,t,n,r){this.checkV2(),Te(Al,{name:t,sceneName:n,duration:r},"",!0);var i=this.createGenericFileMessageAttachment(e,t,n,r,void 0,void 0,"aac");return this.createMessage(2,{attachment:i,attachmentUploadState:0})}createVideoMessage(e,t,n,r,i,o){this.checkV2(),Te(Ol,{name:t,sceneName:n,duration:r,width:i,height:o},"",!0);var s=this.createGenericFileMessageAttachment(e,t,n,r,i,o,"mp4");return this.createMessage(3,{attachment:s,attachmentUploadState:0})}createFileMessage(e,t,n){this.checkV2(),Te(Cl,{name:t,sceneName:n},"",!0);var r=this.createGenericFileMessageAttachment(e,t,n,void 0,void 0,void 0,"txt");return this.createMessage(6,{attachment:r,attachmentUploadState:0})}createGenericFileMessageAttachment(e,t,n,r,i,o,s){if(n=n||this.defaultNosSceneName,!this.core.V2NIMStorageService.hasStorageScene)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMStorageService not exist"}});if(!this.core.V2NIMStorageService.hasStorageScene(n))throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sceneName: "+n+" has not been added"}});var{file:a,path:c}=Od(e),l=Object.assign(Object.assign(Object.assign({name:t,uploadState:0,sceneName:n||this.defaultNosSceneName},r?{duration:r}:{}),i?{width:i}:{}),o?{height:o}:{});if(a){var d=a.name.lastIndexOf("."),u=-1===d?a.name:a.name.substring(0,d);l.name=l.name||u,l.size=a.size,l.ext=`.${We(a.name)||We(t||"")||s}`}else if(c){var p=c.lastIndexOf("/"),h=c.lastIndexOf("."),g=-1===h?c.substring(p+1):c.substring(p+1,h);l.name=l.name||g,l.ext=`.${We(c)||We(t||"")||s}`}return l=JSON.parse(JSON.stringify(l)),c?l.path=c:a&&(l.file=a),l}createLocationMessage(e,t,n){return this.checkV2(),Te({latitude:{type:"number",allowEmpty:!1},longitude:{type:"number",allowEmpty:!1},address:{type:"string",allowEmpty:!1}},{latitude:e,longitude:t,address:n},"",!0),this.createMessage(4,{attachment:{latitude:e,longitude:t,address:n}})}createCustomMessage(e,t){return this.checkV2(),Te({text:{type:"string"}},{text:e},"",!0),Te({rawAttachment:{type:"string"}},{rawAttachment:t},"",!0),this.createMessage(100,{text:e,attachment:{raw:t}})}createCustomMessageWithAttachment(e,t){return this.checkV2(),Te({raw:{type:"string"}},e,"attachment",!0),Te({subType:{type:"number",min:0,required:!1}},{subType:t},"",!0),this.createMessage(100,t?{attachment:e,subType:t}:{attachment:e})}createCallMessage(e,t,n,r,i){return this.checkV2(),Te({type:{type:"number",allowEmpty:!1}},{type:e},"",!0),Te({channelId:{type:"string",allowEmpty:!1}},{channelId:t},"",!0),Te({status:{type:"number",allowEmpty:!1}},{status:n},"",!0),Te({durations:{type:"array",allowEmpty:!1}},{durations:r},"",!0),this.createMessage(12,{text:i||"",attachment:{type:e,channelId:t,durations:r,status:n}})}createForwardMessage(e){if(this.checkV2(),!e||[11,5,7,10].includes(e.messageType))return null;var t={messageClientId:Ue(),messageType:e.messageType};return e.text&&(t.text=e.text),e.attachment&&(t.attachment=e.attachment),e.attachment&&"uploadState"in e.attachment&&(t.attachmentUploadState=e.attachment.uploadState),this.createMessage(e.messageType,t)}createTipsMessage(e){return this.checkV2(),Te({text:{type:"string",allowEmpty:!1}},{text:e},"",!0),this.createMessage(10,{text:e})}}class kd{constructor(){this.name="V2NIMMessageAttachmentCreator"}createLocationMessageAttachment(e,t,n){return{latitude:"number"==typeof e?e:0,longitude:"number"==typeof t?t:0,address:"string"==typeof n?n:""}}createCustomMessageAttachment(e){return{raw:"string"==typeof e?e:""}}}class Ld{constructor(e){this.config={enable:!1},this.name="V2NIMClientAntispamUtil",this.core=e}setOptions(e){this.config=Object.assign(this.config,e)}reset(e){"destroy"===e&&(this.vocabInfo=void 0)}downloadLocalAntiSpamVocabs(){return Ce(this,void 0,void 0,function*(){if(this.config.enable&&!this.vocabInfo)try{var e=yield this.core.sendCmd("v2DownloadLocalAntiSpamVocabs",{tag:{version:0,md5:""}});this.vocabInfo=Object.assign(Object.assign({},e.content.data),{thesaurus:JSON.parse(e.content.data.thesaurus).thesaurus})}catch(t){this.core.logger.warn("V2NIMLocalAntispamUtil::downloadLocalAntiSpamVocabs error",t)}})}checkTextAntispam(e,t="**"){if(!this.config.enable)return{operateType:0,replacedText:e};if(Te({text:{type:"string",required:!0,allowEmpty:!1},replace:{type:"string"}},{text:e,replace:t},"",!0),!this.vocabInfo)return{operateType:0,replacedText:e};for(var n=e,r=0;r<this.vocabInfo.thesaurus.length;r++){var i=this.filterContent(n,this.vocabInfo.thesaurus[r],t);if(n=i.replacedText,2===i.operateType||3===i.operateType)return i}return{operateType:n===e?0:1,replacedText:n}}filterContent(e,t,n){for(var r=0;r<t.keys.length;r++){var i=t.keys[r],o=i.match||t.match,s=i.operate||t.operate,a=void 0;try{a=this.matchContent(e,i.key,o,s,n)}catch(c){}if(a&&(e=a.replacedText,2===a.operateType||3===a.operateType))return a}return{operateType:1,replacedText:e}}matchContent(e,t,n,r,i){var o=!1,s=null;if(1===n){if(e.indexOf(t)>=0){o=!0;var a=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");s=new RegExp(a,"g")}}else 2===n&&(s=new RegExp(t,"g")).test(e)&&(o=!0);if(o&&s)switch(r){case 1:return{operateType:1,replacedText:e.replace(s,i)};case 2:return{operateType:2,replacedText:e};case 3:return{operateType:3,replacedText:e}}return{operateType:0,replacedText:e}}}class xd extends An{constructor(e){super("YSFService",e),this.core._registerDep(Wc,"V2NIMConversationIdUtil"),this.core._registerDep(Pd,"V2NIMMessageCreator"),this.core._registerDep(kd,"V2NIMMessageAttachmentCreator"),this.core._registerDep(Ld,"V2NIMClientAntispamUtil"),this.core._registerDep(wd,"V2NIMStorageService"),this.sendUtil=new Vd(this.core,this),this.fileUtil=new sd(this.core),this.model=new zc,this.notificationUtil=new Ad(this.core),Gt({cmdMap:Md,cmdConfig:bd})}emit(e,...t){var n,r=`${this.name}::emit ${e.toString()}`;if("onSendMessage"===e){var i=t[0];this.logger.log(`${r}`,`${i.messageClientId}/${i.messageServerId};createTime:${i.createTime};`,`sendingState:${i.sendingState};attachmentUploadState:${i.attachmentUploadState||0};messageStatus:${null===(n=i.messageStatus)||void 0===n?void 0:n.errorCode}`)}else if("onReceiveMessages"===e){var o=t[0];this.logger.log(`${r}`,o.map(e=>`${e.messageClientId}/${e.messageServerId};createTime:${e.createTime}`))}else if("onReceiveCustomNotifications"===e){var s=t[0];this.logger.log(`${r}`,s.map(e=>`sender:${e.senderId};receiver:${e.receiverId};ctype:${e.conversationType};time:${e.timestamp}`))}else this.logger.log(`${r}`,...t);return super.emit(e,...t)}sendMessage(e,t,n={},r){return Ce(this,void 0,void 0,function*(){Te({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||Ue(),Te(il,{conversationId:t,message:e,params:n},"",!0),Ee(this.core.account,t);var i=this.core.timeOrigin.getTimeNode(),{messageBeforeSend:o,clientAntispamResult:s,hiddenParams:a}=this.sendUtil.prepareMessage(e,t,n),c=yield this.sendUtil.doSendMessage({apiCallingTimeNode:i,messageBeforeSend:o,clientAntispamResult:s,hiddenParams:a,progress:r});return c.message.senderId===c.message.receiverId&&this.markMsgsAck([c.message]),c})}sendCustomNotification(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Ee(this.core.account,e),Te(Cd,{content:t,params:n},"",!0);var r=this.notificationUtil.generateNotificationTag(e,t,n);r.type=100,yield this.core.sendCmd("ysfSendCustomNotification",{tag:r})})}sendMessageFn(e){}cancelMessageAttachmentUpload(e){return this.fileUtil.cancelMessageAttachmentUpload(e)}markMsgsAck(e){if(e&&e.length>0){var t=e.map(e=>e.messageServerId).filter(e=>e&&"0"!==e);0!==t.length&&this.core.sendCmd("ysfBatchMarkRead",{sid:101,cid:2,ids:t})}}markNotificationAck(e){if(e&&e.length>0){var t=e.map(e=>e.idServer).filter(e=>e&&"0"!==e);0!==t.length&&this.core.sendCmd("ysfBatchMarkRead",{sid:101,cid:3,ids:t})}}ysfOnMsgHandler(e){var t=Ke(e,e.content.data,"messageServerId"),n=Jl(this.core,t);delete n.__clientExt,this.emit("onReceiveMessages",[n]),this.model.upsertMessages([n]),this.markMsgsAck([n])}ysfSyncOfflineMsgsHandler(e){var t=e.content.datas;t=t.map(e=>Jl(this.core,e)),this.markMsgsAck(t),this.emit("onReceiveMessages",t),this.model.upsertMessages(t)}ysfOnSysNotificationHandler(e){var t=Ke(e,e.content.data,"idServer");this.markNotificationAck([t]);var n=this.processSystemNotification(t);n&&this.emit("onReceiveCustomNotifications",[n])}processSystemNotification(e){var t=Object.assign(Object.assign({},e),{conversationType:1});return delete t.type,t}ysfSyncSysNotificationHandler(e){this.markNotificationAck(e.content.datas);var t=e.content.datas.sort((e,t)=>e.timestamp-t.timestamp).map(e=>this.processSystemNotification(e)).filter(e=>e);t&&this.emit("onReceiveCustomNotifications",t)}}class Vd{constructor(e,t){this.uploadingMessageInfo={},this.core=e,this.service=t}prepareMessage(e,t,n,r){var i=this.checkIfResend(e),o=this.generateSendMessage({message:e,params:n,resend:i,conversationId:t,replyMessage:r}),s=Object.assign({},n.targetConfig?{targetConfig:n.targetConfig}:{}),{clientAntispamResult:a,text:c}=this.checkIfAntispam(n,o);return o.text=c,o.clientAntispamHit=!!a&&3===a.operateType,{messageBeforeSend:o,clientAntispamResult:a,hiddenParams:s}}checkIfAntispam(e,t){var n,r=t.text;if(e.clientAntispamEnabled&&(0===t.messageType||10===t.messageType))if(1===(n=this.core.V2NIMClientAntispamUtil.checkTextAntispam?this.core.V2NIMClientAntispamUtil.checkTextAntispam(t.text||"",e.clientAntispamReplace):{operateType:0,replacedText:""}).operateType)r=n.replacedText;else if(2===n.operateType)throw this.service.emit("onSendMessage",Object.assign(Object.assign({},t),{sendingState:2,messageStatus:{errorCode:le.V2NIM_ERROR_CODE_CLIENT_ANTISPAM}})),new pe({code:le.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:n,text:r}}doMsgReceiveReport(e,t){if(e.senderId!==this.core.account){var n=Ve(e,"__clientExt.statistics.apiCallingTime")||0,r=Ve(e,"__clientExt.statistics.sendTime")||0,i=Ve(e,"__clientExt.statistics.attachUploadDuration")||0,o=this.core.timeOrigin.getNTPTime(),s=e.createTime,a=this.core.timeOrigin.checkNodeReliable(t.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(t.__receiveTimeNode):o;this.core.reporter.report("msgReceive",{msgId:e.messageServerId,clientId:e.messageClientId,serverTime:e.createTime,receiveTime:a,fromAccid:1===e.conversationType?e.senderId:"",toAccid:e.receiverId,type:fd(e.conversationType),tid:1===e.conversationType?"":e.receiverId,apiCallingTime:n,sendTime:r,attachUploadDuration:i,callbackTime:o,preHandleTime:o,result:200,failReason:"",rt:o-s})}}checkIfResend(e){var t=this.service.model.getMessageById(e.messageClientId),n=!1;if("messageServerId"in e&&"0"!==e.messageServerId&&""!==e.messageServerId)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});if(t&&"messageServerId"in t&&"0"!==t.messageServerId&&""!==t.messageServerId)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});return t&&(n=!0),n}doSendMessage(e){var t;return Ce(this,void 0,void 0,function*(){var n,r,{apiCallingTimeNode:i,messageBeforeSend:o,clientAntispamResult:s,hiddenParams:a,progress:c}=e,l={},d=this.service instanceof xd;if(d)n="ysfSendMessage";else if(1===o.conversationType)n="v2SendP2pMessage";else if(2===o.conversationType)n="v2SendTeamMessage";else{if(3!==o.conversationType)throw new ge({detail:{reason:`conversationType: ${o.conversationType} is not supported`}});n="v2SendSuperTeamMessage"}if(this.service.sendMessageFn(o),!d&&this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",o),!o.attachment||!("uploadState"in o.attachment)||o.attachment.url||0!==o.attachment.uploadState&&2!==o.attachment.uploadState)this.service.emit("onSendMessage",o);else{var u=Date.now();try{o.attachmentUploadState=3,o.attachment.uploadState=3,this.service.emit("onSendMessage",o),yield this.service.fileUtil.doSendFile(o,c),o.attachmentUploadState=1,o.attachment.uploadState=1,this.service.emit("onSendMessage",o)}catch(m){throw o.attachmentUploadState=2,o.attachment.uploadState=2,o.sendingState=2,o.messageStatus={errorCode:m.code||le.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",o),l.attachUploadDuration=Date.now()-u,this.doSendMessageFailed(i,l,o,m),m}l.attachUploadDuration=Date.now()-u}this.core.timeOrigin.checkNodeReliable(i)&&(l.apiCallingTime=this.core.timeOrigin.getNTPTime(i),l.sendTime=this.core.timeOrigin.getNTPTime(),o.__clientExt={statistics:l});try{r=yield this.core.sendCmd(n,{tag:Object.assign({},o,a)})}catch(m){throw this.doSendMessageFailed(i,l,o,m),o.sendingState=2,o.messageStatus={errorCode:m.code||le.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",o),m}var p=Ve(r,"content.data.errorCode"),h=Object.assign(Object.assign(Object.assign(Object.assign({},o),r.content.data),o.aiConfig?{aiConfig:Object.assign(Object.assign({},o.aiConfig),(null===(t=r.content.data)||void 0===t?void 0:t.aiConfig)||{})}:{}),{sendingState:1,messageStatus:{errorCode:p&&200!==p?p:200}});this.service.sendMessageFn(h),!d&&this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",h),this.doMsgSendReport(i,l,o);var g=h.antispamResult;return g&&(h.messageStatus.errorCode=le.V2NIM_ERROR_CODE_SERVER_ANTISPAM),delete h.antispamResult,this.service.emit("onSendMessage",h),Object.assign(Object.assign({message:h},g?{antispamResult:g}:{}),s?{clientAntispamResult:s}:{})})}doSendMessageFailed(e,t,n,r){var i=Object.assign(Object.assign({},n),{sendingState:2});this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",i),this.service.sendMessageFn(i),this.doMsgSendReport(e,t,n,r)}doMsgSendReport(e,t,n,r){t.apiCallingTime=this.core.timeOrigin.getNTPTime(e),t.sendTime=this.core.timeOrigin.getNTPTime();var i=this.core.timeOrigin.getNTPTime(),o=Ve(r,"detail.reason");this.core.reporter.report("msgSend",{msgId:n.messageServerId,clientId:n.messageClientId,msgTime:n.createTime,fromAccid:1===n.conversationType?n.senderId:"",toAccid:n.receiverId,type:fd(n.conversationType),tid:1===n.conversationType?"":n.receiverId,result:r?r.code:200,failReason:o||(null==r?void 0:r.message)||"",rt:i-t.apiCallingTime,apiCallingTime:t.apiCallingTime,sendTime:t.sendTime,attachUploadDuration:t.attachUploadDuration,apiCallbackTime:i})}generateSendMessage(e){var t,n,{conversationId:r,replyMessage:i,resend:o,message:s,params:a}=e,c={};if(i){var l=i.threadRoot;c={threadReply:{senderId:i.senderId,receiverId:i.receiverId,messageServerId:i.messageServerId,createTime:i.createTime,messageClientId:i.messageClientId,conversationType:i.conversationType,conversationId:i.conversationId},threadRoot:{senderId:l?l.senderId:i.senderId,receiverId:l?l.receiverId:i.receiverId,messageServerId:l?l.messageServerId:i.messageServerId,createTime:l?l.createTime:i.createTime,messageClientId:l?l.messageClientId:i.messageClientId,conversationType:l?l.conversationType:i.conversationType,conversationId:l?l.conversationId:i.conversationId}}}var d=this.core.V2NIMConversationIdUtil.parseConversationType(r),u=this.core.V2NIMConversationIdUtil.parseConversationTargetId(r);a.pushConfig&&!0!==a.pushConfig.forcePush&&(delete a.pushConfig.forcePushContent,delete a.pushConfig.forcePushAccountIds);var p={},h={};if(a.aiConfig){var g=Ve(a,"aiConfig.content.msg"),m=Ve(a,"aiConfig.content.type")||0;g?h={msg:g,type:m}:void 0===g&&0===s.messageType&&(h={msg:s.text||"",type:m}),(p=Object.assign({aiStreamStatus:0,aiStream:!1},a.aiConfig)).aiStatus=1,void 0!==h.msg&&(p.content=h)}var f=null===(n=null===(t=this.core.V2NIMUserService)||void 0===t?void 0:t.model)||void 0===n?void 0:n.getUser(this.core.account),v=(null==f?void 0:f.updateTime)||0;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},s),c),{messageConfig:Object.assign(Object.assign({},s.messageConfig),a.messageConfig),routeConfig:Object.assign(Object.assign({},s.routeConfig),a.routeConfig),pushConfig:Object.assign(Object.assign({},s.pushConfig),a.pushConfig),antispamConfig:Object.assign(Object.assign({},s.antispamConfig),a.antispamConfig),robotConfig:Object.assign(Object.assign({},s.robotConfig),a.robotConfig)}),p&&p.accountId?{aiConfig:p}:{}),s.attachment?{attachment:Object.assign({},s.attachment)}:{}),{resend:o,senderId:this.core.account,conversationType:d,receiverId:u,conversationId:this.core.V2NIMConversationIdUtil.messageConversationId({conversationType:d,senderId:this.core.account,receiverId:u})}),v?{userUpdateTime:v}:{}),{sendingState:3})}}class Dd{constructor(e,t){this.core=e,this.service=t}checkIfModify(e,t){if("0"===e.messageServerId)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageServerId cannot be empty"}});if(![0,1,2,3,4,6,10,12,100].includes(e.messageType))throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:`modifyMessage: messageType ${e.messageType} not correct`}});if([0,1,2,3,6,10,12].includes(e.messageType)&&t.attachment)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:`modifyMessage: messageType ${e.messageType} can not modify attachment`}});var n=["subType","text","serverExtension","attachment"];if(!n.some(e=>void 0!==Ve(t,e)))throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: missing modified params"}});if(n.every(n=>"attachment"===n?e.attachment&&t.attachment?id(e.messageType,e.attachment)===id(e.messageType,t.attachment):!t.attachment:Ve(e,n)===Ve(t,n)))throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: no change"}})}prepareMessage(e,t){var n=this.generateSendMessage(e,t),{clientAntispamResult:r,text:i}=this.checkIfAntispam(t,n);return n.text=i,n.clientAntispamHit=!!r&&3===r.operateType,{messageBeforeSend:n,clientAntispamResult:r}}modifyMessage(e,t){return Ce(this,void 0,void 0,function*(){var n;if(1===e.conversationType)n="v2MessageP2pModify";else if(2===e.conversationType)n="v2MessageTeamModify";else{if(3!==e.conversationType)throw new ge({detail:{reason:`conversationType: ${e.conversationType} is not supported`}});n="v2MessageSuperTeamModify"}var r=yield this.core.sendCmd(n,{tag:e});if(t&&3===t.operateType)return{errorCode:le.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,clientAntispamResult:t};var i=Object.assign(Object.assign({},e),r.content.data),o=i.antispamResult;if(o)return Object.assign({errorCode:le.V2NIM_ERROR_CODE_SERVER_ANTISPAM,antispamResult:o},t?{clientAntispamResult:t}:{});delete i.antispamResult;var s=Jl(this.core,i);return this.service.model.upsertMessages([s]),this.core.eventBus.emit("V2NIMMessageService/modifyMsg",s),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",s),Object.assign(Object.assign({errorCode:200,message:s},o?{antispamResult:o}:{}),t?{clientAntispamResult:t}:{})})}checkIfAntispam(e,t){var n,r=t.text;if(e.clientAntispamEnabled&&(0===t.messageType||10===t.messageType))if(1===(n=this.core.V2NIMClientAntispamUtil.checkTextAntispam?this.core.V2NIMClientAntispamUtil.checkTextAntispam(t.text||"",e.clientAntispamReplace):{operateType:0,replacedText:""}).operateType)r=n.replacedText;else if(2===n.operateType)throw new pe({code:le.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:n,text:r}}generateSendMessage(e,t){var n;return Object.assign(Object.assign({messageConfig:{lastMessageUpdateEnabled:null===(n=e.messageConfig)||void 0===n?void 0:n.lastMessageUpdateEnabled},routeConfig:Object.assign({routeEnabled:!0},t.routeConfig),pushConfig:Object.assign({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},t.pushConfig),antispamConfig:Object.assign({antispamEnabled:!0},t.antispamConfig)},t.attachment?{attachment:t.attachment}:{}),{conversationType:e.conversationType,senderId:e.senderId,receiverId:e.receiverId,createTime:e.createTime,messageClientId:e.messageClientId,messageServerId:e.messageServerId,messageType:e.messageType,subType:t.subType,text:t.text,serverExtension:t.serverExtension})}}class Ud{constructor(e,t){this.emitRevokeMessage=e=>{var t=e.map(e=>{var t=ed(this.core,e);return 3===t.messageRefer.conversationType?this.core.eventBus.emit("V2NIMSync/updateTimetag",{deleteSuperTeamMsg:e.createTime}):this.core.eventBus.emit("V2NIMSync/updateTimetag",{recallMsg:e.createTime}),t});t.forEach(e=>{this.service.model.deleteMessage(e.messageRefer.messageClientId)}),this.service.emit("onMessageRevokeNotifications",t),this.core.eventBus.emit("V2NIMMessageService/revokeMessages",t)},this.core=e,this.service=t,this.logger=e.logger}revokeMessage(e,t){return Ce(this,void 0,void 0,function*(){if(Te(ol,{message:e,params:t},"",!0),Ee(this.core.account,e.conversationId),1===e.conversationType&&e.senderId!==this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: p2p message senderId is not current user"}});if(!e.messageServerId||"0"===e.messageServerId)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: cannot revoke message with invalid messageServerId: "+e.messageServerId}});var n=3===e.conversationType?"v2RevokeSuperTeamMessage":"v2RevokeMessage",r={1:7,2:8,3:12},i=Object.assign(Object.assign(Object.assign({},e),t),{attach:t&&t.serverExtension,sysMsgType:r[e.conversationType],opeAccount:this.core.account});yield this.core.sendCmd(n,{tag:i});var o={1:1,2:2,3:3},s=[JSON.parse(JSON.stringify({postscript:t&&t.postscript,revokeType:o[e.conversationType],revokeAccountId:this.core.account,serverExtension:t&&t.serverExtension,messageRefer:Zl(this.core,e)}))];this.revokeMessagesFn(s),this.core.eventBus.emit("forwardSend/V2NIMMessageService/revokeMessage",i)})}deleteMessage(e,t){return Ce(this,void 0,void 0,function*(){if(Te(ll,e,"",!0),3===e.sendingState)this.service.fileUtil.cancelMessageAttachmentUpload(e);else if(e.sendingState&&1!==e.sendingState)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: cannot delete unsent message"}});var n={messageRefer:Zl(this.core,e),serverExtension:t},r=Date.now();e.messageServerId&&"0"!==e.messageServerId&&(r=(yield this.core.sendCmd("v2DeleteMessage",{tag:n})).content.timetag);var i=[{serverExtension:t,messageRefer:Zl(this.core,e),deleteTime:r}];this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",[Object.assign(Object.assign({},n),{deleteTime:r})]),this.deleteMessagesFn(i)})}deleteMessages(e,t){return Ce(this,void 0,void 0,function*(){Te(dl,{messages:e},"",!0);var n=[],r=[];if(0===e.length)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: message array length is 0"}});for(var i=e[0].conversationId,o=0;o<e.length;o++){if(3===e[o].sendingState)this.service.fileUtil.cancelMessageAttachmentUpload(e[o]);else if(e[o].sendingState&&1!==e[o].sendingState)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:`deleteMessage: sendingState should be succeeded, please check message at index: ${o}`}});if(o>=1&&e[o].conversationId!==i)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: only allow to delete messages from same conversation"}});e[o].messageServerId&&"0"!==e[o].messageServerId?n.push(e[o]):r.push(e[o])}var s=Date.now(),a=[...r];try{if(n.length>0){var c=yield this.core.sendCmd("v2DeleteMessages",{tag:n.map(e=>({messageRefer:e,serverExtension:t}))});s=c.content.timetag,a=[...a,...n]}}catch(d){if(0===r.length)throw d;this.logger.warn("V2NIMMessageService:deleteMessages: delete messages with serverId failed")}var l=a.map(e=>({serverExtension:t,messageRefer:Zl(this.core,e),deleteTime:s}));this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",a.map(e=>({messageRefer:e,serverExtension:t,deleteTime:s}))),this.deleteMessagesFn(l)})}revokeMessagesFn(e){e.forEach(e=>{this.service.model.deleteMessage(e.messageRefer.messageClientId)}),this.service.emit("onMessageRevokeNotifications",e),this.core.eventBus.emit("V2NIMMessageService/revokeMessages",e)}deleteMessagesFn(e){e.forEach(e=>{this.service.model.deleteMessage(e.messageRefer.messageClientId),this.core.eventBus.emit("V2NIMSync/updateTimetag",{deleteSelfMsgs:e.deleteTime})}),this.service.emit("onMessageDeletedNotifications",e),this.core.eventBus.emit("V2NIMMessageService/deleteMessages",e)}}class $d{constructor(e,t){this.core=e,this.service=t,this.logger=e.logger}stopAIStreamMessage(e,t){var n;return Ce(this,void 0,void 0,function*(){this.checkAI(),yield this.core.sendCmd("v2AIStopModelStreamCall",{tag:{serverId:e.messageServerId,clientId:e.messageClientId,type:e.conversationType,from:e.senderId,to:e.receiverId,aiAccount:null===(n=e.aiConfig)||void 0===n?void 0:n.accountId,opeType:t.operationType,updateContent:t.updateContent,messageTime:e.createTime}}),this.logger.log(`V2AIUtil::streamMessageStop,clientId:${e.messageClientId}`),this.core.V2NIMAIService.model.completeAiStream(e.messageClientId)})}regenAIMessage(e,t){var n,r,i,o,s,a,c,l;return Ce(this,void 0,void 0,function*(){this.checkAI();var d=this.core.V2NIMAIService.model.getAiStream(e.messageClientId);if(d){if(!(null==d?void 0:d.isComplete))throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:`msg::regenAIMessage streamCache is not complete, msgId:${e.messageClientId}`}})}else if(-1===(null===(n=e.streamConfig)||void 0===n?void 0:n.status)||1===(null===(r=e.streamConfig)||void 0===r?void 0:r.status))throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:`msg::regenAIMessage message streamConfig.status forbidden ${e.streamConfig.status}`}});yield this.core.sendCmd("v2AIRegenMessage",{tag:{fromAccount:e.senderId,to:e.receiverId,aiAccount:null===(i=e.aiConfig)||void 0===i?void 0:i.accountId,serverId:e.messageServerId,clientId:e.messageClientId,time:e.createTime,type:e.conversationType,opeType:t.operationType,replyMsgFromAccount:null===(o=e.threadReply)||void 0===o?void 0:o.senderId,replyMsgToAccount:null===(s=e.threadReply)||void 0===s?void 0:s.receiverId,replyMsgTime:null===(a=e.threadReply)||void 0===a?void 0:a.createTime,replyMsgIdServer:null===(c=e.threadReply)||void 0===c?void 0:c.messageServerId,replyMsgIdClient:null===(l=e.threadReply)||void 0===l?void 0:l.messageClientId}}),1===t.operationType&&this.core.V2NIMAIService.model.setAiStream(e.messageClientId,{isComplete:!1,queryStatus:0,chunks:[]})})}checkAI(){if(!this.hasAI())throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMAIService is not registered"}})}hasAI(){var e;return!!(null===(e=this.core.V2NIMAIService)||void 0===e?void 0:e.name)}}class Bd{constructor(e,t){this.core=e,this.service=t,this.model=t.model,this.receiptUtil=t.receiptUtil,this.logger=this.core.logger}setAIStreamPlaceholder(e){this.service.aiUtil.hasAI()&&e.forEach(e=>{var t;1===(null===(t=e.streamConfig)||void 0===t?void 0:t.status)&&this.core.V2NIMAIService.model.setAiStream(e.messageClientId,{isComplete:!1,queryStatus:0,chunks:[],msg:e},!0)})}onMsgHandler(e){var t=Ke(e,e.content.msg,"messageServerId"),{_conversationOnlineSyncNotify:n,_conversationOnlineSyncData:r}=t,i=be(t,["_conversationOnlineSyncNotify","_conversationOnlineSyncData"]),o=Jl(this.core,i,1),s=this.service._filterMessage(o);this.logger.log(`v2OnMsgHandler::recvMsg ${o.messageClientId}/${o.messageServerId}/${o.createTime};isHitFilter:${s}`),3===o.conversationType?this.core.eventBus.emit("V2NIMSync/updateTimetag",{superTeamRoamingMsgs:o.createTime,offlineMsgs:o.createTime}):this.core.eventBus.emit("V2NIMSync/updateTimetag",{roamingMsgs:o.createTime,offlineMsgs:o.createTime}),this.service.config.compatibleWithV1||(this.service.markMsgsAck([o]),this.service.sendUtil.doMsgReceiveReport(o,e)),delete o.__clientExt,this.setAIStreamPlaceholder([o]),5!==o.messageType&&this.core.V2NIMUserService.checkUserUpdate&&this.core.V2NIMUserService.checkUserUpdate(o,o.userUpdateTime),5===o.messageType&&this.core.eventBus.emit("V2NIMTeamService/notification",t),s||(this.service.emit("onReceiveMessages",[o]),this.model.upsertMessages([o]),n&&this.core.eventBus.emit("V2NIMConversationService/conversationOnlineSyncNotify",{content:{info:JSON.parse(n),data:JSON.parse(r)}},o),this.core.eventBus.emit("V2NIMMessageService/onMsg",o))}syncOfflineMsgsHandler(e){var t=e.content.datas;t=t.map(e=>Jl(this.core,e,2)),0!==(t=this.service._filterMessagesByFn(t)).length&&(!this.service.config.compatibleWithV1&&this.service.markMsgsAck(t),this.service.emit("onReceiveMessages",t),this.model.upsertMessages(t),this.core.eventBus.emit("V2NIMMessageService/offlineMsgs",t))}syncRoamingMsgsHandler(e){var t=e.content.datas;t=t.map(e=>Jl(this.core,e,3)),this.setAIStreamPlaceholder(t),0!==(t=this.service._filterMessagesByFn(t)).length&&(this.service.emit("onReceiveMessages",t),this.model.upsertMessages(t),this.core.eventBus.emit("V2NIMMessageService/roamingMsgs",t))}onP2PMessageReceiptsHandler(e){this.receiptUtil.onP2PMessageReceiptsHandler(e)}onTeamMessageReceiptsHandler(e){this.receiptUtil.onTeamMessageReceiptsHandler(e)}syncP2PMessagReceiptsHandler(e){this.receiptUtil.syncP2PMessagReceiptsHandler(e)}syncRevokeMessageHandler(e){this.service.deleteUtil.emitRevokeMessage(e.content.datas)}onRevokeMessageHandler(e){var t=e.content.data;this.service.deleteUtil.emitRevokeMessage([t])}onDeleteMessageHandler(e){var t=e.content.data,n={serverExtension:t.serverExtension,deleteTime:t.deleteTime,messageRefer:Ql(this.core,t.messageRefer)};this.service.deleteUtil.deleteMessagesFn([n])}onDeleteMessagesHandler(e){var t=e.content.data.map(e=>({serverExtension:e.serverExtension,deleteTime:e.deleteTime,messageRefer:Ql(this.core,e.messageRefer)}));this.service.deleteUtil.deleteMessagesFn(t)}syncOnDeleteMessagesHandler(e){var t=e.content.datas.map(e=>({serverExtension:e.serverExtension,deleteTime:e.deleteTime,messageRefer:Ql(this.core,e.messageRefer)}));this.service.emit("onMessageDeletedNotifications",t)}v2MessageOnModifiedHandler(e){var t=Jl(this.core,e.content.data);this.model.upsertMessages([t]),this.service.aiUtil.hasAI()&&this.core.V2NIMAIService.model.completeAiStream(t.messageClientId),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",t),this.core.eventBus.emit("V2NIMMessageService/modifyMsg",t),this.core.eventBus.emit("V2NIMSync/updateTimetag",3===t.conversationType?{superTeamModifyMessage:t.modifyTime}:{p2pTeamModifyMessage:t.modifyTime}),this.service.emit("onReceiveMessagesModified",[t])}v2MessageSyncModifiedHandler(e){var t=e.content.datas.map(e=>Jl(this.core,e)).filter(e=>{var t,n=(null===(t=this.model.getMessageById(e.messageClientId))||void 0===t?void 0:t.modifyTime)||0;return(e.modifyTime||0)>n});t.length>0&&(this.model.upsertMessages(t),t.forEach(e=>{this.service.aiUtil.hasAI()&&this.core.V2NIMAIService.model.completeAiStream(e.messageClientId),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",e)}),this.service.emit("onReceiveMessagesModified",t))}v2MessageSyncSuperTeamModifiedHandler(e){this.v2MessageSyncModifiedHandler(e)}}class Fd{constructor(e,t){this.core=e,this.service=t,this.logger=this.core.logger}setListener(){this.core.eventBus.on("forwardReceive/V2NIMMessageService/sendMsg",this.service.sendMessageFn.bind(this.service)),this.core.eventBus.on("forwardReceive/V2NIMMessageService/revokeMessages",this.service.deleteUtil.emitRevokeMessage.bind(this.service.deleteUtil)),this.core.eventBus.on("forwardReceive/V2NIMMessageService/deleteMessages",this.service.deleteUtil.deleteMessagesFn.bind(this.service.deleteUtil)),this.core.eventBus.on("V2NIMConversationService/deleteConversation",e=>{e.forEach(e=>this.service.model.deleteMessages(e))}),this.core.eventBus.on("V2NIMAIService/receiveMessagesModified",e=>this.service.emit("onReceiveMessagesModified",e))}beforeEmit(e,...t){var n,r,i,o=`${this.service.name}::emit ${e.toString()}`;if("onSendMessage"===e){var s=t[0];this.logger.log(`${o}`,`${s.messageClientId}/${s.messageServerId}/${s.createTime};`,`sendingState:${s.sendingState};attachmentUploadState:${s.attachmentUploadState||0};messageStatus:${null===(n=s.messageStatus)||void 0===n?void 0:n.errorCode};config.lastMsg:${null===(r=s.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled};config.unread:${null===(i=s.messageConfig)||void 0===i?void 0:i.unreadEnabled}`)}else if("onReceiveMessages"===e||"onReceiveMessagesModified"===e){var a=t[0];this.logger.log(`${o}`,a.map(e=>{var t,n;return`${e.messageClientId}/${e.messageServerId}/${e.createTime};config.lastMsg:${null===(t=e.messageConfig)||void 0===t?void 0:t.lastMessageUpdateEnabled};config.unread:${null===(n=e.messageConfig)||void 0===n?void 0:n.unreadEnabled}`}))}else if("onMessageRevokeNotifications"===e){var c=t[0];this.logger.log(`${o}`,c.map(e=>`msg:${e.messageRefer.messageClientId}/${e.messageRefer.messageServerId};revokeAccountId:${e.revokeAccountId}`))}else if("onMessageDeletedNotifications"===e){var l=t[0];this.logger.log(`${o}`,l.map(e=>`msg:${e.messageRefer.messageClientId}/${e.messageRefer.messageServerId};deleteTime:${e.deleteTime}`))}else this.logger.log(`${o}`,...t)}}class jd extends An{constructor(e,t={}){super("V2NIMMessageService",e),this.customAttachmentParsers=[],this.config={compatibleWithV1:!0},this.filterFn=void 0,this.core._registerDep(Wc,"V2NIMConversationIdUtil"),this.core._registerDep(Pd,"V2NIMMessageCreator"),this.core._registerDep(kd,"V2NIMMessageAttachmentCreator"),this.core._registerDep(Ld,"V2NIMClientAntispamUtil"),this.receiptUtil=new Vl(this.core,this),this.fileUtil=new sd(this.core),this.sendUtil=new Vd(this.core,this),this.modifyUtil=new Dd(this.core,this),this.deleteUtil=new Ud(this.core,this),this.aiUtil=new $d(this.core,this),this.model=new zc,this.event=new Fd(this.core,this),this.handler=new Bd(this.core,this),"v2"===this.core.options.apiVersion&&(Gt({cmdMap:cd,cmdConfig:md}),this.setOptions(t),this.setListener())}setOptions(e){var t;(null===(t=this.core.msg)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=Object.assign(this.config,e)}setListener(){this.event.setListener()}reset(){this.model.reset(),this.receiptUtil.reset()}emit(e,...t){return this.event.beforeEmit(e,...t),super.emit(e,...t)}checkExtendUtil(){var e;if(!(null===(e=this.core.V2NIMMessageExtendUtil)||void 0===e?void 0:e.name))throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMMessageLogUtil is not registered"}})}checkLogUtil(){var e;if(!(null===(e=this.core.V2NIMMessageLogUtil)||void 0===e?void 0:e.name))throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMMessageExtendUtil is not registered"}})}getMessageList(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.checkLogUtil();var t=yield this.core.V2NIMMessageLogUtil.getMessageList(e);return t=this._filterMessageByClearTime(e.conversationId,t),this._filterMessagesByFn(t)})}getMessageListEx(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.checkLogUtil();var t=yield this.core.V2NIMMessageLogUtil.getMessageList(e);return t=this._filterMessageByClearTime(e.conversationId,t),{messages:this._filterMessagesByFn(t),anchorMessage:t.length>0?t[t.length-1]:null}})}getMessageListByRefers(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.getMessageListByRefers(e)}clearHistoryMessage(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.clearHistoryMessage(e)}clearRoamingMessage(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.clearRoamingMessage(e)}pinMessage(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.pinMessage(e,t)}unpinMessage(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.unpinMessage(e,t)}updatePinMessage(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.updatePinMessage(e,t)}voiceToText(e){return this.checkV2(),this.checkExtendUtil(),"string"==typeof e.duration&&(e.duration=Number(e.duration)),this.core.V2NIMMessageExtendUtil.voiceToText(e)}getPinnedMessageList(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getPinnedMessageList(e)}addQuickComment(e,t,n,r){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.addQuickComment(e,t,n,r)}removeQuickComment(e,t,n){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.removeQuickComment(e,t,n)}getQuickCommentList(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getQuickCommentList(e)}addCollection(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.addCollection(e)}removeCollections(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.removeCollections(e)}updateCollectionExtension(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.updateCollectionExtension(e,t)}getCollectionListByOption(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getCollectionListByOption(e)}getCollectionListExByOption(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getCollectionListExByOption(e)}searchCloudMessages(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.searchCloudMessages(e)}searchCloudMessagesEx(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.searchCloudMessagesEx(e)}getThreadMessageList(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getThreadMessageList(e)}registerCustomAttachmentParser(e){"function"==typeof e&&-1===this.customAttachmentParsers.indexOf(e)&&this.customAttachmentParsers.unshift(e)}unregisterCustomAttachmentParser(e){var t=this.customAttachmentParsers.indexOf(e);t>-1&&this.customAttachmentParsers.splice(t,1)}sendP2PMessageReceipt(e){return this.checkV2(),this.receiptUtil.sendP2PMessageReceipt(e)}isPeerRead(e){return this.checkV2(),this.receiptUtil.isPeerRead(e)}getP2PMessageReceipt(e){return this.checkV2(),this.receiptUtil.getP2PMessageReceipt(e)}getTeamMessageReceipts(e){return this.checkV2(),this.receiptUtil.getTeamMessageReceipts(e)}getTeamMessageReceiptDetail(e){return this.checkV2(),this.receiptUtil.getTeamMessageReceiptDetail(e)}sendTeamMessageReceipts(e){return this.checkV2(),this.receiptUtil.sendTeamMessageReceipts(e)}revokeMessage(e,t){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.deleteUtil.revokeMessage(e,t)})}deleteMessage(e,t){return this.checkV2(),this.deleteUtil.deleteMessage(e,t)}deleteMessages(e,t){return this.checkV2(),this.deleteUtil.deleteMessages(e,t)}cancelMessageAttachmentUpload(e){return this.checkV2(),this.fileUtil.cancelMessageAttachmentUpload(e)}markMsgsAck(e){if(e&&e.length>0){var t=[],n=[];e.forEach(e=>{e.senderId===this.core.account&&e.senderId!==e.receiverId||(1===e.conversationType?t.push(e):2===e.conversationType&&n.push(e))}),t.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:2,ids:t.map(e=>e.messageServerId)}),n.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:8,cid:3,ids:n.map(e=>e.messageServerId)})}}sendMessage(e,t,n={},r){var i;return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||Ue(),e.conversationId&&e.conversationId!==t)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message.conversationId is not equal to conversationId"}});Te(il,{conversationId:t,message:e,params:n},"",!0),Ee(this.core.account,t);var o=this.core.V2NIMConversationIdUtil.parseConversationType(t);if((2===o||3===o)&&n.robotConfig&&!n.robotConfig.accountId)throw new ge({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});if(2!==o&&3!==o||!n.targetConfig)n.targetConfig=void 0;else{var s=n.targetConfig.receiverIds;if(3===o&&!1===n.targetConfig.inclusive)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"setting inclusive to false for super teams is not allowed"}});if(0===(s=s.filter(e=>e&&e!==this.core.account)).length)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"receiverIds cannot be empty or only contain yourself"}});n.targetConfig.receiverIds=s}(null===(i=n.aiConfig)||void 0===i?void 0:i.aiStream)&&this.aiUtil.checkAI();var a,c=this.core.timeOrigin.getTimeNode(),{messageBeforeSend:l,clientAntispamResult:d,hiddenParams:u}=this.sendUtil.prepareMessage(e,t,n);this.logger.log(`V2SendMessage start:${l.messageClientId}/${l.createTime};conversation:${t};`,`NTPTime:${this.core.timeOrigin.getNTPTime(c)}`);try{a=yield this.sendUtil.doSendMessage({apiCallingTimeNode:c,messageBeforeSend:l,clientAntispamResult:d,hiddenParams:u,progress:r})}catch(p){throw this.logger.warn(`V2SendMessage end:${l.messageClientId}.`,p instanceof pe?`failed:${p.code}`:"failed"),p}return a.message.senderId===a.message.receiverId&&this.markMsgsAck([a.message]),this.logger.log(`V2SendMessage end:${a.message.messageClientId}/${a.message.messageServerId}/${a.message.createTime}`),a})}replyMessage(e,t,n={},r){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||Ue(),Te(rl,{message:e,replyMessage:t,params:n},"",!0),Ee(this.core.account,t.conversationId),(2===e.conversationType||3===e.conversationType)&&n.robotConfig&&!n.robotConfig.accountId)throw new ge({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});var i=this.core.timeOrigin.getTimeNode(),{messageBeforeSend:o,clientAntispamResult:s,hiddenParams:a}=this.sendUtil.prepareMessage(e,t.conversationId,n,t),c=yield this.sendUtil.doSendMessage({apiCallingTimeNode:i,messageBeforeSend:o,clientAntispamResult:s,hiddenParams:a,progress:r});return c.message.senderId===c.message.receiverId&&this.markMsgsAck([c.message]),c})}modifyMessage(e,t){this.checkV2(),this.checkLogin(),Te(wl,e,"message",!0),Te(Pl,t,"params",!0),this.modifyUtil.checkIfModify(e,t);var{messageBeforeSend:n,clientAntispamResult:r}=this.modifyUtil.prepareMessage(e,t);return this.modifyUtil.modifyMessage(n,r)}stopAIStreamMessage(e,t){if(this.checkV2(),this.aiUtil.checkAI(),Te(kl,e,"message",!0),Te(Ll,t,"params",!0),2===t.operationType&&!t.updateContent)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"V2NIMMessage::stopAIStreamMessage updateContent empty"}});return this.aiUtil.stopAIStreamMessage(e,t)}regenAIMessage(e,t){return this.checkV2(),this.aiUtil.checkAI(),Te(kl,e,"message",!0),Te(xl,t,"params",!0),this.aiUtil.regenAIMessage(e,t)}sendMessageFn(e){if(e.msgAckSnapshot){var t=e.msgAckSnapshot,n={conversationId:e.conversationId,messageServerId:e.messageServerId,messageClientId:e.messageClientId,readCount:0,unreadCount:Number(t)};delete e.msgAckSnapshot,this.emit("onReceiveTeamMessageReadReceipts",[n])}e=Xl(e,this.core),this.model.upsertMessages([e]),this.core.eventBus.emit("V2NIMMessageService/sendMessage",e,e.sendingState)}setMessageFilter(e){null!=e?e&&"function"==typeof e.shouldIgnore&&(this.filterFn=e.shouldIgnore):this.filterFn=void 0}_filterMessage(e){if("function"==typeof this.filterFn)try{return!0===this.filterFn(e)}catch(t){return this.logger.error(`V2NIMMessage::triggerMessageFilter ${e.messageClientId} error:`,t),!1}return!1}_filterMessagesByFn(e){return e.filter(e=>!this._filterMessage(e))}_filterMessageByClearTime(e,t){var n=we.localStorage.getItem(`nim_${this.core.account}_${e}_clearTime`),r=n?parseInt(n):0;return r>0?t.filter(e=>e.createTime>=r):t}}var qd={super_team:3,p2p:1,team:2},Gd={3:"super_team",1:"p2p",0:"p2p",2:"team"};function Hd(e,t="|"){var n=e.indexOf(t);if(-1===n)return{target:"",type:0};var r=e.slice(0,n);return{target:e.slice(n+1),type:qd[r]||0}}function Wd(e,t){return`${Gd[e]}|${t}`}class zd{constructor(){this.map=new Map,this.capacity=1e4,this.readTimeMap=new Map,this.stickTopMap=new Map}reset(){this.map.clear(),this.readTimeMap.clear(),this.stickTopMap.clear()}count(){return this.map.size}sort(){var e=Array.from(this.map.values());e.sort((e,t)=>t.sortOrder-e.sortOrder),this.map.clear(),e.forEach(e=>{this.map.set(e.conversationId,e)})}processConversation(e){return"string"==typeof e.lastMessage&&delete e.lastMessage,void 0===e.localExtension&&(e.localExtension=""),e}getById(e){return this.map.get(e)}getAll(){return Array.from(this.map.values()).sort((e,t)=>t.sortOrder-e.sortOrder)}getStickTopList(){return Array.from(this.map.values()).filter(e=>e.stickTop).sort((e,t)=>t.sortOrder-e.sortOrder)}getByOption(e,t,n){var{conversationTypes:r,onlyUnread:i}=n,o=[];this.map.forEach(e=>{r&&r.length>0&&!r.includes(e.type)||i&&!e.unreadCount||n.ignoreMuted&&e.mute||o.push(e)}),o=o.sort((e,t)=>t.sortOrder-e.sortOrder);var s=0;e>0&&(s=ze(o,"sortOrder",e),o[s]&&o[s].sortOrder===e&&(s+=1));var a=o.slice(s).length;return(o=o.slice(s,s+t)).length>0?{offset:a>t?o[o.length-1].sortOrder:0,finished:!(a>t),conversationList:o}:{offset:0,finished:!0,conversationList:o}}upsert(e){var t=e.conversationId,n=this.map.get(t);if(!n){var r=this.processConversation(Object.assign({stickTop:this.getStickTop(t),localExtension:"",lastMessage:null,unreadCount:0,sortOrder:0,createTime:0,updateTime:0},e));return this.setLRU(t,r),r.unreadCount>0}var i=e.unreadCount!==n.unreadCount,o=Object.assign({},n,e);return o=this.processConversation(o),this.setLRU(t,o),i}setLRU(e,t){if(this.map.has(e))this.map.delete(e);else if(this.map.size>=this.capacity){var n=this.map.keys().next().value;n&&this.map.delete(n)}this.map.set(e,t)}bulkUpsert(e){var t=!1;return e.forEach(e=>{this.upsert(e)&&(t=!0)}),t}deleteById(e){var t=this.getById(e);if(t)return this.map.delete(e),t}updateReadTime(e,t){this.readTimeMap.set(e,t)}getReadTime(e){return this.readTimeMap.get(e)||0}updateStickTop(e,t){t?this.stickTopMap.set(e,!0):this.stickTopMap.delete(e)}getStickTop(e){return this.stickTopMap.get(e)||!1}}var Kd,Yd={"4_14":"v2LocalConvSyncReadTime","4_20":"v2LocalConvSyncSuperTeamReadTime","4_22":"v2LocalConvSyncMoreRoaming","4_23":"v2LocalConvSyncStickTop","4_25":"v2LocalConvSyncReliableInfo","7_16":"v2LocalConvMarkReadTime","7_25":"v2LocalConvMultiMarkReadTime","7_116":"v2LocalConvMultiSyncReadTime","21_25":"v2LocalConvSuperTeamMarkReadTime","21_32":"v2LocalConvSuperTeamMultiMarkReadTime","21_125":"v2LocalConvSuperTeamMultiSyncReadTime","33_12":"v2LocalConvStickTopAdd","33_13":"v2LocalConvStickTopDelete","23_112":"v2LocalConvStickTopMultiSyncAdd","23_113":"v2LocalConvStickTopMultiSyncDelete","23_114":"v2LocalConvStickTopMultiSyncUpdate"},Jd="V2NIMLocalConversationService",Xd={id:1,ext:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},Qd={scene:1,to:2,timetag:3},Zd={v2LocalConvSyncReadTime:{sid:4,cid:14,service:Jd,response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},v2LocalConvSyncSuperTeamReadTime:{sid:4,cid:20,service:Jd,response:[{type:"LongLongMap",name:"superTeam"}]},v2LocalConvSyncMoreRoaming:{sid:4,cid:22,service:Jd,response:[]},v2LocalConvSyncStickTop:{sid:4,cid:23,service:Jd,response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:Wt(Xd)}]},v2LocalConvSyncReliableInfo:{sid:4,cid:25,service:Jd,response:[]},v2LocalConvMarkReadTime:{sid:7,cid:16,service:Jd,params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvMultiMarkReadTime:{sid:7,cid:25,service:Jd,ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"tags",reflectMapper:Qd}]},v2LocalConvMultiSyncReadTime:{sid:7,cid:116,service:Jd,response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvSuperTeamMarkReadTime:{sid:21,cid:25,service:Jd,params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvSuperTeamMultiMarkReadTime:{sid:21,cid:32,service:Jd,ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"tags",reflectMapper:Qd}]},v2LocalConvSuperTeamMultiSyncReadTime:{sid:21,cid:125,service:Jd,response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvStickTopAdd:{sid:33,cid:12,service:Jd,params:[{type:"Property",name:"tag",reflectMapper:Xd}],response:[{type:"Property",name:"data",reflectMapper:Wt(Xd)}]},v2LocalConvStickTopDelete:{sid:33,cid:13,service:Jd,params:[{type:"Property",name:"tag",reflectMapper:Xd}],response:[{type:"Long",name:"timetag"}]},v2LocalConvStickTopMultiSyncAdd:{sid:23,cid:112,service:Jd,response:[{type:"Property",name:"data",reflectMapper:Wt(Xd)}]},v2LocalConvStickTopMultiSyncDelete:{sid:23,cid:113,service:Jd,response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:Wt(Xd)}]},v2LocalConvStickTopMultiSyncUpdate:{sid:23,cid:114,service:Jd,response:[{type:"Property",name:"data",reflectMapper:Wt(Xd)}]}};class eu{constructor(e,t){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.currentConversationId=void 0,this._setCurrConvThrottle=ic(()=>{this.currentConversationId&&this._setCurrConv(this.currentConversationId)},5e3,{leading:!1}),this.core=e,this.service=t,this.model=t.model,this.logger=t.logger}reset(){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.currentConversationId=void 0,this._setCurrConvThrottle.flush()}getTotalUnreadCount(){return this.totalUnreadCount}resetTotalAfterSyncDone(){var e=this.service.model.getAll().reduce((e,t)=>e+(t.unreadCount||0),0),t=this.totalUnreadCount;return void 0!==t&&t===e||(this.totalUnreadCount=e,this.service.emit("onTotalUnreadCountChanged",e)),e}digestUnreadCountChange(){this._digest()}_digest(){var e=this.totalUnreadCount,t=this.service.model.getAll().reduce((e,t)=>e+(t.unreadCount||0),0);this.core.logger.log(`V2NIMConversation::digestUnreadCountChange:oldUnreadCount ${e}, newUnreadCount ${t}`),e!==t&&(this.totalUnreadCount=t,this.service.emit("onTotalUnreadCountChanged",t)),Object.keys(this.unreadCountByFilter).forEach(e=>{var t=JSON.parse(e),n=this.getUnreadCountByFilter(t),r=this.unreadCountByFilter[e];this.unreadCountByFilter[e]=n,t.equals=nu.bind(t),r!==n&&this.service.emit("onUnreadCountChangedByFilter",t,n)})}clearUnreadCount(e){var t=e.reduce((e,t)=>(this.service.model.upsert({conversationId:t.conversationId,type:t.type,unreadCount:0})&&e.push(t.conversationId),e),[]);if(t.length>0){var n=t.map(e=>this.service.model.getById(e));this.service.triggerConversationChanged(n),this.digestUnreadCountChange()}}getUnreadCountByIds(e){return(e=En(e)).reduce((e,t)=>{var n=this.service.model.getById(t);return e+(n&&n.unreadCount||0)},0)}getUnreadCountByFilter(e){var t=this.service.model.count();return this.service.model.getByOption(0,t,{conversationTypes:e.conversationTypes,ignoreMuted:e.ignoreMuted}).conversationList.reduce((e,t)=>e+(t.unreadCount||0),0)}isMessageUnread(e,t=0){var n;return e.createTime>t&&e.senderId!==this.core.account&&200===e.messageStatus.errorCode&&!1!==(null===(n=e.messageConfig)||void 0===n?void 0:n.unreadEnabled)}isMessageReferUnread(e,t=0){var n=this.core.V2NIMMessageService.model.getMessageById(e.messageClientId);return n?this.isMessageUnread(n,t):e.createTime>t&&e.senderId!==this.core.account}countUnreadByMessageInMemory(e,t=0){var n=0;return this.core.V2NIMMessageService.model.getMessagesByConversationId(e).forEach(e=>{this.isMessageUnread(e,t)&&n++}),n}addFilter(e){var t=tu(e);if(void 0!==this.unreadCountByFilter[t])throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST});var n=JSON.parse(t),r=this.getUnreadCountByFilter(n);this.unreadCountByFilter[t]=r,this.service.emit("onUnreadCountChangedByFilter",n,r)}deleteFilter(e){var t=tu(e);if(void 0===this.unreadCountByFilter[t])throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});delete this.unreadCountByFilter[t]}markConversationRead(e){return Ce(this,void 0,void 0,function*(){var t=this.model.getById(e),n=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),r=this.core.V2NIMConversationIdUtil.parseConversationType(e),i=this.model.getReadTime(e);if(!t)return i||this.core.timeOrigin.getNTPTime();var o=this.service.compute.computeReadTimeForMark(t);return i>=o?(this.logger.log(`V2LocalConv::markConversationRead currentReadTime >= readTime ${e},${i},${o}`),i):(3===r?yield this.core.sendCmd("v2LocalConvSuperTeamMarkReadTime",{timetag:o,to:n}):yield this.core.sendCmd("v2LocalConvMarkReadTime",{scene:1===r?0:2===r?1:2,timetag:o,to:n}),this.model.updateReadTime(e,o),o)})}markMultiConversationRead(e){return Ce(this,void 0,void 0,function*(){var t={cmd:"v2LocalConvSuperTeamMultiMarkReadTime",params:[]},n={cmd:"v2LocalConvMultiMarkReadTime",params:[]};e.forEach(e=>{var r=this.model.getById(e);if(r){var i=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),o=this.core.V2NIMConversationIdUtil.parseConversationType(e),s=this.model.getReadTime(e),a=this.service.compute.computeReadTimeForMark(r);if(!(s>=a)){var c={conversationId:e,scene:1===o?0:2===o?1:2,timetag:a,to:i};3===o?t.params.push(c):n.params.push(c)}}});var r=xi(t.params,50),i=xi(n.params,50);for(var o of r){try{yield this.core.sendCmd(t.cmd,{tags:o})}catch(a){this.logger.warn("markMultiConversationRead::error:",o.map(e=>e.conversationId),a)}o.forEach(e=>{this.model.updateReadTime(e.conversationId,e.timetag)})}for(var s of i){try{yield this.core.sendCmd(n.cmd,{tags:s})}catch(a){this.logger.warn("markMultiConversationRead::error:",s.map(e=>e.conversationId),a)}s.forEach(e=>{this.model.updateReadTime(e.conversationId,e.timetag)})}})}setCurrentConversation(e){var t=this.currentConversationId;this.currentConversationId=e,this.currentConversationId&&this._setCurrConv(this.currentConversationId),t&&t!==this.currentConversationId&&(this._setCurrConvThrottle.flush(),this._setCurrConv(t))}_setCurrConv(e){var t=this.model.getById(e),n=(null==t?void 0:t.unreadCount)||0;t&&(t.unreadCount=0),t&&n>0&&(this.service.triggerConversationChanged([t]),this._digest()),this.markConversationRead(e).catch(e=>{this.logger.warn("_setConv markRead failed",e)})}}function tu(e){var{conversationTypes:t}=e;return t&&(t=t.sort()),JSON.stringify({conversationGroupId:e.conversationGroupId,conversationTypes:t,ignoreMuted:e.ignoreMuted})}function nu(e){return JSON.stringify(this)===tu(e)}function ru(e,t,n=0,r){var i,o;t=Xl(t,e);var{messageType:s,subType:a,text:c,attachment:l,serverExtension:d}=t,u="";if(t.senderId!==e.account&&5!==s){u=Ve(t,"fromNick");var p=null===(o=null===(i=e.V2NIMFriendService)||void 0===i?void 0:i.model)||void 0===o?void 0:o.getFriend(t.senderId);p&&p.alias&&(u=p.alias)}return JSON.parse(JSON.stringify({lastMessageState:n,messageRefer:Zl(e,t),messageType:s,subType:a,text:c,attachment:l,serverExtension:d,callbackExtension:t.callbackExtension,sendingState:r,senderName:u}))}function iu(e,t){return t&&t.length>0?t.map(t=>ou(e,t)):[]}function ou(e,t){var n=t;if("string"==typeof n.lastMessage)if(""===n.lastMessage);else if(1===n.lastMessageState){var r=ed(e,qt(JSON.parse(n.lastMessage),Wt(hd)));n.lastMessage=function(e,t){var{messageRefer:n,revokeAccountId:r,revokeType:i,callbackExtension:o,serverExtension:s,postscript:a}=t,c=function(e,t,n,r){var i,o,s,a,c,l,d,u;if(t!==e.account){var p=null===(o=null===(i=e.V2NIMFriendService)||void 0===i?void 0:i.model)||void 0===o?void 0:o.getFriend(t);if(p&&p.alias)return p.alias;if(2===n){var h=null===(a=null===(s=e.V2NIMTeamService)||void 0===s?void 0:s.memberModel)||void 0===a?void 0:a.getById(r,1,t);if(h&&h.teamNick)return h.teamNick}else if(3===n){var g=null===(l=null===(c=e.V2NIMTeamService)||void 0===c?void 0:c.memberModel)||void 0===l?void 0:l.getById(r,1,t);if(g&&g.teamNick)return g.teamNick}var m=null===(u=null===(d=e.V2NIMUserService)||void 0===d?void 0:d.model)||void 0===u?void 0:u.getUser(t);return m&&m.name?m.name:void 0}}(e,t.revokeAccountId,t.messageRefer.conversationType,t.messageRefer.receiverId)||"";return JSON.parse(JSON.stringify({lastMessageState:1,messageRefer:n,revokeAccountId:r,revokeType:i,callbackExtension:o,serverExtension:s,text:a||"",senderName:c}))}(e,r)}else if(0===n.lastMessageState){var i=qt(JSON.parse(n.lastMessage),Wt(ld));n.lastMessage=ru(e,i,n.lastMessageState,i.senderId===e.account?1:void 0)}else 2===n.lastMessageState&&delete n.lastMessage;return n}function su(e){var{version:t,deleteFlag:n}=e;return{conversation:be(e,["version","deleteFlag"]),version:t,deleteFlag:n}}!function(e){e[e.createConversation=1]="createConversation",e[e.deleteConversation=2]="deleteConversation",e[e.updateConversation=3]="updateConversation",e[e.setConversationTop=4]="setConversationTop",e[e.clearConversationUnread=5]="clearConversationUnread",e[e.addConversationToGroup=6]="addConversationToGroup",e[e.removeConversationFromGroup=7]="removeConversationFromGroup",e[e.modifyConversationOnSendMessage=8]="modifyConversationOnSendMessage",e[e.modifyConversationOnDeleteMessage=9]="modifyConversationOnDeleteMessage",e[e.modifyConversationOnRecallMessage=10]="modifyConversationOnRecallMessage",e[e.modifyConversationOnClearMessage=11]="modifyConversationOnClearMessage",e[e.oneClickClearConversationUnread=12]="oneClickClearConversationUnread",e[e.modifyConversationOnUpdateMessage=13]="modifyConversationOnUpdateMessage"}(Kd||(Kd={}));class au{constructor(e,t){this.core=e,this.service=t}get hasUserService(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}get hasFriendService(){var e;return!!(null===(e=this.core.V2NIMFriendService)||void 0===e?void 0:e.name)}get hasTeamService(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}get hasMessageService(){var e;return!!(null===(e=this.core.V2NIMMessageService)||void 0===e?void 0:e.name)}computeFromExternal(e){var t,n,r;if(0===e.type)return e;var i=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),o=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),s={};if((null===(t=this.core.V2NIMSettingService)||void 0===t?void 0:t.name)&&(s.mute=this.core.V2NIMSettingService.getConversationMuteStatus(e.conversationId)),1===i&&this.hasUserService){var a,c=this.core.V2NIMUserService.model.getUser(o),l=this.hasFriendService?this.core.V2NIMFriendService.model.getFriend(o):void 0;e.conversationId===(null===(n=e.lastMessage)||void 0===n?void 0:n.messageRefer.conversationId)&&(a=null===(r=e.lastMessage)||void 0===r?void 0:r.senderName),s.name=(null==l?void 0:l.alias)||(null==c?void 0:c.name)||a||o,s.avatar=(null==c?void 0:c.avatar)||""}else if(2===i&&this.hasTeamService){var d=this.core.V2NIMTeamService.model.getById(o,1);s.name=(null==d?void 0:d.name)||o,s.avatar=(null==d?void 0:d.avatar)||""}else if(3===i&&this.hasTeamService){var u=this.core.V2NIMTeamService.model.getById(o,2);s.name=(null==u?void 0:u.name)||o,s.avatar=(null==u?void 0:u.avatar)||""}return Object.assign(e,s),e}computeSortOrder(e,t){return t?e?t+1e15:t:e?1e15:0}computeReadTimeForMark(e){var t,n,r,i=e.conversationId,o=this.service.model.getReadTime(i);if(null===(n=null===(t=null==e?void 0:e.lastMessage)||void 0===t?void 0:t.messageRefer)||void 0===n?void 0:n.createTime)r=e.lastMessage.messageRefer.createTime;else{if(0===e.unreadCount&&o>0)return o;if(!this.core.timeOrigin.checkNodeReliable())return o||0;r=this.core.timeOrigin.getNTPTime()}return r}computeConvWithLastMsg(e,t){var n,r=t||this.core.V2NIMMessageService.model.getLastMessageOfConversation(e.conversationId);if(r&&!1!==(null===(n=r.messageConfig)||void 0===n?void 0:n.lastMessageUpdateEnabled)){var i=ru(this.core,r,0,r.sendingState);e.lastMessage=i,e.createTime=e.createTime||r.createTime,e.updateTime=r.createTime,e.sortOrder=this.computeSortOrder(e.stickTop,r.createTime)}return e}computeConvWithUnread(e,t){var n=this.service.model.getReadTime(e.conversationId),r=this.service.unread.currentConversationId;if(r&&(null==t?void 0:t.conversationId)===r)return e.unreadCount=0,this.service.unread._setCurrConvThrottle(),e;var i=e.unreadCount||0;return t?t&&this.service.unread.isMessageUnread(t)&&(i+=1):i=this.service.unread.countUnreadByMessageInMemory(e.conversationId,n),e.unreadCount=i,e}computeConvByMsgsCache(e,t){var n,r=this.service.model.getById(e),i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=this.core.V2NIMMessageService.model.getLastMessageOfConversation(e),s=0;s=(null==t?void 0:t.updateTime)||(o&&o.createTime?o.createTime:r&&r.updateTime?r.updateTime:this.core.timeOrigin.getNTPTime());var a=this.service.model.getStickTop(e),c=Object.assign(Object.assign({conversationId:e,type:i,stickTop:a,localExtension:(null==r?void 0:r.localExtension)||"",lastMessage:null,unreadCount:0},t),{createTime:(null==r?void 0:r.createTime)||s,updateTime:s,sortOrder:this.computeSortOrder(a,s)});if(o&&!1!==(null===(n=o.messageConfig)||void 0===n?void 0:n.lastMessageUpdateEnabled)){var l=ru(this.core,o,0,o.sendingState);c.lastMessage=l}return c}}class cu{constructor(e,t){this.core=e,this.service=t,this.model=this.service.model,this.logger=this.core.logger}v2LocalConvSyncStickTopHandler(e){var{timetag:t,isThereAnyChange:n,datas:r}=e.content;if(n){var i=this.model.getAll(),o=r.map(e=>{var{target:t,type:n}=Hd(e.id),r=this.core.V2NIMConversationIdUtil.conversationId(n,t);return this.model.updateStickTop(r,!0),r});i.forEach(e=>{o.includes(e.conversationId)?(e.stickTop=!0,e.updateTime=e.updateTime>t?e.updateTime:t):e.stickTop=!1,this.model.updateStickTop(e.conversationId,e.stickTop)}),this.model.bulkUpsert(i)}}v2LocalConvSyncReadTimeHandler(e){var t=e.content.p2p||{},n=e.content.team.m_map||{};this.logger.log("v2SyncLocalConvAck::",t,n),Object.keys(t).forEach(e=>{var n=this.core.V2NIMConversationIdUtil.p2pConversationId(e),r=this.model.getReadTime(n);t[e]>r&&(this.model.updateReadTime(n,t[e]),this.service.emit("onConversationReadTimeUpdated",n,t[e]))}),Object.keys(n).forEach(e=>{var t=this.core.V2NIMConversationIdUtil.teamConversationId(e),r=this.model.getReadTime(t);n[e]>r&&(this.model.updateReadTime(t,n[e]),this.service.emit("onConversationReadTimeUpdated",t,n[e]))})}v2LocalConvSyncSuperTeamReadTimeHandler(e){var t=e.content.superTeam.m_map;this.logger.log("v2SyncLocalSuperTeamConvAck::",t),Object.keys(t).forEach(e=>{var n=this.core.V2NIMConversationIdUtil.superTeamConversationId(e),r=this.model.getReadTime(n);t[e]>r&&(this.model.updateReadTime(n,t[e]),this.service.emit("onConversationReadTimeUpdated",n,t[e]))})}v2LocalConvMultiSyncReadTimeHandler(e){var t=e.content,n=`${0===t.scene?"p2p":1===t.scene?"team":"super_team"}-${t.to}`,{type:r,target:i}=Hd(n,"-"),o=this.core.V2NIMConversationIdUtil.conversationId(r,i),s=this.model.getById(o),a=null==s?void 0:s.unreadCount,c=this.model.getReadTime(o);t.timetag<=c?this.logger.warn(`v2LocalConvMultiSyncReadTimeHandler: ${o} do not need update ack ${t.timetag}/${c}`):(this.model.updateReadTime(o,t.timetag),this.service.emit("onConversationReadTimeUpdated",o,t.timetag),s?(s=this.service.compute.computeConvWithUnread(s),this.model.upsert(s),this.service.unread.digestUnreadCountChange(),void 0===a&&s.unreadCount>0?this.service.triggerConversationCreated(s):"number"==typeof a&&s.unreadCount!==a&&this.service.triggerConversationChanged([s])):this.logger.log(`v2LocalConvMultiSyncReadTimeHandler: ${o} not exist`))}v2LocalConvSuperTeamMultiSyncReadTimeHandler(e){this.v2LocalConvMultiSyncReadTimeHandler(e)}v2LocalConvStickTopMultiSyncAddHandler(e){var{data:t}=e.content,{target:n,type:r}=Hd(t.id),i=this.core.V2NIMConversationIdUtil.conversationId(r,n);this.model.updateStickTop(i,!0);var o=this.model.getById(i);o&&(o.stickTop=!0,o.updateTime=o.updateTime>t.updateTime?o.updateTime:t.updateTime,o.sortOrder=this.service.compute.computeSortOrder(!0,t.updateTime),this.model.upsert(o),this.service.triggerConversationChanged([o]))}v2LocalConvStickTopMultiSyncDeleteHandler(e){var{data:t,timetag:n}=e.content,{target:r,type:i}=Hd(t.id),o=this.core.V2NIMConversationIdUtil.conversationId(i,r);this.model.updateStickTop(o,!1);var s=this.model.getById(o);s&&(s.stickTop=!1,s.updateTime=s.updateTime>n?s.updateTime:n,s.sortOrder=this.service.compute.computeSortOrder(!1,n),this.model.upsert(s),this.service.triggerConversationChanged([s]))}}class lu{constructor(e,t){this.core=e,this.service=t,this.model=this.service.model,this.compute=this.service.compute,this.logger=this.core.logger}setListener(){this.core.eventBus.on("V2NIMLoginService/syncing",()=>this.service.emit("onSyncStarted")),this.core.eventBus.on("V2NIMLoginService/syncDone",this.onSyncDone.bind(this)),this.core.eventBus.on("V2NIMMessageService/sendMessage",this.sendMsg.bind(this)),this.core.eventBus.on("V2NIMMessageService/onMsg",this.recvMsg.bind(this)),this.core.eventBus.on("V2NIMMessageService/modifyMsg",this.modifyMsg.bind(this)),this.core.eventBus.on("V2NIMMessageService/deleteMessages",this.deleteMessages.bind(this)),this.core.eventBus.on("V2NIMMessageService/revokeMessages",this.deleteMessages.bind(this)),this.core.eventBus.on("V2NIMMessageLogUtil/onClearHistoryNotifications",this.clearMessages.bind(this)),this.core.eventBus.on("V2NIMMessageService/roamingMsgs",this.generateConv.bind(this)),this.core.eventBus.on("V2NIMMessageService/offlineMsgs",this.generateConv.bind(this)),this.core.eventBus.on("V2NIMSettingService/setMute",this.setMute.bind(this))}beforeEmit(e,...t){var n,r=`${this.service.name}::emit ${e.toString()}`;if("onConversationCreated"===e){var i=t[0],o=null===(n=i.lastMessage)||void 0===n?void 0:n.messageRefer;this.logger.log(`${r}`,`id:${i.conversationId};unread:${i.unreadCount};lastMsg:${(null==o?void 0:o.messageClientId)||""}/${(null==o?void 0:o.messageServerId)||""}`)}else if("onConversationChanged"===e){var s=t[0];this.logger.log(`${r}`,s.map(e=>{var t,n=null===(t=e.lastMessage)||void 0===t?void 0:t.messageRefer;return`id:${e.conversationId};unread:${e.unreadCount};lastMsg:${(null==n?void 0:n.messageClientId)||""}/${(null==n?void 0:n.messageServerId)||""}`}))}else this.logger.log(`${r}`,...t)}onSyncDone(e){if(e)this.service.emit("onSyncFailed",e);else{var t=this.model.getAll();(t=t.map(e=>{var t=e.conversationId,n=this.compute.computeConvByMsgsCache(t);return n=this.compute.computeConvWithUnread(n),n=this.compute.computeFromExternal(n),this.model.upsert(n),this.model.getById(t)})).length>0&&(this.service.triggerConversationChanged(t),this.service.unread.resetTotalAfterSyncDone()),this.service.emit("onSyncFinished")}}generateConv(e){En(e.map(e=>e.conversationId)).forEach(e=>{var t=this.compute.computeConvByMsgsCache(e);this.model.upsert(t)})}setMute(e,t){var n=this.model.getById(e);n&&n.mute!==t&&(n.mute=t,this.model.upsert(n),this.service.triggerConversationChanged([n]))}deleteMessages(e){var t=new Set;e.forEach(e=>{var n,r=e.messageRefer.conversationId,i=this.model.getById(r);if(i){if(e.messageRefer.messageClientId===(null===(n=i.lastMessage)||void 0===n?void 0:n.messageRefer.messageClientId)){t.add(r);var o=this.core.V2NIMMessageService.model.getLastMessageOfConversation(r);i.lastMessage=o?ru(this.core,o,0,o.sendingState):void 0}var s=this.model.getReadTime(r);if(i.unreadCount>0&&this.service.unread.isMessageReferUnread(e.messageRefer,s)&&(t.add(r),i.unreadCount--),"deleteTime"in e)e.deleteTime>i.updateTime&&(i.updateTime=e.deleteTime,i.sortOrder=this.compute.computeSortOrder(i.stickTop,i.updateTime));else{var a=this.core.timeOrigin.getNTPTime();i.updateTime=a,i.sortOrder=this.compute.computeSortOrder(i.stickTop,a)}this.model.upsert(i)}});var n=Array.from(t);!this.core.V2NIMLoginService.dataSync.checkSyncing()&&n.length>0&&(this.service.triggerConversationChanged(n.map(e=>this.model.getById(e))),this.service.unread.digestUnreadCountChange())}sendMsg(e){var t=e.conversationId,n=this.model.getById(t);if(n){var r=n.lastMessage,i=this.updateCauseMessage(n,e);r!==i.lastMessage&&this.service.triggerConversationChanged([i])}else{var o=this.createCauseMessage(t,e);if(!o)return;this.service.triggerConversationCreated(o)}}recvMsg(e){var t=e.conversationId,n=this.model.getById(t);if(n){var r=n.lastMessage,i=n.unreadCount,o=this.updateCauseMessage(n,e);o=this.compute.computeConvWithUnread(o,e);var s=r!==(o=this.compute.computeFromExternal(o)).lastMessage,a=i!==o.unreadCount;this.model.upsert(o),(s||a)&&this.service.triggerConversationChanged([o])}else{var c=this.createCauseMessage(t,e);if(!c)return;c=this.compute.computeConvWithUnread(c,e),c=this.compute.computeFromExternal(c),this.model.upsert(c),this.service.triggerConversationCreated(c)}this.service.unread.digestUnreadCountChange()}updateCauseMessage(e,t){return e=this.compute.computeConvWithLastMsg(e,t),this.model.upsert(e),this.model.getById(e.conversationId)}createCauseMessage(e,t){var n,r,i;if(!1!==(null===(n=t.messageConfig)||void 0===n?void 0:n.unreadEnabled)||!1!==(null===(r=t.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled)){var o=this.core.V2NIMConversationIdUtil.parseConversationType(e),s=this.model.getStickTop(e),a=!1===(null===(i=t.messageConfig)||void 0===i?void 0:i.lastMessageUpdateEnabled)?void 0:ru(this.core,t,0,t.sendingState),c=this.core.timeOrigin.getNTPTime(),l={conversationId:e,type:o,createTime:a?t.createTime:c,updateTime:a?t.createTime:c,sortOrder:this.compute.computeSortOrder(s,a?t.createTime:c),stickTop:s,localExtension:"",lastMessage:a,unreadCount:0};return this.model.upsert(l),l}}clearMessages(e){var t=new Set;e.forEach(e=>{var{conversationId:n,deleteTime:r}=e,i=this.model.getById(n);i&&(i.unreadCount>0&&(i.unreadCount=0,t.add(n)),i.lastMessage&&i.lastMessage.messageRefer.createTime<=e.deleteTime&&(i.lastMessage=void 0,t.add(n)),r>i.updateTime&&(i.updateTime=r,i.sortOrder=this.compute.computeSortOrder(i.stickTop,i.updateTime)),this.model.upsert(i))});var n=Array.from(t);!this.core.V2NIMLoginService.dataSync.checkSyncing()&&n.length>0&&(this.service.triggerConversationChanged(n.map(e=>this.model.getById(e))),this.service.unread.digestUnreadCountChange())}modifyMsg(e){var t,n=e.conversationId,r=e.messageClientId,i=this.model.getById(n),o=this.core.V2NIMMessageService.model.getMessageById(r);if(i||o)if(i)e.messageClientId===(null===(t=i.lastMessage)||void 0===t?void 0:t.messageRefer.messageClientId)&&(i.lastMessage=ru(this.core,e,0,e.sendingState),this.service.triggerConversationChanged([i]));else{var s=this.createCauseMessage(n,e);if(!s)return;this.service.triggerConversationCreated(s)}}}var du={type:"array",itemRules:{type:"enum",values:[1,2,3]},min:1};class uu{constructor(){this.map=new Map,this.readTimeMap=new Map}set(e){e.forEach(e=>{e=this.processConversation(e),this.map.set(e.conversationId,e)})}reset(){this.map.clear(),this.readTimeMap.clear()}count(){return this.map.size}sort(){var e=Array.from(this.map.values());e.sort((e,t)=>t.sortOrder-e.sortOrder),this.map.clear(),e.forEach(e=>{this.map.set(e.conversationId,e)})}processConversation(e){return"string"==typeof e.lastMessage&&delete e.lastMessage,void 0===e.localExtension&&(e.localExtension=""),e}getById(e){return this.map.get(e)}getStickTopList(){return Array.from(this.map.values()).filter(e=>e.stickTop).sort((e,t)=>t.sortOrder-e.sortOrder)}getAll(){return Array.from(this.map.values()).sort((e,t)=>t.sortOrder-e.sortOrder)}getByOption(e,t,n){var{conversationTypes:r,onlyUnread:i,conversationGroupIds:o}=n,s=[];this.map.forEach(e=>{if((!(r&&r.length>0)||r.includes(e.type))&&(!i||e.unreadCount)&&(!n.ignoreMuted||!e.mute)){if(o){var t=e.groupIds,a=(null==t?void 0:t.length)||0;if(0===o.length&&a>0)return;if(o.length>0&&0===a)return;if(o.length>0&&a>0&&!o.some(e=>t&&t.includes(e)))return}s.push(e)}}),s=s.sort((e,t)=>t.sortOrder-e.sortOrder);var a=0;e>0&&(a=ze(s,"sortOrder",e),s[a]&&s[a].sortOrder===e&&(a+=1));var c=s.slice(a).length;return(s=s.slice(a,a+t)).length>0?{offset:c>t?s[s.length-1].sortOrder:0,finished:!(c>t),conversationList:s}:{offset:0,finished:!0,conversationList:s}}upsert(e){var t=e.conversationId,n=this.map.get(t);if(!n)return e=this.processConversation(Object.assign({},e)),this.map.set(t,e),e.unreadCount>0;var r=e.unreadCount!==n.unreadCount,i=Object.assign({},n,e);return i=this.processConversation(i),this.map.set(t,i),r}bulkUpsert(e){var t=!1;return e.forEach(e=>{this.upsert(e)&&(t=!0)}),t}deleteById(e){var t=this.getById(e);if(t)return this.map.delete(e),t}updateReadTime(e,t){this.readTimeMap.set(e,t)}getReadTime(e){return this.readTimeMap.get(e)||0}}function pu(e,t){var n=typeof e;if(n!==typeof t)return!1;if("object"===n){if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!pu(e[r],t[r]))return!1;return!0}if(e instanceof RegExp&&t instanceof RegExp)return e.toString()===t.toString();if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(null===e&&null===t)return!0;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var i in e)if(!pu(e[i],t[i]))return!1;return!0}return e===t}class hu{constructor(e,t){this.fieldVersion={},this.conversationIdsForBackFill={},this.tempPacket=[],this.isSyncing=!1,this.nextCursor=0,this.core=e,this.service=t}reset(){this.tempPacket=[],this.fieldVersion={},this.conversationIdsForBackFill={},this.isSyncing=!1,this.nextCursor=0}doSync(){return Ce(this,void 0,void 0,function*(){var e;this.isSyncing=!0,this.service.emit("onSyncStarted"),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:2,subType:"conversationSync"});try{e=yield this.core.sendCmd("v2ConversationSync",{tag:{cursor:this.nextCursor}})}catch(i){var t=i;if(t.code===le.V2NIM_ERROR_CODE_CANCELLED)return;return this.isSyncing=!1,this.service.emit("onSyncFailed",t),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:t,subType:"conversationSync"}),void this.processTempPacket()}var n=0===parseInt(Ve(e,"content.info.syncType")),r=Ve(e,"content.info.nextCursor");this.doSyncAndSuccess(n,r)})}doSyncAndSuccess(e,t){e&&this.service.model.sort(),this.isSyncing=!1,this.nextCursor=parseInt(t)||0,this.service.unread.resetTotalAfterSyncDone(),this.service.unread.digestUnreadCountChange(),this.service.emit("onSyncFinished"),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,subType:"conversationSync"}),this.processTempPacket()}setBackFillIds(e){return e.forEach(e=>{if(2===e.lastMessageState&&this.service.compute.hasMessageService){this.conversationIdsForBackFill[e.conversationId]=!0;var t=this.core.V2NIMMessageService.model.getLastMessageOfConversation(e.conversationId);e.lastMessage=t?ru(this.core,t,e.lastMessageState,t.sendingState):""}else this.conversationIdsForBackFill[e.conversationId]=!1;delete e.lastMessageState}),e}recvConversationFromSyncAction(e){var{syncType:t}=Ve(e,"content.info"),n=iu(this.core,Ve(e,"content.datas"));0===(t=parseInt(t))?(n.forEach(e=>{this.initFieldVersion(e.conversationId,e.version)}),n=this.setBackFillIds(n),this.setModel(n)):(n=this.setBackFillIds(n),this.recvConversationForCreated(n)<n.length&&this.recvConversationForChanged(n))}recvConversation(e){if(this.isSyncing)this.tempPacket.push(e);else{var t=iu(this.core,Ve(e,"content.datas")).filter(e=>!!e.conversationId),n=Ve(e,"content.info"),r=t.map(e=>`id:${e.conversationId}, ver:${e.version}`).join(";");if(this.core.logger.getDebugMode()?this.core.logger.debug(`V2NIMConversation::recvConversation: ${r}.`,n,t):this.core.logger.log(`V2NIMConversation::recvConversation: ${r}.`,n),2===n.type){var i=t.map(e=>(delete this.fieldVersion[e.conversationId],this.service.model.deleteById(e.conversationId),e.conversationId));return this.service.emit("onConversationDeleted",i),void this.service.unread.digestUnreadCountChange()}12!==n.type?(n.type,t=this.setBackFillIds(t),this.recvConversationForCreated(t)<t.length&&this.recvConversationForChanged(t)):this.compareAndClearUnreadInModel(n)}}recvConversationForCreated(e){var t=e.filter(e=>!this.fieldVersion[e.conversationId]);return t.reduce((e,t)=>{if(!this.fieldVersion[t.conversationId]){this.initFieldVersion(t.conversationId,t.version),e=!!this.updateModel(t)||e;var n=this.service.model.getById(t.conversationId);return n&&this.service.triggerConversationCreated(n),e}return e},!1)&&this.service.unread.digestUnreadCountChange(),t.length}recvConversationForChanged(e){var t=this.bulkCompare(e);if(0!==t.length){this.bulkUpdateModel(t);var n=t.map(e=>this.service.model.getById(e.conversationId)).filter(e=>!!e);this.service.triggerConversationChanged(n)}}processTempPacket(){this.tempPacket.forEach(e=>{this.recvConversation(e)}),this.tempPacket=[]}bulkCompare(e){return e.map(e=>this.compare(e)).filter(e=>!!e)}compare(e){var{version:t,conversationId:n,deleteFlag:r,type:i}=e,o={},s=0;return["stickTop","groupIds","serverExtension","localExtension","lastMessage","lastMessageState","unreadCount","sortOrder","createTime","updateTime","lastReadTime"].forEach(r=>{var i=r;if(void 0!==e[i]){var a=this.fieldVersion[n];a&&"number"==typeof a[i]&&a[i]>=t||(this.fieldVersion[n]=this.fieldVersion[n]||{},this.fieldVersion[n][i]=t,o[i]=e[i],s+=1)}}),s?Object.assign(Object.assign({},o),{conversationId:n,deleteFlag:r,version:t,type:i}):void 0}bulkUpdateModel(e){var t=!1;e.forEach(e=>{this.updateModel(e)&&(t=!0)}),t&&this.service.unread.digestUnreadCountChange()}initFieldVersion(e,t){this.fieldVersion[e]={stickTop:t,groupIds:t,serverExtension:t,lastMessage:t,lastMessageState:t,unreadCount:t,sortOrder:t,createTime:t,updateTime:t,lastReadTime:t}}initConversation(e,t){var n=Date.now();return Object.assign({conversationId:e,type:this.core.V2NIMConversationIdUtil.parseConversationType(e),stickTop:!1,localExtension:"",serverExtension:"",unreadCount:0,lastReadTime:0,createTime:n,updateTime:n,sortOrder:n},t)}updateModel(e){var{deleteFlag:t,conversation:n}=su(e);if(t){var r=this.service.model.deleteById(n.conversationId);return!!(r&&r.unreadCount>0)}return this.service.model.upsert(n)}setModel(e){var t=e.filter(e=>!e.deleteFlag).map(e=>su(e).conversation);this.service.model.set(t)}updateModelWithLastMessage(e,t,n,r){var i=this.service.model.getById(e),o=t?ru(this.core,t,n,r):void 0;if(!pu(null==i?void 0:i.lastMessage,o))if(i){var s=Object.assign(Object.assign({},i),{sortOrder:o?i.stickTop?o.messageRefer.createTime+1e15:o.messageRefer.createTime:i.sortOrder,lastMessage:o});this.service.model.upsert(s),this.service.triggerConversationChanged([s])}else{this.initFieldVersion(e,-1);var a=this.initConversation(e,{lastMessage:o});this.service.model.upsert(a),this.service.triggerConversationCreated(a)}}updateModelByRevoke(e){var t=[];e.forEach(e=>{var{postscript:n,messageRefer:r}=e,i=be(e,["postscript","messageRefer"]),o=r.conversationId,s=this.service.model.getById(o);s&&s.lastMessage&&s.lastMessage.messageRefer.messageClientId===r.messageClientId&&1!==s.lastMessage.lastMessageState&&(s.lastMessage.lastMessageState=1,n&&(s.lastMessage.text=n),Object.assign(s.lastMessage,i),this.service.model.upsert(s),t.push(s))}),t.length>0&&this.service.triggerConversationChanged(t)}compareAndUpdateModel(e){this.core.logger.log("V2NIMConversation::compareAndUpdateModel",e.map(e=>e.conversationId));var t=!1,n=[];e.forEach(e=>{var r=this.compare(e);if(r){var i=this.service.model.getById(e.conversationId);this.updateModel(r)&&(t=!0);var o=this.service.model.getById(e.conversationId);o&&(i?n.push(o):this.service.triggerConversationCreated(o))}}),n.length>0&&this.service.triggerConversationChanged(n),t&&this.service.unread.digestUnreadCountChange()}compareAndDeleteModel(e){this.core.logger.log("V2NIMConversation::compareAndDeleteModel",e);var t=e.reduce((e,t)=>{delete this.fieldVersion[t];var n=this.service.model.deleteById(t);return!!(n&&n.unreadCount>0)||e},!1);this.service.emit("onConversationDeleted",e),t&&this.service.unread.digestUnreadCountChange()}compareAndDeleteGroupInModel(e,t){this.core.logger.log("V2NIMConversation::compareAndDeleteGroupInModel",e,t);var n=[];Object.keys(this.fieldVersion).forEach(r=>{var i=this.fieldVersion[r];if(void 0===i.groupIds||e>i.groupIds){i.groupIds=e;var o=this.service.model.getById(r);if(o&&o.groupIds&&o.groupIds.length>0){var s=o.groupIds.filter(e=>e!==t);if(s.length!==o.groupIds.length){var a=Object.assign(Object.assign({},o),{groupIds:s});this.service.model.upsert(a),a&&n.push(a)}}}}),n.length>0&&this.service.triggerConversationChanged(n)}compareAndClearUnreadInModel(e){var{oneClickClearUnreadType:t,oneClickClearUnreadVersion:n,oneClickClearUnreadLastReadTime:r,oneClickClearUnreadConversationType:i,oneClickClearUnreadGroupId:o}=e;this.core.logger.log(`V2NIMConversation::compareAndClearUnreadInModel.ver:${n};type:${t};lastReadTime:${r};filter:${i||""};grounp:${o||""}`);var s=[],a=[];if(1===t)a=this.service.model.getAll();else if(i||o){var c=this.service.model.count();a=this.service.model.getByOption(0,c,{conversationTypes:i,conversationGroupIds:o?[o]:void 0}).conversationList}a.forEach(e=>{var t=e.conversationId,i=this.fieldVersion[t];if(void 0===i.unreadCount||n>i.unreadCount){i.unreadCount=n,i.lastReadTime=n;var o=e.unreadCount,a=Object.assign(Object.assign({},e),{lastReadTime:r,unreadCount:0});this.service.model.upsert(a),o>0&&s.push(a)}}),s.length>0&&this.service.triggerConversationChanged(s),this.service.unread.digestUnreadCountChange()}backfillLastMsg(e,t){var n=e=En(e);(t||0!==(n=e.filter(e=>this.conversationIdsForBackFill[e])).length)&&n.forEach(e=>{var t=Ve(this.service.model.getById(e),"lastMessage.messageRefer.messageClientId"),n=this.service.compute.hasMessageService?this.core.V2NIMMessageService.model.getLastMessageOfConversation(e):void 0;(n&&n.messageClientId)!==t&&(this.conversationIdsForBackFill[e]=!1,n?this.updateModelWithLastMessage(e,n,2,n.sendingState):this.updateModelWithLastMessage(e,void 0,2,0))})}}var gu={"28_1":"v2ConversationCreate","28_2":"v2ConversationDelete","28_3":"v2ConversationUpdate","28_4":"v2ConversationSetTop","28_5":"v2ConversationUnreadClear","28_6":"v2ConversationGet","28_7":"v2ConversationGetByIds","28_8":"v2ConversationGetList","28_17":"v2ConversationsDelete","28_18":"v2ConversationsUnreadClear","28_19":"v2ConversationSync","28_20":"v2ConversationNotifySync","28_21":"v2ConversationNotifySyncOnline","28_23":"v2ConversationClearTotalUnread","28_24":"v2ConversationClearTypeUnread","28_25":"v2ConversationClearGroupUnread","4_14":"syncConversationReadTime","4_20":"syncSuperTeamReadTime","4_22":"v2SyncSessionsWithMoreRoaming","4_25":"v2SyncSessionReliableInfo","30_16":"v2MarkConversationReadTime","32_25":"v2MarkSuperTeamReadTime","7_116":"v2MultiDeviceConversationReadTime","21_125":"v2MultiDeviceSuperTeamReadTime"},mu="V2NIMConversationService",fu={conversationId:1,type:{id:2,retType:"number"},serverExtension:3,groupIds:{id:4,retConverter:e=>e?JSON.parse(e):void 0},lastMessage:5,lastMessageState:{id:6,retType:"number"},unreadCount:{id:7,retType:"number"},stickTop:{id:8,retType:"boolean"},sortOrder:{id:9,retType:"number"},version:{id:10,retType:"number"},deleteFlag:{id:11,retType:"boolean"},createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"},lastReadTime:{id:14,retType:"number"}},vu={type:{id:1,retType:"number"},oneClickClearUnreadType:{id:2,retType:"number"},oneClickClearUnreadConversationType:{id:3,retConverter:Jt},oneClickClearUnreadGroupId:{id:4,retType:"string"},oneClickClearUnreadVersion:{id:5,retType:"number"},oneClickClearUnreadLastReadTime:{id:6,retType:"number"}},yu={v2ConversationCreate:{sid:28,cid:1,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Wt(fu)}]},v2ConversationDelete:{sid:28,cid:2,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,clearMessage:2}}],response:[{type:"Property",name:"data",reflectMapper:Wt(fu)}]},v2ConversationUpdate:{sid:28,cid:3,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,serverExtension:2}}],response:[{type:"Property",name:"data",reflectMapper:Wt(fu)}]},v2ConversationSetTop:{sid:28,cid:4,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,stickTop:2}}],response:[{type:"Property",name:"data",reflectMapper:Wt(fu)}]},v2ConversationUnreadClear:{sid:28,cid:5,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Wt(fu)}]},v2ConversationGet:{sid:28,cid:6,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Wt(fu)}]},v2ConversationGetByIds:{sid:28,cid:7,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(fu)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGetList:{sid:28,cid:8,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(fu)},{type:"Property",name:"info",reflectMapper:{1:"hasMore",2:"offset"}}]},v2ConversationsDelete:{sid:28,cid:17,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,clearMessage:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(fu)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationsUnreadClear:{sid:28,cid:18,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(fu)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationSync:{sid:28,cid:19,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}}]},v2ConversationNotifySync:{sid:28,cid:20,service:mu,response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}},{type:"PropertyArray",name:"datas",reflectMapper:Wt(fu)}]},v2ConversationNotifySyncOnline:{sid:28,cid:21,service:mu,response:[{type:"Property",name:"info",reflectMapper:Wt(vu)},{type:"PropertyArray",name:"datas",reflectMapper:Wt(fu)}]},v2ConversationClearTotalUnread:{sid:28,cid:23,service:mu,response:[{type:"Property",name:"info",reflectMapper:Wt(vu)}]},v2ConversationClearTypeUnread:{sid:28,cid:24,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{conversationType:1}}],response:[{type:"Property",name:"info",reflectMapper:Wt(vu)}]},v2ConversationClearGroupUnread:{sid:28,cid:25,service:mu,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:Wt(vu)}]},syncConversationReadTime:{sid:4,cid:14,service:mu,response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamReadTime:{sid:4,cid:20,service:mu,response:[{type:"LongLongMap",name:"superTeam"}]},v2SyncSessionsWithMoreRoaming:{sid:4,cid:22,service:mu,response:[]},v2SyncSessionReliableInfo:{sid:4,cid:25,service:mu,response:[]},v2MarkConversationReadTime:{sid:30,cid:16,service:mu,params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MarkSuperTeamReadTime:{sid:32,cid:25,service:mu,params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceConversationReadTime:{sid:30,cid:116,service:mu,response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceSuperTeamReadTime:{sid:21,cid:125,service:mu,response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]}};class _u{constructor(e,t){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.core=e,this.service=t}reset(){this.totalUnreadCount=void 0,this.unreadCountByFilter={}}getTotalUnreadCount(){return this.totalUnreadCount}resetTotalAfterSyncDone(){var e=this.service.model.getAll().reduce((e,t)=>e+(t.unreadCount||0),0),t=this.totalUnreadCount;return void 0!==t&&t===e||(this.totalUnreadCount=e,this.service.emit("onTotalUnreadCountChanged",e)),e}digestUnreadCountChange(){this._digest()}_digest(){var e=this.totalUnreadCount,t=this.service.model.getAll().reduce((e,t)=>e+(t.unreadCount||0),0);this.core.logger.log(`V2NIMConversation::digestUnreadCountChange:oldUnreadCount ${e}, newUnreadCount ${t}`),e!==t&&(this.totalUnreadCount=t,this.service.emit("onTotalUnreadCountChanged",t)),Object.keys(this.unreadCountByFilter).forEach(e=>{var t=JSON.parse(e),n=this.getUnreadCountByFilter(t),r=this.unreadCountByFilter[e];this.unreadCountByFilter[e]=n,t.equals=Tu.bind(t),r!==n&&this.service.emit("onUnreadCountChangedByFilter",t,n)})}getUnreadCountByIds(e){return e.reduce((e,t)=>{var n=this.service.model.getById(t);return e+(n&&n.unreadCount||0)},0)}getUnreadCountByFilter(e){var t=this.service.model.count();return this.service.model.getByOption(0,t,{conversationTypes:e.conversationTypes,conversationGroupIds:e.conversationGroupId?[e.conversationGroupId]:void 0,ignoreMuted:e.ignoreMuted}).conversationList.reduce((e,t)=>e+(t.unreadCount||0),0)}addFilter(e){var t=Iu(e);if(void 0!==this.unreadCountByFilter[t])throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST});var n=JSON.parse(t),r=this.getUnreadCountByFilter(n);this.unreadCountByFilter[t]=r,this.service.emit("onUnreadCountChangedByFilter",n,r)}deleteFilter(e){var t=Iu(e);if(void 0===this.unreadCountByFilter[t])throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});delete this.unreadCountByFilter[t]}}function Iu(e){var{conversationTypes:t}=e;return t&&(t=t.sort()),JSON.stringify({conversationGroupId:e.conversationGroupId,conversationTypes:t,ignoreMuted:e.ignoreMuted})}function Tu(e){return JSON.stringify(this)===Iu(e)}var Su={createTime:{type:"number"},updateTime:{type:"number"}};function Eu(e){return e&&e.length>0?e.map(e=>Mu(e)):[]}function Mu(e){return an(Su,e)}function bu(e){var t=JSON.parse(e);return Object.keys(t).map(e=>({conversationId:e,error:new pe({code:t[e]})}))}var Cu,Au={type:{type:"number"},deleteVersion:{type:"number"},conversationIds:{type:"object"}};function Ou(e){return an(Au,e)}!function(e){e[e.createConversationGroup=1]="createConversationGroup",e[e.deleteConversationGroup=2]="deleteConversationGroup",e[e.updateConversationGroup=3]="updateConversationGroup",e[e.addConversationToGroup=4]="addConversationToGroup",e[e.removeConversationFromGroup=5]="removeConversationFromGroup"}(Cu||(Cu={}));class Ru{constructor(e,t){this.core=e,this.service=t}get hasUserService(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}get hasFriendService(){var e;return!!(null===(e=this.core.V2NIMFriendService)||void 0===e?void 0:e.name)}get hasTeamService(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}get hasMessageService(){var e;return!!(null===(e=this.core.V2NIMMessageService)||void 0===e?void 0:e.name)}computeConvs(e){return e.map(e=>this.computeConv(e))}computeConv(e){var t,n,r,i,o;if(0===e.type)return e;var s=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),a=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),c={};if(e.lastReadTime||(c.lastReadTime=this.service.model.getReadTime(e.conversationId)),(null===(t=this.core.V2NIMSettingService)||void 0===t?void 0:t.name)&&(c.mute=this.core.V2NIMSettingService.getConversationMuteStatus(e.conversationId)),1===s&&this.hasUserService){var l,d=this.core.V2NIMUserService.model.getUser(a),u=this.hasFriendService?this.core.V2NIMFriendService.model.getFriend(a):void 0;e.conversationId!==(null===(n=e.lastMessage)||void 0===n?void 0:n.messageRefer.conversationId)||0!==(null===(r=e.lastMessage)||void 0===r?void 0:r.lastMessageState)&&2!==(null===(i=e.lastMessage)||void 0===i?void 0:i.lastMessageState)||(l=null===(o=e.lastMessage)||void 0===o?void 0:o.senderName),c.name=(null==u?void 0:u.alias)||(null==d?void 0:d.name)||l||a,c.avatar=(null==d?void 0:d.avatar)||""}else if(2===s&&this.hasTeamService){var p=this.core.V2NIMTeamService.model.getById(a,1);c.name=(null==p?void 0:p.name)||a,c.avatar=(null==p?void 0:p.avatar)||""}else if(3===s&&this.hasTeamService){var h=this.core.V2NIMTeamService.model.getById(a,2);c.name=(null==h?void 0:h.name)||a,c.avatar=(null==h?void 0:h.avatar)||""}return Object.assign(e,c),e}computeReadTimeForMark(e){var t,n,r,i=e.conversationId,o=this.service.model.getReadTime(i);if(null===(n=null===(t=null==e?void 0:e.lastMessage)||void 0===t?void 0:t.messageRefer)||void 0===n?void 0:n.createTime)r=e.lastMessage.messageRefer.createTime;else{if(!this.core.timeOrigin.checkNodeReliable())return o||0;r=this.core.timeOrigin.getNTPTime()}return r}}class Nu{constructor(e,t){this.core=e,this.service=t,this.model=this.service.model,this.logger=this.core.logger}get ifEnabled(){return!0===this.core.options.enableV2CloudConversation}v2ConversationNotifySyncHandler(e){this.ifEnabled&&this.service.versionCache.recvConversationFromSyncAction(e)}v2ConversationNotifySyncOnlineHandler(e){this.ifEnabled&&this.service.versionCache.recvConversation(e)}syncConversationReadTimeHandler(e){var t,n,r;if(this.ifEnabled){if(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.p2p)for(var[i,o]of Object.entries(e.content.p2p))this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(i),o),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(i),o);if(null===(r=null===(n=null==e?void 0:e.content)||void 0===n?void 0:n.team)||void 0===r?void 0:r.m_map)for(var[s,a]of Object.entries(e.content.team.m_map))this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(s),a),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(s),a)}}syncSuperTeamReadTimeHandler(e){var t,n;if(this.ifEnabled&&(null===(n=null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.superTeam)||void 0===n?void 0:n.m_map))for(var[r,i]of Object.entries(e.content.superTeam.m_map))this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(r),i),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(r),i)}v2MultiDeviceConversationReadTimeHandler(e){var t;this.ifEnabled&&(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.to)&&(0===e.content.scene?(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.to),e.content.timetag),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.to),e.content.timetag)):(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(e.content.to),e.content.timetag),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(e.content.to),e.content.timetag)))}v2MultiDeviceSuperTeamReadTimeHandler(e){var t;this.ifEnabled&&(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.to)&&(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(e.content.to),e.content.timetag),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(e.content.to),e.content.timetag))}}class wu{constructor(e,t){this.core=e,this.service=t,this.model=this.service.model,this.versionCache=this.service.versionCache,this.logger=this.core.logger}setListener(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>this.versionCache.doSync()),this.core.eventBus.on("V2NIMConversationService/conversationOnlineSyncNotify",this.conversationOnlineSyncNotify.bind(this)),this.core.eventBus.on("V2NIMMessageService/sendMessage",this.sendMessage.bind(this)),this.core.eventBus.on("V2NIMMessageService/deleteMessages",this.deleteMessages.bind(this)),this.core.eventBus.on("V2NIMMessageService/revokeMessages",this.revokeMessages.bind(this)),this.core.eventBus.on("V2NIMMessageService/roamingMsgs",this.roamingOrOfflineMsgs.bind(this)),this.core.eventBus.on("V2NIMMessageService/offlineMsgs",this.roamingOrOfflineMsgs.bind(this)),this.core.eventBus.on("V2NIMSettingService/setMute",this.setMute.bind(this))}beforeEmit(e,...t){var n,r,i=`${this.service.name}::emit ${e.toString()}`;if("onConversationCreated"===e){var o=t[0];this.logger.log(`${i}`,`id:${o.conversationId};unread:${o.unreadCount};lastMsg:${null===(n=o.lastMessage)||void 0===n?void 0:n.messageRefer.messageClientId}/${null===(r=o.lastMessage)||void 0===r?void 0:r.messageRefer.messageServerId}`)}else if("onConversationChanged"===e){var s=t[0];this.logger.log(`${i}`,s.map(e=>{var t,n;return`id:${e.conversationId};unread:${e.unreadCount};lastMsg:${null===(t=e.lastMessage)||void 0===t?void 0:t.messageRefer.messageClientId}/${null===(n=e.lastMessage)||void 0===n?void 0:n.messageRefer.messageServerId}`}))}else this.logger.log(`${i}`,...t)}conversationOnlineSyncNotify(e,t){var n;!1!==(null===(n=null==t?void 0:t.messageConfig)||void 0===n?void 0:n.lastMessageUpdateEnabled)&&(e.content.info=qt(e.content.info,Wt(vu)),e.content.data=qt(e.content.data,Wt(fu)),t&&(e.content.data.lastMessage=ru(this.core,t,0)),e.content.datas=[e.content.data],this.service.handler.v2ConversationNotifySyncOnlineHandler.call(this,e))}sendMessage(e,t){var n,r;1===t&&!0===(null===(n=e.messageConfig)||void 0===n?void 0:n.historyEnabled)||!1!==(null===(r=null==e?void 0:e.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled)&&this.versionCache.updateModelWithLastMessage(e.conversationId,e,2,t)}deleteMessages(e){var t=e.map(e=>e.messageRefer.conversationId);this.versionCache.backfillLastMsg(t,!0)}revokeMessages(e){this.versionCache.updateModelByRevoke(e)}roamingOrOfflineMsgs(e){var t=En(e.map(e=>e.conversationId));this.versionCache.backfillLastMsg(t,!1)}setMute(e,t){var n=this.model.getById(e);n&&n.mute!==t&&(n.mute=t,this.model.upsert(n),this.service.triggerConversationChanged([n]))}}class Pu extends An{constructor(e,t={}){super("V2NIMConversationService",e),this.config={},this.model=new uu,this.versionCache=new hu(this.core,this),this.unread=new _u(this.core,this),this.compute=new Ru(this.core,this),this.event=new wu(this.core,this),this.handler=new Nu(this.core,this),this.core._registerDep(Wc,"V2NIMConversationIdUtil"),"v2"===this.core.options.apiVersion&&!0===this.core.options.enableV2CloudConversation&&(Gt({cmdMap:gu,cmdConfig:yu}),this.setOptions(t),this.setListener())}setOptions(e){this.config=Object.assign(this.config,e)}setListener(){this.event.setListener()}reset(){this.versionCache.reset(),this.model.reset(),this.unread.reset()}emit(e,...t){return this.event.beforeEmit(e,...t),super.emit(e,...t)}checkEnable(){if(!0!==this.core.options.enableV2CloudConversation)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2CloudConversation is not enabled"}})}getConversationList(e,t){this.checkEnable(),this.checkV2(),Te({offset:{type:"number",min:0}},{offset:e},"",!0),Te({limit:{type:"number",min:1}},{limit:t},"",!0),this.core.V2NIMLoginService.checkIllegalState();var n=this.model.getByOption(e,t,{});return n.conversationList=this.compute.computeConvs(n.conversationList),Promise.resolve(n)}getConversationListByOption(e,t,n){this.checkEnable(),this.checkV2(),Te({offset:{type:"number",min:0}},{offset:e},"",!0),Te({limit:{type:"number",min:1}},{limit:t},"",!0),Te({option:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},onlyUnread:{type:"boolean",required:!1},conversationGroupIds:{type:"array",itemType:"string",required:!1}}}},{option:n},"",!0),this.core.V2NIMLoginService.checkIllegalState();var r=this.model.getByOption(e,t,n);return r.conversationList=this.compute.computeConvs(r.conversationList),Promise.resolve(r)}getConversation(e){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Ee(this.core.account,e);var t=this.model.getById(e);if(t)return this.compute.computeConv(t);throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST})})}getConversationListByIds(e){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Te({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),this.core.V2NIMLoginService.checkIllegalState();var t=e.map(e=>this.model.getById(e)).filter(e=>!!e);return this.compute.computeConvs(t)})}createConversation(e){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Ee(this.core.account,e);var t=Ve(yield this.core.sendCmd("v2ConversationCreate",{tag:{conversationId:e}}),"content.data"),n=ou(this.core,t);this.versionCache.compareAndUpdateModel([n]);var r=this.model.getById(e);if(r)return this.compute.computeConv(r);throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST})})}deleteConversation(e,t){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Ee(this.core.account,e),Te({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0);try{yield this.core.sendCmd("v2ConversationDelete",{tag:{conversationId:e,clearMessage:Number(t||!1)}})}catch(n){this.logger.warn(`V2NIMConversationService:deleteConversation: delete conversation failed: ${e}`)}this.model.getById(e)&&(t&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",[e]),this.versionCache.compareAndDeleteModel([e]))})}deleteConversationListByIds(e,t){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Te({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),Te({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0);var n=bu(Ve(yield this.core.sendCmd("v2ConversationsDelete",{tag:{conversationIds:JSON.stringify(e),clearMessage:Number(t||!1)}}),"content.info.failedMap")).filter(e=>e.error.code!==le.V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST||!this.model.getById(e.conversationId));return n.length<e.length&&(t&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",e),this.versionCache.compareAndDeleteModel(e)),n})}getStickTopConversationList(){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.getStickTopList()})}stickTopConversation(e,t){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Ee(this.core.account,e),Te({stickTop:{type:"boolean"}},{stickTop:t},"",!0);var n=Ve(yield this.core.sendCmd("v2ConversationSetTop",{tag:{conversationId:e,stickTop:Number(t)}}),"content.data"),r=ou(this.core,n);this.versionCache.compareAndUpdateModel([r])})}updateConversation(e,t){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Ee(this.core.account,e),Te({updateInfo:{type:"object",required:!0,rules:{serverExtension:{type:"string"}}}},{updateInfo:t},"",!0);var n=Ve(yield this.core.sendCmd("v2ConversationUpdate",{tag:Object.assign({conversationId:e},t)}),"content.data"),r=ou(this.core,n);this.versionCache.compareAndUpdateModel([r])})}updateConversationLocalExtension(e,t){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Ee(this.core.account,e),Te({localExtension:{type:"string"}},{localExtension:t},"",!0);var n=this.model.getById(e);if(!n)throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});if(n.localExtension!==t){var r=Object.assign(Object.assign({},n),{localExtension:t});this.model.upsert(r),this.triggerConversationChanged([r])}})}getTotalUnreadCount(){return this.checkEnable(),this.checkV2(),this.unread.getTotalUnreadCount()||0}getUnreadCountByIds(e){this.checkEnable(),this.checkV2(),Te({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0);var t=this.unread.getUnreadCountByIds(e);return Promise.resolve(t)}getUnreadCountByFilter(e){this.checkEnable(),this.checkV2(),this.valiteFilter(e);var t=this.unread.getUnreadCountByFilter(e);return Promise.resolve(t)}clearTotalUnreadCount(){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2();var e=Ve(yield this.core.sendCmd("v2ConversationClearTotalUnread"),"content.info");this.versionCache.compareAndClearUnreadInModel(e)})}clearUnreadCountByIds(e){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Te({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0);var t=yield this.core.sendCmd("v2ConversationsUnreadClear",{tag:{conversationIds:JSON.stringify(e)}}),n=iu(this.core,Ve(t,"content.datas")),r=bu(Ve(t,"content.info.failedMap"));return this.versionCache.compareAndUpdateModel(n),r})}clearUnreadCountByGroupId(e){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Te({groupId:{type:"string"}},{groupId:e},"",!0),yield this.core.sendCmd("v2ConversationClearGroupUnread",{tag:{groupId:e}})})}clearUnreadCountByTypes(e){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Te({types:du},{types:e},"",!0);var t=Ve(yield this.core.sendCmd("v2ConversationClearTypeUnread",{tag:{conversationType:JSON.stringify(e)}}),"content.info");this.versionCache.compareAndClearUnreadInModel(t)})}markConversationRead(e){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),this.checkLogin(),Ee(this.core.account,e);var t=this.model.getById(e);if(!t)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Conversation not exist"}});var n=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),r=this.core.V2NIMConversationIdUtil.parseConversationType(e),i=this.model.getReadTime(e),o=this.compute.computeReadTimeForMark(t);return i>=o?(this.logger.log(`V2Conv::markConversationRead currentReadTime >= readTime ${e},${i},${o}`),i):(3===r?yield this.core.sendCmd("v2MarkSuperTeamReadTime",{timetag:o,to:n}):yield this.core.sendCmd("v2MarkConversationReadTime",{scene:1===r?0:2===r?1:2,timetag:o,to:n}),this.model.updateReadTime(e,o),o)})}getConversationReadTime(e){return Ce(this,void 0,void 0,function*(){return this.checkEnable(),this.checkV2(),Ee(this.core.account,e),this.model.getReadTime(e)})}subscribeUnreadCountByFilter(e){var t;this.checkEnable(),this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.addFilter(e)}unsubscribeUnreadCountByFilter(e){var t;this.checkEnable(),this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.deleteFilter(e)}valiteFilter(e){if(Te({filter:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},conversationGroupId:{type:"string",allowEmpty:!1,required:!1},ignoreMuted:{type:"boolean",required:!1}}}},{filter:e},"",!0),void 0===e.conversationTypes&&void 0===e.conversationGroupId&&!0!==e.ignoreMuted)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Filter cannot be empty"}})}triggerConversationChanged(e){e=this.compute.computeConvs(e),(e=JSON.parse(JSON.stringify(e))).forEach(e=>{e.lastMessage||(e.lastMessage=void 0),delete e.lastMessageState}),this.emit("onConversationChanged",e)}triggerConversationCreated(e){e=this.compute.computeConv(e),delete(e=JSON.parse(JSON.stringify(e))).lastMessageState,this.emit("onConversationCreated",e)}}var ku,Lu={"28_9":"v2ConversationGroupCreate","28_10":"v2ConversationGroupDelete","28_11":"v2ConversationGroupUpdate","28_12":"v2ConversationGroupGet","28_13":"v2ConversationGroupsGet","28_14":"v2ConversationGroupListGet","28_15":"v2ConversationGroupAddTo","28_16":"v2ConversationGroupRemoveFrom","28_22":"v2ConversationGroupNotifySyncOnline"},xu="V2NIMConversationGroupService",Vu={groupId:1,name:2,serverExtension:3,createTime:4,updateTime:5},Du={v2ConversationGroupCreate:{sid:28,cid:9,service:xu,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:Wt(Vu)},{type:"PropertyArray",name:"conversations",reflectMapper:Wt(fu)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupDelete:{sid:28,cid:10,service:xu,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"groupList"}}]},v2ConversationGroupUpdate:{sid:28,cid:11,service:xu,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:Wt(Vu)}]},v2ConversationGroupGet:{sid:28,cid:12,service:xu,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"data",reflectMapper:Wt(Vu)}]},v2ConversationGroupsGet:{sid:28,cid:13,service:xu,params:[{type:"Property",name:"tag",reflectMapper:{groupIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Vu)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupListGet:{sid:28,cid:14,service:xu,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Vu)}]},v2ConversationGroupAddTo:{sid:28,cid:15,service:xu,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(fu)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupRemoveFrom:{sid:28,cid:16,service:xu,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(fu)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupNotifySyncOnline:{sid:28,cid:22,service:xu,response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"conversationIds"}},{type:"Property",name:"data",reflectMapper:Wt(Vu)}]}},Uu="V2NIMMessageLogUtil",$u={"30_6":"v2GetMessageList","33_2":"v2GetMessageListByRefers","30_9":"v2ClearRoamingMessage","30_18":"v2ClearHistoryMessage","7_118":"onClearHistoryMessage","4_24":"syncClearHistoryMessage","31_23":"v2GetTeamMessageList","32_14":"v2GetSuperTeamMessageList"},Bu={conversationType:{id:0,retType:"number"},receiverId:1,deleteRoam:{id:2,converter:zt},teamId:3,onlineSync:{id:4,converter:zt},deleteTime:{id:6,retType:"number"},serverExtension:7},Fu=[{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"direction"},{type:"LongArray",name:"msgTypes"}],ju={v2GetMessageList:{sid:30,cid:6,service:Uu,params:[{type:"String",name:"to"},...Fu],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Wt(ld)}]},v2GetMessageListByRefers:{sid:33,cid:2,service:Uu,params:[{type:"PropertyArray",name:"tag",reflectMapper:ld,select:["conversationType","senderId","receiverId","createTime","messageServerId"]}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Wt(ld)}]},v2ClearRoamingMessage:{sid:30,cid:9,service:Uu,params:[{type:"StrArray",name:"conversationIds"}]},v2ClearHistoryMessage:{sid:30,cid:18,service:Uu,params:[{type:"Property",name:"tag",reflectMapper:Bu}],response:[{type:"Long",name:"timetag"}]},v2GetTeamMessageList:{sid:31,cid:23,service:Uu,params:[{type:"Long",name:"to"},...Fu],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Wt(ld)}]},v2GetSuperTeamMessageList:{sid:32,cid:14,service:Uu,params:[{type:"Long",name:"to"},...Fu],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Wt(ld)}]},onClearHistoryMessage:{sid:7,cid:118,service:Uu,response:[{type:"Property",name:"data",reflectMapper:Wt(Bu)}]},syncClearHistoryMessage:{sid:4,cid:24,service:Uu,response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(Bu)}]}},qu="V2NIMMessageExtendUtil",Gu={"29_5":"v2VoiceToText","33_15":"v2PinMessage","33_16":"v2UpdatePinMessage","33_17":"v2UnpinMessage","23_18":"onPinMessage","23_19":"onUpdatePinMessage","23_20":"onUnpinMessage","23_115":"onPinMessage","23_116":"onUpdatePinMessage","23_117":"onUnpinMessage","33_21":"v2GetPinMessageList","33_3":"v2AddQuickComment","33_4":"v2RemoveQuickComment","33_7":"v2GetQuickComment","23_5":"onAddQuickComment","23_6":"onRemoveQuickComment","23_103":"onAddQuickComment","23_104":"onRemoveQuickComment","33_8":"v2AddCollection","33_9":"v2RemoveCollections","33_10":"v2UpdateCollectionExtension","33_11":"v2GetCollectionListByOption","30_26":"v2SearchCloudMessagesGroupByConversation","30_27":"v2SearchCloudMessages","30_34":"v2SearchCloudMessagesEx","33_1":"v2GetThreadMessageList"},Hu={conversationType:{id:1,converter:fd,retConverter:vd,access:"messageRefer.conversationType"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},createTime:{id:4,retType:"number",access:"messageRefer.createTime"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},detail:7,modify:{id:8,retType:"number"}},Wu={conversationType:{id:1,access:"messageRefer.conversationType",retConverter:vd},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},time:{id:4,access:"messageRefer.createTime",converter:zt,retType:"number"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},operatorId:7,serverExtension:8,createTime:{id:9,converter:zt,retType:"number"},updateTime:{id:10,converter:zt,retType:"number"}},zu={operatorId:1,index:{id:2,retType:"number"},createTime:{id:3,retType:"number"},serverExtension:4,pushEnabled:{id:5,access:"pushConfig.pushEnabled",converter:zt},needBadge:{id:6,access:"pushConfig.needBadge",converter:zt},title:{id:7,access:"pushConfig.title"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"}},Ku={accid:1,serverExtension:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},Yu={collectionId:1,collectionType:{id:2,retType:"number"},collectionData:3,serverExtension:4,uniqueId:5,createTime:{id:6,retType:"number"},updateTime:{id:7,retType:"number"}},Ju={keyword:1,beginTime:2,endTime:3,messageLimit:5,sortOrder:{id:6,converter:e=>0===e?2:1},p2pAccountIds:{id:7,converter:e=>e.join(",")},teamIds:{id:8,converter:e=>e.join(",")},senderAccountIds:{id:9,converter:e=>e.join(",")},messageTypes:{id:10,converter:e=>e.join(",")},messageSubtypes:{id:11,converter:e=>e.join(",")}},Xu={keywordList:{id:1,converter:e=>Yt(e)},keywordMatchType:2,searchStartTime:3,searchTimePeriod:4,pageToken:5,limit:7,direction:8,conversationId:9,senderAccountIds:{id:12,converter:e=>e.join(",")},messageTypes:{id:13,converter:e=>e.join(",")},messageSubtypes:{id:14,converter:e=>e.join(",")}},Qu=Object.assign(Object.assign({},Ju),{conversationLimit:4}),Zu={v2PinMessage:{sid:33,cid:15,service:qu,params:[{type:"Property",name:"msg",reflectMapper:ld,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:Ku}],response:[{type:"Long",name:"timetag"}]},v2UnpinMessage:{sid:33,cid:17,service:qu,params:[{type:"Property",name:"msg",reflectMapper:ld,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:Ku}],response:[{type:"Long",name:"timetag"}]},v2UpdatePinMessage:{sid:33,cid:16,service:qu,params:[{type:"Property",name:"msg",reflectMapper:ld,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:Ku}],response:[{type:"Long",name:"timetag"}]},v2GetPinMessageList:{sid:33,cid:21,service:qu,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,timetag:2}}],response:[{type:"Long",name:"timetag"},{type:"Bool",name:"changed"},{type:"PropertyArray",name:"data",reflectMapper:Wt(Wu)}]},v2VoiceToText:{sid:29,cid:5,service:qu,params:[{type:"Property",name:"tag",reflectMapper:{mimeType:0,sampleRate:1,voiceUrl:2,duration:3}}],response:[{type:"String",name:"data"}]},v2AddQuickComment:{sid:33,cid:3,service:qu,params:[{type:"Property",name:"message",reflectMapper:ld,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:zu}],response:[{type:"Long",name:"timetag"}]},v2RemoveQuickComment:{sid:33,cid:4,service:qu,params:[{type:"Property",name:"message",reflectMapper:ld,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:zu}],response:[{type:"Long",name:"timetag"}]},onAddQuickComment:{sid:23,cid:5,service:qu,response:[{type:"Property",name:"message",reflectMapper:Wt(ld)},{type:"Property",name:"quickComment",reflectMapper:Wt(zu)}]},onRemoveQuickComment:{sid:23,cid:6,service:qu,response:[{type:"Property",name:"message",reflectMapper:Wt(ld)},{type:"Property",name:"quickComment",reflectMapper:Wt(zu)}]},v2GetQuickComment:{sid:33,cid:7,service:qu,params:[{type:"PropertyArray",name:"tag",reflectMapper:Hu}],response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(Hu)}]},onPinMessage:{sid:23,cid:18,service:qu,response:[{type:"Property",name:"msg",reflectMapper:Wt(ld)},{type:"Property",name:"pinInfo",reflectMapper:Wt(Ku)}]},onUpdatePinMessage:{sid:23,cid:19,service:qu,response:[{type:"Property",name:"msg",reflectMapper:Wt(ld)},{type:"Property",name:"pinInfo",reflectMapper:Wt(Ku)}]},onUnpinMessage:{sid:23,cid:20,service:qu,response:[{type:"Property",name:"msg",reflectMapper:Wt(ld)},{type:"Property",name:"pinInfo",reflectMapper:Wt(Ku)}]},v2AddCollection:{sid:33,cid:8,service:qu,params:[{type:"Property",name:"tag",reflectMapper:Yu}],response:[{type:"Property",name:"data",reflectMapper:Wt(Yu)}]},v2RemoveCollections:{sid:33,cid:9,service:qu,params:[{type:"PropertyArray",name:"tag",reflectMapper:Yu,select:["collectionId","createTime"]}],response:[{type:"Int",name:"data"}]},v2UpdateCollectionExtension:{sid:33,cid:10,service:qu,params:[{type:"Property",name:"tag",reflectMapper:Yu}],response:[{type:"Property",name:"data",reflectMapper:Wt(Yu)}]},v2GetCollectionListByOption:{sid:33,cid:11,service:qu,params:[{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeId:3,limit:4,direction:5,collectionType:6}}],response:[{type:"Long",name:"total"},{type:"PropertyArray",name:"data",reflectMapper:Wt(Yu)}]},v2SearchCloudMessagesGroupByConversation:{sid:30,cid:26,service:qu,params:[{type:"Property",name:"tag",reflectMapper:Qu}],response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(ld)}]},v2SearchCloudMessages:{sid:30,cid:27,service:qu,params:[{type:"Property",name:"tag",reflectMapper:Ju}],response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(ld)}]},v2SearchCloudMessagesEx:{sid:30,cid:34,service:qu,params:[{type:"Property",name:"tag",reflectMapper:Xu}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Wt(ld)},{type:"Int",name:"hasMore"},{type:"String",name:"nextPageToken"}]},v2GetThreadMessageList:{sid:33,cid:1,service:qu,params:[{type:"Property",name:"messageRefer",reflectMapper:ld},{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeMessageServerId:3,limit:4,reverse:5}}],response:[{type:"Property",name:"message",reflectMapper:Wt(ld)},{type:"Property",name:"replyResult",reflectMapper:Wt({total:{id:1,retType:"number"},timestamp:{id:2,retType:"number"}})},{type:"PropertyArray",name:"replyList",reflectMapper:Wt(ld)}]}},ep={joinMode:{type:"enum",values:[1,0,2],required:!1},agreeMode:{type:"enum",values:[0,1],required:!1},inviteMode:{type:"enum",values:[1,0],required:!1},updateInfoMode:{type:"enum",values:[1,0],required:!1},updateExtensionMode:{type:"enum",values:[1,0],required:!1},chatBannedMode:{type:"enum",values:[0,1],required:!1}},tp={type:"object",required:!0,rules:Object.assign({name:{type:"string",allowEmpty:!1},teamType:{type:"enum",values:[1,2]},memberLimit:{type:"number",min:1,required:!1}},ep)},np={type:"array",min:1,itemType:"string"},rp={type:"boolean"},ip={type:"string"},op={type:"string",allowEmpty:!1},sp={type:"object",rules:{antispamBusinessId:{type:"string",required:!1}},required:!1},ap={teamId:{type:"string",regExp:/^[1-9]\d*$/,allowEmpty:!1}},cp={teamIds:{type:"array",itemRules:{type:"string",allowEmpty:!1,regExp:/^[1-9]\d*$/},min:1}},lp={teamType:{type:"enum",values:[1,2]}},dp={teamTypes:{type:"array",itemType:"enum",values:[1,2],required:!1}},up={inviteeParams:{type:"object",required:!0,rules:{inviteeAccountIds:np,postscript:Object.assign(Object.assign({},ip),{required:!1}),serverExtension:Object.assign(Object.assign({},ip),{required:!1})}}},pp={updateTeamInfoParams:{type:"object",required:!0,rules:Object.assign({name:{type:"string",allowEmpty:!1,required:!1},memberLimit:{type:"number",min:1,required:!1}},ep)}},hp={type:"enum",values:[0,2]},gp={memberInfoParams:{type:"object",rules:{teamNick:{type:"string",required:!1},serverExtension:{type:"string",required:!1},antispamConfig:{type:"object",required:!1,rules:{antispamBusinessId:{type:"string",required:!1}}}}}},mp={chatBannedMode:{type:"enum",values:[0,1]}},fp={queryOption:{type:"object",rules:{roleQueryType:{type:"enum",values:[0,2,1]},onlyChatBanned:{type:"boolean",required:!1},direction:{type:"enum",values:[1,0],required:!1},limit:{type:"number",min:1,required:!1},nextToken:{type:"string",required:!1}}}},vp={teamId:ap.teamId,teamType:{type:"enum",values:[1,2]},operatorAccountId:{type:"string",allowEmpty:!1}},yp={actionType:{type:"enum",values:[2,0,1,3]}},_p={actionType:{type:"enum",values:[2]}},Ip={actionType:{type:"enum",values:[0]}},Tp={types:{type:"array",itemType:"enum",values:[0,2,1,3],required:!1},status:{type:"array",itemType:"enum",values:[1,3,0,2],required:!1},offset:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},Sp={teamId:ap.teamId,teamType:lp.teamType,accountIds:np},Ep={accountId:{type:"string",allowEmpty:!1},teamNick:{type:"string"},antispamConfig:{type:"object",required:!1,rules:{antispamBusinessId:{type:"string",required:!1}}}};class Mp{constructor(){this.teamMap=new Map,this.superTeamMap=new Map}set(e){e.forEach(e=>{this.chooseMap(e.teamType).set(e.teamId,e)})}reset(){this.teamMap.clear(),this.superTeamMap.clear()}count(e,t=!0){var n=this.chooseMap(e),r=0;return n.forEach(e=>{t&&e.isValidTeam&&r++,t||r++}),r}chooseMap(e){return 2===e?this.superTeamMap:1===e?this.teamMap:new Map}getById(e,t,n=!0){var r=this.chooseMap(t).get(e);if(r){if(n&&r.isValidTeam)return r;if(!n)return r}}getAll(e,t=!0){var n=this.chooseMap(e);return Array.from(n.values()).filter(e=>!(!t||!e.isValidTeam)||!t||void 0).sort((e,t)=>t.updateTime-e.updateTime)}upsert(e){var t=e.teamId,n=e.teamType,r=this.chooseMap(n),i=r.get(t)||{},o=Object.assign({},i,e);return r.set(t,o),o}deleteById(e,t){var n=this.getById(e,t);if(n)return n.isValidTeam=!1,n}searchTeamByKeyword(e){var t=[];return this.teamMap.forEach(n=>{n.name.includes(e)&&t.push(n)}),this.superTeamMap.forEach(n=>{n.name.includes(e)&&t.push(n)}),t}}class bp{constructor(){this.teamMembers=[],this.superTeamMembers=[],this.maxSize=2e3}reset(){this.teamMembers=[],this.superTeamMembers=[]}setData(e){e.forEach(e=>{this.chooseList(e.teamType).push(e)})}chooseList(e){return 2===e?this.superTeamMembers:1===e?this.teamMembers:[]}getById(e,t,n){return this.chooseList(t).find(t=>t.teamId===e&&t.accountId===n)}upsert(e){var t=e.teamType,n=e.teamId,r=this.chooseList(t),i=r.findIndex(t=>t.teamId===n&&t.accountId===e.accountId);-1===i?r.push(e):r[i]=Object.assign(Object.assign({},r[i]),e),r.length>this.maxSize&&r.shift()}deleteByAccount(e,t,n){var r=this.chooseList(t),i=r.findIndex(t=>t.teamId===e&&t.accountId===n);if(-1!==i){var o=r[i];return o.inTeam=!1,r.splice(i,1),o}}deleteByTeamId(e,t){var n=this.chooseList(t).filter(t=>t.teamId!==e);2===t?this.superTeamMembers=n:this.teamMembers=n}}class Cp{constructor(e,t){this.core=e,this.service=t}processNotification(e){var{attachment:t,senderId:n,receiverId:r,createTime:i}=e,{id:o,data:s}=t,a=o>400?2:1,{id:c,ids:l,tinfo:d,mute:u}=Wl(s,a),p=this.service.model.getById(r,a);switch(this.core.logger.log(`v2Team::processNotification, notificationType:${o}, teamId:${r}`,s),o){case ku.SUPER_TEAM_INVITATION:case ku.TEAM_INVITATION:l.includes(this.core.account)&&this.onTeamJoined(d),this.onTeamMembersJoined(d,l.filter(e=>e!==this.core.account));break;case ku.SUPER_TEAM_INVITE_ACCEPT:case ku.TEAM_INVITE_ACCEPT:n===this.core.account?this.onTeamJoined(d):this.onTeamMemberJoined(d,n);break;case ku.SUPER_TEAM_APPLY_ACCEPT:case ku.TEAM_APPLY_ACCEPT:c===this.core.account?this.onTeamJoined(d):this.onTeamMemberJoined(d,c);break;case ku.SUPER_TEAM_ADD_MANAGER:case ku.TEAM_ADD_MANAGER:this.updateTeamMemberRole(r,a,l,{memberRole:2,updateTime:i});break;case ku.SUPER_TEAM_REMOVE_MANAGER:case ku.TEAM_REMOVE_MANAGER:this.updateTeamMemberRole(r,a,l,{memberRole:0,updateTime:i});break;case ku.SUPER_TEAM_KICK:case ku.TEAM_KICK:this.onTeamInfoUpdated(d),l.forEach(e=>{e===this.core.account?this.onTeamLeft(r,a,!0):this.onTeamMemberKicked(n,d.teamId,d.teamType,e)});break;case ku.SUPER_TEAM_LEAVE:case ku.TEAM_LEAVE:d?this.onTeamInfoUpdated(d):p&&n===this.core.account&&(p.isValidTeam=!1,this.onTeamInfoUpdated(p)),n===this.core.account?this.onTeamLeft(r,a,!1):this.onTeamMemberLeft(r,a,n);break;case ku.SUPER_TEAM_DISMISS:case ku.TEAM_DISMISS:this.onTeamDismissed(r,a);break;case ku.SUPER_TEAM_UPDATE:case ku.TEAM_UPDATED:this.onTeamInfoUpdated(d);break;case ku.SUPER_TEAM_TRANSFER_OWNER:case ku.TEAM_TRANSFER_OWNER:this.onTeamInfoUpdated(d),this.updateTeamMemberRole(r,a,[n,d.ownerAccountId],[{memberRole:0,updateTime:i},{memberRole:1,updateTime:i,joinTime:i}],!1);break;case ku.SUPER_TEAM_MEMBER_MUTE:case ku.TEAM_MEMBER_MUTE:this.service.model.upsert(d),this.updateTeamMemberRole(r,a,c?[c]:l,{chatBanned:0!==u,updateTime:i})}}onTeamJoined(e){this.service.model.upsert(e),this.service.emit("onTeamJoined",e),this.service.getTeamMemberListByIds(e.teamId,e.teamType,[this.core.account]).catch(e=>{this.core.logger.error("Get Member error after onTeamJoined",e)})}onTeamLeft(e,t,n){var r=this.service.model.deleteById(e,t)||zl(e,t,{isValidTeam:!1});this.service.memberModel.deleteByAccount(e,t,this.core.account),this.service.emit("onTeamLeft",r,n)}onTeamDismissed(e,t){var n=this.service.model.deleteById(e,t);n||(n=zl(e,t,{isValidTeam:!1})),this.service.memberModel.deleteByTeamId(e,t),this.service.emit("onTeamDismissed",n)}onTeamInfoUpdated(e){var t=this.service.model.upsert(e);this.service.emit("onTeamInfoUpdated",t)}onTeamMemberJoined(e,t){this.service.model.upsert(e),this.service.emit("onTeamInfoUpdated",e);var n=e.updateTime||e.createTime,r=Kl(e.teamId,e.teamType,t,{joinTime:n,updateTime:n});this.service.emit("onTeamMemberJoined",[r])}onTeamMembersJoined(e,t){var n=e.updateTime||e.createTime,r=t.map(t=>Kl(e.teamId,e.teamType,t,{joinTime:n,updateTime:n}));0!==r.length&&(this.service.model.upsert(e),this.service.emit("onTeamInfoUpdated",e),this.service.emit("onTeamMemberJoined",r))}onTeamMemberLeft(e,t,n){var r=this.service.memberModel.deleteByAccount(e,t,n);r||(r=Kl(e,t,n,{inTeam:!1})),this.service.emit("onTeamMemberLeft",[r])}onTeamMemberKicked(e,t,n,r){var i=this.service.memberModel.deleteByAccount(t,n,r);i||(i=Kl(t,n,r,{inTeam:!1})),this.service.emit("onTeamMemberKicked",e,[i])}onTeamMemberInfoUpdated(e){e.forEach(e=>{if(e.accountId===this.core.account&&this.core.V2NIMSettingService.name&&this.core.V2NIMConversationIdUtil.name){var t=1===e.teamType?this.core.V2NIMConversationIdUtil.teamConversationId(e.teamId):this.core.V2NIMConversationIdUtil.superTeamConversationId(e.teamId),n=this.core.V2NIMSettingService.getConversationMuteStatus(t);this.core.eventBus.emit("V2NIMSettingService/setMute",t,n)}}),this.service.emit("onTeamMemberInfoUpdated",e)}updateTeamMemberRole(e,t,n,r,i=!0){return Ce(this,void 0,void 0,function*(){var o=n.filter((n,i)=>{var o=this.service.memberModel.getById(e,t,n);return o&&this.service.memberModel.upsert(Object.assign(Object.assign({},o),Array.isArray(r)?r[i]:r)),!o});if(i&&o.length>0)try{(yield this.service.getTeamMemberListByIds(e,t,o)).forEach(e=>this.service.memberModel.upsert(e))}catch(a){this.core.logger.warn("v2Team::processNotification, getTeamMemberListByIds failed",a)}var s=n.map((n,o)=>{var s=this.service.memberModel.getById(e,t,n);return s||i?s:Kl(e,t,n,Array.isArray(r)?r[o]:r)}).filter(e=>!!e);s.length>0&&this.onTeamMemberInfoUpdated(s)})}processSysNotification(e){var{receiverId:t,postscript:n,senderId:r,timestamp:i,content:o}=e,s={};try{s=JSON.parse(o)}catch(c){this.core.logger.warn("v2Team::processSysNotification, parse content failed",o)}var a={actionType:{0:0,1:1,2:2,3:3,15:0,16:1,17:2,18:3}[e.type],teamId:t,teamType:e.type>=15?2:1,operatorAccountId:r,postscript:n,timestamp:i,actionStatus:0,read:!1};s.attach&&(a.serverExtension=s.attach),this.core.logger.log("v2Team::processSysNotification, type:",e.type,a),this.service.notificationModel.create(a),this.service.emit("onReceiveTeamJoinActionInfo",a)}updateTeamActionStatus(e,t){this.service.notificationModel.update({teamId:e.teamId,teamType:e.teamType,operatorAccountId:e.operatorAccountId,actionType:e.actionType,actionStatus:t})}checkIfExpired(e){return!(!e||509!==e&&(e>=500&&e<=599||e>=19e4))}}!function(e){e[e.TEAM_INVITATION=0]="TEAM_INVITATION",e[e.TEAM_KICK=1]="TEAM_KICK",e[e.TEAM_LEAVE=2]="TEAM_LEAVE",e[e.TEAM_UPDATED=3]="TEAM_UPDATED",e[e.TEAM_DISMISS=4]="TEAM_DISMISS",e[e.TEAM_APPLY_ACCEPT=5]="TEAM_APPLY_ACCEPT",e[e.TEAM_TRANSFER_OWNER=6]="TEAM_TRANSFER_OWNER",e[e.TEAM_ADD_MANAGER=7]="TEAM_ADD_MANAGER",e[e.TEAM_REMOVE_MANAGER=8]="TEAM_REMOVE_MANAGER",e[e.TEAM_INVITE_ACCEPT=9]="TEAM_INVITE_ACCEPT",e[e.TEAM_MEMBER_MUTE=10]="TEAM_MEMBER_MUTE",e[e.SUPER_TEAM_INVITATION=401]="SUPER_TEAM_INVITATION",e[e.SUPER_TEAM_KICK=402]="SUPER_TEAM_KICK",e[e.SUPER_TEAM_LEAVE=403]="SUPER_TEAM_LEAVE",e[e.SUPER_TEAM_UPDATE=404]="SUPER_TEAM_UPDATE",e[e.SUPER_TEAM_DISMISS=405]="SUPER_TEAM_DISMISS",e[e.SUPER_TEAM_TRANSFER_OWNER=406]="SUPER_TEAM_TRANSFER_OWNER",e[e.SUPER_TEAM_ADD_MANAGER=407]="SUPER_TEAM_ADD_MANAGER",e[e.SUPER_TEAM_REMOVE_MANAGER=408]="SUPER_TEAM_REMOVE_MANAGER",e[e.SUPER_TEAM_MEMBER_MUTE=409]="SUPER_TEAM_MEMBER_MUTE",e[e.SUPER_TEAM_APPLY_ACCEPT=410]="SUPER_TEAM_APPLY_ACCEPT",e[e.SUPER_TEAM_INVITE_ACCEPT=411]="SUPER_TEAM_INVITE_ACCEPT"}(ku||(ku={}));class Ap{constructor(){this.list=[],this.maxCount=1e3}reset(){this.list=[]}checkSameAction(e,t,n=!1){return e.teamId===t.teamId&&e.teamType===t.teamType&&e.actionType===t.actionType&&e.operatorAccountId===t.operatorAccountId&&(!n||e.timestamp===t.timestamp)}create(e){this.list.push(e),this.list.length>this.maxCount&&this.list.shift()}update(e){this.list.forEach(t=>{this.checkSameAction(t,e)&&0===t.actionStatus&&Object.assign(t,e)})}delete(e){this.list=this.list.map(t=>{if(!this.checkSameAction(t,e,!1))return t}).filter(e=>e)}getByOption(e){var{types:t,status:n,offset:r=0,limit:i=50}=e,o=[];this.list.forEach(e=>{t&&t.length>0&&!t.includes(e.actionType)||n&&n.length>0&&!n.includes(e.actionStatus)||o.push(e)}),o=o.sort((e,t)=>t.timestamp-e.timestamp);var s=0;r>0&&(s=ze(o,"timestamp",r),o[s]&&o[s].timestamp===r&&(s+=1));var a=o.slice(s).length;return(o=o.slice(s,s+i)).length>0?{offset:a>i?o[o.length-1].timestamp:0,finished:!(a>i),infos:o}:{offset:0,finished:!0,infos:o}}setRead(e){for(var t of this.list)this.checkSameAction(t,e)&&(t.read=!0)}setAllRead(){for(var e of this.list)e.read=!0}getUnreadCount(){var e=new Set;for(var t of this.list)t.read||0!==t.actionStatus||0!==t.actionType&&2!==t.actionType||e.add(`${t.operatorAccountId}_${t.teamType}_${t.teamId}`);return e.size}}class Op{constructor(e,t){this.core=e,this.service=t,this.model=t.model,this.memberModel=t.memberModel,this.notification=t.notification,this.logger=this.core.logger}setListener(){this.core.eventBus.on("V2NIMTeamService/onSyncStarted",()=>{this.service.emit("onSyncStarted")}),this.core.eventBus.on("V2NIMTeamService/onSyncFinished",()=>{this.service.emit("onSyncFinished")}),this.core.eventBus.on("V2NIMTeamService/onSyncFailed",e=>{this.service.emit("onSyncFailed",e)}),this.core.eventBus.on("forwardReceive/V2NIMTeamService/created",e=>{this.model.upsert(e);var t=Kl(e.teamId,e.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(t),this.service.emit("onTeamCreated",e)}),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",e=>{this.memberModel.upsert(e),this.service.emit("onTeamInfoUpdated",[e])}),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateTeamActionStatus",this.notification.updateTeamActionStatus.bind(this.notification)),this.core.eventBus.on("V2NIMTeamService/sysNotification",this.notification.processSysNotification.bind(this.notification)),this.core.eventBus.on("V2NIMTeamService/notification",this.notification.processNotification.bind(this.notification))}beforeEmit(e,...t){var n=`${this.service.name}::emit ${e.toString()}`;if("onTeamCreated"===e||"onTeamDismissed"===e||"onTeamJoined"===e||"onTeamLeft"===e||"onTeamInfoUpdated"===e){var r=t[0];this.logger.log(`${n}`,`team:${r.teamId}_${r.teamType};updateTime:${r.updateTime}`)}else if("onTeamMemberJoined"===e||"onTeamMemberLeft"===e||"onTeamMemberInfoUpdated"===e){var i=t[0];this.logger.log(`${n}`,i.map(e=>`team:${e.teamId}_${e.teamType};account:${e.accountId}`))}else if("onTeamMemberKicked"===e){var o=t[0],s=t[1];this.logger.log(`${n}`,`operator${o}`,s.map(e=>`team:${e.teamId}_${e.teamType};account:${e.accountId}`))}else this.logger.log(`${n}`,...t)}onSyncDone(e){e?this.service.emit("onSyncFailed",e):this.service.emit("onSyncFinished")}}class Rp{constructor(e,t){this.core=e,this.service=t,this.model=t.model,this.memberModel=t.memberModel,this.logger=this.core.logger}v2TeamSyncHandler(e){this.model.set(e.content.datas)}v2SuperTeamSyncHandler(e){this.model.set(e.content.datas)}v2TeamCreateMultiSyncHandler(e){var t=e.content.data;this.model.upsert(t);var n=Kl(t.teamId,t.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(n),this.service.emit("onTeamCreated",t)}v2SuperTeamCreateMultiSyncHandler(e){var t=e.content.data;this.model.upsert(t);var n=Kl(t.teamId,t.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(n),this.service.emit("onTeamCreated",t)}v2TeamMemberUpdateMultiSyncHandler(e){var t=e.content.data;t.teamType=1;var n=this.memberModel.getById(t.teamId,t.teamType,t.accountId);this.service.notification.updateTeamMemberRole(t.teamId,t.teamType,[t.accountId],t),t.accountId===this.core.account&&n&&n.bits!==t.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",t.teamId,t.teamType,t.bits)}v2SuperTeamMemberUpdateMultiSyncHandler(e){var t=e.content.data;t.teamType=2;var n=this.memberModel.getById(t.teamId,t.teamType,t.accountId);this.service.notification.updateTeamMemberRole(t.teamId,t.teamType,[t.accountId],t),t.accountId===this.core.account&&n&&n.bits!==t.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",t.teamId,t.teamType,t.bits)}v2TeamMembersOfSelfInSyncHandler(e){e.content.datas.forEach(e=>{e.teamType=1,this.memberModel.upsert(e)})}v2SuperTeamMembersOfSelfInSyncHandler(e){e.content.datas.forEach(e=>{e.teamType=2,this.memberModel.upsert(e)})}}var Np="V2NIMUserService",wp={"34_3":"v2UpdateBlockList","34_7":"v2GetUserList","34_10":"v2UpdateSelfUserProfile","3_109":"v2SyncSelfUserInfo","3_110":"onUpdateUserProfile","3_103":"onUpdateBlockList","3_8":"syncBlockAndMuteList","34_5":"v2SetP2PMessageMuteMode","3_105":"v2OnUpdateMuteList"},Pp={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"}},kp={v2UpdateBlockList:{sid:34,cid:3,service:Np,params:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},v2GetUserList:{sid:34,cid:7,service:Np,params:[{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(Pp)}]},v2UpdateSelfUserProfile:{sid:34,cid:10,service:Np,params:[{type:"Property",name:"tag",reflectMapper:Pp}],response:[{type:"Long",name:"updateTime"}]},onUpdateUserProfile:{sid:3,cid:110,service:Np,response:[{type:"Property",name:"data",reflectMapper:Wt(Pp)}]},onUpdateBlockList:{sid:3,cid:103,service:Np,response:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},syncBlockAndMuteList:{sid:3,cid:8,service:Np,response:[{type:"PropertyArray",name:"data",reflectMapper:Wt({accountId:0,isMute:{id:1,retType:"boolean"},isBlock:{id:2,retType:"boolean"}})},{type:"Long",name:"timetag"}]},v2SyncSelfUserInfo:{sid:3,cid:109,service:Np,response:[{type:"Property",name:"user",reflectMapper:Wt(Pp)}]},v2SetP2PMessageMuteMode:{sid:34,cid:5,service:Np,params:[{type:"String",name:"accountId"},{type:"Bool",name:"muteMode"}]},v2OnUpdateMuteList:{sid:3,cid:105,service:Np,response:[{type:"String",name:"accountId"},{type:"Bool",name:"mute"}]}};class Lp{constructor(){this.muteList=new Set,this.userMap=new Map,this.blockList=[]}reset(){this.muteList.clear(),this.userMap.clear(),this.blockList=[]}setAccountMuteMode(e,t){1===t?this.muteList.add(e):this.muteList.delete(e)}setUser(e){this.userMap.set(e.accountId,e)}getUser(e){return this.userMap.get(e)}getUserListBySearchOption(e){return Array.from(this.userMap.values()).filter(t=>!(void 0!==e.searchName&&!e.searchName||!t.name.includes(e.keyword))||!(!e.searchAccountId||!t.accountId.includes(e.keyword))||!!(t.mobile&&e.searchMobile&&t.mobile.includes(e.keyword)))}addToBlockList(e){e.forEach(e=>{this.blockList.includes(e)||this.blockList.push(e)})}removeFromBlockList(e){e.forEach(e=>{var t=this.blockList.indexOf(e);-1!==t&&this.blockList.splice(t,1)})}checkBlock(e){var t={};return e.forEach(e=>{t[e]=this.blockList.includes(e)}),t}}var xp={type:"string",required:!0,allowEmpty:!1},Vp={type:"string",required:!1,allowEmpty:!0},Dp={name:{type:"string",required:!1,allowEmpty:!0},avatar:Vp,sign:Vp,email:Vp,birthday:Vp,mobile:Vp,gender:{type:"number",required:!1},serverExtension:Vp};class Up extends An{constructor(e){super("V2NIMUserService",e),Gt({cmdMap:wp,cmdConfig:kp}),this.model=new Lp,"v2"===this.core.options.apiVersion&&this.setListener()}reset(){this.model.reset()}setListener(){this.core.eventBus.on("forwardReceive/V2NIMUserService/updateBlockList",(e,t)=>{t?this.model.addToBlockList([e]):this.model.removeFromBlockList([e]),t?this.emitBlockListAdded(e):this.emit("onBlockListRemoved",e)}),this.core.eventBus.on("forwardReceive/V2NIMUserService/updateUserProfile",e=>{this.updateUserProfileInMemory(e)})}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;if("onUserProfileChanged"===e){var r=t[0];this.logger.log(`${n}`,r.map(e=>`id:${e.accountId};name:${e.name};updateTime:${e.updateTime}`))}else if("onBlockListAdded"===e){var i=t[0];this.logger.log(`${n}`,`id:${i.accountId};name:${i.name};updateTime:${i.updateTime}`)}else this.logger.log(`${n}`,...t);return super.emit(e,...t)}getUserList(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this._getUserList(e)})}_getUserList(e){var t;return Ce(this,void 0,void 0,function*(){Te({accountIds:np},{accountIds:e},"",!0);var n=[];e.forEach(e=>{this.model.getUser(e)||n.push(e)});var r=null;n.length>0&&(r=yield this.core.sendCmd("v2GetUserList",{accountIds:n})),((null===(t=null==r?void 0:r.content)||void 0===t?void 0:t.data)||[]).forEach(e=>{this.model.setUser(e)});var i=[];return e.forEach(e=>{var t=this.model.getUser(e);t&&i.push(t)}),i})}getUserListFromCloud(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te({accountIds:{type:"array",min:1,max:500,itemType:"string"}},{accountIds:e},"",!0);var t=(yield this.core.sendCmd("v2GetUserList",{accountIds:e})).content.data||[],n=[];t.forEach(e=>{var t=this.model.getUser(e.accountId);this.compareUserForUpdate(t,e)&&n.push(e),this.model.setUser(e)});var r=e.reduce((e,t)=>{var n=this.model.getUser(t);return n&&e.push(n),e},[]);return n.length>0&&this.emit("onUserProfileChanged",n),r})}compareUserForUpdate(e,t){return!e||!("number"==typeof e.updateTime&&"number"==typeof t.updateTime&&e.updateTime>=t.updateTime)}updateSelfUserProfile(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(Dp,e,"",!0);var t=yield this.core.sendCmd("v2UpdateSelfUserProfile",{tag:Object.assign(Object.assign({},e),{accountId:this.core.account})});yield this.updateUserProfileInMemory(Object.assign(Object.assign({},e),{updateTime:t.content.updateTime}))})}addUserToBlockList(e){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),e===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot block yourself"}});Te({accountId:xp},{accountId:e},"",!0),yield this.core.sendCmd("v2UpdateBlockList",{accountId:e,addToBlockList:!0}),this.model.addToBlockList([e]),this.emitBlockListAdded(e)})}removeUserFromBlockList(e){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),e===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot unblock yourself"}});Te({accountId:xp},{accountId:e},"",!0),yield this.core.sendCmd("v2UpdateBlockList",{accountId:e,addToBlockList:!1}),this.model.removeFromBlockList([e]),this.emit("onBlockListRemoved",e)})}searchUserByOption(e){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Te({keyword:{type:"string",allowEmpty:!1},searchName:{type:"boolean",required:!1},searchAccountId:{type:"boolean",required:!1},searchMobile:{type:"boolean",required:!1}},e,"",!0),!1===(void 0===e.searchName||e.searchName)&&!e.searchAccountId&&!e.searchMobile)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"one of searchName, searchAccountId, searchMobile must be true"}});return this.model.getUserListBySearchOption(e)})}getBlockList(){return this.checkV2(),Promise.resolve(this.model.blockList)}checkBlock(e){return this.checkV2(),Te({accountIds:np},{accountIds:e},"",!0),Promise.resolve(this.model.checkBlock(e))}updateUserProfileInMemory(e){return Ce(this,void 0,void 0,function*(){var t=this.model.getUser(this.core.account);t?(Object.assign(t,e),this.model.setUser(t)):t=(yield this._getUserList([this.core.account]))[0],t&&this.emit("onUserProfileChanged",[t])})}onUpdateUserProfileHandler(e){return Ce(this,void 0,void 0,function*(){var t=e.content.data;yield this.updateUserProfileInMemory(t)})}onUpdateBlockListHandler(e){var t=e.content.accountId;e.content.addToBlockList?(this.model.addToBlockList([t]),this.emitBlockListAdded(t)):(this.model.removeFromBlockList([t]),this.emit("onBlockListRemoved",t))}syncBlockAndMuteListHandler(e){e.content.data.forEach(e=>{e.isBlock?this.model.addToBlockList([e.accountId]):this.model.setAccountMuteMode(e.accountId,e.isMute?1:0)})}v2SyncSelfUserInfoHandler(e){var t=e.content.user;this.model.setUser(t)}checkUserUpdate(e,t){var n=e.senderId;n!==this.core.account&&this.refreshUserInfo(n,t)}refreshUserInfo(e,t=0){return Ce(this,void 0,void 0,function*(){if(e&&"string"==typeof e){var n=this.model.getUser(e),r=[];if(!n||n&&"number"==typeof n.updateTime&&"number"==typeof t&&!isNaN(n.updateTime)&&!isNaN(t)&&n.updateTime<t)try{r=(yield this.core.sendCmd("v2GetUserList",{accountIds:[e]})).content.data}catch(o){return void this.logger.warn(`V2NIMUserService:refreshUserInfo: failed for ${e}`)}for(var i of r)this.model.setUser(i),this.emit("onUserProfileChanged",[i])}})}emitBlockListAdded(e){return Ce(this,void 0,void 0,function*(){var t=yield this._getUserList([e]);1===t.length&&this.emit("onBlockListAdded",t[0])})}v2OnUpdateMuteListHandler(e){return Ce(this,void 0,void 0,function*(){var{accountId:t,mute:n}=e.content,r=n?1:0;this.core.eventBus.emit("v2NIMUserService/updateMuteList",t,r)})}}var $p="V2NIMFriendService",Bp={"35_1":"v2AddFriend","35_2":"v2DeleteFriend","35_3":"v2SetFriendInfo","35_4":"v2IncFriendInfo","12_101":"v2OnAddFriend","12_102":"v2OnDeleteFriend","12_103":"v2OnUpdateFriendInfo","12_5":"v2SyncFriendList","12_6":"v2SyncFriendUserList"},Fp={accountId:4,relationShip:{id:5,retType:"number"},source:{id:7,retType:"number"},alias:8,serverExtension:10,createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},customerExtension:13},jp={v2AddFriend:{sid:35,cid:1,service:$p,params:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"}],response:[]},v2DeleteFriend:{sid:35,cid:2,service:$p,params:[{type:"String",name:"accountId"},{type:"Property",name:"params",reflectMapper:{deleteAlias:{id:1,converter:zt}}}]},v2SetFriendInfo:{sid:35,cid:3,service:$p,params:[{type:"Property",name:"tag",reflectMapper:Fp}]},v2OnAddFriend:{sid:12,cid:101,service:$p,response:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"},{type:"Property",name:"ext",reflectMapper:Wt({serverExt:1})}]},v2OnDeleteFriend:{sid:12,cid:102,service:$p,response:[{type:"String",name:"accountId"}]},v2OnUpdateFriendInfo:{sid:12,cid:103,service:$p,response:[{type:"Property",name:"data",reflectMapper:Wt(Fp)}]},v2SyncFriendList:{sid:12,cid:5,service:$p,response:[{type:"PropertyArray",name:"friends",reflectMapper:Wt(Fp)},{type:"Long",name:"timetag"}]},v2SyncFriendUserList:{sid:12,cid:6,service:$p,response:[{type:"PropertyArray",name:"users",reflectMapper:Wt(Pp)}]},v2IncFriendInfo:{sid:35,cid:4,service:$p,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:Wt(Fp)},{type:"Long",name:"timetag"}]}},qp={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!0,rules:{addMode:{type:"enum",required:!0,values:[1,2]},postscript:{type:"string",required:!1,allowEmpty:!0}}}},Gp={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{deleteAlias:{type:"boolean",required:!1}}}},Hp={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{alias:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0}}}},Wp={applicantAccountId:{type:"string",allowEmpty:!1},recipientAccountId:{type:"string",allowEmpty:!1},operatorAccountId:{type:"string",required:!1,allowEmpty:!1},postscript:{type:"string",required:!1,allowEmpty:!0},status:{type:"enum",values:[1,4,3,0,2]},timestamp:{type:"number",min:1}};function zp(e,t){if(Te(Wp,e,"",!0),e&&e.applicantAccountId!==t&&e.recipientAccountId!==t)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Friend application is not your own"}})}var Kp={offset:{type:"number",required:!1},limit:{type:"number",required:!1},status:{type:"array",itemType:"enum",required:!1,values:[1,4,3,0,2]}};class Yp{constructor(e,t){this.core=e,this.service=t}processSysNotification(e){if(6===e.type){var t=e.senderId;this.core.V2NIMFriendService.handleDeleteFriend(t,2)}else if(5===e.type)try{var n=JSON.parse(e.content);if(1===(null==n?void 0:n.vt)){this.core.V2NIMFriendService.handleAddFriend(e.senderId,e.timestamp);var r={applicantAccountId:e.senderId,recipientAccountId:e.receiverId,operatorAccountId:e.senderId,postscript:e.postscript,timestamp:e.timestamp,status:4,read:!1};this.service.notificationModel.appendFriendAddApplication(r),this.service.notificationModel.updateFriendAddApplicationStatus(r.applicantAccountId,4,r.applicantAccountId)}else if(2===(null==n?void 0:n.vt)){var i={applicantAccountId:e.senderId,recipientAccountId:e.receiverId,operatorAccountId:e.senderId,postscript:e.postscript,timestamp:e.timestamp,status:0,read:!1};this.service.handleApplyFriend(i),this.service.notificationModel.appendFriendAddApplication(i)}else if(3===(null==n?void 0:n.vt)){this.core.V2NIMFriendService.handleAddFriend(e.senderId,e.timestamp);var o={applicantAccountId:e.receiverId,recipientAccountId:e.senderId,operatorAccountId:e.senderId,timestamp:e.timestamp,postscript:e.postscript,status:1,read:!1};this.service.notificationModel.appendFriendAddApplication(o)}else if(4===(null==n?void 0:n.vt)){var s={applicantAccountId:e.receiverId,recipientAccountId:e.senderId,operatorAccountId:e.senderId,timestamp:e.timestamp,postscript:e.postscript,status:2,read:!1};this.service.notificationModel.appendFriendAddApplication(s),this.service.emit("onFriendAddRejected",s)}}catch(a){this.core.logger.warn("V2NIMFriendNotificationImpl::processSysNotification, parse content error:",a)}}}class Jp{constructor(){this.validFriendIds=new Set,this.friendMap=new Map,this.friendTimetag=0}reset(){this.friendMap.clear(),this.validFriendIds.clear()}upsertFriend(e,t){delete t.relationShip;var n=this.friendMap.get(e)||{},r=Object.assign({accountId:e},n,t);return this.friendMap.set(e,r),this.validFriendIds.add(e),r}addFriend(e){this.validFriendIds.add(e)}deleteFriend(e){this.validFriendIds.delete(e)}getFriend(e){return this.validFriendIds.has(e)?this.friendMap.get(e):void 0}getFriendList(){return Array.from(this.validFriendIds.values()).map(e=>this.getFriend(e)).filter(e=>!!e)}getFriendListBySearchOption(e){return Array.from(this.validFriendIds.values()).map(e=>this.getFriend(e)).filter(t=>{var n=void 0===e.searchAlias||e.searchAlias;return!(void 0===t||!(n&&t.alias&&t.alias.includes(e.keyword)||e.searchAccountId&&t.accountId.includes(e.keyword)))})}getFriendByIds(e){return e.map(e=>this.getFriend(e)).filter(e=>!!e)}setFriendTimetag(e){this.friendTimetag=e}getFriendTimetag(){return this.friendTimetag}}class Xp{constructor(){this.list=[],this.maxCount=1e3}reset(){this.list=[]}updateFriendAddApplicationStatus(e,t,n){if(0!==t)for(var r of this.list)r.applicantAccountId===e&&0===r.status&&(r.status=t,r.operatorAccountId=n)}getAddApplicationList(e){var t=void 0===e.offset?0:e.offset,n=this.list.filter(t=>{var n=e.status||[];return 0===n.length||!!n.includes(t.status)}).reverse(),r=e.limit||50,i=n.slice(t,t+r),o=t+r>=n.length;return{infos:i,finished:o,offset:o?0:t+r}}checkSameApplication(e,t,n=!1){return e.applicantAccountId===t.applicantAccountId&&e.recipientAccountId===t.recipientAccountId&&(!n||e.timestamp===t.timestamp)}setAllApplicationRead(){for(var e of this.list)e.read=!0}setApplicationRead(e){for(var t of this.list)this.checkSameApplication(t,e)&&(t.read=!0)}getAddApplicationUnreadCount(){var e=new Set;for(var t of this.list)t.read||0!==t.status||e.add(t.applicantAccountId);return e.size}appendFriendAddApplication(e){this.list.push(e),this.list.length>this.maxCount&&this.list.shift()}clearApplicationList(){this.list=[]}deleteApplication(e){this.list=this.list.map(t=>{if(!this.checkSameApplication(t,e,!1))return t}).filter(e=>e)}}var Qp={muteMode:{type:"enum",values:[2,0,1]}},Zp={accountId:{type:"string",required:!0,allowEmpty:!1},muteMode:{type:"enum",required:!0,values:[2,0,1]}},eh={type:"object",required:!1,rules:{certificateName:{type:"string",required:!0,allowEmpty:!1},appId:{type:"string",required:!1,allowEmpty:!1},appKey:{type:"string",required:!1,allowEmpty:!1},secret:{type:"string",required:!1,allowEmpty:!1}}},th={config:{type:"object",required:!0,rules:{apns:eh,hwPush:eh,miPush:eh,vivoPush:eh,oppoPush:eh,honorPush:eh,fcmPush:eh,mzPush:eh}}},nh="V2NIMSettingService",rh={"34_1":"v2SetDeviceToken","34_2":"v2SetAppBackground","34_15":"v2SetPushMobileOnDesktopOnline","3_115":"v2SettingMutilSyncDonnop","4_13":"v2SettingSyncDonnop"},ih={need:{id:1,converter:e=>e?2:1,retConverter:e=>"2"===e}},oh={v2SetDeviceToken:{sid:34,cid:1,service:nh,params:[{type:"String",name:"certificateName"},{type:"String",name:"pushDeviceToken"},{type:"Int",name:"pushkit"}]},v2SetAppBackground:{sid:34,cid:2,service:nh,params:[{type:"Bool",name:"isBackground"},{type:"Int",name:"badge"}]},v2SetPushMobileOnDesktopOnline:{sid:34,cid:15,service:nh,params:[{type:"Property",name:"tag",reflectMapper:ih}]},v2SettingMutilSyncDonnop:{sid:3,cid:115,service:nh,response:[{type:"Property",name:"data",reflectMapper:Wt(ih)},{type:"Long",name:"timetag"}]},v2SettingSyncDonnop:{sid:4,cid:13,service:nh,response:[{type:"Property",name:"data",reflectMapper:Wt(ih)},{type:"Long",name:"timetag"}]}};class sh{constructor(e,t){this.core=e,this.service=t}v2SettingMutilSyncDonnopHandler(e){var{need:t}=e.content.data;this.service.needToPushMobileOnDesktopOnline=t,this.service.emit("onPushMobileOnDesktopOnline",t)}v2SettingSyncDonnopHandler(e){var{need:t}=e.content.data;this.service.needToPushMobileOnDesktopOnline=t,this.service.emit("onPushMobileOnDesktopOnline",t)}}class ah{constructor(e,t){this.offlinePushPlugin=void 0,this.offlinePushConfig=void 0,this.authConfig=void 0,this.aosPushInfo=void 0,this.appBackgroundOptions={badge:0,isBackground:!1},this.setTokenAndBackgroundStateAfterLogin=e=>{this.aosPushInfo=e,this.logger.log("OfflinePushService: setToken, deviceClientId:",null==e?void 0:e.clientId),this.offlinePushPlugin&&(this.logger.log("OfflinePushService: setToken plugin is provided"),this.logger.log("OfflinePushService: setToken pushType is: ",e&&e.pushType),this.regToken(),this.core.sendCmd("v2SetAppBackground",{isBackground:this.appBackgroundOptions.isBackground,badge:this.appBackgroundOptions.badge||0}))},this.core=e,this.service=t,this.logger=e.logger}getRNDeviceInfo(){var e;return this.logger.log("OfflinePushService:getDeviceInfo start"),null===(e=this.offlinePushPlugin)||void 0===e||e.init(JSON.stringify(this.authConfig),(e,t,n)=>{if(this.logger.log(`OfflinePushService:: type: ${e}, tokenName: ${t}, token: ${n}`),n){var r="",i=we.getSystemInfo()||{},o=i.os?i.os.toLowerCase():"";this.aosPushInfo&&this.aosPushInfo.pushType?r=this.aosPushInfo.pushType:"ios"===o?r="":"android"===o&&(r="8"),this.pushTokenToServer(r,n)}else this.logger.warn("OfflinePushService:: token is empty. Please check your parameters")}),new Promise((e,t)=>{var n;null===(n=this.offlinePushPlugin)||void 0===n||n.getDeviceInfo(n=>{try{this.logger.log(`OfflinePushService:getDeviceInfo result ${n?JSON.stringify(n):""}`),e(JSON.parse(n))}catch(r){t(new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"OfflinePushService:getDeviceInfo error"}}))}}),setTimeout(()=>{t(new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"OfflinePushService:getDeviceInfo timeout"}}))},2e3)})}pushTokenToServer(e,t){var n,r,i,o,s,a,c,l,d="",u=this.offlinePushConfig;switch(e){case"5":d=null===(n=null==u?void 0:u.miPush)||void 0===n?void 0:n.certificateName;break;case"6":d=null===(r=null==u?void 0:u.hwPush)||void 0===r?void 0:r.certificateName;break;case"7":d=null===(i=null==u?void 0:u.mzPush)||void 0===i?void 0:i.certificateName;break;case"8":d=null===(o=null==u?void 0:u.fcmPush)||void 0===o?void 0:o.certificateName;break;case"9":d=null===(s=null==u?void 0:u.vivoPush)||void 0===s?void 0:s.certificateName;break;case"10":d=null===(a=null==u?void 0:u.oppoPush)||void 0===a?void 0:a.certificateName;break;case"11":d=null===(c=null==u?void 0:u.honorPush)||void 0===c?void 0:c.certificateName;break;default:d=null===(l=null==u?void 0:u.apns)||void 0===l?void 0:l.certificateName}if(""===d||void 0===d)this.logger.warn("OfflinePushService:: certificate name is empty for push type: ",e);else try{if("UNIAPP"===we.platform){var p=as.parse("557d1e3cafa43e2589a588270c53d56f"),h=as.stringify(Es.decrypt(t,p));this.logger.log("OfflinePushService:: token",h),this.core.sendCmd("v2SetDeviceToken",{certificateName:d,pushDeviceToken:h,pushkit:0})}else this.core.sendCmd("v2SetDeviceToken",{certificateName:d,pushDeviceToken:t,pushkit:0})}catch(g){return this.logger.log("OfflinePushService:: decrypt error",g),void this.logger.warn("OfflinePushService:: token before decrypt",t)}}regToken(){var e=we.getSystemInfo()||{},t=e.os?e.os.toLowerCase():"";if(this.logger.log("OfflinePushService: os",t),"ios"===t||"android"===t)if(!this.offlinePushPlugin||"UNIAPP"===we.platform&&"function"!=typeof this.offlinePushPlugin.getDeviceToken||"React Native"===we.platform&&"android"===t&&"function"!=typeof this.offlinePushPlugin.init||"React Native"===we.platform&&"ios"===t&&"function"!=typeof this.offlinePushPlugin.checkPermissions)this.logger.warn("OfflinePushService: plugin is not correct, please check your plugin according to Yunxin Official Documentation");else{"React Native"===we.platform&&we.envPayload.AppState&&we.envPayload.AppState.addEventListener("change",this.handleRNAppStateChange.bind(this));var n="";this.aosPushInfo&&this.aosPushInfo.pushType?n=this.aosPushInfo.pushType:"ios"===t?n="":"android"===t&&(n="8"),this.logger.log("OfflinePushService:: prepare to get device token. suggestPushType: "+n),this.logger.log("OfflinePushService push config",JSON.stringify(this.authConfig,null,2),"platform",we.platform),"UNIAPP"===we.platform?this.offlinePushPlugin.getDeviceToken({suggestPushType:n,config:this.authConfig},e=>{e?(this.logger.log("OfflinePushService:: token is :"+e),this.pushTokenToServer(n,e)):this.logger.warn("OfflinePushService:: token is empty. Please check your parameters")}):"React Native"===we.platform&&"android"===t?(this.logger.log("OfflinePushService:: onLogin",this.core.account,typeof n,n),this.offlinePushPlugin.onLogin(this.core.account,parseInt(n),!1,"")):"React Native"===we.platform&&"ios"===t?this.offlinePushPlugin.checkPermissions(()=>{this.logger.log("OfflinePushService addEventListener requestPermissions");try{this.offlinePushPlugin.requestPermissions()}catch(e){this.logger.log("OfflinePushService:: requestPermissions error",e)}this.offlinePushPlugin.addEventListener("register",e=>{this.logger.log(`OfflinePushService:: ios token: ${e}`),this.pushTokenToServer(n,e)}),this.offlinePushPlugin.addEventListener("registrationError",e=>{this.logger.log("OfflinePushService:: ios registerError",e)})}):this.logger.error(`OfflinePushService:: platform is not supported. Please check your parameters. Platform: ${we.platform}. os: ${t}`)}else this.logger.warn("OfflinePushService: only Android or IOS support offline push")}handleRNAppStateChange(e){this.logger.log(`push::handleAppStateChange: pushConfig ios/aos; state: ${e}`),this.appBackgroundOptions={badge:this.core.V2NIMConversationService.getTotalUnreadCount(),isBackground:"background"===e||"inactive"===e},this.setAppBackground(this.appBackgroundOptions.isBackground,this.appBackgroundOptions.badge)}setOfflinePushConfig(e,t){var n,r,i,o,s,a,c,l,d,u,p,h,g,m,f,v,y,_,I,T,S,E,M,b,C,A,O,R,N,w,P,k,L,x,V,D;this.logger.log("setOfflinePushConfig","plugin",e,"config",t),this.offlinePushPlugin=e,this.offlinePushConfig=t,this.authConfig={xmAppId:null===(r=null===(n=this.offlinePushConfig)||void 0===n?void 0:n.miPush)||void 0===r?void 0:r.appId,xmAppKey:null===(o=null===(i=this.offlinePushConfig)||void 0===i?void 0:i.miPush)||void 0===o?void 0:o.appKey,xmCertificateName:null===(a=null===(s=this.offlinePushConfig)||void 0===s?void 0:s.miPush)||void 0===a?void 0:a.certificateName,hwAppId:null===(l=null===(c=this.offlinePushConfig)||void 0===c?void 0:c.hwPush)||void 0===l?void 0:l.appId,hwCertificateName:null===(u=null===(d=this.offlinePushConfig)||void 0===d?void 0:d.hwPush)||void 0===u?void 0:u.certificateName,oppoAppId:null===(h=null===(p=this.offlinePushConfig)||void 0===p?void 0:p.oppoPush)||void 0===h?void 0:h.appId,oppoAppKey:null===(m=null===(g=this.offlinePushConfig)||void 0===g?void 0:g.oppoPush)||void 0===m?void 0:m.appKey,oppoAppSecret:null===(v=null===(f=this.offlinePushConfig)||void 0===f?void 0:f.oppoPush)||void 0===v?void 0:v.secret,oppoCertificateName:null===(_=null===(y=this.offlinePushConfig)||void 0===y?void 0:y.oppoPush)||void 0===_?void 0:_.certificateName,vivoAppId:null===(T=null===(I=this.offlinePushConfig)||void 0===I?void 0:I.vivoPush)||void 0===T?void 0:T.appId,vivoAppKey:null===(E=null===(S=this.offlinePushConfig)||void 0===S?void 0:S.vivoPush)||void 0===E?void 0:E.appKey,vivoCertificateName:null===(b=null===(M=this.offlinePushConfig)||void 0===M?void 0:M.vivoPush)||void 0===b?void 0:b.certificateName,fcmCertificateName:null===(A=null===(C=this.offlinePushConfig)||void 0===C?void 0:C.fcmPush)||void 0===A?void 0:A.certificateName,mzAppId:null===(R=null===(O=this.offlinePushConfig)||void 0===O?void 0:O.mzPush)||void 0===R?void 0:R.appId,mzAppKey:null===(w=null===(N=this.offlinePushConfig)||void 0===N?void 0:N.mzPush)||void 0===w?void 0:w.appKey,mzCertificateName:null===(k=null===(P=this.offlinePushConfig)||void 0===P?void 0:P.mzPush)||void 0===k?void 0:k.certificateName,apnsCertificateName:null===(x=null===(L=this.offlinePushConfig)||void 0===L?void 0:L.apns)||void 0===x?void 0:x.certificateName,honorCertificateName:null===(D=null===(V=this.offlinePushConfig)||void 0===V?void 0:V.honorPush)||void 0===D?void 0:D.certificateName}}setAppBackground(e,t){return Ce(this,void 0,void 0,function*(){this.appBackgroundOptions={isBackground:e,badge:t||0},yield this.core.sendCmd("v2SetAppBackground",{isBackground:e,badge:t||0})})}}class ch{constructor(e,t){this.p2pMessageMuteModeChangeHandler=(e,t)=>{this.service.emit("onP2PMessageMuteModeChanged",e,t),this.hasUserService&&this.core.V2NIMUserService.model.setAccountMuteMode(e,t);var n=this.core.V2NIMConversationIdUtil.p2pConversationId(e),r=1===t;this.core.eventBus.emit("V2NIMSettingService/setMute",n,r)},this.core=e,this.service=t}get hasUserService(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}get hasTeamService(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}getConversationMuteStatus(e){if("string"!=typeof e)return!1;var t=this.core.V2NIMConversationIdUtil.parseConversationType(e),n=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e);return 3===t?0!==this.getTeamMessageMuteMode(n,2):2===t?0!==this.getTeamMessageMuteMode(n,1):!(1!==t||!this.hasUserService||!this.core.V2NIMUserService.model.muteList.has(n))}setTeamMessageMuteMode(e,t,n){return Ce(this,void 0,void 0,function*(){var r=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",i={teamId:e,teamType:t,accountId:this.core.account,bits:n};yield this.core.sendCmd(r,{teamMember:i}),this.core.V2NIMTeamService.memberModel.upsert(i),this.service.emit("onTeamMessageMuteModeChanged",e,t,n);var o=1===t?this.core.V2NIMConversationIdUtil.teamConversationId(e):this.core.V2NIMConversationIdUtil.superTeamConversationId(e),s=this.getConversationMuteStatus(o);this.core.eventBus.emit("V2NIMSettingService/setMute",o,s)})}getTeamMessageMuteMode(e,t){var n;return"string"!=typeof e||"number"!=typeof t?0:this.hasTeamService?3&((null===(n=this.core.V2NIMTeamService.memberModel.getById(e,t,this.core.account))||void 0===n?void 0:n.bits)||0):0}getAllTeamMessageMuteMode(e){if(!this.hasTeamService)return Promise.resolve({});var t=this.core.V2NIMTeamService.memberModel.chooseList(e),n={};return t.forEach(e=>{if(e.accountId===this.core.account){var t=e.bits||0;n[e.teamId]=3&t}}),Promise.resolve(n)}setP2PMessageMuteMode(e,t){return Ce(this,void 0,void 0,function*(){yield this.core.sendCmd("v2SetP2PMessageMuteMode",{accountId:e,muteMode:1===t}),this.p2pMessageMuteModeChangeHandler(e,t)})}getP2PMessageMuteMode(e){return this.hasUserService&&this.core.V2NIMUserService.model.muteList.has(e)?1:0}getP2PMessageMuteList(){return this.hasUserService?Promise.resolve(Array.from(this.core.V2NIMUserService.model.muteList)):Promise.resolve([])}}class lh{constructor(e,t){this.core=e,this.service=t,this.push=t.push,this.mute=t.mute}setListener(){this.core.eventBus.on("V2NIMSettingService/updateBits",(e,t,n)=>{this.service.emit("onTeamMessageMuteModeChanged",e,t,n)}),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",this.push.setTokenAndBackgroundStateAfterLogin.bind(this.push)),this.core.eventBus.on("v2NIMUserService/updateMuteList",this.mute.p2pMessageMuteModeChangeHandler.bind(this.mute)),this.core.eventBus.on("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",this.mute.p2pMessageMuteModeChangeHandler.bind(this.mute))}}var dh={"27_1":"v2NIMSync","27_10":"v2QChatSync"},uh={v2NIMSync:{sid:27,cid:1,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,p2pTeamModifyMessage:30,superTeamModifyMessage:31,filterMsgs:100}}],response:[{type:"Long",name:"timetag"}]},v2QChatSync:{sid:27,cid:10,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Long",name:"timetag"}]}};class ph{constructor(){this.aiStreamMap=new Map}reset(){this.aiStreamMap.clear()}getAiStream(e){return this.aiStreamMap.get(e)}getAiStreamIsComplete(e){var t=this.aiStreamMap.get(e);return!t||t.isComplete}getAiStreamQueryStatus(e){var t=this.aiStreamMap.get(e);return t?t.queryStatus:0}upsertAiStreamChunks(e,t,n){var r=this.aiStreamMap.get(e);return r&&!r.isComplete&&(r.chunks[t]=n),r||{isComplete:!1,queryStatus:0,chunks:[]}}setAiStream(e,t,n=!1){var r=this.aiStreamMap.get(e);return r?this.aiStreamMap.set(e,Object.assign(Object.assign({},r),t)):n&&this.aiStreamMap.set(e,Object.assign({isComplete:!1,queryStatus:0,chunks:[]},t)),this.aiStreamMap.get(e)||{isComplete:!1,queryStatus:0,chunks:[]}}completeAiStream(e){var t=this.aiStreamMap.get(e);t&&this.aiStreamMap.set(e,Object.assign(Object.assign({},t),{isComplete:!0,queryStatus:0,chunks:[],aiRAGs:void 0}))}}var hh="V2NIMAIService",gh={"4_26":"v2AIChatNotify","29_35":"v2AIProxyModelCall","29_36":"v2AIGetUserList","4_29":"v2AIOnStreamMessageChunk","4_30":"v2AIChatStreamNotify","29_38":"v2AIStopModelStreamCall","29_39":"v2AIStreamQuery","29_40":"v2AIRegenMessage"},mh={accountId:1,messages:{id:2,converter:Yt,retConverter:Jt},requestId:3,content:{id:4,converter:Yt,retConverter:Jt},promptVariables:5,modelConfigParams:{id:6,converter:Yt,retConverter:Jt},antispamBusinessId:7,antispamEnabled:{id:8,converter:zt},aiStream:{id:9,converter:zt}},fh={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,modelType:{id:11,retType:"number"},modelConfig:{id:12,retConverter:e=>{if(e=Jt(e)){var t=Object.keys(e).reduce((t,n)=>{return t[(r=n,(r=r||"").split("_").map((e,t)=>0===t?e:e[0].toUpperCase()+e.slice(1)).join(""))]=e[n],t;var r},{});if("string"==typeof t.promptKeys)try{t.promptKeys=JSON.parse(t.promptKeys)}catch(n){}return t}}},yunxinConfig:{id:13,retConverter:e=>{if(e=Jt(e))return e}},valid:{id:14,retType:"boolean"},createTime:{id:15,retType:"number"},updateTime:{id:16,retType:"number"}};function vh(e){try{var t=JSON.parse(e);return"number"==typeof t.index?{msg:t.msg||"",type:t.type,lastChunk:{content:t.msg,chunkTime:parseInt(t.timestamp),type:t.type,index:parseInt(t.index)}}:t}catch(n){return}}function yh(e){try{var t=JSON.parse(e);return t&&t.length>0?t.map(e=>(e.description=e.desc,delete e.desc,e)):[]}catch(n){return[]}}var _h={code:{id:1,retType:"number"},accountId:2,requestId:3,content:{id:4,retConverter:vh},aiRAGs:{id:5,retConverter:yh},timestamp:{id:6,retType:"number"},aiStreamStatus:{id:7,retType:"number"},aiStream:{id:8,retType:"boolean"}},Ih={serverId:1,clientId:2,type:{id:3,retType:"number"},from:4,to:5,aiAccount:6,startIndex:{id:7,retType:"number"},endIndex:{id:8,retType:"number"},excludeIndex:{id:9,converter:Yt}},Th={serverId:1,clientId:2,type:{id:3,retType:"number"},content:{id:4,retConverter:vh},aiRAGs:{id:6,retConverter:yh}},Sh={v2AIChatNotify:{sid:4,cid:26,service:hh,response:[{type:"Property",name:"data",reflectMapper:Wt(_h)}]},v2AIProxyModelCall:{sid:29,cid:35,service:hh,params:[{type:"Property",name:"tag",reflectMapper:mh}]},v2AIGetUserList:{sid:29,cid:36,service:hh,params:[{type:"Property",name:"tag",reflectMapper:{pageToken:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(fh)},{type:"Property",name:"queryTag",reflectMapper:Wt({hasMore:{id:16,retType:"boolean"},nextToken:2})}]},v2AIOnStreamMessageChunk:{sid:4,cid:29,service:hh,response:[{type:"Property",name:"msg",reflectMapper:Wt(ld)}]},v2AIChatStreamNotify:{sid:4,cid:30,service:hh,response:[{type:"Property",name:"data",reflectMapper:Wt(_h)}]},v2AIStopModelStreamCall:{sid:29,cid:38,service:hh,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,clientId:2,type:{id:3,retType:"number"},from:4,to:5,aiAccount:6,opeType:{id:7,retType:"number"},updateContent:{id:8},messageTime:{id:11,retType:"number"}}}]},v2AIStreamQuery:{sid:29,cid:39,service:hh,params:[{type:"Property",name:"tag",reflectMapper:Ih}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Th)}]},v2AIRegenMessage:{sid:29,cid:40,service:hh,params:[{type:"Property",name:"tag",reflectMapper:{fromAccount:1,to:2,aiAccount:3,serverId:4,clientId:5,time:{id:6,retType:"number"},type:{id:7,retType:"number"},opeType:{id:8,retType:"number"},replyMsgFromAccount:9,replyMsgToAccount:10,replyMsgTime:{id:11,retType:"number"},replyMsgIdServer:12,replyMsgIdClient:13}}]}};class Eh{constructor(e,t){this.core=e,this.service=t,this.logger=this.core.logger}setListener(){}beforeEmit(e,...t){var n,r,i=`${this.service.name}::emit ${e.toString()}`;if("onProxyAIModelCall"===e){var o=t[0];this.logger.log(`${i}`,`requestId:${o.requestId};aiStreamStatus:${o.aiStreamStatus}`)}else if("onProxyAIModelStreamCall"===e){var s=t[0];this.logger.log(`${i}`,`requestId:${s.requestId};chunkIndex:${null===(n=s.content)||void 0===n?void 0:n.lastChunk.index};chunkTime:${null===(r=s.content)||void 0===r?void 0:r.lastChunk.chunkTime}`)}else this.logger.log(`${i}`,...t)}}class Mh{constructor(e,t){this.core=e,this.service=t,this.model=t.model,this.logger=this.core.logger}v2AIChatNotifyHandler(e){var t=e.content.data;t&&t.requestId&&(this.model.completeAiStream(t.requestId),t.aiStreamStatus=t.aiStreamStatus||0,t.aiStream=t.aiStream||!1,t.content&&(t.content.msg=t.content.msg||""),this.service.emit("onProxyAIModelCall",t))}v2AIChatStreamNotifyHandler(e){var t=e.content.data;if(t&&t.requestId&&t.content&&t.content.msg){var n=this.model.getAiStream(t.requestId);if(n||(n=this.model.setAiStream(t.requestId,{isComplete:!1,queryStatus:0,chunks:[]},!0)),!n.isComplete){var{lastChunk:r}=t.content;if(0===r.index&&t.aiRAGs&&(n=this.model.setAiStream(t.requestId,{aiRAGs:t.aiRAGs})),this.logger.log(`V2AI::streamNotify requestId:${t.requestId};index:${r.index};cacheChunkLength:${n.chunks.length};chunkTime:${r.chunkTime}.`),0===n.chunks.length&&r.index>0)this.logger.log(`V2AI::streamNotify requestId:${t.requestId};chunks missing 0,currentIdx:${r.index},needQuery:${0===n.queryStatus}.`),0===n.queryStatus&&(n=this.model.setAiStream(t.requestId,{queryStatus:1}),this.service._queryAiStream({clientId:t.requestId,type:4,from:this.core.account,aiAccount:t.accountId,startIndex:0,endIndex:r.index-1}));else if(r.index>0&&n.chunks.length>0&&void 0===n.chunks[r.index-1]){var i=n.chunks.reduce((e,t,n)=>(void 0!==t&&e.push(n),e),[]);this.logger.log(`V2AI::streamNotify requestId:${t.requestId};out of order,currenIdx:${r.index},cacheIdx:[${i.join(",")}],needReport:${!n.hasReported}.`),n.hasReported||(n=this.model.setAiStream(t.requestId,{hasReported:!0}),this.reportOutOfOrder({requestId:t.requestId,cacheIds:i,targetIndex:r.index,target:"4-30"}))}(n=this.model.upsertAiStreamChunks(t.requestId,r.index,r.content)).chunks[0]||1!==n.queryStatus?(t.content.msg=n.chunks.join(""),n.aiRAGs&&(t.aiRAGs=n.aiRAGs),this.service.emit("onProxyAIModelStreamCall",t)):this.logger.log(`V2AI::streamNotify requestId:${t.requestId};chunks ignore index:${r.index};queryStatus:${n.queryStatus}.`)}}}v2AIOnStreamMessageChunkHandler(e){var t,n,r,i=Jl(this.core,e.content.msg);if(i.streamConfig&&i.streamConfig.lastChunk){var o=this.model.getAiStream(i.messageClientId);if(!o||!o.isComplete){o||(o=this.model.setAiStream(i.messageClientId,{isComplete:!1,queryStatus:0,chunks:[]},!0));var s=i.streamConfig.lastChunk,a=i.messageClientId;if(0===s.index&&(null===(t=i.aiConfig)||void 0===t?void 0:t.aiRAGs)&&(o=this.model.setAiStream(a,{aiRAGs:i.aiConfig.aiRAGs})),this.logger.log(`V2AI::aiStream requestId:${a};index:${s.index};cacheChunkLength:${o.chunks.length};chunkTime:${s.chunkTime}.`),0===o.chunks.length&&s.index>0)this.logger.log(`V2AI::msg:aiStream requestId:${a};chunks missing 0,currentIdx:${s.index},needQuery:${0===o.queryStatus}.`),0===o.queryStatus&&(o=this.model.setAiStream(a,{queryStatus:1}),this.service._queryAiStream({serverId:i.messageServerId,clientId:a,type:(null===(n=i.aiConfig)||void 0===n?void 0:n.accountId)?i.conversationType:5,from:i.senderId,to:i.receiverId,aiAccount:null===(r=i.aiConfig)||void 0===r?void 0:r.accountId,startIndex:0,endIndex:s.index-1}));else if(s.index>0&&o.chunks.length>0&&void 0===o.chunks[s.index-1]){var c=o.chunks.reduce((e,t,n)=>(void 0!==t&&e.push(n),e),[]);this.logger.log(`V2AI::msg:aiStream requestId:${a};out of order,currenIdx:${s.index};streamCache.chunks:${JSON.stringify(o.chunks)},cacheIdx:[${c.join(",")}],needReport:${!o.hasReported}.`),o.hasReported||(o=this.model.setAiStream(a,{hasReported:!0}),this.reportOutOfOrder({requestId:a,cacheIds:c,targetIndex:s.index,target:"4-29"}))}(o=this.model.upsertAiStreamChunks(a,s.index,s.content)).chunks[0]||1!==o.queryStatus?(i.streamConfig.status=-1,i.aiConfig&&(i.aiConfig.aiStreamStatus=-1),i.text=o.chunks.join(""),o.aiRAGs&&i.aiConfig&&(i.aiConfig.aiRAGs=o.aiRAGs),o.msg&&(i=Object.assign({},o.msg,Object.assign({text:i.text,modifyTime:s.chunkTime,modifyAccountId:o.msg.senderId,streamConfig:i.streamConfig},i.aiConfig?{aiConfig:i.aiConfig}:{}))),this.core.eventBus.emit("V2NIMAIService/receiveMessagesModified",[i])):this.logger.log(`V2AI::msg:callStream requestId:${a};chunks ignore index:${s.index};queryStatus:${o.queryStatus}.`)}}}reportOutOfOrder(e){this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.account,trace_id:Ve(this.core,"clientSocket.socket.sessionId"),action:2,exception_service:0}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:0,context:e.requestId,description:`[${e.cacheIds.join(",")}],${e.targetIndex}`,operation_type:2,target:e.target,net_connect:!0}),this.core.reporter.reportTraceEnd("exceptions",4)}}var bh={"18_1":"v2SignallingCreateRoom","18_2":"v2SignallingDelayRoom","18_3":"v2SignallingCloseRoom","18_4":"v2SignallingJoinRoom","18_5":"v2SignallingLeaveRoom","18_6":"v2SignallingInvite","18_7":"v2SignallingCancelInvite","18_16":"v2SignallingCall","18_17":"v2SignallingCallSetup","18_8":"v2SignallingRejectInvite","18_9":"v2SignallingAcceptInvite","18_10":"v2SignallingSendControl","15_11":"v2SignallingOnlineEvent","15_12":"v2SignallingMultiClientEvent","15_13":"v2SignallingOfflineEvent","15_14":"v2SignallingSyncChannels","18_15":"v2SignallingGetRoomInfo"},Ch="V2NIMSignallingService",Ah={accountId:1,uid:{id:2,retType:"number"},joinTime:{id:3,retType:"number"},expireTime:{id:4,retType:"number"},deviceId:5},Oh={channelType:{id:1,retType:"number",retAccess:"channelInfo.channelType"},channelName:{id:2,retAccess:"channelInfo.channelName"},channelId:{id:3,retAccess:"channelInfo.channelId"},createTime:{id:4,retType:"number",retAccess:"channelInfo.createTime"},expireTime:{id:5,retType:"number",retAccess:"channelInfo.expireTime"},creatorAccountId:{id:6,retAccess:"channelInfo.creatorAccountId"},channelExtension:{id:7,retAccess:"channelInfo.channelExtension"},channelValid:{id:8,retDef:!0,retAccess:"channelInfo.channelValid",retConverter:e=>1!==parseInt(e)},fromAccid:10,toAccid:11,requestId:12,pushEnabled:{id:13,access:"pushConfig.pushEnabled",converter:zt,retType:"boolean"},pushTitle:{id:14,access:"pushConfig.pushTitle"},pushContent:{id:15,access:"pushConfig.pushContent"},pushPayload:{id:16,access:"pushConfig.pushPayload"},unreadEnabled:{id:17,access:"signallingConfig.unreadEnabled",converter:zt,retType:"boolean",def:1},members:{id:18,retAccess:"members",retConverter:e=>{try{return JSON.parse(e).map(e=>qt(e,Wt(Ah)))}catch(t){return}}},attach:{id:19,retConverter:Jt},serverExtension:{id:20,retDef:""},offlineEnabled:{id:21,converter:zt,retType:"boolean",def:1},msgId:22,selfUid:{id:23,retType:"number",access:"signallingConfig.selfUid"},time:{id:24,retType:"number"},rtcChannelName:{id:25,access:"rtcConfig.rtcChannelName"},rtcTokenTtl:{id:26,retType:"number",access:"rtcConfig.rtcTokenTtl",retAccess:"rtcInfo.rtcTokenTtl"},rtcToken:{id:27,retAccess:"rtcInfo.rtcToken"},rtcParams:{id:28,access:"rtcConfig.rtcParams",retAccess:"rtcInfo.rtcParams"},callStatus:{id:30,retType:"number"}},Rh={v2SignallingCall:{sid:18,cid:16,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingCallSetup:{sid:18,cid:17,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingCreateRoom:{sid:18,cid:1,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingDelayRoom:{sid:18,cid:2,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingCloseRoom:{sid:18,cid:3,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingJoinRoom:{sid:18,cid:4,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingLeaveRoom:{sid:18,cid:5,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingInvite:{sid:18,cid:6,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingCancelInvite:{sid:18,cid:7,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingRejectInvite:{sid:18,cid:8,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}]},v2SignallingAcceptInvite:{sid:18,cid:9,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}]},v2SignallingSendControl:{sid:18,cid:10,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}]},v2SignallingOnlineEvent:{sid:15,cid:11,service:Ch,response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingMultiClientEvent:{sid:15,cid:12,service:Ch,response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingOfflineEvent:{sid:15,cid:13,service:Ch,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Oh)}]},v2SignallingSyncChannels:{sid:15,cid:14,service:Ch,response:[{type:"PropertyArray",name:"datas",reflectMapper:Wt(Oh)}]},v2SignallingGetRoomInfo:{sid:18,cid:15,service:Ch,params:[{type:"Property",name:"tag",reflectMapper:Oh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Oh)}]},v2SignallingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:Ch,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},Nh={calleeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},channelType:{type:"enum",values:[1,3,2]},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},wh={channelId:{type:"string",required:!0,allowEmpty:!1},callerAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},Ph={channelType:{type:"enum",values:[1,3,2]},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0}},kh={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},Lh={channelId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},xh={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},Vh={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}}},Dh={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}}},Uh={channelId:{type:"string",allowEmpty:!1},receiverAccountId:{type:"string",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},$h={channelId:{type:"string",allowEmpty:!1},inviterAccountId:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},Bh=$h;function Fh(e){var t,n=e.attach,r={eventType:n.type,channelInfo:e.channelInfo,operatorAccountId:e.fromAccid,time:e.time,serverExtension:e.serverExtension,requestId:e.requestId,pushConfig:e.pushConfig,unreadEnabled:null===(t=e.signallingConfig)||void 0===t?void 0:t.unreadEnabled},{fromAccid:i,toAccid:o}=e;switch(r.eventType){case 1:break;case 2:r.member={accountId:n.member[1],uid:Number(n.member[2]),joinTime:Number(n.member[3]),expireTime:Number(n.member[4]),deviceId:n.member[5]};break;case 3:case 4:r.operatorAccountId=i,r.inviteeAccountId=o,r.inviterAccountId=i;break;case 5:case 6:r.operatorAccountId=i,r.inviterAccountId=o,r.inviteeAccountId=i}return JSON.parse(JSON.stringify(r))}var jh,qh={"19_1":"v2PublishEvent","14_2":"v2OnUserStatusChange","19_3":"v2SubscribeUserStatus","19_4":"v2UnsubscribeUserStatus","19_5":"v2UnsubscribeAllUserStatus","19_6":"v2QuerySubscribeEvent","19_7":"v2QueryAllSubscribeEvent","14_9":"v2OnMultiUserStatusChange"},Gh="V2NIMSubscriptionService",Hh={eventType:{id:1,retType:"number"},statusType:{id:2,retType:"number"},uniqueId:3,extension:4,duration:{id:5,retType:"number"},onlineOnly:{id:6,retType:"boolean",converter:e=>e?1:2},multiSync:{id:7,retType:"boolean",converter:zt},publishTime:{id:10,retType:"number"},serverId:11,clientType:{id:12,retType:"number"},serverExtension:13,extensionReceived:14,accountId:103},Wh={eventType:{id:1,retType:"number"},duration:{id:2,retType:"number"},immediateSync:{id:3,retType:"number",converter:zt},accountId:102,subscribeTime:{id:105,retType:"number"}},zh={v2PublishEvent:{sid:19,cid:1,service:Gh,params:[{type:"Property",name:"tag",reflectMapper:Hh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Hh)}]},v2OnUserStatusChange:{sid:14,cid:2,service:Gh,response:[{type:"Property",name:"data",reflectMapper:Wt(Hh)}]},v2SubscribeUserStatus:{sid:19,cid:3,service:Gh,params:[{type:"Property",name:"tag",reflectMapper:Wh},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeUserStatus:{sid:19,cid:4,service:Gh,params:[{type:"Property",name:"tag",reflectMapper:Wh},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeAllUserStatus:{sid:19,cid:5,service:Gh,params:[{type:"Property",name:"tag",reflectMapper:Wh}]},v2QuerySubscribeEvent:{sid:19,cid:6,service:Gh,params:[{type:"Property",name:"tag",reflectMapper:Wh},{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(Wh)}]},v2QueryAllSubscribeEvent:{sid:19,cid:7,service:Gh,params:[{type:"Property",name:"tag",reflectMapper:Wh}],response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(Wh)}]},v2OnMultiUserStatusChange:{sid:14,cid:9,service:Gh,response:[{type:"PropertyArray",name:"data",reflectMapper:Wt(Hh)}]}},Kh={accountIds:{type:"array",required:!0,itemType:"string",min:1,max:100},duration:{type:"number",required:!1,min:60,max:2592e3},immediateSync:{type:"boolean",required:!1}},Yh={accountIds:{type:"array",required:!1,itemType:"string",max:100}},Jh={statusType:{type:"number",required:!0,min:1e4,max:2147483647},duration:{type:"number",required:!1,min:60,max:604800},extension:{type:"jsonstr",required:!1},onlineOnly:{type:"boolean",required:!1},multiSync:{type:"boolean",required:!1}};!function(e){e[e.V2NIM_PROXY_REQUEST_METHOD_GET=1]="V2NIM_PROXY_REQUEST_METHOD_GET",e[e.V2NIM_PROXY_REQUEST_METHOD_POST=2]="V2NIM_PROXY_REQUEST_METHOD_POST",e[e.V2NIM_PROXY_REQUEST_METHOD_PUT=3]="V2NIM_PROXY_REQUEST_METHOD_PUT",e[e.V2NIM_PROXY_REQUEST_METHOD_DELETE=4]="V2NIM_PROXY_REQUEST_METHOD_DELETE"}(jh||(jh={}));var Xh="V2NIMPassthroughService",Qh={"22_1":"v2ProxyRequest","22_2":"v2ProxyOnRequest"},Zh={zone:1,path:2,method:3,header:4,body:5},eg={v2ProxyRequest:{sid:22,cid:1,service:Xh,params:[{type:"Property",name:"tag",reflectMapper:Zh}],response:[{type:"Property",name:"data",reflectMapper:Wt(Zh)}]},v2ProxyOnRequest:{sid:22,cid:2,service:Xh,response:[{type:"Property",name:"data",reflectMapper:Wt({fromAccountId:1,body:2,time:{id:3,retType:"number"}})}]}},tg={path:{type:"string",allowEmpty:!1},zone:{type:"string",required:!1},method:{type:"enum",values:[jh.V2NIM_PROXY_REQUEST_METHOD_DELETE,jh.V2NIM_PROXY_REQUEST_METHOD_GET,jh.V2NIM_PROXY_REQUEST_METHOD_POST,jh.V2NIM_PROXY_REQUEST_METHOD_PUT],required:!1},header:{type:"jsonstr",required:!1},body:{type:"string",required:!1}};!function(e){Oe(we,e())}(()=>({setLogger:It,platform:"UNIAPP",localStorage:Et,request:Rt,WebSocket:Vt,uploadFile:Lt,getFileUploadInformation:xt,getSystemInfo:kt,net:Ct,powerMonitor:new Ot,logStorage:Mt})),yt.registerService(class extends An{constructor(e,t){super("V1NIMLoginService",e),this.account="",this.token="",this.deviceId="",this.processId="",this.clientSession="",this.status="unconnected",this.config=xn,this.isManualLoginAttempt=!1,this.core._registerDep(Ln,"misc"),Gt({cmdMap:nn,cmdConfig:sn}),e.V1NIMLoginService=this,t&&this.setOptions(t);var n=new Mn(this.core,this);this.clientSocket=n,"v1"===this.core.options.apiVersion&&(this.core.clientSocket=n,this.core.auth=this),this.lbs=new bn(e),this.authenticator=new Cn(e),this.doLoginStepsManager=new nt}reset(){this.lbs.reset()}setOptions(e){var t,n,r;e&&Object.keys(e).length>0?(this.config=qe(this.config,e),this.account=e.account||this.core.options.account,this.token=e.token||this.core.options.token,this.core.options=Object.assign(Object.assign({},this.core.options),this.config)):(this.config=qe(this.core.options,this.config),this.account=this.core.options.account,this.token=this.core.options.token),null===(n=null===(t=this.core.clientSocket)||void 0===t?void 0:t.setLinkSSL)||void 0===n||n.call(t,null===(r=this.config.linkSSL)||void 0===r||r);var i="",o="";this.config.isFixedDeviceId?(i=we.localStorage.getItem("__NIM_DEVC_ID__")||Ue(),o=we.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||Ue(),we.localStorage.setItem("__NIM_DEVC_ID__",i),we.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",o)):(i=Ue(),o=Ue()),this.deviceId=i,this.clientSession=o,this.core.reporter.setConfig({common:{dev_id:i}})}connect(e={}){return this.login(e)}login(e={}){return Ce(this,void 0,void 0,function*(){this._checkApiVersion(),e.isAutoReconnect||(this.isManualLoginAttempt=!0,this.processId=Ue()),yield this._connect(e),this.core.abtest.abtRequest();try{yield this.doLogin(e.isAutoReconnect),this.processId=Ue(),this.isManualLoginAttempt=!1}catch(t){throw this.isManualLoginAttempt=!1,t}})}_connect(e={}){return Ce(this,void 0,void 0,function*(){if(!/^(unconnected|waitReconnect)$/.test(this.core.status)){var t=`NIM status is ${this.core.status}, and would not connect`;return this.logger.warn(t),Promise.reject(t)}this.clientSocket.beforeConnect(),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",{user_id:this.core.options.account,action:e.isAutoReconnect?"auto_login":"manual_login",binary_websocket:!1,process_id:this.processId}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:JSON.stringify(Object.assign(Object.assign({},this.core.options),{account:"***",token:"***"})),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:we.net.getNetworkStatus()});var n=yield this.lbs.getLbsInfos();try{var r=yield this.clientSocket.connect({linkUrls:n,isAutoReconnect:e.isAutoReconnect},(e,t)=>{this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:e.code||408,description:`ws_handshake_failed:${e.message}`,succeed:!1},{asyncParams:we.net.getNetworkStatus()})});r&&this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:r,code:200,succeed:!0},{asyncParams:we.net.getNetworkStatus()})}catch(i){throw this.core.reporter.reportTraceEnd("login",!1),i}})}doLogin(e=!1){return Ce(this,void 0,void 0,function*(){var t;try{t=yield this.authenticator.verifyAuthentication(e),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:200,succeed:!0},{asyncParams:we.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!0),this.core.status="logined"}catch(s){var n=s,r=Ve(n,"data.disconnect_reason")||"",i=415===n.code?JSON.stringify({disconnect_reason:r}):n.message;if(this.core.logger.warn("nim login:: login failed",s),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:n.code||0,succeed:!1,description:i},{asyncParams:we.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!1),this.clientSocket.doDisconnect(yn.OFFLINE,this.isManualLoginAttempt?"FailedToInitializeLogin":"ReconnectLoginFailed",s),this.isManualLoginAttempt)throw s;return}try{var o=t.loginTime?parseInt(t.loginTime):Date.now();yield this.core.cloudStorage.init(o)}catch(s){this.core.logger.error("NIM:login cloudStorage init failed ",s)}this.core.eventBus.emit("logined",t),this.core.emit("logined",t),this.emit("logined",t),this.core.logger.log("login done"),this.clientSocket.resetConnectStatus(),this.clientSocket.ping()})}disconnect(){return this.logout()}logout(){return Ce(this,void 0,void 0,function*(){switch(this._checkApiVersion(),this.doLoginStepsManager.clear(),this.status){case"logined":try{yield this.clientSocket.sendCmd("logout",void 0,{timeout:1e3}),this.clientSocket.doDisconnect(yn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData()}catch(ie){this.logger.error("Instance::disconnect sendCmd:logout error",ie),this.clientSocket.doDisconnect(yn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData()}break;case"connected":case"connecting":case"waitReconnect":return this.clientSocket.doDisconnect(yn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),Promise.resolve();case"unconnected":case"destroyed":return Promise.resolve()}})}kick(e){var t;return Ce(this,void 0,void 0,function*(){this._checkApiVersion();var n=yield this.clientSocket.sendCmd("kick",e);return null===(t=n.content)||void 0===t?void 0:t.deviceIds})}_checkApiVersion(){if("v1"!==this.core.options.apiVersion)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v1"'}})}nimLoginClientChangeHandler(e){if(e.error)this.logger.error("nimLoginClientChangeHandler:: error, ",e.error);else{var{datas:t,state:n}=e.content,r=gn(t,n);r.length>0&&(this.core.emit("multiPortLogin",r),this.emit("multiPortLogin",r))}}kickedHandler(e){if(e.error)this.logger.error("kickedHandler:: error, ",e.error);else{var t=(n=e.content,r=an({clientType:{type:"enum",values:Zt},customClientType:{type:"number"}},n),i=(i=mn[r.reason])||{reason:"unknow",message:"Unknown reason"},Object.assign(r,i));this.logger.warn("kicked::",t),this.clientSocket.doDisconnect(yn.KICKED,t),this.core._clearModuleData()}var n,r,i}getConnectStatus(){switch(this.core.status){case"unconnected":case"destroyed":default:return 0;case"connecting":return 2;case"connected":case"logined":return 1;case"waitReconnect":return 3}}getLoginStatus(){switch(this.core.status){case"unconnected":case"destroyed":case"waitReconnect":default:return 0;case"connecting":case"connected":return 2;case"logined":return 1}}getLoginUser(){return this.core.options.account}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;return this.logger.log(`${n}`,...t),super.emit(e,...t)}},"V1NIMLoginService"),yt.registerService(class extends On{constructor(e){super("msg",e),this.onV2SendMessage=e=>{var t=ni(e,{account:this.core.account,featureValue:tn.default});t.status=e.status,this.core.eventBus.emit("session/updateForNewMsg",t)},this.onV2ModifyMessage=e=>{var t,n=`${Qt[e.scene]}-${e.to===this.core.account?e.from:e.to}`,r=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:n}),i=ni(e,r?{account:this.core.account,sessionAck:r.ack,msgReceiptTime:r.msgReceiptTime}:{account:this.core.account});this.core.eventBus.emit("session/updateForModifyMsg",i)},this.onV2RecallMsg=e=>{var t=ai([e],Mi(+e.type));this.core.eventBus.emit("session/updateForDeletedMsg",t)},this.onV2DeleteSelfMsgs=e=>{var t=ai(e);this.core.eventBus.emit("session/updateForDeletedMsg",t)},this.service=new li(e),Gt({cmdMap:mi,cmdConfig:_i}),this.registerListener()}registerListener(){this.core.eventBus.on("forwardReceive/msg/sendMsg",this.onV2SendMessage),this.core.eventBus.on("forwardReceive/msg/modifyMsg",this.onV2ModifyMessage),this.core.eventBus.on("forwardReceive/msg/recallMsg",this.onV2RecallMsg),this.core.eventBus.on("forwardReceive/msg/deleteSelfMsgs",this.onV2DeleteSelfMsgs)}sendTextMsg(e){return Te({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(Object.assign(Object.assign({},e),{type:"text"}))}sendTipMsg(e){return Te({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(Object.assign(Object.assign({},e),{type:"tip"}))}sendGeoLocationMsg(e){return Te({attach:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},e),this.sendMsg(Object.assign(Object.assign({},e),{type:"geo",attach:JSON.stringify(e.attach)}))}sendCustomMsg(e){return Te({attach:{type:"string",allowEmpty:!1}},e),this.sendMsg(Object.assign(Object.assign({},e),{type:"custom"}))}sendMsg(e){var t;if(Te({scene:{type:"enum",values:$e(Qt)},type:{type:"enum",values:$e(Xt)},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},setting:{type:"object",rules:{resendFlag:{type:"boolean",required:!1},needSaveHistory:{type:"boolean",required:!1},needRoaming:{type:"boolean",required:!1},needOffline:{type:"boolean",required:!1},needSelfSync:{type:"boolean",required:!1},needRouted:{type:"boolean",required:!1},needUpdateSession:{type:"boolean",required:!1}},required:!1},antiSpamInfo:{type:"object",required:!1,rules:{clientAntispamHitting:{type:"boolean",required:!1},antiSpamUsingYidun:{type:"boolean",required:!1}}},pushInfo:{type:"object",required:!1,rules:Jr},robotInfo:{type:"object",required:!1,rules:Xr},teamSpecializationInfo:{type:"object",required:!1,rules:{needACK:{type:"boolean",required:!1}}}},e),"team"===e.scene&&e.robotInfo&&!e.robotInfo.account)throw new he('When "scene" equals "team", account is required in robotInfo',{key:"account"},"required");var n,r="p2p"===e.scene?"sendMsg":"team"===e.scene?"sendTeamMsg":"sendSuperTeamMsg",i=si(e,this.core.account,this.core.config.deviceId,null===(t=this.core.user)||void 0===t?void 0:t.myInfo),o=ni(Object.assign(Object.assign({},i),{time:(new Date).getTime()}),{account:this.core.account,featureValue:tn.default,statusValue:en.sending});try{e.onSendBefore&&e.onSendBefore(o)}catch(s){this.logger.error("sendMsg: options.onSendBefore error",s)}return this.core.eventBus.emit("session/updateForNewMsg",o),this.core.eventBus.emit("forwardSend/msg/sendMsg",i),this.core.sendCmd(r,{msg:i}).then(t=>{var{content:r,error:s}=t;if(n=r.msg,s)throw s;var a=ni(Object.assign(Object.assign({},i),r.msg),{account:this.core.account,featureValue:tn.default,statusValue:en.sent});return a.from===a.to&&this.markMsgsAck([a]),this.core.eventBus.emit("session/updateForNewMsg",a),this.core.eventBus.emit("forwardSend/msg/sendMsg",Object.assign(Object.assign({},si(a,a.from,a.fromDeviceId)),{idClient:a.idClient,status:"sent"})),this.core.reporter.report("msgSend",{msgId:a.idServer,clientId:a.idClient,msgTime:a.time,fromAccid:"p2p"===e.scene?this.core.account:"",toAccid:a.to,type:Qt[a.scene],roomId:"",tid:"p2p"===e.scene?"":a.to,result:200,failReason:"",rt:Date.now()-o.time}),a}).catch(t=>{var r=ni(Object.assign(Object.assign(Object.assign({},i),{time:(new Date).getTime()}),n),{account:this.core.account,featureValue:tn.default,statusValue:7101===t.code?en.refused:en.sendFailed});throw t.msg=r,this.core.eventBus.emit("session/updateForNewMsg",r),this.core.eventBus.emit("forwardSend/msg/sendMsg",Object.assign(Object.assign({},si(r,r.from,r.fromDeviceId)),{status:"sendFailed"})),this.core.reporter.report("msgSend",{msgId:r.idServer,clientId:r.idClient,msgTime:r.time,fromAccid:"p2p"===e.scene?this.core.account:"",toAccid:r.to,type:Qt[r.scene],roomId:"",tid:"p2p"===e.scene?"":r.to,result:null==t?void 0:t.code,failReason:(null==t?void 0:t.message)||"",rt:Date.now()-o.time}),t})}resendMsg(e){return Ce(this,void 0,void 0,function*(){Te({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}}},e);var t=e.msg,n=Object.assign(Object.assign({},t),{attach:t.attach?JSON.stringify(t.attach):void 0,setting:{resendFlag:!0}});if(t.from!==this.core.account)throw new Error(`You can only resend messages that you sent: ${t.idClient}`);return this.sendMsg(n)})}forwardMsg(e){return Ce(this,void 0,void 0,function*(){Te({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}},scene:{type:"enum",values:$e(Qt)},to:{type:"string",allowEmpty:!1}},e);var t=e.msg,n=Object.assign(Object.assign({},t),{scene:e.scene,to:e.to,attach:t.attach?JSON.stringify(t.attach):void 0});return this.sendMsg(n)})}sendImageMsg(e){return this.doSendFile(Object.assign(Object.assign({},e),{type:"image"}))}sendFileMsg(e){return this.doSendFile(Object.assign(Object.assign({},e),{type:"file"}))}sendAudioMsg(e){return this.doSendFile(Object.assign(Object.assign({},e),{type:"audio"}))}sendVideoMsg(e){return this.doSendFile(Object.assign(Object.assign({},e),{type:"video"}))}doSendFile(e){return Ce(this,void 0,void 0,function*(){Te({scene:{type:"enum",values:$e(Qt)},to:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e);var t=e.attach;if(!t){if(!this.core.cloudStorage||!this.core.cloudStorage.uploadFile)throw new Error('Service "cloudStorage" does not exist');try{t=yield this.core.cloudStorage.uploadFile(e)}catch(n){throw this.logger.error("sendFile:: upload File error or abort.",n),n}}return this.sendMsg(Object.assign(Object.assign({},e),{attach:JSON.stringify(t),type:e.type}))})}recallMsg(e){return Ce(this,void 0,void 0,function*(){Te({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},scene:{type:"enum",values:$e(Qt)},time:{type:"number"}}},pushInfo:{type:"object",required:!1,rules:hi},ps:{type:"string",allowEmpty:!1,required:!1}},e);var t=e.msg,n=oi({time:t.time,type:{p2p:7,team:8,superTeam:12}[t.scene],to:t.to,from:t.from,ps:e.ps,attach:e.attach,deletedIdClient:t.idClient,deletedIdServer:t.idServer,opeAccount:t.from,env:e.env,pushInfo:e.pushInfo});yield this.core.sendCmd({p2p:"recallMsg",team:"recallMsg",superTeam:"recallSuperTeamMsg"}[t.scene],{recallMsgTag:n});var r=ai([Object.assign({},t,{deletedMsgCreateTime:t.time})]);return this.core.eventBus.emit("session/updateForDeletedMsg",r),this.core.eventBus.emit("forwardSend/msg/recallMsg",n),t})}deleteSelfMsgs(e){return Ce(this,void 0,void 0,function*(){Te({msgs:{type:"array",rules:{scene:{type:"enum",values:["p2p","team"]},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},time:{type:"number",allowEmpty:!1}}},ext:{type:"string",allowEmpty:!1,required:!1}},e);var t=e.msgs.map(t=>({scene:"p2p"===t.scene?1:2,from:t.from,to:t.to,idServer:t.idServer,idClient:t.idClient,deletedMsgCreateTime:t.time,ext:e.ext})),n=yield this.core.sendCmd("deleteSelfMsgs",{deletedMsgs:t}),r=ai(t.map(e=>{var t;return Object.assign({},e,{time:null===(t=null==n?void 0:n.content)||void 0===t?void 0:t.timetag})}));return this.core.eventBus.emit("session/updateForDeletedMsg",r),this.core.eventBus.emit("forwardSend/msg/deleteSelfMsgs",t.map(e=>{var t;return Object.assign(Object.assign({},e),{time:null===(t=null==n?void 0:n.content)||void 0===t?void 0:t.timetag})})),r})}sendMsgReceipt(e){var t,n;return Ce(this,void 0,void 0,function*(){Te({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},target:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e);var r=e.msg;if("p2p"===r.scene&&"in"===r.flow){var i={to:r.target,idClient:r.idClient,time:r.time},o=yield this.core.sendCmd("sendMsgReceipt",{msgReceiptTag:i}),s=parseInt(null===(n=null===(t=o.content)||void 0===t?void 0:t.msgReceiptTag)||void 0===n?void 0:n.time);return Object.assign(Object.assign({},i),{time:s?Math.min(s,i.time):i.time})}this.logger.warn(`Msg scene: ${r.scene}, flow: ${r.flow} is not allowed to send msg receipt`)})}sendTeamMsgReceipt(e){return Ce(this,void 0,void 0,function*(){Te({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}},max:50}},e);var t=e.teamMsgReceipts;this.core.sendCmd("sendTeamMsgReceipt",{teamMsgReceipts:t})})}getTeamMsgReads(e){var t;return Ce(this,void 0,void 0,function*(){Te({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e);var n=e.teamMsgReceipts,r=yield this.core.sendCmd("getTeamMsgReads",{teamMsgReceipts:n}),i=null===(t=r.content)||void 0===t?void 0:t.teamMsgReceipts;return i?i.map(e=>Object.assign(Object.assign({},e),{read:parseInt(e.read),unread:parseInt(e.unread)})):[]})}getTeamMsgReadAccounts(e){return Ce(this,void 0,void 0,function*(){Te({teamMsgReceipt:{type:"object",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e);var t=e.teamMsgReceipt;return(yield this.core.sendCmd("getTeamMsgReadAccounts",{teamMsgReceiptTag:t})).content})}markMsgsAck(e){if(e&&e.length>0){var t=[],n=[];e.forEach(e=>{"p2p"===e.scene&&"in"===e.flow?t.push(e):"team"===e.scene&&"in"===e.flow&&n.push(e)}),t.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:t.map(e=>e.idServer)}),n.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:n.map(e=>e.idServer)})}}onMsgHandler(e){var t;if(e.error)this.logger.error("msgHandler::recvError",e.error);else{var n=Ke(e,e.content.msg,"idServer"),r=ei(n,this.core.account),i=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:r}),o=ni(n,i?{account:this.core.account,sessionAck:i.ack,msgReceiptTime:i.msgReceiptTime}:{account:this.core.account});this.logger.getDebugMode()?this.logger.debug("msgHandler::recvMsg",o.idClient,o.idServer,o):this.logger.log("msgHandler::recvMsg",o.idClient,o.idServer),this.markMsgsAck([o]),this.core.eventBus.emit("session/updateForNewMsg",o),"superTeam"===o.scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:o.time}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:o.time}),this.core.emit("msg",o),"notification"===o.type?this.core.eventBus.emit("team/onNotification",o):"out"!==o.flow&&this.doMsgReceiveReport(o,e),"notification"!==o.type&&this.core.user.checkUserUpdate(o)}}doMsgReceiveReport(e,t){if(e.from!==this.core.account){var n="p2p"===e.scene,r=Ve(e,"__clientExt.statistics.apiCallingTime")||0,i=Ve(e,"__clientExt.statistics.sendTime")||0,o=Ve(e,"__clientExt.statistics.attachUploadDuration")||0,s=this.core.timeOrigin.getNTPTime(),a=e.time,c=this.core.timeOrigin.checkNodeReliable(t.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(t.__receiveTimeNode):s;this.core.reporter.report("msgReceive",{msgId:e.idServer,clientId:e.idClient,serverTime:a,receiveTime:c,fromAccid:n?e.from:"",toAccid:e.to,type:Qt[e.scene],tid:n?"":e.to,apiCallingTime:r,sendTime:i,attachUploadDuration:o,callbackTime:s,preHandleTime:s,result:200,failReason:"",rt:s-a})}}nimOnTeamMsgsHandler(e){e.content.datas.forEach(t=>{this.onMsgHandler(Object.assign({},e,{content:{msg:t}}))})}syncRoamingMsgsHandler(e){var t,n,r=e.content.msgs||[];if(0!==r.length){var i=ei(r[0],this.core.account),o=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:i}),s=(r=ri(r,o?{account:this.core.account,featureValue:tn.roam,sessionAck:o.ack,msgReceiptTime:o.msgReceiptTime}:{account:this.core.account,featureValue:tn.roam}))[0].time,a={timetag:s,sessionId:i,msgs:ci(r)};"function"!=typeof(null===(n=this.core.sync)||void 0===n?void 0:n.getSyncDoneFlag)||this.core.sync.getSyncDoneFlag()||this.core.eventBus.emit("session/syncMsgs",a),this.core.emit("syncRoamingMsgs",a),"superTeam"===r[0].scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:s}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:s})}}syncOfflineMsgsHandler(e){var t=e.content.msgs||[];if(0!==t.length){var n={},r=[];t.forEach(e=>{var t=ei(e,this.core.account),i=this.core.session.getSessionWithUncomplete({id:t}),o=ni(e,i?{account:this.core.account,featureValue:tn.leave,sessionAck:i.ack,msgReceiptTime:i.msgReceiptTime}:{account:this.core.account,featureValue:tn.leave});r.push(o),n[o.sessionId]?n[o.sessionId].push(o):n[o.sessionId]=[o]}),this.markMsgsAck(r);var i=0;Object.keys(n).forEach(e=>{var t=n[e].sort((e,t)=>t.time-e.time);(t=ii(t))[0].time>i&&(i=t[0].time);var r={timetag:t[0].time,sessionId:e,msgs:t};this.core.eventBus.emit("session/syncMsgs",r),this.core.emit("syncOfflineMsgs",r)}),this.core.eventBus.emit("sync/updateTimetag",{offlineMsgs:i})}}syncDeleteSelfMsgsHandler(e){var t,n=null===(t=e.content)||void 0===t?void 0:t.deletedMsgs;n&&n.length>0||this.logger.warn("syncDeleteSelfMsgs:: no msgs");var r=n[n.length-1].time;this.core.eventBus.emit("sync/updateTimetag",{deleteSelfMsgs:r})}onDeleteSelfMsgHandler(e){var t=ai([e.content.deletedMsg]);this.core.eventBus.emit("session/updateForDeletedMsg",t),this.core.emit("deleteSelfMsgs",t)}onDeleteSelfMsgsHandler(e){var t=ai(e.content.deletedMsgs);this.core.eventBus.emit("session/updateForDeletedMsg",t),this.core.emit("deleteSelfMsgs",t)}onBroadcastMsgHandler(e){var t=e.content.msg,n=this.service.processBroadcastMsg([t]);this.core.emit("broadcastMsgs",n)}syncBroadcastMsgHandler(e){var t=e.content.msgs,n=this.service.processBroadcastMsg(t);this.core.emit("broadcastMsgs",n)}},"msg"),yt.registerService(class extends On{constructor(e){super("user",e),this.userInfoMap=new Map,this.myInfo=Fr({}),Gt({cmdMap:Wr,cmdConfig:Yr})}setBlack(e){return Te({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),this.core.sendCmd("setBlack",e).then(()=>{this.core.eventBus.emit("forwardSend/user/updateBlackList",e.account,e.isAdd)})}setMute(e){return Ce(this,void 0,void 0,function*(){Te({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),yield this.core.sendCmd("setMute",e).then(()=>{}),this.core.eventBus.emit("forwardSend/user/setMute",e.account,e.isAdd)})}getRelations(){return this.core.sendCmd("syncRelations",{timetag:0})}getBlackList(){return Ce(this,void 0,void 0,function*(){return(yield this.core.sendCmd("syncRelations",{timetag:0})).blackList||[]})}getMuteList(){return Ce(this,void 0,void 0,function*(){return(yield this.core.sendCmd("syncRelations",{timetag:0})).muteList||[]})}updatePushToken(){return Ce(this,void 0,void 0,function*(){this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead")})}updateAppBackground(){return Ce(this,void 0,void 0,function*(){this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead")})}getUsersNameCardFromServer(e){return Te({accounts:{type:"array",max:150,itemType:"string"}},e),this.core.sendCmd("getUsersNameCardFromServer",hr(e,["accounts"])).then(t=>{var{content:n}=t;return this.logger.log("user:: getUsers done",e.accounts),n&&n.users?n.users.map(e=>Fr(e)):[]})}updateMyNameCard(e){if(Te({nick:{type:"string",required:!1},avatar:{type:"string",required:!1},signature:{type:"string",required:!1},gender:{type:"enum",values:$e(yr),required:!1},email:{type:"string",required:!1},birth:{type:"string",required:!1},tel:{type:"string",required:!1},ext:{type:"string",required:!1}},e),0===Object.keys(e).length)return Promise.resolve(this.myInfo);var t=hr(e,["nick","avatar","signature","email","birth","tel","ext"]);return e.gender&&(t.gender=yr[e.gender]),this.core.sendCmd("updateMyNameCard",{user:t}).then(n=>{var{content:r}=n;return r&&r.timetag&&this.core.eventBus.emit("sync/updateTimetag",{myInfo:+r.timetag}),e.gender&&(t.gender=e.gender),this.myInfo=Object.assign({},this.myInfo,t),this.core.eventBus.emit("forwardSend/user/updateUserInfo",t),this.myInfo})}checkUserUpdate(e){var t=e.from;if(t!==this.core.account){var n=this.userInfoMap.get(t);if(n){var r=n.updateTime,i=e.userUpdateTime;!isNaN(r)&&!isNaN(i)&&"number"==typeof r&&"number"==typeof i&&r<i&&this.refreshUserInfo(t)}else this.refreshUserInfo(t)}}refreshUserInfo(e){return Ce(this,void 0,void 0,function*(){var t=yield this.getUsersNameCardFromServer({accounts:[e]});for(var n of t)this.userInfoMap.set(n.account,n),this.core.emit("updateUserInfo",n)})}onUpdateBlackListHandler(e){var{content:t}=e;t.account?this.core.emit("updateBlackList",t):this.logger.warn("onUpdateBlackListHandler: no account")}onUpdateMuteListHandler(e){var{content:t}=e;t.account?this.core.emit("updateMuteList",t):this.logger.warn("onUpdateBlackListHandler: no account")}syncRelationsHandler(e){var{content:t}=e,{list:n,timetag:r}=t,i={blackList:[],muteList:[]};return r&&this.core.eventBus.emit("sync/updateTimetag",{relations:r}),n&&n.length&&n.forEach(e=>{var t,n,r=(n={account:(t=e).account,updateTime:+t.updateTime,createTime:+t.createTime},"1"===t.isMuted&&(n.isMuted=!0),"1"===t.isBlack&&(n.isBlack=!0),n);r.isBlack&&i.blackList.push(r),r.isMuted&&i.muteList.push(r)}),this.core.emit("relations",i),Promise.resolve(i)}syncMyNameCardHandler(e){e.content.user&&(this.myInfo=Fr(e.content.user),this.core.emit("syncMyNameCard",this.myInfo),this.core.eventBus.emit("sync/updateTimetag",{myInfo:e.content.timetag}))}onUpdateMyNameCardHandler(e){var t=e.content.user;t?(Object.assign(this.myInfo,Fr(t)),this.core.emit("updateMyNameCard",this.myInfo)):this.logger.warn("onUpdateMyNameCardHandler no user info")}},"user"),yt.registerService(class extends On{constructor(e,t){super("session",e),this.list=new Map,this.unreadCountFilterFn=e=>!0,this.lastMessageFilterFn=e=>!0,this.initEventListeners(),Gt({cmdMap:Ai,cmdConfig:Ni}),this.stickTopService=new ki(e),this.unreadModule=new Li(e),t&&this.setOptions(t)}setOptions(e){"function"==typeof(null==e?void 0:e.unreadCountFilterFn)&&(this.unreadCountFilterFn=e.unreadCountFilterFn),"function"==typeof(null==e?void 0:e.lastMessageFilterFn)&&(this.lastMessageFilterFn=e.lastMessageFilterFn)}reset(){this.list.forEach(e=>{e.unreadMsgs=[]}),this.list.clear()}initEventListeners(){this.core.eventBus.on("session/syncMsgs",this.onSyncMsgs.bind(this)),this.core.eventBus.on("session/updateForNewMsg",this.updateSessionWithMsg.bind(this)),this.core.eventBus.on("session/updateForModifyMsg",this.updateSessionByModifyMsg.bind(this)),this.core.eventBus.on("session/updateForClearMsg",(e,t=!0)=>{e&&e.length>0&&e.forEach(e=>{this.updateSession({id:e.sessionId,lastMsg:null,unread:0,unreadMsgs:[]},t)})}),this.core.eventBus.on("session/updateForDeletedMsg",this.updateSessionForDeletedMsg.bind(this))}createSession(e,t){try{var{scene:n,accid:r}=Fe(e);return{id:e,scene:n,to:r,lastMsg:t,updateTime:t?t.time:0,unread:0,unreadMsgs:[],ack:0}}catch(i){throw this.logger.error(`Failed to create session with ${e}`,i),new Error(`Failed to create session with ${e}`)}}getSession(e){Te({id:{type:"string",allowEmpty:!1}},e);var t=this.list.get(e.id);if(this.isSessionComplete(t))return t}getSessionWithUncomplete(e){return this.list.get(e.id)}getAllSessions(){var e=[];for(var[t,n]of this.list)this.isSessionComplete(n)&&e.push(n);return e}getSessions(e){Te({limit:{type:"number",required:!1},lastSessionId:{type:"string",allowEmpty:!1,required:!1},desc:{type:"boolean",required:!1}},e);var t=[],{limit:n=100,desc:r=!0}=e,{lastSessionId:i}=e,o=0;if(r){for(var[s,a]of this.list){if(i===s)break;this.isSessionComplete(a)&&t.push(a)}return t.slice(-n).reverse()}for(var[c,l]of this.list)if(i)c===i&&(i=void 0);else if(this.isSessionComplete(l)){if(++o>n)break;t.push(l)}return t}resetSessionUnreadCount(e){var t;return Ce(this,void 0,void 0,function*(){Te({id:{type:"string",allowEmpty:!1}},e),Te({id:{type:"string",allowEmpty:!1}},e);var n=e.id,r=this.list.get(n);if(!r)throw this.logger.warn("resetSessionUnreadCount: can not find session "+n),new Error("Session::canSessionResetUnreadCount: can not find session "+n);var i=!1;try{i=this.unreadModule.canSessionResetUnreadCount(r)}catch(l){this.logger.warn(l)}if(!1!==i){var{accid:o,scene:s}=Fe(n),a={to:o,timetag:(null===(t=null==r?void 0:r.lastMsg)||void 0===t?void 0:t.time)||r.updateTime||0},c="markSuperTeamSessionAck";return"superTeam"!==s&&(a.scene="p2p"===s?0:1,c="markSessionAck"),this.core.sendCmd(c,a).then(()=>{var e=this.storeUnreadByAck(n,a.timetag);e&&this.core.emit("updateSession",e)})}})}resetMultiSessionUnreadCount(e){return Ce(this,void 0,void 0,function*(){Te({ids:{type:"array",itemType:"string",min:1}},e);var t=e.ids.map(e=>this.list.get(e)).filter((t,n)=>!!t||(this.logger.warn("Session::canSessionResetUnreadCount: can not find session "+e.ids[n]),!1)),{superTeam:n,p2pOrTeam:r}=this.unreadModule.filterSessionForResetUnreadCount(t),i=xi(n.params,50),o=xi(r.params,50);for(var s of i)yield this.core.sendCmd(n.cmd,{datas:s}),s.forEach(e=>{var t=this.storeUnreadByAck(e.sessionId,e.timetag);t&&this.core.emit("updateSession",t)});for(var a of o)yield this.core.sendCmd(r.cmd,{datas:a}),a.forEach(e=>{var t=this.storeUnreadByAck(e.sessionId,e.timetag);t&&this.core.emit("updateSession",t)})})}resetAllSessionsUnreadCount(){var e=[];return this.list.forEach(t=>{e.push(t.id)}),0===e.length?Promise.resolve():this.resetMultiSessionUnreadCount({ids:e})}deleteSession(e){return Ce(this,void 0,void 0,function*(){Te({id:{type:"string",allowEmpty:!1},isSyncToServer:{type:"boolean",required:!1}},e),this.list.delete(e.id),this.core.msgLog&&e.isSyncToServer&&(yield this.core.msgLog.deleteRoamingMsgs({ids:[e.id]}))})}deleteAllSessionsFromLocal(){this.list.clear()}addStickTopSession(e){return Ce(this,void 0,void 0,function*(){var t=yield this.stickTopService.addStickTopSession(e);return this.list.set(t.id,t),t})}deleteStickTopSession(e){return Ce(this,void 0,void 0,function*(){var t=yield this.stickTopService.deleteStickTopSession(e);return this.list.set(t.id,t),t})}updateStickTopSession(e){return Ce(this,void 0,void 0,function*(){var t=yield this.stickTopService.updateStickTopSession(e);return this.list.set(t.id,t),t})}nimMultiSyncAddStickTopSessionHandler(e){var t=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(t.id,t),this.core.emit("updateSession",t)}nimMultiSyncDeleteStickTopSessionHandler(e){var t=this.stickTopService.stickTopSessionHandler({id:e.content.data.id,updateTime:e.content.timetag,ext:""},!1);this.list.set(t.id,t),this.core.emit("updateSession",t)}nimMultiSyncUpdateStickTopSessionHandler(e){var t=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(t.id,t),this.core.emit("updateSession",t)}nimSyncStickTopSessionsHandler(e){if(this.core.eventBus.emit("sync/updateTimetag",{stickTopSessions:e.content.timetag}),e.content.isThereAnyChange){var t=e.content.datas,n=[];this.list.forEach(e=>{var t;e&&(null===(t=null==e?void 0:e.stickTopInfo)||void 0===t?void 0:t.isStickOnTop)&&n.push(e)}),n.forEach(e=>{var n=e.id;if(!t.find(e=>{var{scene:t,accid:r}=Fe(e.id,"|");return`${t}-${r}`===n})){var r={},{scene:i,accid:o}=Fe(n,"-");r.id=`${i}|${o}`,r.ext="",r.isTop=!1,t.push(r)}}),t.forEach(e=>{var t;!1===e.isTop?(delete e.isTop,t=this.stickTopService.stickTopSessionHandler(e,!1)):t=this.stickTopService.stickTopSessionHandler(e),this.list.set(t.id,t)})}}updateSessionWithMsg(e){var t,n,r=!0,i=!0,o="boolean"!=typeof(null===(t=e.pushInfo)||void 0===t?void 0:t.needPushBadge)||(null===(n=e.pushInfo)||void 0===n?void 0:n.needPushBadge);try{r=!!this.unreadCountFilterFn(e)}catch(l){this.logger.error("session:updateSessionWithMsg, unreadCountFilterFn error",l)}try{i=!!this.lastMessageFilterFn(e)}catch(l){this.logger.error("session:updateSessionWithMsg, lastMessageFilterFn error",l)}var s=this.list.get(e.sessionId)||this.createSession(e.sessionId),a=!1;if(this.logger.log("session:updateSessionWithMsg, pending ",e.sessionId,e.idClient,e.idServer,i,r),i&&(!s.lastMsg||s.lastMsg.time<e.time||e.status===en[en.sending]||s.lastMsg.status===en[en.sending])&&(s.lastMsg=e,s.updateTime=e.time,a=!0),r&&o&&e.status===en[en.unread]&&e.time>(s.ack||0)){s.unread++;var c=s.unreadMsgs||[];c.unshift(e),c.sort((e,t)=>t.time-e.time),s.unreadMsgs=c,a=!0}a&&(this.logger.log("session:updateSessionWithMsg updating ",s.id,s.unread,s.lastMsg&&s.lastMsg.idClient),this.list.set(s.id,s),this.core.emit("updateSession",s))}updateSessionByModifyMsg(e){var t=this.list.get(e.sessionId)||this.createSession(e.sessionId),n=t.unreadMsgs||[],r=n.findIndex(t=>t.idClient===e.idClient);r>-1&&(n[r]=e),t.unreadMsgs=n,this.list.set(t.id,t);var i=!0;try{i=!!this.lastMessageFilterFn(e)}catch(o){this.logger.error("session:updateSessionByModifyMsg, lastMessageFilterFn error",o)}i&&(t.lastMsg&&t.lastMsg.idClient!==e.idClient||(t.lastMsg=e,t.updateTime=e.time,this.logger.log("session:updateSessionByModifyMsg updating ",t.id,t.unread,t.lastMsg&&t.lastMsg.idClient),this.list.set(t.id,t),this.core.emit("updateSession",t)))}storeUnreadByAck(e,t){var n=this.list.get(e)||this.createSession(e);if(!(n.ack&&t<n.ack)){var r=n.unreadMsgs||[],i=[],o=[],s=0;return n.unreadMsgs=[],r.length>0&&(r.forEach(e=>{o.includes(e.idClient)||e.time>t&&(s++,o.push(e.idClient),i.push(e))}),n.unreadMsgs=i.sort((e,t)=>t.time-e.time)),n.ack=t,n.unread=s,n.lastMsg&&"unread"===n.lastMsg.status&&t>=n.lastMsg.time&&(n.lastMsg.status="read"),this.list.set(e,n),n}this.logger.warn("storeUnreadByAck: not need update ack",e,t,n.ack)}updateSession(e,t=!0){var n=e.id,r=this.list.get(n)||this.createSession(e.id),i=Object.assign(r,e);return this.list.set(n,i),this.logger.log("updateSession: update",t,hr(e,["id","ack","unread"]),i.lastMsg&&i.lastMsg.idClient),t&&this.core.emit("updateSession",i),i}isSessionComplete(e){return!!e&&!!(e.id&&e.scene&&e.to)&&void 0!==e.lastMsg}syncSessionAckHandler(e){var t=e.content.p2p||{},n=e.content.team.m_map||{};this.logger.log("syncSessionAck::",t,n),Object.keys(t).forEach(e=>{this.updateSession({id:"p2p-"+e,ack:t[e]},!1)}),Object.keys(n).forEach(e=>{this.updateSession({id:"team-"+e,ack:n[e]},!1)})}syncSuperTeamSessionAckHandler(e){var t=e.content.superTeam.m_map;this.logger.log("syncSuperTeamSessionAck::",t),Object.keys(t).forEach(e=>{this.updateSession({id:"superTeam-"+e,ack:t[e]},!1)})}syncMarkSessionAckHandler(e){var t=e.content,n=`${0===t.scene?"p2p":1===t.scene?"team":"superTeam"}-${t.to}`,r=this.list.get(n);if(r&&r.ack&&t.timetag<r.ack)this.logger.warn(`syncMarkSessionAckHandler: ${n} do not need update ack`,r.ack,t.timetag);else{var i=this.storeUnreadByAck(n,t.timetag);i&&this.core.emit("updateSession",i)}}syncMarkSuperTeamSessionAckHandler(e){e.content.scene=5,this.syncMarkSessionAckHandler(e)}onSyncDone(){var e=[];this.list.forEach((t,n)=>{e.push(this.storeUnreadByAck(n,t.ack||0))}),this.list.clear(),e.sort((e,t)=>e.updateTime-t.updateTime).forEach(e=>{this.list.set(e.id,e)}),(e=e.filter(e=>this.isSessionComplete(e)).sort((e,t)=>t.updateTime-e.updateTime)).length>0&&this.core.emit("sessions",e)}onSyncMsgs(e){var t=this.list.get(e.sessionId),n=[];try{n=e.msgs.filter(e=>{var t,n,r="boolean"!=typeof(null===(t=e.pushInfo)||void 0===t?void 0:t.needPushBadge)||(null===(n=e.pushInfo)||void 0===n?void 0:n.needPushBadge);return this.unreadCountFilterFn(JSON.parse(JSON.stringify(e)))&&r})}catch(s){this.logger.error("session:onSyncMsgs, unreadCountFilterFn error ",s)}var r,i=[];try{i=e.msgs.filter(e=>this.lastMessageFilterFn(JSON.parse(JSON.stringify(e))))}catch(s){this.logger.error("session:onSyncMsgs, lastMessageFilterFn error ",s)}i&&i.length>0&&(r=i[i.length-1],r=i[0].time>r.time?i[0]:r);var o=r?r.time:0;t||(t=r?this.createSession(e.sessionId,r):this.createSession(e.sessionId)),t.unreadMsgs=t.unreadMsgs?n.concat(t.unreadMsgs).filter(e=>e.status===en[en.unread]):n.filter(e=>e.status===en[en.unread]),t.updateTime&&t.updateTime>=o||(t.updateTime=o),t.lastMsg&&t.lastMsg.time>=o||(t.lastMsg=r),this.list.set(t.id,t)}updateSessionForDeletedMsg(e){var t={};e.forEach(e=>{var n=e.to===this.core.account?e.from:e.to,r=`${e.scene}-${n}`,i=this.list.get(r);if(i){var o=i.unreadMsgs.some(t=>t.idClient===e.idClient),s=!0;try{s=!!this.unreadCountFilterFn(e)}catch(l){this.logger.error("session:updateSessionForDeletedMsg, unreadCountFilterFn error",l)}var a=i.ack||0;if(s&&o&&a<e.time&&e.from!==this.core.account&&i.unread>0&&(i.unread=i.unread-1,i.unreadMsgs&&i.unreadMsgs.length>0)){var c=function(e,t){e=e||[],t=t||{};for(var n=0;n<e.length;n++){var r=!0;for(var i in t)if(e[n][i]!==t[i]){r=!1;break}if(r)return n}return-1}(i.unreadMsgs,{idClient:e.idClient});c>=0&&i.unreadMsgs.splice(c,1)}i.lastMsg&&i.lastMsg.idClient===e.idClient&&(i.lastMsg=null),t[i.id]=!0}}),Object.keys(t).forEach(e=>{var t=this.list.get(e);t&&this.core.emit("updateSession",t)})}multiSyncMsgReceiptHandler(e){var t,n=null===(t=e.content)||void 0===t?void 0:t.msgReceiptTag;if(n){this.updateSessionMsgReceiptTime([n],!0),n.msgReceiptTime=n.time,n.sessionId=`p2p-${n.from}`;var r=be(n,["time","from"]);this.core.emit("msgReceipts",[r])}}syncMsgReceiptsHandler(e){var t,n=null===(t=e.content)||void 0===t?void 0:t.msgReceipts;n&&this.updateSessionMsgReceiptTime(n,!1)}updateSessionMsgReceiptTime(e,t=!0){e&&e.length>0&&e.forEach(e=>{var n=this.list.get(`p2p-${e.from}`);n||(n=this.createSession(`p2p-${e.from}`));var r=parseInt(e.time);n.msgReceiptTime&&n.msgReceiptTime>=r||(n.msgReceiptTime=r,n.lastMsg&&"sent"===n.lastMsg.status&&r>=n.lastMsg.time&&(n.lastMsg.status="receipt"),this.logger.log(`session: update session ${n.id} msgReceiptTime: ${n.msgReceiptTime}`),this.list.set(n.id,n),t&&this.core.emit("updateSession",n))})}},"session"),yt.registerService(class extends On{constructor(e){super("team",e),this.myTeamMembersMap=new Map,this.service=new Vi(e),this.setListeners(),Gt({cmdMap:jr,cmdConfig:Hr})}setListeners(){this.core.eventBus.on("forwardReceive/team/updateMyMemberInfo",e=>{this.emitMemberUpdate(e)}),this.core.eventBus.on("team/onNotification",e=>this.notificationHandler(e))}reset(){this.myTeamMembersMap.clear()}mergeMyTeamMembers(e){e.forEach(e=>{var t=e.teamId,n=this.myTeamMembersMap.get(t),r=Object.assign({},n,e);this.myTeamMembersMap.set(t,r)})}getTeamInfo(e){return Ce(this,void 0,void 0,function*(){return Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),kr((yield this.core.sendCmd("getTeamInfo",{teamId:e.teamId})).content.team)})}getTeams(){return Ce(this,void 0,void 0,function*(){return Lr((yield this.core.sendCmd("getTeams",{timetag:0})).content.teams)})}getTeamsById(e){return Ce(this,void 0,void 0,function*(){Te({teamIds:{type:"array",itemType:"string"}},e);var t=yield this.core.sendCmd("getTeamsById",{teamIds:e.teamIds});return{teams:Lr(t.content.teams),tids:t.content.tids}})}createTeam(e){return Ce(this,void 0,void 0,function*(){Te({type:{type:"enum",values:["advanced","normal"]},name:{type:"string",allowEmpty:!1},level:{type:"number",required:!1},accounts:{type:"array",itemType:"string",required:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e);var t=xr(e),n=kr((yield this.core.sendCmd("createTeam",{team:t,accounts:e.accounts||[],ps:e.ps||""})).content.team);return this.core.eventBus.emit("forwardSend/team/created",n),n})}dismissTeam(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),yield this.core.sendCmd("dismissTeam",{teamId:e.teamId})})}leaveTeam(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),yield this.core.sendCmd("leaveTeam",{teamId:e.teamId})})}transferTeam(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),yield this.core.sendCmd("transferTeam",e)})}updateTeamInfo(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e);var t=xr(e);return yield this.core.sendCmd("updateTeamInfo",{team:t}),kr(t)})}getTeamMembers(e){var t;return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",required:!1}},e);var n=yield this.core.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0}),r=Ur(null===(t=n.content)||void 0===t?void 0:t.teamMembers);return e.accounts&&e.accounts.length>0?r.filter(t=>{var n;return null===(n=e.accounts)||void 0===n?void 0:n.includes(t.account)}):r})}getMutedTeamMembers(e){return Ce(this,void 0,void 0,function*(){return Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),Ur((yield this.core.sendCmd("getMutedTeamMembers",{teamId:e.teamId})).content.teamMembers)})}addTeamMembers(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),yield this.core.sendCmd("addTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""})})}removeTeamMembers(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),yield this.core.sendCmd("removeTeamMembers",{teamId:e.teamId,accounts:e.accounts})})}applyTeam(e){return Ce(this,void 0,void 0,function*(){return Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),kr((yield this.core.sendCmd("applyTeam",{teamId:e.teamId,ps:e.ps||""})).content.team)})}addTeamManagers(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),yield this.core.sendCmd("addTeamManagers",e)})}removeTeamManagers(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),yield this.core.sendCmd("removeTeamManagers",e)})}updateMyMemberInfo(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e);var t=Vr({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext});yield this.core.sendCmd("updateMyMemberInfo",{teamMember:t});var n=Dr(Object.assign({updateTime:(new Date).getTime(),account:this.core.account},t)),r=this.emitMemberUpdate(n);return this.core.eventBus.emit("forwardSend/team/updateMyMemberInfo",r),n})}emitMemberUpdate(e){e=Dr(e),this.mergeMyTeamMembers([e]),this.core.emit("updateTeamMember",e);var t=Di(this.myTeamMembersMap.get(e.teamId));return this.core.emit("myTeamMembers",[t]),t}updateMemberNick(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},e);var t=Vr({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account});return yield this.core.sendCmd("updateNickInTeam",{teamMember:t}),Dr(Object.assign({updateTime:(new Date).getTime()},t))})}muteTeamMember(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},mute:{type:"boolean"}},e),yield this.core.sendCmd("muteTeamMember",{teamId:e.teamId,account:e.account,mute:e.mute?1:0})})}getTeamMemberInvitorAccid(e){var t;return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:200}},e);var n={teamId:e.teamId};e.accounts&&e.accounts.length>0&&(n.accounts=e.accounts);var r=yield this.core.sendCmd("getTeamMemberInvitorAccid",n);return(null===(t=r.content)||void 0===t?void 0:t.accountsMap)||{}})}muteTeam(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),yield this.core.sendCmd("muteTeam",{teamId:e.teamId,mute:e.mute?1:0})})}passTeamApply(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e);try{yield this.core.sendCmd("passTeamApply",e),this.core.eventBus.emit("forwardSend/team/passTeamApply",e)}catch(n){var t=n;throw this.core.eventBus.emit("forwardSend/team/passTeamApply",e,null==t?void 0:t.code),n}})}rejectTeamApply(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e);try{yield this.core.sendCmd("rejectTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""}),this.core.eventBus.emit("forwardSend/team/rejectTeamApply",e)}catch(n){var t=n;throw this.core.eventBus.emit("forwardSend/team/rejectTeamApply",e,null==t?void 0:t.code),n}})}acceptTeamInvite(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e);try{yield this.core.sendCmd("acceptTeamInvite",e),this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",e)}catch(n){var t=n;throw this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",e,null==t?void 0:t.code),n}})}rejectTeamInvite(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e);try{yield this.core.sendCmd("rejectTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""}),this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",e)}catch(n){var t=n;throw this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",e,null==t?void 0:t.code),n}})}notifyTeamMsgReceiptsHandler(e){var t,n=null===(t=e.content)||void 0===t?void 0:t.teamMsgReceipts;n&&n.length>0&&(this.core.emit("teamMsgReceipts",n),this.core.emit("msgReceipts",n))}syncTeamsHandler(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{teams:parseInt(t.timetag)});var n=null==t?void 0:t.teams;if(n&&n.length){var r=Lr(n);this.core.emit("teams",r)}}syncCreateTeamHandler(e){var t=e.content,n=kr(null==t?void 0:t.team),r=$r(n,n.owner,"owner");this.core.emit("createTeam",n,r)}syncUpdateTeamMemberHandler(e){var t=e.content,n=Dr(null==t?void 0:t.teamMember);n.updateTime||(n.updateTime=(new Date).getTime()),this.mergeMyTeamMembers([n]),this.core.emit("updateTeamMember",n);var r=Di(this.myTeamMembersMap.get(n.teamId));this.core.emit("myTeamMembers",[r])}syncMyTeamMembersHandler(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{myTeamMembers:parseInt(t.timetag)});var n=null==t?void 0:t.teamMembers.map(e=>Dr(e));this.mergeMyTeamMembers(n),this.core.emit("myTeamMembers",Di(n))}notificationHandler(e){var{attach:t,scene:n,from:r,to:i,time:o,idServer:s,idClient:a}=e,{team:c,account:l,accounts:d,type:u}=t;if("team"===n)switch(this.logger.getDebugMode()?this.logger.debug("team::recvNotification",s,a,t):this.logger.log("team::recvNotification",s,a,i,u,l,d),u){case"updateTeam":c.updateTime=o,this.core.emit("updateTeam",c);break;case"addTeamMembers":this.service.notifyAddTeamMembers(c,d);break;case"acceptTeamInvite":this.service.notifyAddTeamMembers(c,[r]);break;case"passTeamApply":this.service.notifyAddTeamMembers(c,[l]);break;case"addTeamManagers":this.service.notifyUpdateTeamManagers(i,d,!0,o);break;case"removeTeamManagers":this.service.notifyUpdateTeamManagers(i,d,!1,o);break;case"removeTeamMembers":this.service.notifyRemoveTeamMembers(c,d);break;case"leaveTeam":this.service.notifyRemoveTeamMembers(c,[r]);break;case"dismissTeam":this.core.emit("dismissTeam",{teamId:i});break;case"transferTeam":this.service.notifyTransferTeam(c,r,l);break;case"updateTeamMemberMute":this.service.notifyUpdateTeamMembersMute(c,[l],t.mute)}}},"team"),yt.registerService(class extends On{constructor(e){super("systemMessage",e),this.sysMsgUnread={total:0,friend:0,msg:0,team:0,superTeam:0},this.core.eventBus.on("logined",()=>{this.initEventListeners()}),Gt({cmdMap:Ui,cmdConfig:Fi})}initEventListeners(){this.core.eventBus.on("systemMessage/passFriendApply",e=>{this.core.emit("updateSystemMessages",[{idServer:e.idServer,from:e.account,state:"pass",type:"friendRequest"}])}),this.core.eventBus.on("systemMessage/rejectFriendApply",e=>{this.core.emit("updateSystemMessages",[{idServer:e.idServer,from:e.account,state:"decline",type:"friendRequest"}])})}doMarkSysMsgAck(e){var t=[],n=[],r=["customSuperTeam"];e.forEach(e=>{e.idServer&&(r.includes(e.type)?n.push(e.idServer):t.push(e.idServer))}),t.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:t}),n.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:n})}sendCustomSysMsg(e){Te({to:{type:"string",allowEmpty:!1},type:{type:"enum",values:["customP2p","customTeam","customSuperTeam"]},attach:{type:"string",allowEmpty:!1},setting:{type:"object",rules:{needSaveOffline:{type:"boolean",required:!1},env:{type:"string",allowEmpty:!1,required:!1}},required:!1},pushInfo:{type:"object",required:!1,rules:hi}},e);var t="customSuperTeam"===e.type?"sendSuperTeamCustomSysMsg":"sendCustomSysMsg";return this.core.sendCmd(t,{sysMsg:Ei(e)}).then(()=>{this.logger.log("sendCustomSysMsg success")}).catch(e=>{throw this.logger.error("sendCustomSysMsg failed",e.message),e})}onSysMsgHandler(e){var t,n=null===(t=e.content)||void 0===t?void 0:t.sysMsg;if(n){var r=Si(n=Ke(e,e.content.sysMsg,"idServer"),this.logger,ui.default);this.core.emit("sysMsg",r),this.doMarkSysMsgAck([r])}else this.logger.warn("onSysMsg no content.sysMsg")}syncOfflineSysMsgsHandler(e){if(e.content.sysMsgs&&e.content.sysMsgs.length>0){var t=e.content.sysMsgs.map(e=>Si(e,this.logger,ui.leave));this.core.emit("syncSysMsgs",t),this.doMarkSysMsgAck(t)}}onRecallMsgHandler(e){var t,n=null===(t=e.content)||void 0===t?void 0:t.sysMsg;if(n){var r=ai([n=Ke(e,e.content.sysMsg,"idServer")],Mi(+n.type));this.core.eventBus.emit("session/updateForDeletedMsg",r);var i=Si(n,this.logger,ui.default);this.core.emit("sysMsg",i),this.doMarkSysMsgAck([i])}else this.logger.warn("onSysMsg no content.sysMsg")}syncRecallMsgOfflineAndRoamingHandler(e){var{timetag:t,type:n,sysMsgs:r}=e.content,i=parseInt(n),o=1===i?ui.leave:ui.roam,s=r.map(e=>Si(e,this.logger,o));1===i&&this.doMarkSysMsgAck(s),this.core.eventBus.emit("sync/updateTimetag",{recallMsg:t}),this.core.emit("syncSysMsgs",s)}},"systemMessage"),yt.registerService(class extends On{constructor(e){super("friend",e),Gt({cmdMap:Gi,cmdConfig:zi})}getFriends(){var e;return Ce(this,void 0,void 0,function*(){var t=yield this.core.sendCmd("getFriends",{timetag:0}),n=(null===(e=t.content)||void 0===e?void 0:e.friends)||[];return n.map(e=>ji(e))})}addFriend(e){return Ce(this,void 0,void 0,function*(){Te({account:{type:"string",allowEmpty:!1},ps:{type:"string",allowEmpty:!1,required:!1}},e),yield this.core.sendCmd("friendReuqest",{account:e.account,type:1,ps:e.ps||""});var t=(new Date).getTime();return this.core.eventBus.emit("forwardSend/friend/addFriend",e.account),{account:e.account,createTime:t,updateTime:t,valid:!0,source:0,passRelationShip:1,relationShip:1,bitsExtension:0}})}applyFriend(e){return Ce(this,void 0,void 0,function*(){Te({account:{type:"string",allowEmpty:!1}},e),yield this.core.sendCmd("friendReuqest",{account:e.account,type:2,ps:e.ps||""})})}passFriendApply(e){return Ce(this,void 0,void 0,function*(){Te({account:{type:"string",allowEmpty:!1}},e);try{yield this.core.sendCmd("friendReuqest",{account:e.account,type:3,ps:e.ps||""}).then(t=>(this.core.eventBus.emit("systemMessage/passFriendApply",e),t)),this.core.eventBus.emit("forwardSend/friend/passFriendApply",e.account)}catch(t){throw this.core.eventBus.emit("forwardSend/friend/passFriendApply",e.account,t),t}})}rejectFriendApply(e){return Ce(this,void 0,void 0,function*(){Te({account:{type:"string",allowEmpty:!1}},e);try{yield this.core.sendCmd("friendReuqest",{account:e.account,type:4,ps:e.ps||""}).then(t=>(this.core.eventBus.emit("systemMessage/rejectFriendApply",e),t)),this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",e.account,e.ps)}catch(t){throw this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",e.account,e.ps,t),t}})}deleteFriend(e){return Ce(this,void 0,void 0,function*(){Te({account:{type:"string",allowEmpty:!1},delAlias:{type:"boolean"}},e),yield this.core.sendCmd("deleteFriend",{account:e.account,delFriendParams:{delAlias:!0===e.delAlias?1:0}}),this.core.eventBus.emit("forwardSend/friend/deleteFriend",e.account)})}updateFriend(e){return Ce(this,void 0,void 0,function*(){Te({account:{type:"string",allowEmpty:!1},alias:{type:"string"},ext:{type:"string",required:!1}},e),yield this.core.sendCmd("updateFriend",{updateFriendTag:e}),this.core.eventBus.emit("forwardSend/friend/updateFriend",e)})}syncFriendRequestHandler(e){var t=function(e){var t=Object.assign({},e);try{t.ps=t.ps&&JSON.parse(t.ps)}catch(r){}if(t.type=qi[t.type],"addFriend"===t.type||"passFriendApply"===t.type){var n=(new Date).getTime();t.friend={account:e.account,alias:"",createTime:n,ext:"",updateTime:n,valid:!0}}return t}(e.content);this.core.emit("syncFriend",t)}syncDeleteFriendHandler(e){var t=e.content.account;this.logger.log(`friend::emit syncFriendAction: deleteFriend ${t}`),this.core.emit("syncFriend",{type:"deleteFriend",account:t})}syncUpdateFriendHandler(e){var t=ji(e.content.friend);this.logger.log("friend::emit syncFriendAction: updateFriend, ",null==t?void 0:t.account),this.core.emit("syncFriend",{type:"updateFriend",friend:t})}syncFriendsHandler(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{friends:parseInt(t.timetag)});var n=null==t?void 0:t.friends;if(n&&n.length){var r=n.map(e=>ji(e));this.core.emit("friends",r)}}syncFriendUsersHandler(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{friendUsers:parseInt(t.timetag)});var n=null==t?void 0:t.users;if(n&&n.length){var r=n.map(e=>Fr(e));this.core.emit("users",r)}}},"friend"),yt.registerService(class extends On{constructor(e){super("event",e),Gt({cmdMap:Xi,cmdConfig:eo})}publishEvent(e){var t;return Ce(this,void 0,void 0,function*(){Te({type:{type:"number"},value:{type:"number"},ext:{type:"string",required:!1},validTime:{type:"number",min:60,max:2592e3,required:!1},broadcastType:{type:"number",required:!1},sync:{type:"boolean",required:!1}},e);var n=Object.assign(Object.assign({validTime:e.validTime||604800,broadcastType:e.broadcastType||2},e),{idClient:Ue(),sync:!0===e.sync?1:0}),r=yield this.core.sendCmd("publishEvent",{msgEvent:n});return Yi((null===(t=r.content)||void 0===t?void 0:t.msgEvent)||{})})}subscribeEvent(e){var t;return Ce(this,void 0,void 0,function*(){Te({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100},subscribeTime:{type:"number",min:60,max:2592e3,required:!1}},e);var n=Object.assign(Object.assign({subscribeTime:2592e3},e),{sync:!0===e.sync?1:0}),r=yield this.core.sendCmd("subscribeEvent",{msgEventSubscribe:n,accounts:e.accounts});return{failedAccounts:(null===(t=r.content)||void 0===t?void 0:t.accounts)||[]}})}unSubscribeEvents(e){var t;return Ce(this,void 0,void 0,function*(){Te({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e);var n,r={type:e.type};if(e.accounts&&e.accounts.length>0){var i=yield this.core.sendCmd("unSubscribeEventsByAccounts",{msgEventSubscribe:r,accounts:e.accounts});n=(null===(t=i.content)||void 0===t?void 0:t.accounts)||[]}else yield this.core.sendCmd("unSubscribeEventsByType",{msgEventSubscribe:r}),n=[];return{failedAccounts:n}})}querySubscribeEvents(e){var t;return Ce(this,void 0,void 0,function*(){var n;return Te({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),n=e.accounts&&e.accounts.length>0?yield this.core.sendCmd("querySubscribeEventsByAccounts",{msgEventSubscribe:{type:e.type},accounts:e.accounts}):yield this.core.sendCmd("querySubscribeEventsByType",{msgEventSubscribe:{type:e.type}}),Ki(null===(t=n.content)||void 0===t?void 0:t.msgEventSubscribes)})}pushEventHandler(e){var t,n=(null===(t=e.content)||void 0===t?void 0:t.msgEvent)||{};this.core.emit("pushEvents",[Yi(n)])}pushEventsHandler(e){var t,n,r=(null===(t=e.content)||void 0===t?void 0:t.msgEvents)||{};this.core.emit("pushEvents",(n=r,Array.isArray(n)&&n.length>0?n.map(e=>Yi(e)):[]))}},"event"),yt.registerService(class extends On{constructor(e){super("msgExtend",e),Gt({cmdMap:to,cmdConfig:io})}getThreadMsgs(e){var t;return Ce(this,void 0,void 0,function*(){Te({scene:{type:"enum",values:$e(Qt)},threadMsgFromAccount:{type:"string",allowEmpty:!1},threadMsgIdServer:{type:"string",allowEmpty:!1},threadMsgTime:{type:"number"},threadMsgToAccount:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},lastMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1}},e);var n,r,i,o=yield this.core.sendCmd("getThreadMsgs",(n=e,r={scene:Qt[n.scene],from:n.threadMsgFromAccount,to:n.threadMsgToAccount,time:n.threadMsgTime,idServer:n.threadMsgIdServer},i={limit:n.limit<100?n.limit:100,beginTime:"number"==typeof n.beginTime?n.beginTime:0,reverse:!0===n.reverse?1:0},n.lastMsgId&&(i.lastMsgId=n.lastMsgId),{msg:r,threadMsgReq:i})),{msgs:s,threadMsg:a}=o.content,{threadMsgsMeta:c}=o.content,l=ei(a,this.core.account),d=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:l});return{msgs:s=ri(s,d?{account:this.core.account,sessionAck:d.ack,msgReceiptTime:d.msgReceiptTime}:{account:this.core.account}),threadMsg:a=ni(a,d?{account:this.core.account,sessionAck:d.ack,msgReceiptTime:d.msgReceiptTime}:{account:this.core.account}),total:parseInt(c.total),timetag:parseInt(c.lastMsgTime)}})}getMsgsByIdServer(e){return Ce(this,void 0,void 0,function*(){return Te({reqMsgs:{type:"array",rules:{scene:{type:"enum",values:$e(Qt)},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},time:{type:"number"}},min:1,max:100}},e),(yield this.core.sendCmd("getMsgsByIdServer",{reqMsgs:e.reqMsgs.map(e=>Object.assign(Object.assign({},e),{scene:Be(Qt,e.scene)}))})).content.msgs.map(e=>{var t,n=ei(e,this.core.account),r=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:n});return ni(e,r?{account:this.core.account,sessionAck:r.ack,msgReceiptTime:r.msgReceiptTime}:{account:this.core.account})})})}},"msgExtend"),yt.registerService(class extends On{constructor(e){super("msgLog",e),this.onV2ClearHistoryMessage=e=>{var t=po(e);this.core.eventBus.emit("session/updateForClearMsg",[t],!0)},Gt({cmdMap:so,cmdConfig:lo}),this.registerListener()}registerListener(){this.core.eventBus.on("forwardReceive/msgLog/clearHistoryMsgsFromServer",this.onV2ClearHistoryMessage)}deleteRoamingMsgs(e){return Ce(this,void 0,void 0,function*(){Te({ids:{type:"array",itemType:"string"}},e);var t=[];try{t=e.ids.map(e=>{var{scene:t,accid:n}=Fe(e);return`${t}|${n}`})}catch(n){throw this.logger.error(`Failed to delete roaming msgs with ${e.ids}`,n),new Error(`Failed to create session with ${e.ids}`)}yield this.core.sendCmd("deleteRoamingMsgs",{ids:t})})}getHistoryMsgs(e){var t,n;return Ce(this,void 0,void 0,function*(){"function"!=typeof(null===(t=this.core.sync)||void 0===t?void 0:t.getSyncDoneFlag)||this.core.sync.getSyncDoneFlag()||this.logger.warn("Please call getHistoryMsgs after syncdone event"),Te({scene:{type:"enum",values:$e(Qt)},to:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},lastMsgId:{type:"string",required:!1,allowEmpty:!1},asc:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},e);var r="p2p"===e.scene?"getHistoryMsgs":"team"===e.scene?"getHistoryTeamMsgs":"getHistorySuperTeamMsgs",i=yield this.core.sendCmd(r,qe({beginTime:0,endTime:0,lastMsgId:0,limit:100,reverse:!1},Object.assign(Object.assign({},e),{msgTypes:e.msgTypes?e.msgTypes.map(e=>Xt[e]):[]}))),{content:o}=i;if(!(o.msgs&&o.msgs.length>0))return[];var s=ei(o.msgs[0],this.core.account),a=null===(n=this.core.session)||void 0===n?void 0:n.getSessionWithUncomplete({id:s}),c=ri(o.msgs,a?{account:this.core.account,sessionAck:a.ack,msgReceiptTime:a.msgReceiptTime}:{account:this.core.account});return!0===e.asc?c.sort((e,t)=>e.time-t.time):c})}clearHistoryMsgsFromServer(e){return Ce(this,void 0,void 0,function*(){Te({scene:{type:"enum",values:["p2p","team"]},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},isSyncSelf:{type:"boolean",required:!1}},e);var t=Object.assign(Object.assign({isDeleteRoam:1},e),{type:"team"===e.scene?2:1,isSyncSelf:!0===e.isSyncSelf?1:0});t[2===t.type?"toTid":"otherAccid"]=e.to;var n=(yield this.core.sendCmd("clearHistoryMsgsFromServer",{clearHistoryMsgsFromServerReqTag:t})).content;return this.core.eventBus.emit("session/updateForClearMsg",[{sessionId:`${e.scene}-${e.to}`}],!0),this.core.eventBus.emit("forwardSend/msgLog/clearHistoryMsgsFromServer",Object.assign(Object.assign({},t),{time:n.timetag})),n})}multiSyncClearServerHistoryMsgsHandler(e){var t=po(e.content.data);this.core.eventBus.emit("session/updateForClearMsg",[t],!0),this.core.emit("clearServerHistoryMsgs",[t])}ftsCloudMsgLogs(e){return Ce(this,void 0,void 0,function*(){return this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogs")})}ftsCloudMsgLogsAggWithSession(e){return Ce(this,void 0,void 0,function*(){return this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogsAggWithSession")})}baseFtsCloudMsgLogs(e,t){return Ce(this,void 0,void 0,function*(){if(Te({keyword:{type:"string",allowEmpty:!1},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",required:!1},msglogsLimit:{type:"number",required:!1},orderRule:{type:"enum",values:$e(Ji),required:!1},p2pSessionList:{type:"array",itemType:"string",required:!1},teamSessionList:{type:"array",itemType:"string",required:!1},senderList:{type:"array",itemType:"string",required:!1},msgTypeList:{type:"array",itemType:"enum",values:$e(Xt),required:!1},msgSubTypeList:{type:"array",itemType:"number",required:!1}},e),e.fromTime&&e.toTime&&e.toTime<e.fromTime)throw new he("Request parameter error: toTime should be greater than fromTime",e,"");var n,r=(n=an(mo,e),Array.isArray(n.msgTypeList)&&(n.msgTypeList=n.msgTypeList.map(e=>Xt[e]).join(",")),["p2pSessionList","teamSessionList","senderList","msgSubTypeList"].forEach(e=>{Array.isArray(n[e])&&(n[e]=n[e].join(","))}),n);return(yield this.core.sendCmd(t,{tag:r})).content.datas.map(e=>{var t,n=ei(e,this.core.account),r=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:n});return ni(e,r?{account:this.core.account,sessionAck:r.ack,msgReceiptTime:r.msgReceiptTime}:{account:this.core.account})})})}syncClearServerHistoryMsgsHandler(e){var t,n=(t=e.content.datas,Array.isArray(t)&&t.length>0?t.map(e=>po(e)):[]);this.core.emit("clearServerHistoryMsgs",n)}},"msgLog"),yt.registerService(class extends On{constructor(e){super("passThrough",e),this.core=e,Gt({cmdMap:fo,cmdConfig:_o})}request(e){return Te({path:{type:"string",allowEmpty:!1}},e),this.core.sendCmd("requestProxy",{requestProxyTag:e}).then(e=>{var{content:t}=e;return t.requestProxyTag})}onRequestProxyHandler(e){var{proxyMsg:t}=e.content;t&&t.time&&(t.time=+t.time),this.core.emit("proxyMsg",t)}},"passThrough"),yt.registerService(Po,"cloudStorage"),yt.registerService(class extends On{constructor(e){super("superTeam",e),this.mySuperTeamMembersMap=new Map,this.service=new Zo(e),Gt({cmdMap:es,cmdConfig:rs}),this.setListeners()}setListeners(){this.core.eventBus.on("forwardReceive/superTeam/updateMyMemberInfo",e=>{this.emitMemberUpdate(e)}),this.core.eventBus.on("team/onNotification",e=>this.notificationHandler(e))}reset(){this.mySuperTeamMembersMap.clear()}mergeMySuperTeamMembers(e){e.forEach(e=>{var t=e.teamId,n=this.mySuperTeamMembersMap.get(t),r=Object.assign({},n,e);this.mySuperTeamMembersMap.set(t,r)})}getSuperTeamInfo(e){return Ce(this,void 0,void 0,function*(){return Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),Wo((yield this.core.sendCmd("getSuperTeamInfo",{teamId:e.teamId})).content.superTeam)})}getSuperTeams(){return Ce(this,void 0,void 0,function*(){return zo((yield this.core.sendCmd("getSuperTeams",{timetag:0})).content.superTeams)})}updateSuperTeamInfo(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e);var t,n,r,i=(t=e,n=Object.assign({},t),r={joinMode:Vo,beInviteMode:Uo,inviteMode:Bo,updateTeamMode:jo,updateExtMode:Go},["avatar","name","intro","announcement","ext"].forEach(e=>{void 0!==n[e]&&(n[e]=n[e].toString())}),Object.keys(r).forEach(e=>{void 0!==n[e]&&(n[e]=r[e][n[e]])}),n);return yield this.core.sendCmd("updateSuperTeamInfo",{superTeam:i}),Wo(i)})}addSuperTeamMembers(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),yield this.core.sendCmd("addSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""})})}removeSuperTeamMembers(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),yield this.core.sendCmd("removeSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts})})}addSuperTeamManagers(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),yield this.core.sendCmd("addSuperTeamManagers",e)})}removeSuperTeamManagers(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),yield this.core.sendCmd("removeSuperTeamManagers",e)})}applySuperTeam(e){return Ce(this,void 0,void 0,function*(){return Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),Wo((yield this.core.sendCmd("applySuperTeam",{teamId:e.teamId,ps:e.ps||""})).content.superTeam)})}transferSuperTeam(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),yield this.core.sendCmd("transferSuperTeam",e)})}muteSuperTeam(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),yield this.core.sendCmd("muteSuperTeam",{teamId:e.teamId,mute:e.mute?1:0})})}muteSuperTeamMembers(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string"},mute:{type:"boolean"}},e),yield this.core.sendCmd("muteSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,mute:e.mute?1:0})})}updateMemberNick(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},e);var t=Ko({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account});return yield this.core.sendCmd("updateSuperTeamMemberNick",{teamMember:t}),Yo(Object.assign({updateTime:(new Date).getTime()},t))})}updateMyMemberInfo(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e);var t=Ko({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext});yield this.core.sendCmd("updateMySuperTeamMemberInfo",{teamMember:t});var n=Yo(Object.assign({updateTime:(new Date).getTime(),account:this.core.account},t)),r=this.emitMemberUpdate(n);return this.core.eventBus.emit("forwardSend/superTeam/updateMyMemberInfo",r),n})}getSuperTeamMembersByAccounts(e){var t;return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:20,min:1}},e);var n=e.accounts.map(t=>`${e.teamId}|${t}`),r=yield this.core.sendCmd("getSuperTeamMembersByAccounts",{memberIds:n});return Jo(null===(t=r.content)||void 0===t?void 0:t.superTeamMembers)})}getSuperTeamMembers(e){var t;return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,max:1e3,required:!1},reverse:{type:"boolean",required:!1}},e);var n=yield this.core.sendCmd("getSuperTeamMembers",Object.assign({joinTime:0,limit:100,reverse:!1},e));return Jo(null===(t=n.content)||void 0===t?void 0:t.superTeamMembers)})}queryMuteMembers(e){return Ce(this,void 0,void 0,function*(){return Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),Jo((yield this.core.sendCmd("queryMuteSuperTeamMembers",Object.assign({limit:100,joinTime:0,reverse:!1},e))).content.superTeamMembers)})}leaveSuperTeam(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),yield this.core.sendCmd("leaveSuperTeam",{teamId:e.teamId})})}passSuperTeamApply(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e);try{yield this.core.sendCmd("passSuperTeamApply",e),this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",e)}catch(n){var t=n;throw this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",e,null==t?void 0:t.code),n}})}rejectSuperTeamApply(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e);try{yield this.core.sendCmd("rejectSuperTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""}),this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",e)}catch(n){var t=n;throw this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",e,null==t?void 0:t.code),n}})}acceptSuperTeamInvite(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e);try{yield this.core.sendCmd("acceptSuperTeamInvite",e),this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",e)}catch(n){var t=n;throw this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",e,null==t?void 0:t.code),n}})}rejectSuperTeamInvite(e){return Ce(this,void 0,void 0,function*(){Te({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e);try{yield this.core.sendCmd("rejectSuperTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""}),this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",e)}catch(n){var t=n;throw this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",e,null==t?void 0:t.code),n}})}emitMemberUpdate(e){e=Yo(e),this.mergeMyTeamMembers([e]),this.core.emit("updateTeamMember",e);var t=Di(this.mySuperTeamMembersMap.get(e.teamId));return this.core.emit("myTeamMembers",[t]),t}mergeMyTeamMembers(e){e.forEach(e=>{var t=e.teamId,n=this.mySuperTeamMembersMap.get(t),r=Object.assign({},n,e);this.mySuperTeamMembersMap.set(t,r)})}syncSuperTeamsHandler(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{superTeams:parseInt(t.timetag)});var n=null==t?void 0:t.teams;if(n&&n.length){var r=zo(n);this.core.emit("superTeams",r)}}syncCreateSuperTeamHandler(e){var t=e.content,n=Wo(null==t?void 0:t.superTeam),r=Xo(n,n.owner,"owner");this.core.emit("createSuperTeam",n,r)}syncUpdateSuperTeamMemberHandler(e){var t=e.content,n=Yo(null==t?void 0:t.teamMember);n.updateTime||(n.updateTime=(new Date).getTime()),this.mergeMySuperTeamMembers([n]),this.core.emit("updateSuperTeamMember",n);var r=Di(this.mySuperTeamMembersMap.get(n.teamId));this.core.emit("mySuperTeamMembers",[r])}syncMySuperTeamMembersHandler(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{mySuperTeamMembers:parseInt(t.timetag)});var n=null==t?void 0:t.teamMembers.map(e=>Yo(e));this.mergeMySuperTeamMembers(n),this.core.emit("mySuperTeamMembers",Di(n))}notificationHandler(e){var{attach:t,scene:n,from:r,to:i,time:o,idServer:s,idClient:a}=e,{team:c,account:l,accounts:d,type:u}=t;if("superTeam"===n)switch(this.logger.getDebugMode()?this.logger.debug("superTeam::recvNotification",s,a,t):this.logger.log("superTeam::recvNotification",s,a,i,u,l,d),u){case"updateSuperTeam":c.updateTime=o,this.core.emit("updateSuperTeam",c);break;case"addSuperTeamMembers":this.service.notifyAddSuperTeamMembers(c,d);break;case"acceptSuperTeamInvite":this.service.notifyAddSuperTeamMembers(c,[r]);break;case"passSuperTeamApply":this.service.notifyAddSuperTeamMembers(c,[l]);break;case"addSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(i,d,!0,o);break;case"removeSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(i,d,!1,o);break;case"removeSuperTeamMembers":this.service.notifyRemoveSuperTeamMembers(c,d);break;case"leaveSuperTeam":this.service.notifyRemoveSuperTeamMembers(c,[r]);break;case"dismissSuperTeam":this.core.emit("dismissSuperTeam",{teamId:i});break;case"transferSuperTeam":this.service.notifyTransferSuperTeam(c,r,l);break;case"updateSuperTeamMembersMute":this.service.notifyUpdateSuperTeamMembersMute(c,d,t.mute)}}},"superTeam"),yt.registerService(class extends On{constructor(e,t={}){super("sync",e),this.syncDoneFlag=!1,this.config={myInfo:!!e.user.name,offlineMsgs:!!e.msg.name,teams:!!e.team.name,myTeamMembers:!!e.team.name,roamingMsgs:!!e.msg.name,relations:!!e.user.name,friends:!!e.friend.name,friendUsers:!!e.user.name,msgReceipts:!!e.msg.name,broadcastMsgs:!!e.msg.name,recallMsg:!!e.msg.name,sessionAck:!!e.session.name,superTeamSessionAck:!!e.session.name,superTeams:!!e.superTeam.name,mySuperTeamMembers:!!e.superTeam.name,superTeamRoamingMsgs:!!e.superTeam.name,deleteSuperTeamMsg:!!e.superTeam.name,deleteSelfMsgs:!!e.msg.name,sessionHistoryMsgsDelete:!!e.msgLog.name,avSignal:!!e.signaling.name},this.setOptions(t),this.timetags={},this.initEventListeners(),Gt({cmdMap:bi,cmdConfig:Ci})}setOptions(e){Object.assign(this.config,e)}reset(){this.timetags={},this.syncDoneFlag=!1}getSyncDoneFlag(){return this.syncDoneFlag}doSync(){var e;return Ce(this,void 0,void 0,function*(){var t=this.genSyncParams();this.logger.log("sync::doSyncV1: ",t);try{var n=yield this.core.clientSocket.sendCmd("sync",{sync:t});this.core.logger.log("sync::doSyncV1 done in",null===(e=n.content)||void 0===e?void 0:e.timetag),this.syncDoneFlag=!0,this.core.emit("syncdone")}catch(r){return this.core.logger.error("sync::doSyncV1 error",r),this.syncDoneFlag=!0,void this.core.emit("syncdone")}})}initEventListeners(){this.core.eventBus.on("logined",()=>{this.syncDoneFlag=!1,this.doSync()}),this.core.eventBus.on("sync/updateTimetag",e=>{Object.keys(e).forEach(t=>{e[t]>(this.timetags[t]||0)&&(this.timetags[t]=e[t])})})}genSyncParams(){return Object.keys(this.config).filter(e=>{var t=e;return this.config[t]}).reduce((e,t)=>{var n=t;return e[n]=this.timetags[n]||0,e},{})}handleImmediate(e){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),Promise.resolve(e)}delaySyncDone(e){var{hostEnvEnum:t}=we.getSystemInfo();return 102===t?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new Promise(t=>{setTimeout(()=>{this.handleImmediate(e).then(()=>{t(e)})},100)})):this.handleImmediate(e)}syncHandler(e){return this.delaySyncDone(e)}},"sync"),yt.registerService(class extends On{constructor(e){super("plugin",e),this.core=e,Gt({cmdMap:is,cmdConfig:os})}getChatroomAddress(e){return Ce(this,void 0,void 0,function*(){return Te({chatroomId:{type:"string",allowEmpty:!1},ipType:{type:"number",required:!1}},e),(yield this.core.sendCmd("getChatroomAddress",{chatroomId:e.chatroomId,isWeixinApp:"WXAPP"===we.platform,ipType:e.ipType||0})).content.address})}getQChatAddress(e){return Ce(this,void 0,void 0,function*(){return Te({ipType:{type:"number",required:!1}},e),(yield this.core.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:(null==e?void 0:e.ipType)||0}})).content.address})}},"plugin"),yt.registerService(class extends On{constructor(e){super("offlinePush",e),this.plugin=void 0,this.authConfig=void 0,this.appBackgroundOptions={badge:0,isBackground:!1},this.setTokenAndBackgroundStateAfterLogin=e=>{this.plugin&&(this.regToken(e&&e.aosPushInfo),this.core.sendCmd("updateAppBackground",{isBackground:this.appBackgroundOptions.isBackground,badge:this.appBackgroundOptions.badge||0}))},Gt({cmdMap:Ms,cmdConfig:bs}),this.core.eventBus.on("logined",this.setTokenAndBackgroundStateAfterLogin)}setOfflinePushConfig(e){e.plugin?(Te({plugin:{type:"object",required:!0},authConfig:{type:"object",required:!0}},e),this.plugin=e.plugin,this.authConfig=e.authConfig):this.logger.warn("setOfflinePushConfig: invoke setOfflinePushConfig without plugin. If you are not running iOS or android app, please ignore this notice.")}regToken(e){var t=we.getSystemInfo()||{},n=t.os?t.os.toLowerCase():"";if(this.logger.log("OfflinePushService: os",n),"ios"===n||"android"===n)if(this.plugin&&"function"==typeof this.plugin.getDeviceToken){var r="";e&&e.pushType?r=e.pushType:"ios"===n?r="":"android"===n&&(r="8"),this.logger.log("OfflinePushService:: prepare to get device token. suggestPushType: "+r),this.logger.log("OfflinePushService push config",JSON.stringify(this.authConfig,null,2)),this.plugin.getDeviceToken({suggestPushType:r,config:this.authConfig},e=>{e?(this.logger.log("OfflinePushService:: token is :"+e),this.pushTokenToServer(r,e)):this.logger.warn("OfflinePushService:: token is empty. Please check your parameters")})}else this.logger.warn("OfflinePushService: plugin.getDeviceToken is not a function");else this.logger.warn("OfflinePushService: only Android or IOS support offline push")}pushTokenToServer(e,t){var n="",r=this.authConfig;switch(e){case"5":n=r.xmCertificateName;break;case"6":n=r.hwCertificateName;break;case"7":n=r.mzCertificateName;break;case"8":n=r.fcmCertificateName;break;case"9":n=r.vivoCertificateName;break;case"10":n=r.oppoCertificateName;break;case"11":n=r.honorCertificateName;break;default:n=r.apnsCertificateName}""===n||void 0===n?this.logger.warn("OfflinePushService:: certificate name is empty for push type: ",e):this.updatePushToken({tokenName:n,token:t,pushkit:0})}updatePushToken(e){return Ce(this,void 0,void 0,function*(){var t;Te({tokenName:{type:"string",allowEmpty:!1,required:!0},token:{type:"string",allowEmpty:!1,required:!0},pushkit:{type:"number",required:!1}},e);try{var n=as.parse("557d1e3cafa43e2589a588270c53d56f");t=as.stringify(Es.decrypt(e.token,n)),this.logger.log("updatePushToken:: token",t)}catch(r){return this.logger.log("updatePushToken:: decrypt error",r),void this.logger.warn("updatePushToken:: token before decrypt",e.token)}yield this.core.sendCmd("updatePushToken",Object.assign(Object.assign({},e),{token:t}))})}updateAppBackground(e){return Ce(this,void 0,void 0,function*(){Te({isBackground:{type:"boolean",required:!0},badge:{type:"number",required:!1}},e),this.appBackgroundOptions={isBackground:e.isBackground,badge:e.badge||0},yield this.core.sendCmd("updateAppBackground",{isBackground:e.isBackground,badge:e.badge||0})})}},"offlinePush"),yt.registerService(class extends On{constructor(e){super("cloudSession",e),Gt({cmdMap:Cs,cmdConfig:Rs})}queryCloudSessionList(e){var t;return Ce(this,void 0,void 0,function*(){Te({minTimestamp:{type:"number",min:0,required:!1},maxTimestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},includedLastMsg:{type:"boolean",required:!1}},e);var n=Object.assign({limit:100,includedLastMsg:!0},e);n.includedLastMsg=hn.boolean(e,"includedLastMsg");var r=yield this.core.sendCmd("nimQueryCloudSessionList",{tag:n}),i=(null===(t=r.content)||void 0===t?void 0:t.tag)||{},o=r.content.sessions;return{hasMore:+i.hasMore>0,sessionList:Ps(o,this.core.account,this.logger)}})}queryCloudSession(e){return Ce(this,void 0,void 0,function*(){Te({sessionId:{type:"string",allowEmpty:!1}},e);var{accid:t,scene:n}=Fe(e.sessionId,"-");return ws((yield this.core.sendCmd("nimQueryCloudSession",{tag:{sessionId:"superTeam"===n?`super_team|${t}`:`${n}|${t}`}})).content.session,this.core.account,this.logger)})}updateCloudSession(e){return Ce(this,void 0,void 0,function*(){Te({sessionId:{type:"string",allowEmpty:!1},ext:{type:"string",allowEmpty:!1,required:!1}},e);var{accid:t,scene:n}=Fe(e.sessionId,"-");yield this.core.sendCmd("nimUpdateCloudSession",{tag:{sessionId:"superTeam"===n?`super_team|${t}`:`${n}|${t}`,ext:e.ext}})})}deleteCloudSessionList(e){return Ce(this,void 0,void 0,function*(){Te({sessionIdList:{type:"array",itemType:"string"}},e);var t=e.sessionIdList.map(e=>{var{accid:t,scene:n}=Fe(e,"-");return{sessionId:"superTeam"===n?`super_team|${t}`:`${n}|${t}`}});yield this.core.sendCmd("nimDeleteCloudSessionList",{tags:t})})}nimMultiSyncUpdateCloudSessionHandler(e){var t=ws(e.content.session,this.core.account,this.logger);this.core.emit("multiSyncUpdateCloudSession",t)}},"cloudSession"),yt.registerService(qs,"signaling"),yt.registerService(class extends An{constructor(e,t={}){var n;super("V2NIMLoginService",e),this.account="",this.previousLoginAccount="",this.token="",this.deviceId="",this.clientSession="",this.processId="",this.kickedDetail=null,this.binaryWebsocket=!0,this.core._registerDep(Ln,"misc"),Gt({cmdMap:Dn,cmdConfig:Bn}),"v2"===e.options.apiVersion&&(Gt({cmdMap:Un,cmdConfig:Fn}),this.core.auth=this),this.previousLoginManager=new nt,this.doLoginStepsManager=new nt,this.loginTimerManager=new Me,this.loginOption=Object.assign({},fr),this.config={lbsUrls:mr,linkUrl:"weblink.netease.im:443",linkSSL:!0},this.setOptions(t),e.V2NIMLoginService=this,!1!==this.core.options.binaryWebsocket&&"function"==typeof Uint8Array?(this.binaryWebsocket=!0,n=new sr(this.core)):(this.binaryWebsocket=!1,n=new ar(this.core)),this.clientSocket=n,"v2"===this.core.options.apiVersion&&(this.core.clientSocket=n),this.lifeCycle=new ur(e),this.reconnect=new cr(e),this.lbs=new lr(e),this.authenticator=new dr(e),this.dataSync=new pr(e)}get hasSettingService(){var e;return!!(null===(e=this.core.V2NIMSettingService)||void 0===e?void 0:e.name)}setOptions(e){var t,n,r;Te({lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e,"",!0),this.config=qe(this.config,e),null===(n=null===(t=this.core.clientSocket)||void 0===t?void 0:t.setLinkSSL)||void 0===n||n.call(t,null===(r=this.config.linkSSL)||void 0===r||r);var i="",o="";this.config.isFixedDeviceId?(i=we.localStorage.getItem("__NIM_DEVC_ID__")||Ue(),o=we.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||Ue(),we.localStorage.setItem("__NIM_DEVC_ID__",i),we.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",o)):(i=Ue(),o=Ue()),this.deviceId=i,this.clientSession=o,this.core.reporter.setConfig({common:{dev_id:i}})}reset(){this.account="",this.token="",this.processId="",this.lbs.reset(),this.reconnect.destroy(),this.authenticator.reset(),this.authenticator.clearLastLoginClient(),this.dataSync.reset()}login(e,t,n={}){return Ce(this,void 0,void 0,function*(){this._checkApiVersion();var r=we.getSystemInfo()||{},i=r.os?r.os.toLowerCase():"";if("React Native"===we.platform&&"android"===i&&this.hasSettingService&&Ve(this.core.V2NIMSettingService,"push.offlinePushPlugin"))try{this.deviceInfo=yield this.core.V2NIMSettingService.push.getRNDeviceInfo()}catch(o){this.logger.error(o)}if("string"!=typeof e||""===e.trim())throw new ge({detail:{reason:"Account must be string"}});if(Te(gr,n,"",!0),0===(n=qe(fr,n)).authType&&!t)throw new ge({detail:{reason:"When authType is 0, token cannot be empty"}});if(""!==this.previousLoginAccount&&this.previousLoginAccount!==e&&this.core._clearModuleData(),0===this.getLoginStatus())this.logger.log(`V2NIMLoginService::login:allowLogin:${e}`,n);else{if(1===this.getLoginStatus())return this.smoothForLogined(e,t,n);if(2===this.getLoginStatus())return this.smoothForLogining(e,t,n)}this.account=e,this.previousLoginAccount=e,this.token=t,this.processId=Ue(),this.loginOption=qe(fr,n),this.kickedDetail=null,this.loginTimerManager.destroy(),this.loginTimerManager.addTimer(()=>{var e=new pe({code:le.V2NIM_ERROR_CODE_TIMEOUT,detail:{reason:"Login API timeout"}});this.doLoginStepsManager.clear(e),this.previousLoginManager.clear(e),this.originLoginPromise=void 0,this.lifeCycle.processEvent("exited",e)},this.loginOption.timeout>0?this.loginOption.timeout:6e4,1);try{yield this.multiTryDoLogin(),this.loginTimerManager.destroy()}catch(o){throw this.loginTimerManager.destroy(),o}})}setAppVisibility(){this.logger.warn("V2NIMLoginService::setAppVisibility is deprecated @v10.9.40")}getChatroomLinkAddress(e,t){return Ce(this,void 0,void 0,function*(){return Te({roomId:{type:"string",regExp:/^\d+$/,required:!0,allowEmpty:!1},miniProgram:{type:"boolean",required:!1}},{roomId:e,miniProgram:t},"",!0),t=void 0===t?je():t,(yield this.clientSocket.sendCmd("v2GetChatroomLinkAddress",{roomId:e,miniProgram:t})).content.linkAddress})}multiTryDoLogin(e){return Ce(this,void 0,void 0,function*(){for(var t=new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"loginFailed"}}),n=0;n<=this.loginOption.retryCount;n++){var r=`V2NIMLoginService::times of login try: ${n}`;n>0?this.logger.warn(r):this.logger.log(r);try{this.originLoginPromise=e||this.doLogin(!1),e=void 0;var i=yield this.previousLoginManager.add(this.originLoginPromise);return this.core.reporter.reportTraceEnd("login",!0),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.originLoginPromise=void 0,i}catch(o){if(t=o||t,this.logger.error(`V2NIMLoginService::login failed, times of login try: ${n}, err.code: ${null==t?void 0:t.code}, err.message: "${null==t?void 0:t.message}"`),t.code!==le.V2NIM_ERROR_CODE_CANCELLED&&this.core.reporter.reportTraceEnd("login",!1),this.reconnect.clearReconnectTimer(),this.checkLoginTerminalCode(t&&t.code))throw this.lifeCycle.processEvent("exited",t),t;t&&399===t.code&&this.lbs.reset()}}throw this.lifeCycle.processEvent("exited",t),t})}doLogin(e){var t,n;return Ce(this,void 0,void 0,function*(){var r=!!e||this.authenticator.checkAutoLogin(this.loginOption.forceMode);this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",r?{user_id:this.account,action:"auto_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}:{user_id:this.account,action:"manual_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:JSON.stringify(this.loginOption),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:we.net.getNetworkStatus()});var i=yield this.doLoginStepsManager.add(this.lbs.getLbsInfos());yield this.doLoginStepsManager.add(this.clientSocket.connect(i,e));var o=yield this.doLoginStepsManager.add(this.authenticator.verifyAuthentication(r));if(this.processId=Ue(),this.clientSocket.resetSocketConfig(),this.reconnect.reset(),this.dataSync.reset(),this.lifeCycle.processEvent("loginSucc",void 0,Object.assign(Object.assign({},o),{isReconnect:e})),this.clientSocket.ping(),this.core.abtest.abtRequest(),"function"==typeof(null===(t=this.core.V2NIMClientAntispamUtil)||void 0===t?void 0:t.downloadLocalAntiSpamVocabs)&&this.core.V2NIMClientAntispamUtil.downloadLocalAntiSpamVocabs(),"function"==typeof(null===(n=this.core.cloudStorage)||void 0===n?void 0:n.init))try{yield this.core.cloudStorage.init(o.timestamp)}catch(s){this.logger.warn("doLogin::cloudStorage init error",s)}return o})}smoothForLogined(e,t,n){return Ce(this,void 0,void 0,function*(){var r=this.checkIsSameLogin(e,t,n);return this.logger.warn(`V2NIMLoginService::smoothForLogined:Logined, isSameLogin ${r}`),r?void 0:(yield this.logout(),this.login(e,t,n))})}smoothForLogining(e,t,n){return Ce(this,void 0,void 0,function*(){var r=this.checkIsSameLogin(e,t,n);if(this.logger.warn(`V2NIMLoginService::smoothForLogining:Logining progress exists, abort the previous login attempt and start next attempt, isSameLogin ${r}`),this.previousLoginManager.clear(),this.reconnect.reset(),this.account=e,this.previousLoginAccount=e,this.token=t,this.loginOption=qe(this.loginOption,n),!r)return this.doLoginStepsManager.clear(),this.clientSocket.doDisconnect(Kn.ACTIVE,"Aborted"),this.reset(),this.lifeCycle.processEvent("logout"),yield Promise.resolve(),this.login(e,t,n);if(!this.originLoginPromise)throw new pe({code:le.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"NoPreviousLoginExists"}});this.reconnect.reset(),yield Promise.resolve(),yield this.multiTryDoLogin(this.originLoginPromise)})}checkIsSameLogin(e,t,n){return this.account===e&&this.loginOption.authType===n.authType&&(0!==n.authType||this.token===t)}logout(){return Ce(this,void 0,void 0,function*(){this._checkApiVersion(),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.loginTimerManager.destroy(),this.originLoginPromise=void 0;var e=this.getConnectStatus(),t=this.getLoginStatus();switch(t){case 1:try{yield this.clientSocket.sendCmd("v2Logout",void 0,{timeout:1e3}),this.clientSocket.doDisconnect(Kn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout")}catch(n){this.logger.error("Instance::disconnect sendCmd:logout error",n),this.clientSocket.doDisconnect(Kn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout")}break;case 2:case 3:this.clientSocket.doDisconnect(Kn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout");break;case 0:throw this.core._clearModuleData(),new pe({code:le.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:`Illegal logout. loginStatus ${t}. connectStatus ${e}`}});default:throw this.core._clearModuleData(),new pe({code:le.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:`Illegal logout. illegal status: loginStatus ${t}. connectStatus ${e}`}})}})}getConnectStatus(){return this.lifeCycle.getConnectStatus()}getLoginStatus(){return this.lifeCycle.getLoginStatus()}getLoginUser(){return this.account}getLoginClients(){return function(e,t){e=e||[],t=t||"";for(var n=[],r=[],i=0;i<e.length;i++){var o=e[i][t];-1===r.indexOf(o)&&(r.push(o),n.push(e[i]))}return n}(this.authenticator.loginClients,"clientId").map(e=>hr(e,["type","os","timestamp","customTag","customClientType","clientId","clientIP"]))}getCurrentLoginClient(){var e;if(null===(e=this.authenticator.loginClientOfThisConnection)||void 0===e?void 0:e.clientId)return hr(this.authenticator.loginClientOfThisConnection,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])}getDataSync(){var e=this.dataSync.datas;return e&&e.length>0?e.map(e=>({type:e.type,state:e.state})):null}setReconnectDelayProvider(e){this.reconnect._setReconnectDelayProvider(e)}kickOffline(e){return Ce(this,void 0,void 0,function*(){if(this._checkApiVersion(),Te({clientId:{type:"string",allowEmpty:!1}},e,"",!0),0===Ve(yield this.clientSocket.sendCmd("v2KickOffline",{clientIds:[e.clientId]}),"content.clientIds.length"))throw new pe({code:le.V2NIM_ERROR_CODE_REQUEST_FAILED})})}getKickedOfflineDetail(){return this.kickedDetail}checkLoginTerminalCode(e){return this.authenticator.checkLoginTerminalCode(e)}checkIllegalState(){if(!this.getLoginUser())throw new pe({code:le.V2NIM_ERROR_CODE_ILLEGAL_STATE})}_checkApiVersion(){if("v2"!==this.core.options.apiVersion)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v2"'}})}v2LoginHandler(e){if(e.error)throw this.clientSocket.doDisconnect(Kn.ACTIVE,e.error),e.error;return e}v2LoginClientChangeHandler(e){this.authenticator.changeLoginClient(parseInt(e.content.state),e.content.datas)}nimLoginClientChangeHandler(e){this.authenticator.changeLoginClient(parseInt(e.content.state),e.content.datas)}qchatLoginClientChangeHandler(e){var t=parseInt(e.content.state);t=1===t?2:3,this.authenticator.changeLoginClient(t,[e.content.data])}v2BeKickedHandler(e){if(e.error)this.core.logger.error("v2BeKickedHandler error, ",e.error);else{var t=an({reason:{type:"number"},clientType:{type:"number"},customClientType:{type:"number"}},e.content);this.core.logger.warn("v2Bekicked::",t),this.kickedDetail=t,this.clientSocket.doDisconnect(Kn.KICKED,t),this.core._clearModuleData(),this.lifeCycle.processEvent("kicked",new pe({code:le.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to kicked"}}),t),this.emit("onKickedOffline",t)}}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;if("onLoginFailed"===e||"onDisconnected"===e||"onConnectFailed"===e){var r=t[0];this.logger.log(`${n}`,r.toString())}else if("onDataSync"===e){var i=t[2];this.logger.log(`${n}`,t[0],t[1],i&&i.toString())}else this.logger.log(`${n}`,...t);return super.emit(e,...t)}},"V2NIMLoginService"),yt.registerService(class extends An{constructor(e,t={}){super("V2NIMLocalConversationService",e),this.config={},this.model=new zd,this.unread=new eu(this.core,this),this.compute=new au(this.core,this),this.event=new lu(this.core,this),this.handler=new cu(this.core,this),this.core._registerDep(Wc,"V2NIMConversationIdUtil"),this.core._registerDep(jd,"V2NIMMessageService"),"v2"===this.core.options.apiVersion&&(Gt({cmdMap:Yd,cmdConfig:Zd}),this.setOptions(t),this.setListener())}setOptions(e){this.config=Object.assign(this.config,e)}setListener(){this.event.setListener()}reset(){this.model.reset(),this.unread.reset()}emit(e,...t){return this.event.beforeEmit(e,...t),super.emit(e,...t)}getConversationList(e,t){this.checkV2(),Te({offset:{type:"number",min:0}},{offset:e},"",!0),Te({limit:{type:"number",min:1}},{limit:t},"",!0),this.core.V2NIMLoginService.checkIllegalState();var n=this.model.getByOption(e,t,{});return n.conversationList=n.conversationList.map(e=>this.compute.computeFromExternal(e)),Promise.resolve(n)}getConversationListByOption(e,t,n){this.checkV2(),Te({offset:{type:"number",min:0}},{offset:e},"",!0),Te({limit:{type:"number",min:1}},{limit:t},"",!0),Te({conversationTypes:{type:"array",itemType:"number",required:!1},onlyUnread:{type:"boolean",required:!1}},n,"option",!0),this.core.V2NIMLoginService.checkIllegalState();var r=this.model.getByOption(e,t,n);return r.conversationList=r.conversationList.map(e=>this.compute.computeFromExternal(e)),Promise.resolve(r)}getConversation(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Ee(this.core.account,e);var t=this.model.getById(e);if(t)return this.compute.computeFromExternal(t);throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST})})}getConversationListByIds(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),this.core.V2NIMLoginService.checkIllegalState();var t=e.map(e=>this.model.getById(e)).filter(e=>!!e);return t.map(e=>this.compute.computeFromExternal(e))})}createConversation(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Ee(this.core.account,e);var t=this.model.getById(e);if(t)return this.compute.computeFromExternal(t);var n=this.compute.computeConvByMsgsCache(e,{updateTime:this.core.timeOrigin.getNTPTime()});n=this.compute.computeConvWithUnread(n),n=this.compute.computeFromExternal(n),this.model.upsert(n);var r=this.model.getById(e);return this.triggerConversationCreated(r),r})}deleteConversation(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Ee(this.core.account,e),Te({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0),yield this.unread.markConversationRead(e);var n=this.model.deleteById(e);if(!n)throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});t&&this.core.V2NIMMessageService.model.deleteMessages(e),!!(n&&n.unreadCount>0)&&this.unread.digestUnreadCountChange(),this.emit("onConversationDeleted",[e])})}deleteConversationListByIds(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),Te({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0),yield this.unread.markMultiConversationRead(e);var n=!1;return e.forEach(e=>{t&&this.core.V2NIMMessageService.model.deleteMessages(e),this.model.deleteById(e)&&(n=!0)}),n&&this.unread.digestUnreadCountChange(),this.emit("onConversationDeleted",e),[]})}getStickTopConversationList(){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.getStickTopList()})}stickTopConversation(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Ee(this.core.account,e),Te({stickTop:{type:"boolean"}},{stickTop:t},"",!0);var n=this.model.getById(e);if((null==n?void 0:n.stickTop)!==t){var r=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=yield this.core.sendCmd(t?"v2LocalConvStickTopAdd":"v2LocalConvStickTopDelete",{tag:{id:Wd(i,r)}});this.model.updateStickTop(e,t);var s=o.content.timetag||o.content.data.updateTime;this.model.upsert({conversationId:e,type:i,stickTop:t,updateTime:s,sortOrder:this.compute.computeSortOrder(t,s)});var a=[this.model.getById(e)];this.triggerConversationChanged(a)}})}updateConversationLocalExtension(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Ee(this.core.account,e),Te({localExtension:{type:"string"}},{localExtension:t},"",!0);var n=this.model.getById(e);if(!n)throw new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});if(n.localExtension!==t){var r=Object.assign(Object.assign({},n),{localExtension:t});this.model.upsert(r),this.triggerConversationChanged([r])}})}getTotalUnreadCount(){return this.checkV2(),this.unread.getTotalUnreadCount()||0}getUnreadCountByIds(e){this.checkV2(),Te({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0);var t=this.unread.getUnreadCountByIds(e);return Promise.resolve(t)}getUnreadCountByFilter(e){this.checkV2(),this.valiteFilter(e);var t=this.unread.getUnreadCountByFilter(e);return Promise.resolve(t)}clearTotalUnreadCount(){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.checkLogin();var e=this.model.getAll();yield this.unread.markMultiConversationRead(e.map(e=>e.conversationId)),this.unread.clearUnreadCount(e)})}clearUnreadCountByIds(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.checkLogin(),Te({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0);var t=[],n=[],r=new RegExp(`^${this.core.account}\\|[1-3]\\|`);if(e.forEach(e=>{r.test(e)?t.push(e):n.push(e)}),t.length>0){var i=t.map(e=>this.model.getById(e)).filter(e=>!!e);yield this.unread.markMultiConversationRead(t),this.unread.clearUnreadCount(i)}return n.map(e=>({conversationId:e,error:new pe({code:le.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST})}))})}clearUnreadCountByTypes(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.checkLogin(),Te({types:du},{types:e},"",!0);var t=this.model.getByOption(0,1e3,{conversationTypes:e});yield this.unread.markMultiConversationRead(t.conversationList.map(e=>e.conversationId)),this.unread.clearUnreadCount(t.conversationList)})}subscribeUnreadCountByFilter(e){var t;this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.addFilter(e)}unsubscribeUnreadCountByFilter(e){var t;this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.deleteFilter(e)}getConversationReadTime(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),Ee(this.core.account,e),this.model.getReadTime(e)})}markConversationRead(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.checkLogin(),Ee(this.core.account,e),this.unread.markConversationRead(e)})}setCurrentConversation(e){this.checkV2(),e&&Ee(this.core.account,e),this.unread.setCurrentConversation(e)}valiteFilter(e){if(Te({filter:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},ignoreMuted:{type:"boolean",required:!1}}}},{filter:e},"",!0),void 0===e.conversationTypes&&!0!==e.ignoreMuted)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Filter cannot be empty"}})}triggerConversationChanged(e){e=e.map(e=>this.compute.computeFromExternal(e)),(e=JSON.parse(JSON.stringify(e))).forEach(e=>{e.lastMessage||(e.lastMessage=void 0),delete e.lastMessageState}),this.emit("onConversationChanged",e)}triggerConversationCreated(e){e=this.compute.computeFromExternal(e),delete(e=JSON.parse(JSON.stringify(e))).lastMessageState,this.emit("onConversationCreated",e)}},"V2NIMLocalConversationService"),yt.registerService(Pu,"V2NIMConversationService"),yt.registerService(class extends An{constructor(e,t={}){super("V2NIMConversationGroupService",e),this.config={},this.core._registerDep(Pu,"V2NIMConversationService"),"v2"===this.core.options.apiVersion&&!0===this.core.options.enableV2CloudConversation&&(Gt({cmdMap:Lu,cmdConfig:Du}),this.setOptions(t))}setOptions(e){this.config=Object.assign(this.config,e)}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;if("onConversationsAddedToGroup"===e){var r=t[0],i=t[1];this.logger.log(`${n}`,`groupId:${r}`,`conversations:${i.map(e=>e.conversationId).join(",")}`)}else this.logger.log(`${n}`,...t);return super.emit(e,...t)}get ifEnabled(){return!0===this.core.options.enableV2CloudConversation}checkEnable(){if(!0!==this.core.options.enableV2CloudConversation)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2CloudConversation is not enabled"}})}createConversationGroup(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Te({name:{type:"string",allowEmpty:!1}},{name:e},"",!0),Te({serverExtension:{type:"string",required:!1}},{serverExtension:t},"",!0),Te({conversationIds:{type:"array",itemType:"string",required:!1}},{conversationIds:n},"",!0);var r=yield this.core.sendCmd("v2ConversationGroupCreate",{tag:{name:e,serverExtension:t||"",conversationIds:n&&JSON.stringify(n)}}),i=Mu(Ve(r,"content.data")),o=iu(this.core,Ve(r,"content.conversations")),s=bu(Ve(r,"content.info.failedMap"));return this.emit("onConversationGroupCreated",i),o.length>0&&(this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(o),this.emit("onConversationsAddedToGroup",i.groupId,o.map(e=>this.core.V2NIMConversationService.model.getById(e.conversationId)).filter(e=>!!e))),{group:i,failedList:s}})}deleteConversationGroup(e){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Te({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0);var t=Ou(Ve(yield this.core.sendCmd("v2ConversationGroupDelete",{tag:{groupId:e}}),"content.info"));this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(t.deleteVersion,e),this.emit("onConversationGroupDeleted",e)})}updateConversationGroup(e,t,n){return Ce(this,void 0,void 0,function*(){if(this.checkEnable(),this.checkV2(),Te({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Te({name:{type:"string",required:!1}},{name:t},"",!0),Te({serverExtension:{type:"string",required:!1}},{serverExtension:n},"",!0),void 0===t&&void 0===n)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER});var r=Mu(Ve(yield this.core.sendCmd("v2ConversationGroupUpdate",{tag:{groupId:e,name:t,serverExtension:n}}),"content.data"));this.emit("onConversationGroupChanged",r)})}addConversationsToGroup(e,t){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Te({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Te({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:t},"",!0);var n=yield this.core.sendCmd("v2ConversationGroupAddTo",{tag:{groupId:e,conversationIds:JSON.stringify(t)}}),r=Ve(n,"content.info.failedMap")||"",i=[];r&&(i=bu(r));var o=iu(this.core,Ve(n,"content.datas"));this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(o);var s=o.map(e=>this.core.V2NIMConversationService.model.getById(e.conversationId)).filter(e=>!!e);return s.length>0&&this.emit("onConversationsAddedToGroup",e,s),i})}removeConversationsFromGroup(e,t){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Te({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Te({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:t},"",!0);var n=yield this.core.sendCmd("v2ConversationGroupRemoveFrom",{tag:{groupId:e,conversationIds:JSON.stringify(t)}}),r=Ve(n,"content.info.failedMap")||"",i=[];r&&(i=bu(r));var o=iu(this.core,Ve(n,"content.datas"));return this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(o),this.emit("onConversationsRemovedFromGroup",e,o.map(e=>e.conversationId)),i})}getConversationGroup(e){return Ce(this,void 0,void 0,function*(){return this.checkEnable(),this.checkV2(),Te({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Mu(Ve(yield this.core.sendCmd("v2ConversationGroupGet",{tag:{groupId:e}}),"content.data"))})}getConversationGroupList(){return Ce(this,void 0,void 0,function*(){return this.checkEnable(),this.checkV2(),Eu(Ve(yield this.core.sendCmd("v2ConversationGroupListGet"),"content.datas"))})}getConversationGroupListByIds(e){return Ce(this,void 0,void 0,function*(){this.checkEnable(),this.checkV2(),Te({groupIds:{type:"array",itemType:"string",min:1}},{groupIds:e},"",!0);var t=Eu(Ve(yield this.core.sendCmd("v2ConversationGroupsGet",{tag:{groupIds:e&&JSON.stringify(e)}}),"content.datas"));return e.map(e=>t.filter(t=>t.groupId===e)[0]).filter(e=>!!e)})}v2ConversationGroupNotifySyncOnlineHandler(e){if(this.ifEnabled){var t=Ou(Ve(e,"content.info")),{type:n,deleteVersion:r,conversationIds:i}=t,o=Mu(Ve(e,"content.data"));if(this.core.logger.log("v2ConversationGroupNotifySyncOnlineHandler",t,o),1===n)this.emit("onConversationGroupCreated",o),i&&i.length>0&&this.emit("onConversationsAddedToGroup",o.groupId,i.map(e=>this.core.V2NIMConversationService.model.getById(e)).filter(e=>!!e));else if(2===n)this.emit("onConversationGroupDeleted",o.groupId),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(r,o.groupId);else if(3===n)this.emit("onConversationGroupChanged",o);else if(4===n){var s=i.map(e=>this.core.V2NIMConversationService.model.getById(e)).filter(e=>!!e);this.emit("onConversationsAddedToGroup",o.groupId,s)}else 5===n&&this.emit("onConversationsRemovedFromGroup",o.groupId,i)}}},"V2NIMConversationGroupService"),yt.registerService(jd,"V2NIMMessageService"),yt.registerService(class extends An{constructor(e,t){super("V2NIMNotificationService",e),this.config={compatibleWithV1:!0},this.notificationUtil=new Ad(this.core),this.core._registerDep(Wc,"V2NIMConversationIdUtil"),"v2"===this.core.options.apiVersion&&(Gt({cmdMap:_d,cmdConfig:Sd}),this.setOptions(t))}setOptions(e){var t;(null===(t=this.core.systemMessage)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=Object.assign(this.config,e)}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;if("onReceiveCustomNotifications"===e){var r=t[0];this.logger.log(`${n}`,r.map(e=>`sender:${e.senderId};receiver:${e.receiverId};ctype:${e.conversationType};time:${e.timestamp}`))}else if("onReceiveBroadcastNotifications"===e){var i=t[0];this.logger.log(`${n}`,i.map(e=>`id:${e.id};sender:${e.senderId};time:${e.timestamp}`))}else this.logger.log(`${n}`,...t);return super.emit(e,...t)}sendCustomNotification(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Ee(this.core.account,e),Te(Cd,{content:t,params:n},"",!0);var r=3===this.core.V2NIMConversationIdUtil.parseConversationType(e)?"v2SendCustomNotificationWithSuperTeam":"v2SendCustomNotification",i=this.notificationUtil.generateNotificationTag(e,t,n);yield this.core.sendCmd(r,{tag:i})})}processSystemNotification(e){var t=e.type;if([0,1,2,3,4,15,16,17,18].includes(t))this.core.eventBus.emit("V2NIMTeamService/sysNotification",e);else{if(![5,6].includes(t)){var n=Object.assign(Object.assign({},e),{conversationType:{100:1,101:2,102:1,103:3}[t]});return delete n.type,n}this.core.eventBus.emit("V2NIMFriendService/sysNotification",e)}}markBroadcastMsgAck(e){this.config.compatibleWithV1||this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:17,ids:e.map(e=>e.id)})}syncBroadcastMsgHandler(e){var t=e.content.datas;this.markBroadcastMsgAck(t),t.forEach(e=>{this.core.eventBus.emit("V2NIMSync/updateTimetag",{broadcastMsgs:parseInt(e.id)})}),this.emit("onReceiveBroadcastNotifications",t)}onBroadcastMsgHandler(e){var t=e.content.data;this.markBroadcastMsgAck([t]),this.core.eventBus.emit("V2NIMSync/updateTimetag",{broadcastMsgs:parseInt(t.id)}),this.emit("onReceiveBroadcastNotifications",[t])}onSysNotificationHandler(e){var t=Ke(e,e.content.data,"idServer");this.markSysNotificationAck([t]);var n=this.processSystemNotification(t);n&&this.emit("onReceiveCustomNotifications",[n])}v2SyncOfflineSysNotificationsHandler(e){this.markSysNotificationAck(e.content.datas);var t=e.content.datas.sort((e,t)=>e.timestamp-t.timestamp).map(e=>this.processSystemNotification(e)).filter(e=>e);t&&this.emit("onReceiveCustomNotifications",t)}v2NotificationRevokeHandler(e){var t=Ke(e,e.content.data,"idServer");this.markSysNotificationAck([t])}v2NotificationSyncRevokeHandler(e){var{type:t}=e.content;1===parseInt(t)&&this.markSysNotificationAck(e.content.datas)}markSysNotificationAck(e){if(!this.config.compatibleWithV1){var t=[],n=[],r=[15,16,17,18,103];e.forEach(e=>{e.idServer&&(r.includes(e.type)?n.push(e.idServer):t.push(e.idServer))}),t.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"7",cid:"3",ids:t}),n.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"21",cid:"19",ids:n})}}},"V2NIMNotificationService"),yt.registerService(wd,"V2NIMStorageService"),yt.registerService(Nd,"V2NIMStorageUtil"),yt.registerService(class extends An{constructor(e){super("V2NIMTeamService",e),this.core._registerDep(Wc,"V2NIMConversationIdUtil"),this.model=new Mp,this.memberModel=new bp,this.notificationModel=new Ap,this.notification=new Cp(e,this),this.event=new Op(e,this),this.handler=new Rp(e,this),"v2"===this.core.options.apiVersion&&(Gt({cmdMap:Dl,cmdConfig:Hl}),this.setListener())}setListener(){this.event.setListener()}reset(){this.model.reset(),this.memberModel.reset(),this.notificationModel.reset()}emit(e,...t){return this.event.beforeEmit(e,...t),super.emit(e,...t)}createTeam(e,t,n,r){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te({createTeamParams:tp},{createTeamParams:e},"",!0),Te({inviteeAccountIds:Object.assign(Object.assign({},np),{min:0,required:!1})},{inviteeAccountIds:t},"",!0),Te({antispamConfig:sp},{antispamConfig:r},"",!0);var i=2===e.teamType?"v2SuperTeamCreate":"v2TeamCreate",o=yield this.core.sendCmd(i,{team:e,inviteeAccountIds:t||[],postscript:n||"",antispamConfig:r}),s=o.content.team;return this.model.upsert(s),this.getTeamMemberListByIds(s.teamId,s.teamType,[this.core.account]).catch(e=>{this.core.logger.error("Get Member error after createTeam",e)}),this.emit("onTeamCreated",s),{team:s,failedList:o.content.failedList}})}updateTeamInfo(e,t,n,r){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te(pp,{updateTeamInfoParams:n},"",!0),Te({antispamConfig:sp},{antispamConfig:r},"",!0);var i=Object.assign({teamId:e,teamType:t},n),o=2===t?"v2SuperTeamUpdateInfo":"v2TeamUpdateInfo";yield this.core.sendCmd(o,{team:i,antispamConfig:r}),this.model.upsert(i)})}leaveTeam(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0);var n=2===t?"v2SuperTeamLeave":"v2TeamLeave";yield this.core.sendCmd(n,{teamId:e}),this.model.deleteById(e,t)})}getTeamInfo(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0);var n=2===t?"v2SuperTeamGetInfo":"v2TeamGetInfo",r=this.model.getById(e,t,!1);if(r)return r;var i=(yield this.core.sendCmd(n,{teamId:e})).content.team;return this.model.upsert(i),i})}getJoinedTeamList(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(dp,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&0!==e.length||(e=[1,2]);var t=[];return e.forEach(e=>{t=t.concat(this.model.getAll(e))}),t.sort((e,t)=>e.createTime-t.createTime)})}getJoinedTeamCount(e){this.checkV2(),Te(dp,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&0!==e.length||(e=[1,2]);var t=0;return e.forEach(e=>{t+=this.model.count(e)}),t}getJoinedTeamMembers(e){this.checkV2(),Te(dp,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&0!==e.length||(e=[1,2]);var t=[];return e.forEach(e=>{var n=this.memberModel.chooseList(e).filter(e=>e.accountId===this.core.account);t=t.concat(n)}),Promise.resolve(t)}getTeamInfoByIds(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(cp,{teamIds:e},"",!0),Te(lp,{teamType:t},"",!0);var n=2===t?"v2SuperTeamGetByIds":"v2TeamGetByIds",r=e.map(e=>this.model.getById(e,t,!1)),i=e.filter((e,t)=>!r[t]);if(0===i.length)return r;var o=(yield this.core.sendCmd(n,{teamIds:i})).content.teams;return r.map((t,n)=>{if(t)return t;var r=e[n],i=o.find(e=>e.teamId===r);return i&&this.model.upsert(i),i}).filter(e=>!!e)})}dismissTeam(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0);var n=2===t?"v2SuperTeamDismiss":"v2TeamDismiss";yield this.core.sendCmd(n,{teamId:e})})}inviteMember(e,t,n,r){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te({inviteeAccountIds:np},{inviteeAccountIds:n},"",!0),Te({postscript:Object.assign(Object.assign({},ip),{required:!1})},{postscript:r},"",!0);var i=2===t?"v2SuperTeamInviteMembers":"v2TeamInviteMembers";return(yield this.core.sendCmd(i,{teamId:e,accounts:n,ps:r||""})).content.abortedAccidList})}inviteMemberEx(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te(up,{inviteeParams:n},"",!0);var r=2===t?"v2SuperTeamInviteMembers":"v2TeamInviteMembers";return(yield this.core.sendCmd(r,{teamId:e,accounts:n.inviteeAccountIds,ps:n.postscript||"",attach:n.serverExtension})).content.abortedAccidList})}acceptInvitation(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(vp,e,"invitationInfo",!0),Te(_p,e,"invitationInfo",!0);var{teamType:t,teamId:n,operatorAccountId:r}=e,i=2===t?"v2SuperTeamAcceptInvitation":"v2TeamAcceptInvitation";try{var o=yield this.core.sendCmd(i,{teamId:n,from:r});return this.notification.updateTeamActionStatus(e,1),o.content.team}catch(a){var s=a;throw this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),a}})}rejectInvitation(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(vp,e,"invitationInfo",!0),Te(_p,e,"invitationInfo",!0),Te({postscript:Object.assign(Object.assign({},ip),{required:!1})},{postscript:t},"",!0);var{teamType:n,teamId:r,operatorAccountId:i}=e,o=2===n?"v2SuperTeamRejectInvite":"v2TeamRejectInvite";try{yield this.core.sendCmd(o,{teamId:r,from:i,ps:t||""}),this.notification.updateTeamActionStatus(e,2)}catch(a){var s=a;throw this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),a}})}kickMember(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te({memberAccountIds:np},{memberAccountIds:n},"",!0);var r=2===t?"v2SuperTeamKickMembers":"v2TeamKickMembers";yield this.core.sendCmd(r,{teamId:e,accounts:n})})}applyJoinTeam(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0);var r=2===t?"v2SuperTeamApplyToJoin":"v2TeamApplyToJoin",i=yield this.core.sendCmd(r,{teamId:e,ps:n||""}),o=i.content.team,s=i.content.isInTeam;return o.isValidTeam=!!o.isValidTeam&&!!s,o})}acceptJoinApplication(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(vp,e,"applicationInfo",!0),Te(Ip,e,"applicationInfo",!0);var{teamType:t,teamId:n,operatorAccountId:r}=e,i=2===t?"v2SuperTeamAcceptJoinApplication":"v2TeamAcceptJoinApplication";try{yield this.core.sendCmd(i,{teamId:n,from:r}),this.notification.updateTeamActionStatus(e,1)}catch(s){var o=s;throw this.notification.checkIfExpired(o.code)&&this.notification.updateTeamActionStatus(e,3),s}})}rejectJoinApplication(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(vp,e,"applicationInfo",!0),Te(Ip,e,"applicationInfo",!0),Te({postscript:Object.assign(Object.assign({},ip),{required:!1})},{postscript:t},"",!0);var{teamType:n,teamId:r,operatorAccountId:i}=e,o=2===n?"v2SuperTeamRejectJoinApplication":"v2TeamRejectJoinApplication";try{yield this.core.sendCmd(o,{teamId:r,from:i,ps:t||""}),this.notification.updateTeamActionStatus(e,2)}catch(a){var s=a;throw this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),a}})}updateTeamMemberRole(e,t,n,r){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te({memberAccountIds:np},{memberAccountIds:n},"",!0),Te({memberRole:hp},{memberRole:r},"",!0);var i=2===r?"AddManagers":"RemoveManagers";i=2===t?`v2SuperTeam${i}`:`v2Team${i}`,yield this.core.sendCmd(i,{teamId:e,accounts:En(n)})})}transferTeamOwner(e,t,n,r){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te({accountId:op},{accountId:n},"",!0),Te({leave:{type:"boolean",required:!1}},{leave:r},"",!0);var i=this.model.getById(e,t);if(i&&i.ownerAccountId===n)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Transfer to self is not allowed"}});var o=2===t?"v2SuperTeamTransferOwner":"v2TeamTransferOwner";yield this.core.sendCmd(o,{teamId:e,account:n,leave:r||!1})})}updateSelfTeamMemberInfo(e,t,n){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te(gp,{memberInfoParams:n},"",!0),void 0===n.teamNick&&void 0===n.serverExtension)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER});var r=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",i=Object.assign(Object.assign({},n),{teamId:e,accountId:this.core.account}),o=n.antispamConfig?{teamMember:i,specialFollowUpdate:{},antispam:n.antispamConfig}:{teamMember:i};yield this.core.sendCmd(r,o),yield this.notification.updateTeamMemberRole(e,t,[this.core.account],i);var s=this.memberModel.getById(e,t,this.core.account);if(this.core.V2NIMSettingService.name&&this.core.V2NIMConversationIdUtil.name){var a=1===t?this.core.V2NIMConversationIdUtil.teamConversationId(e):this.core.V2NIMConversationIdUtil.superTeamConversationId(e),c=this.core.V2NIMSettingService.getConversationMuteStatus(a);this.core.eventBus.emit("V2NIMSettingService/setMute",a,c)}this.core.eventBus.emit("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",s)})}updateTeamMemberNick(e,t,n,r){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te({accountId:op},{accountId:n},"",!0),Te({nick:ip},{nick:r},"",!0),n===this.core.account)return this.updateSelfTeamMemberInfo(e,t,{teamNick:r});var i=2===t?"v2SuperTeamUpdateMember":"v2TeamUpdateMember";yield this.core.sendCmd(i,{teamMember:{teamNick:r,teamId:e,accountId:n}})})}updateTeamMemberNickEx(e,t,n){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te(Ep,n,"",!0),n.accountId===this.core.account)return this.updateSelfTeamMemberInfo(e,t,{teamNick:n.teamNick,antispamConfig:n.antispamConfig});var r=2===t?"v2SuperTeamUpdateMember":"v2TeamUpdateMember";yield this.core.sendCmd(r,{teamMember:{teamNick:n.teamNick,teamId:e,accountId:n.accountId},antispam:n.antispamConfig})})}setTeamChatBannedMode(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te(mp,{chatBannedMode:n},"",!0);var r=2===t?"v2SuperTeamSetChatBannedMode":"v2TeamSetChatBannedMode";yield this.core.sendCmd(r,{teamId:e,chatBannedMode:n}),this.model.upsert({teamId:e,teamType:t,chatBannedMode:n})})}setTeamMemberChatBannedStatus(e,t,n,r){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te({accountId:op},{accountId:n},"",!0),Te({chatBanned:rp},{chatBanned:r},"",!0);var i=2===t?"v2SuperTeamMemberSetChatBannedStatus":"v2TeamMemberSetChatBannedStatus";yield this.core.sendCmd(i,{teamId:e,accountId:2===t?[n]:n,chatBanned:r?1:0})})}getTeamMemberList(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te(fp,{queryOption:n},"",!0);var r=void 0===n.direction?0:n.direction;r=0===r?1:0;var i=yield this.core.sendCmd("v2TeamMemberGetList",{tag:Object.assign(Object.assign({teamId:e,teamType:t,onlyChatBanned:!1,nextToken:"",limit:100},n),{direction:r})}),o=i.content.datas,s=Ve(i,"raw.r.0");return 2===t&&s&&s.map&&(o=s.map(e=>qt(e,Wt(jl)))),{nextToken:i.content.pageInfo.nextToken||"",finished:!+i.content.pageInfo.hasMore,memberList:Yl(o,t)}})}getTeamMemberListByIds(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te({accountIds:np},{accountIds:n},"",!0);for(var r=2===t?"v2SuperTeamMemberGetListByIds":"v2TeamMemberGetListByIds",i=n.map(t=>`${e}|${t}`),o=[],s=0;s<i.length;s+=20){var a=Yl((yield this.core.sendCmd(r,{tag:i.slice(s,s+20)})).content.datas,t);o=o.concat(a),a.forEach(e=>this.memberModel.upsert(e))}return o})}getTeamMemberInvitor(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te({accountIds:np},{accountIds:n},"",!0);var r=2===t?"v2SuperTeamGetMemberInvitor":"v2TeamGetMemberInvitor";return(yield this.core.sendCmd(r,{teamId:e,accounts:n})).content.accountsMap})}searchTeamByKeyword(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.checkLogin(),Te({keyword:op},{keyword:e},"",!0),this.model.searchTeamByKeyword(e)})}addTeamMembersFollow(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(Sp,{teamId:e,teamType:t,accountIds:n},"",!0);var r=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",[i]=yield this.getTeamMemberListByIds(e,t,[this.core.account]),o=(yield this.core.sendCmd(r,{teamMember:{teamId:e},specialFollowUpdate:{accountIds:n,operation:1}})).content.data;Object.keys(o).length>0&&(Object.assign(i,o),this.emit("onTeamMemberInfoUpdated",[i]),this.memberModel.upsert(i))})}removeTeamMembersFollow(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(Sp,{teamId:e,teamType:t,accountIds:n},"",!0);var[r]=yield this.getTeamMemberListByIds(e,t,[this.core.account]),i=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",o=(yield this.core.sendCmd(i,{teamMember:{teamId:e},specialFollowUpdate:{accountIds:n,operation:0}})).content.data;Object.keys(o).length>0&&(Object.assign(r,o),this.emit("onTeamMemberInfoUpdated",[r]),this.memberModel.upsert(r))})}getTeamJoinActionInfoList(e){return this.checkV2(),Te(Tp,e,"option",!0),this.core.V2NIMLoginService.checkIllegalState(),Promise.resolve(this.notificationModel.getByOption(e))}clearAllTeamJoinActionInfo(){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.notificationModel.reset()})}deleteTeamJoinActionInfo(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Te(vp,e,"",!0),Te(yp,e,"",!0),Te({timestamp:{type:"number",min:1}},e,"",!0),this.notificationModel.delete(e)})}setTeamJoinActionInfoRead(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),e?(Te(vp,e,"",!0),Te(yp,e,"",!0),this.notificationModel.setRead(e)):this.notificationModel.setAllRead()})}getTeamJoinActionInfoUnreadCount(){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.notificationModel.getUnreadCount()})}},"V2NIMTeamService"),yt.registerService(Up,"V2NIMUserService"),yt.registerService(class extends An{constructor(e){super("V2NIMFriendService",e),this.notification=new Yp(this.core,this),this.model=new Jp,this.notificationModel=new Xp,this.core._registerDep(Up,"V2NIMUserService"),"v2"===this.core.options.apiVersion&&(Gt({cmdMap:Bp,cmdConfig:jp}),this.setListener())}reset(){this.model.reset()}setListener(){this.core.eventBus.on("V2NIMFriendService/sysNotification",this.notification.processSysNotification.bind(this.notification)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/addFriend",this.handleAddFriend.bind(this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/deleteFriend",this.handleDeleteFriend.bind(this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/setFriendInfo",this.handleSetFriendInfo.bind(this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/acceptAddApplication",this.handlePassFriendApply.bind(this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/rejectAddApplication",this.handleRejectFriendApply.bind(this))}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;if("onFriendAdded"===e||"onFriendInfoChanged"===e){var r=t[0];this.logger.log(`${n}`,`${r.accountId};updateTime:${r.updateTime}`)}else this.logger.log(`${n}`,...t);return super.emit(e,...t)}get hasUserService(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}addFriend(e,t){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),e===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot add yourself"}});Te(qp,{accountId:e,params:t},"",!0),yield this.core.sendCmd("v2AddFriend",{accountId:e,verifyType:t.addMode,postscript:t.postscript||""}),1===t.addMode&&(yield this.handleAddFriend(e),this.notificationModel.updateFriendAddApplicationStatus(e,4,this.core.account))})}deleteFriend(e,t){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),e===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot delete yourself"}});Te(Gp,{accountId:e,params:t},"",!0),yield this.core.sendCmd("v2DeleteFriend",{accountId:e,params:t}),t.deleteAlias&&this.model.upsertFriend(e,{alias:""}),this.handleDeleteFriend(e)})}acceptAddApplication(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),zp(e,this.core.account);try{yield this.core.sendCmd("v2AddFriend",{accountId:e.applicantAccountId,verifyType:3,postscript:""}),this.handlePassFriendApply(e.applicantAccountId)}catch(t){throw this.handlePassFriendApply(e.applicantAccountId,t),t}})}rejectAddApplication(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),zp(e,this.core.account);try{yield this.core.sendCmd("v2AddFriend",{accountId:e.applicantAccountId,verifyType:4,postscript:t||""}),this.handleRejectFriendApply({applicantAccountId:e.applicantAccountId,recipientAccountId:e.recipientAccountId,operatorAccountId:this.core.account,postscript:t||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!1,status:2})}catch(n){throw this.handleRejectFriendApply({applicantAccountId:e.applicantAccountId,recipientAccountId:e.recipientAccountId,operatorAccountId:this.core.account,postscript:t||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!1,status:3},n),n}})}setFriendInfo(e,t){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te(Hp,{accountId:e,params:t},"",!0),e===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot set yourself"}});yield this.core.sendCmd("v2SetFriendInfo",{tag:Object.assign({accountId:e},t)}),this.handleSetFriendInfo(e,t)})}getFriendList(){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.computedFields(this.model.getFriendList())})}getFriendByIds(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Te({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:e},"",!0),this.computedFields(this.model.getFriendByIds(e))})}checkFriend(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Te({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:e},"",!0);var t={};return e.forEach(e=>{t[e]=!!this.model.getFriend(e)}),t})}getAddApplicationList(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Te(Kp,e,"",!0),this.notificationModel.getAddApplicationList(e)})}setAddApplicationRead(){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.notificationModel.setAllApplicationRead()})}setAddApplicationReadEx(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),e?(zp(e,this.core.account),this.notificationModel.setApplicationRead(e)):this.notificationModel.setAllApplicationRead()})}getAddApplicationUnreadCount(){return Ce(this,void 0,void 0,function*(){return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.notificationModel.getAddApplicationUnreadCount()})}clearAllAddApplication(){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.notificationModel.clearApplicationList()})}deleteAddApplication(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),zp(e,this.core.account),this.notificationModel.deleteApplication(e)})}searchFriendByOption(e){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Te({keyword:{type:"string",allowEmpty:!1},searchAccountId:{type:"boolean",required:!1}},e,"",!0),void 0!==e.searchAlias&&!e.searchAlias&&!e.searchAccountId)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchAlias and searchAccountId cannot be false at the same time"}});return this.computedFields(this.model.getFriendListBySearchOption(e))})}v2OnAddFriendHandler(e){var{accountId:t,verifyType:n,postscript:r}=e.content;if(1===n)this.handleAddFriend(t),this.notificationModel.updateFriendAddApplicationStatus(t,4,this.core.account);else if(2===n){var i={applicantAccountId:this.core.account,recipientAccountId:t,operatorAccountId:this.core.account,postscript:r,timestamp:this.core.timeOrigin.getNTPTime(),status:0,read:!1};this.handleApplyFriend(i)}else if(3===n)this.handlePassFriendApply(t);else if(4===n){var o={applicantAccountId:t,recipientAccountId:this.core.account,operatorAccountId:this.core.account,postscript:r,timestamp:this.core.timeOrigin.getNTPTime(),status:2,read:!1};this.handleRejectFriendApply(o)}}v2OnDeleteFriendHandler(e){var{accountId:t}=e.content;this.handleDeleteFriend(t)}v2OnUpdateFriendInfoHandler(e){var{data:t}=e.content,n=this.model.upsertFriend(t.accountId,t);this.emit("onFriendInfoChanged",this.computedField(n))}v2SyncFriendListHandler(e){var{friends:t,timetag:n}=e.content;this.model.setFriendTimetag(n),t.forEach(e=>{e.serverExtension||(e.serverExtension=""),e.customerExtension||(e.customerExtension=""),0===e.relationShip?this.model.deleteFriend(e.accountId):this.model.upsertFriend(e.accountId,e)})}v2SyncFriendUserListHandler(e){var{users:t}=e.content;this.hasUserService&&t.forEach(e=>{this.core.V2NIMUserService.model.setUser(e)})}handleApplyFriend(e){this.emit("onFriendAddApplication",e)}handleAddFriend(e,t){return Ce(this,void 0,void 0,function*(){this.model.addFriend(e),yield this.incrementSyncFriend(),yield this.core.V2NIMUserService.refreshUserInfo(e);var t=this.model.getFriend(e);t&&this.emit("onFriendAdded",this.computedField(t))})}handleDeleteFriend(e,t){t=void 0===t?1:t,this.emit("onFriendDeleted",e,t),this.model.deleteFriend(e)}handleSetFriendInfo(e,t){var n=this.model.upsertFriend(e,t);this.emit("onFriendInfoChanged",this.computedField(n))}handlePassFriendApply(e,t){var n=t?null==t?void 0:t.code:200;if(!(n>=19e4||n===le.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===n||n===le.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.notificationModel.updateFriendAddApplicationStatus(e,1,this.core.account),this.handleAddFriend(e);else{if(n>=500&&n<=599&&509!==n)return;this.notificationModel.updateFriendAddApplicationStatus(e,3,this.core.account)}}handleRejectFriendApply(e,t){var n=t?null==t?void 0:t.code:200;if(!(n>=19e4||n===le.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===n)this.emit("onFriendAddRejected",e),this.notificationModel.updateFriendAddApplicationStatus(e.applicantAccountId,2,this.core.account);else if(n===le.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.notificationModel.updateFriendAddApplicationStatus(e.applicantAccountId,1,this.core.account);else{if(n>=500&&n<=599&&509!==n)return;this.notificationModel.updateFriendAddApplicationStatus(e.applicantAccountId,3,this.core.account)}}incrementSyncFriend(){return Ce(this,void 0,void 0,function*(){var e=yield this.core.sendCmd("v2IncFriendInfo",{timetag:this.model.getFriendTimetag()}),{friends:t,timetag:n}=e.content;this.model.setFriendTimetag(n),t.forEach(e=>{this.model.upsertFriend(e.accountId,e)})})}computedFields(e){return e.map(e=>this.computedField(e))}computedField(e){var t,n,r=null===(n=null===(t=this.core.V2NIMUserService)||void 0===t?void 0:t.model)||void 0===n?void 0:n.getUser(e.accountId);return r?Object.assign({},e,{userProfile:r}):e}},"V2NIMFriendService"),yt.registerService(class extends An{constructor(e){super("V2NIMSettingService",e),this.needToPushMobileOnDesktopOnline=!0,this.core._registerDep(Wc,"V2NIMConversationIdUtil"),this.push=new ah(e,this),this.mute=new ch(e,this),this.event=new lh(e,this),this.handler=new sh(e,this),"v2"===this.core.options.apiVersion&&(this.setListener(),Gt({cmdMap:rh,cmdConfig:oh}))}get hasUserService(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}get hasTeamService(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}setListener(){this.event.setListener()}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;return this.logger.log(`${n}`,...t),super.emit(e,...t)}getConversationMuteStatus(e){return this.mute.getConversationMuteStatus(e)}setTeamMessageMuteMode(e,t,n){if(!this.hasTeamService)throw new pe({code:le.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"setTeamMessageMuteMode: no team service"}});return this.checkV2(),Te(ap,{teamId:e},"",!0),Te(lp,{teamType:t},"",!0),Te(Qp,{muteMode:n},"",!0),this.mute.setTeamMessageMuteMode(e,t,n)}getTeamMessageMuteMode(e,t){return this.mute.getTeamMessageMuteMode(e,t)}getAllTeamMessageMuteMode(e){return this.checkV2(),this.checkLogin(),Te(lp,{teamType:e},"",!0),this.mute.getAllTeamMessageMuteMode(e)}setP2PMessageMuteMode(e,t){if(this.checkV2(),Te(Zp,{accountId:e,muteMode:t},"",!0),e===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"can not set mute mode for self"}});return this.mute.setP2PMessageMuteMode(e,t)}getP2PMessageMuteMode(e){return Te({accountId:{type:"string",required:!0,allowEmpty:!1}},{accountId:e},"",!0),this.mute.getP2PMessageMuteMode(e)}getP2PMessageMuteList(){return this.mute.getP2PMessageMuteList()}setAppBackground(e,t){return this.checkV2(),Te({isBackground:{type:"boolean"},badge:{type:"number",required:!1}},{isBackground:e,badge:t},"",!0),this.push.setAppBackground(e,t)}setOfflinePushConfig(e,t){Te(th,{config:t},"",!0),this.push.setOfflinePushConfig(e,t)}setPushMobileOnDesktopOnline(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te({need:{type:"boolean",required:!1}},{need:e},"",!0),e=void 0===e||e,yield this.core.sendCmd("v2SetPushMobileOnDesktopOnline",{tag:{need:e}}),this.needToPushMobileOnDesktopOnline=e,this.emit("onPushMobileOnDesktopOnline",e)})}getPushMobileOnDesktopOnline(){return this.checkLogin(),Promise.resolve(this.needToPushMobileOnDesktopOnline)}},"V2NIMSettingService"),yt.registerService(class extends An{constructor(e){super("V2NIMSyncService",e),this.teamKey=["teams","superTeams","myTeamMembers","mySuperTeamMembers"],this.config={},this.timetags={},"v2"===this.core.options.apiVersion&&(this.initEventListeners(),Gt({cmdMap:dh,cmdConfig:uh}),this.setListener())}reset(){this.timetags={}}setListener(){this.core.eventBus.on("V2NIMSync/updateTimetag",e=>{Object.keys(e).forEach(t=>{e[t]>(this.timetags[t]||0)&&(this.timetags[t]=e[t])})})}setOptions(e){var t=this.core,n=!(!t.V2NIMConversationService.name&&!t.V2NIMLocalConversationService.name);return this.config=Object.assign({myInfo:!!t.V2NIMUserService.name,offlineMsgs:!!t.V2NIMMessageService.name,roamingMsgs:!!t.V2NIMMessageService.name,relations:!!t.V2NIMUserService.name,friends:!!t.V2NIMFriendService.name,friendUsers:!!t.V2NIMUserService.name,msgReceipts:!!t.V2NIMMessageService.name,broadcastMsgs:!!t.V2NIMNotificationService.name,recallMsg:!!t.V2NIMMessageService.name,sessionAck:n,superTeamSessionAck:n,stickTopSessions:n,superTeamRoamingMsgs:!!t.V2NIMTeamService.name,deleteSuperTeamMsg:!!t.V2NIMTeamService.name,deleteSelfMsgs:!!t.V2NIMMessageService.name,sessionHistoryMsgsDelete:!!t.V2NIMMessageService.name,avSignal:!!t.V2NIMSignallingService.name,teams:!!t.V2NIMTeamService.name,superTeams:!!t.V2NIMTeamService.name,myTeamMembers:!!t.V2NIMTeamService.name,mySuperTeamMembers:!!t.V2NIMTeamService.name,donnop:!!t.V2NIMSettingService.name,p2pTeamModifyMessage:!!t.V2NIMMessageService.name,superTeamModifyMessage:!!t.V2NIMMessageService.name},e),this.config}doBasicSync(){return Ce(this,void 0,void 0,function*(){var e=Object.keys(this.config).filter(e=>!this.teamKey.includes(e)&&this.config[e]),t=this.genSyncParams(e);this.logger.log("V2Sync:basic",t);var n=(yield this.core.clientSocket.sendCmd("v2NIMSync",{tag:t})).content.timetag;this.setTimetags(n,e.filter(e=>"broadcastMsgs"!==e)),yield this.delaySyncDone(),yield this.handleImmediate(),this.core.logger.log("sync::basic sync complete in",n)})}doTeamSync(){return Ce(this,void 0,void 0,function*(){var e=this.teamKey.filter(e=>this.config[e]);if(0!==e.length){var t=this.genSyncParams(e);this.core.eventBus.emit("V2NIMTeamService/onSyncStarted"),this.logger.log("V2Sync:team",t);var n=null;try{n=yield this.core.clientSocket.sendCmd("v2NIMSync",{tag:t})}catch(i){throw this.core.eventBus.emit("V2NIMTeamService/onSyncFailed",i),i}this.core.eventBus.emit("V2NIMTeamService/onSyncFinished");var r=n.content.timetag;this.setTimetags(r,this.teamKey),this.core.logger.log("sync::team sync complete in",r)}})}doQchatSync(){return Ce(this,void 0,void 0,function*(){var e=yield this.core.clientSocket.sendCmd("v2QChatSync",{tag:{systemNotification:0}});this.core.logger.log("sync::qchat sync complete in",e.content.timetag)})}doSync(){return Ce(this,void 0,void 0,function*(){var e=Ve(this.core,"V2NIMLoginService.authenticator.loginClientOfThisConnection.loginType");if(void 0!==e){if(this.logger.log(`sync::doSync:type ${e}`),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:2,subType:"mainSync"}),1===e)try{yield this.doBasicSync(),yield this.doTeamSync()}catch(t){return void this.doSyncComplete(t)}else if(2===e)try{yield this.doQchatSync()}catch(t){return void this.doSyncComplete(t)}else{if(3!==e)return;try{yield this.doBasicSync(),yield this.doTeamSync(),yield this.doQchatSync()}catch(t){return void this.doSyncComplete(t)}}this.doSyncComplete()}else this.logger.warn("sync::doSync: no loginType, stop sync")})}doSyncComplete(e){e&&this.core.logger.log("sync::doSync complete but got error",e),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:e,subType:"mainSync"})}initEventListeners(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.doSync()})}genSyncParams(e){return e.reduce((e,t)=>{var n=t;return e[n]=this.timetags[n]||0,e},{})}setTimetags(e,t){t.forEach(t=>{this.timetags[t]=e})}handleImmediate(){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),Promise.resolve()}delaySyncDone(){var{hostEnvEnum:e}=we.getSystemInfo();return 102===e?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new Promise(e=>{setTimeout(()=>{e()},100)})):Promise.resolve()}},"V2NIMSyncService"),yt.registerService(class extends An{constructor(e){super("V2NIMAIService",e),this.model=new ph,this.event=new Eh(this.core,this),this.handler=new Mh(this.core,this),Gt({cmdMap:gh,cmdConfig:Sh})}setListener(){this.event.setListener()}reset(){this.model.reset()}emit(e,...t){return this.event.beforeEmit(e,...t),super.emit(e,...t)}getAIUserList(){return Ce(this,void 0,void 0,function*(){return this.checkV2(),(yield this.core.sendCmd("v2AIGetUserList",{tag:{}})).content.datas})}proxyAIModelCall(e){return Ce(this,void 0,void 0,function*(){if(Te(Yc,e,"",!0),this.model.getAiStream(e.requestId))throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,desc:"Same requestId",detail:{rawData:e.requestId}});this.model.setAiStream(e.requestId,{isComplete:!1,queryStatus:0,chunks:[]},!0),yield this.core.sendCmd("v2AIProxyModelCall",{tag:e})})}stopAIModelStreamCall(e){return Ce(this,void 0,void 0,function*(){Te(Jc,e,"",!0),yield this.core.sendCmd("v2AIStopModelStreamCall",{tag:{clientId:e.requestId,aiAccount:e.accountId,type:4,from:this.core.account}}),this.logger.log(`V2AI::streamCallStop,requestId:${e.requestId}`),this.model.completeAiStream(e.requestId)})}_queryAiStream(e){return Ce(this,void 0,void 0,function*(){this.model.setAiStream(e.clientId,{queryStatus:1});try{var t=yield this.core.sendCmd("v2AIStreamQuery",{tag:e});this.model.setAiStream(e.clientId,{queryStatus:2});var n=t.content.datas;if(!(n&&n.length>0))return;n.forEach(e=>{var t=e.clientId,n=this.model.getAiStream(t);if(n&&(!n||!n.isComplete)&&e.content&&e.content.lastChunk){var r=e.content.lastChunk;this.model.upsertAiStreamChunks(t,r.index,r.content),0===r.index&&e.aiRAGs&&this.model.setAiStream(t,{aiRAGs:e.aiRAGs}),this.logger.log(`V2AI::queryAiStream requestId:${t};index:${r.index};cacheChunkLength:${n.chunks.length};chunkTime:${r.chunkTime}.`)}})}catch(r){this.logger.warn(`V2AI::queryAiStream requestId:${e.clientId};error:`,r),this.model.setAiStream(e.clientId,{queryStatus:2})}})}},"V2NIMAIService"),yt.registerService(class{constructor(e){this.name="DataStructureConverter",this.core=e}messageConvertToV1(e){var t,n=qt(jt(e,ld),Wt(fi)),r=ei(n,this.core.account),i=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:r});return ni(n,i?{account:this.core.account,sessionAck:i.ack,msgReceiptTime:i.msgReceiptTime}:{account:this.core.account})}messageConvertToV2(e){var t=qt(jt(si(e,e.from,e.fromDeviceId),fi),dd);return(t=Jl(this.core,t)).sendingState="sending"===e.status?3:"sendFailed"===e.status?2:1,t}},"DataStructureConverter"),yt.registerService(class{constructor(e){this.name="V2NIMMessageConverter",this.core=e}messageSerialization(e){if(!e)return null;var t=jt(e,ld);return JSON.stringify(t)}messageDeserialization(e){var t,n,r,i,o,s,a,c,l,d,u,p,h,g,m,f,v,y,_,I,T,S,E;if(!e)return null;try{var M=qt(JSON.parse(e),dd);return M.sendingState=0,1!==M.conversationType||M.senderId!==this.core.account&&M.receiverId!==this.core.account?2===M.conversationType?M.conversationId=this.core.V2NIMConversationIdUtil.teamConversationId(M.receiverId):3===M.conversationType&&(M.conversationId=this.core.V2NIMConversationIdUtil.superTeamConversationId(M.receiverId)):M.conversationId=this.core.V2NIMConversationIdUtil.p2pConversationId(M.senderId===this.core.account?M.receiverId:M.senderId),M.threadReply&&(M.threadReply.conversationType=M.conversationType,M.threadReply=Ql(this.core,M.threadReply)),M.threadRoot&&(M.threadRoot.conversationType=M.conversationType,M.threadRoot=Ql(this.core,M.threadRoot)),[1,3,2,0].includes(M.conversationType)||this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): ${M.conversationType}`),M.senderId&&"string"!=typeof M.senderId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): ${M.senderId}`),M.receiverId&&"string"!=typeof M.receiverId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): ${M.receiverId}`),"createTime"in M&&isNaN(M.createTime)&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): ${M.createTime}`),[2,7,12,100,6,1,-1,4,5,11,0,10,3].includes(M.messageType)||this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid messageType(enum): ${M.messageType}`),"subType"in M&&isNaN(M.subType)&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid subType(number): ${M.subType}`),M.messageClientId&&"string"!=typeof M.messageClientId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): ${M.messageClientId}`),M.messageServerId&&"string"!=typeof M.messageServerId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): ${M.messageServerId}`),M.attachment&&"object"!=typeof M.attachment&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid attachment(object): ${M.attachment}`),M.text&&"string"!=typeof M.text&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid text(string): ${M.text}`),M.serverExtension&&"string"!=typeof M.serverExtension&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid serverExtension(string): ${M.serverExtension}`),M.callbackExtension&&"string"!=typeof M.callbackExtension&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid callbackExtension(string): ${M.callbackExtension}`),(null===(t=M.pushConfig)||void 0===t?void 0:t.pushContent)&&"string"!=typeof M.pushConfig.pushContent&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid pushContent(string): ${M.pushConfig.pushContent}`),(null===(n=M.pushConfig)||void 0===n?void 0:n.pushPayload)&&"string"!=typeof M.pushConfig.pushPayload&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid pushPayload(string): ${M.pushConfig.pushPayload}`),(null===(r=M.pushConfig)||void 0===r?void 0:r.forcePushContent)&&"string"!=typeof M.pushConfig.forcePushContent&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushContent(string): ${M.pushConfig.forcePushContent}`),(null===(i=M.pushConfig)||void 0===i?void 0:i.forcePushAccountIds)&&!Array.isArray(M.pushConfig.forcePushAccountIds)&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushAccountIds(array): ${M.pushConfig.forcePushAccountIds}`),(null===(o=M.routeConfig)||void 0===o?void 0:o.routeEnvironment)&&"string"!=typeof M.routeConfig.routeEnvironment&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid routeEnvironment(string): ${M.routeConfig.routeEnvironment}`),(null===(s=M.antispamConfig)||void 0===s?void 0:s.antispamBusinessId)&&"string"!=typeof M.antispamConfig.antispamBusinessId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid antispamBusinessId(string): ${M.antispamConfig.antispamBusinessId}`),(null===(a=M.antispamConfig)||void 0===a?void 0:a.antispamCustomMessage)&&"string"!=typeof M.antispamConfig.antispamCustomMessage&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCustomMessage(string): ${M.antispamConfig.antispamCustomMessage}`),(null===(c=M.antispamConfig)||void 0===c?void 0:c.antispamCheating)&&"string"!=typeof M.antispamConfig.antispamCheating&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCheating(string): ${M.antispamConfig.antispamCheating}`),(null===(l=M.antispamConfig)||void 0===l?void 0:l.antispamExtension)&&"string"!=typeof M.antispamConfig.antispamExtension&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid antispamExtension(string): ${M.antispamConfig.antispamExtension}`),(null===(d=M.robotConfig)||void 0===d?void 0:d.accountId)&&"string"!=typeof M.robotConfig.accountId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid accountId(string): ${M.robotConfig.accountId}`),(null===(u=M.robotConfig)||void 0===u?void 0:u.topic)&&"string"!=typeof M.robotConfig.topic&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid topic(string): ${M.robotConfig.topic}`),(null===(p=M.robotConfig)||void 0===p?void 0:p.function)&&"string"!=typeof M.robotConfig.function&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid function(string): ${M.robotConfig.function}`),(null===(h=M.robotConfig)||void 0===h?void 0:h.customContent)&&"string"!=typeof M.robotConfig.customContent&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid customContent(string): ${M.robotConfig.customContent}`),(null===(g=M.threadRoot)||void 0===g?void 0:g.senderId)&&"string"!=typeof M.threadRoot.senderId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): ${M.threadRoot.senderId}`),(null===(m=M.threadRoot)||void 0===m?void 0:m.receiverId)&&"string"!=typeof M.threadRoot.receiverId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): ${M.threadRoot.receiverId}`),(null===(f=M.threadRoot)||void 0===f?void 0:f.messageClientId)&&"string"!=typeof M.threadRoot.messageClientId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): ${M.threadRoot.messageClientId}`),(null===(v=M.threadRoot)||void 0===v?void 0:v.messageServerId)&&"string"!=typeof M.threadRoot.messageServerId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): ${M.threadRoot.messageServerId}`),M.threadRoot&&"createTime"in M.threadRoot&&isNaN(M.threadRoot.createTime)&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): ${M.threadRoot.createTime}`),M.threadRoot&&![1,3,2,0].includes(M.threadRoot.conversationType)&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): ${M.threadRoot.conversationType}`),(null===(y=M.threadRoot)||void 0===y?void 0:y.conversationId)&&"string"!=typeof M.threadRoot.conversationId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): ${M.threadRoot.conversationId}`),(null===(_=M.threadReply)||void 0===_?void 0:_.senderId)&&"string"!=typeof M.threadReply.senderId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): ${M.threadReply.senderId}`),(null===(I=M.threadReply)||void 0===I?void 0:I.receiverId)&&"string"!=typeof M.threadReply.receiverId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): ${M.threadReply.receiverId}`),(null===(T=M.threadReply)||void 0===T?void 0:T.messageClientId)&&"string"!=typeof M.threadReply.messageClientId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): ${M.threadReply.messageClientId}`),(null===(S=M.threadReply)||void 0===S?void 0:S.messageServerId)&&"string"!=typeof M.threadReply.messageServerId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): ${M.threadReply.messageServerId}`),M.threadReply&&"createTime"in M.threadReply&&isNaN(M.threadReply.createTime)&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): ${M.threadReply.createTime}`),M.threadReply&&![1,3,2,0].includes(M.threadReply.conversationType)&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): ${M.threadReply.conversationType}`),(null===(E=M.threadReply)||void 0===E?void 0:E.conversationId)&&"string"!=typeof M.threadReply.conversationId&&this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): ${M.threadReply.conversationId}`),delete M.__clientExt,delete M.userUpdateTime,M}catch(b){return this.core.logger.error(`V2NIMMessageConverterImpl.messageDeserialization: invalid message string: ${e}`),null}}},"V2NIMMessageConverter"),yt.registerService(class extends An{constructor(e){super("V2NIMMessageLogUtil",e),this.clearHistoryMessageFn=e=>{var t=td(this.core,e);this.emitClearHistoryMessage([t])},this.core=e,this.service=this.core.V2NIMMessageService,"v2"===this.core.options.apiVersion&&(Gt({cmdMap:$u,cmdConfig:ju}),this.setListener())}setListener(){this.core.eventBus.on("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",this.clearHistoryMessageFn)}getMessageListByRefers(e){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te(cl,{messageRefers:e},"",!0),0===e.length)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageListByRefers: messageRefers cannot be an empty array"}});var t=[],n=e.map(e=>{var n=this.service.model.getMessageById(e.messageClientId);return!n&&e.messageServerId&&"0"!==e.messageServerId&&t.push(e),n}),r=[];if(t.length>0){var i=yield this.core.sendCmd("v2GetMessageListByRefers",{tag:t});r=i.content.msgs}return n.map((t,n)=>{if(t)return t;var i=e[n],o=r.find(e=>e.messageServerId===i.messageServerId);return o?Jl(this.core,o):void 0}).filter(e=>void 0!==e&&!this.service._filterMessage(e))})}getMessageList(e){var t;return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(sl,e,"",!0),Ee(this.core.account,e.conversationId);var n=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),r=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),i=1===n?"v2GetMessageList":2===n?"v2GetTeamMessageList":"v2GetSuperTeamMessageList",o=e.beginTime||0,s=e.endTime||0;if(0!==o&&0!==s&&o>s)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: beginTime cannot be greater than endTime"}});var a=void 0===e.direction?0:e.direction;if(e.anchorMessage)if(0===a){if(0===s)s=e.anchorMessage.createTime;else if(s!==e.anchorMessage.createTime)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorMessage.createTime"}})}else if(0===o)o=e.anchorMessage.createTime;else if(o!==e.anchorMessage.createTime)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorMessage.createTime"}});var c=null===(t=e.anchorMessage)||void 0===t?void 0:t.messageServerId,l=yield this.core.sendCmd(i,{beginTime:o,endTime:s,lastMsgId:c||0,limit:e.limit||50,direction:a,msgTypes:e.messageTypes?e.messageTypes.slice():[],to:r}),{content:d}=l,u=d.msgs.map(e=>Jl(this.core,e));return c&&(u=u.filter(e=>e.messageServerId!==c)),this.getMessageListMonkeyPatch(u,e)})}getMessageListMonkeyPatch(e,t){var n=t.conversationId,r=e,i=r.reduce((e,t)=>(e[t.messageClientId]=!0,e),{}),o=this.service.model.getMessagesByConversationId(n);o=o.sort((e,n)=>1===t.direction?e.createTime-n.createTime:n.createTime-e.createTime);var s=0,a=t.beginTime||0,c=t.endTime||0;t.anchorMessage&&(0===t.direction?c=t.anchorMessage.createTime:a=t.anchorMessage.createTime,s=o.findIndex(e=>{var n;return e.messageClientId===(null===(n=t.anchorMessage)||void 0===n?void 0:n.messageClientId)}),s+=1);for(var l=s;l<o.length;l++){var d=o[l],u=!i[d.messageClientId],p=void 0===d.sendingState||1===d.sendingState,h=d.conversationId===n,g=d.createTime>a&&(d.createTime<c||0===c),m=!t.messageTypes||t.messageTypes.includes(d.messageType);u&&p&&h&&g&&m&&r.push(o[l])}return(r=r.sort((e,n)=>1===t.direction?e.createTime-n.createTime:n.createTime-e.createTime)).slice(0,t.limit||50)}clearHistoryMessage(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(ul,e,"",!0),Ee(this.core.account,e.conversationId);var{conversationId:t,deleteRoam:n,onlineSync:r,serverExtension:i}=e,o=this.core.V2NIMConversationIdUtil.parseConversationType(t),s=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t),a={deleteRoam:n,onlineSync:r,serverExtension:i,conversationType:o};1===o?a.receiverId=s:a.teamId=s;var c=this.core.timeOrigin.getNTPTime();e.clearMode=e.clearMode||0,0===e.clearMode&&(c=(yield this.core.sendCmd("v2ClearHistoryMessage",{tag:a})).content.timetag),2===e.clearMode&&we.localStorage.setItem(`nim_${this.core.account}_${t}_clearTime`,c.toString()),this.core.eventBus.emit("forwardSend/V2NIMMessageLogService/clearHistoryMessage",Object.assign(Object.assign({},a),{deleteTime:c})),this.emitClearHistoryMessage([{deleteTime:c,serverExtension:i,conversationId:t}])})}clearRoamingMessage(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},void 0,!0);var t=[];try{t=e.map(e=>{var t=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e);return Wd(this.core.V2NIMConversationIdUtil.parseConversationType(e),t)})}catch(n){throw this.logger.error(`V2NIMMessage::clearRoamingMessage with ${e}`,n),new pe({code:le.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:"Failed to create session",rawData:`${e}`}})}yield this.core.sendCmd("v2ClearRoamingMessage",{conversationIds:t})})}syncClearHistoryMessageHandler(e){var t=e.content.data.map(e=>td(this.core,e));this.emitClearHistoryMessage(t)}onClearHistoryMessageHandler(e){var t=td(this.core,e.content.data);this.emitClearHistoryMessage([t])}emitClearHistoryMessage(e){e.forEach(e=>{this.service.model.deleteMessages(e.conversationId,e.deleteTime),this.core.eventBus.emit("V2NIMSync/updateTimetag",{sessionHistoryMsgsDelete:e.deleteTime})}),this.core.eventBus.emit("V2NIMMessageLogUtil/onClearHistoryNotifications",e),this.service.emit("onClearHistoryNotifications",e)}},"V2NIMMessageLogUtil"),yt.registerService(class extends An{constructor(e){super("V2NIMMessageExtendUtil",e),this.core=e,this.service=this.core.V2NIMMessageService,"v2"===this.core.options.apiVersion&&Gt({cmdMap:Gu,cmdConfig:Zu})}pinMessage(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(al,e,"message",!0),Te(pl,{serverExtension:t},"",!0);var n=yield this.core.sendCmd("v2PinMessage",{msg:e,msgPin:{serverExtension:t}});this.emitPinNotification({pinState:1,message:e,serverExtension:t,createTime:n.content.timetag,updateTime:n.content.timetag,operatorId:this.core.account})})}unpinMessage(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(al,e,"messageRefer",!0),Te(pl,{serverExtension:t},"",!0);var n=yield this.core.sendCmd("v2UnpinMessage",{msg:e,msgPin:{serverExtension:t}});this.emitPinNotification({pinState:0,message:e,serverExtension:t,updateTime:n.content.timetag,operatorId:this.core.account})})}updatePinMessage(e,t){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(al,e,"message",!0),Te(pl,{serverExtension:t},"",!0);var n=yield this.core.sendCmd("v2UpdatePinMessage",{msg:e,msgPin:{serverExtension:t}});this.emitPinNotification({pinState:2,message:e,serverExtension:t,updateTime:n.content.timetag,operatorId:this.core.account})})}getPinnedMessageList(e){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),!this.core.V2NIMConversationIdUtil||!this.core.V2NIMConversationIdUtil.parseConversationType)throw new Error('Service "V2NIMConversationService" does not exist');Ee(this.core.account,e);var t=this.core.V2NIMConversationIdUtil.convertToV1ConversationId(e);return t=t.replace("superTeam","super_team"),(yield this.core.sendCmd("v2GetPinMessageList",{tag:{conversationId:t,timetag:0}})).content.data.map(e=>Object.assign(Object.assign({},e),{messageRefer:Object.assign(Object.assign({},e.messageRefer),{conversationId:this.core.V2NIMConversationIdUtil.messageConversationId(e.messageRefer)})})).sort((e,t)=>t.updateTime-e.updateTime)})}addQuickComment(e,t,n,r){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(fl,{message:e,index:t,serverExtension:n,pushConfig:r},"",!0);var i=yield this.core.sendCmd("v2AddQuickComment",{message:e,quickComment:{index:t,serverExtension:n,pushConfig:r}}),o={operationType:1,quickComment:{messageRefer:Zl(this.core,e),createTime:i.content.timetag,index:t,serverExtension:n||"",operatorId:this.core.account}};this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",o)})}removeQuickComment(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(al,e,"messageRefer",!0),Te({index:{type:"number",min:1}},{index:t},"",!0),Te({serverExtension:{type:"string",required:!1}},{serverExtension:n},"",!0);var r=yield this.core.sendCmd("v2RemoveQuickComment",{message:e,quickComment:{index:t,serverExtension:n}}),i={operationType:2,quickComment:{messageRefer:Zl(this.core,e),createTime:r.content.timetag,index:t,serverExtension:n||"",operatorId:this.core.account}};this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",i)})}getQuickCommentList(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(vl,{messages:e},"",!0);var t={};return(yield this.core.sendCmd("v2GetQuickComment",{tag:e.map(e=>({messageRefer:e}))})).content.data.forEach(e=>{var n,r;try{if(!e.detail)return void(t[n=e.messageRefer.messageClientId]||(t[n]=[]));var i=JSON.parse(e.detail);t[r=e.messageRefer.messageClientId]||(t[r]=[]),i.forEach(n=>{t[e.messageRefer.messageClientId].push({messageRefer:Object.assign(Object.assign({},e.messageRefer),{conversationId:this.core.V2NIMConversationIdUtil.messageConversationId(e.messageRefer)}),operatorId:n[1],index:parseInt(n[2]),createTime:parseInt(n[3]),serverExtension:n[4]})})}catch(o){this.logger.error("getQuickCommentList JSON Parse Error",e.detail,o)}}),t})}voiceToText(e){return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te(ml,e,"",!0),!e.voicePath&&!e.voiceUrl&&!e.file)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"voiceToText: voicePath、voiceUrl、file cannot be empty at the same time"}});var{voicePath:t,file:n,mimeType:r,sampleRate:i,duration:o,sceneName:s}=e,a=s?this.core.V2NIMStorageService.getStorageScene(s):null,c=e.voiceUrl;if(!c){var l={};n?l.file=n:0===(null==t?void 0:t.indexOf("nim-external"))?l.fileInput=t:l.filePath=t,c=(yield this.core.cloudStorage.uploadFile(Object.assign({type:"audio",nosScenes:a?a.sceneName:void 0,nosSurvivalTime:a?a.expireTime:void 0},l))).url}return(yield this.core.sendCmd("v2VoiceToText",{tag:{voiceUrl:c,mimeType:r,sampleRate:i,duration:o}},{timeout:3e4})).content.data})}onPinMessageHandler(e){return this.pinMessageChangeHandler(e,1)}onUnpinMessageHandler(e){return this.pinMessageChangeHandler(e,0)}onUpdatePinMessageHandler(e){return this.pinMessageChangeHandler(e,2)}pinMessageChangeHandler(e,t){var n=e.content.msg,r=e.content.pinInfo;n.conversationId=this.core.V2NIMConversationIdUtil.messageConversationId(n),this.emitPinNotification({pinState:t,message:n,serverExtension:r.serverExtension,createTime:r.createTime,updateTime:r.updateTime,operatorId:r.accid})}emitPinNotification(e){var t={pinState:e.pinState,pin:Object.assign(Object.assign({serverExtension:e.serverExtension||"",operatorId:e.operatorId},e.createTime?{createTime:e.createTime}:{}),{updateTime:e.updateTime,messageRefer:Zl(this.core,e.message)})};this.core.V2NIMMessageService.emit("onMessagePinNotification",t)}onAddQuickCommentHandler(e){return this.onQuickCommentNotificationHandler(e,1)}onRemoveQuickCommentHandler(e){return this.onQuickCommentNotificationHandler(e,2)}onQuickCommentNotificationHandler(e,t){var n={operationType:t,quickComment:Object.assign({messageRefer:Object.assign(Object.assign({},e.content.message),{conversationId:this.core.V2NIMConversationIdUtil.messageConversationId(e.content.message)})},e.content.quickComment)};this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",n)}addCollection(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),Te(yl,{params:e},"",!0),(yield this.core.sendCmd("v2AddCollection",{tag:e})).content.data})}removeCollections(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),Te(_l,{collections:e},"",!0),(yield this.core.sendCmd("v2RemoveCollections",{tag:e})).content.data})}updateCollectionExtension(e,t){return Ce(this,void 0,void 0,function*(){return this.checkV2(),Te(Il,{collection:e,serverExtension:t},"",!0),(yield this.core.sendCmd("v2UpdateCollectionExtension",{tag:Object.assign(Object.assign({},e),{serverExtension:t})})).content.data})}getCollectionListByOption(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),Te(Tl,e,"",!0),(yield this.getCollectionListExByOption(e)).collectionList})}getCollectionListExByOption(e){var t,n;return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(Tl,e,"",!0);var r=e.beginTime||0,i=e.endTime||0,o=void 0===e.direction?0:e.direction;if(void 0!==(null===(t=e.anchorCollection)||void 0===t?void 0:t.collectionId))if(0===e.direction){if(0===i)i=e.anchorCollection.createTime;else if(i!==e.anchorCollection.createTime)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: When providing anchorCollection, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorCollection.createTime"}})}else if(0===r)r=e.anchorCollection.createTime;else if(r!==e.anchorCollection.createTime)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: When providing anchorCollection, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorCollection.createTime"}});if(0!==r&&0!==i&&r>=i)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: beginTime cannot be greater than endTime"}});var s={beginTime:r,endTime:i,direction:o,limit:e.limit,collectionType:e.collectionType,excludeId:(null===(n=e.anchorCollection)||void 0===n?void 0:n.collectionId)?e.anchorCollection.collectionId:0};s.collectionType||delete s.collectionType;var a=yield this.core.sendCmd("v2GetCollectionListByOption",{tag:s});return{totalCount:a.content.total,collectionList:a.content.data}})}searchCloudMessages(e){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(Sl,e,"",!0);var t=e.beginTime||0,n=e.endTime||0;if(0!==t&&0!==n&&t>n)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchCloudMessages: beginTime cannot be greater than endTime"}});var r=void 0===e.sortOrder?0:e.sortOrder,i=e.conversationLimit||0,o=e.messageLimit||10,s=i>0?"v2SearchCloudMessagesGroupByConversation":"v2SearchCloudMessages",a=yield this.core.sendCmd(s,{tag:Object.assign(Object.assign({},e),{beginTime:t,endTime:n,sortOrder:r,conversationLimit:i,messageLimit:o})});return this.service._filterMessagesByFn(a.content.data.map(e=>Jl(this.core,e)))})}searchCloudMessagesEx(e){var t,n,r;return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te(El,e,"",!0),e.conversationId&&Ee(this.core.account,e.conversationId),!(null===(t=e.keywordList)||void 0===t?void 0:t.length)&&!(null===(n=e.senderAccountIds)||void 0===n?void 0:n.length)&&!(null===(r=e.messageTypes)||void 0===r?void 0:r.length))throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchCloudMessagesEx: keywordList senderAccountIds messageTypes cannot be empty at the same time"}});0===e.searchTimePeriod&&delete e.searchTimePeriod;var i=yield this.core.sendCmd("v2SearchCloudMessagesEx",{tag:Object.assign({},e)}),{msgs:o,hasMore:s,nextPageToken:a}=i.content,c=this.service._filterMessagesByFn(o.map(e=>Jl(this.core,e))).sort((e,t)=>t.createTime-e.createTime);return{count:o.length,items:rd(this.core,c),hasMore:Kt(s),nextPageToken:a}})}getThreadMessageList(e){return Ce(this,void 0,void 0,function*(){if(Te(Nl,e,"getThreadMessageList",!0),e.beginTime=e.beginTime||0,e.endTime&&e.beginTime>e.endTime)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getThreadMessageList: beginTime cannot be greater than endTime"}});var t=yield this.core.sendCmd("v2GetThreadMessageList",{messageRefer:e.messageRefer,tag:{beginTime:e.beginTime,endTime:e.endTime,limit:e.limit,reverse:1===e.direction?1:0,excludeMessageServerId:e.excludeMessageServerId}}),{message:n,replyResult:r,replyList:i}=t.content,o=Jl(this.core,n),s=i.map(e=>Jl(this.core,e));return s=this.service._filterMessagesByFn(s),s=this.service._filterMessageByClearTime(o.conversationId,s),{message:o,timestamp:r.timestamp,replyCount:r.total,replyList:s}})}},"V2NIMMessageExtendUtil"),yt.registerService(class extends An{constructor(e,t={}){super("V2NIMSignallingService",e),this.config={compatibleWithV1:!0},this.channels={},this.timer=0,this.pollingInterval=12e4,"v2"===this.core.options.apiVersion&&(Gt({cmdMap:bh,cmdConfig:Rh}),this.setOptions(t))}reset(){this.timer=0,this.channels={}}setOptions(e){var t;(null===(t=this.core.signaling)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=Object.assign(this.config,e)}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;return this.logger.log(`${n}`,...t),super.emit(e,...t)}call(e){var t;return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te(Nh,e,"",!0),e.calleeAccountId===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"You cannot call yourself"}});var n=void 0!==e.pushConfig&&void 0!==e.pushConfig.pushEnabled&&e.pushConfig.pushEnabled,r=(yield this.core.sendCmd("v2SignallingCall",{tag:Object.assign(Object.assign({},e),{toAccid:e.calleeAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled,pushConfig:Object.assign(Object.assign({},e.pushConfig||{}),{pushEnabled:n})})})).content.data;return this.channels[r.channelInfo.channelId]=Di(r.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(this.aotoDelay.bind(this),this.pollingInterval,-1)),{callStatus:r.callStatus,rtcInfo:r.rtcInfo,roomInfo:{channelInfo:r.channelInfo,members:r.members}}})}callSetup(e){var t;return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te(wh,e,"",!0),e.callerAccountId===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"callSetup: cannot be yourself"}});var n=(yield this.core.sendCmd("v2SignallingCallSetup",{tag:Object.assign(Object.assign({},e),{toAccid:e.callerAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled})})).content.data;return this.channels[n.channelInfo.channelId]=Di(n.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(this.aotoDelay.bind(this),this.pollingInterval,-1)),{callStatus:n.callStatus,rtcInfo:n.rtcInfo,roomInfo:{channelInfo:n.channelInfo,members:n.members}}})}createRoom(e,t,n){return Ce(this,void 0,void 0,function*(){return this.checkV2(),Te(Ph,{channelType:e,channelName:t,channelExtension:n},"",!0),(yield this.core.sendCmd("v2SignallingCreateRoom",{tag:{channelType:e,channelName:t,channelExtension:n}})).content.data.channelInfo})}delayRoom(e){return Ce(this,void 0,void 0,function*(){this.checkV2();var t=yield this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:e}});return{channelInfo:t.content.data.channelInfo,members:t.content.data.members}})}closeRoom(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(kh,{channelId:e,offlineEnabled:t,serverExtension:n},"",!0),yield this.core.sendCmd("v2SignallingCloseRoom",{tag:{channelId:e,offlineEnabled:void 0!==t&&t,serverExtension:n}})})}joinRoom(e){var t;return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(Lh,e,"",!0);var n=(yield this.core.sendCmd("v2SignallingJoinRoom",{tag:Object.assign(Object.assign({},e),{offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled})})).content.data;this.channels[n.channelInfo.channelId]=Di(n.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(this.aotoDelay.bind(this),this.pollingInterval,-1));var{channelInfo:r,members:i,rtcInfo:o}=n;return{roomInfo:{channelInfo:r,members:i},rtcInfo:o}})}leaveRoom(e,t,n){return Ce(this,void 0,void 0,function*(){this.checkV2(),Te(xh,{channelId:e,offlineEnabled:t,serverExtension:n},"",!0),yield this.core.sendCmd("v2SignallingLeaveRoom",{tag:{channelId:e,offlineEnabled:void 0!==t&&t,serverExtension:n}}),delete this.channels[e]})}invite(e){var t;return Ce(this,void 0,void 0,function*(){if(this.checkV2(),Te(Vh,e,"",!0),e.inviteeAccountId===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"invite: cannot be yourself"}});var n=void 0!==e.pushConfig&&void 0!==e.pushConfig.pushEnabled&&e.pushConfig.pushEnabled;return(yield this.core.sendCmd("v2SignallingInvite",{tag:Object.assign(Object.assign({},e),{toAccid:e.inviteeAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled,pushConfig:Object.assign(Object.assign({},e.pushConfig||{}),{pushEnabled:n})})})).content.data})}cancelInvite(e){return Ce(this,void 0,void 0,function*(){return this.checkV2(),Te(Dh,e,"",!0),(yield this.core.sendCmd("v2SignallingCancelInvite",{tag:Object.assign(Object.assign({},e),{toAccid:e.inviteeAccountId})})).content.data})}rejectInvite(e){return Ce(this,void 0,void 0,function*(){if(Te($h,e,"",!0),e.inviterAccountId===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"rejectInvite: cannot be yourself"}});yield this.core.sendCmd("v2SignallingRejectInvite",{tag:Object.assign(Object.assign({},e),{toAccid:e.inviterAccountId})})})}acceptInvite(e){return Ce(this,void 0,void 0,function*(){if(Te(Bh,e,"",!0),e.inviterAccountId===this.core.account)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"acceptInvite: cannot be yourself"}});yield this.core.sendCmd("v2SignallingAcceptInvite",{tag:Object.assign(Object.assign({},e),{toAccid:e.inviterAccountId})})})}sendControl(e,t,n){return Ce(this,void 0,void 0,function*(){Te(Uh,{channelId:e,receiverAccountId:t,serverExtension:n},"",!0),yield this.core.sendCmd("v2SignallingSendControl",{tag:{channelId:e,toAccid:t,serverExtension:n}})})}getRoomInfoByChannelName(e){return Ce(this,void 0,void 0,function*(){Te({channelName:{type:"string",allowEmpty:!1}},{channelName:e},"",!0);var t=yield this.core.sendCmd("v2SignallingGetRoomInfo",{tag:{channelName:e}}),{members:n,channelInfo:r}=t.content.data;return{channelInfo:r,members:n||[]}})}aotoDelay(){return Ce(this,void 0,void 0,function*(){var e=Object.keys(this.channels);if(0===e.length)return this.timer&&this.core.timerManager.deleteTimer(this.timer),void(this.timer=0);this.logger.log("v2Signlling:autoDelay",e);for(var t=0;t<e.length;t++){var n=e[t];try{var r=yield this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:n}});this.channels[n]=r.content.data.channelInfo}catch(i){this.logger.warn(`signling:autoDelay ${n} failed`,i),delete this.channels[n]}}})}v2SignallingOnlineEventHandler(e){var t=Ke(e,e.content.data,"msgId","0"),n=t.msgId;!this.config.compatibleWithV1&&n&&parseInt(n)&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:[n]}),this.handleLeaveRoom(t),this.emit("onOnlineEvent",Fh(t))}v2SignallingMultiClientEventHandler(e){this.handleLeaveRoom(e.content.data),this.emit("onMultiClientEvent",Fh(e.content.data))}v2SignallingOfflineEventHandler(e){if(e.content.datas&&e.content.datas.length>0){if(!this.config.compatibleWithV1){var t=e.content.datas.map(e=>e.msgId);t.length>0&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:t})}var n=e.content.datas.map(e=>(this.handleLeaveRoom(e),Fh(e)));this.emit("onOfflineEvent",n)}}v2SignallingSyncChannelsHandler(e){if(this.timer=0,this.channels={},e.content.datas&&e.content.datas.length>0){var t=e.content.datas;t.forEach(e=>{var t=e.channelInfo.channelId;this.channels[t]=Di(e.channelInfo)}),this.timer||(this.timer=this.core.timerManager.addTimer(this.aotoDelay.bind(this),this.pollingInterval,-1)),this.emit("onSyncRoomInfoList",t)}}handleLeaveRoom(e){switch(e.attach.type){case 1:case 7:case 9:delete this.channels[e.channelInfo.channelId]}}},"V2NIMSignallingService"),yt.registerService(class extends An{constructor(e){super("V2NIMSubscriptionService",e),"v2"===this.core.options.apiVersion&&Gt({cmdMap:qh,cmdConfig:zh})}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;return this.logger.log(`${n}`,...t),super.emit(e,...t)}subscribeUserStatus(e){return Ce(this,void 0,void 0,function*(){return this.checkLogin(),this.checkV2(),Te(Kh,e,"",!0),(yield this.core.sendCmd("v2SubscribeUserStatus",{tag:{eventType:1,duration:e.duration||60,immediateSync:void 0!==e.immediateSync&&e.immediateSync},accountIds:e.accountIds})).content.failedList})}unsubscribeUserStatus(e){return Ce(this,void 0,void 0,function*(){this.checkLogin(),this.checkV2(),Te(Yh,e,"",!0);var t=[];return e.accountIds.length>0?t=(yield this.core.sendCmd("v2UnsubscribeUserStatus",{tag:{eventType:1},accountIds:e.accountIds})).content.failedList:(yield this.core.sendCmd("v2UnsubscribeAllUserStatus",{tag:{eventType:1}}),t=[]),t})}publishCustomUserStatus(e){return Ce(this,void 0,void 0,function*(){return this.checkLogin(),this.checkV2(),Te(Jh,e,"",!0),(yield this.core.sendCmd("v2PublishEvent",{tag:Object.assign(Object.assign({},e),{eventType:1,uniqueId:Ue(),duration:e.duration||60,onlineOnly:void 0===e.onlineOnly||e.onlineOnly,multiSync:void 0!==e.multiSync&&e.multiSync})})).content.data})}queryUserStatusSubscriptions(e){return Ce(this,void 0,void 0,function*(){this.checkLogin(),this.checkV2(),Te({accountIds:{type:"array",required:!0,itemType:"string",max:3e3}},{accountIds:e},"",!0);var t=[];if(e.length>0)for(var n=0;n<e.length;n+=100){var r=yield this.core.sendCmd("v2QuerySubscribeEvent",{tag:{eventType:1},accountIds:e.slice(n,n+100)});t=t.concat(r.content.data.map(e=>({accountId:e.accountId,subscribeTime:e.subscribeTime,duration:e.duration})))}else{var i=yield this.core.sendCmd("v2QueryAllSubscribeEvent",{tag:{eventType:1}});t=t.concat(i.content.data.map(e=>({accountId:e.accountId,subscribeTime:e.subscribeTime,duration:e.duration})))}return t})}v2OnUserStatusChangeHandler(e){var t=e.content.data,{eventType:n,extensionReceived:r}=t,i=be(t,["eventType","extensionReceived"]);1===n?this.emit("onUserStatusChanged",[Object.assign(Object.assign({},i),{extension:r})]):this.logger.log("v2OnUserStatusChangeHandler eventType = ",n,"msgEvent = ",t)}v2OnMultiUserStatusChangeHandler(e){var t=e.content.data.filter(e=>1===e.eventType).map(e=>{var{eventType:t,extensionReceived:n}=e,r=be(e,["eventType","extensionReceived"]);return Object.assign(Object.assign({},r),{extension:n})});t.length>0&&this.emit("onUserStatusChanged",t)}},"V2NIMSubscriptionService"),yt.registerService(class extends An{constructor(e){super("V2NIMPassthroughService",e),Gt({cmdMap:Qh,cmdConfig:eg})}emit(e,...t){var n=`${this.name}::emit ${e.toString()}`;return this.logger.log(`${n}`,...t),super.emit(e,...t)}httpProxy(e){return Ce(this,void 0,void 0,function*(){if(Te(tg,e,"",!0),e.method===jh.V2NIM_PROXY_REQUEST_METHOD_GET&&e.body||e.method===jh.V2NIM_PROXY_REQUEST_METHOD_POST&&!e.body||e.method===jh.V2NIM_PROXY_REQUEST_METHOD_PUT&&!e.body)throw new pe({code:le.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:`method ${e.method}, incorrect body`}});return(yield this.core.sendCmd("v2ProxyRequest",{tag:e})).content.data})}v2ProxyOnRequestHandler(e){var{data:t}=e.content;this.emit("onProxyNotify",t)}},"V2NIMPassthroughService"),yt.registerService(xd,"YSFService"),yt.registerService(class extends Gs{constructor(e,t){super("qchatChannel",e),this.config={autoSubscribe:!1},this.core=e,Gt({cmdMap:Qs,cmdConfig:na()}),t&&this.setOptions(t),this.subscribeModuleService=new oc(e),this.subscribeForVisitorService=new sc(e),this.setListener()}setOptions(e){e&&(this.config=Object.assign(this.config,e))}setListener(){this.core.eventBus.on("logined",e=>{this.subscribeModuleService.resumeSubscribe(e.isAutoReconnect),this.subscribeForVisitorService.resumeSubscribe(e.isAutoReconnect),this.config.autoSubscribe&&(this.subscribeModuleService.autoSubscribeServerMap={},this.subscribeModuleService.autoSubscribeUnreadMap={},this.subscribeModuleService.autoSubscribe())}),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",e=>{this.subscribeModuleService.resumeSubscribe(e.isReconnect),this.subscribeForVisitorService.resumeSubscribe(e.isReconnect),this.config.autoSubscribe&&(this.subscribeModuleService.autoSubscribeServerMap={},this.subscribeModuleService.autoSubscribeUnreadMap={},this.subscribeModuleService.autoSubscribe())}),this.core.eventBus.on("qchatChannel/changeUnread",this.subscribeModuleService.changeUnread.bind(this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/updateUnreads",this.subscribeModuleService.updateUnreads.bind(this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/cacheSubscribe",this.subscribeModuleService.cacheSubscribe.bind(this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/clearUnreadCountByServers",this.subscribeModuleService.clearUnreadCountByServers.bind(this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/getRoleIdsByServerId",this.subscribeModuleService.getRoleIdsByServerId.bind(this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/autoUnSubscribe",e=>{if(this.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",e),e.type===ja[ja.channelVisibilityUpdate])this.logger.log("QChatChannel::begin autoUnSubscribe channel key is",`${e.serverId}_${e.channelId}`),this.subscribeModuleService._unSubscribeChannel(e.serverId,e.channelId),this.logger.log("QChatChannel::autoUnSubscribe channel done key is",`${e.serverId}_${e.channelId}`);else if(e.type===ja[ja.serverEnterLeave]){(this.subscribeModuleService.manualSubscribeServerMap[e.serverId]||this.subscribeModuleService.autoSubscribeServerMap[e.serverId])&&(this.logger.log("QChatChannel::begin autoUnSubscribe server key is",e.serverId),this.subscribeModuleService._unSubscribeServer(e.serverId),this.logger.log("QChatChannel::autoUnSubscribe server done key is",e.serverId));var t=this.subscribeModuleService.unreadServerCount[e.serverId];if(!t)return;this.logger.log("QChatChannel::begin autoUnSubscribe channels key is",Object.keys(t)),Object.keys(t).forEach(t=>{this.subscribeModuleService._unSubscribeChannel(e.serverId,t)}),this.logger.log("QChatChannel::autoUnSubscribe channels done key is",Object.keys(t))}}),this.core.eventBus.on("qchatChannel/serverIdentifyChange",e=>{this.subscribeModuleService.changeCacheServerRoleIds(e)})}createChannel(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",min:1},type:{type:"enum",values:$e(Ks)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},e),da((yield this.core.sendCmd("qchatCreateChannel",{channelInfo:Object.assign(Object.assign({},e),{type:Ks[e.type]}),antispamTag:Ca(e)})).content.channelInfo)})}deleteChannel(e){return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",allowEmpty:!1}},e),yield this.core.sendCmd("qchatDeleteChannel",e)})}updateChannel(e){return Ce(this,void 0,void 0,function*(){Te({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:$e(Ks),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},e);var t=e;return e.type&&(t.type=Ks[e.type]),da((yield this.core.sendCmd("qchatUpdateChannel",{channelInfo:t,antispamTag:Ca(e)})).content.channelInfo)})}getChannels(e){return Ce(this,void 0,void 0,function*(){return Te({channelIds:{type:"array",itemType:"string",min:1}},e),ua((yield this.core.sendCmd("qchatGetChannels",e)).content.channelList)})}getChannelsByPage(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:Object.assign({limit:100},e)}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:ua(n)}})}getMembersByPage(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:e}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:Ma(n)}})}updateWhiteBlackRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:$e(Ws)},opeType:{type:"enum",values:$e(zs)}},e),yield this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:Object.assign(Object.assign({},e),{type:Ws[e.type],opeType:zs[e.opeType]})})})}getWhiteBlackRolesPage(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:$e(Ws)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:Object.assign(Object.assign({},e),{type:Ws[e.type]})}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:Ja(n)}})}updateWhiteBlackMembers(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:$e(Ws)},opeType:{type:"enum",values:$e(zs)},toAccids:{type:"array",itemType:"string",min:1}},e),yield this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:Object.assign(Object.assign({},e),{type:Ws[e.type],opeType:zs[e.opeType],toAccids:JSON.stringify(e.toAccids)})})})}getWhiteBlackMembersPage(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:$e(Ws)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:Object.assign(Object.assign({limit:100},e),{type:Ws[e.type]})}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:Ma(n)}})}getExistingWhiteBlackRoles(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:$e(Ws)},roleIds:{type:"array",itemType:"string",min:1}},e);var t=yield this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:Object.assign(Object.assign({},e),{type:Ws[e.type],roleIds:JSON.stringify(e.roleIds)})}),{datas:n}=t.content;return{datas:Ja(n)}})}getExistingWhiteBlackMembers(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:$e(Ws)},accids:{type:"array",itemType:"string",min:1}},e);var t=yield this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:Object.assign(Object.assign({},e),{type:Ws[e.type],accids:JSON.stringify(e.accids)})}),{datas:n}=t.content;return{datas:Ma(n)}})}updateCategoryInfoOfChannel(e){return Ce(this,void 0,void 0,function*(){return Te({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},e),da((yield this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:e})).content.channelInfo)})}createChannelCategory(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},e),ga((yield this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:e})).content.QChatChannelCategoryInfo)})}removeChannelCategory(e){return Ce(this,void 0,void 0,function*(){Te({categoryId:{type:"string",allowEmpty:!1}},e),yield this.core.sendCmd("qchatRemoveChannelCategory",e)})}updateChannelCategory(e){return Ce(this,void 0,void 0,function*(){return Te({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},e),ga((yield this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:e})).content.QChatChannelCategoryInfo)})}getChannelCategoriesByID(e){return Ce(this,void 0,void 0,function*(){return Te({categoryIds:{type:"array",itemType:"string",min:1}},e),ma((yield this.core.sendCmd("qchatGetChannelCategoriesByID",e)).content.channelCategoryList)})}updateChannelCategoryWhiteBlackRole(e){return Ce(this,void 0,void 0,function*(){Te({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:$e(Ws)},opeType:{type:"enum",values:$e(zs)},roleId:{type:"string",allowEmpty:!1}},e),yield this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:Object.assign(Object.assign({},e),{type:Ws[e.type],opeType:zs[e.opeType]})})})}getChannelCategoryWhiteBlackRolesPage(e){return Ce(this,void 0,void 0,function*(){Te({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:$e(Ws)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:Object.assign(Object.assign({},e),{type:Ws[e.type]})}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:Ja(n)}})}updateChannelCategoryWhiteBlackMembers(e){return Ce(this,void 0,void 0,function*(){Te({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:$e(Ws)},opeType:{type:"enum",values:$e(zs)},toAccids:{type:"array",itemType:"string",min:1}},e),yield this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:Object.assign(Object.assign({},e),{type:Ws[e.type],opeType:zs[e.opeType],toAccids:JSON.stringify(e.toAccids)})})})}getChannelCategoryWhiteBlackMembersPage(e){return Ce(this,void 0,void 0,function*(){Te({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:$e(Ws)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:Object.assign(Object.assign({},e),{type:Ws[e.type]})}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:Ma(n)}})}getChannelCategoryWhiteBlackRoles(e){return Ce(this,void 0,void 0,function*(){Te({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:$e(Ws)},roleIds:{type:"array",itemType:"string",min:1}},e);var t=yield this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:Object.assign(Object.assign({},e),{type:Ws[e.type],roleIds:JSON.stringify(e.roleIds)})}),{datas:n}=t.content;return Ja(n)})}getChannelCategoryWhiteBlackMembers(e){return Ce(this,void 0,void 0,function*(){Te({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:$e(Ws)},accids:{type:"array",itemType:"string",min:1}},e);var t=yield this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:Object.assign(Object.assign({},e),{type:Ws[e.type],accids:JSON.stringify(e.accids)})}),{datas:n}=t.content;return Ma(n)})}getChannelCategoriesPage(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:e}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:ma(n)}})}getChannelCategoryChannelsPage(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:e}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:ua(n)}})}subscribeChannel(e){return Ce(this,void 0,void 0,function*(){if(Te({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},e),this.config.autoSubscribe&&!e.isInternalTrigger&&5!==e.type)throw new ve("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);var t=yield this.subscribeModuleService.subscribe(e);if(t.unreadInfos=ha(t.unreadInfos),5!==e.type)return 1===e.opeType&&(e.channels=t.unreadInfos.map(e=>({serverId:e.serverId,channelId:e.channelId}))),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",e),this.config.autoSubscribe?this.subscribeModuleService.cacheAutoSubscribe(e):this.subscribeModuleService.cacheSubscribe(e),this.subscribeModuleService.updateUnreads(t.unreadInfos),t;this.subscribeModuleService.cacheSubscribe(e)})}getChannelUnreadInfos(e){return Ce(this,void 0,void 0,function*(){var t=ha((yield this.core.sendCmd("qchatGetUnreadInfo",e)).content.unreadInfos);return this.subscribeModuleService.updateUnreads(t),t})}getChannelSearchByPage(e){return Ce(this,void 0,void 0,function*(){if(Te({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:$e(Ys),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:$e(Hs),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),e.startTime&&e.endTime&&e.startTime>=e.endTime)throw new he("startTime more than endTime",e,"timeRule");var t=yield this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:Object.assign(Object.assign({},e),{order:e.order&&Ys[e.order],sort:e.sort&&Hs[e.sort]})}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag),cursor:r.cursor},datas:ua(n)}})}channelMemberSearch(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},e),fa((yield this.core.sendCmd("qchatChannelMemberSearch",{qchatChannelMemberSearchTag:e})).content.datas)})}subscribeAsVisitor(e){return Ce(this,void 0,void 0,function*(){return Te({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},channels:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},min:1}},e),yield this.subscribeForVisitorService.subscribeChannelAsVisitor(e)})}qchatAutoSubscribeNotificationHandler(e){var t=ha(e.content.unreadInfos),n=e.content.serverIds;this.subscribeModuleService.updateUnreads(t);var r=[];if(n.length){var i={opeType:1};i.channels=n.map(e=>({serverId:e.serverId,channelId:""})),i.type=4,r.push(i)}if(t.length){var o={opeType:1};o.channels=t.map(e=>({serverId:e.serverId,channelId:e.channelId})),o.type=1,r.push(o)}if(r.length)for(var s of r)this.subscribeModuleService.cacheAutoSubscribe(s)}},"qchatChannel"),yt.registerService(class extends Gs{constructor(e,t){super("qchatMedia",e),this.config={},this.tokenExpireTime=24e4,this.getTokenState=!1,this.core=e,Gt({cmdMap:uc,cmdConfig:hc()}),t&&this.setOptions(t),this.setListener(),this.tokenExpireTime=24e4,this.channelId="",this.serverId=""}setOptions(e){e&&(this.config=Object.assign(this.config,e),(null==e?void 0:e.neroom)&&this.setNeroom(e.neroom))}setNeroom(e){this.neroom=new e}setListener(){this.core.eventBus.on("disconnect",this._existRomm.bind(this)),this.core.eventBus.on("kicked",this._existRomm.bind(this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",this._existRomm.bind(this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",this._existRomm.bind(this)),this.core.eventBus.on("qchatMedia/serverOrChannelLeave",e=>Ce(this,void 0,void 0,function*(){(e.type===ja[ja.channelVisibilityUpdate]&&e.channelId===this.channelId||e.type===ja[ja.serverEnterLeave]&&e.serverId===this.serverId)&&this.roomContext&&this.roomContext.roomUuid&&(yield this.disconnectChannel())}))}_existRomm(){return Ce(this,void 0,void 0,function*(){this.roomContext&&(yield this.disconnectChannel()),this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0)})}_checkPermission(e){return Ce(this,void 0,void 0,function*(){return yield this.core.qchatRole.checkPermission(e)})}_checkConnectState(){if("connect"!==this.state)throw new ve("QChatMedia::you should connect first")}kickMemberOut(e){var t;return Ce(this,void 0,void 0,function*(){this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1}},e);try{yield null===(t=this.roomContext)||void 0===t?void 0:t.kickMemberOut(e.accid)}catch(n){throw this.logger.error("QChatMedia::kickMemberOut error params is "+JSON.stringify(e),n),new ve("QChatMedia::kickMemberOut error",n)}})}disconnectChannel(){var e;return Ce(this,void 0,void 0,function*(){this.logger.debug("QChatMedia::disconnect begin disconnect");try{yield null===(e=this.roomContext)||void 0===e?void 0:e.leaveRoom()}catch(t){this.logger.error("QChatMedia::disconnect error",t)}this.authService&&(yield this.authService.logout()),this._setStateInit(),this.core.emit("qchatMediaDisconnect"),this.core.qchatMedia.emit("qchatMediaDisconnect")})}_setStateInit(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""}muteAudio(e){var t,n,r,i,o;return Ce(this,void 0,void 0,function*(){if(this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1}},e),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)===e.accid)try{yield null===(n=this.rtcController)||void 0===n?void 0:n.muteMyAudio()}catch(a){throw this.logger.error("QChatMedia::muteAudio error",a),new ve("QChatMedia::muteAudio error",a)}else try{var s=null===(r=this.roomContext)||void 0===r?void 0:r.roomProperties.audioOff;if(s&&"offNotAllowSelfOn"===(null===(i=s.value)||void 0===i?void 0:i.split("_")[0])&&!(yield this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"})))return void this.logger.error("QChatMedia::unMuteAudio not allow open auido");yield null===(o=this.rtcController)||void 0===o?void 0:o.muteMemberAudio(e.accid)}catch(c){throw this.logger.error("QChatMedia::muteAudio error params is "+JSON.stringify(e),c),new ve("QChatMedia::muteAudio error",c)}})}unMuteAudio(e){var t,n,r,i,o;return Ce(this,void 0,void 0,function*(){this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1}},e);var s=null===(t=this.roomContext)||void 0===t?void 0:t.roomProperties.audioOff;if(!s||"offNotAllowSelfOn"!==(null===(n=s.value)||void 0===n?void 0:n.split("_")[0])||(yield this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"})))if((null===(r=this.roomContext)||void 0===r?void 0:r.localMember.uuid)===e.accid)try{yield null===(i=this.rtcController)||void 0===i?void 0:i.unmuteMyAudio()}catch(a){throw this.logger.error("QChatMedia::unMuteAudio error",a),new ve("QChatMedia::unMuteAudio error",a)}else try{yield null===(o=this.rtcController)||void 0===o?void 0:o.unmuteMemberAudio(e.accid)}catch(c){throw this.logger.error("QChatMedia::unMuteAudio error params is "+JSON.stringify(e),c),new ve("QChatMedia::unMuteAudio error",c)}else this.logger.error("QChatMedia::unMuteAudio not allow open auido")})}muteVideo(e){var t,n,r,i,o;return Ce(this,void 0,void 0,function*(){if(this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1}},e),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)===e.accid)try{yield null===(n=this.rtcController)||void 0===n?void 0:n.muteMyVideo()}catch(a){throw this.logger.error("QChatMedia::muteVideo error",a),new ve("QChatMedia::muteVideo error",a)}else try{var s=null===(r=this.roomContext)||void 0===r?void 0:r.roomProperties.videoOff;if(s&&"offNotAllowSelfOn"===(null===(i=s.value)||void 0===i?void 0:i.split("_")[0])&&!(yield this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"})))return void this.logger.error("QChatMedia::unMuteVideo not allow open video");yield null===(o=this.rtcController)||void 0===o?void 0:o.muteMemberVideo(e.accid)}catch(c){throw this.logger.error("QChatMedia::muteVideo error params is "+JSON.stringify(e),c),new ve("QChatMedia::muteVideo error",c)}})}unMuteVideo(e){var t,n,r,i,o;return Ce(this,void 0,void 0,function*(){this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1}},e);var s=null===(t=this.roomContext)||void 0===t?void 0:t.roomProperties.videoOff;if(!s||"offNotAllowSelfOn"!==(null===(n=s.value)||void 0===n?void 0:n.split("_")[0])||(yield this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"})))if((null===(r=this.roomContext)||void 0===r?void 0:r.localMember.uuid)===e.accid)try{yield null===(i=this.rtcController)||void 0===i?void 0:i.unmuteMyVideo()}catch(a){throw this.logger.error("QChatMedia::unMuteVideo error",a),new ve("QChatMedia::unMuteVideo error",a)}else try{null===(o=this.rtcController)||void 0===o||o.unmuteMemberVideo(e.accid)}catch(a){throw this.logger.error("QChatMedia::unMuteVideo error",a),new ve("QChatMedia::unMuteVideo error",a)}else this.logger.error("QChatMedia::unMuteVideo not allow open video")})}startScreenShare(){var e;return Ce(this,void 0,void 0,function*(){this._checkConnectState();try{null===(e=this.rtcController)||void 0===e||e.startScreenShare()}catch(t){throw this.logger.error("QChatMedia::startScreenShare error",t),new ve("QChatMedia::startScreenShare error",t)}})}stopScreenShare(){var e;return Ce(this,void 0,void 0,function*(){this._checkConnectState();try{null===(e=this.rtcController)||void 0===e||e.stopScreenShare()}catch(t){throw this.logger.error("QChatMedia::stopScreenShare error",t),new ve("QChatMedia::stopScreenShare error",t)}})}stopMemberScreenShare(e){var t;return Ce(this,void 0,void 0,function*(){this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1}},e);try{null===(t=this.rtcController)||void 0===t||t.stopMemberScreenShare(e.accid)}catch(n){throw this.logger.error("QChatMedia::stopMemberScreenShare error",n),new ve("QChatMedia::stopMemberScreenShare error",n)}})}subscribeRemoteVideoStream(e){var t;return Ce(this,void 0,void 0,function*(){this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},e);try{null===(t=this.rtcController)||void 0===t||t.subscribeRemoteVideoStream(e.accid,e.streamType)}catch(n){throw this.logger.error("QChatMedia::subscribeRemoteVideoStream error",n),new ve("QChatMedia::subscribeRemoteVideoStream error",n)}})}unSubscribeRemoteVideoStream(e){var t;return Ce(this,void 0,void 0,function*(){this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},e);try{null===(t=this.rtcController)||void 0===t||t.unsubscribeRemoteVideoStream(e.accid,e.streamType)}catch(n){throw this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",n),new ve("QChatMedia::unSubscribeRemoteVideoStream error",n)}})}setupVideoCanvas(e){var t;if(this._checkConnectState(),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)===e.accid)try{return this.rtcController.setupLocalVideoCanvas(e.videoView)}catch(n){throw this.logger.error("QChatMedia::setupVideoCanvas error",n),new ve("QChatMedia::setupVideoCanvas error",n)}else try{return this.rtcController.setupRemoteVideoCanvas(e.videoView,e.accid)}catch(n){throw this.logger.error("QChatMedia::setupVideoCanvas error",n),new ve("QChatMedia::setupVideoCanvas error",n)}}setupRemoteVideoSubStreamCanvas(e){this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1}},e);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(e.videoView,e.accid)}catch(t){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",t),new ve("QChatMedia::setupRemoteVideoSubStreamCanvas error",t)}}getScreenSharingUserUuid(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(ie){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",ie),new ve("QChatMedia::getScreenSharingUserUuid error",ie)}}initQChatMedia(e){return Ce(this,void 0,void 0,function*(){if(this.neroom)if(void 0===this.state){try{this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:e.serverConfig})}catch(t){throw this.logger.error("QChatMedia::initQChatMedia error",t),new ve("QChatMedia::initQChatMedia error",t)}this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init"}else this.logger.error("QChatMedia::init::you already init QChatMedia");else this.logger.warn("QChatMedia::init::you should import neroom SDK")})}loginByIM(){var e;return Ce(this,void 0,void 0,function*(){if("init"===this.state){var t=yield this._getToken(),n=Ve(this.core,"options.token")||Ve(this.core,"V2NIMLoginService.token");try{yield null===(e=this.authService)||void 0===e?void 0:e.loginByIM(this.core.account,t,n)}catch(r){throw this.logger.error("QChatMedia::loginByIM error",r),new ve("QChatMedia::loginByIM error",r)}this.state="login"}else this.logger.error("QChatMedia::connect::you should init before login")})}_getToken(){var e;return Ce(this,void 0,void 0,function*(){this.logger.log("QChatMedia::getToken begin getToken");var t=yield this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:null===(e=this.neroom)||void 0===e?void 0:e.deviceId}}),{token:n,expire:r}=t.content.neroomToken;return this.logger.log(`QChatMedia::getToken success token is ${n},expire is ${r} `),this.tokenTimer||(this.logger.debug(`QChatMedia::getToken set token timer,expire is ${1e3*r-this.tokenExpireTime} `),this.tokenTimer=this.core.timerManager.addTimer(()=>Ce(this,void 0,void 0,function*(){this.tokenTimer&&this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0;var e=yield this._getToken();this.authService&&this.authService.renewToken(e)}),1e3*r-this.tokenExpireTime)),n})}connectChannel(e){var t,n;return Ce(this,void 0,void 0,function*(){if(void 0!==this.state){"init"===this.state&&(yield this.loginByIM()),this.serverId=e.serverId,this.channelId=e.channelId;try{yield null===(t=this.roomService)||void 0===t?void 0:t.joinRoom({roomUuid:e.channelId,role:"qchatAudience",userName:this.core.account,initialProperties:{}},{})}catch(i){throw this.logger.error("QChatMedia::connectChannel error",i),new ve("QChatMedia::connectChannel error",i)}var r=null===(n=this.roomService)||void 0===n?void 0:n.getRoomContext(e.channelId);r?(this.roomContext=r,this.rtcController=this.roomContext.rtcController,this.state="connect",yield this.rtcController.joinRtcChannel(),this.core.emit("connectChannel"),this.core.qchatMedia.emit("connectChannel")):this.logger.error("QChatMedia::connect room not exited")}else this.logger.error("QChatMedia::connect::you should init before login")})}updateRTCChannelInfo(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},e),yield this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:Object.assign(Object.assign({},e),{audio:JSON.stringify(e.audio),video:JSON.stringify(e.video)})})})}getRTCChannelInfo(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},e),function(e){try{e.audio&&(e.audio=JSON.parse(e.audio))}catch(t){throw new he('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{e.video&&(e.video=JSON.parse(e.video))}catch(t){throw new he('result "video" JSON parse error',{key:"video"},"JSON parse error")}return an(cc,e)}((yield this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:e})).content.RTCChannelConfig)})}getRTCChannelOnlineMembers(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},e),lc((yield this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:e})).content.memberList)})}addRTCChannelListener(){var e,t;this._checkConnectState();try{null===(e=this.authService)||void 0===e||e.addAuthListener({onAuthEvent:e=>Ce(this,void 0,void 0,function*(){if(1026===e&&!this.getTokenState){this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0;var t=yield this._getToken();this.authService&&(yield this.authService.renewToken(t)),this.getTokenState=!1}})})}catch(n){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",n),new ve("QChatMedia::loginByIM addAuthListener error",n)}null===(t=this.roomContext)||void 0===t||t.addRoomListener({onRoomPropertiesChanged:e=>{var t,n,r,i,o,s;if(this.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",e),e.audioOff){var a=null===(t=e.audioOff.value)||void 0===t?void 0:t.split("_")[0];"offNotAllowSelfOn"!==a&&"offAllowSelfOn"!==a||(null===(n=this.roomContext)||void 0===n?void 0:n.localMember.isAudioOn)&&(null===(r=this.rtcController)||void 0===r||r.muteMyAudio())}else if(e.videoOff){var c=null===(i=e.videoOff.value)||void 0===i?void 0:i.split("_")[0];"offNotAllowSelfOn"!==c&&"offAllowSelfOn"!==c||(null===(o=this.roomContext)||void 0===o?void 0:o.localMember.isVideoOn)&&(null===(s=this.rtcController)||void 0===s||s.muteMyVideo())}},onRoomPropertiesDeleted:e=>{this.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",e)},onMemberJoinRtcChannel:e=>{this.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",e);var t=e.map(e=>e.uuid);this.core.emit("memberJoinRTCChannel",t),this.core.qchatMedia.emit("memberJoinRTCChannel",t)},onMemberLeaveRoom:e=>{this.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",e);var t=e.map(e=>e.uuid);this.core.emit("memberLeaveRTCChannel",t),this.core.qchatMedia.emit("memberLeaveRTCChannel",t)},onRoomEnded:e=>{this.authService&&this.authService.logout(),this._setStateInit(),this.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",e),this.core.emit("RTCChannelEnded",e),this.core.qchatMedia.emit("RTCChannelEnded",e)},onRtcChannelError:e=>{this.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",e),"SOCKET_ERROR"===e&&this.disconnectChannel(),this.core.emit("RTCChannelError",e),this.core.qchatMedia.emit("RTCChannelError",e)},onRtcAudioVolumeIndication:e=>{this.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",e),this.core.emit("onRtcAudioVolumeIndication",e),this.core.qchatMedia.emit("onRtcAudioVolumeIndication",e)},onMemberAudioMuteChanged:(e,t,n)=>{this.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",e,t),this.core.emit("memberAudioMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid}),this.core.qchatMedia.emit("memberAudioMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid})},onMemberScreenShareStateChanged:(e,t,n)=>{this.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",e,t),this.core.emit("memberScreenShareStateChanged",{memberAccId:e.uuid,isSharing:t,operateByAccId:n.uuid}),this.core.qchatMedia.emit("memberScreenShareStateChanged",{memberAccId:e.uuid,isSharing:t,operateByAccId:n.uuid})},onMemberVideoMuteChanged:(e,t,n)=>{this.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",e,t),this.core.emit("memberVideoMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid}),this.core.qchatMedia.emit("memberVideoMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid})}})}enumCameraDevices(){return this._checkConnectState(),this.rtcController.enumCameraDevices().then(e=>e.data,e=>{throw this.logger.error("QChatMedia::enumCameraDevices error",e),new ve("QChatMedia::enumCameraDevices error",e)})}enumPlayoutDevices(){return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then(e=>e.data,e=>{throw this.logger.error("QChatMedia::enumPlayoutDevices error",e),new ve("QChatMedia::enumPlayoutDevices error",e)})}enumRecordDevices(){return this._checkConnectState(),this.rtcController.enumRecordDevices().then(e=>e.data,e=>{throw this.logger.error("QChatMedia::enumRecordDevices error",e),new ve("QChatMedia::enumRecordDevices error",e)})}removeRTCChannelListener(){var e,t;this._checkConnectState(),null===(e=this.roomContext)||void 0===e||e.removeRoomListener({}),null===(t=this.authService)||void 0===t||t.removeAuthListener({})}setSelectedCameraDevice(e){return this._checkConnectState(),Te({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedCameraDevice(e.deviceId).then(e=>e.data,e=>{throw this.logger.error("QChatMedia::setSelectedCameraDevice error",e),new ve("QChatMedia::setSelectedCameraDevice error",e)})}setSelectedPlayoutDevice(e){return this._checkConnectState(),Te({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedPlayoutDevice(e.deviceId).then(e=>e.data,e=>{throw this.logger.error("QChatMedia::setSelectedPlayoutDevice error",e),new ve("QChatMedia::setSelectedPlayoutDevice error",e)})}setSelectedRecordDevice(e){return this._checkConnectState(),Te({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedRecordDevice(e.deviceId).then(e=>e.data,e=>{throw this.logger.error("QChatMedia::setSelectedRecordDevice error",e),new ve("QChatMedia::setSelectedRecordDevice error",e)})}getRTCMembers(){return this._checkConnectState(),this.roomContext.remoteMembers.filter(e=>e.isInRtcChannel).map(e=>({accid:e.uuid,isAudioOn:!!e.isAudioOn,isVideoOn:!!e.isVideoOn,isSharingScreen:!!e.isSharingScreen,properties:e.properties}))}subscribeRemoteVideoSubStream(e){var t;return Ce(this,void 0,void 0,function*(){this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1}},e);try{null===(t=this.rtcController)||void 0===t||t.subscribeRemoteVideoSubStream(e.accid)}catch(n){throw this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",n),new ve("QChatMedia::subscribeRemoteVideoSubStream error",n)}})}unsubscribeRemoteVideoSubStream(e){var t;return Ce(this,void 0,void 0,function*(){this._checkConnectState(),Te({accid:{type:"string",allowEmpty:!1}},e);try{null===(t=this.rtcController)||void 0===t||t.unsubscribeRemoteVideoSubStream(e.accid)}catch(n){throw this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",n),new ve("QChatMedia::unsubscribeRemoteVideoSubStream error",n)}})}muteAllAudio(){var e;return Ce(this,void 0,void 0,function*(){if(this._checkConnectState(),yield this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"}))try{null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("audioOff",JSON.stringify({value:`offNotAllowSelfOn_${(new Date).getTime()}`}))}catch(t){throw this.logger.error("QChatMedia::muteAllAudio error",t),new ve("QChatMedia::muteAllAudio error",t)}else this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth")})}muteAllVideo(){var e;return Ce(this,void 0,void 0,function*(){if(this._checkConnectState(),yield this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"}))try{null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("videoOff",JSON.stringify({value:`offNotAllowSelfOn_${(new Date).getTime()}`}))}catch(t){throw this.logger.error("QChatMedia::muteAllVideo error",t),new ve("QChatMedia::muteAllVideo error",t)}else this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth")})}unMuteAllAudio(){var e;return Ce(this,void 0,void 0,function*(){if(this._checkConnectState(),yield this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"}))try{null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("audioOff",JSON.stringify({value:`disable_${(new Date).getTime()}`}))}catch(t){throw this.logger.error("QChatMedia::unMuteAllAudio error",t),new ve("QChatMedia::unMuteAllAudio error",t)}else this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth")})}unMuteAllVideo(){var e;return Ce(this,void 0,void 0,function*(){if(this._checkConnectState(),yield this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"}))try{null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("videoOff",JSON.stringify({value:`disable_${(new Date).getTime()}`}))}catch(t){throw this.logger.error("QChatMedia::unMuteAllVideo error",t),new ve("QChatMedia::unMuteAllVideo error",t)}else this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth")})}},"qchatMedia"),yt.registerService(class extends Gs{constructor(e){super("qchatMsg",e),this.core=e,this.lastChannelIdInMark="",Gt({cmdMap:gc,cmdConfig:vc()}),this.notificationModuleService=new Fc(e),this.messageModuleService=new qc(e),this.extendModuleService=new Gc(e)}sendMessage(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:$e(Ua)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},mentionRoleIds:{type:"array",itemType:"string",required:!1,min:1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},e),yield this.messageModuleService.sendMessage(e)})}updateMessage(e){return Ce(this,void 0,void 0,function*(){if(Te({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},e),"number"==typeof e.message.status&&e.message.status<1e4)throw new ve("Status should be greater than or equal to 10000");return yield this.messageModuleService.doUpdateMessage(e)})}resendMessage(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},e),yield this.messageModuleService.resendMessage(e)})}deleteMessage(e){return Ce(this,void 0,void 0,function*(){Te({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},e);var t=JSON.parse(JSON.stringify(e));return t.message.status=2,yield this.messageModuleService.doUpdateMessage(t)})}revokeMessage(e){return Ce(this,void 0,void 0,function*(){Te({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},e);var t=JSON.parse(JSON.stringify(e));return t.message=hr(t.message,["serverId","channelId","msgIdServer","time"]),t.message.status=1,yield this.messageModuleService.doUpdateMessage(t)})}markMessageRead(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},e),e.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=e.channelId,this.messageModuleService.markMessageRead(e)})}replyMessage(e){Te({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},e);var t=e.replyMessage;if(e.serverId!==t.serverId||e.channelId!==t.channelId)throw new ve("Forbid replying to message from other server, channel");return this.sendMessage(e)}getMessageHistoryByIds(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),yield this.extendModuleService.getMessageHistoryByIds(e)})}getReferMessages(e){return Ce(this,void 0,void 0,function*(){return Te({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:$e(qa),required:!1}},e),yield this.extendModuleService.getReferMessages(e)})}getThreadMessages(e){return Ce(this,void 0,void 0,function*(){return Te({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},e),yield this.extendModuleService.getThreadMessages(e)})}getThreadRootMessagesMeta(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),yield this.extendModuleService.getThreadRootMessagesMeta(e)})}sendSystemNotification(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},e),yield this.notificationModuleService.sendSystemNotification(e)})}updateSystemNotification(e){return Ce(this,void 0,void 0,function*(){return Te({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:$e(ja)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},e),yield this.notificationModuleService.updateSystemNotification(e)})}markSystemNotificationsRead(e){return Ce(this,void 0,void 0,function*(){Te({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},e),yield this.notificationModuleService.markSystemNotificationsRead(e)})}getHistoryMessage(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),yield this.messageModuleService.getHistoryMessage(e)})}getMentionedMeMessages(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),yield this.messageModuleService.getMentionedMeMessages(e)})}areMentionedMeMessages(e){return Ce(this,void 0,void 0,function*(){if(Te({messages:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1}},min:1}},e),!e.messages.every(t=>e.messages[0].serverId===t.serverId))throw new ve("Different serverId",e,10414);if(this.core.qchatChannel.subscribeForVisitorService.isInAutoServers(e.messages[0].serverId))throw new ve("Not allowed for visitor",e,10403);return yield this.messageModuleService.areMentionedMeMessages(e.messages)})}addQuickComment(e){return Ce(this,void 0,void 0,function*(){yield this.extendModuleService.updateQuickComment(e,1)})}removeQuickComment(e){return Ce(this,void 0,void 0,function*(){yield this.extendModuleService.updateQuickComment(e,2)})}getQuickComments(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},e),yield this.extendModuleService.getQuickComments(e)})}sendTypingEvent(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),yield this.extendModuleService.sendTypingEvent(e)})}getLastMessageOfChannels(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},e),yield this.messageModuleService.getLastMessageOfChannels(e)})}qchatOnMsgHandler(e){return Ce(this,void 0,void 0,function*(){this.messageModuleService.onMsg(e)})}qchatOnRecvUnreadInfoHandler(e){return Ce(this,void 0,void 0,function*(){this.messageModuleService.onRecvUnreadInfo(e)})}qchatOnSysMsgHandler(e){this.notificationModuleService.onSysMsg(e)}qchatMultiSyncMessageReadHandler(e){this.messageModuleService.onMultiSyncRead(e)}qchatMultiSyncSystemNotificationUpdateHandler(e){this.notificationModuleService.onMultiSysMsg(e)}qchatSyncSystemNotificationHandler(e){this.notificationModuleService.onSyncSysMsg(e)}qchatRecvMessageUpdateHandler(e){return Ce(this,void 0,void 0,function*(){this.messageModuleService.onRecvMsgUpdate(e)})}searchMsgByPage(e){return Ce(this,void 0,void 0,function*(){return Te({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:$e(Ys),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:$e(Da),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),yield this.messageModuleService.messageSearchByPage(e)})}qchatMultiSyncServersMessageReadHandler(e){this.messageModuleService.onMultiSyncServersRead(e)}},"qchatMsg"),yt.registerService(class extends Gs{constructor(e){super("qchatRole",e),this.core=e,Gt({cmdMap:Sc,cmdConfig:bc()}),this.category=new Hc(e)}createServerRole(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},e),Ya((yield this.core.sendCmd("qchatCreateServerRole",{serverRole:Object.assign(Object.assign({},za(e)),{type:Na.custom}),antispamTag:Ca(e)})).content.serverRole)})}updateServerRole(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},e),Ya((yield this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:za(e),antispamTag:Ca(e)})).content.serverRole)})}deleteServerRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),yield this.core.sendCmd("qchatDeleteServerRole",e)})}getServerRoles(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},e);var t=yield this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:za(e)}),n=t.content.serverRoles.filter(e=>1===parseInt(e.isMember));return n=n.map(e=>e.roleId),{roles:Ja(t.content.serverRoles),isMemberRoles:n}})}addChannelRole(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},e),Ya((yield this.core.sendCmd("qchatAddChannelRole",{channelRole:za(e)})).content.channelRole)})}getChannelRoles(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),Ja((yield this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:e})).content.channelRoles)})}removeChannelRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),yield this.core.sendCmd("qchatRemoveChannelRole",e)})}updateChannelRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},e);var t=yield this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:za(e)});if(406===t.raw.code)throw new ve("No update required",{},406);return Ya(t.content.channelRole)})}addMemberRole(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),Ya((yield this.core.sendCmd("qchatAddMemberRole",{memberRole:e})).content.memberRole)})}getMemberRoles(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),Ja((yield this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:e})).content.memberRoles)})}removeMemberRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),yield this.core.sendCmd("qchatRemoveMemberRole",{memberRole:e})})}updateMemberRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},e);var t=yield this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:za(e)});if(406===t.raw.code)throw new ve("No update required",{},406);return Ya(t.content.memberRole)})}addMembersToServerRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},e);var t=yield this.core.sendCmd("qchatAddMembersToServerRole",Object.assign(Object.assign({},e),{accids:JSON.stringify(e.accids)})),n=Ve(t,"content.accids.successAccids"),r=Ve(t,"content.accids.failedAccids");return{successAccids:n?JSON.parse(n):[],failedAccids:r?JSON.parse(r):[]}})}removeMembersFromServerRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},e);var t=yield this.core.sendCmd("qchatRemoveMembersFromServerRole",Object.assign(Object.assign({},e),{accids:JSON.stringify(e.accids)})),n=Ve(t,"content.accids.successAccids"),r=Ve(t,"content.accids.failedAccids");return{successAccids:n?JSON.parse(n):[],failedAccids:r?JSON.parse(r):[]}})}getMembersFromServerRole(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},e),Ja((yield this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:e})).content.members)})}getServerRolesByAccid(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),Ja((yield this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:e})).content.serverRoles)})}getExistingServerRolesByAccids(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e);var t=yield this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:e.serverId,accids:JSON.stringify(e.accids)});try{var n=JSON.parse(t.content.serverRoles);return Object.keys(n).forEach(e=>{n[e].forEach((t,r)=>{n[e][r]=qt(t,Mc().serverRole)}),n[e]=Ja(n[e])}),n}catch(r){throw this.logger.error(`can not parse serverRolesGroupByAccid from ${e.serverId} and ${e.accids}`,t.content.serverRoles),r}})}getExistingChannelRolesByServerRoleIds(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},e),Ja((yield this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:e.serverId,channelId:e.channelId,roleIds:JSON.stringify(e.roleIds)})).content.channelRoles)})}getExistingAccidsOfMemberRoles(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e);var t=(yield this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:e.serverId,channelId:e.channelId,accids:JSON.stringify(e.accids)})).content.memberRoles;return t&&t.length>0?t.map(e=>e.accid):[]})}getExistingAccidsInServerRole(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e);var t=(yield this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:e.serverId,roleId:e.roleId,accids:JSON.stringify(e.accids)})).content.members;return t&&t.length>0?t.map(e=>e.accid):[]})}updateServerRolePriorities(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},e),Ja((yield this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:e.serverId,serverRoles:e.serverRoles.map(e=>({serverId:e.serverId,roleId:e.roleId,priority:e.priority}))})).content.serverRoles)})}checkPermission(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"string"}},e),(yield this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:Object.assign(Object.assign({},e),{auth:ka[e.auth]||e.auth})})).content.checked})}addChannelCategoryRole(e){return Ce(this,void 0,void 0,function*(){return yield this.category.addChannelCategoryRole(e)})}removeChannelCategoryRole(e){return Ce(this,void 0,void 0,function*(){return yield this.category.removeChannelCategoryRole(e)})}updateChannelCategoryRole(e){return Ce(this,void 0,void 0,function*(){return yield this.category.updateChannelCategoryRole(e)})}getChannelCategoryRole(e){return Ce(this,void 0,void 0,function*(){return yield this.category.getChannelCategoryRole(e)})}addChannelCategoryMemberRole(e){return Ce(this,void 0,void 0,function*(){return yield this.category.addChannelCategoryMemberRole(e)})}removeChannelCategoryMemberRole(e){return Ce(this,void 0,void 0,function*(){return yield this.category.removeChannelCategoryMemberRole(e)})}updateChannelCategoryMemberRole(e){return Ce(this,void 0,void 0,function*(){return yield this.category.updateChannelCategoryMemberRole(e)})}getChannelCategoryMemberRole(e){return Ce(this,void 0,void 0,function*(){return yield this.category.getChannelCategoryMemberRole(e)})}checkPermissions(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"string"}},e),this.core.logger.log("qchatRole::checkPermission options is",e);var t=yield this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:Object.assign(Object.assign({},e),{auths:JSON.stringify(e.auths.map(e=>ka[e]||e))})});this.core.logger.log("qchatRole::checkPermission result is",t.content);var n={};return t.content.checkPermissionsResult.forEach(e=>{n[e.auth]=e.isAllow}),this.core.logger.log("qchatRole::checkPermission auths is",n),Ka(n)})}},"qchatRole"),yt.registerService(class extends Gs{constructor(e){super("qchatServer",e),this.core=e,Gt({cmdMap:yc,cmdConfig:Tc()})}createServer(e){return Ce(this,void 0,void 0,function*(){return Te({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},e),Ta((yield this.core.sendCmd("qchatCreateServer",{serverInfo:Object.assign(Object.assign({},e),{searchEnable:!1===e.searchEnable?0:1}),antispamTag:Ca(e)})).content.serverInfo)})}deleteServer(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1}},e),yield this.core.sendCmd("qchatDeleteServer",e)})}updateServer(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},e),Ta((yield this.core.sendCmd("qchatUpdateServer",{serverInfo:Object.assign(Object.assign({},e),{searchEnable:!1===e.searchEnable?0:1}),antispamTag:Ca(e)})).content.serverInfo)})}getServers(e){return Ce(this,void 0,void 0,function*(){return Te({serverIds:{type:"array",itemType:"string",min:1}},e),Sa((yield this.core.sendCmd("qchatGetServers",e)).content.serverList)})}getServersByPage(e){return Ce(this,void 0,void 0,function*(){Te({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetServersByPage",{tag:e}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:Sa(n)}})}inviteServerMembers(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},e);var t=yield this.core.sendCmd("qchatInviteServerMembers",e),n=t.content.record||{};return{failByOverAccids:t.content.failByOverAccids,failByBanAccids:t.content.failByBanAccids,recordInfo:Oa(n)}})}acceptServerInvite(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),yield this.core.sendCmd("qchatAcceptServerInvite",e)})}rejectInviteServer(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),yield this.core.sendCmd("qchatRejectInviteServer",e)})}applyServerJoin(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},e),Oa((yield this.core.sendCmd("qchatApplyServerJoin",e)).content.data)})}acceptServerApply(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),yield this.core.sendCmd("qchatAcceptServerApply",e)})}rejectServerApply(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),yield this.core.sendCmd("qchatRejectServerApply",e)})}kickServerMembers(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},e),yield this.core.sendCmd("qchatKickServerMembers",e)})}leaveServer(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1}},e),yield this.core.sendCmd("qchatLeaveServer",e)})}updateMyMemberInfo(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},e),Ea((yield this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:e,antispamTag:Ca(e)})).content.memberInfo)})}updateServerMemberInfo(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},e),Ea((yield this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:e,antispamTag:Ca(e)})).content.memberInfo)})}getServerMembers(e){return Ce(this,void 0,void 0,function*(){Te({accids:{type:"array"}},e);var t=[];if(e.accids.length)for(var n of e.accids)t.push(`${n.serverId}|${n.accid}`);return Ma((yield this.core.sendCmd("qchatGetServerMembers",{accids:t})).content.accidList)})}getServerMembersByPage(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetServerMembersByPage",{tag:e}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:Ma(n)}})}subscribeServer(e){var t,n,r,i;return Ce(this,void 0,void 0,function*(){if(Te({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},e),(null===(n=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===n?void 0:n.autoSubscribe)&&!e.isInternalTrigger)throw new ve("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);if(e.type||(e.type=4),e.servers.length){var o=Object.assign(Object.assign({},e),{channels:e.servers.map(e=>({serverId:e.serverId,channelId:""}))}),{failedChannels:s}=yield this.core.qchatChannel.subscribeModuleService.subscribe(o);return(null===(i=null===(r=this.core.qchatChannel)||void 0===r?void 0:r.config)||void 0===i?void 0:i.autoSubscribe)?this.core.qchatChannel.subscribeModuleService.cacheAutoSubscribe(o):this.core.qchatChannel.subscribeModuleService.cacheSubscribe(o),{failedServers:s}}})}banServerMember(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),yield this.core.sendCmd("qchatUpdateServerMemberBan",{tag:Object.assign(Object.assign({},e),{opeType:1})})})}unbanServerMember(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),yield this.core.sendCmd("qchatUpdateServerMemberBan",{tag:Object.assign(Object.assign({},e),{opeType:2})})})}getBannedMembersByPage(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e);var t=yield this.core.sendCmd("qchatGetBannedMembersByPage",{tag:e}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag)},datas:ba(n)}})}serverSearchByPage(e){return Ce(this,void 0,void 0,function*(){if(Te({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:$e(Ys),required:!1},searchType:{type:"enum",values:$e(Xs)},sort:{type:"enum",values:$e(Js),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),e.startTime&&e.endTime&&e.startTime>=e.endTime)throw new he("startTime more than endTime",e,"timeRule");var t=yield this.core.sendCmd("qchatServerSearchByPage",{tag:Object.assign(Object.assign({},e),{order:e.order&&Ys[e.order],searchType:Xs[e.searchType],sort:e.sort&&Js[e.sort],serverType:JSON.stringify(e.serverType)})}),{datas:n,listQueryTag:r}=t.content;return{listQueryTag:{hasMore:1==+r.hasMore,nextTimetag:parseInt(r.nextTimetag),cursor:r.cursor},datas:Sa(n)}})}serverMemberSearchByPage(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},e),Ma((yield this.core.sendCmd("qchatServerMemberSearchByPage",{tag:e})).content.members)})}generateInviteCode(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},e),an({expireTime:{type:"number"}},(yield this.core.sendCmd("qchatGenerateInviteCode",{tag:e})).content.data)})}joinByInviteCode(e){return Ce(this,void 0,void 0,function*(){Te({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},e),yield this.core.sendCmd("qchatJoinByInviteCode",{tag:e})})}getInviteApplyRecordOfServer(e){return Ce(this,void 0,void 0,function*(){return Te({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),Ra((yield this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:Object.assign(Object.assign({},e),{reverse:e.reverse?1:0})})).content.data)})}getInviteApplyRecordOfSelf(e){return Ce(this,void 0,void 0,function*(){return Te({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),Ra((yield this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:Object.assign(Object.assign({},e),{reverse:e.reverse?1:0})})).content.data)})}markRead(e){return Ce(this,void 0,void 0,function*(){Te({serverIds:{type:"array",itemType:"string",required:!0}},e);var t=xa((yield this.core.sendCmd("qchatClearServersUnread",e)).content.clearServersUnreadTag),{successServerIds:n,ackTimestamp:r}=t;return this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",n,r),t})}subscribeAllChannel(e){var t,n;return Ce(this,void 0,void 0,function*(){if(Te({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},e),null===(n=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===n?void 0:n.autoSubscribe)throw new ve("subscribe channel failed, manual subscribe is not allowed in auto subscribe mode.",{},403);var r=yield this.core.sendCmd("qchatSubscribeChannelsByServers",e,{timeout:3e4});r.content.unreadInfos=ha(r.content.unreadInfos),r.content.failServerIds=va(r.content.failServerIds);var i={type:e.type,opeType:1,channels:r.content.unreadInfos.map(e=>({serverId:e.serverId,channelId:e.channelId}))};return this.core.eventBus.emit("qchatChannel/cacheSubscribe",i),this.core.eventBus.emit("qchatChannel/getRoleIdsByServerId",e.serverIds),this.core.eventBus.emit("qchatChannel/updateUnreads",r.content.unreadInfos),r.content})}enterAsVisitor(e){return Ce(this,void 0,void 0,function*(){Te({serverIds:{type:"array",itemType:"string",min:1}},e);var t=va((yield this.core.sendCmd("qchatEnterAsVisitor",{tag:{serverIds:JSON.stringify(e.serverIds)}})).content.failServerIds),n=_e(e.serverIds,t);return this.core.qchatChannel.subscribeForVisitorService.cacheServer(n),{failedServers:t}})}leaveAsVisitor(e){return Ce(this,void 0,void 0,function*(){Te({serverIds:{type:"array",itemType:"string",min:1}},e);var t=va((yield this.core.sendCmd("qchatLeaveAsVisitor",{tag:{serverIds:JSON.stringify(e.serverIds)}})).content.failServerIds);return _e(e.serverIds,t).forEach(e=>{this.core.qchatChannel.subscribeForVisitorService.deleteServer(e)}),{failedServers:t}})}subscribeAsVisitor(e){return Ce(this,void 0,void 0,function*(){return Te({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},serverIds:{type:"array",itemType:"string",min:1}},e),e.serverIds.length?yield this.core.qchatChannel.subscribeForVisitorService.subscribeServerAsVisitor(e):{failedServers:[]}})}},"qchatServer"),yt.registerPrivateService(class{constructor(e){this.bindEvents=()=>{this.core.eventBus.on("forwardSend/msg/sendMsg",this.onV1SendMsg),this.core.eventBus.on("forwardSend/msg/recallMsg",this.onV1RecallMsg),this.core.eventBus.on("forwardSend/msg/deleteSelfMsgs",this.onV1DeleteSelfMsgs),this.core.eventBus.on("forwardSend/msgLog/clearHistoryMsgsFromServer",this.onV1ClearHistoryMessage),this.core.eventBus.on("forwardSend/V2NIMMessageService/sendMsg",this.onV2SendMsg),this.core.eventBus.on("forwardSend/V2NIMMessageService/modifyMsg",this.onV2ModifyMsg),this.core.eventBus.on("forwardSend/V2NIMMessageService/revokeMessage",this.onV2RevokeMessage),this.core.eventBus.on("forwardSend/V2NIMMessageService/deleteSelfMsgs",this.onV2DeleteSelfMsgs),this.core.eventBus.on("forwardSend/V2NIMMessageLogService/clearHistoryMessage",this.onV2ClearHistoryMessage),this.core.eventBus.on("forwardSend/team/created",this.onV1TeamCreated),this.core.eventBus.on("forwardSend/team/updateMyMemberInfo",this.onV1TeamMemberUpdate),this.core.eventBus.on("forwardSend/superTeam/updateMyMemberInfo",this.onV1SuperTeamMemberUpdate),this.core.eventBus.on("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",this.onV2TeamMemberUpdate),this.core.eventBus.on("forwardSend/team/passTeamApply",(e,t)=>this.onV1TeamApply(e,1,1,t)),this.core.eventBus.on("forwardSend/superTeam/passSuperTeamApply",(e,t)=>{this.onV1TeamApply(e,2,1,t)}),this.core.eventBus.on("forwardSend/team/rejectTeamApply",(e,t)=>{this.onV1TeamApply(e,1,2,t)}),this.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamApply",(e,t)=>{this.onV1TeamApply(e,2,2,t)}),this.core.eventBus.on("forwardSend/team/acceptTeamInvite",(e,t)=>{this.onV1TeamInvite(e,1,1,t)}),this.core.eventBus.on("forwardSend/superTeam/acceptSuperTeamInvite",(e,t)=>{this.onV1TeamInvite(e,2,1,t)}),this.core.eventBus.on("forwardSend/team/rejectTeamInvite",(e,t)=>{this.onV1TeamInvite(e,1,2,t)}),this.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamInvite",(e,t)=>{this.onV1TeamInvite(e,2,2,t)}),this.core.eventBus.on("forwardSend/user/updateBlackList",this.onV1UpdateBlackList),this.core.eventBus.on("forwardSend/user/updateUserInfo",this.onV1UpdateUserInfo),this.core.eventBus.on("forwardSend/user/setMute",this.onV1SetMute),this.core.eventBus.on("forwardSend/friend/addFriend",this.onV1AddFriend),this.core.eventBus.on("forwardSend/friend/deleteFriend",this.onV1DeleteFriend),this.core.eventBus.on("forwardSend/friend/updateFriend",this.onV1UpdateFriend),this.core.eventBus.on("forwardSend/friend/passFriendApply",this.onV1PassFriendApply),this.core.eventBus.on("forwardSend/friend/rejectFriendApply",this.onV1RejectFriendApply)},this.onV1TeamApply=(e,t,n,r)=>{if(r){if(!this.core.V2NIMTeamService.notification.checkIfExpired(r))return;n=3}this.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:e.teamId,teamType:t,operatorAccountId:e.from,actionType:0},n)},this.onV1TeamInvite=(e,t,n,r)=>{if(r){if(!this.core.V2NIMTeamService.notification.checkIfExpired(r.code))return;n=3}this.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:e.teamId,teamType:t,operatorAccountId:e.from,actionType:2},n)},this.onV1PassFriendApply=(e,t)=>{this.core.eventBus.emit("forwardReceive/V2NIMFriendService/acceptAddApplication",e,t)},this.onV1RejectFriendApply=(e,t,n)=>{this.core.eventBus.emit("forwardReceive/V2NIMFriendService/rejectAddApplication",{applicantAccountId:e,recipientAccountId:this.core.account,operatorAccountId:this.core.account,postscript:t||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:3},n)},this.onV1SetMute=(e,t)=>{this.core.eventBus.emit("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",e,t?1:0)},this.onV1UpdateFriend=e=>{this.core.eventBus.emit("forwardReceive/V2NIMFriendService/setFriendInfo",e.account,Object.assign(Object.assign({},"alias"in e?{alias:e.alias}:{}),"ext"in e?{serverExtension:e.ext}:{}))},this.onV1AddFriend=e=>{this.core.eventBus.emit("forwardReceive/V2NIMFriendService/addFriend",e)},this.onV1DeleteFriend=e=>{this.core.eventBus.emit("forwardReceive/V2NIMFriendService/deleteFriend",e)},this.onV1UpdateUserInfo=e=>{var t=qt(jt(e,zr.user),Wt(Pp));this.core.eventBus.emit("forwardReceive/V2NIMUserService/updateUserProfile",t)},this.onV1UpdateBlackList=(e,t)=>{this.core.eventBus.emit("forwardReceive/V2NIMUserService/updateBlockList",e,t)},this.onV1TeamCreated=e=>{var t=qt(jt(xr(e),qr.team),Wt(Bl));this.core.eventBus.emit("forwardReceive/V2NIMTeamService/created",t)},this.onV1TeamMemberUpdate=e=>{(e=Object.assign({},e)).type&&(e.type={normal:0,owner:1,manager:2}[e.type]);var t=qt(jt(e,qr.teamMember),Wt(Fl));t.teamType=1,this.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",t)},this.onV1SuperTeamMemberUpdate=e=>{(e=Object.assign({},e)).type&&(e.type={normal:0,owner:1,manager:2}[e.type]);var t=qt(jt(e,ts.superTeamMember),Wt(jl));t.teamType=2,this.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",t)},this.onV2TeamMemberUpdate=e=>{var t=e.teamType,n=jt(e,Fl);if(2===t){var r=qt(n,Wt(ts.superTeamMember));this.core.eventBus.emit("forwardReceive/superTeam/updateMyMemberInfo",r)}else{var i=qt(n,Wt(qr.teamMember));this.core.eventBus.emit("forwardReceive/team/updateMyMemberInfo",i)}},this.onV1SendMsg=e=>{var t=qt(jt(e,fi),dd);(t=Jl(this.core,t)).sendingState="sending"===e.status?3:"sent"===e.status?1:2,this.core.eventBus.emit("forwardReceive/V2NIMMessageService/sendMsg",t)},this.onV2SendMsg=e=>{var t=qt(jt(e,ld),Wt(fi));t.status=3===e.sendingState?"sending":1===e.sendingState?"sent":"sendFailed",this.core.eventBus.emit("forwardReceive/msg/sendMsg",t)},this.onV2ModifyMsg=e=>{var t=qt(jt(e,ld),Wt(fi));this.core.eventBus.emit("forwardReceive/msg/modifyMsg",t)},this.onV1RecallMsg=e=>{e.deleteMsgCreatetime=e.time;var t=qt(jt(e,vi.recallMsgTag),Wt(hd));this.core.eventBus.emit("forwardReceive/V2NIMMessageService/revokeMessages",[t])},this.onV2RevokeMessage=e=>{var t=qt(jt(e,hd),yi.recallMsgTag);this.core.eventBus.emit("forwardReceive/msg/recallMsg",t)},this.onV1DeleteSelfMsgs=e=>{var t=e.map(e=>qt(jt(e,vi.deleteSelfMsgTag),Wt(ud)));t.forEach(e=>{e.messageRefer=Zl(this.core,e.messageRefer)}),this.core.eventBus.emit("forwardReceive/V2NIMMessageService/deleteMessages",t)},this.onV2DeleteSelfMsgs=e=>{var t=e.map(e=>qt(jt(e,ud),yi.deleteSelfMsgTag));this.core.eventBus.emit("forwardReceive/msg/deleteSelfMsgs",t)},this.onV1ClearHistoryMessage=e=>{var t=qt(jt(e,ao.clearHistoryMsgsFromServerReqTag),Wt(Bu));this.core.eventBus.emit("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",t)},this.onV2ClearHistoryMessage=e=>{var t=qt(jt(e,Bu),co.clearHistoryMsgsFromServerReqTag);this.core.eventBus.emit("forwardReceive/msgLog/clearHistoryMsgsFromServer",t)},this.core=e,this.bindEvents()}},"eventForwardCenter"),e.V2NIMConst=ue,e.default=yt,Object.defineProperty(e,"__esModule",{value:!0})}(NIM_UNIAPP_SDK.exports);var NIM_UNIAPP_SDKExports=NIM_UNIAPP_SDK.exports;const NIM=getDefaultExportFromCjs(NIM_UNIAPP_SDKExports);function die(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw new Error("number"==typeof e?"[MobX] minified error nr: "+e+(n.length?" "+n.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+e)}var mockGlobal={};function getGlobal(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:mockGlobal}var assign=Object.assign,getDescriptor=Object.getOwnPropertyDescriptor,defineProperty=Object.defineProperty,objectPrototype=Object.prototype,EMPTY_ARRAY=[];Object.freeze(EMPTY_ARRAY);var EMPTY_OBJECT={};Object.freeze(EMPTY_OBJECT);var hasProxy="undefined"!=typeof Proxy,plainObjectString=Object.toString();function assertProxies(){hasProxy||die("Proxy not available")}function once(e){var t=!1;return function(){if(!t)return t=!0,e.apply(this,arguments)}}var noop=function(){};function isFunction$1(e){return"function"==typeof e}function isStringish(e){switch(typeof e){case"string":case"symbol":case"number":return!0}return!1}function isObject$1(e){return null!==e&&"object"==typeof e}function isPlainObject$1(e){if(!isObject$1(e))return!1;var t=Object.getPrototypeOf(e);if(null==t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n.toString()===plainObjectString}function isGenerator(e){var t=null==e?void 0:e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName)}function addHiddenProp(e,t,n){defineProperty(e,t,{enumerable:!1,writable:!0,configurable:!0,value:n})}function addHiddenFinalProp(e,t,n){defineProperty(e,t,{enumerable:!1,writable:!1,configurable:!0,value:n})}function createInstanceofPredicate(e,t){var n="isMobX"+e;return t.prototype[n]=!0,function(e){return isObject$1(e)&&!0===e[n]}}function isES6Map(e){return null!=e&&"[object Map]"===Object.prototype.toString.call(e)}function isPlainES6Map(e){var t=Object.getPrototypeOf(e),n=Object.getPrototypeOf(t);return null===Object.getPrototypeOf(n)}function isES6Set(e){return null!=e&&"[object Set]"===Object.prototype.toString.call(e)}var hasGetOwnPropertySymbols=void 0!==Object.getOwnPropertySymbols;function getPlainObjectKeys(e){var t=Object.keys(e);if(!hasGetOwnPropertySymbols)return t;var n=Object.getOwnPropertySymbols(e);return n.length?[].concat(t,n.filter(function(t){return objectPrototype.propertyIsEnumerable.call(e,t)})):t}var ownKeys="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:hasGetOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function toPrimitive(e){return null===e?null:"object"==typeof e?""+e:e}function hasProp(e,t){return objectPrototype.hasOwnProperty.call(e,t)}var getOwnPropertyDescriptors=Object.getOwnPropertyDescriptors||function(e){var t={};return ownKeys(e).forEach(function(n){t[n]=getDescriptor(e,n)}),t};function getFlag(e,t){return!!(e&t)}function setFlag(e,t,n){return n?e|=t:e&=~t,e}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _createForOfIteratorHelperLoose(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_extends.apply(null,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _toPrimitive(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:t+""}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}var storedAnnotationsSymbol=Symbol("mobx-stored-annotations");function createDecoratorAnnotation(e){return Object.assign(function(t,n){if(is20223Decorator(n))return e.decorate_20223_(t,n);storeAnnotation(t,n,e)},e)}function storeAnnotation(e,t,n){hasProp(e,storedAnnotationsSymbol)||addHiddenProp(e,storedAnnotationsSymbol,_extends({},e[storedAnnotationsSymbol])),isOverride(n)||(e[storedAnnotationsSymbol][t]=n)}function is20223Decorator(e){return"object"==typeof e&&"string"==typeof e.kind}var $mobx=Symbol("mobx administration"),Atom=function(){function e(e){void 0===e&&(e="Atom"),this.name_=void 0,this.flags_=0,this.observers_=new Set,this.lastAccessedBy_=0,this.lowestObserverState_=IDerivationState_.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=e}var t=e.prototype;return t.onBO=function(){this.onBOL&&this.onBOL.forEach(function(e){return e()})},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(e){return e()})},t.reportObserved=function(){return reportObserved(this)},t.reportChanged=function(){startBatch(),propagateChanged(this),endBatch()},t.toString=function(){return this.name_},_createClass(e,[{key:"isBeingObserved",get:function(){return getFlag(this.flags_,e.isBeingObservedMask_)},set:function(t){this.flags_=setFlag(this.flags_,e.isBeingObservedMask_,t)}},{key:"isPendingUnobservation",get:function(){return getFlag(this.flags_,e.isPendingUnobservationMask_)},set:function(t){this.flags_=setFlag(this.flags_,e.isPendingUnobservationMask_,t)}},{key:"diffValue",get:function(){return getFlag(this.flags_,e.diffValueMask_)?1:0},set:function(t){this.flags_=setFlag(this.flags_,e.diffValueMask_,1===t)}}])}();Atom.isBeingObservedMask_=1,Atom.isPendingUnobservationMask_=2,Atom.diffValueMask_=4;var isAtom=createInstanceofPredicate("Atom",Atom);function createAtom(e,t,n){void 0===t&&(t=noop),void 0===n&&(n=noop);var r=new Atom(e);return t!==noop&&onBecomeObserved(r,t),n!==noop&&onBecomeUnobserved(r,n),r}function identityComparer(e,t){return e===t}function structuralComparer(e,t){return deepEqual(e,t)}function shallowComparer(e,t){return deepEqual(e,t,1)}function defaultComparer(e,t){return Object.is?Object.is(e,t):e===t?0!==e||1/e==1/t:e!=e&&t!=t}var comparer={identity:identityComparer,structural:structuralComparer,default:defaultComparer,shallow:shallowComparer};function deepEnhancer(e,t,n){return isObservable(e)?e:Array.isArray(e)?observable.array(e,{name:n}):isPlainObject$1(e)?observable.object(e,void 0,{name:n}):isES6Map(e)?observable.map(e,{name:n}):isES6Set(e)?observable.set(e,{name:n}):"function"!=typeof e||isAction(e)||isFlow(e)?e:isGenerator(e)?flow(e):autoAction(n,e)}function shallowEnhancer(e,t,n){return null==e||isObservableObject(e)||isObservableArray(e)||isObservableMap(e)||isObservableSet(e)?e:Array.isArray(e)?observable.array(e,{name:n,deep:!1}):isPlainObject$1(e)?observable.object(e,void 0,{name:n,deep:!1}):isES6Map(e)?observable.map(e,{name:n,deep:!1}):isES6Set(e)?observable.set(e,{name:n,deep:!1}):void 0}function referenceEnhancer(e){return e}function refStructEnhancer(e,t){return deepEqual(e,t)?t:e}var OVERRIDE="override";function isOverride(e){return e.annotationType_===OVERRIDE}function createActionAnnotation(e,t){return{annotationType_:e,options_:t,make_:make_$1,extend_:extend_$1,decorate_20223_:decorate_20223_$1}}function make_$1(e,t,n,r){var i;if(null!=(i=this.options_)&&i.bound)return null===this.extend_(e,t,n,!1)?0:1;if(r===e.target_)return null===this.extend_(e,t,n,!1)?0:2;if(isAction(n.value))return 1;var o=createActionDescriptor(e,this,t,n,!1);return defineProperty(r,t,o),2}function extend_$1(e,t,n,r){var i=createActionDescriptor(e,this,t,n);return e.defineProperty_(t,i,r)}function decorate_20223_$1(e,t){var n,r=t.kind,i=t.name,o=t.addInitializer,s=this,a=function(e){var t,n,r,o;return createAction(null!=(t=null==(n=s.options_)?void 0:n.name)?t:i.toString(),e,null!=(r=null==(o=s.options_)?void 0:o.autoAction)&&r)};return"field"==r?function(e){var t,n=e;return isAction(n)||(n=a(n)),null!=(t=s.options_)&&t.bound&&((n=n.bind(this)).isMobxAction=!0),n}:"method"==r?(isAction(e)||(e=a(e)),null!=(n=this.options_)&&n.bound&&o(function(){var e=this,t=e[i].bind(e);t.isMobxAction=!0,e[i]=t}),e):void die("Cannot apply '"+s.annotationType_+"' to '"+String(i)+"' (kind: "+r+"):\n'"+s.annotationType_+"' can only be used on properties with a function value.")}function assertActionDescriptor(e,t,n,r){t.annotationType_,r.value}function createActionDescriptor(e,t,n,r,i){var o,s,a,c,l,d,u;void 0===i&&(i=globalState.safeDescriptors),assertActionDescriptor(e,t,n,r);var p,h=r.value;null!=(o=t.options_)&&o.bound&&(h=h.bind(null!=(p=e.proxy_)?p:e.target_));return{value:createAction(null!=(s=null==(a=t.options_)?void 0:a.name)?s:n.toString(),h,null!=(c=null==(l=t.options_)?void 0:l.autoAction)&&c,null!=(d=t.options_)&&d.bound?null!=(u=e.proxy_)?u:e.target_:void 0),configurable:!i||e.isPlainObject_,enumerable:!1,writable:!i}}function createFlowAnnotation(e,t){return{annotationType_:e,options_:t,make_:make_$2,extend_:extend_$2,decorate_20223_:decorate_20223_$2}}function make_$2(e,t,n,r){var i;if(r===e.target_)return null===this.extend_(e,t,n,!1)?0:2;if(null!=(i=this.options_)&&i.bound&&(!hasProp(e.target_,t)||!isFlow(e.target_[t]))&&null===this.extend_(e,t,n,!1))return 0;if(isFlow(n.value))return 1;var o=createFlowDescriptor(e,this,t,n,!1,!1);return defineProperty(r,t,o),2}function extend_$2(e,t,n,r){var i,o=createFlowDescriptor(e,this,t,n,null==(i=this.options_)?void 0:i.bound);return e.defineProperty_(t,o,r)}function decorate_20223_$2(e,t){var n,r=t.name,i=t.addInitializer;return isFlow(e)||(e=flow(e)),null!=(n=this.options_)&&n.bound&&i(function(){var e=this,t=e[r].bind(e);t.isMobXFlow=!0,e[r]=t}),e}function assertFlowDescriptor(e,t,n,r){t.annotationType_,r.value}function createFlowDescriptor(e,t,n,r,i,o){void 0===o&&(o=globalState.safeDescriptors),assertFlowDescriptor(e,t,n,r);var s,a=r.value;(isFlow(a)||(a=flow(a)),i)&&((a=a.bind(null!=(s=e.proxy_)?s:e.target_)).isMobXFlow=!0);return{value:a,configurable:!o||e.isPlainObject_,enumerable:!1,writable:!o}}function createComputedAnnotation(e,t){return{annotationType_:e,options_:t,make_:make_$3,extend_:extend_$3,decorate_20223_:decorate_20223_$3}}function make_$3(e,t,n){return null===this.extend_(e,t,n,!1)?0:1}function extend_$3(e,t,n,r){return assertComputedDescriptor(e,this,t,n),e.defineComputedProperty_(t,_extends({},this.options_,{get:n.get,set:n.set}),r)}function decorate_20223_$3(e,t){var n=this,r=t.name;return(0,t.addInitializer)(function(){var t=asObservableObject(this)[$mobx],i=_extends({},n.options_,{get:e,context:this});i.name||(i.name="ObservableObject."+r.toString()),t.values_.set(r,new ComputedValue(i))}),function(){return this[$mobx].getObservablePropValue_(r)}}function assertComputedDescriptor(e,t,n,r){t.annotationType_,r.get}function createObservableAnnotation(e,t){return{annotationType_:e,options_:t,make_:make_$4,extend_:extend_$4,decorate_20223_:decorate_20223_$4}}function make_$4(e,t,n){return null===this.extend_(e,t,n,!1)?0:1}function extend_$4(e,t,n,r){var i,o;return assertObservableDescriptor(e,this),e.defineObservableProperty_(t,n.value,null!=(i=null==(o=this.options_)?void 0:o.enhancer)?i:deepEnhancer,r)}function decorate_20223_$4(e,t){var n=this,r=t.kind,i=t.name,o=new WeakSet;function s(e,t){var r,s,a=asObservableObject(e)[$mobx],c=new ObservableValue(t,null!=(r=null==(s=n.options_)?void 0:s.enhancer)?r:deepEnhancer,"ObservableObject."+i.toString(),!1);a.values_.set(i,c),o.add(e)}if("accessor"==r)return{get:function(){return o.has(this)||s(this,e.get.call(this)),this[$mobx].getObservablePropValue_(i)},set:function(e){return o.has(this)||s(this,e),this[$mobx].setObservablePropValue_(i,e)},init:function(e){return o.has(this)||s(this,e),e}}}function assertObservableDescriptor(e,t,n,r){t.annotationType_}var AUTO="true",autoAnnotation=createAutoAnnotation();function createAutoAnnotation(e){return{annotationType_:AUTO,options_:e,make_:make_$5,extend_:extend_$5,decorate_20223_:decorate_20223_$5}}function make_$5(e,t,n,r){var i,o,s,a;if(n.get)return computed.make_(e,t,n,r);if(n.set){var c=createAction(t.toString(),n.set);return r===e.target_?null===e.defineProperty_(t,{configurable:!globalState.safeDescriptors||e.isPlainObject_,set:c})?0:2:(defineProperty(r,t,{configurable:!0,set:c}),2)}if(r!==e.target_&&"function"==typeof n.value)return isGenerator(n.value)?(null!=(a=this.options_)&&a.autoBind?flow.bound:flow).make_(e,t,n,r):(null!=(s=this.options_)&&s.autoBind?autoAction.bound:autoAction).make_(e,t,n,r);var l,d=!1===(null==(i=this.options_)?void 0:i.deep)?observable.ref:observable;"function"==typeof n.value&&null!=(o=this.options_)&&o.autoBind&&(n.value=n.value.bind(null!=(l=e.proxy_)?l:e.target_));return d.make_(e,t,n,r)}function extend_$5(e,t,n,r){var i,o,s;if(n.get)return computed.extend_(e,t,n,r);if(n.set)return e.defineProperty_(t,{configurable:!globalState.safeDescriptors||e.isPlainObject_,set:createAction(t.toString(),n.set)},r);"function"==typeof n.value&&null!=(i=this.options_)&&i.autoBind&&(n.value=n.value.bind(null!=(s=e.proxy_)?s:e.target_));return(!1===(null==(o=this.options_)?void 0:o.deep)?observable.ref:observable).extend_(e,t,n,r)}function decorate_20223_$5(e,t){die("'"+this.annotationType_+"' cannot be used as a decorator")}var OBSERVABLE="observable",OBSERVABLE_REF="observable.ref",OBSERVABLE_SHALLOW="observable.shallow",OBSERVABLE_STRUCT="observable.struct",defaultCreateObservableOptions={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};function asCreateObservableOptions(e){return e||defaultCreateObservableOptions}Object.freeze(defaultCreateObservableOptions);var observableAnnotation=createObservableAnnotation(OBSERVABLE),observableRefAnnotation=createObservableAnnotation(OBSERVABLE_REF,{enhancer:referenceEnhancer}),observableShallowAnnotation=createObservableAnnotation(OBSERVABLE_SHALLOW,{enhancer:shallowEnhancer}),observableStructAnnotation=createObservableAnnotation(OBSERVABLE_STRUCT,{enhancer:refStructEnhancer}),observableDecoratorAnnotation=createDecoratorAnnotation(observableAnnotation);function getEnhancerFromOptions(e){return!0===e.deep?deepEnhancer:!1===e.deep?referenceEnhancer:getEnhancerFromAnnotation(e.defaultDecorator)}function getAnnotationFromOptions(e){var t;return e?null!=(t=e.defaultDecorator)?t:createAutoAnnotation(e):void 0}function getEnhancerFromAnnotation(e){var t,n;return e&&null!=(t=null==(n=e.options_)?void 0:n.enhancer)?t:deepEnhancer}function createObservable(e,t,n){return is20223Decorator(t)?observableAnnotation.decorate_20223_(e,t):isStringish(t)?void storeAnnotation(e,t,observableAnnotation):isObservable(e)?e:isPlainObject$1(e)?observable.object(e,t,n):Array.isArray(e)?observable.array(e,t):isES6Map(e)?observable.map(e,t):isES6Set(e)?observable.set(e,t):"object"==typeof e&&null!==e?e:observable.box(e,t)}assign(createObservable,observableDecoratorAnnotation);var observableFactories={box:function(e,t){var n=asCreateObservableOptions(t);return new ObservableValue(e,getEnhancerFromOptions(n),n.name,!0,n.equals)},array:function(e,t){var n=asCreateObservableOptions(t);return(!1===globalState.useProxies||!1===n.proxy?createLegacyArray:createObservableArray)(e,getEnhancerFromOptions(n),n.name)},map:function(e,t){var n=asCreateObservableOptions(t);return new ObservableMap(e,getEnhancerFromOptions(n),n.name)},set:function(e,t){var n=asCreateObservableOptions(t);return new ObservableSet(e,getEnhancerFromOptions(n),n.name)},object:function(e,t,n){return initObservable(function(){return extendObservable(!1===globalState.useProxies||!1===(null==n?void 0:n.proxy)?asObservableObject({},n):asDynamicObservableObject({},n),e,t)})},ref:createDecoratorAnnotation(observableRefAnnotation),shallow:createDecoratorAnnotation(observableShallowAnnotation),deep:observableDecoratorAnnotation,struct:createDecoratorAnnotation(observableStructAnnotation)},observable=assign(createObservable,observableFactories),COMPUTED="computed",COMPUTED_STRUCT="computed.struct",computedAnnotation=createComputedAnnotation(COMPUTED),computedStructAnnotation=createComputedAnnotation(COMPUTED_STRUCT,{equals:comparer.structural}),computed=function(e,t){if(is20223Decorator(t))return computedAnnotation.decorate_20223_(e,t);if(isStringish(t))return storeAnnotation(e,t,computedAnnotation);if(isPlainObject$1(e))return createDecoratorAnnotation(createComputedAnnotation(COMPUTED,e));var n=isPlainObject$1(t)?t:{};return n.get=e,n.name||(n.name=e.name||""),new ComputedValue(n)},_getDescriptor$config,_getDescriptor;Object.assign(computed,computedAnnotation),computed.struct=createDecoratorAnnotation(computedStructAnnotation);var currentActionId=0,nextActionId=1,isFunctionNameConfigurable=null!=(_getDescriptor$config=null==(_getDescriptor=getDescriptor(function(){},"name"))?void 0:_getDescriptor.configurable)&&_getDescriptor$config,tmpNameDescriptor={value:"action",configurable:!0,writable:!1,enumerable:!1};function createAction(e,t,n,r){function i(){return executeAction(e,n,t,r||this,arguments)}return void 0===n&&(n=!1),i.isMobxAction=!0,i.toString=function(){return t.toString()},isFunctionNameConfigurable&&(tmpNameDescriptor.value=e,defineProperty(i,"name",tmpNameDescriptor)),i}function executeAction(e,t,n,r,i){var o=_startAction(e,t);try{return n.apply(r,i)}catch(s){throw o.error_=s,s}finally{_endAction(o)}}function _startAction(e,t,n,r){var i=globalState.trackingDerivation,o=!t||!i;startBatch();var s=globalState.allowStateChanges;o&&(untrackedStart(),s=allowStateChangesStart(!0));var a={runAsAction_:o,prevDerivation_:i,prevAllowStateChanges_:s,prevAllowStateReads_:allowStateReadsStart(!0),notifySpy_:!1,startTime_:0,actionId_:nextActionId++,parentActionId_:currentActionId};return currentActionId=a.actionId_,a}function _endAction(e){currentActionId!==e.actionId_&&die(30),currentActionId=e.parentActionId_,void 0!==e.error_&&(globalState.suppressReactionErrors=!0),allowStateChangesEnd(e.prevAllowStateChanges_),allowStateReadsEnd(e.prevAllowStateReads_),endBatch(),e.runAsAction_&&untrackedEnd(e.prevDerivation_),globalState.suppressReactionErrors=!1}function allowStateChangesStart(e){var t=globalState.allowStateChanges;return globalState.allowStateChanges=e,t}function allowStateChangesEnd(e){globalState.allowStateChanges=e}var ObservableValue=function(e){function t(t,n,r,i,o){var s;return void 0===r&&(r="ObservableValue"),void 0===o&&(o=comparer.default),(s=e.call(this,r)||this).enhancer=void 0,s.name_=void 0,s.equals=void 0,s.hasUnreportedChange_=!1,s.interceptors_=void 0,s.changeListeners_=void 0,s.value_=void 0,s.dehancer=void 0,s.enhancer=n,s.name_=r,s.equals=o,s.value_=n(t,void 0,r),s}_inheritsLoose(t,e);var n=t.prototype;return n.dehanceValue=function(e){return void 0!==this.dehancer?this.dehancer(e):e},n.set=function(e){this.value_,(e=this.prepareNewValue_(e))!==globalState.UNCHANGED&&this.setNewValue_(e)},n.prepareNewValue_=function(e){if(hasInterceptors(this)){var t=interceptChange(this,{object:this,type:UPDATE,newValue:e});if(!t)return globalState.UNCHANGED;e=t.newValue}return e=this.enhancer(e,this.value_,this.name_),this.equals(this.value_,e)?globalState.UNCHANGED:e},n.setNewValue_=function(e){var t=this.value_;this.value_=e,this.reportChanged(),hasListeners(this)&&notifyListeners(this,{type:UPDATE,object:this,newValue:e,oldValue:t})},n.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},n.intercept_=function(e){return registerInterceptor(this,e)},n.observe_=function(e,t){return t&&e({observableKind:"value",debugObjectName:this.name_,object:this,type:UPDATE,newValue:this.value_,oldValue:void 0}),registerListener(this,e)},n.raw=function(){return this.value_},n.toJSON=function(){return this.get()},n.toString=function(){return this.name_+"["+this.value_+"]"},n.valueOf=function(){return toPrimitive(this.get())},n[Symbol.toPrimitive]=function(){return this.valueOf()},t}(Atom),ComputedValue=function(){function e(e){this.dependenciesState_=IDerivationState_.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.observers_=new Set,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=IDerivationState_.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new CaughtException(null),this.name_=void 0,this.triggeredBy_=void 0,this.flags_=0,this.derivation=void 0,this.setter_=void 0,this.isTracing_=TraceMode.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,e.get||die(31),this.derivation=e.get,this.name_=e.name||"ComputedValue",e.set&&(this.setter_=createAction("ComputedValue-setter",e.set)),this.equals_=e.equals||(e.compareStructural||e.struct?comparer.structural:comparer.default),this.scope_=e.context,this.requiresReaction_=e.requiresReaction,this.keepAlive_=!!e.keepAlive}var t=e.prototype;return t.onBecomeStale_=function(){propagateMaybeChanged(this)},t.onBO=function(){this.onBOL&&this.onBOL.forEach(function(e){return e()})},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(e){return e()})},t.get=function(){if(this.isComputing&&die(32,this.name_,this.derivation),0!==globalState.inBatch||0!==this.observers_.size||this.keepAlive_){if(reportObserved(this),shouldCompute(this)){var e=globalState.trackingContext;this.keepAlive_&&!e&&(globalState.trackingContext=this),this.trackAndCompute()&&propagateChangeConfirmed(this),globalState.trackingContext=e}}else shouldCompute(this)&&(this.warnAboutUntrackedRead_(),startBatch(),this.value_=this.computeValue_(!1),endBatch());var t=this.value_;if(isCaughtException(t))throw t.cause;return t},t.set=function(e){if(this.setter_){this.isRunningSetter&&die(33,this.name_),this.isRunningSetter=!0;try{this.setter_.call(this.scope_,e)}finally{this.isRunningSetter=!1}}else die(34,this.name_)},t.trackAndCompute=function(){var e=this.value_,t=this.dependenciesState_===IDerivationState_.NOT_TRACKING_,n=this.computeValue_(!0),r=t||isCaughtException(e)||isCaughtException(n)||!this.equals_(e,n);return r&&(this.value_=n),r},t.computeValue_=function(e){this.isComputing=!0;var t,n=allowStateChangesStart(!1);if(e)t=trackDerivedFunction(this,this.derivation,this.scope_);else if(!0===globalState.disableErrorBoundaries)t=this.derivation.call(this.scope_);else try{t=this.derivation.call(this.scope_)}catch(r){t=new CaughtException(r)}return allowStateChangesEnd(n),this.isComputing=!1,t},t.suspend_=function(){this.keepAlive_||(clearObserving(this),this.value_=void 0)},t.observe_=function(e,t){var n=this,r=!0,i=void 0;return autorun(function(){var o=n.get();if(!r||t){var s=untrackedStart();e({observableKind:"computed",debugObjectName:n.name_,type:UPDATE,object:n,newValue:o,oldValue:i}),untrackedEnd(s)}r=!1,i=o})},t.warnAboutUntrackedRead_=function(){},t.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},t.valueOf=function(){return toPrimitive(this.get())},t[Symbol.toPrimitive]=function(){return this.valueOf()},_createClass(e,[{key:"isComputing",get:function(){return getFlag(this.flags_,e.isComputingMask_)},set:function(t){this.flags_=setFlag(this.flags_,e.isComputingMask_,t)}},{key:"isRunningSetter",get:function(){return getFlag(this.flags_,e.isRunningSetterMask_)},set:function(t){this.flags_=setFlag(this.flags_,e.isRunningSetterMask_,t)}},{key:"isBeingObserved",get:function(){return getFlag(this.flags_,e.isBeingObservedMask_)},set:function(t){this.flags_=setFlag(this.flags_,e.isBeingObservedMask_,t)}},{key:"isPendingUnobservation",get:function(){return getFlag(this.flags_,e.isPendingUnobservationMask_)},set:function(t){this.flags_=setFlag(this.flags_,e.isPendingUnobservationMask_,t)}},{key:"diffValue",get:function(){return getFlag(this.flags_,e.diffValueMask_)?1:0},set:function(t){this.flags_=setFlag(this.flags_,e.diffValueMask_,1===t)}}])}();ComputedValue.isComputingMask_=1,ComputedValue.isRunningSetterMask_=2,ComputedValue.isBeingObservedMask_=4,ComputedValue.isPendingUnobservationMask_=8,ComputedValue.diffValueMask_=16;var isComputedValue=createInstanceofPredicate("ComputedValue",ComputedValue),IDerivationState_,IDerivationState_2,TraceMode,TraceMode2;IDerivationState_2=IDerivationState_||(IDerivationState_={}),IDerivationState_2[IDerivationState_2.NOT_TRACKING_=-1]="NOT_TRACKING_",IDerivationState_2[IDerivationState_2.UP_TO_DATE_=0]="UP_TO_DATE_",IDerivationState_2[IDerivationState_2.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",IDerivationState_2[IDerivationState_2.STALE_=2]="STALE_",TraceMode2=TraceMode||(TraceMode={}),TraceMode2[TraceMode2.NONE=0]="NONE",TraceMode2[TraceMode2.LOG=1]="LOG",TraceMode2[TraceMode2.BREAK=2]="BREAK";var CaughtException=function(e){this.cause=void 0,this.cause=e};function isCaughtException(e){return e instanceof CaughtException}function shouldCompute(e){switch(e.dependenciesState_){case IDerivationState_.UP_TO_DATE_:return!1;case IDerivationState_.NOT_TRACKING_:case IDerivationState_.STALE_:return!0;case IDerivationState_.POSSIBLY_STALE_:for(var t=allowStateReadsStart(!0),n=untrackedStart(),r=e.observing_,i=r.length,o=0;o<i;o++){var s=r[o];if(isComputedValue(s)){if(globalState.disableErrorBoundaries)s.get();else try{s.get()}catch(a){return untrackedEnd(n),allowStateReadsEnd(t),!0}if(e.dependenciesState_===IDerivationState_.STALE_)return untrackedEnd(n),allowStateReadsEnd(t),!0}}return changeDependenciesStateTo0(e),untrackedEnd(n),allowStateReadsEnd(t),!1}}function checkIfStateModificationsAreAllowed(e){}function trackDerivedFunction(e,t,n){var r=allowStateReadsStart(!0);changeDependenciesStateTo0(e),e.newObserving_=new Array(0===e.runId_?100:e.observing_.length),e.unboundDepsCount_=0,e.runId_=++globalState.runId;var i,o=globalState.trackingDerivation;if(globalState.trackingDerivation=e,globalState.inBatch++,!0===globalState.disableErrorBoundaries)i=t.call(n);else try{i=t.call(n)}catch(s){i=new CaughtException(s)}return globalState.inBatch--,globalState.trackingDerivation=o,bindDependencies(e),allowStateReadsEnd(r),i}function bindDependencies(e){for(var t=e.observing_,n=e.observing_=e.newObserving_,r=IDerivationState_.UP_TO_DATE_,i=0,o=e.unboundDepsCount_,s=0;s<o;s++){var a=n[s];0===a.diffValue&&(a.diffValue=1,i!==s&&(n[i]=a),i++),a.dependenciesState_>r&&(r=a.dependenciesState_)}for(n.length=i,e.newObserving_=null,o=t.length;o--;){var c=t[o];0===c.diffValue&&removeObserver(c,e),c.diffValue=0}for(;i--;){var l=n[i];1===l.diffValue&&(l.diffValue=0,addObserver(l,e))}r!==IDerivationState_.UP_TO_DATE_&&(e.dependenciesState_=r,e.onBecomeStale_())}function clearObserving(e){var t=e.observing_;e.observing_=[];for(var n=t.length;n--;)removeObserver(t[n],e);e.dependenciesState_=IDerivationState_.NOT_TRACKING_}function untracked(e){var t=untrackedStart();try{return e()}finally{untrackedEnd(t)}}function untrackedStart(){var e=globalState.trackingDerivation;return globalState.trackingDerivation=null,e}function untrackedEnd(e){globalState.trackingDerivation=e}function allowStateReadsStart(e){var t=globalState.allowStateReads;return globalState.allowStateReads=e,t}function allowStateReadsEnd(e){globalState.allowStateReads=e}function changeDependenciesStateTo0(e){if(e.dependenciesState_!==IDerivationState_.UP_TO_DATE_){e.dependenciesState_=IDerivationState_.UP_TO_DATE_;for(var t=e.observing_,n=t.length;n--;)t[n].lowestObserverState_=IDerivationState_.UP_TO_DATE_}}var MobXGlobals=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},canMergeGlobalState=!0,globalState=function(){var e=getGlobal();return e.__mobxInstanceCount>0&&!e.__mobxGlobals&&(canMergeGlobalState=!1),e.__mobxGlobals&&e.__mobxGlobals.version!==(new MobXGlobals).version&&(canMergeGlobalState=!1),canMergeGlobalState?e.__mobxGlobals?(e.__mobxInstanceCount+=1,e.__mobxGlobals.UNCHANGED||(e.__mobxGlobals.UNCHANGED={}),e.__mobxGlobals):(e.__mobxInstanceCount=1,e.__mobxGlobals=new MobXGlobals):(setTimeout(function(){die(35)},1),new MobXGlobals)}();function addObserver(e,t){e.observers_.add(t),e.lowestObserverState_>t.dependenciesState_&&(e.lowestObserverState_=t.dependenciesState_)}function removeObserver(e,t){e.observers_.delete(t),0===e.observers_.size&&queueForUnobservation(e)}function queueForUnobservation(e){!1===e.isPendingUnobservation&&(e.isPendingUnobservation=!0,globalState.pendingUnobservations.push(e))}function startBatch(){globalState.inBatch++}function endBatch(){if(0===--globalState.inBatch){runReactions();for(var e=globalState.pendingUnobservations,t=0;t<e.length;t++){var n=e[t];n.isPendingUnobservation=!1,0===n.observers_.size&&(n.isBeingObserved&&(n.isBeingObserved=!1,n.onBUO()),n instanceof ComputedValue&&n.suspend_())}globalState.pendingUnobservations=[]}}function reportObserved(e){var t=globalState.trackingDerivation;return null!==t?(t.runId_!==e.lastAccessedBy_&&(e.lastAccessedBy_=t.runId_,t.newObserving_[t.unboundDepsCount_++]=e,!e.isBeingObserved&&globalState.trackingContext&&(e.isBeingObserved=!0,e.onBO())),e.isBeingObserved):(0===e.observers_.size&&globalState.inBatch>0&&queueForUnobservation(e),!1)}function propagateChanged(e){e.lowestObserverState_!==IDerivationState_.STALE_&&(e.lowestObserverState_=IDerivationState_.STALE_,e.observers_.forEach(function(e){e.dependenciesState_===IDerivationState_.UP_TO_DATE_&&e.onBecomeStale_(),e.dependenciesState_=IDerivationState_.STALE_}))}function propagateChangeConfirmed(e){e.lowestObserverState_!==IDerivationState_.STALE_&&(e.lowestObserverState_=IDerivationState_.STALE_,e.observers_.forEach(function(t){t.dependenciesState_===IDerivationState_.POSSIBLY_STALE_?t.dependenciesState_=IDerivationState_.STALE_:t.dependenciesState_===IDerivationState_.UP_TO_DATE_&&(e.lowestObserverState_=IDerivationState_.UP_TO_DATE_)}))}function propagateMaybeChanged(e){e.lowestObserverState_===IDerivationState_.UP_TO_DATE_&&(e.lowestObserverState_=IDerivationState_.POSSIBLY_STALE_,e.observers_.forEach(function(e){e.dependenciesState_===IDerivationState_.UP_TO_DATE_&&(e.dependenciesState_=IDerivationState_.POSSIBLY_STALE_,e.onBecomeStale_())}))}var Reaction=function(){function e(e,t,n,r){void 0===e&&(e="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=IDerivationState_.NOT_TRACKING_,this.runId_=0,this.unboundDepsCount_=0,this.flags_=0,this.isTracing_=TraceMode.NONE,this.name_=e,this.onInvalidate_=t,this.errorHandler_=n,this.requiresObservable_=r}var t=e.prototype;return t.onBecomeStale_=function(){this.schedule_()},t.schedule_=function(){this.isScheduled||(this.isScheduled=!0,globalState.pendingReactions.push(this),runReactions())},t.runReaction_=function(){if(!this.isDisposed){startBatch(),this.isScheduled=!1;var e=globalState.trackingContext;if(globalState.trackingContext=this,shouldCompute(this)){this.isTrackPending=!0;try{this.onInvalidate_()}catch(t){this.reportExceptionInDerivation_(t)}}globalState.trackingContext=e,endBatch()}},t.track=function(e){if(!this.isDisposed){startBatch(),this.isRunning=!0;var t=globalState.trackingContext;globalState.trackingContext=this;var n=trackDerivedFunction(this,e,void 0);globalState.trackingContext=t,this.isRunning=!1,this.isTrackPending=!1,this.isDisposed&&clearObserving(this),isCaughtException(n)&&this.reportExceptionInDerivation_(n.cause),endBatch()}},t.reportExceptionInDerivation_=function(e){var t=this;if(this.errorHandler_)this.errorHandler_(e,this);else{if(globalState.disableErrorBoundaries)throw e;var n="[mobx] uncaught error in '"+this+"'";globalState.suppressReactionErrors||console.error(n,e),globalState.globalReactionErrorHandlers.forEach(function(n){return n(e,t)})}},t.dispose=function(){this.isDisposed||(this.isDisposed=!0,this.isRunning||(startBatch(),clearObserving(this),endBatch()))},t.getDisposer_=function(e){var t=this,n=function n(){t.dispose(),null==e||null==e.removeEventListener||e.removeEventListener("abort",n)};return null==e||null==e.addEventListener||e.addEventListener("abort",n),n[$mobx]=this,n},t.toString=function(){return"Reaction["+this.name_+"]"},t.trace=function(e){},_createClass(e,[{key:"isDisposed",get:function(){return getFlag(this.flags_,e.isDisposedMask_)},set:function(t){this.flags_=setFlag(this.flags_,e.isDisposedMask_,t)}},{key:"isScheduled",get:function(){return getFlag(this.flags_,e.isScheduledMask_)},set:function(t){this.flags_=setFlag(this.flags_,e.isScheduledMask_,t)}},{key:"isTrackPending",get:function(){return getFlag(this.flags_,e.isTrackPendingMask_)},set:function(t){this.flags_=setFlag(this.flags_,e.isTrackPendingMask_,t)}},{key:"isRunning",get:function(){return getFlag(this.flags_,e.isRunningMask_)},set:function(t){this.flags_=setFlag(this.flags_,e.isRunningMask_,t)}},{key:"diffValue",get:function(){return getFlag(this.flags_,e.diffValueMask_)?1:0},set:function(t){this.flags_=setFlag(this.flags_,e.diffValueMask_,1===t)}}])}();Reaction.isDisposedMask_=1,Reaction.isScheduledMask_=2,Reaction.isTrackPendingMask_=4,Reaction.isRunningMask_=8,Reaction.diffValueMask_=16;var MAX_REACTION_ITERATIONS=100,reactionScheduler=function(e){return e()};function runReactions(){globalState.inBatch>0||globalState.isRunningReactions||reactionScheduler(runReactionsHelper)}function runReactionsHelper(){globalState.isRunningReactions=!0;for(var e=globalState.pendingReactions,t=0;e.length>0;){++t===MAX_REACTION_ITERATIONS&&(console.error("[mobx] cycle in reaction: "+e[0]),e.splice(0));for(var n=e.splice(0),r=0,i=n.length;r<i;r++)n[r].runReaction_()}globalState.isRunningReactions=!1}var isReaction=createInstanceofPredicate("Reaction",Reaction);function isSpyEnabled(){return!1}function spyReport(e){}function spyReportStart(e){}function spyReportEnd(e){}function spy(e){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}var ACTION="action",ACTION_BOUND="action.bound",AUTOACTION="autoAction",AUTOACTION_BOUND="autoAction.bound",DEFAULT_ACTION_NAME="<unnamed action>",actionAnnotation=createActionAnnotation(ACTION),actionBoundAnnotation=createActionAnnotation(ACTION_BOUND,{bound:!0}),autoActionAnnotation=createActionAnnotation(AUTOACTION,{autoAction:!0}),autoActionBoundAnnotation=createActionAnnotation(AUTOACTION_BOUND,{autoAction:!0,bound:!0});function createActionFactory(e){return function(t,n){return isFunction$1(t)?createAction(t.name||DEFAULT_ACTION_NAME,t,e):isFunction$1(n)?createAction(t,n,e):is20223Decorator(n)?(e?autoActionAnnotation:actionAnnotation).decorate_20223_(t,n):isStringish(n)?storeAnnotation(t,n,e?autoActionAnnotation:actionAnnotation):isStringish(t)?createDecoratorAnnotation(createActionAnnotation(e?AUTOACTION:ACTION,{name:t,autoAction:e})):void 0}}var action=createActionFactory(!1);Object.assign(action,actionAnnotation);var autoAction=createActionFactory(!0);function isAction(e){return isFunction$1(e)&&!0===e.isMobxAction}function autorun(e,t){var n,r,i,o;void 0===t&&(t=EMPTY_OBJECT);var s,a=null!=(n=null==(r=t)?void 0:r.name)?n:"Autorun";if(!t.scheduler&&!t.delay)s=new Reaction(a,function(){this.track(d)},t.onError,t.requiresObservable);else{var c=createSchedulerFromOptions(t),l=!1;s=new Reaction(a,function(){l||(l=!0,c(function(){l=!1,s.isDisposed||s.track(d)}))},t.onError,t.requiresObservable)}function d(){e(s)}return null!=(i=t)&&null!=(i=i.signal)&&i.aborted||s.schedule_(),s.getDisposer_(null==(o=t)?void 0:o.signal)}Object.assign(autoAction,autoActionAnnotation),action.bound=createDecoratorAnnotation(actionBoundAnnotation),autoAction.bound=createDecoratorAnnotation(autoActionBoundAnnotation);var run=function(e){return e()};function createSchedulerFromOptions(e){return e.scheduler?e.scheduler:e.delay?function(t){return setTimeout(t,e.delay)}:run}var ON_BECOME_OBSERVED="onBO",ON_BECOME_UNOBSERVED="onBUO";function onBecomeObserved(e,t,n){return interceptHook(ON_BECOME_OBSERVED,e,t,n)}function onBecomeUnobserved(e,t,n){return interceptHook(ON_BECOME_UNOBSERVED,e,t,n)}function interceptHook(e,t,n,r){var i="function"==typeof r?getAtom(t,n):getAtom(t),o=isFunction$1(r)?r:n,s=e+"L";return i[s]?i[s].add(o):i[s]=new Set([o]),function(){var e=i[s];e&&(e.delete(o),0===e.size&&delete i[s])}}function extendObservable(e,t,n,r){var i=getOwnPropertyDescriptors(t);return initObservable(function(){var t=asObservableObject(e,r)[$mobx];ownKeys(i).forEach(function(e){t.extend_(e,i[e],!n||(!(e in n)||n[e]))})}),e}var generatorId=0;function FlowCancellationError(){this.message="FLOW_CANCELLED"}FlowCancellationError.prototype=Object.create(Error.prototype);var flowAnnotation=createFlowAnnotation("flow"),flowBoundAnnotation=createFlowAnnotation("flow.bound",{bound:!0}),flow=Object.assign(function(e,t){if(is20223Decorator(t))return flowAnnotation.decorate_20223_(e,t);if(isStringish(t))return storeAnnotation(e,t,flowAnnotation);var n=e,r=n.name||"<unnamed flow>",i=function(){var e,t=arguments,i=++generatorId,o=action(r+" - runid: "+i+" - init",n).apply(this,t),s=void 0,a=new Promise(function(t,n){var a=0;function c(e){var t;s=void 0;try{t=action(r+" - runid: "+i+" - yield "+a++,o.next).call(o,e)}catch(c){return n(c)}d(t)}function l(e){var t;s=void 0;try{t=action(r+" - runid: "+i+" - yield "+a++,o.throw).call(o,e)}catch(c){return n(c)}d(t)}function d(e){if(!isFunction$1(null==e?void 0:e.then))return e.done?t(e.value):(s=Promise.resolve(e.value)).then(c,l);e.then(d,n)}e=n,c(void 0)});return a.cancel=action(r+" - runid: "+i+" - cancel",function(){try{s&&cancelPromise(s);var t=o.return(void 0),n=Promise.resolve(t.value);n.then(noop,noop),cancelPromise(n),e(new FlowCancellationError)}catch(r){e(r)}}),a};return i.isMobXFlow=!0,i},flowAnnotation);function cancelPromise(e){isFunction$1(e.cancel)&&e.cancel()}function isFlow(e){return!0===(null==e?void 0:e.isMobXFlow)}function _isObservable(e,t){return!!e&&(void 0!==t?!!isObservableObject(e)&&e[$mobx].values_.has(t):isObservableObject(e)||!!e[$mobx]||isAtom(e)||isReaction(e)||isComputedValue(e))}function isObservable(e){return _isObservable(e)}function transaction(e,t){void 0===t&&(t=void 0),startBatch();try{return e.apply(t)}finally{endBatch()}}function getAdm(e){return e[$mobx]}flow.bound=createDecoratorAnnotation(flowBoundAnnotation);var objectProxyTraps={has:function(e,t){return getAdm(e).has_(t)},get:function(e,t){return getAdm(e).get_(t)},set:function(e,t,n){var r;return!!isStringish(t)&&(null==(r=getAdm(e).set_(t,n,!0))||r)},deleteProperty:function(e,t){var n;return!!isStringish(t)&&(null==(n=getAdm(e).delete_(t,!0))||n)},defineProperty:function(e,t,n){var r;return null==(r=getAdm(e).defineProperty_(t,n))||r},ownKeys:function(e){return getAdm(e).ownKeys_()},preventExtensions:function(e){die(13)}};function asDynamicObservableObject(e,t){var n,r;return assertProxies(),null!=(r=(n=(e=asObservableObject(e,t))[$mobx]).proxy_)?r:n.proxy_=new Proxy(e,objectProxyTraps)}function hasInterceptors(e){return void 0!==e.interceptors_&&e.interceptors_.length>0}function registerInterceptor(e,t){var n=e.interceptors_||(e.interceptors_=[]);return n.push(t),once(function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)})}function interceptChange(e,t){var n=untrackedStart();try{for(var r=[].concat(e.interceptors_||[]),i=0,o=r.length;i<o&&((t=r[i](t))&&!t.type&&die(14),t);i++);return t}finally{untrackedEnd(n)}}function hasListeners(e){return void 0!==e.changeListeners_&&e.changeListeners_.length>0}function registerListener(e,t){var n=e.changeListeners_||(e.changeListeners_=[]);return n.push(t),once(function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)})}function notifyListeners(e,t){var n=untrackedStart(),r=e.changeListeners_;if(r){for(var i=0,o=(r=r.slice()).length;i<o;i++)r[i](t);untrackedEnd(n)}}var keysSymbol=Symbol("mobx-keys");function makeAutoObservable(e,t,n){return isPlainObject$1(e)?extendObservable(e,e,t,n):(initObservable(function(){var r=asObservableObject(e,n)[$mobx];if(!e[keysSymbol]){var i=Object.getPrototypeOf(e),o=new Set([].concat(ownKeys(e),ownKeys(i)));o.delete("constructor"),o.delete($mobx),addHiddenProp(i,keysSymbol,o)}e[keysSymbol].forEach(function(e){return r.make_(e,!t||(!(e in t)||t[e]))})}),e)}var SPLICE="splice",UPDATE="update",MAX_SPLICE_SIZE=1e4,arrayTraps={get:function(e,t){var n=e[$mobx];return t===$mobx?n:"length"===t?n.getArrayLength_():"string"!=typeof t||isNaN(t)?hasProp(arrayExtensions,t)?arrayExtensions[t]:e[t]:n.get_(parseInt(t))},set:function(e,t,n){var r=e[$mobx];return"length"===t&&r.setArrayLength_(n),"symbol"==typeof t||isNaN(t)?e[t]=n:r.set_(parseInt(t),n),!0},preventExtensions:function(){die(15)}},ObservableArrayAdministration=function(){function e(e,t,n,r){void 0===e&&(e="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=n,this.legacyMode_=r,this.atom_=new Atom(e),this.enhancer_=function(e,n){return t(e,n,"ObservableArray[..]")}}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.dehanceValues_=function(e){return void 0!==this.dehancer&&e.length>0?e.map(this.dehancer):e},t.intercept_=function(e){return registerInterceptor(this,e)},t.observe_=function(e,t){return void 0===t&&(t=!1),t&&e({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),registerListener(this,e)},t.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},t.setArrayLength_=function(e){("number"!=typeof e||isNaN(e)||e<0)&&die("Out of range: "+e);var t=this.values_.length;if(e!==t)if(e>t){for(var n=new Array(e-t),r=0;r<e-t;r++)n[r]=void 0;this.spliceWithArray_(t,0,n)}else this.spliceWithArray_(e,t-e)},t.updateArrayLength_=function(e,t){e!==this.lastKnownLength_&&die(16),this.lastKnownLength_+=t,this.legacyMode_&&t>0&&reserveArrayBuffer(e+t+1)},t.spliceWithArray_=function(e,t,n){var r=this;checkIfStateModificationsAreAllowed(this.atom_);var i=this.values_.length;if(void 0===e?e=0:e>i?e=i:e<0&&(e=Math.max(0,i+e)),t=1===arguments.length?i-e:null==t?0:Math.max(0,Math.min(t,i-e)),void 0===n&&(n=EMPTY_ARRAY),hasInterceptors(this)){var o=interceptChange(this,{object:this.proxy_,type:SPLICE,index:e,removedCount:t,added:n});if(!o)return EMPTY_ARRAY;t=o.removedCount,n=o.added}if(n=0===n.length?n:n.map(function(e){return r.enhancer_(e,void 0)}),this.legacyMode_){var s=n.length-t;this.updateArrayLength_(i,s)}var a=this.spliceItemsIntoValues_(e,t,n);return 0===t&&0===n.length||this.notifyArraySplice_(e,n,a),this.dehanceValues_(a)},t.spliceItemsIntoValues_=function(e,t,n){var r;if(n.length<MAX_SPLICE_SIZE)return(r=this.values_).splice.apply(r,[e,t].concat(n));var i=this.values_.slice(e,e+t),o=this.values_.slice(e+t);this.values_.length+=n.length-t;for(var s=0;s<n.length;s++)this.values_[e+s]=n[s];for(var a=0;a<o.length;a++)this.values_[e+n.length+a]=o[a];return i},t.notifyArrayChildUpdate_=function(e,t,n){var r=!this.owned_&&isSpyEnabled(),i=hasListeners(this),o=i||r?{observableKind:"array",object:this.proxy_,type:UPDATE,debugObjectName:this.atom_.name_,index:e,newValue:t,oldValue:n}:null;this.atom_.reportChanged(),i&&notifyListeners(this,o)},t.notifyArraySplice_=function(e,t,n){var r=!this.owned_&&isSpyEnabled(),i=hasListeners(this),o=i||r?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:SPLICE,index:e,removed:n,added:t,removedCount:n.length,addedCount:t.length}:null;this.atom_.reportChanged(),i&&notifyListeners(this,o)},t.get_=function(e){if(!(this.legacyMode_&&e>=this.values_.length))return this.atom_.reportObserved(),this.dehanceValue_(this.values_[e]);console.warn("[mobx] Out of bounds read: "+e)},t.set_=function(e,t){var n=this.values_;if(this.legacyMode_&&e>n.length&&die(17,e,n.length),e<n.length){checkIfStateModificationsAreAllowed(this.atom_);var r=n[e];if(hasInterceptors(this)){var i=interceptChange(this,{type:UPDATE,object:this.proxy_,index:e,newValue:t});if(!i)return;t=i.newValue}(t=this.enhancer_(t,r))!==r&&(n[e]=t,this.notifyArrayChildUpdate_(e,t,r))}else{for(var o=new Array(e+1-n.length),s=0;s<o.length-1;s++)o[s]=void 0;o[o.length-1]=t,this.spliceWithArray_(n.length,0,o)}},e}();function createObservableArray(e,t,n,r){return void 0===n&&(n="ObservableArray"),void 0===r&&(r=!1),assertProxies(),initObservable(function(){var i=new ObservableArrayAdministration(n,t,r,!1);addHiddenFinalProp(i.values_,$mobx,i);var o=new Proxy(i.values_,arrayTraps);return i.proxy_=o,e&&e.length&&i.spliceWithArray_(0,0,e),o})}var arrayExtensions={clear:function(){return this.splice(0)},replace:function(e){var t=this[$mobx];return t.spliceWithArray_(0,t.values_.length,e)},toJSON:function(){return this.slice()},splice:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o=this[$mobx];switch(arguments.length){case 0:return[];case 1:return o.spliceWithArray_(e);case 2:return o.spliceWithArray_(e,t)}return o.spliceWithArray_(e,t,r)},spliceWithArray:function(e,t,n){return this[$mobx].spliceWithArray_(e,t,n)},push:function(){for(var e=this[$mobx],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.spliceWithArray_(e.values_.length,0,n),e.values_.length},pop:function(){return this.splice(Math.max(this[$mobx].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var e=this[$mobx],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.spliceWithArray_(0,0,n),e.values_.length},reverse:function(){return globalState.trackingDerivation&&die(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){globalState.trackingDerivation&&die(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function(e){var t=this[$mobx],n=t.dehanceValues_(t.values_).indexOf(e);return n>-1&&(this.splice(n,1),!0)}};function addArrayExtension(e,t){"function"==typeof Array.prototype[e]&&(arrayExtensions[e]=t(e))}function simpleFunc(e){return function(){var t=this[$mobx];t.atom_.reportObserved();var n=t.dehanceValues_(t.values_);return n[e].apply(n,arguments)}}function mapLikeFunc(e){return function(t,n){var r=this,i=this[$mobx];return i.atom_.reportObserved(),i.dehanceValues_(i.values_)[e](function(e,i){return t.call(n,e,i,r)})}}function reduceLikeFunc(e){return function(){var t=this,n=this[$mobx];n.atom_.reportObserved();var r=n.dehanceValues_(n.values_),i=arguments[0];return arguments[0]=function(e,n,r){return i(e,n,r,t)},r[e].apply(r,arguments)}}addArrayExtension("at",simpleFunc),addArrayExtension("concat",simpleFunc),addArrayExtension("flat",simpleFunc),addArrayExtension("includes",simpleFunc),addArrayExtension("indexOf",simpleFunc),addArrayExtension("join",simpleFunc),addArrayExtension("lastIndexOf",simpleFunc),addArrayExtension("slice",simpleFunc),addArrayExtension("toString",simpleFunc),addArrayExtension("toLocaleString",simpleFunc),addArrayExtension("toSorted",simpleFunc),addArrayExtension("toSpliced",simpleFunc),addArrayExtension("with",simpleFunc),addArrayExtension("every",mapLikeFunc),addArrayExtension("filter",mapLikeFunc),addArrayExtension("find",mapLikeFunc),addArrayExtension("findIndex",mapLikeFunc),addArrayExtension("findLast",mapLikeFunc),addArrayExtension("findLastIndex",mapLikeFunc),addArrayExtension("flatMap",mapLikeFunc),addArrayExtension("forEach",mapLikeFunc),addArrayExtension("map",mapLikeFunc),addArrayExtension("some",mapLikeFunc),addArrayExtension("toReversed",mapLikeFunc),addArrayExtension("reduce",reduceLikeFunc),addArrayExtension("reduceRight",reduceLikeFunc);var isObservableArrayAdministration=createInstanceofPredicate("ObservableArrayAdministration",ObservableArrayAdministration);function isObservableArray(e){return isObject$1(e)&&isObservableArrayAdministration(e[$mobx])}var ObservableMapMarker={},ADD="add",DELETE="delete",ObservableMap=function(){function e(e,t,n){var r=this;void 0===t&&(t=deepEnhancer),void 0===n&&(n="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[$mobx]=ObservableMapMarker,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=t,this.name_=n,isFunction$1(Map)||die(18),initObservable(function(){r.keysAtom_=createAtom("ObservableMap.keys()"),r.data_=new Map,r.hasMap_=new Map,e&&r.merge(e)})}var t=e.prototype;return t.has_=function(e){return this.data_.has(e)},t.has=function(e){var t=this;if(!globalState.trackingDerivation)return this.has_(e);var n=this.hasMap_.get(e);if(!n){var r=n=new ObservableValue(this.has_(e),referenceEnhancer,"ObservableMap.key?",!1);this.hasMap_.set(e,r),onBecomeUnobserved(r,function(){return t.hasMap_.delete(e)})}return n.get()},t.set=function(e,t){var n=this.has_(e);if(hasInterceptors(this)){var r=interceptChange(this,{type:n?UPDATE:ADD,object:this,newValue:t,name:e});if(!r)return this;t=r.newValue}return n?this.updateValue_(e,t):this.addValue_(e,t),this},t.delete=function(e){var t=this;if((checkIfStateModificationsAreAllowed(this.keysAtom_),hasInterceptors(this))&&!interceptChange(this,{type:DELETE,object:this,name:e}))return!1;if(this.has_(e)){var n=isSpyEnabled(),r=hasListeners(this),i=r||n?{observableKind:"map",debugObjectName:this.name_,type:DELETE,object:this,oldValue:this.data_.get(e).value_,name:e}:null;return transaction(function(){var n;t.keysAtom_.reportChanged(),null==(n=t.hasMap_.get(e))||n.setNewValue_(!1),t.data_.get(e).setNewValue_(void 0),t.data_.delete(e)}),r&&notifyListeners(this,i),!0}return!1},t.updateValue_=function(e,t){var n=this.data_.get(e);if((t=n.prepareNewValue_(t))!==globalState.UNCHANGED){var r=isSpyEnabled(),i=hasListeners(this),o=i||r?{observableKind:"map",debugObjectName:this.name_,type:UPDATE,object:this,oldValue:n.value_,name:e,newValue:t}:null;n.setNewValue_(t),i&&notifyListeners(this,o)}},t.addValue_=function(e,t){var n=this;checkIfStateModificationsAreAllowed(this.keysAtom_),transaction(function(){var r,i=new ObservableValue(t,n.enhancer_,"ObservableMap.key",!1);n.data_.set(e,i),t=i.value_,null==(r=n.hasMap_.get(e))||r.setNewValue_(!0),n.keysAtom_.reportChanged()});var r=isSpyEnabled(),i=hasListeners(this),o=i||r?{observableKind:"map",debugObjectName:this.name_,type:ADD,object:this,name:e,newValue:t}:null;i&&notifyListeners(this,o)},t.get=function(e){return this.has(e)?this.dehanceValue_(this.data_.get(e).get()):this.dehanceValue_(void 0)},t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},t.values=function(){var e=this,t=this.keys();return makeIterableForMap({next:function(){var n=t.next(),r=n.done,i=n.value;return{done:r,value:r?void 0:e.get(i)}}})},t.entries=function(){var e=this,t=this.keys();return makeIterableForMap({next:function(){var n=t.next(),r=n.done,i=n.value;return{done:r,value:r?void 0:[i,e.get(i)]}}})},t[Symbol.iterator]=function(){return this.entries()},t.forEach=function(e,t){for(var n,r=_createForOfIteratorHelperLoose(this);!(n=r()).done;){var i=n.value,o=i[0],s=i[1];e.call(t,s,o,this)}},t.merge=function(e){var t=this;return isObservableMap(e)&&(e=new Map(e)),transaction(function(){isPlainObject$1(e)?getPlainObjectKeys(e).forEach(function(n){return t.set(n,e[n])}):Array.isArray(e)?e.forEach(function(e){var n=e[0],r=e[1];return t.set(n,r)}):isES6Map(e)?(isPlainES6Map(e)||die(19,e),e.forEach(function(e,n){return t.set(n,e)})):null!=e&&die(20,e)}),this},t.clear=function(){var e=this;transaction(function(){untracked(function(){for(var t,n=_createForOfIteratorHelperLoose(e.keys());!(t=n()).done;){var r=t.value;e.delete(r)}})})},t.replace=function(e){var t=this;return transaction(function(){for(var n,r=convertToMap(e),i=new Map,o=!1,s=_createForOfIteratorHelperLoose(t.data_.keys());!(n=s()).done;){var a=n.value;if(!r.has(a))if(t.delete(a))o=!0;else{var c=t.data_.get(a);i.set(a,c)}}for(var l,d=_createForOfIteratorHelperLoose(r.entries());!(l=d()).done;){var u=l.value,p=u[0],h=u[1],g=t.data_.has(p);if(t.set(p,h),t.data_.has(p)){var m=t.data_.get(p);i.set(p,m),g||(o=!0)}}if(!o)if(t.data_.size!==i.size)t.keysAtom_.reportChanged();else for(var f=t.data_.keys(),v=i.keys(),y=f.next(),_=v.next();!y.done;){if(y.value!==_.value){t.keysAtom_.reportChanged();break}y=f.next(),_=v.next()}t.data_=i}),this},t.toString=function(){return"[object ObservableMap]"},t.toJSON=function(){return Array.from(this)},t.observe_=function(e,t){return registerListener(this,e)},t.intercept_=function(e){return registerInterceptor(this,e)},_createClass(e,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Map"}}])}(),isObservableMap=createInstanceofPredicate("ObservableMap",ObservableMap);function makeIterableForMap(e){return e[Symbol.toStringTag]="MapIterator",makeIterable(e)}function convertToMap(e){if(isES6Map(e)||isObservableMap(e))return e;if(Array.isArray(e))return new Map(e);if(isPlainObject$1(e)){var t=new Map;for(var n in e)t.set(n,e[n]);return t}return die(21,e)}var ObservableSetMarker={},ObservableSet=function(){function e(e,t,n){var r=this;void 0===t&&(t=deepEnhancer),void 0===n&&(n="ObservableSet"),this.name_=void 0,this[$mobx]=ObservableSetMarker,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=n,isFunction$1(Set)||die(22),this.enhancer_=function(e,r){return t(e,r,n)},initObservable(function(){r.atom_=createAtom(r.name_),e&&r.replace(e)})}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.clear=function(){var e=this;transaction(function(){untracked(function(){for(var t,n=_createForOfIteratorHelperLoose(e.data_.values());!(t=n()).done;){var r=t.value;e.delete(r)}})})},t.forEach=function(e,t){for(var n,r=_createForOfIteratorHelperLoose(this);!(n=r()).done;){var i=n.value;e.call(t,i,i,this)}},t.add=function(e){var t=this;if(checkIfStateModificationsAreAllowed(this.atom_),hasInterceptors(this)){var n=interceptChange(this,{type:ADD,object:this,newValue:e});if(!n)return this;e=n.newValue}if(!this.has(e)){transaction(function(){t.data_.add(t.enhancer_(e,void 0)),t.atom_.reportChanged()});var r=hasListeners(this),i=r?{observableKind:"set",debugObjectName:this.name_,type:ADD,object:this,newValue:e}:null;r&&notifyListeners(this,i)}return this},t.delete=function(e){var t=this;if(hasInterceptors(this)&&!interceptChange(this,{type:DELETE,object:this,oldValue:e}))return!1;if(this.has(e)){var n=hasListeners(this),r=n?{observableKind:"set",debugObjectName:this.name_,type:DELETE,object:this,oldValue:e}:null;return transaction(function(){t.atom_.reportChanged(),t.data_.delete(e)}),n&&notifyListeners(this,r),!0}return!1},t.has=function(e){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(e))},t.entries=function(){var e=this.values();return makeIterableForSet({next:function(){var t=e.next(),n=t.value,r=t.done;return r?{value:void 0,done:r}:{value:[n,n],done:r}}})},t.keys=function(){return this.values()},t.values=function(){this.atom_.reportObserved();var e=this,t=this.data_.values();return makeIterableForSet({next:function(){var n=t.next(),r=n.value,i=n.done;return i?{value:void 0,done:i}:{value:e.dehanceValue_(r),done:i}}})},t.intersection=function(e){return isES6Set(e)&&!isObservableSet(e)?e.intersection(this):new Set(this).intersection(e)},t.union=function(e){return isES6Set(e)&&!isObservableSet(e)?e.union(this):new Set(this).union(e)},t.difference=function(e){return new Set(this).difference(e)},t.symmetricDifference=function(e){return isES6Set(e)&&!isObservableSet(e)?e.symmetricDifference(this):new Set(this).symmetricDifference(e)},t.isSubsetOf=function(e){return new Set(this).isSubsetOf(e)},t.isSupersetOf=function(e){return new Set(this).isSupersetOf(e)},t.isDisjointFrom=function(e){return isES6Set(e)&&!isObservableSet(e)?e.isDisjointFrom(this):new Set(this).isDisjointFrom(e)},t.replace=function(e){var t=this;return isObservableSet(e)&&(e=new Set(e)),transaction(function(){Array.isArray(e)||isES6Set(e)?(t.clear(),e.forEach(function(e){return t.add(e)})):null!=e&&die("Cannot initialize set from "+e)}),this},t.observe_=function(e,t){return registerListener(this,e)},t.intercept_=function(e){return registerInterceptor(this,e)},t.toJSON=function(){return Array.from(this)},t.toString=function(){return"[object ObservableSet]"},t[Symbol.iterator]=function(){return this.values()},_createClass(e,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Set"}}])}(),isObservableSet=createInstanceofPredicate("ObservableSet",ObservableSet);function makeIterableForSet(e){return e[Symbol.toStringTag]="SetIterator",makeIterable(e)}var descriptorCache=Object.create(null),REMOVE="remove",ObservableObjectAdministration=function(){function e(e,t,n,r){void 0===t&&(t=new Map),void 0===r&&(r=autoAnnotation),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=e,this.values_=t,this.name_=n,this.defaultAnnotation_=r,this.keysAtom_=new Atom("ObservableObject.keys"),this.isPlainObject_=isPlainObject$1(this.target_)}var t=e.prototype;return t.getObservablePropValue_=function(e){return this.values_.get(e).get()},t.setObservablePropValue_=function(e,t){var n=this.values_.get(e);if(n instanceof ComputedValue)return n.set(t),!0;if(hasInterceptors(this)){var r=interceptChange(this,{type:UPDATE,object:this.proxy_||this.target_,name:e,newValue:t});if(!r)return null;t=r.newValue}if((t=n.prepareNewValue_(t))!==globalState.UNCHANGED){var i=hasListeners(this),o=i?{type:UPDATE,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:n.value_,name:e,newValue:t}:null;n.setNewValue_(t),i&&notifyListeners(this,o)}return!0},t.get_=function(e){return globalState.trackingDerivation&&!hasProp(this.target_,e)&&this.has_(e),this.target_[e]},t.set_=function(e,t,n){return void 0===n&&(n=!1),hasProp(this.target_,e)?this.values_.has(e)?this.setObservablePropValue_(e,t):n?Reflect.set(this.target_,e,t):(this.target_[e]=t,!0):this.extend_(e,{value:t,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,n)},t.has_=function(e){if(!globalState.trackingDerivation)return e in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var t=this.pendingKeys_.get(e);return t||(t=new ObservableValue(e in this.target_,referenceEnhancer,"ObservableObject.key?",!1),this.pendingKeys_.set(e,t)),t.get()},t.make_=function(e,t){if(!0===t&&(t=this.defaultAnnotation_),!1!==t){if(!(e in this.target_)){var n;if(null!=(n=this.target_[storedAnnotationsSymbol])&&n[e])return;die(1,t.annotationType_,this.name_+"."+e.toString())}for(var r=this.target_;r&&r!==objectPrototype;){var i=getDescriptor(r,e);if(i){var o=t.make_(this,e,i,r);if(0===o)return;if(1===o)break}r=Object.getPrototypeOf(r)}recordAnnotationApplied(this,t,e)}},t.extend_=function(e,t,n,r){if(void 0===r&&(r=!1),!0===n&&(n=this.defaultAnnotation_),!1===n)return this.defineProperty_(e,t,r);var i=n.extend_(this,e,t,r);return i&&recordAnnotationApplied(this,n,e),i},t.defineProperty_=function(e,t,n){void 0===n&&(n=!1),checkIfStateModificationsAreAllowed(this.keysAtom_);try{startBatch();var r=this.delete_(e);if(!r)return r;if(hasInterceptors(this)){var i=interceptChange(this,{object:this.proxy_||this.target_,name:e,type:ADD,newValue:t.value});if(!i)return null;var o=i.newValue;t.value!==o&&(t=_extends({},t,{value:o}))}if(n){if(!Reflect.defineProperty(this.target_,e,t))return!1}else defineProperty(this.target_,e,t);this.notifyPropertyAddition_(e,t.value)}finally{endBatch()}return!0},t.defineObservableProperty_=function(e,t,n,r){void 0===r&&(r=!1),checkIfStateModificationsAreAllowed(this.keysAtom_);try{startBatch();var i=this.delete_(e);if(!i)return i;if(hasInterceptors(this)){var o=interceptChange(this,{object:this.proxy_||this.target_,name:e,type:ADD,newValue:t});if(!o)return null;t=o.newValue}var s=getCachedObservablePropDescriptor(e),a={configurable:!globalState.safeDescriptors||this.isPlainObject_,enumerable:!0,get:s.get,set:s.set};if(r){if(!Reflect.defineProperty(this.target_,e,a))return!1}else defineProperty(this.target_,e,a);var c=new ObservableValue(t,n,"ObservableObject.key",!1);this.values_.set(e,c),this.notifyPropertyAddition_(e,c.value_)}finally{endBatch()}return!0},t.defineComputedProperty_=function(e,t,n){void 0===n&&(n=!1),checkIfStateModificationsAreAllowed(this.keysAtom_);try{startBatch();var r=this.delete_(e);if(!r)return r;if(hasInterceptors(this))if(!interceptChange(this,{object:this.proxy_||this.target_,name:e,type:ADD,newValue:void 0}))return null;t.name||(t.name="ObservableObject.key"),t.context=this.proxy_||this.target_;var i=getCachedObservablePropDescriptor(e),o={configurable:!globalState.safeDescriptors||this.isPlainObject_,enumerable:!1,get:i.get,set:i.set};if(n){if(!Reflect.defineProperty(this.target_,e,o))return!1}else defineProperty(this.target_,e,o);this.values_.set(e,new ComputedValue(t)),this.notifyPropertyAddition_(e,void 0)}finally{endBatch()}return!0},t.delete_=function(e,t){if(void 0===t&&(t=!1),checkIfStateModificationsAreAllowed(this.keysAtom_),!hasProp(this.target_,e))return!0;if(hasInterceptors(this)&&!interceptChange(this,{object:this.proxy_||this.target_,name:e,type:REMOVE}))return null;try{var n;startBatch();var r,i=hasListeners(this),o=this.values_.get(e),s=void 0;if(!o&&i)s=null==(r=getDescriptor(this.target_,e))?void 0:r.value;if(t){if(!Reflect.deleteProperty(this.target_,e))return!1}else delete this.target_[e];if(o&&(this.values_.delete(e),o instanceof ObservableValue&&(s=o.value_),propagateChanged(o)),this.keysAtom_.reportChanged(),null==(n=this.pendingKeys_)||null==(n=n.get(e))||n.set(e in this.target_),i){var a={type:REMOVE,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:s,name:e};0,i&&notifyListeners(this,a)}}finally{endBatch()}return!0},t.observe_=function(e,t){return registerListener(this,e)},t.intercept_=function(e){return registerInterceptor(this,e)},t.notifyPropertyAddition_=function(e,t){var n,r=hasListeners(this);if(r){var i=r?{type:ADD,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:e,newValue:t}:null;r&&notifyListeners(this,i)}null==(n=this.pendingKeys_)||null==(n=n.get(e))||n.set(!0),this.keysAtom_.reportChanged()},t.ownKeys_=function(){return this.keysAtom_.reportObserved(),ownKeys(this.target_)},t.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},e}();function asObservableObject(e,t){var n;if(hasProp(e,$mobx))return e;var r=null!=(n=null==t?void 0:t.name)?n:"ObservableObject",i=new ObservableObjectAdministration(e,new Map,String(r),getAnnotationFromOptions(t));return addHiddenProp(e,$mobx,i),e}var isObservableObjectAdministration=createInstanceofPredicate("ObservableObjectAdministration",ObservableObjectAdministration);function getCachedObservablePropDescriptor(e){return descriptorCache[e]||(descriptorCache[e]={get:function(){return this[$mobx].getObservablePropValue_(e)},set:function(t){return this[$mobx].setObservablePropValue_(e,t)}})}function isObservableObject(e){return!!isObject$1(e)&&isObservableObjectAdministration(e[$mobx])}function recordAnnotationApplied(e,t,n){var r;null==(r=e.target_[storedAnnotationsSymbol])||delete r[n]}var ENTRY_0=createArrayEntryDescriptor(0),safariPrototypeSetterInheritanceBug=function(){var e=!1,t={};return Object.defineProperty(t,"0",{set:function(){e=!0}}),Object.create(t)[0]=1,!1===e}(),OBSERVABLE_ARRAY_BUFFER_SIZE=0,StubArray=function(){};function inherit(e,t){Object.setPrototypeOf?Object.setPrototypeOf(e.prototype,t):void 0!==e.prototype.__proto__?e.prototype.__proto__=t:e.prototype=t}inherit(StubArray,Array.prototype);var LegacyObservableArray=function(e){function t(t,n,r,i){var o;return void 0===r&&(r="ObservableArray"),void 0===i&&(i=!1),o=e.call(this)||this,initObservable(function(){var e=new ObservableArrayAdministration(r,n,i,!0);e.proxy_=o,addHiddenFinalProp(o,$mobx,e),t&&t.length&&o.spliceWithArray(0,0,t),safariPrototypeSetterInheritanceBug&&Object.defineProperty(o,"0",ENTRY_0)}),o}_inheritsLoose(t,e);var n=t.prototype;return n.concat=function(){this[$mobx].atom_.reportObserved();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Array.prototype.concat.apply(this.slice(),t.map(function(e){return isObservableArray(e)?e.slice():e}))},n[Symbol.iterator]=function(){var e=this,t=0;return makeIterable({next:function(){return t<e.length?{value:e[t++],done:!1}:{done:!0,value:void 0}}})},_createClass(t,[{key:"length",get:function(){return this[$mobx].getArrayLength_()},set:function(e){this[$mobx].setArrayLength_(e)}},{key:Symbol.toStringTag,get:function(){return"Array"}}])}(StubArray);function createArrayEntryDescriptor(e){return{enumerable:!1,configurable:!0,get:function(){return this[$mobx].get_(e)},set:function(t){this[$mobx].set_(e,t)}}}function createArrayBufferItem(e){defineProperty(LegacyObservableArray.prototype,""+e,createArrayEntryDescriptor(e))}function reserveArrayBuffer(e){if(e>OBSERVABLE_ARRAY_BUFFER_SIZE){for(var t=OBSERVABLE_ARRAY_BUFFER_SIZE;t<e+100;t++)createArrayBufferItem(t);OBSERVABLE_ARRAY_BUFFER_SIZE=e}}function createLegacyArray(e,t,n){return new LegacyObservableArray(e,t,n)}function getAtom(e,t){if("object"==typeof e&&null!==e){if(isObservableArray(e))return void 0!==t&&die(23),e[$mobx].atom_;if(isObservableSet(e))return e.atom_;if(isObservableMap(e)){if(void 0===t)return e.keysAtom_;var n=e.data_.get(t)||e.hasMap_.get(t);return n||die(25,t,getDebugName(e)),n}if(isObservableObject(e)){if(!t)return die(26);var r=e[$mobx].values_.get(t);return r||die(27,t,getDebugName(e)),r}if(isAtom(e)||isComputedValue(e)||isReaction(e))return e}else if(isFunction$1(e)&&isReaction(e[$mobx]))return e[$mobx];die(28)}function getAdministration(e,t){return e||die(29),void 0!==t?getAdministration(getAtom(e,t)):isAtom(e)||isComputedValue(e)||isReaction(e)||isObservableMap(e)||isObservableSet(e)?e:e[$mobx]?e[$mobx]:void die(24,e)}function getDebugName(e,t){var n;if(void 0!==t)n=getAtom(e,t);else{if(isAction(e))return e.name;n=isObservableObject(e)||isObservableMap(e)||isObservableSet(e)?getAdministration(e):getAtom(e)}return n.name_}function initObservable(e){var t=untrackedStart(),n=allowStateChangesStart(!0);startBatch();try{return e()}finally{endBatch(),allowStateChangesEnd(n),untrackedEnd(t)}}Object.entries(arrayExtensions).forEach(function(e){var t=e[0],n=e[1];"concat"!==t&&addHiddenProp(LegacyObservableArray.prototype,t,n)}),reserveArrayBuffer(1e3);var toString$1=objectPrototype.toString,_getGlobal$Iterator;function deepEqual(e,t,n){return void 0===n&&(n=-1),eq(e,t,n)}function eq(e,t,n,r,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;if("function"!==o&&"object"!==o&&"object"!=typeof t)return!1;var s=toString$1.call(e);if(s!==toString$1.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0===+e?1/+e==1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t;case"[object Symbol]":return"undefined"!=typeof Symbol&&Symbol.valueOf.call(e)===Symbol.valueOf.call(t);case"[object Map]":case"[object Set]":n>=0&&n++}e=unwrap(e),t=unwrap(t);var a="[object Array]"===s;if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var c=e.constructor,l=t.constructor;if(c!==l&&!(isFunction$1(c)&&c instanceof c&&isFunction$1(l)&&l instanceof l)&&"constructor"in e&&"constructor"in t)return!1}if(0===n)return!1;n<0&&(n=-1),i=i||[];for(var d=(r=r||[]).length;d--;)if(r[d]===e)return i[d]===t;if(r.push(e),i.push(t),a){if((d=e.length)!==t.length)return!1;for(;d--;)if(!eq(e[d],t[d],n-1,r,i))return!1}else{var u=Object.keys(e),p=u.length;if(Object.keys(t).length!==p)return!1;for(var h=0;h<p;h++){var g=u[h];if(!hasProp(t,g)||!eq(e[g],t[g],n-1,r,i))return!1}}return r.pop(),i.pop(),!0}function unwrap(e){return isObservableArray(e)?e.slice():isES6Map(e)||isObservableMap(e)||isES6Set(e)||isObservableSet(e)?Array.from(e.entries()):e}var maybeIteratorPrototype=(null==(_getGlobal$Iterator=getGlobal().Iterator)?void 0:_getGlobal$Iterator.prototype)||{};function makeIterable(e){return e[Symbol.iterator]=getSelf,Object.assign(Object.create(maybeIteratorPrototype),e)}function getSelf(){return this}["Symbol","Map","Set"].forEach(function(e){void 0===getGlobal()[e]&&die("MobX requires global '"+e+"' to be available or polyfilled")}),"object"==typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:spy,extras:{getDebugName:getDebugName},$mobx:$mobx});var axios$3={exports:{}},bind$2=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},bind$1=bind$2,toString=Object.prototype.toString,kindOf=function(e){return function(t){var n=toString.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())}}(Object.create(null));function kindOfTest(e){return e=e.toLowerCase(),function(t){return kindOf(t)===e}}function isArray(e){return Array.isArray(e)}function isUndefined(e){return void 0===e}function isBuffer(e){return null!==e&&!isUndefined(e)&&null!==e.constructor&&!isUndefined(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&isArrayBuffer(e.buffer)}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return null!==e&&"object"==typeof e}function isPlainObject(e){if("object"!==kindOf(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList");function isFunction(e){return"[object Function]"===toString.call(e)}function isStream(e){return isObject(e)&&isFunction(e.pipe)}function isFormData(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||toString.call(e)===t||isFunction(e.toString)&&e.toString()===t)}var isURLSearchParams=kindOfTest("URLSearchParams");function trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),isArray(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}function merge(){var e={};function t(t,n){isPlainObject(e[n])&&isPlainObject(t)?e[n]=merge(e[n],t):isPlainObject(t)?e[n]=merge({},t):isArray(t)?e[n]=t.slice():e[n]=t}for(var n=0,r=arguments.length;n<r;n++)forEach(arguments[n],t);return e}function extend(e,t,n){return forEach(t,function(t,r){e[r]=n&&"function"==typeof t?bind$1(t,n):t}),e}function stripBOM(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}function inherits(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)}function toFlatObject(e,t,n){var r,i,o,s={};t=t||{};do{for(i=(r=Object.getOwnPropertyNames(e)).length;i-- >0;)s[o=r[i]]||(t[o]=e[o],s[o]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t}function endsWith(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n}function toArray(e){if(!e)return null;var t=e.length;if(isUndefined(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n}var isTypedArray=function(e){return function(t){return e&&t instanceof e}}("undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array)),utils$b={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim,stripBOM:stripBOM,inherits:inherits,toFlatObject:toFlatObject,kindOf:kindOf,kindOfTest:kindOfTest,endsWith:endsWith,toArray:toArray,isTypedArray:isTypedArray,isFileList:isFileList},utils$a=utils$b;function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL$1=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(utils$a.isURLSearchParams(t))r=t.toString();else{var i=[];utils$a.forEach(t,function(e,t){null!=e&&(utils$a.isArray(e)?t+="[]":e=[e],utils$a.forEach(e,function(e){utils$a.isDate(e)?e=e.toISOString():utils$a.isObject(e)&&(e=JSON.stringify(e)),i.push(encode(t)+"="+encode(e))}))}),r=i.join("&")}if(r){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e},utils$9=utils$b;function InterceptorManager$1(){this.handlers=[]}InterceptorManager$1.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},InterceptorManager$1.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager$1.prototype.forEach=function(e){utils$9.forEach(this.handlers,function(t){null!==t&&e(t)})};var InterceptorManager_1=InterceptorManager$1,utils$8=utils$b,normalizeHeaderName$1=function(e,t){utils$8.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})},utils$7=utils$b;function AxiosError$2(e,t,n,r,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}utils$7.inherits(AxiosError$2,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var prototype=AxiosError$2.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(e){descriptors[e]={value:e}}),Object.defineProperties(AxiosError$2,descriptors),Object.defineProperty(prototype,"isAxiosError",{value:!0}),AxiosError$2.from=function(e,t,n,r,i,o){var s=Object.create(prototype);return utils$7.toFlatObject(e,s,function(e){return e!==Error.prototype}),AxiosError$2.call(s,e.message,t,n,r,i),s.name=e.name,o&&Object.assign(s,o),s};var AxiosError_1=AxiosError$2,transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},utils$6=utils$b;function toFormData$1(e,t){t=t||new FormData;var n=[];function r(e){return null===e?"":utils$6.isDate(e)?e.toISOString():utils$6.isArrayBuffer(e)||utils$6.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(i,o){if(utils$6.isPlainObject(i)||utils$6.isArray(i)){if(-1!==n.indexOf(i))throw Error("Circular reference detected in "+o);n.push(i),utils$6.forEach(i,function(n,i){if(!utils$6.isUndefined(n)){var s,a=o?o+"."+i:i;if(n&&!o&&"object"==typeof n)if(utils$6.endsWith(i,"{}"))n=JSON.stringify(n);else if(utils$6.endsWith(i,"[]")&&(s=utils$6.toArray(n)))return void s.forEach(function(e){!utils$6.isUndefined(e)&&t.append(a,r(e))});e(n,a)}}),n.pop()}else t.append(o,r(i))}(e),t}var toFormData_1=toFormData$1,settle,hasRequiredSettle,cookies,hasRequiredCookies;function requireSettle(){if(hasRequiredSettle)return settle;hasRequiredSettle=1;var e=AxiosError_1;return settle=function(t,n,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?n(new e("Request failed with status code "+r.status,[e.ERR_BAD_REQUEST,e.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):t(r)}}function requireCookies(){if(hasRequiredCookies)return cookies;hasRequiredCookies=1;var e=utils$b;return cookies=e.isStandardBrowserEnv()?function(){return{write:function(t,n,r,i,o,s){var a=[];a.push(t+"="+encodeURIComponent(n)),e.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),e.isString(i)&&a.push("path="+i),e.isString(o)&&a.push("domain="+o),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()}var isAbsoluteURL$1=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},combineURLs$1=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},isAbsoluteURL=isAbsoluteURL$1,combineURLs=combineURLs$1,buildFullPath$1=function(e,t){return e&&!isAbsoluteURL(t)?combineURLs(e,t):t},parseHeaders,hasRequiredParseHeaders,isURLSameOrigin,hasRequiredIsURLSameOrigin,CanceledError_1,hasRequiredCanceledError,parseProtocol,hasRequiredParseProtocol,xhr,hasRequiredXhr,_null,hasRequired_null;function requireParseHeaders(){if(hasRequiredParseHeaders)return parseHeaders;hasRequiredParseHeaders=1;var e=utils$b,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return parseHeaders=function(n){var r,i,o,s={};return n?(e.forEach(n.split("\n"),function(n){if(o=n.indexOf(":"),r=e.trim(n.substr(0,o)).toLowerCase(),i=e.trim(n.substr(o+1)),r){if(s[r]&&t.indexOf(r)>=0)return;s[r]="set-cookie"===r?(s[r]?s[r]:[]).concat([i]):s[r]?s[r]+", "+i:i}}),s):s}}function requireIsURLSameOrigin(){if(hasRequiredIsURLSameOrigin)return isURLSameOrigin;hasRequiredIsURLSameOrigin=1;var e=utils$b;return isURLSameOrigin=e.isStandardBrowserEnv()?function(){var t,n=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var t=e;return n&&(r.setAttribute("href",t),t=r.href),r.setAttribute("href",t),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=i(window.location.href),function(n){var r=e.isString(n)?i(n):n;return r.protocol===t.protocol&&r.host===t.host}}():function(){return function(){return!0}}()}function requireCanceledError(){if(hasRequiredCanceledError)return CanceledError_1;hasRequiredCanceledError=1;var e=AxiosError_1;function t(t){e.call(this,null==t?"canceled":t,e.ERR_CANCELED),this.name="CanceledError"}return utils$b.inherits(t,e,{__CANCEL__:!0}),CanceledError_1=t}function requireParseProtocol(){return hasRequiredParseProtocol?parseProtocol:(hasRequiredParseProtocol=1,parseProtocol=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""})}function requireXhr(){if(hasRequiredXhr)return xhr;hasRequiredXhr=1;var e=utils$b,t=requireSettle(),n=requireCookies(),r=buildURL$1,i=buildFullPath$1,o=requireParseHeaders(),s=requireIsURLSameOrigin(),a=transitional,c=AxiosError_1,l=requireCanceledError(),d=requireParseProtocol();return xhr=function(u){return new Promise(function(p,h){var g,m=u.data,f=u.headers,v=u.responseType;function y(){u.cancelToken&&u.cancelToken.unsubscribe(g),u.signal&&u.signal.removeEventListener("abort",g)}e.isFormData(m)&&e.isStandardBrowserEnv()&&delete f["Content-Type"];var _=new XMLHttpRequest;if(u.auth){var I=u.auth.username||"",T=u.auth.password?unescape(encodeURIComponent(u.auth.password)):"";f.Authorization="Basic "+btoa(I+":"+T)}var S=i(u.baseURL,u.url);function E(){if(_){var e="getAllResponseHeaders"in _?o(_.getAllResponseHeaders()):null,n={data:v&&"text"!==v&&"json"!==v?_.response:_.responseText,status:_.status,statusText:_.statusText,headers:e,config:u,request:_};t(function(e){p(e),y()},function(e){h(e),y()},n),_=null}}if(_.open(u.method.toUpperCase(),r(S,u.params,u.paramsSerializer),!0),_.timeout=u.timeout,"onloadend"in _?_.onloadend=E:_.onreadystatechange=function(){_&&4===_.readyState&&(0!==_.status||_.responseURL&&0===_.responseURL.indexOf("file:"))&&setTimeout(E)},_.onabort=function(){_&&(h(new c("Request aborted",c.ECONNABORTED,u,_)),_=null)},_.onerror=function(){h(new c("Network Error",c.ERR_NETWORK,u,_,_)),_=null},_.ontimeout=function(){var e=u.timeout?"timeout of "+u.timeout+"ms exceeded":"timeout exceeded",t=u.transitional||a;u.timeoutErrorMessage&&(e=u.timeoutErrorMessage),h(new c(e,t.clarifyTimeoutError?c.ETIMEDOUT:c.ECONNABORTED,u,_)),_=null},e.isStandardBrowserEnv()){var M=(u.withCredentials||s(S))&&u.xsrfCookieName?n.read(u.xsrfCookieName):void 0;M&&(f[u.xsrfHeaderName]=M)}"setRequestHeader"in _&&e.forEach(f,function(e,t){void 0===m&&"content-type"===t.toLowerCase()?delete f[t]:_.setRequestHeader(t,e)}),e.isUndefined(u.withCredentials)||(_.withCredentials=!!u.withCredentials),v&&"json"!==v&&(_.responseType=u.responseType),"function"==typeof u.onDownloadProgress&&_.addEventListener("progress",u.onDownloadProgress),"function"==typeof u.onUploadProgress&&_.upload&&_.upload.addEventListener("progress",u.onUploadProgress),(u.cancelToken||u.signal)&&(g=function(e){_&&(h(!e||e&&e.type?new l:e),_.abort(),_=null)},u.cancelToken&&u.cancelToken.subscribe(g),u.signal&&(u.signal.aborted?g():u.signal.addEventListener("abort",g))),m||(m=null);var b=d(S);b&&-1===["http","https","file"].indexOf(b)?h(new c("Unsupported protocol "+b+":",c.ERR_BAD_REQUEST,u)):_.send(m)})}}function require_null(){return hasRequired_null?_null:(hasRequired_null=1,_null=null)}var utils$5=utils$b,normalizeHeaderName=normalizeHeaderName$1,AxiosError$1=AxiosError_1,transitionalDefaults=transitional,toFormData=toFormData_1,DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!utils$5.isUndefined(e)&&utils$5.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function getDefaultAdapter(){var e;return("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=requireXhr()),e}function stringifySafely(e,t,n){if(utils$5.isString(e))try{return(t||JSON.parse)(e),utils$5.trim(e)}catch(r){if("SyntaxError"!==r.name)throw r}return(n||JSON.stringify)(e)}var defaults$3={transitional:transitionalDefaults,adapter:getDefaultAdapter(),transformRequest:[function(e,t){if(normalizeHeaderName(t,"Accept"),normalizeHeaderName(t,"Content-Type"),utils$5.isFormData(e)||utils$5.isArrayBuffer(e)||utils$5.isBuffer(e)||utils$5.isStream(e)||utils$5.isFile(e)||utils$5.isBlob(e))return e;if(utils$5.isArrayBufferView(e))return e.buffer;if(utils$5.isURLSearchParams(e))return setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,r=utils$5.isObject(e),i=t&&t["Content-Type"];if((n=utils$5.isFileList(e))||r&&"multipart/form-data"===i){var o=this.env&&this.env.FormData;return toFormData(n?{"files[]":e}:e,o&&new o)}return r||"application/json"===i?(setContentTypeIfUnset(t,"application/json"),stringifySafely(e)):e}],transformResponse:[function(e){var t=this.transitional||defaults$3.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,i=!n&&"json"===this.responseType;if(i||r&&utils$5.isString(e)&&e.length)try{return JSON.parse(e)}catch(o){if(i){if("SyntaxError"===o.name)throw AxiosError$1.from(o,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response);throw o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:require_null()},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils$5.forEach(["delete","get","head"],function(e){defaults$3.headers[e]={}}),utils$5.forEach(["post","put","patch"],function(e){defaults$3.headers[e]=utils$5.merge(DEFAULT_CONTENT_TYPE)});var defaults_1=defaults$3,utils$4=utils$b,defaults$2=defaults_1,transformData$1=function(e,t,n){var r=this||defaults$2;return utils$4.forEach(n,function(n){e=n.call(r,e,t)}),e},isCancel$1,hasRequiredIsCancel;function requireIsCancel(){return hasRequiredIsCancel?isCancel$1:(hasRequiredIsCancel=1,isCancel$1=function(e){return!(!e||!e.__CANCEL__)})}var utils$3=utils$b,transformData=transformData$1,isCancel=requireIsCancel(),defaults$1=defaults_1,CanceledError=requireCanceledError();function throwIfCancellationRequested(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new CanceledError}var dispatchRequest$1=function(e){return throwIfCancellationRequested(e),e.headers=e.headers||{},e.data=transformData.call(e,e.data,e.headers,e.transformRequest),e.headers=utils$3.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),utils$3.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||defaults$1.adapter)(e).then(function(t){return throwIfCancellationRequested(e),t.data=transformData.call(e,t.data,t.headers,e.transformResponse),t},function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},utils$2=utils$b,mergeConfig$2=function(e,t){t=t||{};var n={};function r(e,t){return utils$2.isPlainObject(e)&&utils$2.isPlainObject(t)?utils$2.merge(e,t):utils$2.isPlainObject(t)?utils$2.merge({},t):utils$2.isArray(t)?t.slice():t}function i(n){return utils$2.isUndefined(t[n])?utils$2.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function o(e){if(!utils$2.isUndefined(t[e]))return r(void 0,t[e])}function s(n){return utils$2.isUndefined(t[n])?utils$2.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function a(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}var c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a};return utils$2.forEach(Object.keys(e).concat(Object.keys(t)),function(e){var t=c[e]||i,r=t(e);utils$2.isUndefined(r)&&t!==a||(n[e]=r)}),n},data,hasRequiredData;function requireData(){return hasRequiredData?data:(hasRequiredData=1,data={version:"0.27.2"})}var VERSION=requireData().version,AxiosError=AxiosError_1,validators$1={};["object","boolean","number","function","string","symbol"].forEach(function(e,t){validators$1[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});var deprecatedWarnings={};function assertOptions(e,t,n){if("object"!=typeof e)throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),i=r.length;i-- >0;){var o=r[i],s=t[o];if(s){var a=e[o],c=void 0===a||s(a,o,e);if(!0!==c)throw new AxiosError("option "+o+" must be "+c,AxiosError.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new AxiosError("Unknown option "+o,AxiosError.ERR_BAD_OPTION)}}validators$1.transitional=function(e,t,n){function r(e,t){return"[Axios v"+VERSION+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,o){if(!1===e)throw new AxiosError(r(i," has been removed"+(t?" in "+t:"")),AxiosError.ERR_DEPRECATED);return t&&!deprecatedWarnings[i]&&(deprecatedWarnings[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};var validator$1={assertOptions:assertOptions,validators:validators$1},utils$1=utils$b,buildURL=buildURL$1,InterceptorManager=InterceptorManager_1,dispatchRequest=dispatchRequest$1,mergeConfig$1=mergeConfig$2,buildFullPath=buildFullPath$1,validator=validator$1,validators=validator.validators;function Axios$1(e){this.defaults=e,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios$1.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=mergeConfig$1(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&validator.assertOptions(n,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))});var o,s=[];if(this.interceptors.response.forEach(function(e){s.push(e.fulfilled,e.rejected)}),!i){var a=[dispatchRequest,void 0];for(Array.prototype.unshift.apply(a,r),a=a.concat(s),o=Promise.resolve(t);a.length;)o=o.then(a.shift(),a.shift());return o}for(var c=t;r.length;){var l=r.shift(),d=r.shift();try{c=l(c)}catch(u){d(u);break}}try{o=dispatchRequest(c)}catch(u){return Promise.reject(u)}for(;s.length;)o=o.then(s.shift(),s.shift());return o},Axios$1.prototype.getUri=function(e){e=mergeConfig$1(this.defaults,e);var t=buildFullPath(e.baseURL,e.url);return buildURL(t,e.params,e.paramsSerializer)},utils$1.forEach(["delete","get","head","options"],function(e){Axios$1.prototype[e]=function(t,n){return this.request(mergeConfig$1(n||{},{method:e,url:t,data:(n||{}).data}))}}),utils$1.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,i){return this.request(mergeConfig$1(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Axios$1.prototype[e]=t(),Axios$1.prototype[e+"Form"]=t(!0)});var Axios_1=Axios$1,CancelToken_1,hasRequiredCancelToken,spread,hasRequiredSpread,isAxiosError,hasRequiredIsAxiosError;function requireCancelToken(){if(hasRequiredCancelToken)return CancelToken_1;hasRequiredCancelToken=1;var e=requireCanceledError();function t(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var n;this.promise=new Promise(function(e){n=e});var r=this;this.promise.then(function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}}),this.promise.then=function(e){var t,n=new Promise(function(e){r.subscribe(e),t=e}).then(e);return n.cancel=function(){r.unsubscribe(t)},n},t(function(t){r.reason||(r.reason=new e(t),n(r.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},t.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},t.source=function(){var e;return{token:new t(function(t){e=t}),cancel:e}},CancelToken_1=t}function requireSpread(){return hasRequiredSpread?spread:(hasRequiredSpread=1,spread=function(e){return function(t){return e.apply(null,t)}})}function requireIsAxiosError(){if(hasRequiredIsAxiosError)return isAxiosError;hasRequiredIsAxiosError=1;var e=utils$b;return isAxiosError=function(t){return e.isObject(t)&&!0===t.isAxiosError}}var utils=utils$b,bind=bind$2,Axios=Axios_1,mergeConfig=mergeConfig$2,defaults=defaults_1;function createInstance(e){var t=new Axios(e),n=bind(Axios.prototype.request,t);return utils.extend(n,Axios.prototype,t),utils.extend(n,t),n.create=function(t){return createInstance(mergeConfig(e,t))},n}var axios$2=createInstance(defaults);axios$2.Axios=Axios,axios$2.CanceledError=requireCanceledError(),axios$2.CancelToken=requireCancelToken(),axios$2.isCancel=requireIsCancel(),axios$2.VERSION=requireData().version,axios$2.toFormData=toFormData_1,axios$2.AxiosError=AxiosError_1,axios$2.Cancel=axios$2.CanceledError,axios$2.all=function(e){return Promise.all(e)},axios$2.spread=requireSpread(),axios$2.isAxiosError=requireIsAxiosError(),axios$3.exports=axios$2,axios$3.exports.default=axios$2;var axiosExports=axios$3.exports,axios=axiosExports;const axios$1=getDefaultExportFromCjs(axios);var eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,o||e,s),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var c,l,d=this._events[a],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,i),!0;case 5:return d.fn.call(d.context,t,r,i,o),!0;case 6:return d.fn.call(d.context,t,r,i,o,s),!0}for(l=1,c=new Array(u-1);l<u;l++)c[l-1]=arguments[l];d.fn.apply(d.context,c)}else{var p,h=d.length;for(l=0;l<h;l++)switch(d[l].once&&this.removeListener(e,d[l].fn,void 0,!0),u){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,t);break;case 3:d[l].fn.call(d[l].context,t,r);break;case 4:d[l].fn.call(d[l].context,t,r,i);break;default:if(!c)for(p=1,c=new Array(u-1);p<u;p++)c[p-1]=arguments[p];d[l].fn.apply(d[l].context,c)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var c=0,l=[],d=a.length;c<d;c++)(a[c].fn!==t||i&&!a[c].once||r&&a[c].context!==r)&&l.push(a[c]);l.length?this._events[o]=1===l.length?l[0]:l:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a}(eventemitter3);var eventemitter3Exports=eventemitter3.exports;const EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign$1=function(){return __assign$1=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign$1.apply(this,arguments)};function __awaiter$1(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})}function __generator$1(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function __values$1(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read$1(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function __spreadArray$1(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var request$1=function(e){var t=e.method,n=void 0===t?"POST":t,r=e.url,i=e.data,o=e.headers;return __awaiter$1(void 0,void 0,void 0,function(){var e,t;return __generator$1(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,axios$1({method:n,url:r,data:i,headers:o})];case 1:return 200!==(e=s.sent()).data.code?[2,Promise.reject(e.data)]:[2,e.data];case 2:return t=s.sent(),[2,Promise.reject(t)];case 3:return[2]}})})},webRequestHelper=request$1,request=webRequestHelper,url$1="https://statistic.live.126.net/statics/report/xkit/action",EventTracking=function(){function e(e){var t=e.appKey,n=e.version,r=e.component,i=e.nertcVersion,o=e.imVersion,s=e.os,a=void 0===s?"":s,c=e.framework,l=void 0===c?"":c,d=e.language,u=void 0===d?"":d,p=e.container,h=void 0===p?"":p,g=e.platform,m=void 0===g?"Web":g,f=e.channel,v=void 0===f?"netease":f;this.platform=m,this.appKey=t,this.version=n,this.component=r,this.nertcVersion=i,this.imVersion=o,this.channel=v,this.os=a,this.framework=l,this.language=u,this.container=h}return e.prototype.track=function(e,t){return __awaiter$1(this,void 0,void 0,function(){var n,r,i,o,s,a,c,l,d,u,p,h,g;return __generator$1(this,function(m){switch(m.label){case 0:r=(n=this).appKey,i=n.version,o=n.component,s=n.nertcVersion,a=n.imVersion,c=n.platform,l=n.channel,d=n.os,u=n.framework,p=n.language,h=n.container,g=Date.now(),m.label=1;case 1:return m.trys.push([1,3,,4]),[4,request({method:"POST",url:url$1,data:{appKey:r,version:i,component:o,timeStamp:g,nertcVersion:s,imVersion:a,platform:c,reportType:e,data:t,channel:l,os:d,framework:u,language:p,container:h}})];case 2:case 3:return m.sent(),[3,4];case 4:return[2]}})})},e}(),EventTracking$1=EventTracking;!function(e){function t(t){var n=e.call(this)||this;return n.visibilityState=document.visibilityState,n.entries=[],n._visibilitychange=function(){n.visibilityState=document.visibilityState,n._trigger()},n.intersectionObserver=new IntersectionObserver(n._intersectionObserverHandler.bind(n),t),document.addEventListener("visibilitychange",n._visibilitychange),n}__extends(t,e),t.prototype.observe=function(e){return this.intersectionObserver.observe(e)},t.prototype.unobserve=function(e){return this.intersectionObserver.unobserve(e)},t.prototype.destroy=function(){this.intersectionObserver.disconnect(),document.removeEventListener("visibilitychange",this._visibilitychange),this.entries=[]},t.prototype._intersectionObserverHandler=function(e){this.entries=e,this._trigger()},t.prototype._trigger=function(){var e=this;this.entries.forEach(function(t){"visible"!==e.visibilityState||t.intersectionRatio<=0?e.emit("visibleChange",{visible:!1,target:t.target}):e.emit("visibleChange",{visible:!0,target:t.target})})}}(EventEmitter);var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var loglevel=createCommonjsModule(function(e){var t,n;t=commonjsGlobal,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(r,i,o){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?a:void 0!==console[r]?s(console,r):void 0!==console.log?s(console,"log"):e)}(r)||l.apply(this,arguments)}function u(e,n){var s,a,l,u=this,p="loglevel";function h(){var e;if(typeof window!==t&&p){try{e=window.localStorage[p]}catch(o){}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(p),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch(o){}return void 0===u.levels[e]&&(e=void 0),e}}function g(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?p+=":"+e:"symbol"==typeof e&&(p=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){return null!=l?l:null!=a?a:s},u.setLevel=function(e,n){return l=g(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&p){try{return void(window.localStorage[p]=n)}catch(i){}try{window.document.cookie=encodeURIComponent(p)+"="+n+";"}catch(i){}}}(l),c.call(u)},u.setDefaultLevel=function(e){a=g(e),h()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,function(){if(typeof window!==t&&p){try{window.localStorage.removeItem(p)}catch(e){}try{window.document.cookie=encodeURIComponent(p)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(o!==u&&(s=g(o.getLevel())),c.call(u),o===u)for(var e in i)i[e].rebuild()},s=g(o?o.getLevel():"WARN");var m=h();null!=m&&(l=g(m)),c.call(u)}(o=new u).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new u(e,o.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=p),o},o.getLoggers=function(){return i},o.default=o,o},e.exports?e.exports=n():t.log=n()}),log=loglevel;function sensitiveInfoFilter(e){var t=["scene/apps/***/",'"rtcKey":"***"','"imKey":"***"','"appkey":"***"','"appkey": "***"','appkey:"***"','appkey: "***"','"appkey":***','"appkey": ***',"appkey:***","appkey: ***"];return["scene/apps/[a-z0-9]{32}/",'"rtcKey":"[a-z0-9]{32}"','"imKey":"[a-z0-9]{32}"','"appkey":"[a-z0-9]{32}"','"appkey": "[a-z0-9]{32}"','appkey:"[a-z0-9]{32}"','appkey: "[a-z0-9]{32}"','"appkey":[a-z0-9]{32}','"appkey": [a-z0-9]{32}',"appkey:[a-z0-9]{32}","appkey: [a-z0-9]{32}"].forEach(function(n,r){var i=new RegExp(n,"gi");e=e.replace(i,t[r])}),e}var logDebug=function(e){var t,n=void 0===e?{appName:"",version:"",storeWindow:!1,needStringify:!0}:e,r=n.level,i=n.appName,o=void 0===i?"":i,s=n.storeWindow,a=void 0!==s&&s,c=n.needStringify,l=void 0===c||c,d=function(){try{var e=navigator.userAgent.toLocaleLowerCase(),t=e.match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/)||[];return{browser:t[1].replace(/version/,"safari"),ver:t[2]}}catch(n){return null}},u=(t=new Proxy(log,{get:function(e,t){var n,r;if(t in e){var i=e[t];if(!["log","info","warn","error","trace","debug"].includes(t))return i;var s,a,c,u,p,h,g,m=(a=(s=new Date).getFullYear(),c=s.getMonth()+1,u=s.getDate(),p=s.getHours()<10?"0".concat(s.getHours()):s.getHours(),h=s.getMinutes()<10?"0".concat(s.getMinutes()):s.getMinutes(),g=s.getSeconds()<10?"0".concat(s.getSeconds()):s.getSeconds(),"".concat(a,"-").concat(c,"-").concat(u," ").concat(p,":").concat(h,":").concat(g));d()&&(m+="[".concat(null===(n=d())||void 0===n?void 0:n.browser," ").concat(null===(r=d())||void 0===r?void 0:r.ver,"]")),m+="[".concat({log:"L",info:"I",warn:"W",error:"E",trace:"E",debug:"D"}[t],"]")+"[".concat(o,"]")+":";var f=this;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(l)for(var n=0;n<e.length;n++){if("object"==typeof e[n])try{e[n]=JSON.stringify(e[n])}catch(r){console.warn("[日志打印对象无法序列化]",e[n])}"string"==typeof e[n]&&(e[n]=sensitiveInfoFilter(e[n]))}return i.apply(f,__spreadArray$1([m],__read$1(e),!1))}}}}),t);return r&&u.setLevel(r),a&&(window.__LOGGER__=u),u},logDebug$1=logDebug,EventPriority,EventPriority2;EventPriority2=EventPriority||(EventPriority={}),EventPriority2[EventPriority2.LOW=0]="LOW",EventPriority2[EventPriority2.NORMAL=1]="NORMAL",EventPriority2[EventPriority2.HIGH=2]="HIGH";var ReportEvent=function(){function e(e){this.appKey="",this.component="",this.data={},this.framework="",this.version="",this.startTime=0,this.endTime=0,this.duration=0,this.data.startTime=(new Date).getTime(),this.data.timeStamp=this.data.startTime,this.eventId=e.eventId,this.priority=e.priority}return e.prototype.end=function(){this.data.endTime&&this.data.duration||(this.data.endTime=this.data.endTime||(new Date).getTime(),this.data.duration=this.data.duration||this.data.endTime-this.data.startTime)},e.prototype.setAppInfo=function(e){this.appKey=e.appKey,this.component=e.component,this.version=e.version,e.framework&&(this.framework=e.framework)},e.prototype.endWith=function(e){var t=e.code,n=e.msg,r=e.requestId,i=e.serverCost;this.data.code="number"!=typeof t?-2:t,this.data.message=n,this.data.requestId=r,this.data.serverCost=i,this.end()},e.prototype.endWithSuccess=function(e){if(e){var t=e.requestId,n=e.serverCost;this.data.requestId=t,this.data.serverCost=n}this.data.code=0,this.data.message="success",this.end()},e.prototype.endWithFailure=function(e){if(e){var t=e.requestId,n=e.serverCost;this.data.requestId=t,this.data.serverCost=n}this.data.code=-1,this.data.message="failure",this.end()},e.prototype.setParams=function(e){return this.data.params=__assign$1({},e),this},e.prototype.addParams=function(e){return this.data.params=__assign$1(__assign$1({},this.data.params),e),this},e.prototype.setData=function(e){this.data=__assign$1(__assign$1({},this.data),e)},e.prototype.setUserId=function(e){this.data.userId=e},e}(),EventStep=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(ReportEvent);function getFileType(e){var t={img:/(png|gif|jpg)/i,pdf:/pdf$/i,word:/(doc|docx)$/i,excel:/(xls|xlsx)$/i,ppt:/(ppt|pptx)$/i,zip:/(zip|rar|7z)$/i,audio:/(mp3|wav|wmv)$/i,video:/(mp4|mkv|rmvb|wmv|avi|flv|mov)$/i};return Object.keys(t).find(function(n){return t[n].test(e)})||""}!function(e){function t(t){var n=e.call(this,t)||this;return n._stepMap=new Map,n}__extends(t,e),t.prototype.beginStep=function(e){if(this._stepMap.has(e))return this._stepMap[e];var t=new EventStep({eventId:e,priority:this.priority});return t.setData({step:e}),this._stepMap.set(e,t),t},t.prototype.addStep=function(e){this._stepMap.set(e.eventId,e)},t.prototype.removeStep=function(e){this._stepMap.delete(e)},t.prototype.endWith=function(t){e.prototype.endWith.call(this,t),this.end()},t.prototype.endWithSuccess=function(t){e.prototype.endWithSuccess.call(this,t),this.end()},t.prototype.endWithFailure=function(t){e.prototype.endWithFailure.call(this,t),this.end()},t.prototype.end=function(){var t,n,r=[];e.prototype.end.call(this);try{for(var i=__values$1(this._stepMap.values()),o=i.next();!o.done;o=i.next()){var s=o.value;s.data.index=r.length,r.push(s.data)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}r.length>0&&(this.data.steps=r)}}(EventStep);var parseFileSize=function(e,t){void 0===t&&(t=0);var n={0:"B",1:"KB",2:"MB",3:"GB",4:"TB"},r=function(e,t){return t>=Object.keys(n).length?"the file is too big":e<1024?"".concat(e).concat(n[t]):r(Math.round(e/1024),t+1)};return r(e,t)};function debounce(e,t){var n=null;return function(){for(var r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];n&&(clearTimeout(n),n=null),n=setTimeout(function(){e.apply(r,i)},t)}}var __assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign.apply(this,arguments)};function __rest(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function __awaiter(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})}function __generator(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function __spreadArray(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var ConnectStore=function(){function e(e,t,n){this.rootStore=e,this.nim=t,this.localOptions=n,this.connectStatus=3,this.loginStatus=0,this.logger=null,makeAutoObservable(this),this._onLoginStatus=this._onLoginStatus.bind(this),this._onLoginFailed=this._onLoginFailed.bind(this),this._onKickedOffline=this._onKickedOffline.bind(this),this._onLoginClientChanged=this._onLoginClientChanged.bind(this),this._onConnectStatus=this._onConnectStatus.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this._onConnectFailed=this._onConnectFailed.bind(this),this._onDataSync=this._onDataSync.bind(this),this.logger=e.logger,t.V2NIMLoginService.on("onLoginStatus",this._onLoginStatus),t.V2NIMLoginService.on("onLoginFailed",this._onLoginFailed),t.V2NIMLoginService.on("onKickedOffline",this._onKickedOffline),t.V2NIMLoginService.on("onLoginClientChanged",this._onLoginClientChanged),t.V2NIMLoginService.on("onConnectStatus",this._onConnectStatus),t.V2NIMLoginService.on("onDisconnected",this._onDisconnected),t.V2NIMLoginService.on("onConnectFailed",this._onConnectFailed),t.V2NIMLoginService.on("onDataSync",this._onDataSync)}return e.prototype.destroy=function(){this.nim.V2NIMLoginService.off("onLoginStatus",this._onLoginStatus),this.nim.V2NIMLoginService.off("onLoginFailed",this._onLoginFailed),this.nim.V2NIMLoginService.off("onKickedOffline",this._onKickedOffline),this.nim.V2NIMLoginService.off("onLoginClientChanged",this._onLoginClientChanged),this.nim.V2NIMLoginService.off("onConnectStatus",this._onConnectStatus),this.nim.V2NIMLoginService.off("onDisconnected",this._onDisconnected),this.nim.V2NIMLoginService.off("onConnectFailed",this._onConnectFailed),this.nim.V2NIMLoginService.off("onDataSync",this._onDataSync)},e.prototype._onLoginStatus=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onLoginStatus",e),this.loginStatus=e},e.prototype._onLoginFailed=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onLoginFailed",e)},e.prototype._onKickedOffline=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onKickedOffline",e)},e.prototype._onLoginClientChanged=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onLoginClientChanged",e)},e.prototype._onConnectStatus=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onConnectStatus",e),this.connectStatus=e,1===e&&this.rootStore.subscriptionStore.resetState()},e.prototype._onDisconnected=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onDisconnected",e)},e.prototype._onConnectFailed=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onConnectFailed",e)},e.prototype._onDataSync=function(e,t){var n,r,i,o;null===(n=this.logger)||void 0===n||n.log("_onDataSync",e,t),this.rootStore.userStore.getMyUserInfoActive(),this.rootStore.relationStore.getBlockListActive(),this.rootStore.relationStore.getP2PMuteListActive(),(null===(r=this.rootStore.sdkOptions)||void 0===r?void 0:r.enableV2CloudConversation)?null===(i=this.rootStore.conversationStore)||void 0===i||i.getConversationListActive(0,this.localOptions.conversationLimit||100):null===(o=this.rootStore.localConversationStore)||void 0===o||o.getConversationListActive(0,this.localOptions.conversationLimit||100),this.rootStore.teamStore.getJoinedTeamListActive(),this.rootStore.friendStore.getFriendListActive(),this.rootStore.friendStore.getAddApplicationListActive({status:[],offset:0,limit:100}),this.rootStore.teamStore.getTeamJoinActionInfoListActive({offset:0,limit:100}),this.localOptions.aiVisible&&this.rootStore.aiUserStore.getAIUserListActive()},e}(),FriendStore=function(){function e(e,t){this.rootStore=e,this.nim=t,this.friends=new Map,this.logger=null,makeAutoObservable(this),this._onFriendAdded=this._onFriendAdded.bind(this),this._onFriendDeleted=this._onFriendDeleted.bind(this),this._onFriendAddApplication=this._onFriendAddApplication.bind(this),this._onFriendAddRejected=this._onFriendAddRejected.bind(this),this._onFriendInfoChanged=this._onFriendInfoChanged.bind(this),this.logger=e.logger,t.V2NIMFriendService.on("onFriendAdded",this._onFriendAdded),t.V2NIMFriendService.on("onFriendDeleted",this._onFriendDeleted),t.V2NIMFriendService.on("onFriendAddApplication",this._onFriendAddApplication),t.V2NIMFriendService.on("onFriendAddRejected",this._onFriendAddRejected),t.V2NIMFriendService.on("onFriendInfoChanged",this._onFriendInfoChanged)}return e.prototype.resetState=function(){this.friends.clear()},e.prototype.destroy=function(){this.resetState(),this.nim.V2NIMFriendService.off("onFriendAdded",this._onFriendAdded),this.nim.V2NIMFriendService.off("onFriendDeleted",this._onFriendDeleted),this.nim.V2NIMFriendService.off("onFriendAddApplication",this._onFriendAddApplication),this.nim.V2NIMFriendService.off("onFriendAddRejected",this._onFriendAddRejected),this.nim.V2NIMFriendService.off("onFriendInfoChanged",this._onFriendInfoChanged)},e.prototype.getFriendListActive=function(){var e,t,n;return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(e=this.logger)||void 0===e||e.log("getFriendListActive"),[4,this.nim.V2NIMFriendService.getFriendList()];case 1:return r=o.sent(),this.addFriend(r),null===(t=this.logger)||void 0===t||t.log("getFriendListActive success",r),[2,r];case 2:throw i=o.sent(),null===(n=this.logger)||void 0===n||n.error("getFriendListActive failed: ",i),i;case 3:return[2]}})})},e.prototype.getFriendByIdsActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("getFriendByIdsActive",e),[4,this.nim.V2NIMFriendService.getFriendByIds(e)];case 1:return i=s.sent(),this.addFriend(i),null===(n=this.logger)||void 0===n||n.log("getFriendByIdsActive success",i),[2,i];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("getFriendByIdsActive failed: ",o),o;case 3:return[2]}})})},e.prototype.getAddApplicationListActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("getAddApplicationListActive"),[4,this.nim.V2NIMFriendService.getAddApplicationList(e)];case 1:return i=s.sent(),this.rootStore.sysMsgStore.addFriendApplyMsg(i.infos),null===(n=this.logger)||void 0===n||n.log("getAddApplicationListActive success",i),[2,i];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("getAddApplicationListActive failed: ",o),o;case 3:return[2]}})})},e.prototype.addFriendActive=function(e,t){var n,r,i;return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("addFriendActive",e),[4,this.nim.V2NIMFriendService.addFriend(e,t)];case 1:return s.sent(),null===(r=this.logger)||void 0===r||r.log("addFriendActive success",e,t),[3,3];case 2:throw o=s.sent(),null===(i=this.logger)||void 0===i||i.error("addFriendActive failed: ",e,t,o),o;case 3:return[2]}})})},e.prototype.acceptAddApplicationActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("acceptAddApplicationActive",e),[4,this.nim.V2NIMFriendService.acceptAddApplication(e)];case 1:return o.sent(),null===(n=this.logger)||void 0===n||n.log("acceptAddApplicationActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("acceptAddApplicationActive failed: ",e,i),i;case 3:return[2]}})})},e.prototype.rejectAddApplicationActive=function(e,t){var n,r,i;return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("rejectAddApplicationActive",e,t),[4,this.nim.V2NIMFriendService.rejectAddApplication(e,t)];case 1:return s.sent(),null===(r=this.logger)||void 0===r||r.log("rejectFriendApplyActive success",e,t),[3,3];case 2:throw o=s.sent(),null===(i=this.logger)||void 0===i||i.error("rejectFriendApplyActive failed: ",e,t,o),o;case 3:return[2]}})})},e.prototype.deleteFriendActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("deleteFriendActive",e),[4,this.nim.V2NIMFriendService.deleteFriend(e,{deleteAlias:!0})];case 1:return o.sent(),this.removeFriend([e]),null===(n=this.logger)||void 0===n||n.log("deleteFriendActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("deleteFriendActive failed: ",e,i),i;case 3:return[2]}})})},e.prototype.setFriendInfoActive=function(e,t){var n,r,i;return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("setFriendInfoActive",e,t),[4,this.nim.V2NIMFriendService.setFriendInfo(e,t)];case 1:return s.sent(),null===(r=this.logger)||void 0===r||r.log("setFriendInfoActive success",e,t),[3,3];case 2:throw o=s.sent(),null===(i=this.logger)||void 0===i||i.error("setFriendInfoActive failed: ",e,t,o),o;case 3:return[2]}})})},e.prototype.addFriend=function(e){var t=this;e.filter(function(e){return!!e.accountId}).forEach(function(e){var n=t.friends.get(e.accountId);n?t.friends.set(e.accountId,__assign(__assign(__assign({},n),e),e.userProfile)):t.friends.set(e.accountId,__assign(__assign({},e),e.userProfile))}),this.rootStore.userStore.addUsers(e.map(function(e){return __assign(__assign({},e),e.userProfile)}))},e.prototype.removeFriend=function(e){var t=this;e.forEach(function(e){t.friends.delete(e)})},e.prototype._onFriendAdded=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onFriendAdded",e),this.addFriend([e]),this.rootStore.sysMsgStore.updateFriendApplyMsg([{operatorAccountId:this.rootStore.userStore.myUserInfo.accountId,applicantAccountId:e.accountId,recipientAccountId:this.rootStore.userStore.myUserInfo.accountId,timestamp:Date.now(),status:1,isRead:!0,read:!0}])},e.prototype._onFriendDeleted=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onFriendDeleted",e),e&&this.removeFriend([e])},e.prototype._onFriendAddApplication=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onFriendAddApplication",e),e.applicantAccountId!==this.rootStore.userStore.myUserInfo.accountId&&this.rootStore.sysMsgStore.addFriendApplyMsg([e])},e.prototype._onFriendAddRejected=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onFriendAddRejected",e),this.rootStore.sysMsgStore.addFriendApplyMsg([__assign(__assign({},e),{isRead:!0})])},e.prototype._onFriendInfoChanged=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onFriendInfoChanged",e),this.addFriend([e])},e}(),AT_ALL_ACCOUNT="ait_all",HISTORY_LIMIT=20,PIN_CONVERSATION_LIMIT=20,RECALL_TIME=12e4,AI_MESSAGE_LIMIT=30,name$1="@xkit-yx/im-store-v2",version$1="0.8.5",description$1="云信即时通讯 store V2 版本",license$1="MIT",main$1="dist/index.cjs.js",module="dist/index.esm.js",typings="dist/types/index.d.ts",publishConfig={access:"public"},scripts$1={dev:"rollup -c --environment DEV",build:"rollup -c --environment PROD"},files$1=["dist"],author$1="",devDependencies$1={"@rollup/plugin-commonjs":"^17.1.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.0",del:"^6.0.0",gulp:"^4.0.2","gulp-less":"^5.0.0","gulp-rename":"^2.0.0","gulp-typescript":"^6.0.0-alpha.1",less:"^4.1.1","less-plugin-npm-import":"^2.1.0","nim-web-sdk-ng":"10.9.30",postcss:"^8.3.5","postcss-nested":"^5.0.5",rollup:"^2.39.0","rollup-plugin-postcss":"^4.0.0","rollup-plugin-terser":"^7.0.2","rollup-plugin-typescript2":"^0.31.0",tslib:"^2.5.0",typescript:"^4.6.4"},peerDependencies={"nim-web-sdk-ng":"^10.x"},dependencies={"@xkit-yx/utils":"^0.7.2",mobx:"^6.6.1"},packageJson={name:name$1,version:version$1,description:description$1,license:license$1,main:main$1,module:module,typings:typings,publishConfig:publishConfig,scripts:scripts$1,files:files$1,author:author$1,devDependencies:devDependencies$1,peerDependencies:peerDependencies,dependencies:dependencies},logger=logDebug$1({level:"debug",version:packageJson.version,appName:packageJson.name,needStringify:!1}),frequencyControl=function(e,t,n){var r,i=[],o=!1;return function(s){var a=this;return new Promise(function(c,l){var d=i.find(function(e){return e.args===s});if(d?d.queue.push({resolve:c,reject:l}):i.push({args:s,queue:[{resolve:c,reject:l}]}),!o){var u=function(t){t.length&&(o=!0,e.call(a,t.map(function(e){return e.args})).then(function(e){for(var n=function(){var n=t.shift();if(n){var r=e.find(function(e){return e.accountId===n.args});n.queue.forEach(function(e){return e.resolve(r)})}};t.length;)n()}).catch(function(e){for(;t.length;){var n=t.shift();n&&n.queue.forEach(function(t){return t.reject(e)})}}).finally(function(){o=!1,i.length&&u(i.splice(0,n))}))};i.length>=n?(clearTimeout(r),u(i.splice(0,n))):(clearTimeout(r),r=setTimeout(function(){u(i.splice(0,n))},t))}})}},batchRequest=function(e,t){return function(n){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return __awaiter(this,void 0,void 0,function(){var i,o,s,a,c,l,d,u;return __generator(this,function(p){switch(p.label){case 0:return n.length?[3,2]:[4,e.apply(this,[n].concat(r))];case 1:p.sent(),p.label=2;case 2:for(i=[],o=0;o<n.length;o+=t)i.push(n.slice(o,o+t));p.label=3;case 3:p.trys.push([3,8,9,10]),s=__values(i),a=s.next(),p.label=4;case 4:return a.done?[3,7]:(c=a.value,[4,e.apply(this,[c].concat(r))]);case 5:p.sent(),p.label=6;case 6:return a=s.next(),[3,4];case 7:return[3,10];case 8:return l=p.sent(),d={error:l},[3,10];case 9:try{a&&!a.done&&(u=s.return)&&u.call(s)}finally{if(d)throw d.error}return[7];case 10:return[2]}})})}};function detectLanguage(){var e,t;if("undefined"!=typeof window){if(null===window||void 0===window?void 0:window.__VUE__)return(null===(t=null===(e=null===window||void 0===window?void 0:window.Vue)||void 0===e?void 0:e.version)||void 0===t?void 0:t.startsWith("2"))?"Vue2":"Vue3";if(null===window||void 0===window?void 0:window.__REACT_DEVTOOLS_GLOBAL_HOOK__)return"React"}return"unknown"}function detectContainer(e){var t,n;return"Web"===e?"WEB":"H5"===e?"H5":"UniApp"===e?null===(n=null===(t=null===uni||void 0===uni?void 0:uni.getSystemInfoSync())||void 0===t?void 0:t.uniPlatform)||void 0===n?void 0:n.toUpperCase():void 0}var Queue=function(){function e(e,t){void 0===e&&(e=20),void 0===t&&(t="rightToLeft"),this.itemLength=e,this.flow=t,this.queue=[],makeAutoObservable(this)}return e.prototype.push=function(e,t){this.queue.push(e),this._handle(t)},e.prototype.unshift=function(e,t){this.queue.unshift(e),this._handle(t)},e.prototype.pop=function(){return this.queue.pop()},e.prototype.shift=function(){return this.queue.shift()},e.prototype.resetLimitState=function(){this._handle()},e.prototype.clear=function(){this.queue.length=0},e.prototype.get=function(){return this.queue},e.prototype.set=function(e,t){this.queue=e,this._handle(t)},Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),e.prototype._handle=function(e){void 0===e&&(e=!1),this.queue.length>this.itemLength&&!e&&("leftToRight"===this.flow?this.queue.splice(this.itemLength,this.queue.length-this.itemLength):this.queue.splice(0,this.queue.length-this.itemLength))},e}(),QueueMap=function(){function e(e,t){void 0===e&&(e=20),void 0===t&&(t="rightToLeft"),this.itemLength=e,this.flow=t,this.map=new Map,makeAutoObservable(this)}return e.prototype.get=function(e){var t;return null===(t=this.map.get(e))||void 0===t?void 0:t.get()},e.prototype.set=function(e,t,n){var r=new Queue(this.itemLength,this.flow);r.set(t,n),this.map.set(e,r)},e.prototype.delete=function(e){var t;return null===(t=this.map.get(e))||void 0===t||t.clear(),this.map.delete(e)},e.prototype.resetLimitState=function(){this.map.forEach(function(e){return e.resetLimitState()})},e.prototype.clear=function(){this.map.forEach(function(e){return e.clear()}),this.map.clear()},e.prototype.values=function(){return __spreadArray([],__read(this.map.values()),!1).map(function(e){return e.get()}).flat()},e}(),PinMsgsMap=function(){function e(e){void 0===e&&(e=PIN_CONVERSATION_LIMIT),this.map=new Map,this.pinConversationLimit=PIN_CONVERSATION_LIMIT,this.pinConversationLimit=e,makeAutoObservable(this)}return e.prototype.set=function(e,t){var n=this.map.get(e)||new Map;if(this.map.has(e)&&this.map.delete(e),t.forEach(function(e){0!==e.pinState?n.set(e.messageRefer.messageClientId,e):n.delete(e.messageRefer.messageClientId)}),this.map.set(e,n),this.map.size>this.pinConversationLimit){var r=this.map.keys().next().value;r&&this.map.delete(r)}},e.prototype.get=function(e){var t=this.map.get(e);return t?(this.map.delete(e),this.map.set(e,t),t):null},e.prototype.delete=function(e,t){var n=this.map.get(e);n&&(this.map.delete(e),t.forEach(function(e){n.delete(e)}),this.map.set(e,n))},e.prototype.clear=function(){this.map&&(this.map.forEach(function(e){e.clear()}),this.map.clear())},e}(),PinMsgsMap$1=PinMsgsMap,MsgStore=function(){function e(e,t,n){this.rootStore=e,this.nim=t,this.localOptions=n,this.msgs=new QueueMap(HISTORY_LIMIT,"rightToLeft"),this.replyMsgs=new Map,this.logger=null,this.pinMsgs=new PinMsgsMap$1,this.collectionMsgs=new Map,makeAutoObservable(this),this.logger=e.logger,this._onReceiveMessages=this._onReceiveMessages.bind(this),this._onClearHistoryNotifications=this._onClearHistoryNotifications.bind(this),this._onMessageDeletedNotifications=this._onMessageDeletedNotifications.bind(this),this._onMessagePinNotification=this._onMessagePinNotification.bind(this),this._onMessageQuickCommentNotification=this._onMessageQuickCommentNotification.bind(this),this._onMessageRevokeNotifications=this._onMessageRevokeNotifications.bind(this),this._onReceiveP2PMessageReadReceipts=this._onReceiveP2PMessageReadReceipts.bind(this),this._onReceiveTeamMessageReadReceipts=this._onReceiveTeamMessageReadReceipts.bind(this),this._onReceiveMessagesModified=this._onReceiveMessagesModified.bind(this),this.getTeamMsgReadsActive=batchRequest(this.getTeamMsgReadsActive,50),t.V2NIMMessageService.on("onReceiveMessages",this._onReceiveMessages),t.V2NIMMessageService.on("onClearHistoryNotifications",this._onClearHistoryNotifications),t.V2NIMMessageService.on("onMessageDeletedNotifications",this._onMessageDeletedNotifications),t.V2NIMMessageService.on("onMessagePinNotification",this._onMessagePinNotification),t.V2NIMMessageService.on("onMessageQuickCommentNotification",this._onMessageQuickCommentNotification),t.V2NIMMessageService.on("onMessageRevokeNotifications",this._onMessageRevokeNotifications),t.V2NIMMessageService.on("onReceiveP2PMessageReadReceipts",this._onReceiveP2PMessageReadReceipts),t.V2NIMMessageService.on("onReceiveTeamMessageReadReceipts",this._onReceiveTeamMessageReadReceipts),t.V2NIMMessageService.on("onReceiveMessagesModified",this._onReceiveMessagesModified)}return e.prototype.resetState=function(){this.msgs.clear(),this.replyMsgs.clear(),this.pinMsgs.clear()},e.prototype.destroy=function(){var e=this;this.resetState(),this.nim.V2NIMMessageService.off("onReceiveMessages",this._onReceiveMessages),this.nim.V2NIMMessageService.off("onClearHistoryNotifications",this._onClearHistoryNotifications),this.nim.V2NIMMessageService.off("onMessageDeletedNotifications",this._onMessageDeletedNotifications),this.nim.V2NIMMessageService.off("onMessagePinNotification",this._onMessagePinNotification),this.nim.V2NIMMessageService.off("onMessageQuickCommentNotification",this._onMessageQuickCommentNotification),this.nim.V2NIMMessageService.off("onMessageRevokeNotifications",this._onMessageRevokeNotifications),this.nim.V2NIMMessageService.off("onReceiveP2PMessageReadReceipts",this._onReceiveP2PMessageReadReceipts),this.nim.V2NIMMessageService.off("onReceiveTeamMessageReadReceipts",this._onReceiveTeamMessageReadReceipts),this.getMsg().forEach(function(t){e._handleClearMsgTimer(t)})},e.prototype.replyMsgActive=function(e){(null==e?void 0:e.conversationId)&&this.replyMsgs.set(e.conversationId,e)},e.prototype.removeReplyMsgActive=function(e){this.replyMsgs.delete(e)},e.prototype.getReplyMsgActive=function(e){var t=this.replyMsgs.get(e);if(t)return this.handleMsgForSDK(t)},e.prototype.reCallMsgActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("reCallMsgActive",e),[4,this.nim.V2NIMMessageService.revokeMessage(this.handleMsgForSDK(e))];case 1:return s.sent(),this.removeMsg(e.conversationId,[e.messageClientId]),i=this._createReCallMsg(e),this.addMsg(i.conversationId,[i]),null===(n=this.logger)||void 0===n||n.log("reCallMsgActive success",e),[3,3];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("reCallMsgActive failed: ",e,o),o;case 3:return[2]}})})},e.prototype.deleteMsgActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a=this;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("deleteMsgActive",e),[4,this.nim.V2NIMMessageService.deleteMessages(e.map(function(e){return a.handleMsgForSDK(e)}))];case 1:return c.sent(),(i=e[0].conversationId)&&(o=e.map(function(e){return e.messageClientId}),this.removeMsg(i,o)),null===(n=this.logger)||void 0===n||n.log("deleteMsgActive success",e),[3,3];case 2:throw s=c.sent(),null===(r=this.logger)||void 0===r||r.warn("deleteMsgActive failed, but delete msgs from memory: ",e,s),s;case 3:return[2]}})})},e.prototype.replyMessageByThreadActive=function(e,t,n,r){var i,o,s;return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),null===(i=this.logger)||void 0===i||i.log("replyMessageByThreadActive",e,t),[4,this.nim.V2NIMMessageService.replyMessage(e,t,r)];case 1:return a=l.sent(),this.removeReplyMsgActive(n),this._handleSendMsgSuccess(a.message),null===(o=this.logger)||void 0===o||o.log("replyMessageByThreadActive success",{message:e,repliedMessage:t},a),[3,3];case 2:throw c=l.sent(),null===(s=this.logger)||void 0===s||s.error("replyMessageByThreadActive fail",e,t),e.threadReply=t,this._handleSendMsgSuccess(e),c;case 3:return[2]}})})},e.prototype.sendMessageActive=function(e){var t,n,r,i,o,s,a,c,l;return __awaiter(this,void 0,void 0,function(){var d,u,p,h,g,m,f,v,y,_,I,T,S,E,M,b,C,A=this;return __generator(this,function(O){switch(O.label){case 0:null===(t=this.logger)||void 0===t||t.log("sendMessageActive",e),d=e.msg,u=e.conversationId,p=e.conversationType,h=e.progress,g=e.sendBefore,m=e.serverExtension,f=e.previewImg,v=e.onAISend,y=__assign({},d),_={},_=(null===(n=this.localOptions)||void 0===n?void 0:n.sendReplyMsgByExt)?this._formatExtField(u,m||JSON.parse(y.serverExtension||"{}")):m||JSON.parse(y.serverExtension||"{}"),y.serverExtension=Object.keys(_).length?JSON.stringify(_):void 0,y.senderId=this.rootStore.userStore.myUserInfo.accountId,y.receiverId=this.nim.V2NIMConversationIdUtil.parseConversationTargetId(u),y.conversationId=u,void 0!==p&&(y.conversationType=p),y.sendingState=3,f&&(y.previewImg=f),h&&(y.uploadProgress=0),O.label=1;case 1:return O.trys.push([1,6,,7]),[4,null===(i=(r=this.localOptions).sendMsgBefore)||void 0===i?void 0:i.call(r,e)];case 2:return!1===(I=O.sent())?(null===(o=this.logger)||void 0===o||o.log("sendMessageActive cancel",e,I),[2]):(T=this._getAIConfig(y),this.addMsg(y.conversationId,[y]),null==g||g(y),S=T||(null==I?void 0:I.aiConfig)?__assign(__assign({},T),null==I?void 0:I.aiConfig):void 0,E=__assign(__assign({},I),{pushConfig:(null==I?void 0:I.pushConfig)||((null==_?void 0:_.yxAitMsg)?this._formatExtAitToPushInfo(_.yxAitMsg,y.text||""):void 0),messageConfig:__assign({readReceiptEnabled:!0},null==I?void 0:I.messageConfig),aiConfig:S}),null===(s=this.logger)||void 0===s||s.log("sendMessageActive finalParams: ",y,u,E),!(M=this.getReplyMsgActive(u))||(null===(a=this.localOptions)||void 0===a?void 0:a.sendReplyMsgByExt)?[3,4]:(y.serverExtension=Object.keys(_).length?JSON.stringify(_):void 0,[4,this.replyMessageByThreadActive(y,M,u,E)]));case 3:return O.sent(),null==g||g(y),[2];case 4:return[4,this.nim.V2NIMMessageService.sendMessage(y,u,E,function(e){if(null==h?void 0:h(e)){var t=A.getMsg(u,[y.messageClientId])[0];t&&A.addMsg(u,[__assign(__assign({},t),{uploadProgress:e})])}})];case 5:return b=O.sent().message,S&&(null==v||v(b,S)),6!==d.messageType&&1!==d.messageType&&3!==d.messageType||(b.uploadProgress=100),this._handleSendMsgSuccess(b),null===(c=this.logger)||void 0===c||c.log("sendMessageActive success",b),0===y.messageType&&this.removeReplyMsgActive(u),[2,b];case 6:throw C=O.sent(),null===(l=this.logger)||void 0===l||l.error("sendMessageActive failed: ",C.toString(),y),191002===C.code?this.removeMsg(u,[y.messageClientId]):this._handleSendMsgFail(y,C.code),0===y.messageType&&this.removeReplyMsgActive(u),C;case 7:return[2]}})})},e.prototype.cancelMessageAttachmentUploadActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("cancelMessageAttachmentUploadActive",e),[4,this.nim.V2NIMMessageService.cancelMessageAttachmentUpload(this.handleMsgForSDK(e))];case 1:return o.sent(),this.removeMsg(e.conversationId,[e.messageClientId]),null===(n=this.logger)||void 0===n||n.log("cancelMessageAttachmentUploadActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("cancelMessageAttachmentUploadActive failed: ",e,i),i;case 3:return[2]}})})},e.prototype.sendMsgReceiptActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("sendMsgReceiptActive",e),[4,this.nim.V2NIMMessageService.sendP2PMessageReceipt(this.handleMsgForSDK(e))];case 1:return o.sent(),null===(n=this.logger)||void 0===n||n.log("sendMsgReceiptActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("sendMsgReceiptActive failed: ",e,i.toString()),i;case 3:return[2]}})})},e.prototype.addCollectionActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("addCollectionActive",e),[4,this.nim.V2NIMMessageService.addCollection(e)];case 1:return o.sent(),null===(n=this.logger)||void 0===n||n.log("addCollectionActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("addCollectionActive failed: ",e,i.toString()),i;case 3:return[2]}})})},e.prototype.removeCollectionsActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("removeCollectionsActive",e),[4,this.nim.V2NIMMessageService.removeCollections(e)];case 1:return o.sent(),null===(n=this.logger)||void 0===n||n.log("removeCollectionsActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("removeCollectionsActive failed: ",e,i.toString()),i;case 3:return[2]}})})},e.prototype.getCollectionListByOptionActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s=this;return __generator(this,function(a){switch(a.label){case 0:i=[],a.label=1;case 1:return a.trys.push([1,3,,4]),null===(t=this.logger)||void 0===t||t.log("getCollectionListByOptionActive",e),[4,this.nim.V2NIMMessageService.getCollectionListByOption(e)];case 2:return(i=a.sent()).forEach(function(e){var t=JSON.parse(e.collectionData),n=s.nim.V2NIMMessageConverter.messageDeserialization(t.message);n&&s.collectionMsgs.set(n.messageClientId,n)}),null===(n=this.logger)||void 0===n||n.log("getCollectionListByOptionActive success",e),[3,4];case 3:throw o=a.sent(),null===(r=this.logger)||void 0===r||r.error("getCollectionListByOptionActive failed: ",e,o.toString()),o;case 4:return[2,i]}})})},e.prototype.sendTeamMsgReceiptActive=function(e){var t,n,r,i;return __awaiter(this,void 0,void 0,function(){var o,s,a=this;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),null===(t=this.logger)||void 0===t||t.log("sendTeamMsgReceiptActive",e),e.length?(o=e.map(function(e){return a.handleMsgForSDK(e)}),null===(n=this.logger)||void 0===n||n.log("sendTeamMsgReceiptActive finalParams: ",o),[4,this.nim.V2NIMMessageService.sendTeamMessageReceipts(o)]):[3,2];case 1:c.sent(),c.label=2;case 2:return null===(r=this.logger)||void 0===r||r.log("sendTeamMsgReceiptActive success",e),[3,4];case 3:throw s=c.sent(),null===(i=this.logger)||void 0===i||i.error("sendTeamMsgReceiptActive failed: ",e,s.toString()),s;case 4:return[2]}})})},e.prototype.getTeamMessageReceiptDetailsActive=function(e,t){var n,r,i;return __awaiter(this,void 0,void 0,function(){var o,s;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("getTeamMessageReceiptDetailsActive",e,t),[4,this.nim.V2NIMMessageService.getTeamMessageReceiptDetail(e,t)];case 1:return o=a.sent(),null===(r=this.logger)||void 0===r||r.log("getTeamMessageReceiptDetailsActive success:",e,t,o),[2,o];case 2:throw s=a.sent(),null===(i=this.logger)||void 0===i||i.error("getTeamMessageReceiptDetailsActive failed: ",e,t,s.toString()),s;case 3:return[2]}})})},e.prototype.getHistoryMsgActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a,c,l,d,u,p,h,g;return __generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,4,,5]),null===(t=this.logger)||void 0===t||t.log("getHistoryMsgActive",e),i=e.conversationId,o=e.endTime,s=e.lastMsgId,a=e.limit,c=void 0===a?100:a,l=this.nim.V2NIMConversationIdUtil.parseConversationType(i),d={conversationId:i,endTime:o,limit:c},s&&(u=this.getMsg(i,[s])[0])&&(d.anchorMessage=u),[4,this.nim.V2NIMMessageService.getMessageList(d)];case 1:return p=m.sent(),this.addMsg(i,p),2===l&&this.rootStore.localOptions.teamMsgReceiptVisible?(h=p.filter(function(e){return e.isSelf}).filter(function(e){return![5,10].includes(e.messageType)}),[4,this.getTeamMsgReadsActive(h,i)]):[3,3];case 2:m.sent(),m.label=3;case 3:return null===(n=this.logger)||void 0===n||n.log("getHistoryMsgActive success",e,d,p),[2,p];case 4:throw g=m.sent(),null===(r=this.logger)||void 0===r||r.error("getHistoryMsgActive failed: ",e,g.toString()),g;case 5:return[2]}})})},e.prototype.forwardMsgActive=function(e,t,n){var r,i,o,s;return __awaiter(this,void 0,void 0,function(){var a,c,l,d,u;return __generator(this,function(p){switch(p.label){case 0:if(p.trys.push([0,5,,6]),null===(r=this.logger)||void 0===r||r.log("forwardMsgActive",e,t,n),a=null==e?void 0:e.serverExtension)try{delete(a=JSON.parse(a)).yxReplyMsg,delete a.yxAitMsg,a=JSON.stringify(a)}catch(h){}return["canRecall","reCallTimer","yxUnread","yxRead"].forEach(function(t){delete e[t]}),""===(null===(i=e.pushConfig)||void 0===i?void 0:i.pushContent)&&delete e.pushConfig.pushContent,c=this.handleMsgForSDK(__assign(__assign({},e),{serverExtension:a})),(l=this.nim.V2NIMMessageCreator.createForwardMessage(c))?[4,this.sendMessageActive({msg:l,conversationId:t})]:[3,2];case 1:p.sent(),p.label=2;case 2:return n?(d=this.nim.V2NIMMessageCreator.createTextMessage(n),[4,this.sendMessageActive({msg:d,conversationId:t})]):[3,4];case 3:p.sent(),p.label=4;case 4:return null===(o=this.logger)||void 0===o||o.log("forwardMsgActive success",e,t,n),[3,6];case 5:throw u=p.sent(),null===(s=this.logger)||void 0===s||s.error("forwardMsgActive failed: ",u),u;case 6:return[2]}})})},e.prototype.getTeamMsgReadsActive=function(e,t){var n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a=this;return __generator(this,function(c){switch(c.label){case 0:if(null===(n=this.logger)||void 0===n||n.log("getTeamMsgReadsActive",e,t),i=[],!e.length)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.getTeamMessageReceipts(e.map(function(e){return a.handleMsgForSDK(e)}))];case 2:return i=c.sent(),[3,4];case 3:return o=c.sent(),null===(r=this.logger)||void 0===r||r.warn("getTeamMsgReadsActive failed but continue: ",o.toString()),[3,4];case 4:return s=e.filter(function(e){return i.some(function(t){return e.messageClientId===t.messageClientId})}).map(function(e){var t=i.find(function(t){return t.messageClientId===e.messageClientId});return t?a._updateReceiptMsg(e,{unread:t.unreadCount,read:t.readCount}):e}),this.addMsg(t,s),[2]}})})},e.prototype.pinMessageActive=function(e,t){var n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:null===(n=this.logger)||void 0===n||n.log("pinMessageActive",e,t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.pinMessage(e,t)];case 2:return o.sent(),[3,4];case 3:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.warn("pinMessageActive failed but continue: ",i.toString()),i;case 4:return[2]}})})},e.prototype.unpinMessageActive=function(e,t){var n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:null===(n=this.logger)||void 0===n||n.log("uppinMessageActive",e,t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.unpinMessage(e,t)];case 2:return o.sent(),[3,4];case 3:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.warn("uppinMessageActive failed but continue: ",i.toString()),i;case 4:return[2]}})})},e.prototype.updatePinMessageActive=function(e,t){var n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:null===(n=this.logger)||void 0===n||n.log("updatePinMessageActive",e,t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.updatePinMessage(e,t)];case 2:return o.sent(),[3,4];case 3:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.warn("updatePinMessageActive failed but continue: ",i.toString()),i;case 4:return[2]}})})},e.prototype.getPinnedMessageListActive=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t=this.pinMsgs.get(e),n=[],t?(n=__spreadArray([],__read(t.values()),!1),[3,3]):[3,1];case 1:return[4,this._getPinnedMessageListByServer(e)];case 2:n=r.sent(),r.label=3;case 3:return[4,this.completePinnedMessageList(e,n)];case 4:return[2,n=(n=r.sent()).filter(function(e){return e.pinState>0&&e.message}).sort(function(e,t){return t.message.createTime-e.message.createTime})]}})})},e.prototype.stopAIStreamMessageActive=function(e,t){var n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:null===(n=this.logger)||void 0===n||n.log("stopAIStreamMessageActive",e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.stopAIStreamMessage(e,t)];case 2:return o.sent(),[3,4];case 3:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("stopAIStreamMessageActive failed ",i.toString()),i;case 4:return[2]}})})},e.prototype.regenAIMessageActive=function(e,t){var n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:null===(n=this.logger)||void 0===n||n.log("regenAIMessageActive",e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.regenAIMessage(e,t)];case 2:return o.sent(),[3,4];case 3:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("regenAIMessageActive failed ",i.toString()),i;case 4:return[2]}})})},e.prototype.voiceToTextActive=function(e){var t,n;return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(o){switch(o.label){case 0:if(e.textOfVoice)return[2];if(!e.attachment)return[2];if(!("url"in e.attachment))return[2];if(!e.attachment.url)return[2];if(!("duration"in e.attachment))return[2];if(!e.attachment.duration)return[2];null===(t=this.logger)||void 0===t||t.log("voiceToTextActive",e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.voiceToText({voiceUrl:e.attachment.url,duration:e.attachment.duration,sceneName:e.attachment.sceneName,mimeType:"aac",sampleRate:"16000"})];case 2:if(!(r=o.sent()))throw new Error("voiceToText empty");return this.updateMsg(e.conversationId,e.messageClientId,{textOfVoice:r}),[3,4];case 3:throw i=o.sent(),null===(n=this.logger)||void 0===n||n.warn("voiceToTextActive failed: ",i.toString()),i;case 4:return[2]}})})},e.prototype.addMsg=function(e,t){var n=this,r=this.msgs.get(e)||[],i=this.pinMsgs.get(e);t.filter(function(e){return!!e.messageClientId}).map(function(e){return e=n.handleReceiveAIMsg(e),i&&(e=n.handleMsgPinState(e,i)),e}).forEach(function(e){var t=__assign({},e),n=r.find(function(e){return e.messageClientId===t.messageClientId});n?(n.createTime<=t.createTime||3===n.sendingState)&&(void 0!==n.canRecall&&void 0!==n.reCallTimer&&(t.canRecall=n.canRecall,t.reCallTimer=n.reCallTimer),n.textOfVoice&&(t.textOfVoice=n.textOfVoice),r.splice(r.indexOf(n),1,t)):r.push(e)}),this.msgs.set(e,__spreadArray([],__read(r),!1).sort(function(e,t){return e.createTime-t.createTime}),this.rootStore.uiStore.selectedConversation===e)},e.prototype.removeMsg=function(e,t){var n=this;if(!e)return this.getMsg().forEach(function(e){n._handleClearMsgTimer(e)}),void this.msgs.clear();var r=this.msgs.get(e);return r?t&&t.length?void this.msgs.set(e,r.filter(function(e){var r=t.includes(e.messageClientId)&&!(100===e.messageType&&"beReCallMsg"===e.recallType);return r&&n._handleClearMsgTimer(e),!r}),this.rootStore.uiStore.selectedConversation===e):(r.forEach(function(e){n._handleClearMsgTimer(e)}),void this.msgs.delete(e)):void 0},e.prototype.deletePinInfoByMessageClientId=function(e,t){var n;null===(n=this.logger)||void 0===n||n.log("deletePinInfoByMessageClientId",e,t),this.pinMsgs.delete(e,t)},e.prototype.getMsg=function(e,t){if(!e)return this.msgs.values();var n=this.msgs.get(e)||[];return t&&t.length?n.filter(function(e){return t.includes(e.messageClientId)}):n},e.prototype.updateMsg=function(e,t,n){var r=this.msgs.get(e);r&&(r.findIndex(function(e){return e.messageClientId===t})&&this.msgs.set(e,r.map(function(e){return e.messageClientId===t&&(e=__assign(__assign({},e),n)),e}),this.rootStore.uiStore.selectedConversation===e))},e.prototype.handleReceiveAIMsg=function(e){var t=this.rootStore.userStore.myUserInfo.accountId,n=e.aiConfig,r=(n&&2===n.aiStatus?n.accountId:e.senderId)===t;return __assign(__assign({},e),{__kit__isSelf:e.isSelf,__kit__senderId:e.senderId,isSelf:r})},e.prototype.handleMsgPinState=function(e,t){var n=t.get(e.messageClientId);return n&&(e.pinState=n.pinState,e.operatorId=n.operatorId),e},e.prototype.handleMsgForSDK=function(e){var t=e.__kit__isSelf,n=e.__kit__senderId,r=__rest(e,["__kit__isSelf","__kit__senderId"]),i=e.senderId,o=e.isSelf;return t&&(o=t),n&&(i=n),__assign(__assign({},r),{senderId:i,isSelf:o})},e.prototype._getMessageListByRefer=function(e){var t;return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:n=[],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.getMessageListByRefers(e)];case 2:return n=i.sent(),[3,4];case 3:return r=i.sent(),null===(t=this.logger)||void 0===t||t.warn("_getMessageListByRefer failed but continue: ",r.toString()),[3,4];case 4:return[2,n]}})})},e.prototype._getPinnedMessageListByServer=function(e){var t,n;return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(s){switch(s.label){case 0:null===(t=this.logger)||void 0===t||t.log("_getPinnedMessageListByServer",e),r=[],i=[],s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.getPinnedMessageList(e)];case 2:return r=s.sent(),[3,4];case 3:return o=s.sent(),null===(n=this.logger)||void 0===n||n.warn("_getPinnedMessageListByServer failed but continue: ",o.toString()),[3,4];case 4:return r.forEach(function(e){i.push(__assign({pinState:1},e))}),this.pinMsgs.set(e,i),i.length&&this._updateMsgsPinState(e,i),[2,i]}})})},e.prototype.completePinnedMessageList=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=[],t.length?(r=[],t.forEach(function(e){e.message||r.push(e.messageRefer)}),r.length?[4,this._getMessageListByRefer(r)]:[2,t]):[2,t];case 1:return(n=i.sent()).length&&(t=t.map(function(e){var t=n.find(function(t){return t.messageClientId===e.messageRefer.messageClientId});return t&&(e=__assign(__assign({},e),{message:t})),e}),this.pinMsgs.set(e,t)),[2,t]}})})},e.prototype._handleSendMsgSuccess=function(e){e&&e.conversationId&&this.addMsg(e.conversationId,[e])},e.prototype._handleSendMsgFail=function(e,t){if(e&&e.conversationId){var n=this.getMsg(e.conversationId,[e.messageClientId])[0];this._handleClearMsgTimer(n),this.addMsg(e.conversationId,[__assign(__assign(__assign({},n),e),{messageStatus:{errorCode:t},uploadProgress:void 0,sendingState:2,errorCode:t})])}},e.prototype._handleClearMsgTimer=function(e){e&&(clearTimeout(e.canEditTimer),clearTimeout(e.reCallTimer))},e.prototype._onReceiveMessages=function(e){var t,n,r,i,o=this;null===(t=this.logger)||void 0===t||t.log("_onReceiveMessages: ",e),e.forEach(function(e){o.addMsg(e.conversationId,[e])}),(null===(n=this.rootStore.sdkOptions)||void 0===n?void 0:n.enableV2CloudConversation)?null===(r=this.rootStore.conversationStore)||void 0===r||r.handleConversationWithAit(e):null===(i=this.rootStore.localConversationStore)||void 0===i||i.handleConversationWithAit(e)},e.prototype._onReceiveMessagesModified=function(e){var t,n=this;null===(t=this.logger)||void 0===t||t.log("_onReceiveMessagesModified: ",e),e.forEach(function(e){n.addMsg(e.conversationId,[e])})},e.prototype._onClearHistoryNotifications=function(e){var t,n=this;null===(t=this.logger)||void 0===t||t.log("_onClearHistory: ",e),e.forEach(function(e){n.removeMsg(e.conversationId)})},e.prototype._onMessageDeletedNotifications=function(e){var t,n=this;null===(t=this.logger)||void 0===t||t.log("_onMessageDeletedNotifications: ",e);var r={};e.forEach(function(e){var t=e.messageRefer.conversationId;r[t]?r[t].push(e):r[t]=[e]}),Object.keys(r).forEach(function(e){var t=r[e].map(function(e){return e.messageRefer.messageClientId});n.removeMsg(e,t),n.deletePinInfoByMessageClientId(e,t)})},e.prototype._onMessagePinNotification=function(e){var t=this,n=e.pin,r=n.operatorId,i=n.messageRefer,o=n.serverExtension,s=n.createTime,a=n.updateTime,c=this.pinMsgs.get(i.conversationId);if(c){var l=e.pinState,d=null==c?void 0:c.get(i.messageClientId),u=[{pinState:l,messageRefer:i,operatorId:r,serverExtension:o,createTime:(null==d?void 0:d.createTime)||s,updateTime:a}];this.completePinnedMessageList(i.conversationId,u).then(function(e){t._updateMsgsPinState(i.conversationId,e)})}},e.prototype._updateMsgsPinState=function(e,t){var n=this.getMsg(e)||[],r=!1;t.forEach(function(e){var t=n.find(function(t){return t.messageClientId===e.messageRefer.messageClientId});if(t&&t.pinState!==e.pinState){var i=__assign({},t);i.pinState=e.pinState,i.operatorId=e.operatorId,n.splice(n.indexOf(t),1,i),r=!0}}),r&&this.msgs.set(e,n,this.rootStore.uiStore.selectedConversation===e)},e.prototype._onMessageQuickCommentNotification=function(){},e.prototype._onMessageRevokeNotifications=function(e){var t;return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){return null===(t=this.logger)||void 0===t||t.log("_onMessageRevokeNotifications: ",e),e.forEach(function(e){return __awaiter(n,void 0,void 0,function(){var t,n,r,i,o,s,a,c,l,d,u,p,h;return __generator(this,function(g){return(t=this.getMsg(e.messageRefer.conversationId,[e.messageRefer.messageClientId])[0])&&t.recallType||(n=e.messageRefer.conversationId,r=[e.messageRefer.messageClientId],this.removeMsg(n,r),this.deletePinInfoByMessageClientId(n,r),i=this._createBeReCallMsg(e),this.addMsg(i.conversationId,[i]),2===e.messageRefer.conversationType&&(o=(null===(c=this.rootStore.sdkOptions)||void 0===c?void 0:c.enableV2CloudConversation)?null===(l=this.rootStore.conversationStore)||void 0===l?void 0:l.conversations.get(n):null===(d=this.rootStore.localConversationStore)||void 0===d?void 0:d.conversations.get(n))&&(s=o.aitMsgs||[],a=e.messageRefer.messageClientId,s.includes(a)&&(s=s.filter(function(e){return e!==a}),(null===(u=this.rootStore.sdkOptions)||void 0===u?void 0:u.enableV2CloudConversation)?null===(p=this.rootStore.conversationStore)||void 0===p||p.updateConversation([__assign(__assign({},o),{aitMsgs:s})]):null===(h=this.rootStore.localConversationStore)||void 0===h||h.updateConversation([__assign(__assign({},o),{aitMsgs:s})])))),[2]})})}),[2]})})},e.prototype._onReceiveP2PMessageReadReceipts=function(e){var t,n=this;null===(t=this.logger)||void 0===t||t.log("_onReceiveP2PMessageReadReceipts: ",e),e.forEach(function(e){var t,r,i,o,s,a,c=(null===(t=n.rootStore.sdkOptions)||void 0===t?void 0:t.enableV2CloudConversation)?null===(r=n.rootStore.conversationStore)||void 0===r?void 0:r.conversations.get(e.conversationId):null===(i=n.rootStore.localConversationStore)||void 0===i?void 0:i.conversations.get(e.conversationId);c&&e.timestamp>(c.msgReceiptTime||0)&&((null===(o=n.rootStore.sdkOptions)||void 0===o?void 0:o.enableV2CloudConversation)?null===(s=n.rootStore.conversationStore)||void 0===s||s.updateConversation([__assign(__assign({},c),{msgReceiptTime:e.timestamp})]):null===(a=n.rootStore.localConversationStore)||void 0===a||a.updateConversation([__assign(__assign({},c),{msgReceiptTime:e.timestamp})]))})},e.prototype._onReceiveTeamMessageReadReceipts=function(e){var t,n=this;null===(t=this.logger)||void 0===t||t.log("_onReceiveTeamMessageReadReceipts: ",e),e.sort(function(e,t){return e.readCount-t.readCount}),e.forEach(function(e){var t=e.conversationId,r=n.getMsg(t,[e.messageClientId])[0];if(r){var i=n._updateReceiptMsg(r,{unread:e.unreadCount,read:e.readCount});n.addMsg(t,[i])}})},e.prototype._formatExtField=function(e,t){var n=t||{},r=this.getReplyMsgActive(e);return r&&(n.yxReplyMsg={idClient:r.messageClientId,scene:r.conversationType,from:r.senderId,receiverId:r.receiverId,to:r.conversationId,idServer:r.messageServerId,time:r.createTime}),n},e.prototype._updateReceiptMsg=function(e,t){return __assign(__assign({},e),{yxUnread:Number(t.unread),yxRead:Number(t.read)})},e.prototype._formatExtAitToPushInfo=function(e,t){var n;return{forcePushAccountIds:(n=e,Object.keys(n).includes(AT_ALL_ACCOUNT)?void 0:Object.keys(n)),forcePush:!0,forcePushContent:t}},e.prototype._createReCallMsg=function(e){var t=this,n=__assign(__assign({},e),{isSelf:!0,sendingState:1,messageType:100,recallType:"reCallMsg",messageClientId:"recall-".concat(e.messageClientId)});return[100,0].includes(e.messageType)&&(n.oldText=e.text,n.canEdit=!0,n.isRecallMsg=!0,n.canEditTimer=setTimeout(function(){var e=t.getMsg(n.conversationId,[n.messageClientId])[0];e&&t.addMsg(e.conversationId,[__assign(__assign({},e),{canEdit:!1})])},RECALL_TIME)),n},e.prototype._createBeReCallMsg=function(e){return __assign(__assign({},e.messageRefer),{isSelf:e.messageRefer.senderId===this.rootStore.userStore.myUserInfo.accountId,sendingState:1,messageType:100,recallType:"beReCallMsg",messageClientId:"recall-".concat(e.messageRefer.messageClientId)})},e.prototype._getAIConfig=function(e){var t,n,r=this,i=e.serverExtension,o=e.conversationId,s=e.receiverId,a=e.messageType,c=e.text,l=void 0===c?"":c;try{n=JSON.parse(i||"{}")}catch(I){n={}}var d=n.yxAitMsg||{},u=this.getReplyMsgActive(o),p=this.rootStore.uiStore.getRelation(s).relation,h=this.rootStore.userStore.myUserInfo.accountId,g=void 0;if("ai"===p)if(0===a){var m=(this.msgs.get(o)||[]).slice(-AI_MESSAGE_LIMIT).filter(function(e){return 0===e.messageType}),f=m.findIndex(function(e){return e.senderId===h});g={accountId:s,content:{msg:l,type:0},messages:(m=-1===f?[]:m.slice(f)).map(function(e){return{role:e.senderId===h?"user":"assistant",msg:e.text||"",type:0}})}}else g={accountId:s};var v={};Object.keys(d).forEach(function(e){r.rootStore.aiUserStore.aiUsers.has(e)&&(v[e]=d[e])});var y=this._findMinStart(v),_=this.rootStore.aiUserStore.aiUsers.get(y||"");return _&&(g={accountId:_.accountId,content:{msg:l,type:0}}),u&&g&&(0===u.messageType?g.messages=[{role:"user",msg:u.text||"",type:0}]:g.messages=void 0),null==g||(g.aiStream=null===(t=this.localOptions)||void 0===t?void 0:t.aiStream),g},e.prototype._findMinStart=function(e){var t,n,r=Number.MAX_VALUE,i=void 0;for(var o in e){var s=e[o].segments;try{for(var a=(t=void 0,__values(s)),c=a.next();!c.done;c=a.next()){var l=c.value;l.start<r&&(r=l.start,i=o)}}catch(d){t={error:d}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}return i},e}(),RelationStore=function(){function e(e,t){this.rootStore=e,this.nim=t,this.blacklist=[],this.mutes=[],this.logger=null,makeAutoObservable(this),this.logger=e.logger,this._onBlockListAdded=this._onBlockListAdded.bind(this),this._onBlockListRemoved=this._onBlockListRemoved.bind(this),this._onP2PMessageMuteModeChanged=this._onP2PMessageMuteModeChanged.bind(this),t.V2NIMUserService.on("onBlockListAdded",this._onBlockListAdded),t.V2NIMUserService.on("onBlockListRemoved",this._onBlockListRemoved),t.V2NIMSettingService.on("onP2PMessageMuteModeChanged",this._onP2PMessageMuteModeChanged)}return e.prototype.resetState=function(){this.blacklist=[],this.mutes=[]},e.prototype.destroy=function(){this.resetState(),this.nim.V2NIMUserService.off("onBlockListAdded",this._onBlockListAdded),this.nim.V2NIMUserService.off("onBlockListRemoved",this._onBlockListRemoved),this.nim.V2NIMSettingService.off("onP2PMessageMuteModeChanged",this._onP2PMessageMuteModeChanged)},e.prototype.addBlacklist=function(e){this.blacklist=__spreadArray([],__read(new Set(this.blacklist.concat(e))),!1)},e.prototype.removeBlacklist=function(e){this.blacklist=this.blacklist.filter(function(t){return e.every(function(e){return t!==e})})},e.prototype.isInBlacklist=function(e){return this.blacklist.includes(e)},e.prototype.addMutes=function(e){this.mutes=__spreadArray([],__read(new Set(this.mutes.concat(e))),!1)},e.prototype.removeMutes=function(e){this.mutes=this.mutes.filter(function(t){return e.every(function(e){return t!==e})})},e.prototype.getBlockListActive=function(){var e,t;return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),null===(e=this.logger)||void 0===e||e.log("getBlockListActive"),[4,this.nim.V2NIMUserService.getBlockList()];case 1:return n=i.sent(),this.addBlacklist(n),[2,n];case 2:throw r=i.sent(),null===(t=this.logger)||void 0===t||t.error("getBlockListActive failed: ",r),r;case 3:return[2]}})})},e.prototype.getP2PMuteListActive=function(){var e,t;return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),null===(e=this.logger)||void 0===e||e.log("getP2PMuteListActive"),[4,this.nim.V2NIMSettingService.getP2PMessageMuteList()];case 1:return n=i.sent(),this.addMutes(n),[2,n];case 2:throw r=i.sent(),null===(t=this.logger)||void 0===t||t.error("getP2PMuteListActive failed: ",r),r;case 3:return[2]}})})},e.prototype.addUserToBlockListActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("addUserToBlockListActive",e),[4,this.nim.V2NIMUserService.addUserToBlockList(e)];case 1:return o.sent(),this.addBlacklist([e]),null===(n=this.logger)||void 0===n||n.log("addUserToBlockListActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("addUserToBlockListActive failed: ",e,i),i;case 3:return[2]}})})},e.prototype.removeUserFromBlockListActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("removeUserFromBlockListActive",e),[4,this.nim.V2NIMUserService.removeUserFromBlockList(e)];case 1:return o.sent(),this.removeBlacklist([e]),null===(n=this.logger)||void 0===n||n.log("removeUserFromBlockListActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("removeUserFromBlockListActive failed: ",e,i),i;case 3:return[2]}})})},e.prototype.setP2PMessageMuteModeActive=function(e,t){var n,r,i;return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("setP2PMessageMuteModeActive",e,t),[4,this.nim.V2NIMSettingService.setP2PMessageMuteMode(e,t)];case 1:return s.sent(),1===t?this.addMutes([e]):0===t&&this.removeMutes([e]),null===(r=this.logger)||void 0===r||r.log("setP2PMessageMuteModeActive success",{accountId:e,muteMode:t}),[3,3];case 2:throw o=s.sent(),null===(i=this.logger)||void 0===i||i.error("setP2PMessageMuteModeActive failed: ",{accountId:e,muteMode:t},o),o;case 3:return[2]}})})},e.prototype._onBlockListAdded=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onBlockListAdded",e),this.addBlacklist([e.accountId])},e.prototype._onBlockListRemoved=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onBlockListRemoved",e),this.removeBlacklist([e])},e.prototype._onP2PMessageMuteModeChanged=function(e,t){var n;null===(n=this.logger)||void 0===n||n.log("_onP2PMessageMuteModeChanged",e,t),1===t?this.addMutes([e]):0===t&&this.removeMutes([e])},e}(),ConversationStore=function(){function e(e,t){this.rootStore=e,this.nim=t,this.conversations=new Map,this.totalUnreadCount=0,this.logger=null,makeAutoObservable(this),this._onSyncStarted=this._onSyncStarted.bind(this),this._onSyncFinished=this._onSyncFinished.bind(this),this._onSyncFailed=this._onSyncFailed.bind(this),this._onConversationCreated=this._onConversationCreated.bind(this),this._onConversationDeleted=this._onConversationDeleted.bind(this),this._onConversationChanged=this._onConversationChanged.bind(this),this._onTotalUnreadCountChanged=this._onTotalUnreadCountChanged.bind(this),this.logger=e.logger,t.V2NIMConversationService.on("onSyncStarted",this._onSyncStarted),t.V2NIMConversationService.on("onSyncFinished",this._onSyncFinished),t.V2NIMConversationService.on("onSyncFailed",this._onSyncFailed),t.V2NIMConversationService.on("onConversationCreated",this._onConversationCreated),t.V2NIMConversationService.on("onConversationDeleted",this._onConversationDeleted),t.V2NIMConversationService.on("onConversationChanged",this._onConversationChanged),t.V2NIMConversationService.on("onTotalUnreadCountChanged",this._onTotalUnreadCountChanged)}return e.prototype.resetState=function(){var e;null===(e=this.logger)||void 0===e||e.log("Conversation resetState"),this.conversations.clear(),this.totalUnreadCount=0},e.prototype.destroy=function(){this.resetState(),this.nim.V2NIMConversationService.off("onSyncStarted",this._onSyncStarted),this.nim.V2NIMConversationService.off("onSyncFinished",this._onSyncFinished),this.nim.V2NIMConversationService.off("onSyncFailed",this._onSyncFailed),this.nim.V2NIMConversationService.off("onConversationCreated",this._onConversationCreated),this.nim.V2NIMConversationService.off("onConversationDeleted",this._onConversationDeleted),this.nim.V2NIMConversationService.off("onConversationChanged",this._onConversationChanged),this.nim.V2NIMConversationService.off("onTotalUnreadCountChanged",this._onTotalUnreadCountChanged)},e.prototype.addConversation=function(e){var t=this;e.filter(function(e){return!!e.conversationId}).filter(function(e){return[1,2].includes(e.type)}).forEach(function(e){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(n){return t=this.conversations.get(e.conversationId),this.conversations.set(e.conversationId,__assign(__assign({},t),e)),[2]})})})},e.prototype.updateConversation=function(e){var t=this;e.filter(function(e){return!!e.conversationId}).filter(function(e){return[1,2].includes(e.type)}).forEach(function(e){var n=t.conversations.get(e.conversationId);t.conversations.set(e.conversationId,__assign(__assign({},n),e))})},e.prototype.removeConversation=function(e){var t=this;e.forEach(function(e){t.conversations.delete(e),t.rootStore.uiStore.selectedConversation===e&&t.rootStore.uiStore.unselectConversation()})},e.prototype.resetConversation=function(e){var t,n,r,i;return __awaiter(this,void 0,void 0,function(){var o,s;return __generator(this,function(a){switch(a.label){case 0:if(null===(t=this.logger)||void 0===t||t.log("resetConversation",e),!(o=this.conversations.get(e)))return null===(n=this.logger)||void 0===n||n.warn("resetConversation: conversation is not found.",e),[2];a.label=1;case 1:return a.trys.push([1,4,,5]),o.unreadCount?(this._resetMemoryConversationUnreadCount(o),[4,this.nim.V2NIMConversationService.clearUnreadCountByIds([o.conversationId])]):[3,3];case 2:a.sent(),this._resetMemoryConversationUnreadCount(o),a.label=3;case 3:return null===(r=this.logger)||void 0===r||r.log("resetConversation success"),[3,5];case 4:throw s=a.sent(),null===(i=this.logger)||void 0===i||i.error("resetConversation failed: ",s),s;case 5:return[2]}})})},e.prototype.insertConversationActive=function(e,t,n){var r,i,o;return void 0===n&&(n=!0),__awaiter(this,void 0,void 0,function(){var s,a,c;return __generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,5,,6]),null===(r=this.logger)||void 0===r||r.log("insertConversationActive",{conversationType:e,receiverId:t,isSelected:n}),s="",1===e)s=this.nim.V2NIMConversationIdUtil.p2pConversationId(t);else{if(2!==e)throw new Error("Unsupported conversation type");s=this.nim.V2NIMConversationIdUtil.teamConversationId(t)}return this.conversations.has(s)?[3,2]:[4,this.nim.V2NIMConversationService.createConversation(s)];case 1:a=l.sent(),this.addConversation([a]),l.label=2;case 2:return n?[4,this.rootStore.uiStore.selectConversation(s)]:[3,4];case 3:l.sent(),l.label=4;case 4:return null===(i=this.logger)||void 0===i||i.log("insertConversationActive success",{conversationType:e,receiverId:t,isSelected:n}),[3,6];case 5:throw c=l.sent(),null===(o=this.logger)||void 0===o||o.error("insertConversationActive failed: ",{conversationType:e,receiverId:t,isSelected:n},c),c;case 6:return[2]}})})},e.prototype.deleteConversationActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:o.trys.push([0,6,,7]),null===(t=this.logger)||void 0===t||t.log("deleteConversationActive",e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.stickTopConversationActive(e,!1)];case 2:case 3:return o.sent(),[3,4];case 4:return this.removeConversation([e]),[4,this.nim.V2NIMConversationService.deleteConversation(e,!1)];case 5:return o.sent(),null===(n=this.logger)||void 0===n||n.log("deleteConversationActive success"),[3,7];case 6:return i=o.sent(),null===(r=this.logger)||void 0===r||r.warn("deleteConversationActive failed but continue: ",i),[3,7];case 7:return[2]}})})},e.prototype.stickTopConversationActive=function(e,t){var n,r,i;return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("stickTopConversationActive",e,t),[4,this.nim.V2NIMConversationService.stickTopConversation(e,t)];case 1:return s.sent(),null===(r=this.logger)||void 0===r||r.log("stickTopConversationActive success"),[3,3];case 2:throw o=s.sent(),null===(i=this.logger)||void 0===i||i.error("stickTopConversationActive failed: ",o),o;case 3:return[2]}})})},e.prototype.getConversationListActive=function(e,t){var n,r,i;return __awaiter(this,void 0,void 0,function(){var o,s;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),null===(n=this.logger)||void 0===n||n.log("getConversationListActive",e,t),[4,this.nim.V2NIMConversationService.getConversationList(e,t)];case 1:return o=a.sent(),this.addConversation(o.conversationList),[4,this.getP2PMessageReceipt(o.conversationList.filter(function(e){return 1===e.type}).map(function(e){return e.conversationId}))];case 2:return a.sent(),null===(r=this.logger)||void 0===r||r.log("getConversationListActive success",e,t,o),[2,o];case 3:throw s=a.sent(),null===(i=this.logger)||void 0===i||i.error("getConversationListActive failed: ",s,e,t),s;case 4:return[2]}})})},e.prototype.getP2PMessageReceipt=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a=this;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("getP2PMessageReceipt",e),[4,Promise.all(e.map(function(e){return a.nim.V2NIMMessageService.getP2PMessageReceipt(e)}))];case 1:return i=c.sent(),o=i.map(function(e){var t=a.conversations.get(e.conversationId);if(t)return __assign(__assign({},t),{msgReceiptTime:e.timestamp})}).filter(function(e){return!!e}),this.updateConversation(o),null===(n=this.logger)||void 0===n||n.log("getP2PMessageReceipt success",e,i),[2,i];case 2:throw s=c.sent(),null===(r=this.logger)||void 0===r||r.error("getP2PMessageReceipt failed: ",s,e),s;case 3:return[2]}})})},e.prototype._resetMemoryConversationUnreadCount=function(e){var t=this.conversations.get(e.conversationId);t&&this.updateConversation([__assign(__assign({},t),{unreadCount:0})])},e.prototype.getConversationReadTimeActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("getConversationReadTimeActive",e),[4,this.nim.V2NIMConversationService.getConversationReadTime(e)];case 1:return i=s.sent(),null===(n=this.logger)||void 0===n||n.log("getConversationReadTimeActive success",e,i),[2,i];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("getConversationReadTimeActive failed: ",o,e),o;case 3:return[2]}})})},e.prototype.markConversationReadActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("markConversationReadActive",e),[4,this.nim.V2NIMConversationService.markConversationRead(e)];case 1:return i=s.sent(),null===(n=this.logger)||void 0===n||n.log("markConversationReadActive success",e,i),[2,i];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("markConversationReadActive failed: ",o,e),o;case 3:return[2]}})})},e.prototype.handleConversationWithAit=function(e){var t=this;e.map(function(e){return __awaiter(t,void 0,void 0,function(){var t,n,r,i,o,s,a;return __generator(this,function(c){switch(c.label){case 0:return 2!==e.conversationType&&3!==e.conversationType?[3,2]:(null==e?void 0:e.serverExtension)?(t=this.hasAitMsg([e.serverExtension]),[4,this.getConversationReadTimeActive(e.conversationId)]):[3,2];case 1:n=c.sent(),r=e.conversationId==this.rootStore.uiStore.selectedConversation,i=e.senderId===(null===(a=this.rootStore.userStore.myUserInfo)||void 0===a?void 0:a.accountId),e.createTime>n&&t&&!r&&!i&&(o=this.conversations.get(e.conversationId))&&(0===(s=o.aitMsgs||[]).length?this.updateConversation([__assign(__assign({},o),{aitMsgs:[e.messageClientId]})]):this.updateConversation([__assign(__assign({},o),{aitMsgs:__spreadArray(__spreadArray([],__read(s),!1),[e.messageClientId],!1)})])),c.label=2;case 2:return[2]}})})})},e.prototype.resetConversationAit=function(e){var t=this.conversations.get(e);2!==(null==t?void 0:t.type)&&3!==(null==t?void 0:t.type)||this.updateConversation([__assign(__assign({},t),{aitMsgs:[]})])},e.prototype.hasAitMsg=function(e){var t=this,n=!1;return(null==e?void 0:e.length)&&(null==e||e.forEach(function(e){var r,i;try{var o=JSON.parse(e||"{}").yxAitMsg,s=t.rootStore.userStore.myUserInfo.accountId;o&&(null===(r=Object.keys(o))||void 0===r||r.forEach(function(e){e!==s&&e!==AT_ALL_ACCOUNT||(n=!0)}))}catch(a){null===(i=t.logger)||void 0===i||i.error("parse serverExtension failed: ",e)}})),n},e.prototype._onSyncStarted=function(){var e,t,n;null===(e=this.logger)||void 0===e||e.log("_onSyncStarted"),null===(t=this.rootStore.conversationStore)||void 0===t||t.getConversationListActive(0,this.rootStore.localOptions.conversationLimit||100),null===(n=this.logger)||void 0===n||n.log("_onSyncFinished")},e.prototype._onSyncFinished=function(){var e,t;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return null===(e=this.rootStore.conversationStore)||void 0===e||e.getConversationListActive(0,this.rootStore.localOptions.conversationLimit||100),null===(t=this.logger)||void 0===t||t.log("_onSyncFinished"),[2]})})},e.prototype._onSyncFailed=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onSyncFailed",e)},e.prototype._onConversationCreated=function(e){var t,n=this;if(null===(t=this.logger)||void 0===t||t.log("_onConversationCreated",e),2===e.type)this.nim.V2NIMConversationService.getConversation(e.conversationId).then(function(e){n.addConversation([e]),e.lastMessage&&n.handleConversationWithAit([__assign(__assign({},e.lastMessage),e.lastMessage.messageRefer)])});else if(this.addConversation([e]),1===e.type){var r=e.conversationId;this.nim.V2NIMMessageService.getP2PMessageReceipt(r).then(function(e){var t=n.conversations.get(r);t&&n.updateConversation([__assign(__assign({},t),{msgReceiptTime:e.timestamp})])})}},e.prototype._onConversationDeleted=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onConversationDeleted",e),this.removeConversation(e)},e.prototype._onConversationChanged=function(e){var t;return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){return null===(t=this.logger)||void 0===t||t.log("_onConversationChanged",e),this.addConversation(e),e.forEach(function(e){return __awaiter(n,void 0,void 0,function(){var t,n,r,i,o,s;return __generator(this,function(a){switch(a.label){case 0:return t=null===(r=e.lastMessage)||void 0===r?void 0:r.attachment,n=null==t?void 0:t.type,5===(null===(i=e.lastMessage)||void 0===i?void 0:i.messageType)&&(1===n&&(null===(o=null==t?void 0:t.targetIds)||void 0===o?void 0:o.includes(this.rootStore.userStore.myUserInfo.accountId))||2===n&&(null===(s=e.lastMessage)||void 0===s?void 0:s.messageRefer.senderId)===this.rootStore.userStore.myUserInfo.accountId||4===n)?[4,this.deleteConversationActive(e.conversationId)]:[3,2];case 1:return a.sent(),[3,4];case 2:return this.rootStore.uiStore.selectedConversation!==e.conversationId?[3,4]:[4,this.resetConversation(e.conversationId)];case 3:a.sent(),a.label=4;case 4:return 2===e.type&&0==e.unreadCount&&this.resetConversationAit(e.conversationId),[2]}})})}),[2]})})},e.prototype._onTotalUnreadCountChanged=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onTotalUnreadCountChanged",e),this.totalUnreadCount=e},e}(),TeamStore=function(){function e(e,t,n){this.rootStore=e,this.nim=t,this.localOptions=n,this.teams=new Map,this.logger=null,makeAutoObservable(this),this.logger=e.logger,this._onReceiveTeamJoinActionInfo=this._onReceiveTeamJoinActionInfo.bind(this),this._onSyncFailed=this._onSyncFailed.bind(this),this._onSyncFinished=this._onSyncFinished.bind(this),this._onSyncStarted=this._onSyncStarted.bind(this),this._onTeamCreated=this._onTeamCreated.bind(this),this._onTeamDismissed=this._onTeamDismissed.bind(this),this._onTeamInfoUpdated=this._onTeamInfoUpdated.bind(this),this._onTeamJoined=this._onTeamJoined.bind(this),this._onTeamLeft=this._onTeamLeft.bind(this),this._onTeamMemberInfoUpdated=this._onTeamMemberInfoUpdated.bind(this),this._onTeamMemberJoined=this._onTeamMemberJoined.bind(this),this._onTeamMemberKicked=this._onTeamMemberKicked.bind(this),this._onTeamMemberLeft=this._onTeamMemberLeft.bind(this),t.V2NIMTeamService.on("onReceiveTeamJoinActionInfo",this._onReceiveTeamJoinActionInfo),t.V2NIMTeamService.on("onSyncFailed",this._onSyncFailed),t.V2NIMTeamService.on("onSyncFinished",this._onSyncFinished),t.V2NIMTeamService.on("onSyncStarted",this._onSyncStarted),t.V2NIMTeamService.on("onTeamCreated",this._onTeamCreated),t.V2NIMTeamService.on("onTeamDismissed",this._onTeamDismissed),t.V2NIMTeamService.on("onTeamInfoUpdated",this._onTeamInfoUpdated),t.V2NIMTeamService.on("onTeamJoined",this._onTeamJoined),t.V2NIMTeamService.on("onTeamLeft",this._onTeamLeft),t.V2NIMTeamService.on("onTeamMemberInfoUpdated",this._onTeamMemberInfoUpdated),t.V2NIMTeamService.on("onTeamMemberJoined",this._onTeamMemberJoined),t.V2NIMTeamService.on("onTeamMemberKicked",this._onTeamMemberKicked),t.V2NIMTeamService.on("onTeamMemberLeft",this._onTeamMemberLeft),t.V2NIMSettingService.on("onTeamMessageMuteModeChanged",this._onTeamMessageMuteModeChanged)}return e.prototype.resetState=function(){this.teams.clear()},e.prototype.destroy=function(){this.resetState(),this.nim.V2NIMTeamService.off("onReceiveTeamJoinActionInfo",this._onReceiveTeamJoinActionInfo),this.nim.V2NIMTeamService.off("onSyncFailed",this._onSyncFailed),this.nim.V2NIMTeamService.off("onSyncFinished",this._onSyncFinished),this.nim.V2NIMTeamService.off("onSyncStarted",this._onSyncStarted),this.nim.V2NIMTeamService.off("onTeamCreated",this._onTeamCreated),this.nim.V2NIMTeamService.off("onTeamDismissed",this._onTeamDismissed),this.nim.V2NIMTeamService.off("onTeamInfoUpdated",this._onTeamInfoUpdated),this.nim.V2NIMTeamService.off("onTeamJoined",this._onTeamJoined),this.nim.V2NIMTeamService.off("onTeamLeft",this._onTeamLeft),this.nim.V2NIMTeamService.off("onTeamMemberInfoUpdated",this._onTeamMemberInfoUpdated),this.nim.V2NIMTeamService.off("onTeamMemberJoined",this._onTeamMemberJoined),this.nim.V2NIMTeamService.off("onTeamMemberKicked",this._onTeamMemberKicked),this.nim.V2NIMTeamService.off("onTeamMemberLeft",this._onTeamMemberLeft),this.nim.V2NIMSettingService.off("onTeamMessageMuteModeChanged",this._onTeamMessageMuteModeChanged)},e.prototype.addTeam=function(e){var t=this;e.filter(function(e){return!!e.isValidTeam}).filter(function(e){return!!e.teamId}).forEach(function(e){t.teams.set(e.teamId,e)})},e.prototype.removeTeam=function(e){var t=this;e.forEach(function(e){t.teams.delete(e)})},e.prototype.updateTeam=function(e){var t=this;e.filter(function(e){return!!e.teamId}).forEach(function(e){var n=t.teams.get(e.teamId);if(n){var r=__assign(__assign({},n),e);t.teams.set(e.teamId,r)}})},e.prototype.createTeamActive=function(e){var t,n,r,i=e.accounts,o=e.type,s=void 0===o?1:o,a=e.avatar,c=e.name,l=e.intro,d=e.serverExtension,u=e.joinMode,p=e.agreeMode,h=e.inviteMode,g=e.updateInfoMode,m=e.updateExtensionMode;return __awaiter(this,void 0,void 0,function(){var e,o;return __generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("createTeamActive",{accounts:i,type:s,avatar:a,name:c,intro:l,serverExtension:d}),[4,this.nim.V2NIMTeamService.createTeam({avatar:a,teamType:s,joinMode:u||this.localOptions.teamJoinMode,agreeMode:p||this.localOptions.teamAgreeMode,inviteMode:h||this.localOptions.teamInviteMode,updateInfoMode:g||this.localOptions.teamUpdateTeamMode,updateExtensionMode:m||this.localOptions.teamUpdateExtMode,name:c,intro:l,serverExtension:d},i,"")];case 1:return e=f.sent().team,null===(n=this.logger)||void 0===n||n.log("createTeamActive success",e),[2,e];case 2:throw o=f.sent(),null===(r=this.logger)||void 0===r||r.error("createTeamActive failed: ",{accounts:i,type:s,avatar:a,name:c,intro:l,serverExtension:d},o,o.code,o.detail),o;case 3:return[2]}})})},e.prototype.applyTeamActive=function(e,t){var n,r,i;return void 0===t&&(t=1),__awaiter(this,void 0,void 0,function(){var o,s;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("applyTeamActive",e),[4,this.nim.V2NIMTeamService.applyJoinTeam(e,t)];case 1:return o=a.sent(),null===(r=this.logger)||void 0===r||r.log("applyTeamActive success",e),[2,o];case 2:throw s=a.sent(),null===(i=this.logger)||void 0===i||i.error("applyTeamActive failed: ",e,s),s;case 3:return[2]}})})},e.prototype.leaveTeamActive=function(e,t){var n,r,i;return void 0===t&&(t=1),__awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("leaveTeamActive",e),[4,this.nim.V2NIMTeamService.leaveTeam(e,t)];case 1:return s.sent(),null===(r=this.logger)||void 0===r||r.log("leaveTeamActive success",e),[3,3];case 2:throw o=s.sent(),null===(i=this.logger)||void 0===i||i.error("leaveTeamActive failed: ",e,o),o;case 3:return[2]}})})},e.prototype.dismissTeamActive=function(e,t){var n,r,i;return void 0===t&&(t=1),__awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("dismissTeamActive",e),[4,this.nim.V2NIMTeamService.dismissTeam(e,t)];case 1:return s.sent(),null===(r=this.logger)||void 0===r||r.log("dismissTeamActive success",e),[3,3];case 2:throw o=s.sent(),null===(i=this.logger)||void 0===i||i.error("dismissTeamActive failed: ",e,o),o;case 3:return[2]}})})},e.prototype.transferTeamActive=function(e){var t,n,r,i=e.teamId,o=e.type,s=void 0===o?1:o,a=e.account,c=e.leave;return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("transferTeamActive",{teamId:i,type:s,account:a,leave:c}),[4,this.nim.V2NIMTeamService.transferTeamOwner(i,s,a,null!=c?c:this.localOptions.leaveOnTransfer)];case 1:return o.sent(),null===(n=this.logger)||void 0===n||n.log("transferTeamActive success",{teamId:i,type:s,account:a,leave:c}),[3,3];case 2:throw e=o.sent(),null===(r=this.logger)||void 0===r||r.error("transferTeamActive failed: ",{teamId:i,type:s,account:a,leave:c},e),e;case 3:return[2]}})})},e.prototype.setTeamChatBannedActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("muteTeamActive",e),[4,this.nim.V2NIMTeamService.setTeamChatBannedMode(e.teamId,e.type||1,e.chatBannedMode)];case 1:return o.sent(),null===(n=this.logger)||void 0===n||n.log("muteTeamActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("muteTeamActive failed: ",e,i),i;case 3:return[2]}})})},e.prototype.updateTeamActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a,c;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("updateTeamActive",e),i=e.teamId,o=e.type,s=void 0===o?1:o,a=e.info,[4,this.nim.V2NIMTeamService.updateTeamInfo(i,s,a)];case 1:return l.sent(),null===(n=this.logger)||void 0===n||n.log("updateTeamActive success",e),[3,3];case 2:throw c=l.sent(),null===(r=this.logger)||void 0===r||r.error("updateTeamActive failed: ",e,c),c;case 3:return[2]}})})},e.prototype.getTeamActive=function(e,t){var n;return void 0===t&&(t=1),__awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return null===(n=this.logger)||void 0===n||n.log("getTeamActive: ",e),(r=this.teams.get(e))?[2,r]:[4,this.getTeamForceActive(e,t)];case 1:return r=i.sent(),this.addTeam([r]),[2,r]}})})},e.prototype.getTeamForceActive=function(e,t){var n,r,i;return void 0===t&&(t=1),__awaiter(this,void 0,void 0,function(){var o,s;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("getTeamForceActive: ",e),[4,this.nim.V2NIMTeamService.getTeamInfo(e,t)];case 1:return o=a.sent(),null===(r=this.logger)||void 0===r||r.log("getTeamForceActive success",o),[2,o];case 2:throw s=a.sent(),null===(i=this.logger)||void 0===i||i.error("getTeamForceActive failed: ",e,s),s;case 3:return[2]}})})},e.prototype.setTeamMessageMuteModeActive=function(e,t,n){var r,i,o;return __awaiter(this,void 0,void 0,function(){var s;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),null===(r=this.logger)||void 0===r||r.log("setTeamMessageMuteModeActive",{teamId:e,teamType:t,muteMode:n}),[4,this.nim.V2NIMSettingService.setTeamMessageMuteMode(e,t,n)];case 1:return a.sent(),null===(i=this.logger)||void 0===i||i.log("setTeamMessageMuteModeActive success",{teamId:e,teamType:t,muteMode:n}),[3,3];case 2:throw s=a.sent(),null===(o=this.logger)||void 0===o||o.error("setTeamMessageMuteModeActive failed: ",{teamId:e,teamType:t,muteMode:n},s),s;case 3:return[2]}})})},e.prototype.acceptTeamInviteActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("acceptTeamInviteActive: ",e),[4,this.nim.V2NIMTeamService.acceptInvitation(e)];case 1:return o.sent(),null===(n=this.logger)||void 0===n||n.log("acceptTeamInviteActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("acceptTeamInviteActive failed: ",e,i),i;case 3:return[2]}})})},e.prototype.rejectTeamInviteActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("rejectTeamInviteActive: ",e),[4,this.nim.V2NIMTeamService.rejectInvitation(e)];case 1:return o.sent(),null===(n=this.logger)||void 0===n||n.log("rejectTeamInviteActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("rejectTeamInviteActive failed: ",e,i),i;case 3:return[2]}})})},e.prototype.acceptJoinApplicationActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("acceptJoinApplicationActive: ",e),[4,this.nim.V2NIMTeamService.acceptJoinApplication(e)];case 1:return o.sent(),null===(n=this.logger)||void 0===n||n.log("acceptJoinApplicationActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("acceptJoinApplicationActive failed: ",e,i),i;case 3:return[2]}})})},e.prototype.rejectTeamApplyActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("rejectTeamApplyActive: ",e),[4,this.nim.V2NIMTeamService.rejectJoinApplication(e)];case 1:return o.sent(),null===(n=this.logger)||void 0===n||n.log("rejectTeamApplyActive success",e),[3,3];case 2:throw i=o.sent(),null===(r=this.logger)||void 0===r||r.error("rejectTeamApplyActive failed: ",e,i),i;case 3:return[2]}})})},e.prototype.updateTeamMemberRoleActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a,c,l;return __generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("addTeamManagersActive: ",e),i=e.teamId,o=e.type,s=void 0===o?1:o,a=e.accounts,c=e.role,[4,this.nim.V2NIMTeamService.updateTeamMemberRole(i,s,a,c)];case 1:return d.sent(),null===(n=this.logger)||void 0===n||n.log("addTeamManagersActive success",e),[3,3];case 2:throw l=d.sent(),null===(r=this.logger)||void 0===r||r.error("addTeamManagersActive failed: ",e,l),l;case 3:return[2]}})})},e.prototype.getTeamJoinActionInfoListActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("getTeamJoinActionInfoListActive: ",e),[4,this.nim.V2NIMTeamService.getTeamJoinActionInfoList(e)];case 1:return i=s.sent(),this.rootStore.sysMsgStore.addTeamJoinActionMsg(i.infos),null===(n=this.logger)||void 0===n||n.log("getTeamJoinActionInfoListActive success",i),[2,i];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("getTeamJoinActionInfoListActive failed: ",e,o),o;case 3:return[2]}})})},e.prototype.getJoinedTeamListActive=function(){var e,t,n;return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(e=this.logger)||void 0===e||e.log("getJoinedTeamListActive"),[4,this.nim.V2NIMTeamService.getJoinedTeamList([1])];case 1:return r=o.sent(),this.addTeam(r),null===(t=this.logger)||void 0===t||t.log("getJoinedTeamListActive success",r),[2,r];case 2:throw i=o.sent(),null===(n=this.logger)||void 0===n||n.error("getJoinedTeamListActive failed: ",i),i;case 3:return[2]}})})},e.prototype.getTeamMessageMuteModeActive=function(e,t){var n,r,i;return __awaiter(this,void 0,void 0,function(){var o,s;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("getTeamMessageMuteModeActive",e,t),[4,this.nim.V2NIMSettingService.getTeamMessageMuteMode(e,t)];case 1:return o=a.sent(),null===(r=this.logger)||void 0===r||r.log("getTeamMessageMuteModeActive success",e,t),[2,o];case 2:throw s=a.sent(),null===(i=this.logger)||void 0===i||i.error("getTeamMessageMuteModeActive failed: ",e,t,s),s;case 3:return[2]}})})},e.prototype._onReceiveTeamJoinActionInfo=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onReceiveTeamJoinActionInfo: ",e),this.rootStore.sysMsgStore.addTeamJoinActionMsg([e])},e.prototype._onSyncFailed=function(e){var t;null===(t=this.logger)||void 0===t||t.log("V2NIMTeamService _onSyncFailed: ",e)},e.prototype._onSyncFinished=function(){var e,t;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return null===(e=this.rootStore.conversationStore)||void 0===e||e.getConversationListActive(0,this.rootStore.localOptions.conversationLimit||100),null===(t=this.logger)||void 0===t||t.log("V2NIMTeamService _onSyncFinished"),[2]})})},e.prototype._onSyncStarted=function(){var e;null===(e=this.logger)||void 0===e||e.log("V2NIMTeamService _onSyncStarted")},e.prototype._onTeamCreated=function(e){var t;null===(t=this.logger)||void 0===t||t.log("V2NIMTeamService _onTeamCreated: ",e),this.addTeam([e])},e.prototype._onTeamDismissed=function(e){var t;null===(t=this.logger)||void 0===t||t.log("V2NIMTeamService _onTeamDismissed: ",e),this._handleRemoveTeam(e.teamId)},e.prototype._onTeamInfoUpdated=function(e){var t;null===(t=this.logger)||void 0===t||t.log("V2NIMTeamService _onTeamInfoUpdated: ",e),this.updateTeam([e])},e.prototype._onTeamJoined=function(e){var t;null===(t=this.logger)||void 0===t||t.log("V2NIMTeamService _onTeamJoined: ",e),this.addTeam([e])},e.prototype._onTeamLeft=function(e){var t;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return null===(t=this.logger)||void 0===t||t.log("V2NIMTeamService _onTeamLeft: ",e),this._handleRemoveTeam(e.teamId),[2]})})},e.prototype._onTeamMemberInfoUpdated=function(e){var t;null===(t=this.logger)||void 0===t||t.log("V2NIMTeamService _onTeamMemberInfoUpdated: ",e);var n=e[0].teamId;this.rootStore.teamMemberStore.updateTeamMember(n,e)},e.prototype._onTeamMemberJoined=function(e){var t;return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){return null===(t=this.logger)||void 0===t||t.log("V2NIMTeamService _onTeamMemberJoined: ",e),n=e[0].teamId,this.rootStore.teamMemberStore.addTeamMember(n,e),[2]})})},e.prototype._onTeamMemberKicked=function(e,t){var n;return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){return null===(n=this.logger)||void 0===n||n.log("V2NIMTeamService _onTeamMemberKicked: ",e,t),r=t[0].teamId,this.rootStore.teamMemberStore.removeTeamMember(r,t.map(function(e){return e.accountId})),[2]})})},e.prototype._onTeamMemberLeft=function(e){var t;return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){return null===(t=this.logger)||void 0===t||t.log("V2NIMTeamService _onTeamMemberLeft: ",e),n=e[0].teamId,this.rootStore.teamMemberStore.removeTeamMember(n,e.map(function(e){return e.accountId})),[2]})})},e.prototype._handleRemoveTeam=function(e){this.removeTeam([e]),this.rootStore.teamMemberStore.removeTeamMember(e)},e.prototype._onTeamMessageMuteModeChanged=function(e,t,n){var r;null===(r=this.logger)||void 0===r||r.log("V2NIMTeamService _onTeamMessageMuteModeChanged: ",e,t,n)},e}(),TeamMemberStore=function(){function e(e,t){this.rootStore=e,this.nim=t,this.teamMembers=new Map,this.logger=null,makeAutoObservable(this),this.logger=e.logger}return e.prototype.resetState=function(){this.teamMembers.clear()},e.prototype.destroy=function(){this.resetState()},e.prototype.addTeamMemberActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a,c,l;return __generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("addTeamMemberActive",e),i=e.teamId,o=e.type,s=void 0===o?1:o,a=e.accounts,c=e.ps,[4,this.nim.V2NIMTeamService.inviteMember(i,s,a,c)];case 1:return d.sent(),null===(n=this.logger)||void 0===n||n.log("addTeamMemberActive success",e),[3,3];case 2:throw l=d.sent(),null===(r=this.logger)||void 0===r||r.error("addTeamMemberActive failed: ",e,l),l;case 3:return[2]}})})},e.prototype.removeTeamMemberActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a,c;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("removeTeamMemberActive",e),i=e.teamId,o=e.type,s=void 0===o?1:o,a=e.accounts,[4,this.nim.V2NIMTeamService.kickMember(i,s,a)];case 1:return l.sent(),null===(n=this.logger)||void 0===n||n.log("removeTeamMemberActive success",e),[3,3];case 2:throw c=l.sent(),null===(r=this.logger)||void 0===r||r.error("removeTeamMemberActive failed: ",e,c),c;case 3:return[2]}})})},e.prototype.getTeamMemberActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a,c,l;return __generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("getTeamMemberActive",e),i=e.teamId,o=e.queryOption,s=e.type,a=void 0===s?1:s,[4,this.nim.V2NIMTeamService.getTeamMemberList(i,a,o)];case 1:return c=d.sent(),null===(n=this.logger)||void 0===n||n.log("getTeamMemberActive success: ",i,a,o,c),this.setTeamMembers(i,c.memberList),[2,c];case 2:throw l=d.sent(),null===(r=this.logger)||void 0===r||r.error("getTeamMemberActive failed: ",e,l),l;case 3:return[2]}})})},e.prototype.updateMyMemberInfoActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a,c;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("updateMyMemberInfo",e),i=e.teamId,o=e.type,s=void 0===o?1:o,a=e.memberInfo,[4,this.nim.V2NIMTeamService.updateSelfTeamMemberInfo(i,s,a)];case 1:return l.sent(),null===(n=this.logger)||void 0===n||n.log("updateMyMemberInfo success: ",e),[3,3];case 2:throw c=l.sent(),null===(r=this.logger)||void 0===r||r.error("updateMyMemberInfo failed: ",e,c),c;case 3:return[2]}})})},e.prototype.setTeamMembers=function(e,t){var n=new Map;t.forEach(function(e){n.set(e.accountId,e)}),this.teamMembers.set(e,n)},e.prototype.addTeamMember=function(e,t){var n=this.teamMembers.get(e);n||(n=new Map),t.filter(function(e){return!!e.inTeam}).filter(function(e){return!!e.accountId}).forEach(function(e){n.set(e.accountId,e)}),this.teamMembers.set(e,n)},e.prototype.removeTeamMember=function(e,t){if(t&&t.length){var n=this.teamMembers.get(e);n&&(t.forEach(function(e){n.delete(e)}),this.teamMembers.set(e,n))}else this.teamMembers.delete(e)},e.prototype.updateTeamMember=function(e,t){var n=this.teamMembers.get(e);n&&(t.forEach(function(e){var t=n.get(e.accountId);t&&(t=__assign(__assign({},t),e),n.set(e.accountId,t))}),this.teamMembers.set(e,n))},e.prototype.getTeamMember=function(e,t){var n,r=__spreadArray([],__read((null===(n=this.teamMembers.get(e))||void 0===n?void 0:n.values())||[]),!1);return t&&t.length?r.filter(function(e){return t.some(function(t){return t===e.accountId})}):r},e}(),SysMsgStore=function(){function e(e,t){this.rootStore=e,this.nim=t,this.friendApplyMsg=new Map,this.teamJoinActionMsg=new Map,this.logger=null,makeAutoObservable(this),this.logger=e.logger}return e.prototype.resetState=function(){this.friendApplyMsg.clear(),this.teamJoinActionMsg.clear()},e.prototype.destroy=function(){this.resetState()},Object.defineProperty(e.prototype,"friendApplyMsgs",{get:function(){return Array.from(this.friendApplyMsg.values()).sort(function(e,t){return t.timestamp-e.timestamp})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"teamJoinActionMsgs",{get:function(){return Array.from(this.teamJoinActionMsg.values()).sort(function(e,t){return t.timestamp-e.timestamp})},enumerable:!1,configurable:!0}),e.prototype.addFriendApplyMsg=function(e){var t=this;e.forEach(function(e){var n=t.createFriendApplyMsgKey(e);t.friendApplyMsg.set(n,e)})},e.prototype.deleteFriendApplyMsg=function(e){var t=this;e.forEach(function(e){var n=t.createFriendApplyMsgKey(e);t.friendApplyMsg.delete(n)})},e.prototype.updateFriendApplyMsg=function(e){var t=this;e.forEach(function(e){var n=t.createFriendApplyMsgKey(e),r=t.friendApplyMsg.get(n);r&&t.friendApplyMsg.set(n,__assign(__assign({},r),e))})},e.prototype.addTeamJoinActionMsg=function(e){var t=this;e.forEach(function(e){var n=t.createTeamJoinActionMsgKey(e);t.teamJoinActionMsg.set(n,e)})},e.prototype.deleteTeamJoinActionMsg=function(e){var t=this;e.forEach(function(e){var n=t.createTeamJoinActionMsgKey(e);t.teamJoinActionMsg.delete(n)})},e.prototype.updateTeamJoinActionMsg=function(e){var t=this;e.forEach(function(e){var n=t.createTeamJoinActionMsgKey(e),r=t.teamJoinActionMsg.get(n),i=__assign(__assign({},r),e);t.teamJoinActionMsg.set(n,i)})},e.prototype.getUnreadFriendApplyMsgsCount=function(){return this.friendApplyMsgs.filter(function(e){return!e.isRead}).length},e.prototype.getUnreadTeamJoinActionMsgsCount=function(){return this.teamJoinActionMsgs.filter(function(e){return!e.isRead}).length},e.prototype.getTotalUnreadMsgsCount=function(){return this.getUnreadFriendApplyMsgsCount()+this.getUnreadTeamJoinActionMsgsCount()},e.prototype.setAllApplyMsgRead=function(){this.updateFriendApplyMsg(this.friendApplyMsgs.map(function(e){return __assign(__assign({},e),{isRead:!0})})),this.updateTeamJoinActionMsg(this.teamJoinActionMsgs.map(function(e){return __assign(__assign({},e),{isRead:!0})}))},e.prototype.createTeamJoinActionMsgKey=function(e){return"".concat(e.teamId,"_").concat(e.operatorAccountId,"_").concat(e.actionType)},e.prototype.createFriendApplyMsgKey=function(e){return"".concat(e.applicantAccountId,"_").concat(e.recipientAccountId)},e}(),UserStore=function(){function e(e,t){this.rootStore=e,this.nim=t,this.users=new Map,this.myUserInfo={accountId:this.nim.V2NIMLoginService.getLoginUser(),name:"",createTime:Date.now(),updateTime:Date.now()},this.logger=null,this._getUserInfo=frequencyControl(this._getUserInfos,1e3,100),makeAutoObservable(this),this._onUserProfileChanged=this._onUserProfileChanged.bind(this),this.logger=e.logger,t.V2NIMUserService.on("onUserProfileChanged",this._onUserProfileChanged)}return e.prototype.resetState=function(){this.users.clear(),this.myUserInfo={accountId:this.nim.V2NIMLoginService.getLoginUser(),name:"",createTime:Date.now(),updateTime:Date.now()}},e.prototype.destroy=function(){this.resetState(),this.nim.V2NIMUserService.off("onUserProfileChanged",this._onUserProfileChanged)},e.prototype.addUsers=function(e){var t=this;e.filter(function(e){return!!e.accountId}).forEach(function(e){t.users.set(e.accountId,e)})},e.prototype.removeUsers=function(e){var t=this;e.forEach(function(e){t.users.delete(e)})},e.prototype.getMyUserServerExt=function(){var e,t={};try{t=JSON.parse((null===(e=this.myUserInfo)||void 0===e?void 0:e.serverExtension)||"{}")}catch(n){}return t},e.prototype.updateSelfUserProfileActive=function(e,t){var n,r,i,o;return __awaiter(this,void 0,void 0,function(){var s,a,c,l;return __generator(this,function(d){switch(d.label){case 0:if(d.trys.push([0,6,,7]),null===(n=this.logger)||void 0===n||n.log("updateSelfUserProfileActive",e,t),!t)return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),s=this.nim.V2NIMStorageService.createUploadFileTask({fileObj:t}),[4,this.nim.V2NIMStorageService.uploadFile(s,function(){})];case 2:return a=d.sent(),e.avatar=a,[3,4];case 3:return c=d.sent(),null===(r=this.logger)||void 0===r||r.warn("upload avatar error and save continue.",c),[3,4];case 4:return[4,this.nim.V2NIMUserService.updateSelfUserProfile(e)];case 5:return d.sent(),null===(i=this.logger)||void 0===i||i.log("updateSelfUserProfileActive success",e,t),[3,7];case 6:throw l=d.sent(),null===(o=this.logger)||void 0===o||o.error("updateSelfUserProfileActive failed:",e,l,t),l;case 7:return[2]}})})},e.prototype.getUserActive=function(e){var t,n;return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){return null===(t=this.logger)||void 0===t||t.log("getUserListActive",e),(r=this.users.get(e))?(null===(n=this.logger)||void 0===n||n.log("getUserListActive success",r,e),[2,r]):[2,this.getUserForceActive(e)]})})},e.prototype.getUserForceActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("getUserForceActive",e),[4,this._getUserInfo(e)];case 1:return i=s.sent(),null===(n=this.logger)||void 0===n||n.log("getUserForceActive success",i,e),[2,i];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("getUserForceActive failed: ",e,o),o;case 3:return[2]}})})},e.prototype.getUserListFromCloudActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("getUserListFromCloudActive",e),[4,this.nim.V2NIMUserService.getUserListFromCloud(e)];case 1:return i=s.sent(),this.addUsers(i),null===(n=this.logger)||void 0===n||n.log("getUserListFromCloudActive success",i,e),[2,i];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("getUserListFromCloudActive failed: ",e,o),o;case 3:return[2]}})})},e.prototype.getMyUserInfoActive=function(){var e,t,n;return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(e=this.logger)||void 0===e||e.log("getMyUserInfoActive"),[4,this.nim.V2NIMUserService.getUserList([this.nim.V2NIMLoginService.getLoginUser()])];case 1:return r=o.sent(),this.myUserInfo=r[0],this.addUsers(r),null===(t=this.logger)||void 0===t||t.log("getMyUserInfoActive success",r),[2,r[0]];case 2:throw i=o.sent(),null===(n=this.logger)||void 0===n||n.error("getMyUserInfoActive failed: ",i),i;case 3:return[2]}})})},e.prototype._getUserInfos=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.nim.V2NIMUserService.getUserList(e)];case 1:return t=n.sent(),this.addUsers(t),[2,t]}})})},e.prototype._onUserProfileChanged=function(e){var t,n=this;null===(t=this.logger)||void 0===t||t.log("_onUserProfileChanged: ",e),e.forEach(function(e){e.accountId===n.myUserInfo.accountId&&(n.myUserInfo=e)}),this.addUsers(e)},e}(),AIUserStore=function(){function e(e,t,n){this.rootStore=e,this.nim=t,this.localOptions=n,this.aiUsers=new Map,this.aiReqMsgs=[],this.aiResMsgs=[],this.logger=null,this.onSendAIProxyErrorHandler=function(){},this.requestIds=[],this.proxyAccountId="",makeAutoObservable(this),this.logger=e.logger,this._onProxyAIModelCall=this._onProxyAIModelCall.bind(this),this.nim.V2NIMAIService.on("onProxyAIModelCall",this._onProxyAIModelCall)}return Object.defineProperty(e.prototype,"aiProxying",{get:function(){return this.aiReqMsgs.length>this.aiResMsgs.length},enumerable:!1,configurable:!0}),e.prototype.resetState=function(){this.aiUsers.clear(),this.aiReqMsgs=[],this.aiResMsgs=[]},e.prototype.destroy=function(){this.resetState(),this.nim.V2NIMAIService.off("onProxyAIModelCall",this._onProxyAIModelCall)},e.prototype.addAIUsers=function(e){var t=this;e.filter(function(e){return!!e.accountId}).forEach(function(e){t.aiUsers.set(e.accountId,e)})},e.prototype.removeAIUsers=function(e){var t=this;e.forEach(function(e){t.aiUsers.delete(e)})},e.prototype.getAIUserList=function(e){var t=__spreadArray([],__read(this.aiUsers.values()),!1),n=function(e,t){return t.createTime-e.createTime};return e&&e.length?t.filter(function(t){return e.includes(t.accountId)}).sort(n):t.sort(n)},e.prototype.getAISearchUser=function(){var e,t,n=this.getAIUserList();return null===(t=null===(e=this.localOptions.aiUserAgentProvider)||void 0===e?void 0:e.getAISearchUser)||void 0===t?void 0:t.call(e,n)},e.prototype.getAITranslateUser=function(){var e,t,n=this.getAIUserList();return null===(t=null===(e=this.localOptions.aiUserAgentProvider)||void 0===e?void 0:e.getAITranslateUser)||void 0===t?void 0:t.call(e,n)},e.prototype.getAITranslateLangs=function(){var e,t,n=this.getAIUserList();return(null===(t=null===(e=this.localOptions.aiUserAgentProvider)||void 0===e?void 0:e.getAITranslateLangs)||void 0===t?void 0:t.call(e,n))||[]},e.prototype.getAIUserServerExt=function(e){var t=this.aiUsers.get(e);if(!t)return{};try{return JSON.parse(t.serverExtension||"{}")}catch(n){return{}}},e.prototype.getAIChatUser=function(){var e=this;return this.getAIUserList().filter(function(t){return 1===e.getAIUserServerExt(t.accountId).aiChat})},e.prototype.getAIPinDefaultUser=function(){var e=this;return this.getAIUserList().filter(function(t){return 1===e.getAIUserServerExt(t.accountId).pinDefault})},e.prototype.getAIPinUser=function(){var e=this.rootStore.userStore.getMyUserServerExt();return this.getAIPinDefaultUser().filter(function(t){var n;return!(null===(n=e.unpinAIUsers)||void 0===n?void 0:n.includes(t.accountId))})},e.prototype.isAIPinUser=function(e){return this.getAIPinUser().some(function(t){return t.accountId===e})},e.prototype.isAISearching=function(){var e;return this.proxyAccountId===(null===(e=this.getAISearchUser())||void 0===e?void 0:e.accountId)},e.prototype.isAITranslating=function(){var e;return this.proxyAccountId===(null===(e=this.getAITranslateUser())||void 0===e?void 0:e.accountId)},e.prototype.isAIUser=function(e){return this.aiUsers.has(e)},e.prototype.resetAIProxy=function(){this.requestIds=[],this.aiReqMsgs=[],this.aiResMsgs=[],this.proxyAccountId="",this.onSendAIProxyErrorHandler=function(){}},e.prototype.getAIUserListActive=function(){var e,t,n;return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),null===(e=this.logger)||void 0===e||e.log("getAIUserListActive"),[4,this.nim.V2NIMAIService.getAIUserList()];case 1:return r=o.sent(),this.addAIUsers(r),null===(t=this.logger)||void 0===t||t.log("getAIUserListActive success:",r),[3,3];case 2:return i=o.sent(),null===(n=this.logger)||void 0===n||n.log("getAIUserListActive failed:",i),[3,3];case 3:return[2]}})})},e.prototype.sendAIProxyActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("sendAIProxyActive",e),i=__assign({},e),e.requestId?(this.resetAIProxy(),this.requestIds.push(e.requestId),this.proxyAccountId=e.accountId):(i.requestId=Math.random().toString(36).slice(2),this.requestIds.push(i.requestId)),e.onSendAIProxyErrorHandler&&(this.onSendAIProxyErrorHandler=e.onSendAIProxyErrorHandler),[4,this.nim.V2NIMAIService.proxyAIModelCall(i)];case 1:return s.sent(),this.aiReqMsgs.push(e.content),null===(n=this.logger)||void 0===n||n.log("sendAIProxyActive success:",e),[3,3];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("sendAIProxyActive failed:",o.toString()),this.onSendAIProxyErrorHandler(o.code),o;case 3:return[2]}})})},e.prototype._onProxyAIModelCall=function(e){var t;null===(t=this.logger)||void 0===t||t.log("_onProxyAIModelCall",e),this.requestIds.includes(e.requestId)&&(200===e.code?this.aiResMsgs.push(e.content.msg):(this.aiReqMsgs.pop(),this.onSendAIProxyErrorHandler(e.code)))},e}(),UiStore=function(){function e(e){this.rootStore=e,this.selectedContactType="",this.selectedConversation="",this.logger=null,makeAutoObservable(this),this.logger=e.logger}return e.prototype.resetState=function(){this.selectedContactType="",this.selectedConversation=""},e.prototype.destroy=function(){this.resetState()},e.prototype.selectContactType=function(e){var t;null===(t=this.logger)||void 0===t||t.log("selectContactType: ",e),this.selectedContactType=e},e.prototype.unselectContactType=function(){var e;null===(e=this.logger)||void 0===e||e.log("unselectContactType"),this.selectedContactType=""},e.prototype.selectConversation=function(e){var t,n,r,i,o,s;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===(t=this.logger)||void 0===t||t.log("selectConversation: ",e),e===this.selectedConversation?[2]:(this.rootStore.msgStore.msgs.resetLimitState(),this.selectedConversation=e,e?(null===(n=this.rootStore.sdkOptions)||void 0===n?void 0:n.enableV2CloudConversation)?(null===(r=this.rootStore.conversationStore)||void 0===r||r.resetConversationAit(e),[4,null===(i=this.rootStore.conversationStore)||void 0===i?void 0:i.resetConversation(e)]):[3,2]:[3,4]);case 1:return a.sent(),[3,4];case 2:return null===(o=this.rootStore.localConversationStore)||void 0===o||o.resetConversationAit(e),[4,null===(s=this.rootStore.localConversationStore)||void 0===s?void 0:s.resetConversation(e)];case 3:a.sent(),a.label=4;case 4:return[2]}})})},e.prototype.unselectConversation=function(){var e;null===(e=this.logger)||void 0===e||e.log("unselectConversation"),this.selectedConversation="",this.rootStore.msgStore.msgs.resetLimitState()},e.prototype.getRelation=function(e){return{relation:this.rootStore.userStore.myUserInfo.accountId===e?"myself":this.rootStore.aiUserStore.aiUsers.has(e)?"ai":this.rootStore.friendStore.friends.has(e)?"friend":"stranger",isInBlacklist:this.rootStore.relationStore.isInBlacklist(e)}},e.prototype.getFriendWithUserNameCard=function(e){var t=this.rootStore.friendStore.friends.get(e)||{accountId:"",serverExtension:"",customerExtension:""},n=this.rootStore.userStore.users.get(e)||{accountId:"",name:"",createTime:Date.now()};return __assign(__assign({},t),n)},e.prototype.getAppellation=function(e){var t,n=e.account,r=e.teamId,i=void 0===r?"":r,o=e.ignoreAlias,s=void 0!==o&&o,a=e.nickFromMsg,c=void 0===a?"":a,l=this.rootStore.aiUserStore.aiUsers.get(n);if(l)return l.name||n;var d=this.rootStore.friendStore.friends.get(n),u=this.rootStore.userStore.users.get(n),p=null===(t=this.rootStore.teamMemberStore.teamMembers.get(i))||void 0===t?void 0:t.get(n);return!s&&(null==d?void 0:d.alias)||(null==p?void 0:p.teamNick)||(null==u?void 0:u.name)||c||n},Object.defineProperty(e.prototype,"friends",{get:function(){return __spreadArray([],__read(this.rootStore.friendStore.friends.values()),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conversations",{get:function(){var e;return(null===(e=this.rootStore.conversationStore)||void 0===e?void 0:e.conversations.values())?__spreadArray([],__read(this.rootStore.conversationStore.conversations.values()),!1):[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localConversations",{get:function(){var e;return(null===(e=this.rootStore.localConversationStore)||void 0===e?void 0:e.conversations.values())?__spreadArray([],__read(this.rootStore.localConversationStore.conversations.values()),!1):[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"users",{get:function(){return __spreadArray([],__read(this.rootStore.userStore.users.values()),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"teamList",{get:function(){return __spreadArray([],__read(this.rootStore.teamStore.teams.values()),!1).filter(function(e){return e.isValidTeam}).sort(function(e,t){return t.createTime-e.createTime})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"applyMsgs",{get:function(){return __spreadArray([],__read(this.rootStore.sysMsgStore.friendApplyMsg.values()),!1)},enumerable:!1,configurable:!0}),e}(),StorageStore=function(){function e(e,t){this.rootStore=e,this.nim=t,makeAutoObservable(this)}return e.prototype.uploadFileActive=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(o){switch(o.label){case 0:if(logger.log("uploadFileActive",e),!e)throw t="upload avatar error, no file or filepath",logger.warn(t),new Error(t);n="",o.label=1;case 1:return o.trys.push([1,3,,4]),r=this.nim.V2NIMStorageService.createUploadFileTask({fileObj:e}),[4,this.nim.V2NIMStorageService.uploadFile(r,function(){})];case 2:return n=o.sent(),[3,4];case 3:throw i=o.sent(),logger.warn("upload avatar error ",i),i;case 4:return[2,n]}})})},e}(),name="nim-web-sdk-ng",version="10.9.30",sdk={version:100930,versionFormat:"10.9.30"},description="Yunxin IM SDK next generation",main="./dist/v2/NIM_BROWSER_SDK.js",types="./dist/v2/NIM_BROWSER_SDK/index.d.ts",scripts={test:"jest --maxWorkers 1 --silent",lint:"npx eslint ./src",dev:"cd pages/ && npm run dev",clean:"rm -rf ./dist",emitTypes:"tsc --emitDeclarationOnly --declaration --declarationDir temp/types","build:esm":"npm run emitTypes && rollup --config ./build/esm.config.js",build:"npm run clean && npm run emitTypes && node script/copyPlugin.js && rollup --config ./build/v1.config.js && rollup --config ./build/v2.config.js && rollup --config ./build/esm.config.js",analyze:'npm run clean && npx rollup --config ./build/analyze.config.js && ls -lhR dist | grep ".js"',"pages:build":"cd pages/ && npm install && npm run build && cp -rf dist/ ../dist/",api:"npm run translate && node script/buildApi.js",translate:"rm -rf ./apidocs && multilingual-tool convert --indir=src/typings --outdir=apidocs --includes=ts","api-diff":"multilingual-tool diff --dir=src/typings --receiver=3070898 --exclude=DS_Store",updateVerInNdp:"node ./script/updateVerInNdp.js"},repository={type:"git",url:"ssh://git@g.hz.netease.com:22222/yunxin/im/sdk.git"},keywords=["im","sdk"],author="yunxin",license="ISC",eslintIgnore=["dist/"],files=["README.md","CHANGELOG.md","dist/v1/NIM*","dist/v1/CHATROOM*","dist/v1/QCHAT*","dist/v2/NIM*","dist/v2/CHATROOM*","dist/esm/*"],devDependencies={"@babel/core":"^7.13.15","@babel/plugin-proposal-class-properties":"^7.13.0","@babel/plugin-transform-block-scoping":"^7.23.4","@babel/plugin-transform-runtime":"^7.13.15","@babel/preset-env":"^7.13.15","@babel/preset-typescript":"^7.13.0","@babel/runtime":"^7.13.10","@babel/runtime-corejs3":"^7.13.10","@microsoft/api-extractor":"^7.19.4","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^18.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.1","@rollup/plugin-replace":"^3.0.0","@rollup/plugin-typescript":"^8.3.0","@types/backo2":"^1.0.1","@types/jest":"^27.4.1","@types/lodash":"^4.14.177","@types/platform":"^1.3.3","@typescript-eslint/eslint-plugin":"^5.12.0","@typescript-eslint/parser":"^5.12.0","@yxfe/multilingual-tool":"^1.0.30","@yxfe/nim-log-reporter":"^1.0.6","@yxfe/nos-uploader":"^1.0.28","@yxfe/request":"^0.2.12",backo2:"^1.0.2","browser-md5-file":"^1.1.1","core-js":"^3.10.1","cross-env":"^7.0.3",eslint:"^8.9.0","eslint-config-prettier":"^8.5.0","eslint-plugin-prettier":"^4.0.0",eventemitter3:"^4.0.7",husky:"^7.0.4",jest:"^27.5.1","lodash-es":"^4.17.21","neroom-web-sdk":"1.7.0",platform:"^1.3.6","pre-commit":"^1.2.2",prettier:"^2.6.1","react-native":"^0.75.2",rollup:"^2.45.2","rollup-plugin-banner":"^0.2.1","rollup-plugin-banner2":"^1.2.2","rollup-plugin-copy":"^3.4.0","rollup-plugin-insert":"^1.3.2","rollup-plugin-terser":"^7.0.2","rollup-plugin-visualizer":"^5.12.0","ts-jest":"^27.1.4",tslib:"^2.3.1",typedoc:"^0.22.11",typescript:"^4.5.4"},sdkPkg={name:name,version:version,sdk:sdk,description:description,main:main,types:types,scripts:scripts,repository:repository,keywords:keywords,author:author,license:license,eslintIgnore:eslintIgnore,files:files,devDependencies:devDependencies},LocalConversationStore=function(){function e(e,t){this.rootStore=e,this.nim=t,this.conversations=new Map,this.totalUnreadCount=0,this.logger=null,makeAutoObservable(this),this._onSyncStarted=this._onSyncStarted.bind(this),this._onSyncFinished=this._onSyncFinished.bind(this),this._onSyncFailed=this._onSyncFailed.bind(this),this._onConversationCreated=this._onConversationCreated.bind(this),this._onConversationDeleted=this._onConversationDeleted.bind(this),this._onConversationChanged=this._onConversationChanged.bind(this),this._onTotalUnreadCountChanged=this._onTotalUnreadCountChanged.bind(this),this.logger=e.logger,t.V2NIMLocalConversationService.on("onSyncStarted",this._onSyncStarted),t.V2NIMLocalConversationService.on("onSyncFinished",this._onSyncFinished),t.V2NIMLocalConversationService.on("onSyncFailed",this._onSyncFailed),t.V2NIMLocalConversationService.on("onConversationCreated",this._onConversationCreated),t.V2NIMLocalConversationService.on("onConversationDeleted",this._onConversationDeleted),t.V2NIMLocalConversationService.on("onConversationChanged",this._onConversationChanged),t.V2NIMLocalConversationService.on("onTotalUnreadCountChanged",this._onTotalUnreadCountChanged)}return e.prototype.resetState=function(){var e;null===(e=this.logger)||void 0===e||e.log("LocalConversationStore Conversation resetState"),this.conversations.clear(),this.totalUnreadCount=0},e.prototype.destroy=function(){this.resetState(),this.nim.V2NIMLocalConversationService.off("onSyncStarted",this._onSyncStarted),this.nim.V2NIMLocalConversationService.off("onSyncFinished",this._onSyncFinished),this.nim.V2NIMLocalConversationService.off("onSyncFailed",this._onSyncFailed),this.nim.V2NIMLocalConversationService.off("onConversationCreated",this._onConversationCreated),this.nim.V2NIMLocalConversationService.off("onConversationDeleted",this._onConversationDeleted),this.nim.V2NIMLocalConversationService.off("onConversationChanged",this._onConversationChanged),this.nim.V2NIMLocalConversationService.off("onTotalUnreadCountChanged",this._onTotalUnreadCountChanged)},e.prototype.addConversation=function(e){var t=this;e.filter(function(e){return!!e.conversationId}).filter(function(e){return[1,2].includes(e.type)}).forEach(function(e){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(n){return t=this.conversations.get(e.conversationId),this.conversations.set(e.conversationId,__assign(__assign({},t),e)),[2]})})})},e.prototype.updateConversation=function(e){var t=this;e.filter(function(e){return!!e.conversationId}).filter(function(e){return[1,2].includes(e.type)}).forEach(function(e){var n=t.conversations.get(e.conversationId);t.conversations.set(e.conversationId,__assign(__assign({},n),e))})},e.prototype.removeConversation=function(e){var t=this;e.forEach(function(e){t.conversations.delete(e),t.rootStore.uiStore.selectedConversation===e&&t.rootStore.uiStore.unselectConversation()})},e.prototype.resetConversation=function(e){var t,n,r,i;return __awaiter(this,void 0,void 0,function(){var o,s;return __generator(this,function(a){switch(a.label){case 0:if(null===(t=this.logger)||void 0===t||t.log("LocalConversationStore resetConversation",e),!(o=this.conversations.get(e)))return null===(n=this.logger)||void 0===n||n.warn("LocalConversationStore resetConversation: conversation is not found.",e),[2];a.label=1;case 1:return a.trys.push([1,4,,5]),o.unreadCount?(this._resetMemoryConversationUnreadCount(o),[4,this.nim.V2NIMLocalConversationService.clearUnreadCountByIds([o.conversationId])]):[3,3];case 2:a.sent(),this._resetMemoryConversationUnreadCount(o),a.label=3;case 3:return null===(r=this.logger)||void 0===r||r.log("LocalConversationStore resetConversation success"),[3,5];case 4:throw s=a.sent(),null===(i=this.logger)||void 0===i||i.error("LocalConversationStore resetConversation failed: ",s),s;case 5:return[2]}})})},e.prototype.insertConversationActive=function(e,t,n){var r,i,o;return void 0===n&&(n=!0),__awaiter(this,void 0,void 0,function(){var s,a,c;return __generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,5,,6]),null===(r=this.logger)||void 0===r||r.log("LocalConversationStore insertConversationActive",{conversationType:e,receiverId:t,isSelected:n}),s="",1===e)s=this.nim.V2NIMConversationIdUtil.p2pConversationId(t);else{if(2!==e)throw new Error("Unsupported conversation type");s=this.nim.V2NIMConversationIdUtil.teamConversationId(t)}return this.conversations.has(s)?[3,2]:[4,this.nim.V2NIMLocalConversationService.createConversation(s)];case 1:a=l.sent(),this.addConversation([a]),l.label=2;case 2:return n?[4,this.rootStore.uiStore.selectConversation(s)]:[3,4];case 3:l.sent(),l.label=4;case 4:return null===(i=this.logger)||void 0===i||i.log("LocalConversationStore insertConversationActive success",{conversationType:e,receiverId:t,isSelected:n}),[3,6];case 5:throw c=l.sent(),null===(o=this.logger)||void 0===o||o.error("LocalConversationStore insertConversationActive failed: ",{conversationType:e,receiverId:t,isSelected:n},c),c;case 6:return[2]}})})},e.prototype.deleteConversationActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:o.trys.push([0,6,,7]),null===(t=this.logger)||void 0===t||t.log("LocalConversationStore deleteConversationActive",e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.stickTopConversationActive(e,!1)];case 2:case 3:return o.sent(),[3,4];case 4:return this.removeConversation([e]),[4,this.nim.V2NIMLocalConversationService.deleteConversation(e,!1)];case 5:return o.sent(),null===(n=this.logger)||void 0===n||n.log("LocalConversationStore deleteConversationActive success"),[3,7];case 6:return i=o.sent(),null===(r=this.logger)||void 0===r||r.warn("LocalConversationStore deleteConversationActive failed but continue: ",i),[3,7];case 7:return[2]}})})},e.prototype.stickTopConversationActive=function(e,t){var n,r,i;return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(n=this.logger)||void 0===n||n.log("LocalConversationStore stickTopConversationActive",e,t),[4,this.nim.V2NIMLocalConversationService.stickTopConversation(e,t)];case 1:return s.sent(),null===(r=this.logger)||void 0===r||r.log("LocalConversationStore stickTopConversationActive success"),[3,3];case 2:throw o=s.sent(),null===(i=this.logger)||void 0===i||i.error("LocalConversationStore stickTopConversationActive failed: ",o),o;case 3:return[2]}})})},e.prototype.getConversationListActive=function(e,t){var n,r,i;return __awaiter(this,void 0,void 0,function(){var o,s;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),null===(n=this.logger)||void 0===n||n.log("LocalConversationStore getConversationListActive",e,t),[4,this.nim.V2NIMLocalConversationService.getConversationList(e,t)];case 1:return o=a.sent(),this.addConversation(o.conversationList),[4,this.getP2PMessageReceipt(o.conversationList.filter(function(e){return 1===e.type}).map(function(e){return e.conversationId}))];case 2:return a.sent(),null===(r=this.logger)||void 0===r||r.log("LocalConversationStore getConversationListActive success",e,t,o),[2,o];case 3:throw s=a.sent(),null===(i=this.logger)||void 0===i||i.error("LocalConversationStore getConversationListActive failed: ",s,e,t),s;case 4:return[2]}})})},e.prototype.getP2PMessageReceipt=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o,s,a=this;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("LocalConversationStore getP2PMessageReceipt",e),[4,Promise.all(e.map(function(e){return a.nim.V2NIMMessageService.getP2PMessageReceipt(e)}))];case 1:return i=c.sent(),o=i.map(function(e){var t=a.conversations.get(e.conversationId);if(t)return __assign(__assign({},t),{msgReceiptTime:e.timestamp})}).filter(function(e){return!!e}),this.updateConversation(o),null===(n=this.logger)||void 0===n||n.log("LocalConversationStore getP2PMessageReceipt success",e,i),[2,i];case 2:throw s=c.sent(),null===(r=this.logger)||void 0===r||r.error("LocalConversationStore getP2PMessageReceipt failed: ",s,e),s;case 3:return[2]}})})},e.prototype._resetMemoryConversationUnreadCount=function(e){var t=this.conversations.get(e.conversationId);t&&this.updateConversation([__assign(__assign({},t),{unreadCount:0})])},e.prototype.getConversationReadTimeActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("LocalConversationStore getConversationReadTimeActive",e),[4,this.nim.V2NIMLocalConversationService.getConversationReadTime(e)];case 1:return i=s.sent(),null===(n=this.logger)||void 0===n||n.log("LocalConversationStore getConversationReadTimeActive success",e,i),[2,i];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("LocalConversationStore getConversationReadTimeActive failed: ",o,e),o;case 3:return[2]}})})},e.prototype.markConversationReadActive=function(e){var t,n,r;return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("LocalConversationStore markConversationReadActive",e),[4,this.nim.V2NIMLocalConversationService.markConversationRead(e)];case 1:return i=s.sent(),null===(n=this.logger)||void 0===n||n.log("LocalConversationStore markConversationReadActive success",e,i),[2,i];case 2:throw o=s.sent(),null===(r=this.logger)||void 0===r||r.error("LocalConversationStore markConversationReadActive failed: ",o,e),o;case 3:return[2]}})})},e.prototype.handleConversationWithAit=function(e){var t=this;e.map(function(e){return __awaiter(t,void 0,void 0,function(){var t,n,r,i,o,s,a;return __generator(this,function(c){switch(c.label){case 0:return 2!==e.conversationType&&3!==e.conversationType?[3,2]:(null==e?void 0:e.serverExtension)?(t=this.hasAitMsg([e.serverExtension]),[4,this.getConversationReadTimeActive(e.conversationId)]):[3,2];case 1:n=c.sent(),r=e.conversationId==this.rootStore.uiStore.selectedConversation,i=e.senderId===(null===(a=this.rootStore.userStore.myUserInfo)||void 0===a?void 0:a.accountId),e.createTime>n&&t&&!r&&!i&&((o=this.conversations.get(e.conversationId))?0===(s=o.aitMsgs||[]).length?this.updateConversation([__assign(__assign({},o),{aitMsgs:[e.messageClientId]})]):this.updateConversation([__assign(__assign({},o),{aitMsgs:__spreadArray(__spreadArray([],__read(s),!1),[e.messageClientId],!1)})]):this.addConversation([{conversationId:e.conversationId,type:e.conversationType,aitMsgs:[e.messageClientId]}])),c.label=2;case 2:return[2]}})})})},e.prototype.resetConversationAit=function(e){var t=this.conversations.get(e);2!==(null==t?void 0:t.type)&&3!==(null==t?void 0:t.type)||this.updateConversation([__assign(__assign({},t),{aitMsgs:[]})])},e.prototype.hasAitMsg=function(e){var t=this,n=!1;return(null==e?void 0:e.length)&&(null==e||e.forEach(function(e){var r,i;try{var o=JSON.parse(e||"{}").yxAitMsg,s=t.rootStore.userStore.myUserInfo.accountId;o&&(null===(r=Object.keys(o))||void 0===r||r.forEach(function(e){e!==s&&e!==AT_ALL_ACCOUNT||(n=!0)}))}catch(a){null===(i=t.logger)||void 0===i||i.error("LocalConversationStore parse serverExtension failed: ",e)}})),n},e.prototype._onSyncStarted=function(){var e,t;null===(e=this.logger)||void 0===e||e.log("LocalConversationStore _onSyncStarted"),null===(t=this.rootStore.localConversationStore)||void 0===t||t.getConversationListActive(0,this.rootStore.localOptions.conversationLimit||100)},e.prototype._onSyncFinished=function(){var e,t;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return null===(e=this.logger)||void 0===e||e.log("LocalConversationStore _onSyncFinished"),null===(t=this.rootStore.localConversationStore)||void 0===t||t.getConversationListActive(0,this.rootStore.localOptions.conversationLimit||100),[2]})})},e.prototype._onSyncFailed=function(e){var t;null===(t=this.logger)||void 0===t||t.log("LocalConversationStore _onSyncFailed",e)},e.prototype._onConversationCreated=function(e){var t,n=this;if(null===(t=this.logger)||void 0===t||t.log("LocalConversationStore _onConversationCreated",e),2===e.type)this.nim.V2NIMLocalConversationService.getConversation(e.conversationId).then(function(e){n.addConversation([e]),e.lastMessage&&n.handleConversationWithAit([__assign(__assign({},e.lastMessage),e.lastMessage.messageRefer)])});else if(this.addConversation([e]),1===e.type){var r=e.conversationId;this.nim.V2NIMMessageService.getP2PMessageReceipt(r).then(function(e){var t=n.conversations.get(r);t&&n.updateConversation([__assign(__assign({},t),{msgReceiptTime:e.timestamp})])})}},e.prototype._onConversationDeleted=function(e){var t;null===(t=this.logger)||void 0===t||t.log("LocalConversationStore _onConversationDeleted",e),this.removeConversation(e)},e.prototype._onConversationChanged=function(e){var t;return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){return null===(t=this.logger)||void 0===t||t.log("LocalConversationStore _onConversationChanged",e),this.addConversation(e),e.forEach(function(e){return __awaiter(n,void 0,void 0,function(){var t,n,r,i,o,s;return __generator(this,function(a){switch(a.label){case 0:return t=null===(r=e.lastMessage)||void 0===r?void 0:r.attachment,n=null==t?void 0:t.type,5===(null===(i=e.lastMessage)||void 0===i?void 0:i.messageType)&&(1===n&&(null===(o=null==t?void 0:t.targetIds)||void 0===o?void 0:o.includes(this.rootStore.userStore.myUserInfo.accountId))||2===n&&(null===(s=e.lastMessage)||void 0===s?void 0:s.messageRefer.senderId)===this.rootStore.userStore.myUserInfo.accountId||4===n)?[4,this.deleteConversationActive(e.conversationId)]:[3,2];case 1:return a.sent(),[3,4];case 2:return this.rootStore.uiStore.selectedConversation!==e.conversationId?[3,4]:[4,this.resetConversation(e.conversationId)];case 3:a.sent(),a.label=4;case 4:return 2===e.type&&0==e.unreadCount&&this.resetConversationAit(e.conversationId),[2]}})})}),[2]})})},e.prototype._onTotalUnreadCountChanged=function(e){var t;null===(t=this.logger)||void 0===t||t.log("LocalConversationStore _onTotalUnreadCountChanged",e),this.totalUnreadCount=e},e}(),SubscriptionStore=function(){function e(e,t){this.rootStore=e,this.nim=t,this.stateMap=new Map,this.logger=null,makeAutoObservable(this),this._onUserStatusChanged=this._onUserStatusChanged.bind(this),this.nim.V2NIMSubscriptionService.on("onUserStatusChanged",this._onUserStatusChanged),this.logger=e.logger}return e.prototype.resetState=function(){var e;null===(e=this.logger)||void 0===e||e.log("SubscriptionStore resetState"),this.stateMap.clear()},e.prototype.destroy=function(){this.resetState(),this.nim.V2NIMSubscriptionService.off("onUserStatusChanged",this._onUserStatusChanged)},e.prototype.getUserStatus=function(e){return this.stateMap.get(e)},e.prototype.getUserStatusList=function(){return __spreadArray([],__read(this.stateMap.values()),!1)},e.prototype.subscribeUserStatusActive=function(e){var t,n,r,i;return __awaiter(this,void 0,void 0,function(){var o,s;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),null===(t=this.logger)||void 0===t||t.log("subscribeUserStatusActive",e),[4,this.nim.V2NIMSubscriptionService.subscribeUserStatus({accountIds:e,duration:604800,immediateSync:!0})];case 1:return(o=a.sent()).length>0?(null===(n=this.logger)||void 0===n||n.warn("subscribeUserStatusActive failed accounts",o),[2,o]):(null===(r=this.logger)||void 0===r||r.log("subscribeUserStatusActive success"),[3,3]);case 2:return s=a.sent(),null===(i=this.logger)||void 0===i||i.error("subscribeUserStatusActive err",s),[3,3];case 3:return[2]}})})},e.prototype._onUserStatusChanged=function(e){var t,n,r;null===(r=this.logger)||void 0===r||r.log("_onUserStatusChanged",e);try{for(var i=__values(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.stateMap.set(s.accountId,s)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e}(),RootStore=function(){function e(e,t,n){void 0===n&&(n="Web");var r,i,o,s,a,c=this;this.localOptions={addFriendNeedVerify:!0,teamJoinMode:0,teamAgreeMode:1,teamInviteMode:0,teamUpdateTeamMode:0,teamUpdateExtMode:1,enableTeam:!0,enableChangeTeamJoinMode:!0,enableChangeTeamAgreeMode:!0,leaveOnTransfer:!1,needMention:!0,p2pMsgReceiptVisible:!1,teamMsgReceiptVisible:!1,loginStateVisible:!1,allowTransferTeamOwner:!1,teamManagerVisible:!1,aiVisible:!0,teamManagerLimit:10,sendMsgBefore:function(e){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(t){return[2,e]})})},aiUserAgentProvider:{},conversationLimit:100,debug:"debug",aiStream:!0,iconfontUrl:[]},this.sdkOptions={},this.conversationStore=null,this.localConversationStore=null,this.logger=null,makeAutoObservable(this),this.nim=e,this.localOptions=__assign(__assign({},this.localOptions),t),this.logger="off"==(null===(r=this.localOptions)||void 0===r?void 0:r.debug)?null:logDebug$1({level:null===(i=this.localOptions)||void 0===i?void 0:i.debug,version:packageJson.version,appName:packageJson.name,needStringify:!1}),null===(o=this.logger)||void 0===o||o.log("store init",{localOptions:this.localOptions}),this.sdkOptions=__assign({},null===(s=this.nim)||void 0===s?void 0:s.getOptions()),this.connectStore=new ConnectStore(this,e,this.localOptions),this.friendStore=new FriendStore(this,e),this.msgStore=new MsgStore(this,e,this.localOptions),this.relationStore=new RelationStore(this,e),(null===(a=this.sdkOptions)||void 0===a?void 0:a.enableV2CloudConversation)?this.conversationStore=new ConversationStore(this,e):this.localConversationStore=new LocalConversationStore(this,e),this.teamStore=new TeamStore(this,e,this.localOptions),this.teamMemberStore=new TeamMemberStore(this,e),this.sysMsgStore=new SysMsgStore(this,e),this.userStore=new UserStore(this,e),this.aiUserStore=new AIUserStore(this,e,this.localOptions),this.uiStore=new UiStore(this),this.storageStore=new StorageStore(this,e),this.subscriptionStore=new SubscriptionStore(this,e);["ContactKit","ConversationKit","ChatKit","SearchKit"].forEach(function(e){new EventTracking$1({appKey:c.nim.options.appkey,version:"",component:e,imVersion:sdkPkg.version,platform:n,channel:"netease",os:"",framework:"",language:detectLanguage(),container:detectContainer(n)}).track("init","")})}return e.prototype.resetState=function(){var e,t,n,r;null===(e=this.logger)||void 0===e||e.log("store resetState"),this.friendStore.resetState(),this.msgStore.resetState(),this.relationStore.resetState(),(null===(t=this.sdkOptions)||void 0===t?void 0:t.enableV2CloudConversation)?null===(n=this.conversationStore)||void 0===n||n.resetState():null===(r=this.localConversationStore)||void 0===r||r.resetState(),this.teamStore.resetState(),this.teamMemberStore.resetState(),this.sysMsgStore.resetState(),this.userStore.resetState(),this.aiUserStore.resetState(),this.uiStore.resetState(),this.subscriptionStore.resetState()},e.prototype.destroy=function(){var e,t,n;logger.log("store destroyed"),this.connectStore.destroy(),this.friendStore.destroy(),this.msgStore.destroy(),this.relationStore.destroy(),(null===(e=this.sdkOptions)||void 0===e?void 0:e.enableV2CloudConversation)?null===(t=this.conversationStore)||void 0===t||t.destroy():null===(n=this.localConversationStore)||void 0===n||n.destroy(),this.teamStore.destroy(),this.teamMemberStore.destroy(),this.sysMsgStore.destroy(),this.userStore.destroy(),this.aiUserStore.destroy(),this.uiStore.destroy(),this.subscriptionStore.destroy()},e.getInstance=function(t,n,r){return void 0===r&&(r="Web"),this.ins||(this.ins=new e(t,n,r)),this.ins},e}();const translate=e=>`[${{textMsgText:t("textMsgText"),customMsgText:t("customMsgText"),audioMsgText:t("audioMsgText"),videoMsgText:t("videoMsgText"),fileMsgText:t("fileMsgText"),callMsgText:t("callMsgText"),geoMsgText:t("geoMsgText"),imgMsgText:t("imgMsgText"),notiMsgText:t("notiMsgText"),robotMsgText:t("robotMsgText"),tipMsgText:t("tipMsgText"),unknowMsgText:t("unknowMsgText")}[e]||""}]`,getMsgContentTipByType=e=>{const{messageType:t,text:n}=e;switch(t){case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT:return n||translate("textMsgText");case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE:return translate("fileMsgText");case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE:return translate("imgMsgText");case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM:return n||translate("customMsgText");case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO:return translate("audioMsgText");case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL:return translate("callMsgText");case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_LOCATION:return translate("geoMsgText");case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_NOTIFICATION:return translate("notiMsgText");case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_ROBOT:return translate("robotMsgText");case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TIPS:return translate("tipMsgText");case Ee.V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO:return translate("videoMsgText");default:return translate("unknowMsgText")}},setTabUnread=()=>{var e,t,n;const r=getCurrentPages$1(),i=r[r.length-1].route;if(i&&!["pages/User/my/index","pages/Contact/index","pages/Conversation/index"].includes(i))return;const o=uni.$UIKitStore;0===(((null==(e=null==o?void 0:o.sdkOptions)?void 0:e.enableV2CloudConversation)?null==(t=null==o?void 0:o.conversationStore)?void 0:t.totalUnreadCount:null==(n=null==o?void 0:o.localConversationStore)?void 0:n.totalUnreadCount)||0)?uni.hideTabBarRedDot({index:0}):uni.showTabBarRedDot({index:0})},setContactTabUnread=()=>{var e,t;const n=getCurrentPages$1(),r=n[n.length-1].route;if(r&&!["pages/User/my/index","pages/Contact/index","pages/Conversation/index"].includes(r))return;0===(null==(t=null==(e=uni.$UIKitStore)?void 0:e.sysMsgStore)?void 0:t.getTotalUnreadMsgsCount())?uni.hideTabBarRedDot({index:1}):uni.showTabBarRedDot({index:1})};var CallEventType=(e=>(e.PeerOnline="peer-online",e.PeerLeave="peer-leave",e.StreamAdded="stream-added",e.StreamRemove="stream-removed",e.ConnectionStateChange="connection-state-change",e.NetworkQuality="network-quality",e.StreamSubscribed="stream-subscribed",e.AUDIOLEVEL_NOT_SUPPORTED="AUDIOLEVEL_NOT_SUPPORTED",e.Error="exception",e.DISCONNECTED="connection-state-change",e))(CallEventType||{});function getParamsValues(e){const t=e.split("&");let n={};return t.forEach(e=>{let t=e.split("=");n[t[0]]=t[1]}),n}function removeListeners(e){e.off("stream-removed"),e.off("stream-added"),e.off("peer-online"),e.off("peer-leave"),e.off("connection-state-change"),e.off("network-quality"),e.off("stream-subscribed"),e.off("exception"),e.off("connection-state-change"),e.destroy()}function addCallListeners(e,t){console.log(`addCallListeners  ${e}`),e.on("peer-online",e=>{console.warn(`${e.uid} 加入房间`),t("peer-online")}),e.on("peer-leave",e=>{console.warn(`${e.uid} 离开房间`),console.warn(`${e.reason} 离开房间`),t("peer-leave",{uid:e.uid})}),e.on("stream-added",async e=>{const n=e.stream,r=n.getId();console.warn(`收到 ${r} 的发布 ${e.mediaType} 的通知`),t("stream-added",{uid:r,stream:n})}),e.on("connection-state-change",e=>{console.warn(`connection-state-change: ${e}`),"DISCONNECTED"===e.curState&&t()}),e.on("exception",e=>{if(e.uid===this.localUid)switch(e.msg){case"FRAMERATE_SENT_TOO_LOW":return Toast("视频发送帧率过低");case"FRAMERATE_VIDEO_BITRATE_TOO_LOW":return Toast("视频发送码率过低");case"AUDIO_INPUT_LEVEL_TOO_LOW":return Toast("发送音量过低");case"SEND_AUDIO_BITRATE_TOO_LOW":return Toast("音频发送码率过低")}}),e.on("stream-removed",e=>{const n=e.stream,r=n.getId();console.warn(`收到 ${r} 的停止发布 ${e.mediaType} 的通知`),n.stop(e.mediaType),t("stream-added",{uid:r,stream:n}),console.warn("远端流停止订阅，需要更新",r,n)}),e.on("network-quality",e=>{e.forEach(e=>{})}),e.on("stream-subscribed",e=>{console.warn("收到了对端的流，准备播放"),t("stream-subscribed",{uid:e.stream.getId(),stream:e.stream})}),e.on("uid-duplicate",()=>{console.warn("==== uid重复，你被踢出")}),e.on("error",e=>{console.error("===== 发生错误事件：",e),"SOCKET_ERROR"===e?console.warn("==== 网络异常，已经退出房间"):"AUDIOLEVEL_NOT_SUPPORTED"==e&&uni.showToast({title:"未找到输入设备",icon:"none",duration:1e3,success:()=>{t("AUDIOLEVEL_NOT_SUPPORTED")}})}),e.on("accessDenied",e=>{console.warn(`==== ${e}设备开启的权限被禁止`)}),e.on("connection-state-change",e=>{console.warn(`网络状态变更: ${e.prevState} => ${e.curState}, 当前是否在重连：${e.reconnect}`)})}async function createTeamRoom(e,t,n){const r=`${Date.now()}${Math.random().toString(7)}`,i=`${Date.now()}${Math.random().toString(36)}`,o=randomNumbers();console.log(`${r}  ${i} ${o}`,"---------------");let s=await uni.$UIKitNIM.V2NIMSignallingService.createRoom(Ee.V2NIMSignallingChannelType.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO,i);await uni.$UIKitNIM.V2NIMSignallingService.joinRoom({channelId:s.channelId});const a=uni.getStorageSync("inviteUsers");for(let c=0;c<a.length;c++)uni.$UIKitNIM.V2NIMSignallingService.invite({serverExtension:`teamId=${n}&conversationId=${t}&ids=${a.toString()}`,channelId:s.channelId,inviteeAccountId:a[c],requestId:r,channelType:Ee.V2NIMSignallingChannelType.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO});return{roomInfo:s,channelName:i,channelId:s.channelId,requestId:r,streamId:o}}function randomNumbers(){let e="";for(let t=0;t<16;t++)e+=Math.floor(9*Math.random()+1);return e}function formatterTime(e){let t="",n=Math.ceil(e);if(n<10)t="00:0"+n;else if(n>60){const e=n/60,r=n%60,i=Math.floor(n/60)<10?"0"+Math.floor(n/60):Math.floor(n/60),o=n%60<10?"0"+n%60:n%60;console.log(e,r,"time=======",i,o),t=`${i}:${o}`}else n>=10&&(t="00:"+n);return t}let audioMap=[{key:"call",value:uni.createInnerAudioContext()},{key:"jieting",value:uni.createInnerAudioContext()},{key:"jujue",value:uni.createInnerAudioContext()}];function playMusic(e,t){var n;const r=null==(n=audioMap.find(e=>e.key===t))?void 0:n.value;r&&(r.src=e,"call"==t&&(r.loop=!0),r.play())}function destoryAudio(){audioMap.forEach((e,t)=>{e.value.stop()}),audioMap=[{key:"call",value:uni.createInnerAudioContext()},{key:"jieting",value:uni.createInnerAudioContext()},{key:"jujue",value:uni.createInnerAudioContext()}]}function stopMusic(e){audioMap.forEach((t,n)=>{t.key==e&&t.value.stop()})}async function createCallMessage(e){console.warn(e,"opts=========");const t=uni.$UIKitNIM.V2NIMConversationIdUtil.teamConversationId(e.uid);let n=await e.client.getSessionStats();const r=uni.$UIKitNIM.V2NIMMessageCreator.createCallMessage(1,e.channelId,e.type||1,[{accountId:uni.$UIKitStore.userStore.myUserInfo.accountId,duration:Math.ceil(n.Duration)||0}]);try{await uni.$UIKitStore.msgStore.sendMessageActive({msg:r,conversationId:t,conversationType:Ee.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM,sendBefore:()=>{uni.$emit(events.ON_SCROLL_BOTTOM)}})}catch(i){console.warn(i.toString(),i.message.toString(),"sendMessageActive")}}const apiUrl="https://api.imgbt.net/";async function httpRequest(e){uni.showLoading();let t=new FormData;for(let n in e.data)t.append(n,e.data[n]);return new Promise((t,n)=>{uni.request({url:apiUrl+e.url,data:e.data,method:e.method||"POST",success(e){console.log("success :",e.data.data,e.data.message),200!=e.data.code?(uni.showToast({icon:"error",title:e.data.message||e.data.msg}),n()):t(e.data.data)},fail(e){uni.showToast({icon:"error",title:"未知错误"}),n()},complete(e){console.log("complete :",e),uni.hideLoading()},header:Object.assign({},{"Content-Type":"application/x-www-form-urlencoded"},e.headers)})})}async function updateImInfo(e){await httpRequest({url:"im/api/updateUser",method:"POST",data:Object.assign({},{account:uni.$UIKitStore.userStore.myUserInfo.accountId})}),null!=e.nickname&&uni.$UIKitNIM.V2NIMUserService.updateSelfUserProfile({name:e.nickname}).then(e=>{uni.showToast({title:"修改成功",icon:"success",duration:1e3,success:()=>{uni.navigateBack()}})}),null!=e.mobile&&uni.$UIKitNIM.V2NIMUserService.updateSelfUserProfile({mobile:e.mobile}).then(e=>{uni.showToast({title:"修改成功",icon:"success",duration:1e3,success:()=>{uni.navigateBack()}})}),null!=e.signature&&uni.$UIKitNIM.V2NIMUserService.updateSelfUserProfile({sign:e.signature}).then(e=>{uni.showToast({title:"修改成功",icon:"success",duration:1e3,success:()=>{uni.navigateBack()}})}),null!=e.gender&&uni.$UIKitNIM.V2NIMUserService.updateSelfUserProfile({gender:e.gender}).then(e=>{uni.showToast({title:"修改成功",icon:"success"})})}var nimCallKit,startByNotificationId;function initNim(e){uni.setStorage({key:STORAGE_KEY,data:e}),console.warn(e.appkey,"appkey====="),uni.showLoading();const t="on"===uni.getStorageSync("enableV2CloudConversation"),n=uni.$UIKitNIM=NIM.getInstance({appkey:e.appkey,needReconnect:!0,debugLevel:"debug",apiVersion:"v2",enableV2CloudConversation:t},{V2NIMLoginServiceConfig:{lbsUrls:isWxApp?["https://lbs.netease.im/lbs/wxwebconf.jsp"]:["https://lbs.netease.im/lbs/webconf.jsp"],linkUrl:isWxApp?"wlnimsc0.netease.im":"weblink.netease.im",isFixedDeviceId:!0}}),r=uni.$UIKitStore=new RootStore(n,{addFriendNeedVerify:!0,p2pMsgReceiptVisible:!0,teamMsgReceiptVisible:!0,loginStateVisible:!0,teamAgreeMode:Ee.V2NIMTeamAgreeMode.V2NIM_TEAM_AGREE_MODE_NO_AUTH,sendMsgBefore:async e=>{const t=getMsgContentTipByType({text:e.msg.text,messageType:e.msg.messageType}),i=e.serverExtension?e.serverExtension.yxAitMsg:{forcePushIDsList:"[]",needForcePush:!1},{forcePushIDsList:o,needForcePush:s}=i?r.msgStore._formatExtAitToPushInfo(i,e.msg.text):{forcePushIDsList:"[]",needForcePush:!1},{conversationId:a}=e,c=n.V2NIMConversationIdUtil.parseConversationType(a),l=n.V2NIMConversationIdUtil.parseConversationTargetId(a),d={pushEnabled:!0,pushNickEnabled:!0,forcePush:s,forcePushContent:t,forcePushAccountIds:o,pushPayload:JSON.stringify({pushTitle:"",notify_effect:"2",intent_uri:"intent:#Intent;action=com.netease.nimlib.uniapp.push.NotificationClickActivity;component=com.netease.nim.demo/com.netease.nimlib.uniapp.push.NotificationClickActivity;launchFlags=0x04000000;i.sessionType=0;S.sessionId=cs1;end",hwField:{click_action:{type:1,intent:"intent:#Intent;action=com.netease.nimlib.uniapp.push.NotificationClickActivity;component=com.netease.nim.demo/com.netease.nimlib.uniapp.push.NotificationClickActivity;launchFlags=0x04000000;i.sessionType=0;S.sessionId=cs1;end"},androidConfig:{category:"IM"}},honorField:{notification:{clickAction:{type:1,intent:""},importance:"NORMAL"}},vivoField:{skipType:"4",skipContent:"",classification:"1",category:"IM"},oppoField:{channel_id:"",category:"IM",notify_level:2,click_action_type:"1",click_action_activity:"",action_parameters:""},fcmFieldV1:{message:{android:{priority:"",data:{sessionType:"0",sessionId:"cs1"},notification:{click_action:""}}}},sessionId:1==c?uni.$UIKitStore.userStore.myUserInfo.accountId:l,sessionType:c}),pushContent:t};return{...e,pushConfig:d}}},"UniApp");n.V2NIMLoginService.login(e.account,e.token).then(async()=>{startByNotificationId?startByNotificationId&&(await uni.$UIKitStore.uiStore.selectConversation(startByNotificationId),uni.navigateTo({url:`/pages/Chat/index?conversationId=${startByNotificationId}`}),startByNotificationId=""):uni.showToast({title:"登录成功",icon:"success",duration:1e3,success:()=>{customSwitchTab({url:"/pages/Conversation/index"}),httpRequest({url:"kyc/getByAccount",method:"GET",data:{account:e.account}}).then(e=>{uni.$UIKitNIM.V2NIMUserService.updateSelfUserProfile({name:e.nickname})})}})}).catch(e=>{102302==e.code?uni.showToast({title:"密码错误",icon:"error",duration:800,success:()=>{uni.reLaunch({url:"/pages/Login/login-form"})}}):102422==e.code&&(uni.showToast({title:e.message,icon:"error"}),uni.navigateTo({url:"/pages/Login/login-form"}))}).finally(()=>{uni.hideLoading()}),console.log("add events==="),uni.$UIKitNIM.V2NIMSignallingService.on("onSyncRoomInfoList",e=>{for(let t=0;t<e.length;t++)uni.$UIKitNIM.V2NIMSignallingService.leaveRoom(e[t].channelInfo.channelId)}),uni.$UIKitNIM.V2NIMSignallingService.on("onMultiClientEvent",e=>{uni.showToast({icon:"none",title:"已在别的设备处理",duration:800,success:()=>{uni.navigateBack()}})}),uni.$UIKitNIM.V2NIMSignallingService.on("onOnlineEvent",e=>{if(console.warn(e,"onOnlineEvent====="),3==e.eventType){const t=getParamsValues(e.serverExtension);console.log(t,"====="),t.teamId?(uni.setStorageSync("inviteUsers",t.ids.split(",")),customNavigateTo({url:`/pages/Other/team-video-call?uid=${e.inviterAccountId}&channelName=${e.channelInfo.channelName}&roomId=${e.channelInfo.channelId}&requestId=${e.requestId}&type=${e.channelInfo.channelType}&conversationId=${t.conversationId}&teamId=${t.teamId}`})):(uni.setStorageSync("currentConversation",e.serverExtension),customNavigateTo({url:`/pages/Other/video-call?uid=${e.inviterAccountId}&audioRoomId=${e.channelInfo.channelName}&roomId=${e.channelInfo.channelId}&requestId=${e.requestId}&type=${e.channelInfo.channelType}`}))}else uni.$emit("on-invite",e)})}function onImHideApp(){startByNotificationId=""}function logout(){uni.removeStorageSync(STORAGE_KEY);try{nimCallKit.logout({},e=>{200!=e.code?console.log("音视频通话插件退出失败"):console.log("音视频通话插件退出成功")})}catch(e){console.log("音视频通话插件退出失败",e)}uni.$UIKitNIM.V2NIMSignallingService.off("onOnlineEvent"),uni.$UIKitNIM.V2NIMSignallingService.off("onSyncRoomInfoList"),uni.$UIKitNIM.V2NIMLoginService.logout().then(()=>{uni.$UIKitStore.destroy(),customReLaunch({url:"/pages/Login/login-form"})})}const _sfc_main={onLaunch(){var e,t;if(console.warn("成功获取音频流",navigator),console.warn("成功获取音频流",navigator.mediaDevices),navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(e=>{}),navigator.mediaDevices.enumerateDevices(),setLanguage("en"==uni.getStorageSync("switchToEnglishFlag")?"en":"zh"),(null==(t=null==(e=null==uni?void 0:uni.$UIKitStore)?void 0:e.connectStore)?void 0:t.connectStatus)===Ee.V2NIMConnectStatus.V2NIM_CONNECT_STATUS_CONNECTED)return;const n=uni.getStorageSync(STORAGE_KEY);uni.getStorageSync("autoLogin"),n&&n.account&&n.token?initNim(n):customRedirectTo({url:isWxApp?"/pages/index/index":"/pages/Login/login-form"})},onShow(){},onHide(){onImHideApp()},methods:{}};setupApp(_sfc_main);var vconsole_min={exports:{}};
/*!
 * vConsole v3.15.1 (https://github.com/Tencent/vConsole)
 *
 * Tencent is pleased to support the open source community by making vConsole available.
 * Copyright (C) 2017 THL A29 Limited, a Tencent company. All rights reserved.
 * Licensed under the MIT License (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at
 * http://opensource.org/licenses/MIT
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
 */(function(module,exports){var n;commonjsGlobal$1||self,n=function(){return function(){var __webpack_modules__={4264:function(e,t,n){e.exports=n(7588)},5036:function(e,t,n){n(1719),n(5677),n(6394),n(5334),n(6969),n(2021),n(8328),n(2129);var r=n(1287);e.exports=r.Promise},2582:function(e,t,n){n(1646),n(6394),n(2004),n(462),n(8407),n(2429),n(1172),n(8288),n(1274),n(8201),n(6626),n(3211),n(9952),n(15),n(9831),n(7521),n(2972),n(6956),n(5222),n(2257);var r=n(1287);e.exports=r.Symbol},8257:function(e,t,n){var r=n(7583),i=n(9212),o=n(5637),s=r.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not a function")}},1186:function(e,t,n){var r=n(7583),i=n(2097),o=n(5637),s=r.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not a constructor")}},9882:function(e,t,n){var r=n(7583),i=n(9212),o=r.String,s=r.TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw s("Can't set "+o(e)+" as a prototype")}},6288:function(e,t,n){var r=n(3649),i=n(3590),o=n(4615),s=r("unscopables"),a=Array.prototype;null==a[s]&&o.f(a,s,{configurable:!0,value:i(null)}),e.exports=function(e){a[s][e]=!0}},4761:function(e,t,n){var r=n(7583),i=n(2447),o=r.TypeError;e.exports=function(e,t){if(i(t,e))return e;throw o("Incorrect invocation")}},2569:function(e,t,n){var r=n(7583),i=n(794),o=r.String,s=r.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not an object")}},5766:function(e,t,n){var r=n(2977),i=n(6782),o=n(1825),s=function(e){return function(t,n,s){var a,c=r(t),l=o(c),d=i(s,l);if(e&&n!=n){for(;l>d;)if((a=c[d++])!=a)return!0}else for(;l>d;d++)if((e||d in c)&&c[d]===n)return e||d||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},4805:function(e,t,n){var r=n(2938),i=n(7386),o=n(5044),s=n(1324),a=n(1825),c=n(4822),l=i([].push),d=function(e){var t=1==e,n=2==e,i=3==e,d=4==e,u=6==e,p=7==e,h=5==e||u;return function(g,m,f,v){for(var y,_,I=s(g),T=o(I),S=r(m,f),E=a(T),M=0,b=v||c,C=t?b(g,E):n||p?b(g,0):void 0;E>M;M++)if((h||M in T)&&(_=S(y=T[M],M,I),e))if(t)C[M]=_;else if(_)switch(e){case 3:return!0;case 5:return y;case 6:return M;case 2:l(C,y)}else switch(e){case 4:return!1;case 7:l(C,y)}return u?-1:i||d?d:C}};e.exports={forEach:d(0),map:d(1),filter:d(2),some:d(3),every:d(4),find:d(5),findIndex:d(6),filterReject:d(7)}},9269:function(e,t,n){var r=n(6544),i=n(3649),o=n(4061),s=i("species");e.exports=function(e){return o>=51||!r(function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo})}},4546:function(e,t,n){var r=n(7583),i=n(6782),o=n(1825),s=n(5999),a=r.Array,c=Math.max;e.exports=function(e,t,n){for(var r=o(e),l=i(t,r),d=i(void 0===n?r:n,r),u=a(c(d-l,0)),p=0;l<d;l++,p++)s(u,p,e[l]);return u.length=p,u}},6917:function(e,t,n){var r=n(7386);e.exports=r([].slice)},5289:function(e,t,n){var r=n(7583),i=n(4521),o=n(2097),s=n(794),a=n(3649)("species"),c=r.Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(o(t)&&(t===c||i(t.prototype))||s(t)&&null===(t=t[a]))&&(t=void 0)),void 0===t?c:t}},4822:function(e,t,n){var r=n(5289);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},3616:function(e,t,n){var r=n(3649)("iterator"),i=!1;try{var o=0,s={next:function(){return{done:!!o++}},return:function(){i=!0}};s[r]=function(){return this},Array.from(s,function(){throw 2})}catch(a){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o={};o[r]=function(){return{next:function(){return{done:n=!0}}}},e(o)}catch(s){}return n}},9624:function(e,t,n){var r=n(7386),i=r({}.toString),o=r("".slice);e.exports=function(e){return o(i(e),8,-1)}},3058:function(e,t,n){var r=n(7583),i=n(8191),o=n(9212),s=n(9624),a=n(3649)("toStringTag"),c=r.Object,l="Arguments"==s(function(){return arguments}());e.exports=i?s:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=c(e),a))?n:l?s(t):"Object"==(r=s(t))&&o(t.callee)?"Arguments":r}},1509:function(e,t,n){var r=n(7386)("".replace),i=String(Error("zxcasd").stack),o=/\n\s*at [^:]*:[^\n]*/,s=o.test(i);e.exports=function(e,t){if(s&&"string"==typeof e)for(;t--;)e=r(e,o,"");return e}},3478:function(e,t,n){var r=n(2870),i=n(929),o=n(6683),s=n(4615);e.exports=function(e,t,n){for(var a=i(t),c=s.f,l=o.f,d=0;d<a.length;d++){var u=a[d];r(e,u)||n&&r(n,u)||c(e,u,l(t,u))}}},926:function(e,t,n){var r=n(6544);e.exports=!r(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},4683:function(e,t,n){var r=n(2365).IteratorPrototype,i=n(3590),o=n(4677),s=n(8821),a=n(339),c=function(){return this};e.exports=function(e,t,n,l){var d=t+" Iterator";return e.prototype=i(r,{next:o(+!l,n)}),s(e,d,!1,!0),a[d]=c,e}},57:function(e,t,n){var r=n(8494),i=n(4615),o=n(4677);e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},4677:function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},5999:function(e,t,n){var r=n(8734),i=n(4615),o=n(4677);e.exports=function(e,t,n){var s=r(t);s in e?i.f(e,s,o(0,n)):e[s]=n}},9012:function(e,t,n){var r=n(7263),i=n(8262),o=n(6268),s=n(4340),a=n(9212),c=n(4683),l=n(729),d=n(7496),u=n(8821),p=n(57),h=n(1270),g=n(3649),m=n(339),f=n(2365),v=s.PROPER,y=s.CONFIGURABLE,_=f.IteratorPrototype,I=f.BUGGY_SAFARI_ITERATORS,T=g("iterator"),S="keys",E="values",M="entries",b=function(){return this};e.exports=function(e,t,n,s,g,f,C){c(n,t,s);var A,O,R,N=function(e){if(e===g&&x)return x;if(!I&&e in k)return k[e];switch(e){case S:case E:case M:return function(){return new n(this,e)}}return function(){return new n(this)}},w=t+" Iterator",P=!1,k=e.prototype,L=k[T]||k["@@iterator"]||g&&k[g],x=!I&&L||N(g),V="Array"==t&&k.entries||L;if(V&&(A=l(V.call(new e)))!==Object.prototype&&A.next&&(o||l(A)===_||(d?d(A,_):a(A[T])||h(A,T,b)),u(A,w,!0,!0),o&&(m[w]=b)),v&&g==E&&L&&L.name!==E&&(!o&&y?p(k,"name",E):(P=!0,x=function(){return i(L,this)})),g)if(O={values:N(E),keys:f?x:N(S),entries:N(M)},C)for(R in O)(I||P||!(R in k))&&h(k,R,O[R]);else r({target:t,proto:!0,forced:I||P},O);return o&&!C||k[T]===x||h(k,T,x,{name:g}),m[t]=x,O}},2219:function(e,t,n){var r=n(1287),i=n(2870),o=n(491),s=n(4615).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});i(t,e)||s(t,e,{value:o.f(e)})}},8494:function(e,t,n){var r=n(6544);e.exports=!r(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},6668:function(e,t,n){var r=n(7583),i=n(794),o=r.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},6778:function(e){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},9307:function(e,t,n){var r=n(6668)("span").classList,i=r&&r.constructor&&r.constructor.prototype;e.exports=i===Object.prototype?void 0:i},2274:function(e){e.exports="object"==typeof window},3256:function(e,t,n){var r=n(6918),i=n(7583);e.exports=/ipad|iphone|ipod/i.test(r)&&void 0!==i.Pebble},7020:function(e,t,n){var r=n(6918);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},5354:function(e,t,n){var r=n(9624),i=n(7583);e.exports="process"==r(i.process)},6846:function(e,t,n){var r=n(6918);e.exports=/web0s(?!.*chrome)/i.test(r)},6918:function(e,t,n){var r=n(5897);e.exports=r("navigator","userAgent")||""},4061:function(e,t,n){var r,i,o=n(7583),s=n(6918),a=o.process,c=o.Deno,l=a&&a.versions||c&&c.version,d=l&&l.v8;d&&(i=(r=d.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},5690:function(e){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},1178:function(e,t,n){var r=n(6544),i=n(4677);e.exports=!r(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",i(1,7)),7!==e.stack)})},7263:function(e,t,n){var r=n(7583),i=n(6683).f,o=n(57),s=n(1270),a=n(460),c=n(3478),l=n(4451);e.exports=function(e,t){var n,d,u,p,h,g=e.target,m=e.global,f=e.stat;if(n=m?r:f?r[g]||a(g,{}):(r[g]||{}).prototype)for(d in t){if(p=t[d],u=e.noTargetGet?(h=i(n,d))&&h.value:n[d],!l(m?d:g+(f?".":"#")+d,e.forced)&&void 0!==u){if(typeof p==typeof u)continue;c(p,u)}(e.sham||u&&u.sham)&&o(p,"sham",!0),s(n,d,p,e)}}},6544:function(e){e.exports=function(e){try{return!!e()}catch(t){return!0}}},1611:function(e,t,n){var r=n(8987),i=Function.prototype,o=i.apply,s=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(o):function(){return s.apply(o,arguments)})},2938:function(e,t,n){var r=n(7386),i=n(8257),o=n(8987),s=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?s(e,t):function(){return e.apply(t,arguments)}}},8987:function(e,t,n){var r=n(6544);e.exports=!r(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},8262:function(e,t,n){var r=n(8987),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},4340:function(e,t,n){var r=n(8494),i=n(2870),o=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,a=i(o,"name"),c=a&&"something"===function(){}.name,l=a&&(!r||r&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:c,CONFIGURABLE:l}},7386:function(e,t,n){var r=n(8987),i=Function.prototype,o=i.bind,s=i.call,a=r&&o.bind(s,s);e.exports=r?function(e){return e&&a(e)}:function(e){return e&&function(){return s.apply(e,arguments)}}},5897:function(e,t,n){var r=n(7583),i=n(9212);e.exports=function(e,t){return arguments.length<2?function(e){return i(e)?e:void 0}(r[e]):r[e]&&r[e][t]}},8272:function(e,t,n){var r=n(3058),i=n(911),o=n(339),s=n(3649)("iterator");e.exports=function(e){if(null!=e)return i(e,s)||i(e,"@@iterator")||o[r(e)]}},6307:function(e,t,n){var r=n(7583),i=n(8262),o=n(8257),s=n(2569),a=n(5637),c=n(8272),l=r.TypeError;e.exports=function(e,t){var n=arguments.length<2?c(e):t;if(o(n))return s(i(n,e));throw l(a(e)+" is not iterable")}},911:function(e,t,n){var r=n(8257);e.exports=function(e,t){var n=e[t];return null==n?void 0:r(n)}},7583:function(e,t,n){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||function(){return this}()||Function("return this")()},2870:function(e,t,n){var r=n(7386),i=n(1324),o=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},4639:function(e){e.exports={}},2716:function(e,t,n){var r=n(7583);e.exports=function(e,t){var n=r.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))}},482:function(e,t,n){var r=n(5897);e.exports=r("document","documentElement")},275:function(e,t,n){var r=n(8494),i=n(6544),o=n(6668);e.exports=!r&&!i(function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},5044:function(e,t,n){var r=n(7583),i=n(7386),o=n(6544),s=n(9624),a=r.Object,c=i("".split);e.exports=o(function(){return!a("z").propertyIsEnumerable(0)})?function(e){return"String"==s(e)?c(e,""):a(e)}:a},9734:function(e,t,n){var r=n(7386),i=n(9212),o=n(1314),s=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},4402:function(e,t,n){var r=n(794),i=n(57);e.exports=function(e,t){r(t)&&"cause"in t&&i(e,"cause",t.cause)}},2743:function(e,t,n){var r,i,o,s=n(9491),a=n(7583),c=n(7386),l=n(794),d=n(57),u=n(2870),p=n(1314),h=n(9137),g=n(4639),m="Object already initialized",f=a.TypeError,v=a.WeakMap;if(s||p.state){var y=p.state||(p.state=new v),_=c(y.get),I=c(y.has),T=c(y.set);r=function(e,t){if(I(y,e))throw new f(m);return t.facade=e,T(y,e,t),t},i=function(e){return _(y,e)||{}},o=function(e){return I(y,e)}}else{var S=h("state");g[S]=!0,r=function(e,t){if(u(e,S))throw new f(m);return t.facade=e,d(e,S,t),t},i=function(e){return u(e,S)?e[S]:{}},o=function(e){return u(e,S)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=i(t)).type!==e)throw f("Incompatible receiver, "+e+" required");return n}}}},114:function(e,t,n){var r=n(3649),i=n(339),o=r("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||s[o]===e)}},4521:function(e,t,n){var r=n(9624);e.exports=Array.isArray||function(e){return"Array"==r(e)}},9212:function(e){e.exports=function(e){return"function"==typeof e}},2097:function(e,t,n){var r=n(7386),i=n(6544),o=n(9212),s=n(3058),a=n(5897),c=n(9734),l=function(){},d=[],u=a("Reflect","construct"),p=/^\s*(?:class|function)\b/,h=r(p.exec),g=!p.exec(l),m=function(e){if(!o(e))return!1;try{return u(l,d,e),!0}catch(t){return!1}},f=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return g||!!h(p,c(e))}catch(t){return!0}};f.sham=!0,e.exports=!u||i(function(){var e;return m(m.call)||!m(Object)||!m(function(){e=!0})||e})?f:m},4451:function(e,t,n){var r=n(6544),i=n(9212),o=/#|\.prototype\./,s=function(e,t){var n=c[a(e)];return n==d||n!=l&&(i(t)?r(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=s.data={},l=s.NATIVE="N",d=s.POLYFILL="P";e.exports=s},794:function(e,t,n){var r=n(9212);e.exports=function(e){return"object"==typeof e?null!==e:r(e)}},6268:function(e){e.exports=!1},5871:function(e,t,n){var r=n(7583),i=n(5897),o=n(9212),s=n(2447),a=n(7786),c=r.Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return o(t)&&s(t.prototype,c(e))}},4026:function(e,t,n){var r=n(7583),i=n(2938),o=n(8262),s=n(2569),a=n(5637),c=n(114),l=n(1825),d=n(2447),u=n(6307),p=n(8272),h=n(7093),g=r.TypeError,m=function(e,t){this.stopped=e,this.result=t},f=m.prototype;e.exports=function(e,t,n){var r,v,y,_,I,T,S,E=n&&n.that,M=!(!n||!n.AS_ENTRIES),b=!(!n||!n.IS_ITERATOR),C=!(!n||!n.INTERRUPTED),A=i(t,E),O=function(e){return r&&h(r,"normal",e),new m(!0,e)},R=function(e){return M?(s(e),C?A(e[0],e[1],O):A(e[0],e[1])):C?A(e,O):A(e)};if(b)r=e;else{if(!(v=p(e)))throw g(a(e)+" is not iterable");if(c(v)){for(y=0,_=l(e);_>y;y++)if((I=R(e[y]))&&d(f,I))return I;return new m(!1)}r=u(e,v)}for(T=r.next;!(S=o(T,r)).done;){try{I=R(S.value)}catch(N){h(r,"throw",N)}if("object"==typeof I&&I&&d(f,I))return I}return new m(!1)}},7093:function(e,t,n){var r=n(8262),i=n(2569),o=n(911);e.exports=function(e,t,n){var s,a;i(e);try{if(!(s=o(e,"return"))){if("throw"===t)throw n;return n}s=r(s,e)}catch(c){a=!0,s=c}if("throw"===t)throw n;if(a)throw s;return i(s),n}},2365:function(e,t,n){var r,i,o,s=n(6544),a=n(9212),c=n(3590),l=n(729),d=n(1270),u=n(3649),p=n(6268),h=u("iterator"),g=!1;[].keys&&("next"in(o=[].keys())?(i=l(l(o)))!==Object.prototype&&(r=i):g=!0),null==r||s(function(){var e={};return r[h].call(e)!==e})?r={}:p&&(r=c(r)),a(r[h])||d(r,h,function(){return this}),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:g}},339:function(e){e.exports={}},1825:function(e,t,n){var r=n(97);e.exports=function(e){return r(e.length)}},2095:function(e,t,n){var r,i,o,s,a,c,l,d,u=n(7583),p=n(2938),h=n(6683).f,g=n(8117).set,m=n(7020),f=n(3256),v=n(6846),y=n(5354),_=u.MutationObserver||u.WebKitMutationObserver,I=u.document,T=u.process,S=u.Promise,E=h(u,"queueMicrotask"),M=E&&E.value;M||(r=function(){var e,t;for(y&&(e=T.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(n){throw i?s():o=void 0,n}}o=void 0,e&&e.enter()},m||y||v||!_||!I?!f&&S&&S.resolve?((l=S.resolve(void 0)).constructor=S,d=p(l.then,l),s=function(){d(r)}):y?s=function(){T.nextTick(r)}:(g=p(g,u),s=function(){g(r)}):(a=!0,c=I.createTextNode(""),new _(r).observe(c,{characterData:!0}),s=function(){c.data=a=!a})),e.exports=M||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,s()),o=t}},783:function(e,t,n){var r=n(7583);e.exports=r.Promise},8640:function(e,t,n){var r=n(4061),i=n(6544);e.exports=!!Object.getOwnPropertySymbols&&!i(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41})},9491:function(e,t,n){var r=n(7583),i=n(9212),o=n(9734),s=r.WeakMap;e.exports=i(s)&&/native code/.test(o(s))},5084:function(e,t,n){var r=n(8257),i=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)};e.exports.f=function(e){return new i(e)}},2764:function(e,t,n){var r=n(8320);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:r(e)}},3590:function(e,t,n){var r,i=n(2569),o=n(8728),s=n(5690),a=n(4639),c=n(482),l=n(6668),d=n(9137)("IE_PROTO"),u=function(){},p=function(e){return"<script>"+e+"<\/script>"},h=function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{r=new ActiveXObject("htmlfile")}catch(i){}var e,t;g="undefined"!=typeof document?document.domain&&r?h(r):((t=l("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F):h(r);for(var n=s.length;n--;)delete g.prototype[s[n]];return g()};a[d]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(u.prototype=i(e),n=new u,u.prototype=null,n[d]=e):n=g(),void 0===t?n:o.f(n,t)}},8728:function(e,t,n){var r=n(8494),i=n(7670),o=n(4615),s=n(2569),a=n(2977),c=n(5432);t.f=r&&!i?Object.defineProperties:function(e,t){s(e);for(var n,r=a(t),i=c(t),l=i.length,d=0;l>d;)o.f(e,n=i[d++],r[n]);return e}},4615:function(e,t,n){var r=n(7583),i=n(8494),o=n(275),s=n(7670),a=n(2569),c=n(8734),l=r.TypeError,d=Object.defineProperty,u=Object.getOwnPropertyDescriptor;t.f=i?s?function(e,t,n){if(a(e),t=c(t),a(n),"function"==typeof e&&"prototype"===t&&"value"in n&&"writable"in n&&!n.writable){var r=u(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return d(e,t,n)}:d:function(e,t,n){if(a(e),t=c(t),a(n),o)try{return d(e,t,n)}catch(r){}if("get"in n||"set"in n)throw l("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},6683:function(e,t,n){var r=n(8494),i=n(8262),o=n(112),s=n(4677),a=n(2977),c=n(8734),l=n(2870),d=n(275),u=Object.getOwnPropertyDescriptor;t.f=r?u:function(e,t){if(e=a(e),t=c(t),d)try{return u(e,t)}catch(n){}if(l(e,t))return s(!i(o.f,e,t),e[t])}},3130:function(e,t,n){var r=n(9624),i=n(2977),o=n(9275).f,s=n(4546),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"==r(e)?function(e){try{return o(e)}catch(t){return s(a)}}(e):o(i(e))}},9275:function(e,t,n){var r=n(8356),i=n(5690).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},4012:function(e,t){t.f=Object.getOwnPropertySymbols},729:function(e,t,n){var r=n(7583),i=n(2870),o=n(9212),s=n(1324),a=n(9137),c=n(926),l=a("IE_PROTO"),d=r.Object,u=d.prototype;e.exports=c?d.getPrototypeOf:function(e){var t=s(e);if(i(t,l))return t[l];var n=t.constructor;return o(n)&&t instanceof n?n.prototype:t instanceof d?u:null}},2447:function(e,t,n){var r=n(7386);e.exports=r({}.isPrototypeOf)},8356:function(e,t,n){var r=n(7386),i=n(2870),o=n(2977),s=n(5766).indexOf,a=n(4639),c=r([].push);e.exports=function(e,t){var n,r=o(e),l=0,d=[];for(n in r)!i(a,n)&&i(r,n)&&c(d,n);for(;t.length>l;)i(r,n=t[l++])&&(~s(d,n)||c(d,n));return d}},5432:function(e,t,n){var r=n(8356),i=n(5690);e.exports=Object.keys||function(e){return r(e,i)}},112:function(e,t){var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},7496:function(e,t,n){var r=n(7386),i=n(2569),o=n(9882);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(s){}return function(n,r){return i(n),o(r),t?e(n,r):n.__proto__=r,n}}():void 0)},3060:function(e,t,n){var r=n(8191),i=n(3058);e.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}},6252:function(e,t,n){var r=n(7583),i=n(8262),o=n(9212),s=n(794),a=r.TypeError;e.exports=function(e,t){var n,r;if("string"===t&&o(n=e.toString)&&!s(r=i(n,e)))return r;if(o(n=e.valueOf)&&!s(r=i(n,e)))return r;if("string"!==t&&o(n=e.toString)&&!s(r=i(n,e)))return r;throw a("Can't convert object to primitive value")}},929:function(e,t,n){var r=n(5897),i=n(7386),o=n(9275),s=n(4012),a=n(2569),c=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(a(e)),n=s.f;return n?c(t,n(e)):t}},1287:function(e,t,n){var r=n(7583);e.exports=r},544:function(e){e.exports=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}}},5732:function(e,t,n){var r=n(2569),i=n(794),o=n(5084);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},2723:function(e){var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},e.exports=t},6893:function(e,t,n){var r=n(1270);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},1270:function(e,t,n){var r=n(7583),i=n(9212),o=n(2870),s=n(57),a=n(460),c=n(9734),l=n(2743),d=n(4340).CONFIGURABLE,u=l.get,p=l.enforce,h=String(String).split("String");(e.exports=function(e,t,n,c){var l,u=!!c&&!!c.unsafe,g=!!c&&!!c.enumerable,m=!!c&&!!c.noTargetGet,f=c&&void 0!==c.name?c.name:t;i(n)&&("Symbol("===String(f).slice(0,7)&&(f="["+String(f).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!o(n,"name")||d&&n.name!==f)&&s(n,"name",f),(l=p(n)).source||(l.source=h.join("string"==typeof f?f:""))),e!==r?(u?!m&&e[t]&&(g=!0):delete e[t],g?e[t]=n:s(e,t,n)):g?e[t]=n:a(t,n)})(Function.prototype,"toString",function(){return i(this)&&u(this).source||c(this)})},3955:function(e,t,n){var r=n(7583).TypeError;e.exports=function(e){if(null==e)throw r("Can't call method on "+e);return e}},460:function(e,t,n){var r=n(7583),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},7730:function(e,t,n){var r=n(5897),i=n(4615),o=n(3649),s=n(8494),a=o("species");e.exports=function(e){var t=r(e),n=i.f;s&&t&&!t[a]&&n(t,a,{configurable:!0,get:function(){return this}})}},8821:function(e,t,n){var r=n(4615).f,i=n(2870),o=n(3649)("toStringTag");e.exports=function(e,t,n){e&&!n&&(e=e.prototype),e&&!i(e,o)&&r(e,o,{configurable:!0,value:t})}},9137:function(e,t,n){var r=n(7836),i=n(8284),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},1314:function(e,t,n){var r=n(7583),i=n(460),o="__core-js_shared__",s=r[o]||i(o,{});e.exports=s},7836:function(e,t,n){var r=n(6268),i=n(1314);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.21.1",mode:r?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})},564:function(e,t,n){var r=n(2569),i=n(1186),o=n(3649)("species");e.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||null==(n=r(s)[o])?t:i(n)}},6389:function(e,t,n){var r=n(7386),i=n(7486),o=n(8320),s=n(3955),a=r("".charAt),c=r("".charCodeAt),l=r("".slice),d=function(e){return function(t,n){var r,d,u=o(s(t)),p=i(n),h=u.length;return p<0||p>=h?e?"":void 0:(r=c(u,p))<55296||r>56319||p+1===h||(d=c(u,p+1))<56320||d>57343?e?a(u,p):r:e?l(u,p,p+2):d-56320+(r-55296<<10)+65536}};e.exports={codeAt:d(!1),charAt:d(!0)}},8117:function(e,t,n){var r,i,o,s,a=n(7583),c=n(1611),l=n(2938),d=n(9212),u=n(2870),p=n(6544),h=n(482),g=n(6917),m=n(6668),f=n(7520),v=n(7020),y=n(5354),_=a.setImmediate,I=a.clearImmediate,T=a.process,S=a.Dispatch,E=a.Function,M=a.MessageChannel,b=a.String,C=0,A={};try{r=a.location}catch(P){}var O=function(e){if(u(A,e)){var t=A[e];delete A[e],t()}},R=function(e){return function(){O(e)}},N=function(e){O(e.data)},w=function(e){a.postMessage(b(e),r.protocol+"//"+r.host)};_&&I||(_=function(e){f(arguments.length,1);var t=d(e)?e:E(e),n=g(arguments,1);return A[++C]=function(){c(t,void 0,n)},i(C),C},I=function(e){delete A[e]},y?i=function(e){T.nextTick(R(e))}:S&&S.now?i=function(e){S.now(R(e))}:M&&!v?(s=(o=new M).port2,o.port1.onmessage=N,i=l(s.postMessage,s)):a.addEventListener&&d(a.postMessage)&&!a.importScripts&&r&&"file:"!==r.protocol&&!p(w)?(i=w,a.addEventListener("message",N,!1)):i="onreadystatechange"in m("script")?function(e){h.appendChild(m("script")).onreadystatechange=function(){h.removeChild(this),O(e)}}:function(e){setTimeout(R(e),0)}),e.exports={set:_,clear:I}},6782:function(e,t,n){var r=n(7486),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},2977:function(e,t,n){var r=n(5044),i=n(3955);e.exports=function(e){return r(i(e))}},7486:function(e){var t=Math.ceil,n=Math.floor;e.exports=function(e){var r=+e;return r!=r||0===r?0:(r>0?n:t)(r)}},97:function(e,t,n){var r=n(7486),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},1324:function(e,t,n){var r=n(7583),i=n(3955),o=r.Object;e.exports=function(e){return o(i(e))}},2670:function(e,t,n){var r=n(7583),i=n(8262),o=n(794),s=n(5871),a=n(911),c=n(6252),l=n(3649),d=r.TypeError,u=l("toPrimitive");e.exports=function(e,t){if(!o(e)||s(e))return e;var n,r=a(e,u);if(r){if(void 0===t&&(t="default"),n=i(r,e,t),!o(n)||s(n))return n;throw d("Can't convert object to primitive value")}return void 0===t&&(t="number"),c(e,t)}},8734:function(e,t,n){var r=n(2670),i=n(5871);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},8191:function(e,t,n){var r={};r[n(3649)("toStringTag")]="z",e.exports="[object z]"===String(r)},8320:function(e,t,n){var r=n(7583),i=n(3058),o=r.String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},5637:function(e,t,n){var r=n(7583).String;e.exports=function(e){try{return r(e)}catch(t){return"Object"}}},8284:function(e,t,n){var r=n(7386),i=0,o=Math.random(),s=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++i+o,36)}},7786:function(e,t,n){var r=n(8640);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7670:function(e,t,n){var r=n(8494),i=n(6544);e.exports=r&&i(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},7520:function(e,t,n){var r=n(7583).TypeError;e.exports=function(e,t){if(e<t)throw r("Not enough arguments");return e}},491:function(e,t,n){var r=n(3649);t.f=r},3649:function(e,t,n){var r=n(7583),i=n(7836),o=n(2870),s=n(8284),a=n(8640),c=n(7786),l=i("wks"),d=r.Symbol,u=d&&d.for,p=c?d:d&&d.withoutSetter||s;e.exports=function(e){if(!o(l,e)||!a&&"string"!=typeof l[e]){var t="Symbol."+e;a&&o(d,e)?l[e]=d[e]:l[e]=c&&u?u(t):p(t)}return l[e]}},1719:function(e,t,n){var r=n(7263),i=n(7583),o=n(2447),s=n(729),a=n(7496),c=n(3478),l=n(3590),d=n(57),u=n(4677),p=n(1509),h=n(4402),g=n(4026),m=n(2764),f=n(3649),v=n(1178),y=f("toStringTag"),_=i.Error,I=[].push,T=function(e,t){var n,r=arguments.length>2?arguments[2]:void 0,i=o(S,this);a?n=a(new _,i?s(this):S):(n=i?this:l(S),d(n,y,"Error")),void 0!==t&&d(n,"message",m(t)),v&&d(n,"stack",p(n.stack,1)),h(n,r);var c=[];return g(e,I,{that:c}),d(n,"errors",c),n};a?a(T,_):c(T,_,{name:!0});var S=T.prototype=l(_.prototype,{constructor:u(1,T),message:u(1,""),name:u(1,"AggregateError")});r({global:!0},{AggregateError:T})},1646:function(e,t,n){var r=n(7263),i=n(7583),o=n(6544),s=n(4521),a=n(794),c=n(1324),l=n(1825),d=n(5999),u=n(4822),p=n(9269),h=n(3649),g=n(4061),m=h("isConcatSpreadable"),f=9007199254740991,v="Maximum allowed index exceeded",y=i.TypeError,_=g>=51||!o(function(){var e=[];return e[m]=!1,e.concat()[0]!==e}),I=p("concat"),T=function(e){if(!a(e))return!1;var t=e[m];return void 0!==t?!!t:s(e)};r({target:"Array",proto:!0,forced:!_||!I},{concat:function(e){var t,n,r,i,o,s=c(this),a=u(s,0),p=0;for(t=-1,r=arguments.length;t<r;t++)if(T(o=-1===t?s:arguments[t])){if(p+(i=l(o))>f)throw y(v);for(n=0;n<i;n++,p++)n in o&&d(a,p,o[n])}else{if(p>=f)throw y(v);d(a,p++,o)}return a.length=p,a}})},5677:function(e,t,n){var r=n(2977),i=n(6288),o=n(339),s=n(2743),a=n(4615).f,c=n(9012),l=n(6268),d=n(8494),u="Array Iterator",p=s.set,h=s.getterFor(u);e.exports=c(Array,"Array",function(e,t){p(this,{type:u,target:r(e),index:0,kind:t})},function(){var e=h(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");var g=o.Arguments=o.Array;if(i("keys"),i("values"),i("entries"),!l&&d&&"values"!==g.name)try{a(g,"name",{value:"values"})}catch(m){}},6956:function(e,t,n){var r=n(7583);n(8821)(r.JSON,"JSON",!0)},5222:function(e,t,n){n(8821)(Math,"Math",!0)},6394:function(e,t,n){var r=n(8191),i=n(1270),o=n(3060);r||i(Object.prototype,"toString",o,{unsafe:!0})},6969:function(e,t,n){var r=n(7263),i=n(8262),o=n(8257),s=n(5084),a=n(544),c=n(4026);r({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=s.f(t),r=n.resolve,l=n.reject,d=a(function(){var n=o(t.resolve),s=[],a=0,l=1;c(e,function(e){var o=a++,c=!1;l++,i(n,t,e).then(function(e){c||(c=!0,s[o]={status:"fulfilled",value:e},--l||r(s))},function(e){c||(c=!0,s[o]={status:"rejected",reason:e},--l||r(s))})}),--l||r(s)});return d.error&&l(d.value),n.promise}})},2021:function(e,t,n){var r=n(7263),i=n(8257),o=n(5897),s=n(8262),a=n(5084),c=n(544),l=n(4026),d="No one promise resolved";r({target:"Promise",stat:!0},{any:function(e){var t=this,n=o("AggregateError"),r=a.f(t),u=r.resolve,p=r.reject,h=c(function(){var r=i(t.resolve),o=[],a=0,c=1,h=!1;l(e,function(e){var i=a++,l=!1;c++,s(r,t,e).then(function(e){l||h||(h=!0,u(e))},function(e){l||h||(l=!0,o[i]=e,--c||p(new n(o,d)))})}),--c||p(new n(o,d))});return h.error&&p(h.value),r.promise}})},8328:function(e,t,n){var r=n(7263),i=n(6268),o=n(783),s=n(6544),a=n(5897),c=n(9212),l=n(564),d=n(5732),u=n(1270);if(r({target:"Promise",proto:!0,real:!0,forced:!!o&&s(function(){o.prototype.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=l(this,a("Promise")),n=c(e);return this.then(n?function(n){return d(t,e()).then(function(){return n})}:e,n?function(n){return d(t,e()).then(function(){throw n})}:e)}}),!i&&c(o)){var p=a("Promise").prototype.finally;o.prototype.finally!==p&&u(o.prototype,"finally",p,{unsafe:!0})}},5334:function(e,t,n){var r,i,o,s,a=n(7263),c=n(6268),l=n(7583),d=n(5897),u=n(8262),p=n(783),h=n(1270),g=n(6893),m=n(7496),f=n(8821),v=n(7730),y=n(8257),_=n(9212),I=n(794),T=n(4761),S=n(9734),E=n(4026),M=n(3616),b=n(564),C=n(8117).set,A=n(2095),O=n(5732),R=n(2716),N=n(5084),w=n(544),P=n(2723),k=n(2743),L=n(4451),x=n(3649),V=n(2274),D=n(5354),U=n(4061),$=x("species"),B="Promise",F=k.getterFor(B),j=k.set,q=k.getterFor(B),G=p&&p.prototype,H=p,W=G,z=l.TypeError,K=l.document,Y=l.process,J=N.f,X=J,Q=!!(K&&K.createEvent&&l.dispatchEvent),Z=_(l.PromiseRejectionEvent),ee="unhandledrejection",te=!1,ne=L(B,function(){var e=S(H),t=e!==String(H);if(!t&&66===U)return!0;if(c&&!W.finally)return!0;if(U>=51&&/native code/.test(e))return!1;var n=new H(function(e){e(1)}),r=function(e){e(function(){},function(){})};return(n.constructor={})[$]=r,!(te=n.then(function(){})instanceof r)||!t&&V&&!Z}),re=ne||!M(function(e){H.all(e).catch(function(){})}),ie=function(e){var t;return!(!I(e)||!_(t=e.then))&&t},oe=function(e,t){var n,r,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,l=e.reject,d=e.domain;try{a?(s||(2===t.rejection&&de(t),t.rejection=1),!0===a?n=o:(d&&d.enter(),n=a(o),d&&(d.exit(),i=!0)),n===e.promise?l(z("Promise-chain cycle")):(r=ie(n))?u(r,n,c,l):c(n)):l(o)}catch(p){d&&!i&&d.exit(),l(p)}},se=function(e,t){e.notified||(e.notified=!0,A(function(){for(var n,r=e.reactions;n=r.get();)oe(n,e);e.notified=!1,t&&!e.rejection&&ce(e)}))},ae=function(e,t,n){var r,i;Q?((r=K.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),l.dispatchEvent(r)):r={promise:t,reason:n},!Z&&(i=l["on"+e])?i(r):e===ee&&R("Unhandled promise rejection",n)},ce=function(e){u(C,l,function(){var t,n=e.facade,r=e.value;if(le(e)&&(t=w(function(){D?Y.emit("unhandledRejection",r,n):ae(ee,n,r)}),e.rejection=D||le(e)?2:1,t.error))throw t.value})},le=function(e){return 1!==e.rejection&&!e.parent},de=function(e){u(C,l,function(){var t=e.facade;D?Y.emit("rejectionHandled",t):ae("rejectionhandled",t,e.value)})},ue=function(e,t,n){return function(r){e(t,r,n)}},pe=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,se(e,!0))},he=function e(t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===n)throw z("Promise can't be resolved itself");var i=ie(n);i?A(function(){var r={done:!1};try{u(i,n,ue(e,r,t),ue(pe,r,t))}catch(o){pe(r,o,t)}}):(t.value=n,t.state=1,se(t,!1))}catch(o){pe({done:!1},o,t)}}};if(ne&&(W=(H=function(e){T(this,W),y(e),u(r,this);var t=F(this);try{e(ue(he,t),ue(pe,t))}catch(n){pe(t,n)}}).prototype,(r=function(e){j(this,{type:B,done:!1,notified:!1,parent:!1,reactions:new P,rejection:!1,state:0,value:void 0})}).prototype=g(W,{then:function(e,t){var n=q(this),r=J(b(this,H));return n.parent=!0,r.ok=!_(e)||e,r.fail=_(t)&&t,r.domain=D?Y.domain:void 0,0==n.state?n.reactions.add(r):A(function(){oe(r,n)}),r.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new r,t=F(e);this.promise=e,this.resolve=ue(he,t),this.reject=ue(pe,t)},N.f=J=function(e){return e===H||e===o?new i(e):X(e)},!c&&_(p)&&G!==Object.prototype)){s=G.then,te||(h(G,"then",function(e,t){var n=this;return new H(function(e,t){u(s,n,e,t)}).then(e,t)},{unsafe:!0}),h(G,"catch",W.catch,{unsafe:!0}));try{delete G.constructor}catch(ge){}m&&m(G,W)}a({global:!0,wrap:!0,forced:ne},{Promise:H}),f(H,B,!1,!0),v(B),o=d(B),a({target:B,stat:!0,forced:ne},{reject:function(e){var t=J(this);return u(t.reject,void 0,e),t.promise}}),a({target:B,stat:!0,forced:c||ne},{resolve:function(e){return O(c&&this===o?H:this,e)}}),a({target:B,stat:!0,forced:re},{all:function(e){var t=this,n=J(t),r=n.resolve,i=n.reject,o=w(function(){var n=y(t.resolve),o=[],s=0,a=1;E(e,function(e){var c=s++,l=!1;a++,u(n,t,e).then(function(e){l||(l=!0,o[c]=e,--a||r(o))},i)}),--a||r(o)});return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=J(t),r=n.reject,i=w(function(){var i=y(t.resolve);E(e,function(e){u(i,t,e).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}})},2257:function(e,t,n){var r=n(7263),i=n(7583),o=n(8821);r({global:!0},{Reflect:{}}),o(i.Reflect,"Reflect",!0)},2129:function(e,t,n){var r=n(6389).charAt,i=n(8320),o=n(2743),s=n(9012),a="String Iterator",c=o.set,l=o.getterFor(a);s(String,"String",function(e){c(this,{type:a,string:i(e),index:0})},function(){var e,t=l(this),n=t.string,i=t.index;return i>=n.length?{value:void 0,done:!0}:(e=r(n,i),t.index+=e.length,{value:e,done:!1})})},462:function(e,t,n){n(2219)("asyncIterator")},8407:function(e,t,n){var r=n(7263),i=n(8494),o=n(7583),s=n(7386),a=n(2870),c=n(9212),l=n(2447),d=n(8320),u=n(4615).f,p=n(3478),h=o.Symbol,g=h&&h.prototype;if(i&&c(h)&&(!("description"in g)||void 0!==h().description)){var m={},f=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:d(arguments[0]),t=l(g,this)?new h(e):void 0===e?h():h(e);return""===e&&(m[t]=!0),t};p(f,h),f.prototype=g,g.constructor=f;var v="Symbol(test)"==String(h("test")),y=s(g.toString),_=s(g.valueOf),I=/^Symbol\((.*)\)[^)]+$/,T=s("".replace),S=s("".slice);u(g,"description",{configurable:!0,get:function(){var e=_(this),t=y(e);if(a(m,e))return"";var n=v?S(t,7,-1):T(t,I,"$1");return""===n?void 0:n}}),r({global:!0,forced:!0},{Symbol:f})}},2429:function(e,t,n){n(2219)("hasInstance")},1172:function(e,t,n){n(2219)("isConcatSpreadable")},8288:function(e,t,n){n(2219)("iterator")},2004:function(e,t,n){var r=n(7263),i=n(7583),o=n(5897),s=n(1611),a=n(8262),c=n(7386),l=n(6268),d=n(8494),u=n(8640),p=n(6544),h=n(2870),g=n(4521),m=n(9212),f=n(794),v=n(2447),y=n(5871),_=n(2569),I=n(1324),T=n(2977),S=n(8734),E=n(8320),M=n(4677),b=n(3590),C=n(5432),A=n(9275),O=n(3130),R=n(4012),N=n(6683),w=n(4615),P=n(8728),k=n(112),L=n(6917),x=n(1270),V=n(7836),D=n(9137),U=n(4639),$=n(8284),B=n(3649),F=n(491),j=n(2219),q=n(8821),G=n(2743),H=n(4805).forEach,W=D("hidden"),z="Symbol",K=B("toPrimitive"),Y=G.set,J=G.getterFor(z),X=Object.prototype,Q=i.Symbol,Z=Q&&Q.prototype,ee=i.TypeError,te=i.QObject,ne=o("JSON","stringify"),re=N.f,ie=w.f,oe=O.f,se=k.f,ae=c([].push),ce=V("symbols"),le=V("op-symbols"),de=V("string-to-symbol-registry"),ue=V("symbol-to-string-registry"),pe=V("wks"),he=!te||!te.prototype||!te.prototype.findChild,ge=d&&p(function(){return 7!=b(ie({},"a",{get:function(){return ie(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=re(X,t);r&&delete X[t],ie(e,t,n),r&&e!==X&&ie(X,t,r)}:ie,me=function(e,t){var n=ce[e]=b(Z);return Y(n,{type:z,tag:e,description:t}),d||(n.description=t),n},fe=function(e,t,n){e===X&&fe(le,t,n),_(e);var r=S(t);return _(n),h(ce,r)?(n.enumerable?(h(e,W)&&e[W][r]&&(e[W][r]=!1),n=b(n,{enumerable:M(0,!1)})):(h(e,W)||ie(e,W,M(1,{})),e[W][r]=!0),ge(e,r,n)):ie(e,r,n)},ve=function(e,t){_(e);var n=T(t),r=C(n).concat(Te(n));return H(r,function(t){d&&!a(ye,n,t)||fe(e,t,n[t])}),e},ye=function(e){var t=S(e),n=a(se,this,t);return!(this===X&&h(ce,t)&&!h(le,t))&&(!(n||!h(this,t)||!h(ce,t)||h(this,W)&&this[W][t])||n)},_e=function(e,t){var n=T(e),r=S(t);if(n!==X||!h(ce,r)||h(le,r)){var i=re(n,r);return!i||!h(ce,r)||h(n,W)&&n[W][r]||(i.enumerable=!0),i}},Ie=function(e){var t=oe(T(e)),n=[];return H(t,function(e){h(ce,e)||h(U,e)||ae(n,e)}),n},Te=function(e){var t=e===X,n=oe(t?le:T(e)),r=[];return H(n,function(e){!h(ce,e)||t&&!h(X,e)||ae(r,ce[e])}),r};if(u||(Q=function(){if(v(Z,this))throw ee("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?E(arguments[0]):void 0,t=$(e);return d&&he&&ge(X,t,{configurable:!0,set:function e(n){this===X&&a(e,le,n),h(this,W)&&h(this[W],t)&&(this[W][t]=!1),ge(this,t,M(1,n))}}),me(t,e)},x(Z=Q.prototype,"toString",function(){return J(this).tag}),x(Q,"withoutSetter",function(e){return me($(e),e)}),k.f=ye,w.f=fe,P.f=ve,N.f=_e,A.f=O.f=Ie,R.f=Te,F.f=function(e){return me(B(e),e)},d&&(ie(Z,"description",{configurable:!0,get:function(){return J(this).description}}),l||x(X,"propertyIsEnumerable",ye,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!u,sham:!u},{Symbol:Q}),H(C(pe),function(e){j(e)}),r({target:z,stat:!0,forced:!u},{for:function(e){var t=E(e);if(h(de,t))return de[t];var n=Q(t);return de[t]=n,ue[n]=t,n},keyFor:function(e){if(!y(e))throw ee(e+" is not a symbol");if(h(ue,e))return ue[e]},useSetter:function(){he=!0},useSimple:function(){he=!1}}),r({target:"Object",stat:!0,forced:!u,sham:!d},{create:function(e,t){return void 0===t?b(e):ve(b(e),t)},defineProperty:fe,defineProperties:ve,getOwnPropertyDescriptor:_e}),r({target:"Object",stat:!0,forced:!u},{getOwnPropertyNames:Ie,getOwnPropertySymbols:Te}),r({target:"Object",stat:!0,forced:p(function(){R.f(1)})},{getOwnPropertySymbols:function(e){return R.f(I(e))}}),ne&&r({target:"JSON",stat:!0,forced:!u||p(function(){var e=Q();return"[null]"!=ne([e])||"{}"!=ne({a:e})||"{}"!=ne(Object(e))})},{stringify:function(e,t,n){var r=L(arguments),i=t;if((f(t)||void 0!==e)&&!y(e))return g(t)||(t=function(e,t){if(m(i)&&(t=a(i,this,e,t)),!y(t))return t}),r[1]=t,s(ne,null,r)}}),!Z[K]){var Se=Z.valueOf;x(Z,K,function(e){return a(Se,this)})}q(Q,z),U[W]=!0},8201:function(e,t,n){n(2219)("matchAll")},1274:function(e,t,n){n(2219)("match")},6626:function(e,t,n){n(2219)("replace")},3211:function(e,t,n){n(2219)("search")},9952:function(e,t,n){n(2219)("species")},15:function(e,t,n){n(2219)("split")},9831:function(e,t,n){n(2219)("toPrimitive")},7521:function(e,t,n){n(2219)("toStringTag")},2972:function(e,t,n){n(2219)("unscopables")},4655:function(e,t,n){var r=n(7583),i=n(6778),o=n(9307),s=n(5677),a=n(57),c=n(3649),l=c("iterator"),d=c("toStringTag"),u=s.values,p=function(e,t){if(e){if(e[l]!==u)try{a(e,l,u)}catch(r){e[l]=u}if(e[d]||a(e,d,t),i[t])for(var n in s)if(e[n]!==s[n])try{a(e,n,s[n])}catch(r){e[n]=s[n]}}};for(var h in i)p(r[h]&&r[h].prototype,h);p(o,"DOMTokenList")},8765:function(e,t,n){var r=n(5036);n(4655),e.exports=r},5441:function(e,t,n){var r=n(2582);n(4655),e.exports=r},7705:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,r,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(s[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);r&&s[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},6738:function(e){e.exports=function(e){return e[1]}},8679:function(e){var t=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,n=window.WeakMap;if(void 0===n){var r=Object.defineProperty,i=Date.now()%1e9;(n=function(){this.name="__st"+(1e9*Math.random()>>>0)+i+++"__"}).prototype={set:function(e,t){var n=e[this.name];return n&&n[0]===e?n[1]=t:r(e,this.name,{value:[e,t],writable:!0}),this},get:function(e){var t;return(t=e[this.name])&&t[0]===e?t[1]:void 0},delete:function(e){var t=e[this.name];if(!t)return!1;var n=t[0]===e;return t[0]=t[1]=void 0,n},has:function(e){var t=e[this.name];return!!t&&t[0]===e}}}var o=new n,s=window.msSetImmediate;if(!s){var a=[],c=String(Math.random());window.addEventListener("message",function(e){if(e.data===c){var t=a;a=[],t.forEach(function(e){e()})}}),s=function(e){a.push(e),window.postMessage(c,"*")}}var l=!1,d=[];function u(){l=!1;var e=d;d=[],e.sort(function(e,t){return e.uid_-t.uid_});var t=!1;e.forEach(function(e){var n,r=e.takeRecords();(n=e).nodes_.forEach(function(e){var t=o.get(e);t&&t.forEach(function(e){e.observer===n&&e.removeTransientObservers()})}),r.length&&(e.callback_(r,e),t=!0)}),t&&u()}function p(e,t){for(var n=e;n;n=n.parentNode){var r=o.get(n);if(r)for(var i=0;i<r.length;i++){var s=r[i],a=s.options;if(n===e||a.subtree){var c=t(a);c&&s.enqueue(c)}}}}var h,g,m=0;function f(e){this.callback_=e,this.nodes_=[],this.records_=[],this.uid_=++m}function v(e,t){this.type=e,this.target=t,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function y(e,t){return h=new v(e,t)}function _(e){return g||((n=new v((t=h).type,t.target)).addedNodes=t.addedNodes.slice(),n.removedNodes=t.removedNodes.slice(),n.previousSibling=t.previousSibling,n.nextSibling=t.nextSibling,n.attributeName=t.attributeName,n.attributeNamespace=t.attributeNamespace,n.oldValue=t.oldValue,(g=n).oldValue=e,g);var t,n}function I(e,t,n){this.observer=e,this.target=t,this.options=n,this.transientObservedNodes=[]}f.prototype={observe:function(e,t){var n;if(n=e,e=window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(n)||n,!t.childList&&!t.attributes&&!t.characterData||t.attributeOldValue&&!t.attributes||t.attributeFilter&&t.attributeFilter.length&&!t.attributes||t.characterDataOldValue&&!t.characterData)throw new SyntaxError;var r,i=o.get(e);i||o.set(e,i=[]);for(var s=0;s<i.length;s++)if(i[s].observer===this){(r=i[s]).removeListeners(),r.options=t;break}r||(r=new I(this,e,t),i.push(r),this.nodes_.push(e)),r.addListeners()},disconnect:function(){this.nodes_.forEach(function(e){for(var t=o.get(e),n=0;n<t.length;n++){var r=t[n];if(r.observer===this){r.removeListeners(),t.splice(n,1);break}}},this),this.records_=[]},takeRecords:function(){var e=this.records_;return this.records_=[],e}},I.prototype={enqueue:function(e){var t,n=this.observer.records_,r=n.length;if(n.length>0){var i=function(e,t){return e===t?e:!g||(n=e)!==g&&n!==h?null:g;var n}(n[r-1],e);if(i)return void(n[r-1]=i)}else t=this.observer,d.push(t),l||(l=!0,s(u));n[r]=e},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(e){var t=this.options;t.attributes&&e.addEventListener("DOMAttrModified",this,!0),t.characterData&&e.addEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.addEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(e){var t=this.options;t.attributes&&e.removeEventListener("DOMAttrModified",this,!0),t.characterData&&e.removeEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.removeEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(e){if(e!==this.target){this.addListeners_(e),this.transientObservedNodes.push(e);var t=o.get(e);t||o.set(e,t=[]),t.push(this)}},removeTransientObservers:function(){var e=this.transientObservedNodes;this.transientObservedNodes=[],e.forEach(function(e){this.removeListeners_(e);for(var t=o.get(e),n=0;n<t.length;n++)if(t[n]===this){t.splice(n,1);break}},this)},handleEvent:function(e){switch(e.stopImmediatePropagation(),e.type){case"DOMAttrModified":var t=e.attrName,n=e.relatedNode.namespaceURI,r=e.target;(o=new y("attributes",r)).attributeName=t,o.attributeNamespace=n;var i=null;"undefined"!=typeof MutationEvent&&e.attrChange===MutationEvent.ADDITION||(i=e.prevValue),p(r,function(e){if(e.attributes&&(!e.attributeFilter||!e.attributeFilter.length||-1!==e.attributeFilter.indexOf(t)||-1!==e.attributeFilter.indexOf(n)))return e.attributeOldValue?_(i):o});break;case"DOMCharacterDataModified":var o=y("characterData",r=e.target);i=e.prevValue,p(r,function(e){if(e.characterData)return e.characterDataOldValue?_(i):o});break;case"DOMNodeRemoved":this.addTransientObserver(e.target);case"DOMNodeInserted":r=e.relatedNode;var s,a,c=e.target;"DOMNodeInserted"===e.type?(s=[c],a=[]):(s=[],a=[c]);var l=c.previousSibling,d=c.nextSibling;(o=y("childList",r)).addedNodes=s,o.removedNodes=a,o.previousSibling=l,o.nextSibling=d,p(r,function(e){if(e.childList)return o})}h=g=void 0}},t||(t=f),e.exports=t},7588:function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(w){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof f?t:f,o=Object.create(i.prototype),s=new O(r||[]);return o._invoke=function(e,t,n){var r=u;return function(i,o){if(r===h)throw new Error("Generator is already running");if(r===g){if("throw"===i)throw o;return N()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=b(s,n);if(a){if(a===m)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===u)throw r=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var c=d(e,t,n);if("normal"===c.type){if(r=n.done?g:p,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=g,n.method="throw",n.arg=c.arg)}}}(e,n,s),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}e.wrap=l;var u="suspendedStart",p="suspendedYield",h="executing",g="completed",m={};function f(){}function v(){}function y(){}var _={};c(_,o,function(){return this});var I=Object.getPrototypeOf,T=I&&I(I(R([])));T&&T!==n&&r.call(T,o)&&(_=T);var S=y.prototype=f.prototype=Object.create(_);function E(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function M(e,t){function n(i,o,s,a){var c=d(e[i],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then(function(e){n("next",e,s,a)},function(e){n("throw",e,s,a)}):t.resolve(u).then(function(e){l.value=e,s(l)},function(e){return n("throw",e,s,a)})}a(c.arg)}var i;this._invoke=function(e,r){function o(){return new t(function(t,i){n(e,r,t,i)})}return i=i?i.then(o,o):o()}}function b(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,b(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=d(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function R(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}return{next:N}}function N(){return{value:t,done:!0}}return v.prototype=y,c(S,"constructor",y),c(y,"constructor",v),v.displayName=c(y,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,a,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},E(M.prototype),c(M.prototype,s,function(){return this}),e.AsyncIterator=M,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new M(l(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})},E(S),c(S,a,"Generator"),c(S,o,function(){return this}),c(S,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=R,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),l=r.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:R(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(n){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},8702:function(e,t,n){n.d(t,{Z:function(){return x}});var r=n(4296),i=n(6464),o=n(6881),s=n(2942),a=n(7003),c=n(3379),l=n.n(c),d=n(7795),u=n.n(d),p=n(569),h=n.n(p),g=n(3565),m=n.n(g),f=n(9216),v=n.n(f),y=n(4589),_=n.n(y),I=n(5313),T={};I.Z&&I.Z.locals&&(T.locals=I.Z.locals);var S,E=0,M={};M.styleTagTransform=_(),M.setAttributes=m(),M.insert=h().bind(null,"head"),M.domAPI=u(),M.insertStyleElement=v(),T.use=function(e){return M.options=e||{},E++||(S=l()(I.Z,M)),T},T.unuse=function(){E>0&&! --E&&(S(),S=null)};var b=T;function C(e){var t,n;return{c:function(){t=(0,s.bi5)("svg"),n=(0,s.bi5)("path"),(0,s.Ljt)(n,"d","M599.99999 832.000004h47.999999a24 24 0 0 0 23.999999-24V376.000013a24 24 0 0 0-23.999999-24h-47.999999a24 24 0 0 0-24 24v431.999991a24 24 0 0 0 24 24zM927.999983 160.000017h-164.819997l-67.999998-113.399998A95.999998 95.999998 0 0 0 612.819989 0.00002H411.179993a95.999998 95.999998 0 0 0-82.319998 46.599999L260.819996 160.000017H95.999999A31.999999 31.999999 0 0 0 64 192.000016v32a31.999999 31.999999 0 0 0 31.999999 31.999999h32v671.999987a95.999998 95.999998 0 0 0 95.999998 95.999998h575.999989a95.999998 95.999998 0 0 0 95.999998-95.999998V256.000015h31.999999a31.999999 31.999999 0 0 0 32-31.999999V192.000016a31.999999 31.999999 0 0 0-32-31.999999zM407.679993 101.820018A12 12 0 0 1 417.999993 96.000018h187.999996a12 12 0 0 1 10.3 5.82L651.219989 160.000017H372.779994zM799.999986 928.000002H223.999997V256.000015h575.999989z m-423.999992-95.999998h47.999999a24 24 0 0 0 24-24V376.000013a24 24 0 0 0-24-24h-47.999999a24 24 0 0 0-24 24v431.999991a24 24 0 0 0 24 24z"),(0,s.Ljt)(t,"class","vc-icon-delete"),(0,s.Ljt)(t,"viewBox","0 0 1024 1024"),(0,s.Ljt)(t,"width","200"),(0,s.Ljt)(t,"height","200")},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n)},d:function(e){e&&(0,s.ogt)(t)}}}function A(e){var t,n,r;return{c:function(){t=(0,s.bi5)("svg"),n=(0,s.bi5)("path"),r=(0,s.bi5)("path"),(0,s.Ljt)(n,"d","M874.154197 150.116875A511.970373 511.970373 0 1 0 1023.993986 511.991687a511.927744 511.927744 0 0 0-149.839789-361.874812z m-75.324866 648.382129A405.398688 405.398688 0 1 1 917.422301 511.991687a405.313431 405.313431 0 0 1-118.59297 286.507317z"),(0,s.Ljt)(r,"d","M725.039096 299.274605a54.351559 54.351559 0 0 0-76.731613 0l-135.431297 135.431297L377.274375 299.274605a54.436817 54.436817 0 0 0-76.944756 76.987385l135.388668 135.431297-135.388668 135.473925a54.436817 54.436817 0 0 0 76.944756 76.987385l135.388668-135.431297 135.431297 135.473926a54.436817 54.436817 0 0 0 76.731613-76.987385l-135.388668-135.473926 135.388668-135.431296a54.479445 54.479445 0 0 0 0.213143-77.030014z"),(0,s.Ljt)(t,"viewBox","0 0 1024 1024"),(0,s.Ljt)(t,"width","200"),(0,s.Ljt)(t,"height","200")},m:function(e,i){(0,s.$Tr)(e,t,i),(0,s.R3I)(t,n),(0,s.R3I)(t,r)},d:function(e){e&&(0,s.ogt)(t)}}}function O(e){var t,n;return{c:function(){t=(0,s.bi5)("svg"),n=(0,s.bi5)("path"),(0,s.Ljt)(n,"fill-rule","evenodd"),(0,s.Ljt)(n,"d","M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"),(0,s.Ljt)(t,"class","vc-icon-copy"),(0,s.Ljt)(t,"viewBox","0 0 16 16")},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n)},d:function(e){e&&(0,s.ogt)(t)}}}function R(e){var t,n;return{c:function(){t=(0,s.bi5)("svg"),n=(0,s.bi5)("path"),(0,s.Ljt)(n,"fill-rule","evenodd"),(0,s.Ljt)(n,"d","M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"),(0,s.Ljt)(t,"class","vc-icon-suc"),(0,s.Ljt)(t,"viewBox","0 0 16 16")},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n)},d:function(e){e&&(0,s.ogt)(t)}}}function N(e){var t,n,r;return{c:function(){t=(0,s.bi5)("svg"),n=(0,s.bi5)("path"),r=(0,s.bi5)("path"),(0,s.Ljt)(n,"d","M776.533333 1024 162.133333 1024C72.533333 1024 0 951.466667 0 861.866667L0 247.466667C0 157.866667 72.533333 85.333333 162.133333 85.333333L469.333333 85.333333c25.6 0 42.666667 17.066667 42.666667 42.666667s-17.066667 42.666667-42.666667 42.666667L162.133333 170.666667C119.466667 170.666667 85.333333 204.8 85.333333 247.466667l0 610.133333c0 42.666667 34.133333 76.8 76.8 76.8l610.133333 0c42.666667 0 76.8-34.133333 76.8-76.8L849.066667 554.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 307.2C938.666667 951.466667 866.133333 1024 776.533333 1024z"),(0,s.Ljt)(r,"d","M256 810.666667c-12.8 0-21.333333-4.266667-29.866667-12.8C217.6 789.333333 213.333333 772.266667 213.333333 759.466667l42.666667-213.333333c0-8.533333 4.266667-17.066667 12.8-21.333333l512-512c17.066667-17.066667 42.666667-17.066667 59.733333 0l170.666667 170.666667c17.066667 17.066667 17.066667 42.666667 0 59.733333l-512 512c-4.266667 4.266667-12.8 8.533333-21.333333 12.8l-213.333333 42.666667C260.266667 810.666667 260.266667 810.666667 256 810.666667zM337.066667 576l-25.6 136.533333 136.533333-25.6L921.6 213.333333 810.666667 102.4 337.066667 576z"),(0,s.Ljt)(t,"class","vc-icon-edit"),(0,s.Ljt)(t,"viewBox","0 0 1024 1024"),(0,s.Ljt)(t,"width","200"),(0,s.Ljt)(t,"height","200")},m:function(e,i){(0,s.$Tr)(e,t,i),(0,s.R3I)(t,n),(0,s.R3I)(t,r)},d:function(e){e&&(0,s.ogt)(t)}}}function w(e){var t,n;return{c:function(){t=(0,s.bi5)("svg"),n=(0,s.bi5)("path"),(0,s.Ljt)(n,"d","M581.338005 987.646578c-2.867097 4.095853-4.573702 8.669555-8.191705 12.287558a83.214071 83.214071 0 0 1-60.959939 24.029001 83.214071 83.214071 0 0 1-61.028203-24.029001c-3.618003-3.618003-5.324608-8.191705-8.123441-12.15103L24.370323 569.050448a83.418864 83.418864 0 0 1 117.892289-117.89229l369.923749 369.92375L1308.829682 24.438587A83.418864 83.418864 0 0 1 1426.721971 142.194348L581.338005 987.646578z"),(0,s.Ljt)(t,"class","vc-icon-don"),(0,s.Ljt)(t,"viewBox","0 0 1501 1024"),(0,s.Ljt)(t,"width","200"),(0,s.Ljt)(t,"height","200")},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n)},d:function(e){e&&(0,s.ogt)(t)}}}function P(e){var t,n;return{c:function(){t=(0,s.bi5)("svg"),n=(0,s.bi5)("path"),(0,s.Ljt)(n,"d","M894.976 574.464q0 78.848-29.696 148.48t-81.408 123.392-121.856 88.064-151.04 41.472q-5.12 1.024-9.216 1.536t-9.216 0.512l-177.152 0q-17.408 0-34.304-6.144t-30.208-16.896-22.016-25.088-8.704-29.696 8.192-29.696 21.504-24.576 29.696-16.384 33.792-6.144l158.72 1.024q54.272 0 102.4-19.968t83.968-53.76 56.32-79.36 20.48-97.792q0-49.152-18.432-92.16t-50.688-76.8-75.264-54.784-93.184-26.112q-2.048 0-2.56 0.512t-2.56 0.512l-162.816 0 0 80.896q0 17.408-13.824 25.6t-44.544-10.24q-8.192-5.12-26.112-17.92t-41.984-30.208-50.688-36.864l-51.2-38.912q-15.36-12.288-26.624-22.016t-11.264-24.064q0-12.288 12.8-25.6t29.184-26.624q18.432-15.36 44.032-35.84t50.688-39.936 45.056-35.328 28.16-22.016q24.576-17.408 39.936-7.168t16.384 30.72l0 81.92 162.816 0q5.12 0 10.752 1.024t10.752 2.048q79.872 8.192 149.504 41.984t121.344 87.552 80.896 123.392 29.184 147.456z"),(0,s.Ljt)(t,"class","vc-icon-cancel"),(0,s.Ljt)(t,"viewBox","0 0 1024 1024"),(0,s.Ljt)(t,"width","200"),(0,s.Ljt)(t,"height","200")},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n)},d:function(e){e&&(0,s.ogt)(t)}}}function k(e){var t,n,r,i,o,a,c,l,d,u="delete"===e[0]&&C(),p="clear"===e[0]&&A(),h="copy"===e[0]&&O(),g="success"===e[0]&&R(),m="edit"===e[0]&&N(),f="done"===e[0]&&w(),v="cancel"===e[0]&&P();return{c:function(){t=(0,s.bGB)("i"),u&&u.c(),n=(0,s.DhX)(),p&&p.c(),r=(0,s.DhX)(),h&&h.c(),i=(0,s.DhX)(),g&&g.c(),o=(0,s.DhX)(),m&&m.c(),a=(0,s.DhX)(),f&&f.c(),c=(0,s.DhX)(),v&&v.c(),(0,s.Ljt)(t,"class","vc-icon")},m:function(y,_){(0,s.$Tr)(y,t,_),u&&u.m(t,null),(0,s.R3I)(t,n),p&&p.m(t,null),(0,s.R3I)(t,r),h&&h.m(t,null),(0,s.R3I)(t,i),g&&g.m(t,null),(0,s.R3I)(t,o),m&&m.m(t,null),(0,s.R3I)(t,a),f&&f.m(t,null),(0,s.R3I)(t,c),v&&v.m(t,null),l||(d=(0,s.oLt)(t,"click",e[1]),l=!0)},p:function(e,s){s[0],"delete"===e[0]?u||((u=C()).c(),u.m(t,n)):u&&(u.d(1),u=null),"clear"===e[0]?p||((p=A()).c(),p.m(t,r)):p&&(p.d(1),p=null),"copy"===e[0]?h||((h=O()).c(),h.m(t,i)):h&&(h.d(1),h=null),"success"===e[0]?g||((g=R()).c(),g.m(t,o)):g&&(g.d(1),g=null),"edit"===e[0]?m||((m=N()).c(),m.m(t,a)):m&&(m.d(1),m=null),"done"===e[0]?f||((f=w()).c(),f.m(t,c)):f&&(f.d(1),f=null),"cancel"===e[0]?v||((v=P()).c(),v.m(t,null)):v&&(v.d(1),v=null)},i:s.ZTd,o:s.ZTd,d:function(e){e&&(0,s.ogt)(t),u&&u.d(),p&&p.d(),h&&h.d(),g&&g.d(),m&&m.d(),f&&f.d(),v&&v.d(),l=!1,d()}}}function L(e,t,n){var r=t.name;return(0,a.H3)(function(){b.use()}),(0,a.ev)(function(){b.unuse()}),e.$$set=function(e){"name"in e&&n(0,r=e.name)},[r,function(t){s.cKT.call(this,e,t)}]}var x=function(e){function t(t){var n;return n=e.call(this)||this,(0,s.S1n)((0,i.Z)(n),t,L,k,s.N8,{name:0}),n}return(0,o.Z)(t,e),(0,r.Z)(t,[{key:"name",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({name:e}),(0,s.yl1)()}}]),t}(s.f_C)},3903:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(6464),_babel_runtime_helpers_inheritsLoose__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(6881),svelte_internal__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2942),svelte__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7003),_component_icon_icon_svelte__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8702),_logTool__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(8665),_log_model__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5629),_logCommand_less__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3411);function get_each_context(e,t,n){var r=e.slice();return r[28]=t[n],r}function create_if_block_2(e){var t,n,r;return{c:function(){(t=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("li")).textContent="Close",(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(t,"class","vc-cmd-prompted-hide")},m:function(i,o){(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.$Tr)(i,t,o),n||(r=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(t,"click",e[5]),n=!0)},p:svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ZTd,d:function(e){e&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ogt)(t),n=!1,r()}}}function create_else_block(e){var t;return{c:function(){(t=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("li")).textContent="No Prompted"},m:function(e,n){(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.$Tr)(e,t,n)},p:svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ZTd,d:function(e){e&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ogt)(t)}}}function create_each_block(e){var t,n,r,i,o=e[28].text+"";function s(){return e[14](e[28])}return{c:function(){t=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("li"),n=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.fLW)(o)},m:function(e,o){(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.$Tr)(e,t,o),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(t,n),r||(i=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(t,"click",s),r=!0)},p:function(t,r){e=t,8&r&&o!==(o=e[28].text+"")&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.rTO)(n,o)},d:function(e){e&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ogt)(t),r=!1,i()}}}function create_if_block_1(e){var t,n,r,i,o;return n=new _component_icon_icon_svelte__WEBPACK_IMPORTED_MODULE_2__.Z({props:{name:"clear"}}),{c:function(){t=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("div"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.YCL)(n.$$.fragment),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(t,"class","vc-cmd-clear-btn")},m:function(s,a){(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.$Tr)(s,t,a),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.yef)(n,t,null),r=!0,i||(o=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(t,"click",(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.AT7)(e[17])),i=!0)},p:svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ZTd,i:function(e){r||((0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ui)(n.$$.fragment,e),r=!0)},o:function(e){(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.etI)(n.$$.fragment,e),r=!1},d:function(e){e&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ogt)(t),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.vpE)(n),i=!1,o()}}}function create_if_block(e){var t,n,r,i,o;return n=new _component_icon_icon_svelte__WEBPACK_IMPORTED_MODULE_2__.Z({props:{name:"clear"}}),{c:function(){t=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("div"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.YCL)(n.$$.fragment),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(t,"class","vc-cmd-clear-btn")},m:function(s,a){(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.$Tr)(s,t,a),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.yef)(n,t,null),r=!0,i||(o=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(t,"click",(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.AT7)(e[19])),i=!0)},p:svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ZTd,i:function(e){r||((0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ui)(n.$$.fragment,e),r=!0)},o:function(e){(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.etI)(n.$$.fragment,e),r=!1},d:function(e){e&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ogt)(t),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.vpE)(n),i=!1,o()}}}function create_fragment(e){for(var t,n,r,i,o,s,a,c,l,d,u,p,h,g,m,f,v,y,_,I,T,S=e[3].length>0&&create_if_block_2(e),E=e[3],M=[],b=0;b<E.length;b+=1)M[b]=create_each_block(get_each_context(e,E,b));var C=null;E.length||(C=create_else_block());var A=e[1].length>0&&create_if_block_1(e),O=e[4].length>0&&create_if_block(e);return{c:function(){t=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("form"),n=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("ul"),S&&S.c(),r=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.DhX)();for(var _=0;_<M.length;_+=1)M[_].c();C&&C.c(),i=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.DhX)(),o=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("div"),s=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("textarea"),a=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.DhX)(),A&&A.c(),c=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.DhX)(),(l=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("button")).textContent="OK",d=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.DhX)(),u=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("form"),p=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("ul"),h=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.DhX)(),g=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("div"),m=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("textarea"),f=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.DhX)(),O&&O.c(),v=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.DhX)(),(y=(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.bGB)("button")).textContent="Filter",(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(n,"class","vc-cmd-prompted"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(n,"style",e[2]),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(s,"class","vc-cmd-input"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(s,"placeholder","command..."),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(o,"class","vc-cmd-input-wrap"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(l,"class","vc-cmd-btn"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(l,"type","submit"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(t,"class","vc-cmd"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(p,"class","vc-cmd-prompted"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(m,"class","vc-cmd-input"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(m,"placeholder","filter..."),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(g,"class","vc-cmd-input-wrap"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(y,"class","vc-cmd-btn"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(y,"type","submit"),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(u,"class","vc-cmd vc-filter")},m:function(E,b){(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.$Tr)(E,t,b),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(t,n),S&&S.m(n,null),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(n,r);for(var R=0;R<M.length;R+=1)M[R].m(n,null);C&&C.m(n,null),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(t,i),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(t,o),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(o,s),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.BmG)(s,e[1]),e[16](s),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(o,a),A&&A.m(o,null),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(t,c),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(t,l),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.$Tr)(E,d,b),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.$Tr)(E,u,b),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(u,p),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(u,h),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(u,g),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(g,m),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.BmG)(m,e[4]),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(g,f),O&&O.m(g,null),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(u,v),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.R3I)(u,y),_=!0,I||(T=[(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(s,"input",e[15]),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(s,"keydown",e[10]),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(s,"keyup",e[11]),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(s,"focus",e[8]),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(s,"blur",e[9]),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(t,"submit",(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.AT7)(e[12])),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(m,"input",e[18]),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.oLt)(u,"submit",(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.AT7)(e[13]))],I=!0)},p:function(e,t){var i=t[0];if(e[3].length>0?S?S.p(e,i):((S=create_if_block_2(e)).c(),S.m(n,r)):S&&(S.d(1),S=null),136&i){var a;for(E=e[3],a=0;a<E.length;a+=1){var c=get_each_context(e,E,a);M[a]?M[a].p(c,i):(M[a]=create_each_block(c),M[a].c(),M[a].m(n,null))}for(;a<M.length;a+=1)M[a].d(1);M.length=E.length,!E.length&&C?C.p(e,i):E.length?C&&(C.d(1),C=null):((C=create_else_block()).c(),C.m(n,null))}(!_||4&i)&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ljt)(n,"style",e[2]),2&i&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.BmG)(s,e[1]),e[1].length>0?A?(A.p(e,i),2&i&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ui)(A,1)):((A=create_if_block_1(e)).c(),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ui)(A,1),A.m(o,null)):A&&((0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.dvw)(),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.etI)(A,1,1,function(){A=null}),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.gbL)()),16&i&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.BmG)(m,e[4]),e[4].length>0?O?(O.p(e,i),16&i&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ui)(O,1)):((O=create_if_block(e)).c(),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ui)(O,1),O.m(g,null)):O&&((0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.dvw)(),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.etI)(O,1,1,function(){O=null}),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.gbL)())},i:function(e){_||((0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ui)(A),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.Ui)(O),_=!0)},o:function(e){(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.etI)(A),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.etI)(O),_=!1},d:function(n){n&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ogt)(t),S&&S.d(),(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.RMB)(M,n),C&&C.d(),e[16](null),A&&A.d(),n&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ogt)(d),n&&(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.ogt)(u),O&&O.d(),I=!1,(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.j7q)(T)}}}function instance($$self,$$props,$$invalidate){var module=_log_model__WEBPACK_IMPORTED_MODULE_3__.W.getSingleton(_log_model__WEBPACK_IMPORTED_MODULE_3__.W,"VConsoleLogModel"),cachedObjKeys={},dispatch=(0,svelte__WEBPACK_IMPORTED_MODULE_1__.x)(),cmdElement,cmdValue="",promptedStyle="",promptedList=[],filterValue="";(0,svelte__WEBPACK_IMPORTED_MODULE_1__.H3)(function(){_logCommand_less__WEBPACK_IMPORTED_MODULE_4__.Z.use()}),(0,svelte__WEBPACK_IMPORTED_MODULE_1__.ev)(function(){_logCommand_less__WEBPACK_IMPORTED_MODULE_4__.Z.unuse()});var evalCommand=function(e){module.evalCommand(e)},moveCursorToPos=function(e,t){e.setSelectionRange&&setTimeout(function(){e.setSelectionRange(t,t)},1)},clearPromptedList=function(){$$invalidate(2,promptedStyle="display: none;"),$$invalidate(3,promptedList=[])},updatePromptedList=function updatePromptedList(identifier){if(""!==cmdValue){identifier||(identifier=(0,_logTool__WEBPACK_IMPORTED_MODULE_5__.oj)(cmdValue));var objName="window",keyName=cmdValue;if("."!==identifier.front.text&&"["!==identifier.front.text||(objName=identifier.front.before,keyName=""!==identifier.back.text?identifier.back.before:identifier.front.after),keyName=keyName.replace(/(^['"]+)|(['"']+$)/g,""),!cachedObjKeys[objName])try{cachedObjKeys[objName]=Object.getOwnPropertyNames(eval("("+objName+")")).sort()}catch(t2){}try{if(cachedObjKeys[objName])for(var i=0;i<cachedObjKeys[objName].length&&!(promptedList.length>=100);i++){var key=String(cachedObjKeys[objName][i]),keyPattern=new RegExp("^"+keyName,"i");if(keyPattern.test(key)){var completeCmd=objName;"."===identifier.front.text||""===identifier.front.text?completeCmd+="."+key:"["===identifier.front.text&&(completeCmd+="['"+key+"']"),promptedList.push({text:key,value:completeCmd})}}}catch(t2){}if(promptedList.length>0){var m=Math.min(200,31*(promptedList.length+1));$$invalidate(2,promptedStyle="display: block; height: "+m+"px; margin-top: "+(-m-2)+"px;"),$$invalidate(3,promptedList)}else clearPromptedList()}else clearPromptedList()},autoCompleteBrackets=function(e,t){if(8!==t&&46!==t&&""===e.front.after)switch(e.front.text){case"[":return $$invalidate(1,cmdValue+="]"),void moveCursorToPos(cmdElement,cmdValue.length-1);case"(":return $$invalidate(1,cmdValue+=")"),void moveCursorToPos(cmdElement,cmdValue.length-1);case"{":return $$invalidate(1,cmdValue+="}"),void moveCursorToPos(cmdElement,cmdValue.length-1)}},dispatchFilterEvent=function(){dispatch("filterText",{filterText:filterValue})},onTapClearText=function(e){"cmd"===e?($$invalidate(1,cmdValue=""),clearPromptedList()):"filter"===e&&($$invalidate(4,filterValue=""),dispatchFilterEvent())},onTapPromptedItem=function onTapPromptedItem(item){var type="";try{type=eval("typeof "+item.value)}catch(t2){}$$invalidate(1,cmdValue=item.value+("function"===type?"()":"")),clearPromptedList()},onCmdFocus=function(){updatePromptedList()},onCmdBlur=function(){},onCmdKeyDown=function(e){13===e.keyCode&&(e.preventDefault(),onCmdSubmit())},onCmdKeyUp=function(e){$$invalidate(3,promptedList=[]);var t=(0,_logTool__WEBPACK_IMPORTED_MODULE_5__.oj)(e.target.value);autoCompleteBrackets(t,e.keyCode),updatePromptedList(t)},onCmdSubmit=function(){""!==cmdValue&&evalCommand(cmdValue),clearPromptedList()},onFilterSubmit=function(e){dispatchFilterEvent()},click_handler=function(e){return onTapPromptedItem(e)};function textarea0_input_handler(){cmdValue=this.value,$$invalidate(1,cmdValue)}function textarea0_binding(e){svelte_internal__WEBPACK_IMPORTED_MODULE_0__.VnY[e?"unshift":"push"](function(){$$invalidate(0,cmdElement=e)})}var click_handler_1=function(){return onTapClearText("cmd")};function textarea1_input_handler(){filterValue=this.value,$$invalidate(4,filterValue)}var click_handler_2=function(){return onTapClearText("filter")};return[cmdElement,cmdValue,promptedStyle,promptedList,filterValue,clearPromptedList,onTapClearText,onTapPromptedItem,onCmdFocus,onCmdBlur,onCmdKeyDown,onCmdKeyUp,onCmdSubmit,onFilterSubmit,click_handler,textarea0_input_handler,textarea0_binding,click_handler_1,textarea1_input_handler,click_handler_2]}var LogCommand=function(e){function t(t){var n;return n=e.call(this)||this,(0,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.S1n)((0,_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_7__.Z)(n),t,instance,create_fragment,svelte_internal__WEBPACK_IMPORTED_MODULE_0__.N8,{}),n}return(0,_babel_runtime_helpers_inheritsLoose__WEBPACK_IMPORTED_MODULE_6__.Z)(t,e),t}(svelte_internal__WEBPACK_IMPORTED_MODULE_0__.f_C);__webpack_exports__.Z=LogCommand},4687:function(e,t,n){n.d(t,{x:function(){return c}});var r,i,o,s,a=n(3313),c=(r=(0,a.fZ)({updateTime:0}),i=r.subscribe,o=r.set,s=r.update,{subscribe:i,set:o,update:s,updateTime:function(){s(function(e){return e.updateTime=Date.now(),e})}})},643:function(e,t,n){n.d(t,{N:function(){return r}});var r=function(){function e(){this._onDataUpdateCallbacks=[]}return e.getSingleton=function(t,n){return n||(n=t.toString()),e.singleton[n]||(e.singleton[n]=new t),e.singleton[n]},e}();r.singleton={}},5103:function(e,t,n){function r(e){var t=e>0?new Date(e):new Date,n=t.getDate()<10?"0"+t.getDate():t.getDate(),r=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,i=t.getFullYear(),o=t.getHours()<10?"0"+t.getHours():t.getHours(),s=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),a=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds(),c=t.getMilliseconds()<10?"0"+t.getMilliseconds():t.getMilliseconds();return c<100&&(c="0"+c),{time:+t,year:i,month:r,day:n,hour:o,minute:s,second:a,millisecond:c}}function i(e){return"[object Number]"===Object.prototype.toString.call(e)}function o(e){return"bigint"==typeof e}function s(e){return"string"==typeof e}function a(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(e){return"boolean"==typeof e}function l(e){return void 0===e}function d(e){return null===e}function u(e){return"symbol"==typeof e}function p(e){return!("[object Object]"!==Object.prototype.toString.call(e)&&(i(e)||o(e)||s(e)||c(e)||a(e)||d(e)||h(e)||l(e)||u(e)))}function h(e){return"function"==typeof e}function g(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function m(e){var t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object DOMWindow]"===t||"[object global]"===t}function f(e){return null!=e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e&&"function"!=typeof e&&"symbol"!=typeof e&&"bigint"!=typeof e&&"undefined"!=typeof Symbol&&"function"==typeof e[Symbol.iterator]}function v(e){return Object.prototype.toString.call(e).replace(/\[object (.*)\]/,"$1")}n.d(t,{C4:function(){return o},DV:function(){return _},FJ:function(){return m},Ft:function(){return d},HD:function(){return s},H_:function(){return D},KL:function(){return A},Kn:function(){return p},MH:function(){return w},PO:function(){return I},QI:function(){return V},QK:function(){return P},TW:function(){return f},_3:function(){return r},_D:function(){return k},cF:function(){return x},hZ:function(){return C},hj:function(){return i},id:function(){return O},jn:function(){return c},kJ:function(){return a},kK:function(){return g},mf:function(){return h},o8:function(){return l},po:function(){return L},qr:function(){return N},qt:function(){return U},rE:function(){return E},yk:function(){return u},zl:function(){return v}});var y=/(function|class) ([^ \{\()}]{1,})[\(| ]/;function _(e){var t;if(null==e)return"";var n=y.exec((null==e||null==(t=e.constructor)?void 0:t.toString())||"");return n&&n.length>1?n[2]:""}function I(e){var t,n=Object.prototype.hasOwnProperty;if(!e||"object"!=typeof e||e.nodeType||m(e))return!1;try{if(e.constructor&&!n.call(e,"constructor")&&!n.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}for(t in e);return void 0===t||n.call(e,t)}var T=/[\n\t]/g,S=function(e){return{"\n":"\\n","\t":"\\t"}[e]};function E(e){return"string"!=typeof e?e:String(e).replace(T,S)}var M=function(e,t){void 0===t&&(t=0);var n="";return s(e)?(t>0&&(e=O(e,t)),n+='"'+E(e)+'"'):u(e)?n+=String(e).replace(/^Symbol\((.*)\)$/i,'Symbol("$1")'):h(e)?n+=(e.name||"function")+"()":o(e)?n+=String(e)+"n":n+=String(e),n},b=function e(t,n,r){if(void 0===r&&(r=0),p(t)||a(t))if(n.circularFinder(t)){var i="";if(a(t))i="(Circular Array)";else if(p(t)){var o;i="(Circular "+((null==(o=t.constructor)?void 0:o.name)||"Object")+")"}n.ret+=n.standardJSON?'"'+i+'"':i}else{var c="",l="";if(n.pretty){for(var d=0;d<=r;d++)c+="  ";l="\n"}var h="{",g="}";a(t)&&(h="[",g="]"),n.ret+=h+l;for(var m=w(t),f=0;f<m.length;f++){var v=m[f];n.ret+=c;try{a(t)||(p(v)||a(v)||u(v)?n.ret+=Object.prototype.toString.call(v):s(v)&&n.standardJSON?n.ret+='"'+v+'"':n.ret+=v,n.ret+=": ")}catch(I){continue}try{var y=t[v];if(a(y))n.maxDepth>-1&&r>=n.maxDepth?n.ret+="Array("+y.length+")":e(y,n,r+1);else if(p(y)){var _;n.maxDepth>-1&&r>=n.maxDepth?n.ret+=((null==(_=y.constructor)?void 0:_.name)||"Object")+" {}":e(y,n,r+1)}else n.ret+=M(y,n.keyMaxLen)}catch(I){n.ret+=n.standardJSON?'"(PARSE_ERROR)"':"(PARSE_ERROR)"}if(n.keyMaxLen>0&&n.ret.length>=10*n.keyMaxLen){n.ret+=", (...)";break}f<m.length-1&&(n.ret+=", "),n.ret+=l}n.ret+=c.substring(0,c.length-2)+g}else n.ret+=M(t,n.keyMaxLen)};function C(e,t){void 0===t&&(t={maxDepth:-1,keyMaxLen:-1,pretty:!1,standardJSON:!1});var n,r=Object.assign({ret:"",maxDepth:-1,keyMaxLen:-1,pretty:!1,standardJSON:!1,circularFinder:(n=new WeakSet,function(e){if("object"==typeof e&&null!==e){if(n.has(e))return!0;n.add(e)}return!1})},t);return b(e,r),r.ret}function A(e){return e<=0?"":e>=1e6?(e/1e3/1e3).toFixed(1)+" MB":e>=1e3?(e/1e3).toFixed(1)+" KB":e+" B"}function O(e,t){return e.length>t&&(e=e.substring(0,t)+"...("+A(function(e){try{return encodeURI(e).split(/%(?:u[0-9A-F]{2})?[0-9A-F]{2}|./).length-1}catch(t){return 0}}(e))+")"),e}var R=function(e,t){return String(e).localeCompare(String(t),void 0,{numeric:!0,sensitivity:"base"})};function N(e){return e.sort(R)}function w(e){return p(e)||a(e)?Object.keys(e):[]}function P(e){var t,n=w(e);return(p(t=e)||a(t)?Object.getOwnPropertyNames(t):[]).filter(function(e){return-1===n.indexOf(e)})}function k(e){return p(e)||a(e)?Object.getOwnPropertySymbols(e):[]}function L(e,t){window.localStorage&&(e="vConsole_"+e,localStorage.setItem(e,t))}function x(e){if(window.localStorage)return e="vConsole_"+e,localStorage.getItem(e)}function V(e){return void 0===e&&(e=""),"__vc_"+e+Math.random().toString(36).substring(2,8)}function D(){return"undefined"!=typeof window&&!!window.__wxConfig&&!!window.wx&&!!window.__virtualDOM__}function U(e){if(D()&&"function"==typeof window.wx[e])try{for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=window.wx[e]).call.apply(t,[window.wx].concat(r))}catch(o){return void console.debug("[vConsole] Fail to call wx."+e+"():",o)}}},5629:function(e,t,n){n.d(t,{W:function(){return g}});var r=n(8270),i=n(6881),o=n(5103),s=n(643),a=n(4687),c=n(8665),l=n(9923);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var g=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).LOG_METHODS=["log","info","warn","debug","error"],t.ADDED_LOG_PLUGIN_ID=[],t.maxLogNumber=1e3,t.logCounter=0,t.groupLevel=0,t.groupLabelCollapsedStack=[],t.pluginPattern=void 0,t.logQueue=[],t.flushLogScheduled=!1,t.origConsole={},t}(0,i.Z)(t,e);var n=t.prototype;return n.bindPlugin=function(e){return!(this.ADDED_LOG_PLUGIN_ID.indexOf(e)>-1||(0===this.ADDED_LOG_PLUGIN_ID.length&&this.mockConsole(),l.O.create(e),this.ADDED_LOG_PLUGIN_ID.push(e),this.pluginPattern=new RegExp("^\\[("+this.ADDED_LOG_PLUGIN_ID.join("|")+")\\]$","i"),0))},n.unbindPlugin=function(e){var t=this.ADDED_LOG_PLUGIN_ID.indexOf(e);return-1!==t&&(this.ADDED_LOG_PLUGIN_ID.splice(t,1),l.O.delete(e),0===this.ADDED_LOG_PLUGIN_ID.length&&this.unmockConsole(),!0)},n.mockConsole=function(){var e=this;"function"!=typeof this.origConsole.log&&(window.console?(this.LOG_METHODS.map(function(t){e.origConsole[t]=window.console[t]}),this.origConsole.time=window.console.time,this.origConsole.timeEnd=window.console.timeEnd,this.origConsole.clear=window.console.clear,this.origConsole.group=window.console.group,this.origConsole.groupCollapsed=window.console.groupCollapsed,this.origConsole.groupEnd=window.console.groupEnd):window.console={},this._mockConsoleLog(),this._mockConsoleTime(),this._mockConsoleGroup(),this._mockConsoleClear(),window._vcOrigConsole=this.origConsole)},n._mockConsoleLog=function(){var e=this;this.LOG_METHODS.map(function(t){window.console[t]=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.addLog({type:t,origData:r||[]})}.bind(window.console)})},n._mockConsoleTime=function(){var e=this,t={};window.console.time=function(e){void 0===e&&(e=""),t[e]=Date.now()}.bind(window.console),window.console.timeEnd=function(n){void 0===n&&(n="");var r=t[n],i=0;r&&(i=Date.now()-r,delete t[n]),e.addLog({type:"log",origData:[n+": "+i+"ms"]})}.bind(window.console)},n._mockConsoleGroup=function(){var e=this,t=function(t){return function(n){void 0===n&&(n="console.group");var r=Symbol(n);e.groupLabelCollapsedStack.push({label:r,collapsed:t}),e.addLog({type:"log",origData:[n],isGroupHeader:t?2:1,isGroupCollapsed:!1},{noOrig:!0}),e.groupLevel++,t?e.origConsole.groupCollapsed(n):e.origConsole.group(n)}.bind(window.console)};window.console.group=t(!1),window.console.groupCollapsed=t(!0),window.console.groupEnd=function(){e.groupLabelCollapsedStack.pop(),e.groupLevel=Math.max(0,e.groupLevel-1),e.origConsole.groupEnd()}.bind(window.console)},n._mockConsoleClear=function(){var e=this;window.console.clear=function(){e.resetGroup(),e.clearLog();for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];e.callOriginalConsole.apply(e,["clear"].concat(n))}.bind(window.console)},n.unmockConsole=function(){for(var e in this.origConsole)window.console[e]=this.origConsole[e],delete this.origConsole[e];window._vcOrigConsole&&delete window._vcOrigConsole},n.callOriginalConsole=function(e){if("function"==typeof this.origConsole[e]){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.origConsole[e].apply(window.console,n)}},n.resetGroup=function(){for(;this.groupLevel>0;)console.groupEnd()},n.clearLog=function(){var e=l.O.getAll();for(var t in e)this.clearPluginLog(t)},n.clearPluginLog=function(e){var t=this.logQueue;this.logQueue=[];for(var n,r=p(t);!(n=r()).done;){var i=n.value;this._extractPluginIdByLog(i)!==e&&this.logQueue.push(i)}l.O.get(e).update(function(e){return e.logList.length=0,e}),a.x.updateTime()},n.addLog=function(e,t){void 0===e&&(e={type:"log",origData:[],isGroupHeader:0,isGroupCollapsed:!1});var n=this.groupLabelCollapsedStack[this.groupLabelCollapsedStack.length-2],r=this.groupLabelCollapsedStack[this.groupLabelCollapsedStack.length-1],i={_id:o.QI(),type:e.type,cmdType:null==t?void 0:t.cmdType,toggle:{},date:Date.now(),data:(0,c.b1)(e.origData||[]),repeated:0,groupLabel:null==r?void 0:r.label,groupLevel:this.groupLevel,groupHeader:e.isGroupHeader,groupCollapsed:e.isGroupHeader?!(null==n||!n.collapsed):!(null==r||!r.collapsed)};this._signalLog(i),null!=t&&t.noOrig||this.callOriginalConsole.apply(this,[e.type].concat(e.origData))},n.evalCommand=function(e){this.addLog({type:"log",origData:[e]},{cmdType:"input"});var t=void 0;try{t=eval.call(window,"("+e+")")}catch(n){try{t=eval.call(window,e)}catch(r){}}this.addLog({type:"log",origData:[t]},{cmdType:"output"})},n._signalLog=function(e){var t=this;this.flushLogScheduled||(this.flushLogScheduled=!0,window.requestAnimationFrame(function(){t.flushLogScheduled=!1,t._flushLogs()})),this.logQueue.push(e)},n._flushLogs=function(){var e=this,t=this.logQueue;this.logQueue=[];for(var n,r={},i=p(t);!(n=i()).done;){var o=n.value,s=this._extractPluginIdByLog(o);(r[s]=r[s]||[]).push(o)}for(var c=function(t){var n=r[t];l.O.get(t).update(function(t){for(var r,i=[].concat(t.logList),o=p(n);!(r=o()).done;){var s=r.value;e._isRepeatedLog(i,s)?e._updateLastLogRepeated(i):i.push(s)}return{logList:i=e._limitLogListLength(i)}})},d=0,u=Object.keys(r);d<u.length;d++)c(u[d]);a.x.updateTime()},n._extractPluginIdByLog=function(e){var t,n="default",r=null==(t=e.data[0])?void 0:t.origData;if(o.HD(r)){var i=r.match(this.pluginPattern);if(null!==i&&i.length>1){var s=i[1].toLowerCase();this.ADDED_LOG_PLUGIN_ID.indexOf(s)>-1&&(n=s,e.data.shift())}}return n},n._isRepeatedLog=function(e,t){var n=e[e.length-1];if(!n)return!1;var r=!1;if(t.type===n.type&&t.cmdType===n.cmdType&&t.data.length===n.data.length){r=!0;for(var i=0;i<t.data.length;i++)if(t.data[i].origData!==n.data[i].origData){r=!1;break}}return r},n._updateLastLogRepeated=function(e){var t=e[e.length-1],n=t.repeated?t.repeated+1:2;return e[e.length-1]=u(u({},t),{},{repeated:n}),e},n._limitLogListLength=function(e){var t=e.length,n=this.maxLogNumber;return t>n?e.slice(t-n,t):e},t}(s.N)},9923:function(e,t,n){n.d(t,{O:function(){return i}});var r=n(3313),i=function(){function e(){}return e.create=function(e){return this.storeMap[e]||(this.storeMap[e]=(0,r.fZ)({logList:[]})),this.storeMap[e]},e.delete=function(e){this.storeMap[e]&&delete this.storeMap[e]},e.get=function(e){return this.storeMap[e]},e.getRaw=function(e){return(0,r.U2)(this.storeMap[e])},e.getAll=function(){return this.storeMap},e}();i.storeMap={}},8665:function(e,t,n){n.d(t,{HX:function(){return d},LH:function(){return o},Tg:function(){return h},b1:function(){return p},oj:function(){return l}});var r=n(5103),i=function(e){var t=r.hZ(e,{maxDepth:0}),n=t.substring(0,36),i=r.DV(e);return t.length>36&&(n+="..."),r.rE(i+" "+n)},o=function(e,t){void 0===t&&(t=!0);var n="undefined",o=e;return e instanceof h?(n="uninvocatable",o="(...)"):r.kJ(e)?(n="array",o=i(e)):r.Kn(e)?(n="object",o=i(e)):r.HD(e)?(n="string",o=r.rE(e),t&&(o='"'+o+'"')):r.hj(e)?(n="number",o=String(e)):r.C4(e)?(n="bigint",o=String(e)+"n"):r.jn(e)?(n="boolean",o=String(e)):r.Ft(e)?(n="null",o="null"):r.o8(e)?(n="undefined",o="undefined"):r.mf(e)?(n="function",o=(e.name||"function")+"()"):r.yk(e)&&(n="symbol",o=String(e)),{text:o,valueType:n}},s=[".","[","(","{","}"],a=["]",")","}"],c=function(e,t,n){void 0===n&&(n=0);for(var r={text:"",pos:-1,before:"",after:""},i=e.length-1;i>=n;i--){var o=t.indexOf(e[i]);if(o>-1){r.text=t[o],r.pos=i,r.before=e.substring(n,i),r.after=e.substring(i+1,e.length);break}}return r},l=function(e){var t=c(e,s,0);return{front:t,back:c(e,a,t.pos+1)}},d=function(e,t){if(""===t)return!0;for(var n=0;n<e.data.length;n++)if("string"==typeof e.data[n].origData&&e.data[n].origData.indexOf(t)>-1)return!0;return!1},u=/(\%[csdo] )|( \%[csdo])/g,p=function(e){if(u.lastIndex=0,r.HD(e[0])&&u.test(e[0])){for(var t,n=[].concat(e),i=n.shift().split(u).filter(function(e){return void 0!==e&&""!==e}),o=n,s=[],a=!1,c="";i.length>0;){var l=i.shift();if(/ ?\%c ?/.test(l)?o.length>0?"string"!=typeof(c=o.shift())&&(c=""):(t=l,c="",a=!0):/ ?\%[sd] ?/.test(l)?(t=o.length>0?r.Kn(o[0])?r.DV(o.shift()):String(o.shift()):l,a=!0):/ ?\%o ?/.test(l)?(t=o.length>0?o.shift():l,a=!0):(t=l,a=!0),a){var d={origData:t};c&&(d.style=c),s.push(d),a=!1,t=void 0,c=""}}for(var p=0;p<o.length;p++)s.push({origData:o[p]});return s}for(var h=[],g=0;g<e.length;g++)h.push({origData:e[g]});return h},h=function(){}},5313:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,".vc-icon {\n  word-break: normal;\n  white-space: normal;\n  overflow: visible;\n}\n.vc-icon svg {\n  fill: var(--VC-FG-2);\n  height: 1em;\n  width: 1em;\n  vertical-align: -0.11em;\n}\n.vc-icon .vc-icon-delete {\n  vertical-align: -0.11em;\n}\n.vc-icon .vc-icon-copy {\n  height: 1.1em;\n  width: 1.1em;\n  vertical-align: -0.16em;\n}\n.vc-icon .vc-icon-suc {\n  fill: var(--VC-TEXTGREEN);\n  height: 1.1em;\n  width: 1.1em;\n  vertical-align: -0.16em;\n}\n",""]),t.Z=s},1142:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,".vc-scroller-viewport {\n  position: relative;\n  overflow: hidden;\n  height: 100%;\n}\n.vc-scroller-contents {\n  min-height: 100%;\n  will-change: transform;\n}\n.vc-scroller-items {\n  will-change: height;\n  position: relative;\n}\n.vc-scroller-item {\n  display: none;\n  position: absolute;\n  left: 0;\n  right: 0;\n}\n.vc-scroller-viewport.static .vc-scroller-item {\n  display: block;\n  position: static;\n}\n.vc-scroller-scrollbar-track {\n  width: 4px;\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  padding: 1px;\n}\n.vc-scroller-scrollbar-thumb {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.5);\n  border-radius: 999px;\n}\n",""]),t.Z=s},3283:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,'#__vconsole {\n  --VC-BG-0: #ededed;\n  --VC-BG-1: #f7f7f7;\n  --VC-BG-2: #fff;\n  --VC-BG-3: #f7f7f7;\n  --VC-BG-4: #4c4c4c;\n  --VC-BG-5: #fff;\n  --VC-BG-6: rgba(0, 0, 0, 0.1);\n  --VC-FG-0: rgba(0, 0, 0, 0.9);\n  --VC-FG-HALF: rgba(0, 0, 0, 0.9);\n  --VC-FG-1: rgba(0, 0, 0, 0.5);\n  --VC-FG-2: rgba(0, 0, 0, 0.3);\n  --VC-FG-3: rgba(0, 0, 0, 0.1);\n  --VC-RED: #fa5151;\n  --VC-ORANGE: #fa9d3b;\n  --VC-YELLOW: #ffc300;\n  --VC-GREEN: #91d300;\n  --VC-LIGHTGREEN: #95ec69;\n  --VC-BRAND: #07c160;\n  --VC-BLUE: #10aeff;\n  --VC-INDIGO: #1485ee;\n  --VC-PURPLE: #6467f0;\n  --VC-LINK: #576b95;\n  --VC-TEXTGREEN: #06ae56;\n  --VC-FG: black;\n  --VC-BG: white;\n  --VC-BG-COLOR-ACTIVE: #ececec;\n  --VC-WARN-BG: #fff3cc;\n  --VC-WARN-BORDER: #ffe799;\n  --VC-ERROR-BG: #fedcdc;\n  --VC-ERROR-BORDER: #fdb9b9;\n  --VC-DOM-TAG-NAME-COLOR: #881280;\n  --VC-DOM-ATTRIBUTE-NAME-COLOR: #994500;\n  --VC-DOM-ATTRIBUTE-VALUE-COLOR: #1a1aa6;\n  --VC-CODE-KEY-FG: #881391;\n  --VC-CODE-PRIVATE-KEY-FG: #cfa1d3;\n  --VC-CODE-FUNC-FG: #0d22aa;\n  --VC-CODE-NUMBER-FG: #1c00cf;\n  --VC-CODE-STR-FG: #c41a16;\n  --VC-CODE-NULL-FG: #808080;\n  color: var(--VC-FG-0);\n  font-size: 13px;\n  font-family: Helvetica Neue, Helvetica, Arial, sans-serif;\n  -webkit-user-select: auto;\n  /* global */\n}\n#__vconsole .vc-max-height {\n  max-height: 19.23076923em;\n}\n#__vconsole .vc-max-height-line {\n  max-height: 6.30769231em;\n}\n#__vconsole .vc-min-height {\n  min-height: 3.07692308em;\n}\n#__vconsole dd,\n#__vconsole dl,\n#__vconsole pre {\n  margin: 0;\n}\n#__vconsole pre {\n  white-space: pre-wrap;\n}\n#__vconsole i {\n  font-style: normal;\n}\n.vc-table {\n  height: 100%;\n}\n.vc-table .vc-table-row {\n  line-height: 1.5;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: row;\n  -moz-box-orient: horizontal;\n  -moz-box-direction: normal;\n  -ms-flex-direction: row;\n  flex-direction: row;\n  -webkit-flex-wrap: wrap;\n  -ms-flex-wrap: wrap;\n  flex-wrap: wrap;\n  overflow: hidden;\n  border-bottom: 1px solid var(--VC-FG-3);\n}\n.vc-table .vc-table-row.vc-left-border {\n  border-left: 1px solid var(--VC-FG-3);\n}\n.vc-table .vc-table-row-icon {\n  margin-left: 4px;\n}\n.vc-table .vc-table-col {\n  -webkit-box-flex: 1;\n  -webkit-flex: 1;\n  -moz-box-flex: 1;\n  -ms-flex: 1;\n  flex: 1;\n  padding: 0.23076923em 0.30769231em;\n  border-left: 1px solid var(--VC-FG-3);\n  overflow: auto;\n}\n.vc-table .vc-table-col:first-child {\n  border: none;\n}\n.vc-table .vc-table-col-value {\n  white-space: pre-wrap;\n  word-break: break-word;\n  /*white-space: nowrap;\n    text-overflow: ellipsis;*/\n  -webkit-overflow-scrolling: touch;\n}\n.vc-table .vc-small .vc-table-col {\n  padding: 0 0.30769231em;\n  font-size: 0.92307692em;\n}\n.vc-table .vc-table-col-2 {\n  -webkit-box-flex: 2;\n  -webkit-flex: 2;\n  -moz-box-flex: 2;\n  -ms-flex: 2;\n  flex: 2;\n}\n.vc-table .vc-table-col-3 {\n  -webkit-box-flex: 3;\n  -webkit-flex: 3;\n  -moz-box-flex: 3;\n  -ms-flex: 3;\n  flex: 3;\n}\n.vc-table .vc-table-col-4 {\n  -webkit-box-flex: 4;\n  -webkit-flex: 4;\n  -moz-box-flex: 4;\n  -ms-flex: 4;\n  flex: 4;\n}\n.vc-table .vc-table-col-5 {\n  -webkit-box-flex: 5;\n  -webkit-flex: 5;\n  -moz-box-flex: 5;\n  -ms-flex: 5;\n  flex: 5;\n}\n.vc-table .vc-table-col-6 {\n  -webkit-box-flex: 6;\n  -webkit-flex: 6;\n  -moz-box-flex: 6;\n  -ms-flex: 6;\n  flex: 6;\n}\n.vc-table .vc-table-row-error {\n  border-color: var(--VC-ERROR-BORDER);\n  background-color: var(--VC-ERROR-BG);\n}\n.vc-table .vc-table-row-error .vc-table-col {\n  color: var(--VC-RED);\n  border-color: var(--VC-ERROR-BORDER);\n}\n.vc-table .vc-table-col-title {\n  font-weight: bold;\n}\n.vc-table .vc-table-action {\n  display: flex;\n  justify-content: space-evenly;\n}\n.vc-table .vc-table-action .vc-icon {\n  flex: 1;\n  text-align: center;\n  display: block;\n}\n.vc-table .vc-table-action .vc-icon:hover {\n  background: var(--VC-BG-3);\n}\n.vc-table .vc-table-action .vc-icon:active {\n  background: var(--VC-BG-1);\n}\n.vc-table .vc-table-input {\n  width: 100%;\n  border: none;\n  color: var(--VC-FG-0);\n  background-color: var(--VC-BG-6);\n  height: 3.53846154em;\n}\n.vc-table .vc-table-input:focus {\n  background-color: var(--VC-FG-2);\n}\n@media (prefers-color-scheme: dark) {\n  #__vconsole:not([data-theme="light"]) {\n    --VC-BG-0: #191919;\n    --VC-BG-1: #1f1f1f;\n    --VC-BG-2: #232323;\n    --VC-BG-3: #2f2f2f;\n    --VC-BG-4: #606060;\n    --VC-BG-5: #2c2c2c;\n    --VC-BG-6: rgba(255, 255, 255, 0.2);\n    --VC-FG-0: rgba(255, 255, 255, 0.8);\n    --VC-FG-HALF: rgba(255, 255, 255, 0.6);\n    --VC-FG-1: rgba(255, 255, 255, 0.5);\n    --VC-FG-2: rgba(255, 255, 255, 0.3);\n    --VC-FG-3: rgba(255, 255, 255, 0.05);\n    --VC-RED: #fa5151;\n    --VC-ORANGE: #c87d2f;\n    --VC-YELLOW: #cc9c00;\n    --VC-GREEN: #74a800;\n    --VC-LIGHTGREEN: #28b561;\n    --VC-BRAND: #07c160;\n    --VC-BLUE: #10aeff;\n    --VC-INDIGO: #1196ff;\n    --VC-PURPLE: #8183ff;\n    --VC-LINK: #7d90a9;\n    --VC-TEXTGREEN: #259c5c;\n    --VC-FG: white;\n    --VC-BG: black;\n    --VC-BG-COLOR-ACTIVE: #282828;\n    --VC-WARN-BG: #332700;\n    --VC-WARN-BORDER: #664e00;\n    --VC-ERROR-BG: #321010;\n    --VC-ERROR-BORDER: #642020;\n    --VC-DOM-TAG-NAME-COLOR: #5DB0D7;\n    --VC-DOM-ATTRIBUTE-NAME-COLOR: #9BBBDC;\n    --VC-DOM-ATTRIBUTE-VALUE-COLOR: #f29766;\n    --VC-CODE-KEY-FG: #e36eec;\n    --VC-CODE-PRIVATE-KEY-FG: #f4c5f7;\n    --VC-CODE-FUNC-FG: #556af2;\n    --VC-CODE-NUMBER-FG: #9980ff;\n    --VC-CODE-STR-FG: #e93f3b;\n    --VC-CODE-NULL-FG: #808080;\n  }\n}\n#__vconsole[data-theme="dark"] {\n  --VC-BG-0: #191919;\n  --VC-BG-1: #1f1f1f;\n  --VC-BG-2: #232323;\n  --VC-BG-3: #2f2f2f;\n  --VC-BG-4: #606060;\n  --VC-BG-5: #2c2c2c;\n  --VC-BG-6: rgba(255, 255, 255, 0.2);\n  --VC-FG-0: rgba(255, 255, 255, 0.8);\n  --VC-FG-HALF: rgba(255, 255, 255, 0.6);\n  --VC-FG-1: rgba(255, 255, 255, 0.5);\n  --VC-FG-2: rgba(255, 255, 255, 0.3);\n  --VC-FG-3: rgba(255, 255, 255, 0.05);\n  --VC-RED: #fa5151;\n  --VC-ORANGE: #c87d2f;\n  --VC-YELLOW: #cc9c00;\n  --VC-GREEN: #74a800;\n  --VC-LIGHTGREEN: #28b561;\n  --VC-BRAND: #07c160;\n  --VC-BLUE: #10aeff;\n  --VC-INDIGO: #1196ff;\n  --VC-PURPLE: #8183ff;\n  --VC-LINK: #7d90a9;\n  --VC-TEXTGREEN: #259c5c;\n  --VC-FG: white;\n  --VC-BG: black;\n  --VC-BG-COLOR-ACTIVE: #282828;\n  --VC-WARN-BG: #332700;\n  --VC-WARN-BORDER: #664e00;\n  --VC-ERROR-BG: #321010;\n  --VC-ERROR-BORDER: #642020;\n  --VC-DOM-TAG-NAME-COLOR: #5DB0D7;\n  --VC-DOM-ATTRIBUTE-NAME-COLOR: #9BBBDC;\n  --VC-DOM-ATTRIBUTE-VALUE-COLOR: #f29766;\n  --VC-CODE-KEY-FG: #e36eec;\n  --VC-CODE-PRIVATE-KEY-FG: #f4c5f7;\n  --VC-CODE-FUNC-FG: #556af2;\n  --VC-CODE-NUMBER-FG: #9980ff;\n  --VC-CODE-STR-FG: #e93f3b;\n  --VC-CODE-NULL-FG: #808080;\n}\n.vc-tabbar {\n  border-bottom: 1px solid var(--VC-FG-3);\n  overflow-x: auto;\n  height: 3em;\n  width: auto;\n  white-space: nowrap;\n}\n.vc-tabbar .vc-tab {\n  display: inline-block;\n  line-height: 3em;\n  padding: 0 1.15384615em;\n  border-right: 1px solid var(--VC-FG-3);\n  text-decoration: none;\n  color: var(--VC-FG-0);\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n}\n.vc-tabbar .vc-tab:active {\n  background-color: rgba(0, 0, 0, 0.15);\n}\n.vc-tabbar .vc-tab.vc-actived {\n  background-color: var(--VC-BG-1);\n}\n.vc-toolbar {\n  border-top: 1px solid var(--VC-FG-3);\n  line-height: 3em;\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: row;\n  -moz-box-orient: horizontal;\n  -moz-box-direction: normal;\n  -ms-flex-direction: row;\n  flex-direction: row;\n}\n.vc-toolbar .vc-tool {\n  display: none;\n  font-style: normal;\n  text-decoration: none;\n  color: var(--VC-FG-0);\n  width: 50%;\n  -webkit-box-flex: 1;\n  -webkit-flex: 1;\n  -moz-box-flex: 1;\n  -ms-flex: 1;\n  flex: 1;\n  text-align: center;\n  position: relative;\n  -webkit-touch-callout: none;\n}\n.vc-toolbar .vc-tool.vc-toggle,\n.vc-toolbar .vc-tool.vc-global-tool {\n  display: block;\n}\n.vc-toolbar .vc-tool:active {\n  background-color: rgba(0, 0, 0, 0.15);\n}\n.vc-toolbar .vc-tool:after {\n  content: " ";\n  position: absolute;\n  top: 0.53846154em;\n  bottom: 0.53846154em;\n  right: 0;\n  border-left: 1px solid var(--VC-FG-3);\n}\n.vc-toolbar .vc-tool-last:after {\n  border: none;\n}\n.vc-topbar {\n  background-color: var(--VC-BG-1);\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: row;\n  -moz-box-orient: horizontal;\n  -moz-box-direction: normal;\n  -ms-flex-direction: row;\n  flex-direction: row;\n  -webkit-flex-wrap: wrap;\n  -ms-flex-wrap: wrap;\n  flex-wrap: wrap;\n  width: 100%;\n}\n.vc-topbar .vc-toptab {\n  display: none;\n  -webkit-box-flex: 1;\n  -webkit-flex: 1;\n  -moz-box-flex: 1;\n  -ms-flex: 1;\n  flex: 1;\n  line-height: 2.30769231em;\n  padding: 0 1.15384615em;\n  border-bottom: 1px solid var(--VC-FG-3);\n  text-decoration: none;\n  text-align: center;\n  color: var(--VC-FG-0);\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n}\n.vc-topbar .vc-toptab.vc-toggle {\n  display: block;\n}\n.vc-topbar .vc-toptab:active {\n  background-color: rgba(0, 0, 0, 0.15);\n}\n.vc-topbar .vc-toptab.vc-actived {\n  border-bottom: 1px solid var(--VC-INDIGO);\n}\n.vc-mask {\n  display: none;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0);\n  z-index: 10001;\n  -webkit-transition: background 0.3s;\n  transition: background 0.3s;\n  -webkit-tap-highlight-color: transparent;\n  overflow-y: scroll;\n}\n.vc-panel {\n  display: none;\n  position: fixed;\n  min-height: 85%;\n  left: 0;\n  right: 0;\n  bottom: -100%;\n  z-index: 10002;\n  background-color: var(--VC-BG-0);\n  transition: bottom 0.3s;\n}\n.vc-toggle .vc-switch {\n  display: none;\n}\n.vc-toggle .vc-mask {\n  background: rgba(0, 0, 0, 0.6);\n  display: block;\n}\n.vc-toggle .vc-panel {\n  bottom: 0;\n}\n.vc-content {\n  background-color: var(--VC-BG-2);\n  overflow-x: hidden;\n  overflow-y: auto;\n  position: absolute;\n  top: 3.07692308em;\n  left: 0;\n  right: 0;\n  bottom: 3.07692308em;\n  -webkit-overflow-scrolling: touch;\n  margin-bottom: constant(safe-area-inset-bottom);\n  margin-bottom: env(safe-area-inset-bottom);\n}\n.vc-content.vc-has-topbar {\n  top: 5.46153846em;\n}\n.vc-plugin-box {\n  display: none;\n  position: relative;\n  min-height: 100%;\n}\n.vc-plugin-box.vc-fixed-height {\n  height: 100%;\n}\n.vc-plugin-box.vc-actived {\n  display: block;\n}\n.vc-plugin-content {\n  display: flex;\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n  flex-direction: column;\n  -webkit-tap-highlight-color: transparent;\n}\n.vc-plugin-content:empty:before {\n  content: "Empty";\n  color: var(--VC-FG-1);\n  position: absolute;\n  top: 45%;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  font-size: 1.15384615em;\n  text-align: center;\n}\n.vc-plugin-empty {\n  color: var(--VC-FG-1);\n  font-size: 1.15384615em;\n  height: 100%;\n  width: 100%;\n  padding: 1.15384615em 0;\n  text-align: center;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n@supports (bottom: constant(safe-area-inset-bottom)) or (bottom: env(safe-area-inset-bottom)) {\n  .vc-toolbar,\n  .vc-switch {\n    bottom: constant(safe-area-inset-bottom);\n    bottom: env(safe-area-inset-bottom);\n  }\n}\n',""]),t.Z=s},7558:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,".vc-switch {\n  display: block;\n  position: fixed;\n  right: 0.76923077em;\n  bottom: 0.76923077em;\n  color: #FFF;\n  background-color: var(--VC-BRAND);\n  line-height: 1;\n  font-size: 1.07692308em;\n  padding: 0.61538462em 1.23076923em;\n  z-index: 10000;\n  border-radius: 0.30769231em;\n  box-shadow: 0 0 0.61538462em rgba(0, 0, 0, 0.4);\n}\n",""]),t.Z=s},5670:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,'/* color */\n.vcelm-node {\n  color: var(--VC-DOM-TAG-NAME-COLOR);\n}\n.vcelm-k {\n  color: var(--VC-DOM-ATTRIBUTE-NAME-COLOR);\n}\n.vcelm-v {\n  color: var(--VC-DOM-ATTRIBUTE-VALUE-COLOR);\n}\n.vcelm-l.vc-actived > .vcelm-node {\n  background-color: var(--VC-FG-3);\n}\n/* layout */\n.vcelm-l {\n  padding-left: 8px;\n  position: relative;\n  word-wrap: break-word;\n  line-height: 1.2;\n}\n/*.vcelm-l.vcelm-noc {\n  padding-left: 0;\n}*/\n.vcelm-l .vcelm-node:active {\n  background-color: var(--VC-BG-COLOR-ACTIVE);\n}\n.vcelm-l.vcelm-noc .vcelm-node:active {\n  background-color: transparent;\n}\n.vcelm-t {\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n/* level */\n/* arrow */\n.vcelm-l:before {\n  content: "";\n  display: block;\n  position: absolute;\n  top: 6px;\n  left: 3px;\n  width: 0;\n  height: 0;\n  border: transparent solid 3px;\n  border-left-color: var(--VC-FG-1);\n}\n.vcelm-l.vc-toggle:before {\n  display: block;\n  top: 6px;\n  left: 0;\n  border-top-color: var(--VC-FG-1);\n  border-left-color: transparent;\n}\n.vcelm-l.vcelm-noc:before {\n  display: none;\n}\n',""]),t.Z=s},3327:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,"",""]),t.Z=s},1130:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,".vc-cmd {\n  height: 3.07692308em;\n  border-top: 1px solid var(--VC-FG-3);\n  display: flex;\n  flex-direction: row;\n}\n.vc-cmd.vc-filter {\n  bottom: 0;\n}\n.vc-cmd-input-wrap {\n  display: flex;\n  align-items: center;\n  flex: 1;\n  position: relative;\n  height: 2.15384615em;\n  padding: 0.46153846em 0.61538462em;\n}\n.vc-cmd-input {\n  width: 100%;\n  border: none;\n  resize: none;\n  outline: none;\n  padding: 0;\n  font-size: 0.92307692em;\n  background-color: transparent;\n  color: var(--VC-FG-0);\n}\n.vc-cmd-input::-webkit-input-placeholder {\n  line-height: 2.15384615em;\n}\n.vc-cmd-btn {\n  width: 3.07692308em;\n  border: none;\n  background-color: var(--VC-BG-0);\n  color: var(--VC-FG-0);\n  outline: none;\n  -webkit-touch-callout: none;\n  font-size: 1em;\n}\n.vc-cmd-clear-btn {\n  flex: 1 3.07692308em;\n  text-align: center;\n  line-height: 3.07692308em;\n}\n.vc-cmd-btn:active,\n.vc-cmd-clear-btn:active {\n  background-color: var(--VC-BG-COLOR-ACTIVE);\n}\n.vc-cmd-prompted {\n  position: absolute;\n  left: 0.46153846em;\n  right: 0.46153846em;\n  background-color: var(--VC-BG-3);\n  border: 1px solid var(--VC-FG-3);\n  overflow-x: scroll;\n  display: none;\n}\n.vc-cmd-prompted li {\n  list-style: none;\n  line-height: 30px;\n  padding: 0 0.46153846em;\n  border-bottom: 1px solid var(--VC-FG-3);\n}\n.vc-cmd-prompted li:active {\n  background-color: var(--VC-BG-COLOR-ACTIVE);\n}\n.vc-cmd-prompted-hide {\n  text-align: center;\n}\n",""]),t.Z=s},7147:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,'.vc-log-row {\n  margin: 0;\n  padding: 0.46153846em 0.61538462em;\n  overflow: hidden;\n  line-height: 1.3;\n  border-bottom: 1px solid var(--VC-FG-3);\n  word-break: break-word;\n  position: relative;\n  display: flex;\n}\n.vc-log-info {\n  color: var(--VC-PURPLE);\n}\n.vc-log-debug {\n  color: var(--VC-YELLOW);\n}\n.vc-log-warn {\n  color: var(--VC-ORANGE);\n  border-color: var(--VC-WARN-BORDER);\n  background-color: var(--VC-WARN-BG);\n}\n.vc-log-error {\n  color: var(--VC-RED);\n  border-color: var(--VC-ERROR-BORDER);\n  background-color: var(--VC-ERROR-BG);\n}\n.vc-logrow-icon {\n  margin-left: auto;\n}\n.vc-log-padding {\n  width: 1.53846154em;\n  border-left: 1px solid var(--VC-FG-3);\n}\n.vc-log-group .vc-log-content {\n  font-weight: bold;\n}\n.vc-log-group-toggle {\n  padding-left: 0.76923077em;\n}\n.vc-log-group-toggle {\n  display: block;\n  font-style: italic;\n  padding-left: 0.76923077em;\n  position: relative;\n}\n.vc-log-group-toggle:active {\n  background-color: var(--VC-BG-COLOR-ACTIVE);\n}\n.vc-log-group > .vc-log-group-toggle::before {\n  content: "";\n  position: absolute;\n  top: 0.30769231em;\n  left: 0.15384615em;\n  width: 0;\n  height: 0;\n  border: transparent solid 0.30769231em;\n  border-left-color: var(--VC-FG-1);\n}\n.vc-log-group.vc-toggle > .vc-log-group-toggle::before {\n  top: 0.46153846em;\n  left: 0;\n  border-top-color: var(--VC-FG-1);\n  border-left-color: transparent;\n}\n.vc-log-time {\n  width: 6.15384615em;\n  color: #777;\n}\n.vc-log-repeat i {\n  margin-right: 0.30769231em;\n  padding: 0 6.5px;\n  color: #D7E0EF;\n  background-color: #42597F;\n  border-radius: 8.66666667px;\n}\n.vc-log-error .vc-log-repeat i {\n  color: #901818;\n  background-color: var(--VC-RED);\n}\n.vc-log-warn .vc-log-repeat i {\n  color: #987D20;\n  background-color: #F4BD02;\n}\n.vc-log-content {\n  flex: 1;\n}\n.vc-log-input,\n.vc-log-output {\n  padding-left: 0.92307692em;\n}\n.vc-log-input:before,\n.vc-log-output:before {\n  content: "›";\n  position: absolute;\n  top: 0.15384615em;\n  left: 0;\n  font-size: 1.23076923em;\n  color: #6A5ACD;\n}\n.vc-log-output:before {\n  content: "‹";\n}\n',""]),t.Z=s},1237:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,'.vc-log-tree {\n  display: block;\n  overflow: auto;\n  position: relative;\n  -webkit-overflow-scrolling: touch;\n}\n.vc-log-tree-node {\n  display: block;\n  font-style: italic;\n  padding-left: 0.76923077em;\n  position: relative;\n}\n.vc-log-tree.vc-is-tree > .vc-log-tree-node:active {\n  background-color: var(--VC-BG-COLOR-ACTIVE);\n}\n.vc-log-tree.vc-is-tree > .vc-log-tree-node::before {\n  content: "";\n  position: absolute;\n  top: 0.30769231em;\n  left: 0.15384615em;\n  width: 0;\n  height: 0;\n  border: transparent solid 0.30769231em;\n  border-left-color: var(--VC-FG-1);\n}\n.vc-log-tree.vc-is-tree.vc-toggle > .vc-log-tree-node::before {\n  top: 0.46153846em;\n  left: 0;\n  border-top-color: var(--VC-FG-1);\n  border-left-color: transparent;\n}\n.vc-log-tree-child {\n  margin-left: 0.76923077em;\n}\n.vc-log-tree-loadmore {\n  text-decoration: underline;\n  padding-left: 1.84615385em;\n  position: relative;\n  color: var(--VC-CODE-FUNC-FG);\n}\n.vc-log-tree-loadmore::before {\n  content: "››";\n  position: absolute;\n  top: -0.15384615em;\n  left: 0.76923077em;\n  font-size: 1.23076923em;\n  color: var(--VC-CODE-FUNC-FG);\n}\n.vc-log-tree-loadmore:active {\n  background-color: var(--VC-BG-COLOR-ACTIVE);\n}\n',""]),t.Z=s},845:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,".vc-log-key {\n  color: var(--VC-CODE-KEY-FG);\n}\n.vc-log-key-private {\n  color: var(--VC-CODE-PRIVATE-KEY-FG);\n}\n.vc-log-val {\n  white-space: pre-line;\n}\n.vc-log-val-function {\n  color: var(--VC-CODE-FUNC-FG);\n  font-style: italic !important;\n}\n.vc-log-val-bigint {\n  color: var(--VC-CODE-FUNC-FG);\n}\n.vc-log-val-number,\n.vc-log-val-boolean {\n  color: var(--VC-CODE-NUMBER-FG);\n}\n.vc-log-val-string {\n  white-space: pre-wrap;\n}\n.vc-log-val-string.vc-log-val-haskey {\n  color: var(--VC-CODE-STR-FG);\n  white-space: normal;\n}\n.vc-log-val-null,\n.vc-log-val-undefined,\n.vc-log-val-uninvocatable {\n  color: var(--VC-CODE-NULL-FG);\n}\n.vc-log-val-symbol {\n  color: var(--VC-CODE-STR-FG);\n}\n",""]),t.Z=s},8747:function(e,t,n){var r=n(6738),i=n.n(r),o=n(7705),s=n.n(o)()(i());s.push([e.id,".vc-group .vc-group-preview {\n  -webkit-touch-callout: none;\n}\n.vc-group .vc-group-preview:active {\n  background-color: var(--VC-BG-COLOR-ACTIVE);\n}\n.vc-group .vc-group-detail {\n  display: none;\n  padding: 0 0 0.76923077em 1.53846154em;\n  border-bottom: 1px solid var(--VC-FG-3);\n}\n.vc-group.vc-actived .vc-group-detail {\n  display: block;\n  background-color: var(--VC-BG-1);\n}\n.vc-group.vc-actived .vc-table-row {\n  background-color: var(--VC-BG-2);\n}\n.vc-group.vc-actived .vc-group-preview {\n  background-color: var(--VC-BG-1);\n}\n",""]),t.Z=s},3411:function(e,t,n){var r=n(3379),i=n.n(r),o=n(7795),s=n.n(o),a=n(569),c=n.n(a),l=n(3565),d=n.n(l),u=n(9216),p=n.n(u),h=n(4589),g=n.n(h),m=n(1130),f={};m.Z&&m.Z.locals&&(f.locals=m.Z.locals);var v,y=0,_={};_.styleTagTransform=g(),_.setAttributes=d(),_.insert=c().bind(null,"head"),_.domAPI=s(),_.insertStyleElement=p(),f.use=function(e){return _.options=e||{},y++||(v=i()(m.Z,_)),f},f.unuse=function(){y>0&&! --y&&(v(),v=null)},t.Z=f},3379:function(e){var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},s=[],a=0;a<e.length;a++){var c=e[a],l=r.base?c[0]+r.base:c[0],d=o[l]||0,u="".concat(l," ").concat(d);o[l]=d+1;var p=n(u),h={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)t[p].references++,t[p].updater(h);else{var g=i(h,r);r.byIndex=a,t.splice(a,0,{identifier:u,updater:g,references:1})}s.push(u)}return s}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var o=r(e=e||[],i=i||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var a=n(o[s]);t[a].references--}for(var c=r(e,i),l=0;l<o.length;l++){var d=n(o[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=c}}},569:function(e){var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(r){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},9216:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:function(e){e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},6464:function(e,t,n){function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,{Z:function(){return r}})},4296:function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}n.d(t,{Z:function(){return i}})},8270:function(e,t,n){function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{Z:function(){return r}})},6881:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(2717);function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(0,r.Z)(e,t)}},2717:function(e,t,n){function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,{Z:function(){return r}})},7003:function(e,t,n){n.d(t,{H3:function(){return r.H3E},ev:function(){return r.evW},x:function(){return r.xa3}});var r=n(2942)},2942:function(e,t,n){function r(){}function i(e){return e()}function o(){return Object.create(null)}function s(e){e.forEach(i)}function a(e){return"function"==typeof e}function c(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t}function d(e){if(null==e)return r;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var o=e.subscribe.apply(e,n);return o.unsubscribe?function(){return o.unsubscribe()}:o}function u(e){var t;return d(e,function(e){return t=e})(),t}function p(e,t,n){e.$$.on_destroy.push(d(t,n))}function h(e,t,n,r){if(e){var i=g(e,t,n,r);return e[0](i)}}function g(e,t,n,r){return e[1]&&r?function(e,t){for(var n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function m(e,t,n,r){if(e[2]&&r){var i=e[2](r(n));if(void 0===t.dirty)return i;if("object"==typeof i){for(var o=[],s=Math.max(t.dirty.length,i.length),a=0;a<s;a+=1)o[a]=t.dirty[a]|i[a];return o}return t.dirty|i}return t.dirty}function f(e,t,n,r,i,o){if(i){var s=g(t,n,r,o);e.p(s,i)}}function v(e){if(e.ctx.length>32){for(var t=[],n=e.ctx.length/32,r=0;r<n;r++)t[r]=-1;return t}return-1}function y(e){var t={};for(var n in e)t[n]=!0;return t}function _(e,t,n){return e.set(n),t}function I(e,t){e.appendChild(t)}function T(e,t,n){e.insertBefore(t,n||null)}function S(e){e.parentNode.removeChild(e)}function E(e,t){for(var n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function M(e){return document.createElement(e)}function b(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function C(e){return document.createTextNode(e)}function A(){return C(" ")}function O(){return C("")}function R(e,t,n,r){return e.addEventListener(t,n,r),function(){return e.removeEventListener(t,n,r)}}function N(e){return function(t){return t.preventDefault(),e.call(this,t)}}function w(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function P(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function k(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function L(e,t){e.value=null==t?"":t}function x(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function V(e,t,n){e.classList[n?"add":"remove"](t)}var D;function U(e){D=e}function $(){if(!D)throw new Error("Function called outside component initialization");return D}function B(e){$().$$.on_mount.push(e)}function F(e){$().$$.on_destroy.push(e)}function j(){var e=$();return function(t,n){var r=e.$$.callbacks[t];if(r){var i=function(e,t,n){void 0===n&&(n=!1);var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,!1,t),r}(t,n);r.slice().forEach(function(t){t.call(e,i)})}}}function q(e,t){var n=this,r=e.$$.callbacks[t.type];r&&r.slice().forEach(function(e){return e.call(n,t)})}n.d(t,{f_C:function(){return ve},hjT:function(){return X},R3I:function(){return I},Ljt:function(){return P},akz:function(){return ue},VnY:function(){return H},cKT:function(){return q},gbL:function(){return oe},FIv:function(){return p},XGm:function(){return y},xa3:function(){return j},YCL:function(){return pe},nuO:function(){return h},vpE:function(){return ge},RMB:function(){return E},ogt:function(){return S},bGB:function(){return M},cSb:function(){return O},yl1:function(){return ee},VOJ:function(){return v},u2N:function(){return m},$XI:function(){return u},lig:function(){return ce},dvw:function(){return ie},S1n:function(){return fe},$Tr:function(){return T},sBU:function(){return a},oLt:function(){return R},yef:function(){return he},ZTd:function(){return r},AqN:function(){return l},evW:function(){return F},H3E:function(){return B},cly:function(){return le},AT7:function(){return N},j7q:function(){return s},N8:function(){return c},rTO:function(){return k},BmG:function(){return L},fxP:function(){return _},czc:function(){return x},DhX:function(){return A},XET:function(){return w},LdU:function(){return d},bi5:function(){return b},fLW:function(){return C},VHj:function(){return V},Ui:function(){return se},etI:function(){return ae},GQg:function(){return de},kmG:function(){return f}}),n(2717),n(6881);var G=[],H=[],W=[],z=[],K=Promise.resolve(),Y=!1;function J(e){W.push(e)}function X(e){z.push(e)}var Q=new Set,Z=0;function ee(){var e=D;do{for(;Z<G.length;){var t=G[Z];Z++,U(t),te(t.$$)}for(U(null),G.length=0,Z=0;H.length;)H.pop()();for(var n=0;n<W.length;n+=1){var r=W[n];Q.has(r)||(Q.add(r),r())}W.length=0}while(G.length);for(;z.length;)z.pop()();Y=!1,Q.clear(),U(e)}function te(e){if(null!==e.fragment){e.update(),s(e.before_update);var t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(J)}}var ne,re=new Set;function ie(){ne={r:0,c:[],p:ne}}function oe(){ne.r||s(ne.c),ne=ne.p}function se(e,t){e&&e.i&&(re.delete(e),e.i(t))}function ae(e,t,n,r){if(e&&e.o){if(re.has(e))return;re.add(e),ne.c.push(function(){re.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}var ce="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:commonjsGlobal$1;function le(e,t){ae(e,1,1,function(){t.delete(e.key)})}function de(e,t,n,r,i,o,s,a,c,l,d,u){for(var p=e.length,h=o.length,g=p,m={};g--;)m[e[g].key]=g;var f=[],v=new Map,y=new Map;for(g=h;g--;){var _=u(i,o,g),I=n(_),T=s.get(I);T?r&&T.p(_,t):(T=l(I,_)).c(),v.set(I,f[g]=T),I in m&&y.set(I,Math.abs(g-m[I]))}var S=new Set,E=new Set;function M(e){se(e,1),e.m(a,d),s.set(e.key,e),d=e.first,h--}for(;p&&h;){var b=f[h-1],C=e[p-1],A=b.key,O=C.key;b===C?(d=b.first,p--,h--):v.has(O)?!s.has(A)||S.has(A)?M(b):E.has(O)?p--:y.get(A)>y.get(O)?(E.add(A),M(b)):(S.add(O),p--):(c(C,s),p--)}for(;p--;){var R=e[p];v.has(R.key)||c(R,s)}for(;h;)M(f[h-1]);return f}function ue(e,t,n){var r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function pe(e){e&&e.c()}function he(e,t,n,r){var o=e.$$,c=o.fragment,l=o.on_mount,d=o.on_destroy,u=o.after_update;c&&c.m(t,n),r||J(function(){var t=l.map(i).filter(a);d?d.push.apply(d,t):s(t),e.$$.on_mount=[]}),u.forEach(J)}function ge(e,t){var n=e.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function me(e,t){-1===e.$$.dirty[0]&&(G.push(e),Y||(Y=!0,K.then(ee)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function fe(e,t,n,i,a,c,l,d){void 0===d&&(d=[-1]);var u=D;U(e);var p=e.$$={fragment:null,ctx:null,props:c,update:r,not_equal:a,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:o(),dirty:d,skip_bound:!1,root:t.target||u.$$.root};l&&l(p.root);var h,g=!1;if(p.ctx=n?n(e,t.props||{},function(t,n){var r=!(arguments.length<=2)&&arguments.length-2?arguments.length<=2?void 0:arguments[2]:n;return p.ctx&&a(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),g&&me(e,t)),n}):[],p.update(),g=!0,s(p.before_update),p.fragment=!!i&&i(p.ctx),t.target){if(t.hydrate){var m=(h=t.target,Array.from(h.childNodes));p.fragment&&p.fragment.l(m),m.forEach(S)}else p.fragment&&p.fragment.c();t.intro&&se(e.$$.fragment),he(e,t.target,t.anchor,t.customElement),ee()}U(u)}var ve=function(){function e(){}var t=e.prototype;return t.$destroy=function(){ge(this,1),this.$destroy=r},t.$on=function(e,t){var n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}},t.$set=function(e){this.$$set&&!function(e){return 0===Object.keys(e).length}(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)},e}()},3313:function(e,t,n){n.d(t,{U2:function(){return r.$XI},fZ:function(){return s}});var r=n(2942);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=[];function s(e,t){var n;void 0===t&&(t=r.ZTd);var s=new Set;function a(t){if((0,r.N8)(e,t)&&(e=t,n)){for(var a,c=!o.length,l=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(s);!(a=l()).done;){var d=a.value;d[1](),o.push(d,e)}if(c){for(var u=0;u<o.length;u+=2)o[u][0](o[u+1]);o.length=0}}}return{set:a,update:function(t){a(t(e))},subscribe:function(i,o){void 0===o&&(o=r.ZTd);var c=[i,o];return s.add(c),1===s.size&&(n=t(a)||r.ZTd),i(e),function(){s.delete(c),0===s.size&&(n(),n=null)}}}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=function(e,t){for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t2){if("object"==typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var __webpack_exports__={};return function(){__webpack_require__.d(__webpack_exports__,{default:function(){return Ti}}),__webpack_require__(5441),__webpack_require__(8765);var e=__webpack_require__(4296),t=__webpack_require__(5103),n={one:function(e,t){void 0===t&&(t=document);try{return t.querySelector(e)||void 0}catch(n){return}},all:function(e,t){void 0===t&&(t=document);try{var n=t.querySelectorAll(e);return[].slice.call(n)}catch(r){return[]}},addClass:function(e,n){if(e)for(var r=(0,t.kJ)(e)?e:[e],i=0;i<r.length;i++){var o=(r[i].className||"").split(" ");o.indexOf(n)>-1||(o.push(n),r[i].className=o.join(" "))}},removeClass:function(e,n){if(e)for(var r=(0,t.kJ)(e)?e:[e],i=0;i<r.length;i++){for(var o=r[i].className.split(" "),s=0;s<o.length;s++)o[s]==n&&(o[s]="");r[i].className=o.join(" ").trim()}},hasClass:function(e,t){return!(!e||!e.classList)&&e.classList.contains(t)},bind:function(e,n,r,i){void 0===i&&(i=!1),e&&((0,t.kJ)(e)?e:[e]).forEach(function(e){e.addEventListener(n,r,!!i)})},delegate:function(e,t,r,i){e&&e.addEventListener(t,function(t){var o=n.all(r,e);if(o)e:for(var s=0;s<o.length;s++)for(var a=t.target;a;){if(a==o[s]){i.call(a,t,a);break e}if((a=a.parentNode)==e)break}},!1)},removeChildren:function(e){for(;e.firstChild;)e.removeChild(e.lastChild);return e}},r=n,i=__webpack_require__(6464),o=__webpack_require__(6881),s=__webpack_require__(2942),a=__webpack_require__(7003),c=__webpack_require__(3379),l=__webpack_require__.n(c),d=__webpack_require__(7795),u=__webpack_require__.n(d),p=__webpack_require__(569),h=__webpack_require__.n(p),g=__webpack_require__(3565),m=__webpack_require__.n(g),f=__webpack_require__(9216),v=__webpack_require__.n(f),y=__webpack_require__(4589),_=__webpack_require__.n(y),I=__webpack_require__(7558),T={};I.Z&&I.Z.locals&&(T.locals=I.Z.locals);var S,E=0,M={};M.styleTagTransform=_(),M.setAttributes=m(),M.insert=h().bind(null,"head"),M.domAPI=u(),M.insertStyleElement=v(),T.use=function(e){return M.options=e||{},E++||(S=l()(I.Z,M)),T},T.unuse=function(){E>0&&! --E&&(S(),S=null)};var b=T;function C(e){var t,n,r,i;return{c:function(){t=(0,s.bGB)("div"),n=(0,s.fLW)("vConsole"),(0,s.Ljt)(t,"class","vc-switch"),(0,s.czc)(t,"right",e[2].x+"px"),(0,s.czc)(t,"bottom",e[2].y+"px"),(0,s.czc)(t,"display",e[0]?"block":"none")},m:function(o,a){(0,s.$Tr)(o,t,a),(0,s.R3I)(t,n),e[8](t),r||(i=[(0,s.oLt)(t,"touchstart",e[3],{passive:!1}),(0,s.oLt)(t,"touchend",e[4],{passive:!1}),(0,s.oLt)(t,"touchmove",e[5],{passive:!1}),(0,s.oLt)(t,"click",e[7])],r=!0)},p:function(e,n){var r=n[0];4&r&&(0,s.czc)(t,"right",e[2].x+"px"),4&r&&(0,s.czc)(t,"bottom",e[2].y+"px"),1&r&&(0,s.czc)(t,"display",e[0]?"block":"none")},i:s.ZTd,o:s.ZTd,d:function(n){n&&(0,s.ogt)(t),e[8](null),r=!1,(0,s.j7q)(i)}}}function A(e,n,r){var i,o=n.show,c=void 0===o||o,l=n.position,d=void 0===l?{x:0,y:0}:l,u={hasMoved:!1,x:0,y:0,startX:0,startY:0,endX:0,endY:0},p={x:0,y:0};(0,a.H3)(function(){b.use()}),(0,a.ev)(function(){b.unuse()});var h=function(e,n){var i=g(e,n);e=i[0],n=i[1],u.x=e,u.y=n,r(2,p.x=e,p),r(2,p.y=n,p),t.po("switch_x",e+""),t.po("switch_y",n+"")},g=function(e,t){var n=Math.max(document.documentElement.offsetWidth,window.innerWidth),r=Math.max(document.documentElement.offsetHeight,window.innerHeight);return e+i.offsetWidth>n&&(e=n-i.offsetWidth),t+i.offsetHeight>r&&(t=r-i.offsetHeight),e<0&&(e=0),t<20&&(t=20),[e,t]};return e.$$set=function(e){"show"in e&&r(0,c=e.show),"position"in e&&r(6,d=e.position)},e.$$.update=function(){66&e.$$.dirty&&i&&h(d.x,d.y)},[c,i,p,function(e){u.startX=e.touches[0].pageX,u.startY=e.touches[0].pageY,u.hasMoved=!1},function(e){u.hasMoved&&(u.startX=0,u.startY=0,u.hasMoved=!1,h(u.endX,u.endY))},function(e){if(!(e.touches.length<=0)){var t=e.touches[0].pageX-u.startX,n=e.touches[0].pageY-u.startY,i=Math.floor(u.x-t),o=Math.floor(u.y-n),s=g(i,o);i=s[0],o=s[1],r(2,p.x=i,p),r(2,p.y=o,p),u.endX=i,u.endY=o,u.hasMoved=!0,e.preventDefault()}},d,function(t){s.cKT.call(this,e,t)},function(e){s.VnY[e?"unshift":"push"](function(){r(1,i=e)})}]}var O=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,A,C,s.N8,{show:0,position:6}),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"show",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({show:e}),(0,s.yl1)()}},{key:"position",get:function(){return this.$$.ctx[6]},set:function(e){this.$$set({position:e}),(0,s.yl1)()}}]),n}(s.f_C);function R(e){var t,n;return{c:function(){t=(0,s.bGB)("div"),(0,s.Ljt)(t,"id",n="__vc_plug_"+e[0]),(0,s.Ljt)(t,"class","vc-plugin-box"),(0,s.VHj)(t,"vc-fixed-height",e[1]),(0,s.VHj)(t,"vc-actived",e[2])},m:function(n,r){(0,s.$Tr)(n,t,r),e[6](t)},p:function(e,r){var i=r[0];1&i&&n!==(n="__vc_plug_"+e[0])&&(0,s.Ljt)(t,"id",n),2&i&&(0,s.VHj)(t,"vc-fixed-height",e[1]),4&i&&(0,s.VHj)(t,"vc-actived",e[2])},i:s.ZTd,o:s.ZTd,d:function(n){n&&(0,s.ogt)(t),e[6](null)}}}function N(e,n,r){var i=n.pluginId,o=void 0===i?"":i,a=n.fixedHeight,c=void 0!==a&&a,l=n.actived,d=void 0!==l&&l,u=n.content,p=void 0===u?void 0:u,h=void 0,g=void 0;return e.$$set=function(e){"pluginId"in e&&r(0,o=e.pluginId),"fixedHeight"in e&&r(1,c=e.fixedHeight),"actived"in e&&r(2,d=e.actived),"content"in e&&r(4,p=e.content)},e.$$.update=function(){57&e.$$.dirty&&g!==o&&p&&h&&(r(5,g=o),r(3,h.innerHTML="",h),(0,t.HD)(p)?r(3,h.innerHTML=p,h):(0,t.kK)(p)&&h.appendChild(p))},[o,c,d,h,p,g,function(e){s.VnY[e?"unshift":"push"](function(){r(3,h=e),r(5,g),r(0,o),r(4,p)})}]}var w=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,N,R,s.N8,{pluginId:0,fixedHeight:1,actived:2,content:4}),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"pluginId",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({pluginId:e}),(0,s.yl1)()}},{key:"fixedHeight",get:function(){return this.$$.ctx[1]},set:function(e){this.$$set({fixedHeight:e}),(0,s.yl1)()}},{key:"actived",get:function(){return this.$$.ctx[2]},set:function(e){this.$$set({actived:e}),(0,s.yl1)()}},{key:"content",get:function(){return this.$$.ctx[4]},set:function(e){this.$$set({content:e}),(0,s.yl1)()}}]),n}(s.f_C),P=__webpack_require__(4687),k=__webpack_require__(3283),L={};k.Z&&k.Z.locals&&(L.locals=k.Z.locals);var x,V=0,D={};D.styleTagTransform=_(),D.setAttributes=m(),D.insert=h().bind(null,"head"),D.domAPI=u(),D.insertStyleElement=v(),L.use=function(e){return D.options=e||{},V++||(x=l()(k.Z,D)),L},L.unuse=function(){V>0&&! --V&&(x(),x=null)};var U=L;function $(e,t,n){var r=e.slice();return r[39]=t[n][0],r[40]=t[n][1],r}function B(e,t,n){var r=e.slice();return r[43]=t[n],r[45]=n,r}function F(e,t,n){var r=e.slice();return r[39]=t[n][0],r[40]=t[n][1],r}function j(e,t,n){var r=e.slice();return r[39]=t[n][0],r[40]=t[n][1],r}function q(e,t,n){var r=e.slice();return r[43]=t[n],r[45]=n,r}function G(e,t,n){var r=e.slice();return r[39]=t[n][0],r[40]=t[n][1],r}function H(e){var t,n,r,i,o,a=e[40].name+"";function c(){return e[25](e[40])}return{c:function(){t=(0,s.bGB)("a"),n=(0,s.fLW)(a),(0,s.Ljt)(t,"class","vc-tab"),(0,s.Ljt)(t,"id",r="__vc_tab_"+e[40].id),(0,s.VHj)(t,"vc-actived",e[40].id===e[2])},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n),i||(o=(0,s.oLt)(t,"click",c),i=!0)},p:function(i,o){e=i,8&o[0]&&a!==(a=e[40].name+"")&&(0,s.rTO)(n,a),8&o[0]&&r!==(r="__vc_tab_"+e[40].id)&&(0,s.Ljt)(t,"id",r),12&o[0]&&(0,s.VHj)(t,"vc-actived",e[40].id===e[2])},d:function(e){e&&(0,s.ogt)(t),i=!1,o()}}}function W(e){var t,n=e[40].hasTabPanel&&H(e);return{c:function(){n&&n.c(),t=(0,s.cSb)()},m:function(e,r){n&&n.m(e,r),(0,s.$Tr)(e,t,r)},p:function(e,r){e[40].hasTabPanel?n?n.p(e,r):((n=H(e)).c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d:function(e){n&&n.d(e),e&&(0,s.ogt)(t)}}}function z(e){var t,n,r,i,o,a=e[43].name+"";function c(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e)[26].apply(t,[e[40],e[45]].concat(r))}return{c:function(){t=(0,s.bGB)("i"),n=(0,s.fLW)(a),(0,s.Ljt)(t,"class",r="vc-toptab vc-topbar-"+e[40].id+" "+e[43].className),(0,s.VHj)(t,"vc-toggle",e[40].id===e[2]),(0,s.VHj)(t,"vc-actived",e[43].actived)},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n),i||(o=(0,s.oLt)(t,"click",c),i=!0)},p:function(i,o){e=i,8&o[0]&&a!==(a=e[43].name+"")&&(0,s.rTO)(n,a),8&o[0]&&r!==(r="vc-toptab vc-topbar-"+e[40].id+" "+e[43].className)&&(0,s.Ljt)(t,"class",r),12&o[0]&&(0,s.VHj)(t,"vc-toggle",e[40].id===e[2]),8&o[0]&&(0,s.VHj)(t,"vc-actived",e[43].actived)},d:function(e){e&&(0,s.ogt)(t),i=!1,o()}}}function K(e){for(var t,n=e[40].topbarList,r=[],i=0;i<n.length;i+=1)r[i]=z(q(e,n,i));return{c:function(){for(var e=0;e<r.length;e+=1)r[e].c();t=(0,s.cSb)()},m:function(e,n){for(var i=0;i<r.length;i+=1)r[i].m(e,n);(0,s.$Tr)(e,t,n)},p:function(e,i){if(8204&i[0]){var o;for(n=e[40].topbarList,o=0;o<n.length;o+=1){var s=q(e,n,o);r[o]?r[o].p(s,i):(r[o]=z(s),r[o].c(),r[o].m(t.parentNode,t))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d:function(e){(0,s.RMB)(r,e),e&&(0,s.ogt)(t)}}}function Y(e){var t,n,r,i=w;function o(e){var t;return{props:{pluginId:e[40].id,fixedHeight:null==(t=e[40].tabOptions)?void 0:t.fixedHeight,actived:e[40].id===e[2],content:e[40].content}}}return i&&(t=new i(o(e))),{c:function(){t&&(0,s.YCL)(t.$$.fragment),n=(0,s.cSb)()},m:function(e,i){t&&(0,s.yef)(t,e,i),(0,s.$Tr)(e,n,i),r=!0},p:function(e,r){var a,c={};if(8&r[0]&&(c.pluginId=e[40].id),8&r[0]&&(c.fixedHeight=null==(a=e[40].tabOptions)?void 0:a.fixedHeight),12&r[0]&&(c.actived=e[40].id===e[2]),8&r[0]&&(c.content=e[40].content),i!==(i=w)){if(t){(0,s.dvw)();var l=t;(0,s.etI)(l.$$.fragment,1,0,function(){(0,s.vpE)(l,1)}),(0,s.gbL)()}i?(t=new i(o(e)),(0,s.YCL)(t.$$.fragment),(0,s.Ui)(t.$$.fragment,1),(0,s.yef)(t,n.parentNode,n)):t=null}else i&&t.$set(c)},i:function(e){r||(t&&(0,s.Ui)(t.$$.fragment,e),r=!0)},o:function(e){t&&(0,s.etI)(t.$$.fragment,e),r=!1},d:function(e){e&&(0,s.ogt)(n),t&&(0,s.vpE)(t,e)}}}function J(e){var t,n,r,i,o,a=e[43].name+"";function c(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e)[28].apply(t,[e[40],e[45]].concat(r))}return{c:function(){t=(0,s.bGB)("i"),n=(0,s.fLW)(a),(0,s.Ljt)(t,"class",r="vc-tool vc-tool-"+e[40].id),(0,s.VHj)(t,"vc-global-tool",e[43].global),(0,s.VHj)(t,"vc-toggle",e[40].id===e[2])},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n),i||(o=(0,s.oLt)(t,"click",c),i=!0)},p:function(i,o){e=i,8&o[0]&&a!==(a=e[43].name+"")&&(0,s.rTO)(n,a),8&o[0]&&r!==(r="vc-tool vc-tool-"+e[40].id)&&(0,s.Ljt)(t,"class",r),8&o[0]&&(0,s.VHj)(t,"vc-global-tool",e[43].global),12&o[0]&&(0,s.VHj)(t,"vc-toggle",e[40].id===e[2])},d:function(e){e&&(0,s.ogt)(t),i=!1,o()}}}function X(e){for(var t,n=e[40].toolbarList,r=[],i=0;i<n.length;i+=1)r[i]=J(B(e,n,i));return{c:function(){for(var e=0;e<r.length;e+=1)r[e].c();t=(0,s.cSb)()},m:function(e,n){for(var i=0;i<r.length;i+=1)r[i].m(e,n);(0,s.$Tr)(e,t,n)},p:function(e,i){if(16396&i[0]){var o;for(n=e[40].toolbarList,o=0;o<n.length;o+=1){var s=B(e,n,o);r[o]?r[o].p(s,i):(r[o]=J(s),r[o].c(),r[o].m(t.parentNode,t))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d:function(e){(0,s.RMB)(r,e),e&&(0,s.ogt)(t)}}}function Q(e){var t,n,r,i,o,a,c,l,d,u,p,h,g,m,f,v,y,_,I,T,S;function E(t){e[23](t)}function M(t){e[24](t)}var b={};void 0!==e[0]&&(b.show=e[0]),void 0!==e[1]&&(b.position=e[1]),n=new O({props:b}),s.VnY.push(function(){return(0,s.akz)(n,"show",E)}),s.VnY.push(function(){return(0,s.akz)(n,"position",M)}),n.$on("click",e[10]);for(var C=Object.entries(e[3]),A=[],R=0;R<C.length;R+=1)A[R]=W(G(e,C,R));for(var N=Object.entries(e[3]),w=[],P=0;P<N.length;P+=1)w[P]=K(j(e,N,P));for(var k=Object.entries(e[3]),L=[],x=0;x<k.length;x+=1)L[x]=Y(F(e,k,x));for(var V=function(e){return(0,s.etI)(L[e],1,1,function(){L[e]=null})},D=Object.entries(e[3]),U=[],B=0;B<D.length;B+=1)U[B]=X($(e,D,B));return{c:function(){var r,i;t=(0,s.bGB)("div"),(0,s.YCL)(n.$$.fragment),o=(0,s.DhX)(),a=(0,s.bGB)("div"),c=(0,s.DhX)(),l=(0,s.bGB)("div"),d=(0,s.bGB)("div");for(var I=0;I<A.length;I+=1)A[I].c();u=(0,s.DhX)(),p=(0,s.bGB)("div");for(var T=0;T<w.length;T+=1)w[T].c();h=(0,s.DhX)(),g=(0,s.bGB)("div");for(var S=0;S<L.length;S+=1)L[S].c();m=(0,s.DhX)(),f=(0,s.bGB)("div");for(var E=0;E<U.length;E+=1)U[E].c();v=(0,s.DhX)(),(y=(0,s.bGB)("i")).textContent="Hide",(0,s.Ljt)(a,"class","vc-mask"),(0,s.czc)(a,"display",e[8]?"block":"none"),(0,s.Ljt)(d,"class","vc-tabbar"),(0,s.Ljt)(p,"class","vc-topbar"),(0,s.Ljt)(g,"class","vc-content"),(0,s.VHj)(g,"vc-has-topbar",(null==(r=e[3][e[2]])||null==(i=r.topbarList)?void 0:i.length)>0),(0,s.Ljt)(y,"class","vc-tool vc-global-tool vc-tool-last vc-hide"),(0,s.Ljt)(f,"class","vc-toolbar"),(0,s.Ljt)(l,"class","vc-panel"),(0,s.czc)(l,"display",e[7]?"block":"none"),(0,s.Ljt)(t,"id","__vconsole"),(0,s.Ljt)(t,"style",_=e[5]?"font-size:"+e[5]+";":""),(0,s.Ljt)(t,"data-theme",e[4]),(0,s.VHj)(t,"vc-toggle",e[6])},m:function(r,i){(0,s.$Tr)(r,t,i),(0,s.yef)(n,t,null),(0,s.R3I)(t,o),(0,s.R3I)(t,a),(0,s.R3I)(t,c),(0,s.R3I)(t,l),(0,s.R3I)(l,d);for(var _=0;_<A.length;_+=1)A[_].m(d,null);(0,s.R3I)(l,u),(0,s.R3I)(l,p);for(var E=0;E<w.length;E+=1)w[E].m(p,null);(0,s.R3I)(l,h),(0,s.R3I)(l,g);for(var M=0;M<L.length;M+=1)L[M].m(g,null);e[27](g),(0,s.R3I)(l,m),(0,s.R3I)(l,f);for(var b=0;b<U.length;b+=1)U[b].m(f,null);(0,s.R3I)(f,v),(0,s.R3I)(f,y),I=!0,T||(S=[(0,s.oLt)(a,"click",e[11]),(0,s.oLt)(g,"touchstart",e[15]),(0,s.oLt)(g,"touchmove",e[16]),(0,s.oLt)(g,"touchend",e[17]),(0,s.oLt)(g,"scroll",e[18]),(0,s.oLt)(y,"click",e[11]),(0,s.oLt)(t,"touchstart",e[19].touchStart,{passive:!1,capture:!0}),(0,s.oLt)(t,"touchmove",e[19].touchMove,{passive:!1,capture:!0}),(0,s.oLt)(t,"touchend",e[19].touchEnd,{passive:!1,capture:!0})],T=!0)},p:function(e,o){var c,u,h={};if(!r&&1&o[0]&&(r=!0,h.show=e[0],(0,s.hjT)(function(){return r=!1})),!i&&2&o[0]&&(i=!0,h.position=e[1],(0,s.hjT)(function(){return i=!1})),n.$set(h),(!I||256&o[0])&&(0,s.czc)(a,"display",e[8]?"block":"none"),4108&o[0]){var m;for(C=Object.entries(e[3]),m=0;m<C.length;m+=1){var y=G(e,C,m);A[m]?A[m].p(y,o):(A[m]=W(y),A[m].c(),A[m].m(d,null))}for(;m<A.length;m+=1)A[m].d(1);A.length=C.length}if(8204&o[0]){var T;for(N=Object.entries(e[3]),T=0;T<N.length;T+=1){var S=j(e,N,T);w[T]?w[T].p(S,o):(w[T]=K(S),w[T].c(),w[T].m(p,null))}for(;T<w.length;T+=1)w[T].d(1);w.length=N.length}if(12&o[0]){var E;for(k=Object.entries(e[3]),E=0;E<k.length;E+=1){var M=F(e,k,E);L[E]?(L[E].p(M,o),(0,s.Ui)(L[E],1)):(L[E]=Y(M),L[E].c(),(0,s.Ui)(L[E],1),L[E].m(g,null))}for((0,s.dvw)(),E=k.length;E<L.length;E+=1)V(E);(0,s.gbL)()}if(12&o[0]&&(0,s.VHj)(g,"vc-has-topbar",(null==(c=e[3][e[2]])||null==(u=c.topbarList)?void 0:u.length)>0),16396&o[0]){var b;for(D=Object.entries(e[3]),b=0;b<D.length;b+=1){var O=$(e,D,b);U[b]?U[b].p(O,o):(U[b]=X(O),U[b].c(),U[b].m(f,v))}for(;b<U.length;b+=1)U[b].d(1);U.length=D.length}(!I||128&o[0])&&(0,s.czc)(l,"display",e[7]?"block":"none"),(!I||32&o[0]&&_!==(_=e[5]?"font-size:"+e[5]+";":""))&&(0,s.Ljt)(t,"style",_),(!I||16&o[0])&&(0,s.Ljt)(t,"data-theme",e[4]),64&o[0]&&(0,s.VHj)(t,"vc-toggle",e[6])},i:function(e){if(!I){(0,s.Ui)(n.$$.fragment,e);for(var t=0;t<k.length;t+=1)(0,s.Ui)(L[t]);I=!0}},o:function(e){(0,s.etI)(n.$$.fragment,e),L=L.filter(Boolean);for(var t=0;t<L.length;t+=1)(0,s.etI)(L[t]);I=!1},d:function(r){r&&(0,s.ogt)(t),(0,s.vpE)(n),(0,s.RMB)(A,r),(0,s.RMB)(w,r),(0,s.RMB)(L,r),e[27](null),(0,s.RMB)(U,r),T=!1,(0,s.j7q)(S)}}}function Z(e,n,r){var i,o,c=n.theme,l=void 0===c?"":c,d=n.disableScrolling,u=void 0!==d&&d,p=n.show,h=void 0!==p&&p,g=n.showSwitchButton,m=void 0===g||g,f=n.switchButtonPosition,v=void 0===f?{x:0,y:0}:f,y=n.activedPluginId,_=void 0===y?"":y,I=n.pluginList,T=void 0===I?{}:I,S=(0,a.x)(),E=!1,M="",b=!1,C=!1,A=!1,O=!0,R=0,N=null,w={};(0,a.H3)(function(){var e=document.querySelectorAll('[name="viewport"]');if(e&&e[0]){var t=(e[e.length-1].getAttribute("content")||"").match(/initial\-scale\=\d+(\.\d+)?/),n=t?parseFloat(t[0].split("=")[1]):1;1!==n&&r(5,M=Math.floor(1/n*13)+"px")}U.use&&U.use(),i=P.x.subscribe(function(e){h&&R!==e.updateTime&&(R=e.updateTime,k())})}),(0,a.ev)(function(){U.unuse&&U.unuse(),i&&i()});var k=function(){!u&&O&&o&&r(9,o.scrollTop=o.scrollHeight-o.offsetHeight,o)},L=function(e){e!==_&&(r(2,_=e),S("changePanel",{pluginId:e}),setTimeout(function(){o&&r(9,o.scrollTop=w[_]||0,o)},0))},x=function(e,n,i){var o=T[n].topbarList[i],s=!0;if(t.mf(o.onClick)&&(s=o.onClick.call(e.target,e,o.data)),!1===s);else{for(var a=0;a<T[n].topbarList.length;a++)r(3,T[n].topbarList[a].actived=i===a,T);r(3,T)}},V=function(e,n,r){var i=T[n].toolbarList[r];t.mf(i.onClick)&&i.onClick.call(e.target,e,i.data)},D={tapTime:700,tapBoundary:10,lastTouchStartTime:0,touchstartX:0,touchstartY:0,touchHasMoved:!1,targetElem:null},$={touchStart:function(e){if(0===D.lastTouchStartTime){var t=e.targetTouches[0];D.touchstartX=t.pageX,D.touchstartY=t.pageY,D.lastTouchStartTime=e.timeStamp,D.targetElem=e.target.nodeType===Node.TEXT_NODE?e.target.parentNode:e.target}},touchMove:function(e){var t=e.changedTouches[0];(Math.abs(t.pageX-D.touchstartX)>D.tapBoundary||Math.abs(t.pageY-D.touchstartY)>D.tapBoundary)&&(D.touchHasMoved=!0)},touchEnd:function(e){if(!1===D.touchHasMoved&&e.timeStamp-D.lastTouchStartTime<D.tapTime&&null!=D.targetElem){var t=!1;switch(D.targetElem.tagName.toLowerCase()){case"textarea":t=!0;break;case"select":t=!D.targetElem.disabled&&!D.targetElem.readOnly;break;case"input":switch(D.targetElem.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":t=!1;break;default:t=!D.targetElem.disabled&&!D.targetElem.readOnly}}t?D.targetElem.focus():e.preventDefault();var n=e.changedTouches[0],r=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,screenX:n.screenX,screenY:n.screenY,clientX:n.clientX,clientY:n.clientY});D.targetElem.dispatchEvent(r)}D.lastTouchStartTime=0,D.touchHasMoved=!1,D.targetElem=null}};return e.$$set=function(e){"theme"in e&&r(4,l=e.theme),"disableScrolling"in e&&r(20,u=e.disableScrolling),"show"in e&&r(21,h=e.show),"showSwitchButton"in e&&r(0,m=e.showSwitchButton),"switchButtonPosition"in e&&r(1,v=e.switchButtonPosition),"activedPluginId"in e&&r(2,_=e.activedPluginId),"pluginList"in e&&r(3,T=e.pluginList)},e.$$.update=function(){6291456&e.$$.dirty[0]&&(!0===h?(r(7,C=!0),r(8,A=!0),N&&clearTimeout(N),r(22,N=setTimeout(function(){r(6,b=!0),k()},10))):(r(6,b=!1),N&&clearTimeout(N),r(22,N=setTimeout(function(){r(7,C=!1),r(8,A=!1)},330))))},[m,v,_,T,l,M,b,C,A,o,function(e){S("show",{show:!0})},function(e){S("show",{show:!1})},L,x,V,function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){var t=!1;if("function"==typeof window.getComputedStyle){var n=window.getComputedStyle(e.target);"auto"!==n.overflow&&"initial"!==n.overflow&&"scroll"!==n.overflow||(t=!0)}if(!t){var i=o.scrollTop,s=o.scrollHeight,a=i+o.offsetHeight;0===i?(r(9,o.scrollTop=1,o),0===o.scrollTop&&(E=!0)):a===s&&(r(9,o.scrollTop=i-1,o),o.scrollTop===i&&(E=!0))}}},function(e){E&&e.preventDefault()},function(e){E=!1},function(e){h&&(O=o.scrollTop+o.offsetHeight>=o.scrollHeight-50,w[_]=o.scrollTop)},$,u,h,N,function(e){r(0,m=e)},function(e){r(1,v=e)},function(e){return L(e.id)},function(e,t,n){return x(n,e.id,t)},function(e){s.VnY[e?"unshift":"push"](function(){r(9,o=e)})},function(e,t,n){return V(n,e.id,t)}]}var ee=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,Z,Q,s.N8,{theme:4,disableScrolling:20,show:21,showSwitchButton:0,switchButtonPosition:1,activedPluginId:2,pluginList:3},null,[-1,-1]),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"theme",get:function(){return this.$$.ctx[4]},set:function(e){this.$$set({theme:e}),(0,s.yl1)()}},{key:"disableScrolling",get:function(){return this.$$.ctx[20]},set:function(e){this.$$set({disableScrolling:e}),(0,s.yl1)()}},{key:"show",get:function(){return this.$$.ctx[21]},set:function(e){this.$$set({show:e}),(0,s.yl1)()}},{key:"showSwitchButton",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({showSwitchButton:e}),(0,s.yl1)()}},{key:"switchButtonPosition",get:function(){return this.$$.ctx[1]},set:function(e){this.$$set({switchButtonPosition:e}),(0,s.yl1)()}},{key:"activedPluginId",get:function(){return this.$$.ctx[2]},set:function(e){this.$$set({activedPluginId:e}),(0,s.yl1)()}},{key:"pluginList",get:function(){return this.$$.ctx[3]},set:function(e){this.$$set({pluginList:e}),(0,s.yl1)()}}]),n}(s.f_C),te=function(){function n(e,t){void 0===t&&(t="newPlugin"),this.isReady=!1,this.eventMap=new Map,this.exporter=void 0,this._id=void 0,this._name=void 0,this._vConsole=void 0,this.id=e,this.name=t,this.isReady=!1}var r=n.prototype;return r.on=function(e,t){return this.eventMap.set(e,t),this},r.onRemove=function(){this.unbindExporter()},r.trigger=function(e,t){var n=this.eventMap.get(e);if("function"==typeof n)n.call(this,t);else{var r="on"+e.charAt(0).toUpperCase()+e.slice(1);"function"==typeof this[r]&&this[r].call(this,t)}return this},r.bindExporter=function(){if(this._vConsole&&this.exporter){var e="default"===this.id?"log":this.id;this._vConsole[e]=this.exporter}},r.unbindExporter=function(){var e="default"===this.id?"log":this.id;this._vConsole&&this._vConsole[e]&&(this._vConsole[e]=void 0)},r.getUniqueID=function(e){return void 0===e&&(e=""),(0,t.QI)(e)},(0,e.Z)(n,[{key:"id",get:function(){return this._id},set:function(e){if("string"!=typeof e)throw"[vConsole] Plugin ID must be a string.";if(!e)throw"[vConsole] Plugin ID cannot be empty.";this._id=e.toLowerCase()}},{key:"name",get:function(){return this._name},set:function(e){if("string"!=typeof e)throw"[vConsole] Plugin name must be a string.";if(!e)throw"[vConsole] Plugin name cannot be empty.";this._name=e}},{key:"vConsole",get:function(){return this._vConsole||void 0},set:function(e){if(!e)throw"[vConsole] vConsole cannot be empty";this._vConsole=e,this.bindExporter()}}]),n}(),ne=function(e){function t(t,n,r,i){var o;return(o=e.call(this,t,n)||this).CompClass=void 0,o.compInstance=void 0,o.initialProps=void 0,o.CompClass=r,o.initialProps=i,o}(0,o.Z)(t,e);var n=t.prototype;return n.onReady=function(){this.isReady=!0},n.onRenderTab=function(e){var t=document.createElement("div"),n=this.compInstance=new this.CompClass({target:t,props:this.initialProps});e(t.firstElementChild,n.options)},n.onRemove=function(){e.prototype.onRemove&&e.prototype.onRemove.call(this),this.compInstance&&this.compInstance.$destroy()},t}(te),re=__webpack_require__(8665),ie=__webpack_require__(9923),oe=__webpack_require__(8702);function se(e){var t,n;return(t=new oe.Z({props:{name:e[0]?"success":"copy"}})).$on("click",e[1]),{c:function(){(0,s.YCL)(t.$$.fragment)},m:function(e,r){(0,s.yef)(t,e,r),n=!0},p:function(e,n){var r={};1&n[0]&&(r.name=e[0]?"success":"copy"),t.$set(r)},i:function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),n=!1},d:function(e){(0,s.vpE)(t,e)}}}function ae(e,n,r){var i=n.content,o=void 0===i?"":i,s=n.handler,a=void 0===s?void 0:s,c={target:document.documentElement},l=!1;return e.$$set=function(e){"content"in e&&r(2,o=e.content),"handler"in e&&r(3,a=e.handler)},[l,function(e){(function(e,t){var n=(void 0===t?{}:t).target,r=void 0===n?document.body:n,i=document.createElement("textarea"),o=document.activeElement;i.value=e,i.setAttribute("readonly",""),i.style.contain="strict",i.style.position="absolute",i.style.left="-9999px",i.style.fontSize="12pt";var s=document.getSelection(),a=!1;s.rangeCount>0&&(a=s.getRangeAt(0)),r.append(i),i.select(),i.selectionStart=0,i.selectionEnd=e.length;try{document.execCommand("copy")}catch(c){}i.remove(),a&&(s.removeAllRanges(),s.addRange(a)),o&&o.focus()})(t.mf(a)?a(o)||"":t.Kn(o)||t.kJ(o)?t.hZ(o,{maxDepth:10,keyMaxLen:1e4,pretty:!1,standardJSON:!0}):o,c),r(0,l=!0),setTimeout(function(){r(0,l=!1)},600)},o,a]}var ce=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,ae,se,s.N8,{content:2,handler:3}),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"content",get:function(){return this.$$.ctx[2]},set:function(e){this.$$set({content:e}),(0,s.yl1)()}},{key:"handler",get:function(){return this.$$.ctx[3]},set:function(e){this.$$set({handler:e}),(0,s.yl1)()}}]),n}(s.f_C),le=__webpack_require__(845),de={};le.Z&&le.Z.locals&&(de.locals=le.Z.locals);var ue,pe=0,he={};he.styleTagTransform=_(),he.setAttributes=m(),he.insert=h().bind(null,"head"),he.domAPI=u(),he.insertStyleElement=v(),de.use=function(e){return he.options=e||{},pe++||(ue=l()(le.Z,he)),de},de.unuse=function(){pe>0&&! --pe&&(ue(),ue=null)};var ge=de;function me(e){var n,r,i,o=t.rE(e[1])+"";return{c:function(){n=(0,s.bGB)("i"),r=(0,s.fLW)(o),i=(0,s.fLW)(":"),(0,s.Ljt)(n,"class","vc-log-key"),(0,s.VHj)(n,"vc-log-key-symbol","symbol"===e[2]),(0,s.VHj)(n,"vc-log-key-private","private"===e[2])},m:function(e,t){(0,s.$Tr)(e,n,t),(0,s.R3I)(n,r),(0,s.$Tr)(e,i,t)},p:function(e,i){2&i&&o!==(o=t.rE(e[1])+"")&&(0,s.rTO)(r,o),4&i&&(0,s.VHj)(n,"vc-log-key-symbol","symbol"===e[2]),4&i&&(0,s.VHj)(n,"vc-log-key-private","private"===e[2])},d:function(e){e&&(0,s.ogt)(n),e&&(0,s.ogt)(i)}}}function fe(e){var t,n,r,i,o=void 0!==e[1]&&me(e);return{c:function(){o&&o.c(),t=(0,s.DhX)(),n=(0,s.bGB)("i"),r=(0,s.fLW)(e[3]),(0,s.Ljt)(n,"class",i="vc-log-val vc-log-val-"+e[4]),(0,s.Ljt)(n,"style",e[0]),(0,s.VHj)(n,"vc-log-val-haskey",void 0!==e[1])},m:function(e,i){o&&o.m(e,i),(0,s.$Tr)(e,t,i),(0,s.$Tr)(e,n,i),(0,s.R3I)(n,r)},p:function(e,a){var c=a[0];void 0!==e[1]?o?o.p(e,c):((o=me(e)).c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null),8&c&&(0,s.rTO)(r,e[3]),16&c&&i!==(i="vc-log-val vc-log-val-"+e[4])&&(0,s.Ljt)(n,"class",i),1&c&&(0,s.Ljt)(n,"style",e[0]),18&c&&(0,s.VHj)(n,"vc-log-val-haskey",void 0!==e[1])},i:s.ZTd,o:s.ZTd,d:function(e){o&&o.d(e),e&&(0,s.ogt)(t),e&&(0,s.ogt)(n)}}}function ve(e,t,n){var r=t.origData,i=t.style,o=void 0===i?"":i,s=t.dataKey,c=void 0===s?void 0:s,l=t.keyType,d=void 0===l?"":l,u="",p="",h=!1;return(0,a.H3)(function(){ge.use()}),(0,a.ev)(function(){ge.unuse()}),e.$$set=function(e){"origData"in e&&n(5,r=e.origData),"style"in e&&n(0,o=e.style),"dataKey"in e&&n(1,c=e.dataKey),"keyType"in e&&n(2,d=e.keyType)},e.$$.update=function(){if(122&e.$$.dirty){n(6,h=void 0!==c);var t=(0,re.LH)(r,h);n(4,p=t.valueType),n(3,u=t.text),h||"string"!==p||n(3,u=u.replace(/\\n/g,"\n").replace(/\\t/g,"    "))}},[o,c,d,u,p,r,h]}var ye=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,ve,fe,s.AqN,{origData:5,style:0,dataKey:1,keyType:2}),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"origData",get:function(){return this.$$.ctx[5]},set:function(e){this.$$set({origData:e}),(0,s.yl1)()}},{key:"style",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({style:e}),(0,s.yl1)()}},{key:"dataKey",get:function(){return this.$$.ctx[1]},set:function(e){this.$$set({dataKey:e}),(0,s.yl1)()}},{key:"keyType",get:function(){return this.$$.ctx[2]},set:function(e){this.$$set({keyType:e}),(0,s.yl1)()}}]),n}(s.f_C),_e=__webpack_require__(1237),Ie={};_e.Z&&_e.Z.locals&&(Ie.locals=_e.Z.locals);var Te,Se=0,Ee={};Ee.styleTagTransform=_(),Ee.setAttributes=m(),Ee.insert=h().bind(null,"head"),Ee.domAPI=u(),Ee.insertStyleElement=v(),Ie.use=function(e){return Ee.options=e||{},Se++||(Te=l()(_e.Z,Ee)),Ie},Ie.unuse=function(){Se>0&&! --Se&&(Te(),Te=null)};var Me=Ie;function be(e,t,n){var r=e.slice();return r[19]=t[n],r[21]=n,r}function Ce(e,t,n){var r=e.slice();return r[19]=t[n],r}function Ae(e,t,n){var r=e.slice();return r[19]=t[n],r[21]=n,r}function Oe(e){for(var t,n,r,i,o,a,c,l=[],d=new Map,u=[],p=new Map,h=[],g=new Map,m=e[7],f=function(e){return e[19]},v=0;v<m.length;v+=1){var y=Ae(e,m,v),_=f(y);d.set(_,l[v]=Ne(_,y))}for(var I=e[11]<e[7].length&&we(e),T=e[9],S=function(e){return e[19]},E=0;E<T.length;E+=1){var M=Ce(e,T,E),b=S(M);p.set(b,u[E]=Pe(b,M))}for(var C=e[8],A=function(e){return e[19]},O=0;O<C.length;O+=1){var R=be(e,C,O),N=A(R);g.set(N,h[O]=Le(N,R))}var w=e[12]<e[8].length&&xe(e),P=e[10]&&Ve(e);return{c:function(){t=(0,s.bGB)("div");for(var e=0;e<l.length;e+=1)l[e].c();n=(0,s.DhX)(),I&&I.c(),r=(0,s.DhX)();for(var c=0;c<u.length;c+=1)u[c].c();i=(0,s.DhX)();for(var d=0;d<h.length;d+=1)h[d].c();o=(0,s.DhX)(),w&&w.c(),a=(0,s.DhX)(),P&&P.c(),(0,s.Ljt)(t,"class","vc-log-tree-child")},m:function(e,d){(0,s.$Tr)(e,t,d);for(var p=0;p<l.length;p+=1)l[p].m(t,null);(0,s.R3I)(t,n),I&&I.m(t,null),(0,s.R3I)(t,r);for(var g=0;g<u.length;g+=1)u[g].m(t,null);(0,s.R3I)(t,i);for(var m=0;m<h.length;m+=1)h[m].m(t,null);(0,s.R3I)(t,o),w&&w.m(t,null),(0,s.R3I)(t,a),P&&P.m(t,null),c=!0},p:function(e,c){67721&c&&(m=e[7],(0,s.dvw)(),l=(0,s.GQg)(l,c,f,1,e,m,d,t,s.cly,Ne,n,Ae),(0,s.gbL)()),e[11]<e[7].length?I?I.p(e,c):((I=we(e)).c(),I.m(t,r)):I&&(I.d(1),I=null),66057&c&&(T=e[9],(0,s.dvw)(),u=(0,s.GQg)(u,c,S,1,e,T,p,t,s.cly,Pe,i,Ce),(0,s.gbL)()),69897&c&&(C=e[8],(0,s.dvw)(),h=(0,s.GQg)(h,c,A,1,e,C,g,t,s.cly,Le,o,be),(0,s.gbL)()),e[12]<e[8].length?w?w.p(e,c):((w=xe(e)).c(),w.m(t,a)):w&&(w.d(1),w=null),e[10]?P?(P.p(e,c),1024&c&&(0,s.Ui)(P,1)):((P=Ve(e)).c(),(0,s.Ui)(P,1),P.m(t,null)):P&&((0,s.dvw)(),(0,s.etI)(P,1,1,function(){P=null}),(0,s.gbL)())},i:function(e){if(!c){for(var t=0;t<m.length;t+=1)(0,s.Ui)(l[t]);for(var n=0;n<T.length;n+=1)(0,s.Ui)(u[n]);for(var r=0;r<C.length;r+=1)(0,s.Ui)(h[r]);(0,s.Ui)(P),c=!0}},o:function(e){for(var t=0;t<l.length;t+=1)(0,s.etI)(l[t]);for(var n=0;n<u.length;n+=1)(0,s.etI)(u[n]);for(var r=0;r<h.length;r+=1)(0,s.etI)(h[r]);(0,s.etI)(P),c=!1},d:function(e){e&&(0,s.ogt)(t);for(var n=0;n<l.length;n+=1)l[n].d();I&&I.d();for(var r=0;r<u.length;r+=1)u[r].d();for(var i=0;i<h.length;i+=1)h[i].d();w&&w.d(),P&&P.d()}}}function Re(e){var t,n;return t=new $e({props:{origData:e[16](e[19]),dataKey:e[19],keyPath:e[3]+"."+e[19],toggle:e[0]}}),{c:function(){(0,s.YCL)(t.$$.fragment)},m:function(e,r){(0,s.yef)(t,e,r),n=!0},p:function(e,n){var r={};128&n&&(r.origData=e[16](e[19])),128&n&&(r.dataKey=e[19]),136&n&&(r.keyPath=e[3]+"."+e[19]),1&n&&(r.toggle=e[0]),t.$set(r)},i:function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),n=!1},d:function(e){(0,s.vpE)(t,e)}}}function Ne(e,t){var n,r,i,o=t[21]<t[11]&&Re(t);return{key:e,first:null,c:function(){n=(0,s.cSb)(),o&&o.c(),r=(0,s.cSb)(),this.first=n},m:function(e,t){(0,s.$Tr)(e,n,t),o&&o.m(e,t),(0,s.$Tr)(e,r,t),i=!0},p:function(e,n){(t=e)[21]<t[11]?o?(o.p(t,n),2176&n&&(0,s.Ui)(o,1)):((o=Re(t)).c(),(0,s.Ui)(o,1),o.m(r.parentNode,r)):o&&((0,s.dvw)(),(0,s.etI)(o,1,1,function(){o=null}),(0,s.gbL)())},i:function(e){i||((0,s.Ui)(o),i=!0)},o:function(e){(0,s.etI)(o),i=!1},d:function(e){e&&(0,s.ogt)(n),o&&o.d(e),e&&(0,s.ogt)(r)}}}function we(e){var t,n,r,i,o=e[14](e[7].length-e[11])+"";return{c:function(){t=(0,s.bGB)("div"),n=(0,s.fLW)(o),(0,s.Ljt)(t,"class","vc-log-tree-loadmore")},m:function(o,a){(0,s.$Tr)(o,t,a),(0,s.R3I)(t,n),r||(i=(0,s.oLt)(t,"click",e[17]),r=!0)},p:function(e,t){2176&t&&o!==(o=e[14](e[7].length-e[11])+"")&&(0,s.rTO)(n,o)},d:function(e){e&&(0,s.ogt)(t),r=!1,i()}}}function Pe(e,t){var n,r,i;return r=new $e({props:{origData:t[16](t[19]),dataKey:String(t[19]),keyType:"symbol",keyPath:t[3]+"["+String(t[19])+"]",toggle:t[0]}}),{key:e,first:null,c:function(){n=(0,s.cSb)(),(0,s.YCL)(r.$$.fragment),this.first=n},m:function(e,t){(0,s.$Tr)(e,n,t),(0,s.yef)(r,e,t),i=!0},p:function(e,n){t=e;var i={};512&n&&(i.origData=t[16](t[19])),512&n&&(i.dataKey=String(t[19])),520&n&&(i.keyPath=t[3]+"["+String(t[19])+"]"),1&n&&(i.toggle=t[0]),r.$set(i)},i:function(e){i||((0,s.Ui)(r.$$.fragment,e),i=!0)},o:function(e){(0,s.etI)(r.$$.fragment,e),i=!1},d:function(e){e&&(0,s.ogt)(n),(0,s.vpE)(r,e)}}}function ke(e){var t,n;return t=new $e({props:{origData:e[16](e[19]),dataKey:e[19],keyType:"private",keyPath:e[3]+"."+e[19],toggle:e[0]}}),{c:function(){(0,s.YCL)(t.$$.fragment)},m:function(e,r){(0,s.yef)(t,e,r),n=!0},p:function(e,n){var r={};256&n&&(r.origData=e[16](e[19])),256&n&&(r.dataKey=e[19]),264&n&&(r.keyPath=e[3]+"."+e[19]),1&n&&(r.toggle=e[0]),t.$set(r)},i:function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),n=!1},d:function(e){(0,s.vpE)(t,e)}}}function Le(e,t){var n,r,i,o=t[21]<t[12]&&ke(t);return{key:e,first:null,c:function(){n=(0,s.cSb)(),o&&o.c(),r=(0,s.cSb)(),this.first=n},m:function(e,t){(0,s.$Tr)(e,n,t),o&&o.m(e,t),(0,s.$Tr)(e,r,t),i=!0},p:function(e,n){(t=e)[21]<t[12]?o?(o.p(t,n),4352&n&&(0,s.Ui)(o,1)):((o=ke(t)).c(),(0,s.Ui)(o,1),o.m(r.parentNode,r)):o&&((0,s.dvw)(),(0,s.etI)(o,1,1,function(){o=null}),(0,s.gbL)())},i:function(e){i||((0,s.Ui)(o),i=!0)},o:function(e){(0,s.etI)(o),i=!1},d:function(e){e&&(0,s.ogt)(n),o&&o.d(e),e&&(0,s.ogt)(r)}}}function xe(e){var t,n,r,i,o=e[14](e[8].length-e[12])+"";return{c:function(){t=(0,s.bGB)("div"),n=(0,s.fLW)(o),(0,s.Ljt)(t,"class","vc-log-tree-loadmore")},m:function(o,a){(0,s.$Tr)(o,t,a),(0,s.R3I)(t,n),r||(i=(0,s.oLt)(t,"click",e[18]),r=!0)},p:function(e,t){4352&t&&o!==(o=e[14](e[8].length-e[12])+"")&&(0,s.rTO)(n,o)},d:function(e){e&&(0,s.ogt)(t),r=!1,i()}}}function Ve(e){var t,n;return t=new $e({props:{origData:e[16]("__proto__"),dataKey:"__proto__",keyType:"private",keyPath:e[3]+".__proto__",toggle:e[0]}}),{c:function(){(0,s.YCL)(t.$$.fragment)},m:function(e,r){(0,s.yef)(t,e,r),n=!0},p:function(e,n){var r={};8&n&&(r.keyPath=e[3]+".__proto__"),1&n&&(r.toggle=e[0]),t.$set(r)},i:function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),n=!1},d:function(e){(0,s.vpE)(t,e)}}}function De(e){var t,n,r,i,o,a,c;r=new ye({props:{origData:e[1],dataKey:e[2],keyType:e[4]}});var l=e[6]&&e[5]&&Oe(e);return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("div"),(0,s.YCL)(r.$$.fragment),i=(0,s.DhX)(),l&&l.c(),(0,s.Ljt)(n,"class","vc-log-tree-node"),(0,s.Ljt)(t,"class","vc-log-tree"),(0,s.Ljt)(t,"data-keypath",e[3]),(0,s.VHj)(t,"vc-toggle",e[5]),(0,s.VHj)(t,"vc-is-tree",e[6])},m:function(d,u){(0,s.$Tr)(d,t,u),(0,s.R3I)(t,n),(0,s.yef)(r,n,null),(0,s.R3I)(t,i),l&&l.m(t,null),o=!0,a||(c=(0,s.oLt)(n,"click",(0,s.XET)(e[15])),a=!0)},p:function(e,n){var i=n[0],a={};2&i&&(a.origData=e[1]),4&i&&(a.dataKey=e[2]),16&i&&(a.keyType=e[4]),r.$set(a),e[6]&&e[5]?l?(l.p(e,i),96&i&&(0,s.Ui)(l,1)):((l=Oe(e)).c(),(0,s.Ui)(l,1),l.m(t,null)):l&&((0,s.dvw)(),(0,s.etI)(l,1,1,function(){l=null}),(0,s.gbL)()),(!o||8&i)&&(0,s.Ljt)(t,"data-keypath",e[3]),32&i&&(0,s.VHj)(t,"vc-toggle",e[5]),64&i&&(0,s.VHj)(t,"vc-is-tree",e[6])},i:function(e){o||((0,s.Ui)(r.$$.fragment,e),(0,s.Ui)(l),o=!0)},o:function(e){(0,s.etI)(r.$$.fragment,e),(0,s.etI)(l),o=!1},d:function(e){e&&(0,s.ogt)(t),(0,s.vpE)(r),l&&l.d(),a=!1,c()}}}function Ue(e,n,r){var i,o,s,c=n.origData,l=n.dataKey,d=void 0===l?void 0:l,u=n.keyPath,p=void 0===u?"":u,h=n.keyType,g=void 0===h?"":h,m=n.toggle,f=void 0===m?{}:m,v=!1,y=!1,_=!1,I=50,T=50;(0,a.H3)(function(){Me.use()}),(0,a.ev)(function(){Me.unuse()});var S=function(e){"enum"===e?r(11,I+=50):"nonEnum"===e&&r(12,T+=50)};return e.$$set=function(e){"origData"in e&&r(1,c=e.origData),"dataKey"in e&&r(2,d=e.dataKey),"keyPath"in e&&r(3,p=e.keyPath),"keyType"in e&&r(4,g=e.keyType),"toggle"in e&&r(0,f=e.toggle)},e.$$.update=function(){1003&e.$$.dirty&&(r(5,v=f[p]||!1),r(6,y=!(c instanceof re.Tg)&&(t.kJ(c)||t.Kn(c))),y&&v&&(r(7,i=i||t.qr(t.MH(c))),r(8,o=o||t.qr(t.QK(c))),r(9,s=s||t._D(c)),r(10,_=t.Kn(c)&&-1===o.indexOf("__proto__"))))},[f,c,d,p,g,v,y,i,o,s,_,I,T,S,function(e){return"(..."+e+" Key"+(e>1?"s":"")+" Left)"},function(){r(5,v=!v),r(0,f[p]=v,f)},function(e){try{return c[e]}catch(t){return new re.Tg}},function(){return S("enum")},function(){return S("nonEnum")}]}var $e=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,Ue,De,s.AqN,{origData:1,dataKey:2,keyPath:3,keyType:4,toggle:0}),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"origData",get:function(){return this.$$.ctx[1]},set:function(e){this.$$set({origData:e}),(0,s.yl1)()}},{key:"dataKey",get:function(){return this.$$.ctx[2]},set:function(e){this.$$set({dataKey:e}),(0,s.yl1)()}},{key:"keyPath",get:function(){return this.$$.ctx[3]},set:function(e){this.$$set({keyPath:e}),(0,s.yl1)()}},{key:"keyType",get:function(){return this.$$.ctx[4]},set:function(e){this.$$set({keyType:e}),(0,s.yl1)()}},{key:"toggle",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({toggle:e}),(0,s.yl1)()}}]),n}(s.f_C),Be=$e,Fe=__webpack_require__(7147),je={};Fe.Z&&Fe.Z.locals&&(je.locals=Fe.Z.locals);var qe,Ge=0,He={};He.styleTagTransform=_(),He.setAttributes=m(),He.insert=h().bind(null,"head"),He.domAPI=u(),He.insertStyleElement=v(),je.use=function(e){return He.options=e||{},Ge++||(qe=l()(Fe.Z,He)),je},je.unuse=function(){Ge>0&&! --Ge&&(qe(),qe=null)};var We=je;function ze(e,t,n){var r=e.slice();return r[9]=t[n],r[11]=n,r}function Ke(e,t,n){var r=e.slice();return r[12]=t[n],r}function Ye(e){for(var t,n,r,i,o,a,c,l,d,u,p,h,g,m=[],f=new Map,v=e[0].groupLevel&&Je(e),y=e[2]>0&&Qe(),_=e[1]&&Ze(e),I=e[0].repeated&&et(e),T=e[0].data,S=function(e){return e[11]},E=0;E<T.length;E+=1){var M=ze(e,T,E),b=S(M);f.set(b,m[E]=rt(b,M))}return d=new ce({props:{handler:e[6]}}),{c:function(){t=(0,s.bGB)("div"),v&&v.c(),n=(0,s.DhX)(),y&&y.c(),r=(0,s.DhX)(),_&&_.c(),i=(0,s.DhX)(),I&&I.c(),o=(0,s.DhX)(),a=(0,s.bGB)("div");for(var p=0;p<m.length;p+=1)m[p].c();c=(0,s.DhX)(),l=(0,s.bGB)("div"),(0,s.YCL)(d.$$.fragment),(0,s.Ljt)(a,"class","vc-log-content"),(0,s.Ljt)(l,"class","vc-logrow-icon"),(0,s.Ljt)(t,"class",u="vc-log-row vc-log-"+e[0].type),(0,s.VHj)(t,"vc-log-input","input"===e[0].cmdType),(0,s.VHj)(t,"vc-log-output","output"===e[0].cmdType),(0,s.VHj)(t,"vc-log-group",e[2]>0),(0,s.VHj)(t,"vc-toggle",1===e[2])},m:function(u,f){(0,s.$Tr)(u,t,f),v&&v.m(t,null),(0,s.R3I)(t,n),y&&y.m(t,null),(0,s.R3I)(t,r),_&&_.m(t,null),(0,s.R3I)(t,i),I&&I.m(t,null),(0,s.R3I)(t,o),(0,s.R3I)(t,a);for(var T=0;T<m.length;T+=1)m[T].m(a,null);(0,s.R3I)(t,c),(0,s.R3I)(t,l),(0,s.yef)(d,l,null),p=!0,h||(g=(0,s.oLt)(t,"click",e[5]),h=!0)},p:function(e,c){e[0].groupLevel?v?v.p(e,c):((v=Je(e)).c(),v.m(t,n)):v&&(v.d(1),v=null),e[2]>0?y||((y=Qe()).c(),y.m(t,r)):y&&(y.d(1),y=null),e[1]?_?_.p(e,c):((_=Ze(e)).c(),_.m(t,i)):_&&(_.d(1),_=null),e[0].repeated?I?I.p(e,c):((I=et(e)).c(),I.m(t,o)):I&&(I.d(1),I=null),17&c&&(T=e[0].data,(0,s.dvw)(),m=(0,s.GQg)(m,c,S,1,e,T,f,a,s.cly,rt,null,ze),(0,s.gbL)()),(!p||1&c&&u!==(u="vc-log-row vc-log-"+e[0].type))&&(0,s.Ljt)(t,"class",u),1&c&&(0,s.VHj)(t,"vc-log-input","input"===e[0].cmdType),1&c&&(0,s.VHj)(t,"vc-log-output","output"===e[0].cmdType),5&c&&(0,s.VHj)(t,"vc-log-group",e[2]>0),5&c&&(0,s.VHj)(t,"vc-toggle",1===e[2])},i:function(e){if(!p){for(var t=0;t<T.length;t+=1)(0,s.Ui)(m[t]);(0,s.Ui)(d.$$.fragment,e),p=!0}},o:function(e){for(var t=0;t<m.length;t+=1)(0,s.etI)(m[t]);(0,s.etI)(d.$$.fragment,e),p=!1},d:function(e){e&&(0,s.ogt)(t),v&&v.d(),y&&y.d(),_&&_.d(),I&&I.d();for(var n=0;n<m.length;n+=1)m[n].d();(0,s.vpE)(d),h=!1,g()}}}function Je(e){for(var t,n=new Array(e[0].groupLevel),r=[],i=0;i<n.length;i+=1)r[i]=Xe(Ke(e,n,i));return{c:function(){for(var e=0;e<r.length;e+=1)r[e].c();t=(0,s.cSb)()},m:function(e,n){for(var i=0;i<r.length;i+=1)r[i].m(e,n);(0,s.$Tr)(e,t,n)},p:function(e,i){if(1&i){var o;for(n=new Array(e[0].groupLevel),o=0;o<n.length;o+=1){var s=Ke(e,n,o);r[o]?r[o].p(s,i):(r[o]=Xe(),r[o].c(),r[o].m(t.parentNode,t))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d:function(e){(0,s.RMB)(r,e),e&&(0,s.ogt)(t)}}}function Xe(e){var t;return{c:function(){t=(0,s.bGB)("i"),(0,s.Ljt)(t,"class","vc-log-padding")},m:function(e,n){(0,s.$Tr)(e,t,n)},p:s.ZTd,d:function(e){e&&(0,s.ogt)(t)}}}function Qe(e){var t;return{c:function(){t=(0,s.bGB)("div"),(0,s.Ljt)(t,"class","vc-log-group-toggle")},m:function(e,n){(0,s.$Tr)(e,t,n)},d:function(e){e&&(0,s.ogt)(t)}}}function Ze(e){var t,n;return{c:function(){t=(0,s.bGB)("div"),n=(0,s.fLW)(e[3]),(0,s.Ljt)(t,"class","vc-log-time")},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n)},p:function(e,t){8&t&&(0,s.rTO)(n,e[3])},d:function(e){e&&(0,s.ogt)(t)}}}function et(e){var t,n,r,i=e[0].repeated+"";return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("i"),r=(0,s.fLW)(i),(0,s.Ljt)(t,"class","vc-log-repeat")},m:function(e,i){(0,s.$Tr)(e,t,i),(0,s.R3I)(t,n),(0,s.R3I)(n,r)},p:function(e,t){1&t&&i!==(i=e[0].repeated+"")&&(0,s.rTO)(r,i)},d:function(e){e&&(0,s.ogt)(t)}}}function tt(e){var t,n;return t=new ye({props:{origData:e[9].origData,style:e[9].style}}),{c:function(){(0,s.YCL)(t.$$.fragment)},m:function(e,r){(0,s.yef)(t,e,r),n=!0},p:function(e,n){var r={};1&n&&(r.origData=e[9].origData),1&n&&(r.style=e[9].style),t.$set(r)},i:function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),n=!1},d:function(e){(0,s.vpE)(t,e)}}}function nt(e){var t,n;return t=new Be({props:{origData:e[9].origData,keyPath:String(e[11]),toggle:e[0].toggle}}),{c:function(){(0,s.YCL)(t.$$.fragment)},m:function(e,r){(0,s.yef)(t,e,r),n=!0},p:function(e,n){var r={};1&n&&(r.origData=e[9].origData),1&n&&(r.keyPath=String(e[11])),1&n&&(r.toggle=e[0].toggle),t.$set(r)},i:function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),n=!1},d:function(e){(0,s.vpE)(t,e)}}}function rt(e,t){var n,r,i,o,a,c,l=[nt,tt],d=[];function u(e,t){return 1&t&&(r=null),null==r&&(r=!!e[4](e[9].origData)),r?0:1}return i=u(t,-1),o=d[i]=l[i](t),{key:e,first:null,c:function(){n=(0,s.cSb)(),o.c(),a=(0,s.cSb)(),this.first=n},m:function(e,t){(0,s.$Tr)(e,n,t),d[i].m(e,t),(0,s.$Tr)(e,a,t),c=!0},p:function(e,n){var r=i;(i=u(t=e,n))===r?d[i].p(t,n):((0,s.dvw)(),(0,s.etI)(d[r],1,1,function(){d[r]=null}),(0,s.gbL)(),(o=d[i])?o.p(t,n):(o=d[i]=l[i](t)).c(),(0,s.Ui)(o,1),o.m(a.parentNode,a))},i:function(e){c||((0,s.Ui)(o),c=!0)},o:function(e){(0,s.etI)(o),c=!1},d:function(e){e&&(0,s.ogt)(n),d[i].d(e),e&&(0,s.ogt)(a)}}}function it(e){var t,n,r=e[0]&&Ye(e);return{c:function(){r&&r.c(),t=(0,s.cSb)()},m:function(e,i){r&&r.m(e,i),(0,s.$Tr)(e,t,i),n=!0},p:function(e,n){var i=n[0];e[0]?r?(r.p(e,i),1&i&&(0,s.Ui)(r,1)):((r=Ye(e)).c(),(0,s.Ui)(r,1),r.m(t.parentNode,t)):r&&((0,s.dvw)(),(0,s.etI)(r,1,1,function(){r=null}),(0,s.gbL)())},i:function(e){n||((0,s.Ui)(r),n=!0)},o:function(e){(0,s.etI)(r),n=!1},d:function(e){r&&r.d(e),e&&(0,s.ogt)(t)}}}function ot(e,n,r){var i=n.log,o=n.showTimestamps,s=void 0!==o&&o,c=n.groupHeader,l=void 0===c?0:c,d=(0,a.x)(),u="",p=function(e,t){var n="000"+e;return n.substring(n.length-t)};return(0,a.H3)(function(){We.use()}),(0,a.ev)(function(){We.unuse()}),e.$$set=function(e){"log"in e&&r(0,i=e.log),"showTimestamps"in e&&r(1,s=e.showTimestamps),"groupHeader"in e&&r(2,l=e.groupHeader)},e.$$.update=function(){if(3&e.$$.dirty&&s){var t=new Date(i.date);r(3,u=p(t.getHours(),2)+":"+p(t.getMinutes(),2)+":"+p(t.getSeconds(),2)+":"+p(t.getMilliseconds(),3))}},[i,s,l,u,function(e){return!(e instanceof re.Tg)&&(t.kJ(e)||t.Kn(e))},function(){l>0&&d("groupCollapsed",{groupLabel:i.groupLabel,groupHeader:1===l?2:1,isGroupCollapsed:1===l})},function(){var e=[];try{for(var n=0;n<i.data.length;n++)t.HD(i.data[n].origData)||t.hj(i.data[n].origData)?e.push(i.data[n].origData):e.push(t.hZ(i.data[n].origData,{maxDepth:10,keyMaxLen:1e4,pretty:!1,standardJSON:!0}))}catch(r){}return e.join(" ")}]}var st=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,ot,it,s.AqN,{log:0,showTimestamps:1,groupHeader:2}),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"log",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({log:e}),(0,s.yl1)()}},{key:"showTimestamps",get:function(){return this.$$.ctx[1]},set:function(e){this.$$set({showTimestamps:e}),(0,s.yl1)()}},{key:"groupHeader",get:function(){return this.$$.ctx[2]},set:function(e){this.$$set({groupHeader:e}),(0,s.yl1)()}}]),n}(s.f_C),at=__webpack_require__(3903),ct=__webpack_require__(3327),lt={};ct.Z&&ct.Z.locals&&(lt.locals=ct.Z.locals);var dt,ut=0,pt={};pt.styleTagTransform=_(),pt.setAttributes=m(),pt.insert=h().bind(null,"head"),pt.domAPI=u(),pt.insertStyleElement=v(),lt.use=function(e){return pt.options=e||{},ut++||(dt=l()(ct.Z,pt)),lt},lt.unuse=function(){ut>0&&! --ut&&(dt(),dt=null)};var ht=lt,gt=__webpack_require__(4264),mt=__webpack_require__.n(gt),ft=function(){function e(e){console.debug("[vConsole] `ResizeObserver` is not supported in the browser, vConsole cannot render correctly."),e([{contentRect:{height:30}}],this)}var t=e.prototype;return t.disconnect=function(){},t.observe=function(e,t){},t.unobserve=function(e){},e}(),vt=function(){return"function"==typeof window.ResizeObserver},yt=function(){return window.ResizeObserver||ft};function _t(e){var t,n,r=e[6].default,i=(0,s.nuO)(r,e,e[5],null);return{c:function(){t=(0,s.bGB)("div"),i&&i.c(),(0,s.Ljt)(t,"class","vc-scroller-item"),(0,s.czc)(t,"display",e[0]?"block":"none",!1),(0,s.czc)(t,"top",e[3]?e[1]+"px":"auto",!1)},m:function(r,o){(0,s.$Tr)(r,t,o),i&&i.m(t,null),e[7](t),n=!0},p:function(e,o){var a=o[0];i&&i.p&&(!n||32&a)&&(0,s.kmG)(i,r,e,e[5],n?(0,s.u2N)(r,e[5],a,null):(0,s.VOJ)(e[5]),null),1&a&&(0,s.czc)(t,"display",e[0]?"block":"none",!1),2&a&&(0,s.czc)(t,"top",e[3]?e[1]+"px":"auto",!1)},i:function(e){n||((0,s.Ui)(i,e),n=!0)},o:function(e){(0,s.etI)(i,e),n=!1},d:function(n){n&&(0,s.ogt)(t),i&&i.d(n),e[7](null)}}}function It(e,t,n){var r,i=t.$$slots,o=void 0===i?{}:i,c=t.$$scope,l=t.show,d=void 0===l?!vt():l,u=t.top,p=t.onResize,h=void 0===p?function(){}:p,g=null,m=vt();return(0,a.H3)(function(){if(d&&h(r.getBoundingClientRect().height),m){var e=yt();(g=new e(function(e){var t=e[0];d&&h(t.contentRect.height)})).observe(r)}}),(0,a.ev)(function(){m&&g.disconnect()}),e.$$set=function(e){"show"in e&&n(0,d=e.show),"top"in e&&n(1,u=e.top),"onResize"in e&&n(4,h=e.onResize),"$$scope"in e&&n(5,c=e.$$scope)},[d,u,r,m,h,c,o,function(e){s.VnY[e?"unshift":"push"](function(){n(2,r=e)})}]}var Tt=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,It,_t,s.N8,{show:0,top:1,onResize:4}),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"show",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({show:e}),(0,s.yl1)()}},{key:"top",get:function(){return this.$$.ctx[1]},set:function(e){this.$$set({top:e}),(0,s.yl1)()}},{key:"onResize",get:function(){return this.$$.ctx[4]},set:function(e){this.$$set({onResize:e}),(0,s.yl1)()}}]),n}(s.f_C),St=function(){function e(){this._x=0,this._endX=0,this._v=0,this._startTime=0,this._endTime=0}var t=e.prototype;return t.set=function(e,t,n,r){this._x=e,this._endX=t,this._v=(t-e)/n,this._startTime=r||Date.now(),this._endTime=this._startTime+n},t.x=function(e){if(this.done(e))return this._endX;var t=e-this._startTime;return this._x+this._v*t},t.dx=function(e){return this.done(e)?0:this._v},t.done=function(e){return e>=this._endTime},e}(),Et=function(){function e(e){this._drag=void 0,this._dragLog=void 0,this._x=0,this._v=0,this._startTime=0,this._drag=e,this._dragLog=Math.log(e)}var t=e.prototype;return t.set=function(e,t,n){this._x=e,this._v=t,this._startTime=n||Date.now()},t.x=function(e){var t=(e-this._startTime)/1e3;return this._x+this._v*Math.pow(this._drag,t)/this._dragLog-this._v/this._dragLog},t.dx=function(e){var t=(e-this._startTime)/1e3;return this._v*Math.pow(this._drag,t)},t.done=function(e){return Math.abs(this.dx(e))<3},e}(),Mt=function(e,t){return e>t-.1&&e<t+.1},bt=function(e){return Mt(e,0)},Ct=function(){function e(e,t,n){this._solver=void 0,this._solution=void 0,this._endPosition=void 0,this._startTime=void 0,this._solver=function(e,t,n){var r=n,i=e,o=t,s=r*r-4*i*o;if(0==s){var a=-r/(2*i);return function(e,t){var n=e,r=t/(a*e);return{x:function(e){return(n+r*e)*Math.pow(Math.E,a*e)},dx:function(e){return(a*(n+r*e)+r)*Math.pow(Math.E,a*e)}}}}if(s>0){var c=(-r-Math.sqrt(s))/(2*i),l=(-r+Math.sqrt(s))/(2*i);return function(e,t){var n=(t-c*e)/(l-c),r=e-n;return{x:function(e){return r*Math.pow(Math.E,c*e)+n*Math.pow(Math.E,l*e)},dx:function(e){return r*c*Math.pow(Math.E,c*e)+n*l*Math.pow(Math.E,l*e)}}}}var d=Math.sqrt(4*i*o-r*r)/(2*i),u=-r/2*i;return function(e,t){var n=e,r=(t-u*e)/d;return{x:function(e){return Math.pow(Math.E,u*e)*(n*Math.cos(d*e)+r*Math.sin(d*e))},dx:function(e){var t=Math.pow(Math.E,u*e),i=Math.cos(d*e),o=Math.sin(d*e);return t*(r*d*i-n*d*o)+u*t*(r*o+n*i)}}}}(e,t,n),this._solution=null,this._endPosition=0,this._startTime=0}var t=e.prototype;return t.x=function(e){if(!this._solution)return 0;var t=(e-this._startTime)/1e3;return this._endPosition+this._solution.x(t)},t.dx=function(e){if(!this._solution)return 0;var t=(e-this._startTime)/1e3;return this._solution.dx(t)},t.set=function(e,t,n,r){r||(r=Date.now()),this._endPosition=e,t==e&&bt(n)||(this._solution=this._solver(t-e,n),this._startTime=r)},t.done=function(e){return e||(e=Date.now()),Mt(this.x(e),this._endPosition)&&bt(this.dx(e))},e}(),At=function(){function e(e,t){this._enableSpring=t,this._getExtend=void 0,this._friction=new Et(.05),this._spring=new Ct(1,90,20),this._toEdge=!1,this._getExtend=e}var t=e.prototype;return t.set=function(e,t,n){if(void 0===n&&(n=Date.now()),this._friction.set(e,t,n),e>0&&t>=0)this._toEdge=!0,this._enableSpring&&this._spring.set(0,e,t,n);else{var r=this._getExtend();e<-r&&t<=0?(this._toEdge=!0,this._enableSpring&&this._spring.set(-r,e,t,n)):this._toEdge=!1}},t.x=function(e){if(this._enableSpring&&this._toEdge)return this._spring.x(e);var t=this._friction.x(e),n=this._friction.dx(e);if(t>0&&n>=0){if(this._toEdge=!0,!this._enableSpring)return 0;this._spring.set(0,t,n,e)}else{var r=this._getExtend();if(t<-r&&n<=0){if(this._toEdge=!0,!this._enableSpring)return-r;this._spring.set(-r,t,n,e)}}return t},t.dx=function(e){return this._toEdge?this._enableSpring?this._spring.dx(e):0:this._friction.dx(e)},t.done=function(e){return this._toEdge?!this._enableSpring||this._spring.done(e):this._friction.done(e)},e}();function Ot(e,t){var n,r;return function i(){if(!r){var o=Date.now();t(o),e.done(o)||(n=requestAnimationFrame(i))}}(),{cancel:function(){cancelAnimationFrame(n),r=!0}}}var Rt=function(){function e(e,t){this._updatePosition=t,this._scrollModel=void 0,this._linearModel=void 0,this._startPosition=0,this._position=0,this._animate=null,this._getExtent=void 0,this._getExtent=e,this._scrollModel=new At(e,!1),this._linearModel=new St}var t=e.prototype;return t.onTouchStart=function(){var e=this._position;if(e>0)e*=0;else{var t=this._getExtent();e<-t&&(e=0*(e+t)-t)}this._startPosition=this._position=e,this._animate&&(this._animate.cancel(),this._animate=null),this._updatePosition(-e)},t.onTouchMove=function(e,t){var n=t+this._startPosition;if(n>0)n*=0;else{var r=this._getExtent();n<-r&&(n=0*(n+r)-r)}this._position=n,this._updatePosition(-n)},t.onTouchEnd=function(e,t,n,r){var i=this,o=t+this._startPosition;if(o>0)o*=0;else{var s=this._getExtent();o<-s&&(o=0*(o+s)-s)}if(this._position=o,this._updatePosition(-o),!(Math.abs(t)<=.1&&Math.abs(r)<=.1)){var a=this._scrollModel;a.set(o,r),this._animate=Ot(a,function(e){var t=i._position=a.x(e);i._updatePosition(-t)})}},t.onTouchCancel=function(){var e=this,t=this._position;if(t>0)t*=0;else{var n=this._getExtent();t<-n&&(t=0*(t+n)-n)}this._position=t;var r=this._scrollModel;r.set(t,0),this._animate=Ot(r,function(t){var n=e._position=r.x(t);e._updatePosition(-n)})},t.onWheel=function(e,t){var n=this._position-t;if(this._animate&&(this._animate.cancel(),this._animate=null),n>0)n=0;else{var r=this._getExtent();n<-r&&(n=-r)}this._position=n,this._updatePosition(-n)},t.getPosition=function(){return-this._position},t.updatePosition=function(e){var t=-e-this._position;this._startPosition+=t,this._position+=t;var n=this._position;this._updatePosition(-n);var r=this._scrollModel,i=Date.now();if(!r.done(i)){var o=r.dx(i);r.set(n,o,i)}},t.scrollTo=function(e,t){var n=this;if(this._animate&&(this._animate.cancel(),this._animate=null),t>0){var r=this._linearModel;r.set(this._position,-e,t),this._animate=Ot(this._linearModel,function(e){var t=n._position=r.x(e);n._updatePosition(-t)})}else this._updatePosition(e)},e}();function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var wt=function(e){var t=null,n=!1,r=function r(){n=!1,e(),t=requestAnimationFrame(function(){t=null,n&&r()})};return{trigger:function(){null===t?r():n=!0},cancel:function(){t&&(cancelAnimationFrame(t),n=!1,t=null)}}},Pt=function(){function e(e){var t=this;this._handler=e,this._touchId=null,this._startX=0,this._startY=0,this._historyX=[],this._historyY=[],this._historyTime=[],this._wheelDeltaX=0,this._wheelDeltaY=0,this._onTouchMove=function(){var e=t._historyX[t._historyX.length-1],n=t._historyY[t._historyY.length-1];t._handler.onTouchMove(e,n)},this._onWheel=wt(function(){var e=t._wheelDeltaX,n=t._wheelDeltaY;t._wheelDeltaX=0,t._wheelDeltaY=0,t._handler.onWheel(e,n)}),this.handleTouchStart=function(e){var n;if("1"!==(null==(n=e.target.dataset)?void 0:n.scrollable)){e.preventDefault();var r=e.touches[0];t._touchId=r.identifier,t._startX=r.pageX,t._startY=r.pageY,t._historyX=[0],t._historyY=[0],t._historyTime=[Date.now()],t._handler.onTouchStart()}},this.handleTouchMove=function(e){var n;if("1"!==(null==(n=e.target.dataset)?void 0:n.scrollable)){e.preventDefault();var r=t._getTouchDelta(e);null!==r&&(t._historyX.push(r.x),t._historyY.push(r.y),t._historyTime.push(Date.now()),t._onTouchMove())}},this.handleTouchEnd=function(e){var n;if("1"!==(null==(n=e.target.dataset)?void 0:n.scrollable)){e.preventDefault();var r=t._getTouchDelta(e);if(null!==r){for(var i=0,o=0,s=Date.now(),a=r.y,c=r.x,l=t._historyTime,d=l.length-1;d>0;d-=1){var u=s-l[d];if(u>30){i=1e3*(c-t._historyX[d])/u,o=1e3*(a-t._historyY[d])/u;break}}t._touchId=null,t._handler.onTouchEnd(r.x,r.y,i,o)}}},this.handleTouchCancel=function(e){var n;"1"!==(null==(n=e.target.dataset)?void 0:n.scrollable)&&(e.preventDefault(),null!==t._getTouchDelta(e)&&(t._touchId=null,t._handler.onTouchCancel()))},this.handleWheel=function(e){var n;"1"!==(null==(n=e.target.dataset)?void 0:n.scrollable)&&(e.preventDefault(),t._wheelDeltaX+=e.deltaX,t._wheelDeltaY+=e.deltaY,t._onWheel.trigger())}}return e.prototype._getTouchDelta=function(e){if(null===this._touchId)return null;for(var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Nt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e.changedTouches);!(t=n()).done;){var r=t.value;if(r.identifier===this._touchId)return{x:r.pageX-this._startX,y:r.pageY-this._startY}}return null},e}(),kt=__webpack_require__(1142),Lt={};kt.Z&&kt.Z.locals&&(Lt.locals=kt.Z.locals);var xt,Vt=0,Dt={};Dt.styleTagTransform=_(),Dt.setAttributes=m(),Dt.insert=h().bind(null,"head"),Dt.domAPI=u(),Dt.insertStyleElement=v(),Lt.use=function(e){return Dt.options=e||{},Vt++||(xt=l()(kt.Z,Dt)),Lt},Lt.unuse=function(){Vt>0&&! --Vt&&(xt(),xt=null)};var Ut=Lt,$t=s.lig.Map,Bt=function(e){return{}},Ft=function(e){return{}},jt=function(e){return{}},qt=function(e){return{}};function Gt(e,t,n){var r=e.slice();return r[53]=t[n],r[55]=n,r}var Ht=function(e){return{item:1025&e[0]}},Wt=function(e){return{item:e[0][e[53].index]}},zt=function(e){return{}},Kt=function(e){return{}};function Yt(e){var t,n,r=e[24].header,i=(0,s.nuO)(r,e,e[31],Kt);return{c:function(){t=(0,s.bGB)("div"),i&&i.c(),(0,s.Ljt)(t,"class","vc-scroller-header")},m:function(r,o){(0,s.$Tr)(r,t,o),i&&i.m(t,null),e[25](t),n=!0},p:function(e,t){i&&i.p&&(!n||1&t[1])&&(0,s.kmG)(i,r,e,e[31],n?(0,s.u2N)(r,e[31],t,zt):(0,s.VOJ)(e[31]),Kt)},i:function(e){n||((0,s.Ui)(i,e),n=!0)},o:function(e){(0,s.etI)(i,e),n=!1},d:function(n){n&&(0,s.ogt)(t),i&&i.d(n),e[25](null)}}}function Jt(e){var t,n=e[24].empty,r=(0,s.nuO)(n,e,e[31],qt);return{c:function(){r&&r.c()},m:function(e,n){r&&r.m(e,n),t=!0},p:function(e,i){r&&r.p&&(!t||1&i[1])&&(0,s.kmG)(r,n,e,e[31],t?(0,s.u2N)(n,e[31],i,jt):(0,s.VOJ)(e[31]),qt)},i:function(e){t||((0,s.Ui)(r,e),t=!0)},o:function(e){(0,s.etI)(r,e),t=!1},d:function(e){r&&r.d(e)}}}function Xt(e){for(var t,n,r=[],i=new $t,o=e[10],a=function(e){return e[53].key},c=0;c<o.length;c+=1){var l=Gt(e,o,c),d=a(l);i.set(d,r[c]=Zt(d,l))}return{c:function(){for(var e=0;e<r.length;e+=1)r[e].c();t=(0,s.cSb)()},m:function(e,i){for(var o=0;o<r.length;o+=1)r[o].m(e,i);(0,s.$Tr)(e,t,i),n=!0},p:function(e,n){17921&n[0]|1&n[1]&&(o=e[10],(0,s.dvw)(),r=(0,s.GQg)(r,n,a,1,e,o,i,t.parentNode,s.cly,Zt,t,Gt),(0,s.gbL)())},i:function(e){if(!n){for(var t=0;t<o.length;t+=1)(0,s.Ui)(r[t]);n=!0}},o:function(e){for(var t=0;t<r.length;t+=1)(0,s.etI)(r[t]);n=!1},d:function(e){for(var n=0;n<r.length;n+=1)r[n].d(e);e&&(0,s.ogt)(t)}}}function Qt(e){var t,n,r=e[24].item,i=(0,s.nuO)(r,e,e[31],Wt),o=i||function(){var e;return{c:function(){e=(0,s.fLW)("Missing template")},m:function(t,n){(0,s.$Tr)(t,e,n)},d:function(t){t&&(0,s.ogt)(e)}}}();return{c:function(){o&&o.c(),t=(0,s.DhX)()},m:function(e,r){o&&o.m(e,r),(0,s.$Tr)(e,t,r),n=!0},p:function(e,t){i&&i.p&&(!n||1025&t[0]|1&t[1])&&(0,s.kmG)(i,r,e,e[31],n?(0,s.u2N)(r,e[31],t,Ht):(0,s.VOJ)(e[31]),Wt)},i:function(e){n||((0,s.Ui)(o,e),n=!0)},o:function(e){(0,s.etI)(o,e),n=!1},d:function(e){o&&o.d(e),e&&(0,s.ogt)(t)}}}function Zt(e,t){var n,r,i;function o(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t)[26].apply(e,[t[53]].concat(r))}return r=new Tt({props:{show:t[53].show,top:t[9][t[53].index],onResize:o,$$slots:{default:[Qt]},$$scope:{ctx:t}}}),{key:e,first:null,c:function(){n=(0,s.cSb)(),(0,s.YCL)(r.$$.fragment),this.first=n},m:function(e,t){(0,s.$Tr)(e,n,t),(0,s.yef)(r,e,t),i=!0},p:function(e,n){t=e;var i={};1024&n[0]&&(i.show=t[53].show),1536&n[0]&&(i.top=t[9][t[53].index]),1024&n[0]&&(i.onResize=o),1025&n[0]|1&n[1]&&(i.$$scope={dirty:n,ctx:t}),r.$set(i)},i:function(e){i||((0,s.Ui)(r.$$.fragment,e),i=!0)},o:function(e){(0,s.etI)(r.$$.fragment,e),i=!1},d:function(e){e&&(0,s.ogt)(n),(0,s.vpE)(r,e)}}}function en(e){var t,n,r=e[24].footer,i=(0,s.nuO)(r,e,e[31],Ft);return{c:function(){t=(0,s.bGB)("div"),i&&i.c(),(0,s.Ljt)(t,"class","vc-scroller-footer")},m:function(r,o){(0,s.$Tr)(r,t,o),i&&i.m(t,null),e[28](t),n=!0},p:function(e,t){i&&i.p&&(!n||1&t[1])&&(0,s.kmG)(i,r,e,e[31],n?(0,s.u2N)(r,e[31],t,Bt):(0,s.VOJ)(e[31]),Ft)},i:function(e){n||((0,s.Ui)(i,e),n=!0)},o:function(e){(0,s.etI)(i,e),n=!1},d:function(n){n&&(0,s.ogt)(t),i&&i.d(n),e[28](null)}}}function tn(e){var t,n,r=e[7]+"%",i=e[8]+"%";return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("div"),(0,s.Ljt)(n,"class","vc-scroller-scrollbar-thumb"),(0,s.czc)(n,"height",r,!1),(0,s.czc)(n,"top",i,!1),(0,s.Ljt)(t,"class","vc-scroller-scrollbar-track"),(0,s.czc)(t,"display",e[7]<100?"block":"none",!1)},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n)},p:function(e,o){128&o[0]&&r!==(r=e[7]+"%")&&(0,s.czc)(n,"height",r,!1),256&o[0]&&i!==(i=e[8]+"%")&&(0,s.czc)(n,"top",i,!1),128&o[0]&&(0,s.czc)(t,"display",e[7]<100?"block":"none",!1)},d:function(e){e&&(0,s.ogt)(t)}}}function nn(e){var t,n,r,i,o,a,c,l,d,u,p,h=e[15].header&&Yt(e),g=[Xt,Jt],m=[];function f(e,t){return e[0].length?0:1}o=f(e),a=m[o]=g[o](e);var v=e[15].footer&&en(e),y=e[1]&&tn(e);return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("div"),h&&h.c(),r=(0,s.DhX)(),i=(0,s.bGB)("div"),a.c(),c=(0,s.DhX)(),v&&v.c(),l=(0,s.DhX)(),y&&y.c(),(0,s.Ljt)(i,"class","vc-scroller-items"),(0,s.Ljt)(n,"class","vc-scroller-contents"),(0,s.Ljt)(t,"class","vc-scroller-viewport"),(0,s.VHj)(t,"static",!e[13])},m:function(a,g){(0,s.$Tr)(a,t,g),(0,s.R3I)(t,n),h&&h.m(n,null),(0,s.R3I)(n,r),(0,s.R3I)(n,i),m[o].m(i,null),e[27](i),(0,s.R3I)(n,c),v&&v.m(n,null),e[29](n),(0,s.R3I)(t,l),y&&y.m(t,null),e[30](t),d=!0,u||(p=[(0,s.oLt)(t,"touchstart",function(){(0,s.sBU)(e[13]?e[11].handleTouchStart:e[12])&&(e[13]?e[11].handleTouchStart:e[12]).apply(this,arguments)}),(0,s.oLt)(t,"touchmove",function(){(0,s.sBU)(e[13]?e[11].handleTouchMove:e[12])&&(e[13]?e[11].handleTouchMove:e[12]).apply(this,arguments)}),(0,s.oLt)(t,"touchend",function(){(0,s.sBU)(e[13]?e[11].handleTouchEnd:e[12])&&(e[13]?e[11].handleTouchEnd:e[12]).apply(this,arguments)}),(0,s.oLt)(t,"touchcancel",function(){(0,s.sBU)(e[13]?e[11].handleTouchCancel:e[12])&&(e[13]?e[11].handleTouchCancel:e[12]).apply(this,arguments)}),(0,s.oLt)(t,"wheel",function(){(0,s.sBU)(e[13]?e[11].handleWheel:e[12])&&(e[13]?e[11].handleWheel:e[12]).apply(this,arguments)})],u=!0)},p:function(c,l){(e=c)[15].header?h?(h.p(e,l),32768&l[0]&&(0,s.Ui)(h,1)):((h=Yt(e)).c(),(0,s.Ui)(h,1),h.m(n,r)):h&&((0,s.dvw)(),(0,s.etI)(h,1,1,function(){h=null}),(0,s.gbL)());var d=o;(o=f(e))===d?m[o].p(e,l):((0,s.dvw)(),(0,s.etI)(m[d],1,1,function(){m[d]=null}),(0,s.gbL)(),(a=m[o])?a.p(e,l):(a=m[o]=g[o](e)).c(),(0,s.Ui)(a,1),a.m(i,null)),e[15].footer?v?(v.p(e,l),32768&l[0]&&(0,s.Ui)(v,1)):((v=en(e)).c(),(0,s.Ui)(v,1),v.m(n,null)):v&&((0,s.dvw)(),(0,s.etI)(v,1,1,function(){v=null}),(0,s.gbL)()),e[1]?y?y.p(e,l):((y=tn(e)).c(),y.m(t,null)):y&&(y.d(1),y=null)},i:function(e){d||((0,s.Ui)(h),(0,s.Ui)(a),(0,s.Ui)(v),d=!0)},o:function(e){(0,s.etI)(h),(0,s.etI)(a),(0,s.etI)(v),d=!1},d:function(n){n&&(0,s.ogt)(t),h&&h.d(),m[o].d(),e[27](null),v&&v.d(),e[29](null),y&&y.d(),e[30](null),u=!1,(0,s.j7q)(p)}}}function rn(e,t,n){var r,i,o,c,l,d,u,p=t.$$slots,h=void 0===p?{}:p,g=t.$$scope,m=(0,s.XGm)(h),f=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},v=t.items,y=t.itemKey,_=void 0===y?void 0:y,I=t.itemHeight,T=void 0===I?void 0:I,S=t.buffer,E=void 0===S?200:S,M=t.stickToBottom,b=void 0!==M&&M,C=t.scrollbar,A=void 0!==C&&C,O=t.start,R=void 0===O?0:O,N=t.end,w=void 0===N?0:N,P=0,k=0,L=0,x=0,V=100,D=0,U=[],$=[],B=[],F=function(){var e=[],t=[],n=0,r=0,i=0,o=0,s=0;return function(a,c,l){if(i===a&&o===c&&s===l)return e;var d=t.length,u=c<=r?Math.max(0,Math.min(c,Math.max(n,Math.min(r-1,l-d)))):c,p=n<=l?Math.max(l,Math.min(a,Math.max(n+1,Math.min(r,u+d)))):l;if(0===d||p-u<d){for(var h=e.length=t.length=l-c,g=0;g<h;g+=1)t[g]=g,e[g]={key:g,index:g+c,show:!0};return n=c,r=l,i=a,o=c,s=l,e}var m=0,f=0,v=0,y=0;r<u||p<n?(v=u,y=u+d):n<u?(f=u-n,v=u,y=u+d):p<r?(f=d-(r-p),v=p-d,y=p):u<=n&&r<=p&&(v=n,y=r);for(var _=u;_<c;_+=1,m+=1){var I=t[(f+m)%d],T=e[_-u];T.key=I,T.index=_,T.show=!1}for(var S=c,E=0;S<l;S+=1){var M=void 0;v<=S&&S<y?(M=t[(f+m)%d],m+=1):(M=d+E,E+=1);var b=S-u;if(b<e.length){var C=e[b];C.key=M,C.index=S,C.show=!0}else e.push({key:M,index:S,show:!0})}for(var A=l;A<p;A+=1,m+=1){var O=t[(f+m)%d],R=e[A-u];R.key=O,R.index=A,R.show=!1}for(var N=0;N<e.length;N+=1)t[N]=e[N].key;return e.sort(function(e,t){return e.key-t.key}),n=u,r=p,i=a,o=c,s=l,e}}(),j=function(){return Math.max(0,x+P+k-L)},q=!0,G=!1,H=[],W=!1,z=!1,K=vt(),Y=function(e,t){var n;(0,a.H3)(function(){var r=e();if(r){t(r.getBoundingClientRect().height),n&&n.disconnect();var i=yt();(n=new i(function(e){var n=e[0];t(n.contentRect.height)})).observe(r)}else t(0),n&&(n.disconnect(),n=null)}),(0,a.ev)(function(){n&&(n.disconnect(),n=null)})},J=function(){var e=d.getPosition(),t=100/(x+P+k);n(8,D=e*t),n(7,V=L*t)},X=function(e){var t=j();(e||d.getPosition()>t)&&d.updatePosition(t)},Q=function(e){!function(e,t,r){for(var i=new Map,o=0;o<H.length;o+=1){var s=H[o],a=void 0===_?s:s[_];i.set(a,U[o])}n(9,$.length=U.length=e.length,$);for(var c=0,u=0;u<e.length;u+=1){var p=e[u],h=void 0===_?p:p[_];i.has(h)?U[u]=i.get(h):U[u]=r,n(9,$[u]=c,$),c+=U[u]}x=Math.max(c,t-P-k),H=e,K?(Z(e,d.getPosition(),t),n(6,l.style.height=x+"px",l),X(q&&b),J()):Z(e,0,9e6)}(e,L,T)};function Z(e,t,r){for(var i=0,o=0;i<e.length&&o+U[i]<t-E;)o+=U[i],i+=1;for(n(16,R=i);i<e.length&&r&&o<t+r+E;)o+=U[i],i+=1;n(17,w=i),n(10,B=F(e.length,R,w))}var ee=function(e,t){return f(void 0,void 0,void 0,mt().mark(function r(){var i,o,s,a;return mt().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(U[e]!==t&&0!==L){r.next=2;break}return r.abrupt("return");case 2:for(i=U[e],U[e]=t,o=v.length,s=e;s<o-1;s+=1)n(9,$[s+1]=$[s]+U[s],$);return x=Math.max($[o-1]+U[o-1],L-P-k),a=d.getPosition(),G=!0,$[e]+i<a?d.updatePosition(a+t-i):X(q&&b),r.next=12,new Promise(function(e){return setTimeout(e,0)});case 12:Z(v,d.getPosition(),L),n(6,l.style.height=x+"px",l),J();case 15:case"end":return r.stop()}},r)}))};(0,a.H3)(function(){n(23,W=!0),Ut.use()}),(0,a.ev)(function(){Ut.unuse()}),K&&(K&&(d=d||new Rt(j,function(e){return f(void 0,void 0,void 0,mt().mark(function t(){var r;return mt().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=j(),q=Math.abs(e-r)<=1,n(5,c.style.transform="translateY("+-e+"px) translateZ(0)",c),J(),!G){t.next=8;break}G=!1,t.next=11;break;case 8:return t.next=10,new Promise(function(e){return setTimeout(e,0)});case 10:Z(v,e,L);case 11:case"end":return t.stop()}},t)}))}),n(11,u=u||new Pt(d))),!z&&K&&(Y(function(){return o},function(e){return f(void 0,void 0,void 0,mt().mark(function t(){var r,i;return mt().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(L!==e){t.next=2;break}return t.abrupt("return");case 2:for(L=e,r=0,i=0;i<v.length;i+=1)r+=U[i];return x=Math.max(r,L-k),n(6,l.style.height=x+"px",l),t.next=9,new Promise(function(e){return setTimeout(e,0)});case 9:Q(v),Z(v,d.getPosition(),L),0!==L&&X(q&&b),J();case 13:case"end":return t.stop()}},t)}))}),Y(function(){return i},function(e){if(k!==e){k=e;for(var t=0,r=0;r<v.length;r+=1)t+=U[r];x=Math.max(t,L-P-k),n(6,l.style.height=x+"px",l),0!==L&&X(q&&b),J()}}),Y(function(){return r},function(e){P!==e&&(P=e,Q(v),J())})));var te={scrollTo:function(e){if(K){var t=$[Math.max(0,Math.min(v.length-1,e))],n=Math.min(j(),t),r=Math.min(Math.floor(500*Math.abs(d.getPosition()-n)/2e3),500);d.scrollTo(n,r)}}};return e.$$set=function(e){"items"in e&&n(0,v=e.items),"itemKey"in e&&n(18,_=e.itemKey),"itemHeight"in e&&n(19,T=e.itemHeight),"buffer"in e&&n(20,E=e.buffer),"stickToBottom"in e&&n(21,b=e.stickToBottom),"scrollbar"in e&&n(1,A=e.scrollbar),"start"in e&&n(16,R=e.start),"end"in e&&n(17,w=e.end),"$$scope"in e&&n(31,g=e.$$scope)},e.$$.update=function(){8388609&e.$$.dirty[0]&&W&&(K||n(4,o.parentElement.style.height="auto",o),Q(v),z=!0)},[v,A,r,i,o,c,l,V,D,$,B,u,function(){},K,ee,m,R,w,_,T,E,b,te,W,h,function(e){s.VnY[e?"unshift":"push"](function(){n(2,r=e)})},function(e,t){return ee(e.index,t)},function(e){s.VnY[e?"unshift":"push"](function(){n(6,l=e)})},function(e){s.VnY[e?"unshift":"push"](function(){n(3,i=e)})},function(e){s.VnY[e?"unshift":"push"](function(){n(5,c=e)})},function(e){s.VnY[e?"unshift":"push"](function(){n(4,o=e),n(23,W),n(13,K),n(0,v)})},g]}var on=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,rn,nn,s.N8,{items:0,itemKey:18,itemHeight:19,buffer:20,stickToBottom:21,scrollbar:1,start:16,end:17,handler:22},null,[-1,-1]),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"items",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({items:e}),(0,s.yl1)()}},{key:"itemKey",get:function(){return this.$$.ctx[18]},set:function(e){this.$$set({itemKey:e}),(0,s.yl1)()}},{key:"itemHeight",get:function(){return this.$$.ctx[19]},set:function(e){this.$$set({itemHeight:e}),(0,s.yl1)()}},{key:"buffer",get:function(){return this.$$.ctx[20]},set:function(e){this.$$set({buffer:e}),(0,s.yl1)()}},{key:"stickToBottom",get:function(){return this.$$.ctx[21]},set:function(e){this.$$set({stickToBottom:e}),(0,s.yl1)()}},{key:"scrollbar",get:function(){return this.$$.ctx[1]},set:function(e){this.$$set({scrollbar:e}),(0,s.yl1)()}},{key:"start",get:function(){return this.$$.ctx[16]},set:function(e){this.$$set({start:e}),(0,s.yl1)()}},{key:"end",get:function(){return this.$$.ctx[17]},set:function(e){this.$$set({end:e}),(0,s.yl1)()}},{key:"handler",get:function(){return this.$$.ctx[22]}}]),n}(s.f_C);function sn(e){var t;return{c:function(){(t=(0,s.bGB)("div")).textContent="Empty",(0,s.Ljt)(t,"slot","empty"),(0,s.Ljt)(t,"class","vc-plugin-empty")},m:function(e,n){(0,s.$Tr)(e,t,n)},p:s.ZTd,d:function(e){e&&(0,s.ogt)(t)}}}function an(e){var t,n;return(t=new st({props:{slot:"item",log:e[16],showTimestamps:e[1],groupHeader:e[16].groupHeader}})).$on("groupCollapsed",e[6]),{c:function(){(0,s.YCL)(t.$$.fragment)},m:function(e,r){(0,s.yef)(t,e,r),n=!0},p:function(e,n){var r={};65536&n&&(r.log=e[16]),2&n&&(r.showTimestamps=e[1]),65536&n&&(r.groupHeader=e[16].groupHeader),t.$set(r)},i:function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),n=!1},d:function(e){(0,s.vpE)(t,e)}}}function cn(e){var t,n;return(t=new at.Z({})).$on("filterText",e[5]),{c:function(){(0,s.YCL)(t.$$.fragment)},m:function(e,r){(0,s.yef)(t,e,r),n=!0},p:s.ZTd,i:function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),n=!1},d:function(e){(0,s.vpE)(t,e)}}}function ln(e){var t,n,r=e[0]&&cn(e);return{c:function(){r&&r.c(),t=(0,s.cSb)()},m:function(e,i){r&&r.m(e,i),(0,s.$Tr)(e,t,i),n=!0},p:function(e,n){e[0]?r?(r.p(e,n),1&n&&(0,s.Ui)(r,1)):((r=cn(e)).c(),(0,s.Ui)(r,1),r.m(t.parentNode,t)):r&&((0,s.dvw)(),(0,s.etI)(r,1,1,function(){r=null}),(0,s.gbL)())},i:function(e){n||((0,s.Ui)(r),n=!0)},o:function(e){(0,s.etI)(r),n=!1},d:function(e){r&&r.d(e),e&&(0,s.ogt)(t)}}}function dn(e){var t,n,r,i;function o(t){e[15](t)}var a={items:e[4],itemKey:"_id",itemHeight:30,buffer:100,stickToBottom:!0,scrollbar:!0,$$slots:{footer:[ln],item:[an,function(e){return{16:e.item}},function(e){return e.item?65536:0}],empty:[sn]},$$scope:{ctx:e}};return void 0!==e[3]&&(a.handler=e[3]),n=new on({props:a}),s.VnY.push(function(){return(0,s.akz)(n,"handler",o)}),{c:function(){t=(0,s.bGB)("div"),(0,s.YCL)(n.$$.fragment),(0,s.Ljt)(t,"class","vc-plugin-content"),(0,s.VHj)(t,"vc-logs-has-cmd",e[0])},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.yef)(n,t,null),i=!0},p:function(e,i){var o=i[0],a={};16&o&&(a.items=e[4]),196611&o&&(a.$$scope={dirty:o,ctx:e}),!r&&8&o&&(r=!0,a.handler=e[3],(0,s.hjT)(function(){return r=!1})),n.$set(a),1&o&&(0,s.VHj)(t,"vc-logs-has-cmd",e[0])},i:function(e){i||((0,s.Ui)(n.$$.fragment,e),i=!0)},o:function(e){(0,s.etI)(n.$$.fragment,e),i=!1},d:function(e){e&&(0,s.ogt)(t),(0,s.vpE)(n)}}}function un(e,t,n){var r,i=s.ZTd;e.$$.on_destroy.push(function(){return i()});var o,c,l=t.pluginId,d=void 0===l?"default":l,u=t.showCmd,p=void 0!==u&&u,h=t.filterType,g=void 0===h?"all":h,m=t.showTimestamps,f=void 0!==m&&m,v=!1,y="",_=[];return(0,a.H3)(function(){ht.use()}),(0,a.ev)(function(){ht.unuse()}),e.$$set=function(e){"pluginId"in e&&n(7,d=e.pluginId),"showCmd"in e&&n(0,p=e.showCmd),"filterType"in e&&n(8,g=e.filterType),"showTimestamps"in e&&n(1,f=e.showTimestamps)},e.$$.update=function(){29056&e.$$.dirty&&(v||(n(2,o=ie.O.get(d)),i(),i=(0,s.LdU)(o,function(e){return n(14,r=e)}),n(12,v=!0)),n(4,_=r.logList.filter(function(e){return("all"===g||g===e.type)&&(""===y||(0,re.HX)(e,y))&&!e.groupCollapsed})))},[p,f,o,c,_,function(e){n(13,y=e.detail.filterText||"")},function(e){var t=e.detail.groupLabel,n=e.detail.groupHeader,r=e.detail.isGroupCollapsed;o.update(function(e){return e.logList.forEach(function(e){e.groupLabel===t&&(e.groupHeader>0?e.groupHeader=n:e.groupCollapsed=r)}),e})},d,g,function(){c.scrollTo(0)},function(){c.scrollTo(_.length-1)},{fixedHeight:!0},v,y,r,function(e){n(3,c=e)}]}var pn=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,un,dn,s.N8,{pluginId:7,showCmd:0,filterType:8,showTimestamps:1,scrollToTop:9,scrollToBottom:10,options:11}),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"pluginId",get:function(){return this.$$.ctx[7]},set:function(e){this.$$set({pluginId:e}),(0,s.yl1)()}},{key:"showCmd",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({showCmd:e}),(0,s.yl1)()}},{key:"filterType",get:function(){return this.$$.ctx[8]},set:function(e){this.$$set({filterType:e}),(0,s.yl1)()}},{key:"showTimestamps",get:function(){return this.$$.ctx[1]},set:function(e){this.$$set({showTimestamps:e}),(0,s.yl1)()}},{key:"scrollToTop",get:function(){return this.$$.ctx[9]}},{key:"scrollToBottom",get:function(){return this.$$.ctx[10]}},{key:"options",get:function(){return this.$$.ctx[11]}}]),n}(s.f_C),hn=__webpack_require__(5629),gn=function(){function e(e){this.model=void 0,this.pluginId=void 0,this.pluginId=e}return e.prototype.destroy=function(){this.model=void 0},e}(),mn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).model=hn.W.getSingleton(hn.W,"VConsoleLogModel"),t}(0,o.Z)(t,e);var n=t.prototype;return n.log=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.addLog.apply(this,["log"].concat(t))},n.info=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.addLog.apply(this,["info"].concat(t))},n.debug=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.addLog.apply(this,["debug"].concat(t))},n.warn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.addLog.apply(this,["warn"].concat(t))},n.error=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.addLog.apply(this,["error"].concat(t))},n.clear=function(){this.model&&this.model.clearPluginLog(this.pluginId)},n.addLog=function(e){if(this.model){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.unshift("["+this.pluginId+"]"),this.model.addLog({type:e,origData:n},{noOrig:!0})}},t}(gn),fn=function(e){function t(t,n){var r;return(r=e.call(this,t,n,pn,{pluginId:t,filterType:"all"})||this).model=hn.W.getSingleton(hn.W,"VConsoleLogModel"),r.isReady=!1,r.isShow=!1,r.isInBottom=!0,r.model.bindPlugin(t),r.exporter=new mn(t),r}(0,o.Z)(t,e);var n=t.prototype;return n.onReady=function(){var t,n;e.prototype.onReady.call(this),this.model.maxLogNumber=Number(null==(t=this.vConsole.option.log)?void 0:t.maxLogNumber)||1e3,this.compInstance.showTimestamps=!(null==(n=this.vConsole.option.log)||!n.showTimestamps)},n.onRemove=function(){e.prototype.onRemove.call(this),this.model.unbindPlugin(this.id)},n.onAddTopBar=function(e){for(var t=this,n=["All","Log","Info","Warn","Error"],r=[],i=0;i<n.length;i++)r.push({name:n[i],data:{type:n[i].toLowerCase()},actived:0===i,className:"",onClick:function(e,n){if(n.type===t.compInstance.filterType)return!1;t.compInstance.filterType=n.type}});r[0].className="vc-actived",e(r)},n.onAddTool=function(e){var t=this;e([{name:"Clear",global:!1,onClick:function(e){t.model.clearPluginLog(t.id),t.vConsole.triggerEvent("clearLog")}},{name:"Top",global:!1,onClick:function(e){t.compInstance.scrollToTop()}},{name:"Bottom",global:!1,onClick:function(e){t.compInstance.scrollToBottom()}}])},n.onUpdateOption=function(){var e,t,n,r;(null==(e=this.vConsole.option.log)?void 0:e.maxLogNumber)!==this.model.maxLogNumber&&(this.model.maxLogNumber=Number(null==(n=this.vConsole.option.log)?void 0:n.maxLogNumber)||1e3),!(null==(t=this.vConsole.option.log)||!t.showTimestamps)!==this.compInstance.showTimestamps&&(this.compInstance.showTimestamps=!(null==(r=this.vConsole.option.log)||!r.showTimestamps))},t}(ne),vn=function(e){function n(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).onErrorHandler=void 0,t.resourceErrorHandler=void 0,t.rejectionHandler=void 0,t}(0,o.Z)(n,e);var r=n.prototype;return r.onReady=function(){e.prototype.onReady.call(this),this.bindErrors(),this.compInstance.showCmd=!0},r.onRemove=function(){e.prototype.onRemove.call(this),this.unbindErrors()},r.bindErrors=function(){t.FJ(window)&&t.mf(window.addEventListener)&&(this.catchWindowOnError(),this.catchResourceError(),this.catchUnhandledRejection())},r.unbindErrors=function(){t.FJ(window)&&t.mf(window.addEventListener)&&(window.removeEventListener("error",this.onErrorHandler),window.removeEventListener("error",this.resourceErrorHandler),window.removeEventListener("unhandledrejection",this.rejectionHandler))},r.catchWindowOnError=function(){var e=this;this.onErrorHandler=this.onErrorHandler?this.onErrorHandler:function(t){var n=t.message;t.filename&&(n+="\\n\\t"+t.filename.replace(location.origin,""),(t.lineno||t.colno)&&(n+=":"+t.lineno+":"+t.colno)),n+="\\n"+(!!t.error&&!!t.error.stack&&t.error.stack.toString()||""),e.model.addLog({type:"error",origData:[n]},{noOrig:!0})},window.removeEventListener("error",this.onErrorHandler),window.addEventListener("error",this.onErrorHandler)},r.catchResourceError=function(){var e=this;this.resourceErrorHandler=this.resourceErrorHandler?this.resourceErrorHandler:function(t){var n=t.target;if(["link","video","script","img","audio"].indexOf(n.localName)>-1){var r=n.href||n.src||n.currentSrc;e.model.addLog({type:"error",origData:["GET <"+n.localName+"> error: "+r]},{noOrig:!0})}},window.removeEventListener("error",this.resourceErrorHandler),window.addEventListener("error",this.resourceErrorHandler,!0)},r.catchUnhandledRejection=function(){var e=this;this.rejectionHandler=this.rejectionHandler?this.rejectionHandler:function(t){var n=t&&t.reason,r="Uncaught (in promise) ",i=[r,n];n instanceof Error&&(i=[r,{name:n.name,message:n.message,stack:n.stack}]),e.model.addLog({type:"error",origData:i},{noOrig:!0})},window.removeEventListener("unhandledrejection",this.rejectionHandler),window.addEventListener("unhandledrejection",this.rejectionHandler)},n}(fn),yn=function(e){function t(){return e.apply(this,arguments)||this}(0,o.Z)(t,e);var n=t.prototype;return n.onReady=function(){e.prototype.onReady.call(this),this.printSystemInfo()},n.printSystemInfo=function(){var e=navigator.userAgent,t=[],n=e.match(/MicroMessenger\/([\d\.]+)/i),r=n&&n[1]?n[1]:null;"servicewechat.com"===location.host||console.info("[system]","Location:",location.href);var i=e.match(/(ipod).*\s([\d_]+)/i),o=e.match(/(ipad).*\s([\d_]+)/i),s=e.match(/(iphone)\sos\s([\d_]+)/i),a=e.match(/(android)\s([\d\.]+)/i),c=e.match(/(Mac OS X)\s([\d_]+)/i);t=[],a?t.push("Android "+a[2]):s?t.push("iPhone, iOS "+s[2].replace(/_/g,".")):o?t.push("iPad, iOS "+o[2].replace(/_/g,".")):i?t.push("iPod, iOS "+i[2].replace(/_/g,".")):c&&t.push("Mac, MacOS "+c[2].replace(/_/g,".")),r&&t.push("WeChat "+r),console.info("[system]","Client:",t.length?t.join(", "):"Unknown");var l=e.toLowerCase().match(/ nettype\/([^ ]+)/g);l&&l[0]&&(t=[(l=l[0].split("/"))[1]],console.info("[system]","Network:",t.length?t.join(", "):"Unknown")),console.info("[system]","UA:",e),setTimeout(function(){var e=window.performance||window.msPerformance||window.webkitPerformance;if(e&&e.timing){var t=e.timing;t.navigationStart&&console.info("[system]","navigationStart:",t.navigationStart),t.navigationStart&&t.domainLookupStart&&console.info("[system]","navigation:",t.domainLookupStart-t.navigationStart+"ms"),t.domainLookupEnd&&t.domainLookupStart&&console.info("[system]","dns:",t.domainLookupEnd-t.domainLookupStart+"ms"),t.connectEnd&&t.connectStart&&(t.connectEnd&&t.secureConnectionStart?console.info("[system]","tcp (ssl):",t.connectEnd-t.connectStart+"ms ("+(t.connectEnd-t.secureConnectionStart)+"ms)"):console.info("[system]","tcp:",t.connectEnd-t.connectStart+"ms")),t.responseStart&&t.requestStart&&console.info("[system]","request:",t.responseStart-t.requestStart+"ms"),t.responseEnd&&t.responseStart&&console.info("[system]","response:",t.responseEnd-t.responseStart+"ms"),t.domComplete&&t.domLoading&&(t.domContentLoadedEventStart&&t.domLoading?console.info("[system]","domComplete (domLoaded):",t.domComplete-t.domLoading+"ms ("+(t.domContentLoadedEventStart-t.domLoading)+"ms)"):console.info("[system]","domComplete:",t.domComplete-t.domLoading+"ms")),t.loadEventEnd&&t.loadEventStart&&console.info("[system]","loadEvent:",t.loadEventEnd-t.loadEventStart+"ms"),t.navigationStart&&t.loadEventEnd&&console.info("[system]","total (DOM):",t.loadEventEnd-t.navigationStart+"ms ("+(t.domComplete-t.navigationStart)+"ms)")}},0)},t}(fn),_n=__webpack_require__(3313),In=__webpack_require__(643);function Tn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Sn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Sn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Sn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var En=function(e,n){void 0===n&&(n={}),t.Kn(n)||(n={});var r=e?e.split("?"):[];if(r.shift(),r.length>0)for(var i,o=Tn(r=r.join("?").split("&"));!(i=o()).done;){var s=i.value.split("=");try{n[s[0]]=decodeURIComponent(s[1])}catch(a){n[s[0]]=s[1]}}return n},Mn=function(e,n){var r="";switch(e){case"":case"text":case"json":if(t.HD(n))try{r=JSON.parse(n),r=t.hZ(r,{maxDepth:10,keyMaxLen:1e4,pretty:!0,standardJSON:!0})}catch(i){r=t.id(String(n),1e4)}else t.Kn(n)||t.kJ(n)?r=t.hZ(n,{maxDepth:10,keyMaxLen:1e4,pretty:!0,standardJSON:!0}):void 0!==n&&(r=Object.prototype.toString.call(n));break;default:void 0!==n&&(r=Object.prototype.toString.call(n))}return r},bn=function(e){if(!e)return null;var n=null;if("string"==typeof e)try{n=JSON.parse(e)}catch(p){var r=e.split("&");if(1===r.length)n=e;else{n={};for(var i,o=Tn(r);!(i=o()).done;){var s=i.value.split("=");n[s[0]]=void 0===s[1]?"undefined":s[1]}}}else if(t.TW(e)){n={};for(var a,c=Tn(e);!(a=c()).done;){var l=a.value,d=l[0],u=l[1];n[d]="string"==typeof u?u:"[object Object]"}}else n=t.PO(e)?e:"[object "+t.zl(e)+"]";return n},Cn=function(e){return void 0===e&&(e=""),e.startsWith("//")&&(e=""+new URL(window.location.href).protocol+e),e.startsWith("http")?new URL(e):new URL(e,window.location.href)},An=function(){this.id="",this.name="",this.method="",this.url="",this.status=0,this.statusText="",this.cancelState=0,this.readyState=0,this.header=null,this.responseType="",this.requestType=void 0,this.requestHeader=null,this.response=void 0,this.responseSize=0,this.responseSizeText="",this.startTime=0,this.startTimeText="",this.endTime=0,this.costTime=0,this.getData=null,this.postData=null,this.actived=!1,this.noVConsole=!1,this.id=(0,t.QI)()},On=function(e){function t(n){var r;return(r=e.call(this)||this)._response=void 0,new Proxy(n,t.Handler)||(0,i.Z)(r)}return(0,o.Z)(t,e),t}(An);On.Handler={get:function(e,t){return"response"===t?e._response:Reflect.get(e,t)},set:function(e,t,n){var r;switch(t){case"response":return e._response=Mn(e.responseType,n),!0;case"url":var i=(null==(r=n=String(n))?void 0:r.replace(new RegExp("[/]*$"),"").split("/").pop())||"Unknown";Reflect.set(e,"name",i);var o=En(n,e.getData);Reflect.set(e,"getData",o);break;case"status":var s=String(n)||"Unknown";Reflect.set(e,"statusText",s);break;case"startTime":if(n&&e.endTime){var a=e.endTime-n;Reflect.set(e,"costTime",a)}break;case"endTime":if(n&&e.startTime){var c=n-e.startTime;Reflect.set(e,"costTime",c)}}return Reflect.set(e,t,n)}};var Rn=function(){function e(e,t){var n=this;this.XMLReq=void 0,this.item=void 0,this.onUpdateCallback=void 0,this.XMLReq=e,this.XMLReq.onreadystatechange=function(){n.onReadyStateChange()},this.XMLReq.onabort=function(){n.onAbort()},this.XMLReq.ontimeout=function(){n.onTimeout()},this.item=new An,this.item.requestType="xhr",this.onUpdateCallback=t}var n=e.prototype;return n.get=function(e,t){switch(t){case"_noVConsole":return this.item.noVConsole;case"open":return this.getOpen(e);case"send":return this.getSend(e);case"setRequestHeader":return this.getSetRequestHeader(e);default:var n=Reflect.get(e,t);return"function"==typeof n?n.bind(e):n}},n.set=function(e,t,n){switch(t){case"_noVConsole":return void(this.item.noVConsole=!!n);case"onreadystatechange":return this.setOnReadyStateChange(e,t,n);case"onabort":return this.setOnAbort(e,t,n);case"ontimeout":return this.setOnTimeout(e,t,n)}return Reflect.set(e,t,n)},n.onReadyStateChange=function(){this.item.readyState=this.XMLReq.readyState,this.item.responseType=this.XMLReq.responseType,this.item.endTime=Date.now(),this.item.costTime=this.item.endTime-this.item.startTime,this.updateItemByReadyState(),this.item.response=Mn(this.item.responseType,this.item.response),this.triggerUpdate()},n.onAbort=function(){this.item.cancelState=1,this.item.statusText="Abort",this.triggerUpdate()},n.onTimeout=function(){this.item.cancelState=3,this.item.statusText="Timeout",this.triggerUpdate()},n.triggerUpdate=function(){this.item.noVConsole||this.onUpdateCallback(this.item)},n.getOpen=function(e){var t=this,n=Reflect.get(e,"open");return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var s=i[0],a=i[1];return t.item.method=s?s.toUpperCase():"GET",t.item.url=a||"",t.item.name=t.item.url.replace(new RegExp("[/]*$"),"").split("/").pop()||"",t.item.getData=En(t.item.url,{}),t.triggerUpdate(),n.apply(e,i)}},n.getSend=function(e){var t=this,n=Reflect.get(e,"send");return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var s=i[0];return t.item.postData=bn(s),t.triggerUpdate(),n.apply(e,i)}},n.getSetRequestHeader=function(e){var t=this,n=Reflect.get(e,"setRequestHeader");return function(){t.item.requestHeader||(t.item.requestHeader={});for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t.item.requestHeader[i[0]]=i[1],t.triggerUpdate(),n.apply(e,i)}},n.setOnReadyStateChange=function(e,t,n){var r=this;return Reflect.set(e,t,function(){r.onReadyStateChange();for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];n.apply(e,i)})},n.setOnAbort=function(e,t,n){var r=this;return Reflect.set(e,t,function(){r.onAbort();for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];n.apply(e,i)})},n.setOnTimeout=function(e,t,n){var r=this;return Reflect.set(e,t,function(){r.onTimeout();for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];n.apply(e,i)})},n.updateItemByReadyState=function(){switch(this.XMLReq.readyState){case 0:case 1:if(this.item.status=0,this.item.statusText="Pending",!this.item.startTime){this.item.startTime=Date.now();var e=(0,t._3)(this.item.startTime);this.item.startTimeText=e.year+"-"+e.month+"-"+e.day+" "+e.hour+":"+e.minute+":"+e.second+"."+e.millisecond}break;case 2:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.item.header={};for(var n=(this.XMLReq.getAllResponseHeaders()||"").split("\n"),r=0;r<n.length;r++){var i=n[r];if(i){var o=i.split(": "),s=o[0],a=o.slice(1).join(": ");this.item.header[s]=a}}break;case 3:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=(0,t.KL)(this.item.responseSize));break;case 4:this.item.status=this.XMLReq.status||this.item.status||0,this.item.statusText=String(this.item.status),this.item.endTime=Date.now(),this.item.costTime=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=this.XMLReq.response,this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=(0,t.KL)(this.item.responseSize));break;default:this.item.status=this.XMLReq.status,this.item.statusText="Unknown"}},e}(),Nn=function(){function e(){}return e.create=function(e){return new Proxy(XMLHttpRequest,{construct:function(t){var n=new t;return new Proxy(n,new Rn(n,e))}})},e}();function wn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Pn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Pn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Nn.origXMLHttpRequest=XMLHttpRequest;var kn=function(){function e(e,t,n){this.resp=void 0,this.item=void 0,this.onUpdateCallback=void 0,this.resp=e,this.item=t,this.onUpdateCallback=n,this.mockReader()}var n=e.prototype;return n.set=function(e,t,n){return Reflect.set(e,t,n)},n.get=function(e,t){var n=this,r=Reflect.get(e,t);switch(t){case"arrayBuffer":case"blob":case"formData":case"json":case"text":return function(){return n.item.responseType=t.toLowerCase(),r.apply(e).then(function(e){return n.item.response=Mn(n.item.responseType,e),n.onUpdateCallback(n.item),e})}}return"function"==typeof r?r.bind(e):r},n.mockReader=function(){var e,n=this;if(this.resp.body&&"function"==typeof this.resp.body.getReader){var r=this.resp.body.getReader;this.resp.body.getReader=function(){var i=r.apply(n.resp.body);if(4===n.item.readyState)return i;var o=i.read,s=i.cancel;return n.item.responseType="arraybuffer",i.read=function(){return o.apply(i).then(function(r){if(e){var i=new Uint8Array(e.length+r.value.length);i.set(e),i.set(r.value,e.length),e=i}else e=new Uint8Array(r.value);return n.item.endTime=Date.now(),n.item.costTime=n.item.endTime-(n.item.startTime||n.item.endTime),n.item.readyState=r.done?4:3,n.item.statusText=r.done?String(n.item.status):"Loading",n.item.responseSize=e.length,n.item.responseSizeText=t.KL(n.item.responseSize),r.done&&(n.item.response=Mn(n.item.responseType,e)),n.onUpdateCallback(n.item),r})},i.cancel=function(){n.item.cancelState=2,n.item.statusText="Cancel",n.item.endTime=Date.now(),n.item.costTime=n.item.endTime-(n.item.startTime||n.item.endTime),n.item.response=Mn(n.item.responseType,e),n.onUpdateCallback(n.item);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return s.apply(i,r)},i}}},e}(),Ln=function(){function e(e){this.onUpdateCallback=void 0,this.onUpdateCallback=e}var n=e.prototype;return n.apply=function(e,t,n){var r=this,i=n[0],o=n[1],s=new An;return this.beforeFetch(s,i,o),e.apply(window,n).then(this.afterFetch(s)).catch(function(e){throw s.endTime=Date.now(),s.costTime=s.endTime-(s.startTime||s.endTime),r.onUpdateCallback(s),e})},n.beforeFetch=function(e,n,r){var i,o="GET",s=null;if(t.HD(n)?(o=(null==r?void 0:r.method)||"GET",i=Cn(n),s=(null==r?void 0:r.headers)||null):(o=n.method||"GET",i=Cn(n.url),s=n.headers),e.method=o,e.requestType="fetch",e.requestHeader=s,e.url=i.toString(),e.name=(i.pathname.split("/").pop()||"")+i.search,e.status=0,e.statusText="Pending",e.readyState=1,!e.startTime){e.startTime=Date.now();var a=t._3(e.startTime);e.startTimeText=a.year+"-"+a.month+"-"+a.day+" "+a.hour+":"+a.minute+":"+a.second+"."+a.millisecond}if("[object Headers]"===Object.prototype.toString.call(s)){e.requestHeader={};for(var c,l=wn(s);!(c=l()).done;){var d=c.value,u=d[0],p=d[1];e.requestHeader[u]=p}}else e.requestHeader=s;if(i.search&&i.searchParams){e.getData={};for(var h,g=wn(i.searchParams);!(h=g()).done;){var m=h.value,f=m[0],v=m[1];e.getData[f]=v}}null!=r&&r.body&&(e.postData=bn(r.body)),this.onUpdateCallback(e)},n.afterFetch=function(e){var n=this;return function(r){e.endTime=Date.now(),e.costTime=e.endTime-(e.startTime||e.endTime),e.status=r.status,e.statusText=String(r.status);var i=!1;e.header={};for(var o,s=wn(r.headers);!(o=s()).done;){var a=o.value,c=a[0],l=a[1];e.header[c]=l,i=l.toLowerCase().indexOf("chunked")>-1||i}return i?e.readyState=3:(e.readyState=4,n.handleResponseBody(r.clone(),e).then(function(r){e.responseSize="string"==typeof r?r.length:r.byteLength,e.responseSizeText=t.KL(e.responseSize),e.response=Mn(e.responseType,r),n.onUpdateCallback(e)})),n.onUpdateCallback(e),new Proxy(r,new kn(r,e,n.onUpdateCallback))}},n.handleResponseBody=function(e,t){var n=e.headers.get("content-type");return n&&n.includes("application/json")?(t.responseType="json",e.text()):n&&(n.includes("text/html")||n.includes("text/plain"))?(t.responseType="text",e.text()):(t.responseType="arraybuffer",e.arrayBuffer())},e}(),xn=function(){function e(){}return e.create=function(e){return new Proxy(fetch,new Ln(e))},e}();function Vn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}xn.origFetch=fetch;var Dn=function(e){return e instanceof Blob?e.type:e instanceof FormData?"multipart/form-data":e instanceof URLSearchParams?"application/x-www-form-urlencoded;charset=UTF-8":"text/plain;charset=UTF-8"},Un=function(){function e(e){this.onUpdateCallback=void 0,this.onUpdateCallback=e}return e.prototype.apply=function(e,t,n){var r=n[0],i=n[1],o=new An,s=Cn(r);if(o.method="POST",o.url=r,o.name=(s.pathname.split("/").pop()||"")+s.search,o.requestType="ping",o.requestHeader={"Content-Type":Dn(i)},o.status=0,o.statusText="Pending",s.search&&s.searchParams){o.getData={};for(var a,c=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Vn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Vn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(s.searchParams);!(a=c()).done;){var l=a.value,d=l[0],u=l[1];o.getData[d]=u}}o.postData=bn(i),o.startTime||(o.startTime=Date.now()),this.onUpdateCallback(o);var p=e.apply(t,n);return p?(o.endTime=Date.now(),o.costTime=o.endTime-(o.startTime||o.endTime),o.status=0,o.statusText="Sent",o.readyState=4):(o.status=500,o.statusText="Unknown"),this.onUpdateCallback(o),p},e}(),$n=function(){function e(){}return e.create=function(e){return new Proxy(navigator.sendBeacon,new Un(e))},e}();$n.origSendBeacon=navigator.sendBeacon;var Bn=(0,_n.fZ)({}),Fn=function(e){function t(){var t;return(t=e.call(this)||this).maxNetworkNumber=1e3,t.ignoreUrlRegExp=void 0,t.itemCounter=0,t.mockXHR(),t.mockFetch(),t.mockSendBeacon(),t}(0,o.Z)(t,e);var n=t.prototype;return n.unMock=function(){window.hasOwnProperty("XMLHttpRequest")&&(window.XMLHttpRequest=Nn.origXMLHttpRequest),window.hasOwnProperty("fetch")&&(window.fetch=xn.origFetch),window.navigator.sendBeacon&&(window.navigator.sendBeacon=$n.origSendBeacon)},n.clearLog=function(){Bn.set({})},n.updateRequest=function(e,t){var n,r=t.url;if(!r||null==(n=this.ignoreUrlRegExp)||!n.test(r)){var i=(0,_n.U2)(Bn),o=!!i[e];if(o){var s=i[e];for(var a in t)s[a]=t[a];t=s}Bn.update(function(n){return n[e]=t,n}),o||(P.x.updateTime(),this.limitListLength())}},n.mockXHR=function(){var e=this;window.hasOwnProperty("XMLHttpRequest")&&(window.XMLHttpRequest=Nn.create(function(t){e.updateRequest(t.id,t)}))},n.mockFetch=function(){var e=this;window.hasOwnProperty("fetch")&&(window.fetch=xn.create(function(t){e.updateRequest(t.id,t)}))},n.mockSendBeacon=function(){var e,t,n=this;null!=(e=window)&&null!=(t=e.navigator)&&t.sendBeacon&&(window.navigator.sendBeacon=$n.create(function(e){n.updateRequest(e.id,e)}))},n.limitListLength=function(){var e=this;if(this.itemCounter++,this.itemCounter%10==0){this.itemCounter=0;var t=(0,_n.U2)(Bn),n=Object.keys(t);n.length>this.maxNetworkNumber-10&&Bn.update(function(t){for(var r=n.splice(0,n.length-e.maxNetworkNumber+10),i=0;i<r.length;i++)t[r[i]]=void 0,delete t[r[i]];return t})}},t}(In.N),jn=__webpack_require__(8747),qn={};jn.Z&&jn.Z.locals&&(qn.locals=jn.Z.locals);var Gn,Hn=0,Wn={};Wn.styleTagTransform=_(),Wn.setAttributes=m(),Wn.insert=h().bind(null,"head"),Wn.domAPI=u(),Wn.insertStyleElement=v(),qn.use=function(e){return Wn.options=e||{},Hn++||(Gn=l()(jn.Z,Wn)),qn},qn.unuse=function(){Hn>0&&! --Hn&&(Gn(),Gn=null)};var zn=qn;function Kn(e,t,n){var r=e.slice();return r[11]=t[n][0],r[12]=t[n][1],r}function Yn(e,t,n){var r=e.slice();return r[11]=t[n][0],r[12]=t[n][1],r}function Jn(e,t,n){var r=e.slice();return r[11]=t[n][0],r[12]=t[n][1],r}function Xn(e,t,n){var r=e.slice();return r[11]=t[n][0],r[12]=t[n][1],r}function Qn(e){var t,n,r;return{c:function(){t=(0,s.fLW)("("),n=(0,s.fLW)(e[0]),r=(0,s.fLW)(")")},m:function(e,i){(0,s.$Tr)(e,t,i),(0,s.$Tr)(e,n,i),(0,s.$Tr)(e,r,i)},p:function(e,t){1&t&&(0,s.rTO)(n,e[0])},d:function(e){e&&(0,s.ogt)(t),e&&(0,s.ogt)(n),e&&(0,s.ogt)(r)}}}function Zn(e){var t,n,r,i,o,a,c=e[0]>0&&Qn(e);return{c:function(){t=(0,s.bGB)("dl"),n=(0,s.bGB)("dd"),r=(0,s.fLW)("Name "),c&&c.c(),(i=(0,s.bGB)("dd")).textContent="Method",(o=(0,s.bGB)("dd")).textContent="Status",(a=(0,s.bGB)("dd")).textContent="Time",(0,s.Ljt)(n,"class","vc-table-col vc-table-col-4"),(0,s.Ljt)(i,"class","vc-table-col"),(0,s.Ljt)(o,"class","vc-table-col"),(0,s.Ljt)(a,"class","vc-table-col"),(0,s.Ljt)(t,"class","vc-table-row")},m:function(e,l){(0,s.$Tr)(e,t,l),(0,s.R3I)(t,n),(0,s.R3I)(n,r),c&&c.m(n,null),(0,s.R3I)(t,i),(0,s.R3I)(t,o),(0,s.R3I)(t,a)},p:function(e,t){e[0]>0?c?c.p(e,t):((c=Qn(e)).c(),c.m(n,null)):c&&(c.d(1),c=null)},d:function(e){e&&(0,s.ogt)(t),c&&c.d()}}}function er(e){var t;return{c:function(){(t=(0,s.bGB)("div")).textContent="Empty",(0,s.Ljt)(t,"slot","empty"),(0,s.Ljt)(t,"class","vc-plugin-empty")},m:function(e,n){(0,s.$Tr)(e,t,n)},p:s.ZTd,d:function(e){e&&(0,s.ogt)(t)}}}function tr(e){var t,n,r,i,o,a,c,l;a=new ce({props:{content:e[10].requestHeader}});for(var d=Object.entries(e[10].requestHeader),u=[],p=0;p<d.length;p+=1)u[p]=nr(Xn(e,d,p));return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("dl"),r=(0,s.bGB)("dt"),i=(0,s.fLW)("Request Headers\n                "),o=(0,s.bGB)("i"),(0,s.YCL)(a.$$.fragment),c=(0,s.DhX)();for(var e=0;e<u.length;e+=1)u[e].c();(0,s.Ljt)(o,"class","vc-table-row-icon"),(0,s.Ljt)(r,"class","vc-table-col vc-table-col-title"),(0,s.Ljt)(n,"class","vc-table-row vc-left-border")},m:function(e,d){(0,s.$Tr)(e,t,d),(0,s.R3I)(t,n),(0,s.R3I)(n,r),(0,s.R3I)(r,i),(0,s.R3I)(r,o),(0,s.yef)(a,o,null),(0,s.R3I)(t,c);for(var p=0;p<u.length;p+=1)u[p].m(t,null);l=!0},p:function(e,n){var r={};if(1024&n&&(r.content=e[10].requestHeader),a.$set(r),1040&n){var i;for(d=Object.entries(e[10].requestHeader),i=0;i<d.length;i+=1){var o=Xn(e,d,i);u[i]?u[i].p(o,n):(u[i]=nr(o),u[i].c(),u[i].m(t,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=d.length}},i:function(e){l||((0,s.Ui)(a.$$.fragment,e),l=!0)},o:function(e){(0,s.etI)(a.$$.fragment,e),l=!1},d:function(e){e&&(0,s.ogt)(t),(0,s.vpE)(a),(0,s.RMB)(u,e)}}}function nr(e){var t,n,r,i,o,a,c,l=e[11]+"",d=e[4](e[12])+"";return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("div"),r=(0,s.fLW)(l),i=(0,s.DhX)(),o=(0,s.bGB)("div"),a=(0,s.fLW)(d),c=(0,s.DhX)(),(0,s.Ljt)(n,"class","vc-table-col vc-table-col-2"),(0,s.Ljt)(o,"class","vc-table-col vc-table-col-4 vc-table-col-value vc-max-height-line"),(0,s.Ljt)(t,"class","vc-table-row vc-left-border vc-small")},m:function(e,l){(0,s.$Tr)(e,t,l),(0,s.R3I)(t,n),(0,s.R3I)(n,r),(0,s.R3I)(t,i),(0,s.R3I)(t,o),(0,s.R3I)(o,a),(0,s.R3I)(t,c)},p:function(e,t){1024&t&&l!==(l=e[11]+"")&&(0,s.rTO)(r,l),1024&t&&d!==(d=e[4](e[12])+"")&&(0,s.rTO)(a,d)},d:function(e){e&&(0,s.ogt)(t)}}}function rr(e){var t,n,r,i,o,a,c,l;a=new ce({props:{content:e[10].getData}});for(var d=Object.entries(e[10].getData),u=[],p=0;p<d.length;p+=1)u[p]=ir(Jn(e,d,p));return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("dl"),r=(0,s.bGB)("dt"),i=(0,s.fLW)("Query String Parameters\n                "),o=(0,s.bGB)("i"),(0,s.YCL)(a.$$.fragment),c=(0,s.DhX)();for(var e=0;e<u.length;e+=1)u[e].c();(0,s.Ljt)(o,"class","vc-table-row-icon"),(0,s.Ljt)(r,"class","vc-table-col vc-table-col-title"),(0,s.Ljt)(n,"class","vc-table-row vc-left-border")},m:function(e,d){(0,s.$Tr)(e,t,d),(0,s.R3I)(t,n),(0,s.R3I)(n,r),(0,s.R3I)(r,i),(0,s.R3I)(r,o),(0,s.yef)(a,o,null),(0,s.R3I)(t,c);for(var p=0;p<u.length;p+=1)u[p].m(t,null);l=!0},p:function(e,n){var r={};if(1024&n&&(r.content=e[10].getData),a.$set(r),1040&n){var i;for(d=Object.entries(e[10].getData),i=0;i<d.length;i+=1){var o=Jn(e,d,i);u[i]?u[i].p(o,n):(u[i]=ir(o),u[i].c(),u[i].m(t,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=d.length}},i:function(e){l||((0,s.Ui)(a.$$.fragment,e),l=!0)},o:function(e){(0,s.etI)(a.$$.fragment,e),l=!1},d:function(e){e&&(0,s.ogt)(t),(0,s.vpE)(a),(0,s.RMB)(u,e)}}}function ir(e){var t,n,r,i,o,a,c,l=e[11]+"",d=e[4](e[12])+"";return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("div"),r=(0,s.fLW)(l),i=(0,s.DhX)(),o=(0,s.bGB)("div"),a=(0,s.fLW)(d),c=(0,s.DhX)(),(0,s.Ljt)(n,"class","vc-table-col vc-table-col-2"),(0,s.Ljt)(o,"class","vc-table-col vc-table-col-4 vc-table-col-value vc-max-height-line"),(0,s.Ljt)(t,"class","vc-table-row vc-left-border vc-small")},m:function(e,l){(0,s.$Tr)(e,t,l),(0,s.R3I)(t,n),(0,s.R3I)(n,r),(0,s.R3I)(t,i),(0,s.R3I)(t,o),(0,s.R3I)(o,a),(0,s.R3I)(t,c)},p:function(e,t){1024&t&&l!==(l=e[11]+"")&&(0,s.rTO)(r,l),1024&t&&d!==(d=e[4](e[12])+"")&&(0,s.rTO)(a,d)},d:function(e){e&&(0,s.ogt)(t)}}}function or(e){var t,n,r,i,o,a,c,l;function d(e,t){return"string"==typeof e[10].postData?ar:sr}a=new ce({props:{content:e[10].postData}});var u=d(e),p=u(e);return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("dl"),r=(0,s.bGB)("dt"),i=(0,s.fLW)("Request Payload\n                "),o=(0,s.bGB)("i"),(0,s.YCL)(a.$$.fragment),c=(0,s.DhX)(),p.c(),(0,s.Ljt)(o,"class","vc-table-row-icon"),(0,s.Ljt)(r,"class","vc-table-col vc-table-col-title"),(0,s.Ljt)(n,"class","vc-table-row vc-left-border")},m:function(e,d){(0,s.$Tr)(e,t,d),(0,s.R3I)(t,n),(0,s.R3I)(n,r),(0,s.R3I)(r,i),(0,s.R3I)(r,o),(0,s.yef)(a,o,null),(0,s.R3I)(t,c),p.m(t,null),l=!0},p:function(e,n){var r={};1024&n&&(r.content=e[10].postData),a.$set(r),u===(u=d(e))&&p?p.p(e,n):(p.d(1),(p=u(e))&&(p.c(),p.m(t,null)))},i:function(e){l||((0,s.Ui)(a.$$.fragment,e),l=!0)},o:function(e){(0,s.etI)(a.$$.fragment,e),l=!1},d:function(e){e&&(0,s.ogt)(t),(0,s.vpE)(a),p.d()}}}function sr(e){for(var t,n=Object.entries(e[10].postData),r=[],i=0;i<n.length;i+=1)r[i]=cr(Yn(e,n,i));return{c:function(){for(var e=0;e<r.length;e+=1)r[e].c();t=(0,s.cSb)()},m:function(e,n){for(var i=0;i<r.length;i+=1)r[i].m(e,n);(0,s.$Tr)(e,t,n)},p:function(e,i){if(1040&i){var o;for(n=Object.entries(e[10].postData),o=0;o<n.length;o+=1){var s=Yn(e,n,o);r[o]?r[o].p(s,i):(r[o]=cr(s),r[o].c(),r[o].m(t.parentNode,t))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d:function(e){(0,s.RMB)(r,e),e&&(0,s.ogt)(t)}}}function ar(e){var t,n,r,i=e[10].postData+"";return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("pre"),r=(0,s.fLW)(i),(0,s.Ljt)(n,"class","vc-table-col vc-table-col-value vc-max-height-line"),(0,s.Ljt)(n,"data-scrollable","1"),(0,s.Ljt)(t,"class","vc-table-row vc-left-border vc-small")},m:function(e,i){(0,s.$Tr)(e,t,i),(0,s.R3I)(t,n),(0,s.R3I)(n,r)},p:function(e,t){1024&t&&i!==(i=e[10].postData+"")&&(0,s.rTO)(r,i)},d:function(e){e&&(0,s.ogt)(t)}}}function cr(e){var t,n,r,i,o,a,c,l=e[11]+"",d=e[4](e[12])+"";return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("div"),r=(0,s.fLW)(l),i=(0,s.DhX)(),o=(0,s.bGB)("div"),a=(0,s.fLW)(d),c=(0,s.DhX)(),(0,s.Ljt)(n,"class","vc-table-col vc-table-col-2"),(0,s.Ljt)(o,"class","vc-table-col vc-table-col-4 vc-table-col-value vc-max-height-line"),(0,s.Ljt)(o,"data-scrollable","1"),(0,s.Ljt)(t,"class","vc-table-row vc-left-border vc-small")},m:function(e,l){(0,s.$Tr)(e,t,l),(0,s.R3I)(t,n),(0,s.R3I)(n,r),(0,s.R3I)(t,i),(0,s.R3I)(t,o),(0,s.R3I)(o,a),(0,s.R3I)(t,c)},p:function(e,t){1024&t&&l!==(l=e[11]+"")&&(0,s.rTO)(r,l),1024&t&&d!==(d=e[4](e[12])+"")&&(0,s.rTO)(a,d)},d:function(e){e&&(0,s.ogt)(t)}}}function lr(e){var t,n,r,i,o,a,c,l;a=new ce({props:{content:e[10].header}});for(var d=Object.entries(e[10].header),u=[],p=0;p<d.length;p+=1)u[p]=dr(Kn(e,d,p));return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("dl"),r=(0,s.bGB)("dt"),i=(0,s.fLW)("Response Headers\n                "),o=(0,s.bGB)("i"),(0,s.YCL)(a.$$.fragment),c=(0,s.DhX)();for(var e=0;e<u.length;e+=1)u[e].c();(0,s.Ljt)(o,"class","vc-table-row-icon"),(0,s.Ljt)(r,"class","vc-table-col vc-table-col-title"),(0,s.Ljt)(n,"class","vc-table-row vc-left-border")},m:function(e,d){(0,s.$Tr)(e,t,d),(0,s.R3I)(t,n),(0,s.R3I)(n,r),(0,s.R3I)(r,i),(0,s.R3I)(r,o),(0,s.yef)(a,o,null),(0,s.R3I)(t,c);for(var p=0;p<u.length;p+=1)u[p].m(t,null);l=!0},p:function(e,n){var r={};if(1024&n&&(r.content=e[10].header),a.$set(r),1040&n){var i;for(d=Object.entries(e[10].header),i=0;i<d.length;i+=1){var o=Kn(e,d,i);u[i]?u[i].p(o,n):(u[i]=dr(o),u[i].c(),u[i].m(t,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=d.length}},i:function(e){l||((0,s.Ui)(a.$$.fragment,e),l=!0)},o:function(e){(0,s.etI)(a.$$.fragment,e),l=!1},d:function(e){e&&(0,s.ogt)(t),(0,s.vpE)(a),(0,s.RMB)(u,e)}}}function dr(e){var t,n,r,i,o,a,c,l=e[11]+"",d=e[4](e[12])+"";return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("div"),r=(0,s.fLW)(l),i=(0,s.DhX)(),o=(0,s.bGB)("div"),a=(0,s.fLW)(d),c=(0,s.DhX)(),(0,s.Ljt)(n,"class","vc-table-col vc-table-col-2"),(0,s.Ljt)(o,"class","vc-table-col vc-table-col-4 vc-table-col-value vc-max-height-line"),(0,s.Ljt)(t,"class","vc-table-row vc-left-border vc-small")},m:function(e,l){(0,s.$Tr)(e,t,l),(0,s.R3I)(t,n),(0,s.R3I)(n,r),(0,s.R3I)(t,i),(0,s.R3I)(t,o),(0,s.R3I)(o,a),(0,s.R3I)(t,c)},p:function(e,t){1024&t&&l!==(l=e[11]+"")&&(0,s.rTO)(r,l),1024&t&&d!==(d=e[4](e[12])+"")&&(0,s.rTO)(a,d)},d:function(e){e&&(0,s.ogt)(t)}}}function ur(e){var t,n,r,i,o,a=e[10].responseSizeText+"";return{c:function(){t=(0,s.bGB)("div"),(n=(0,s.bGB)("div")).textContent="Size",r=(0,s.DhX)(),i=(0,s.bGB)("div"),o=(0,s.fLW)(a),(0,s.Ljt)(n,"class","vc-table-col vc-table-col-2"),(0,s.Ljt)(i,"class","vc-table-col vc-table-col-4 vc-table-col-value vc-max-height-line"),(0,s.Ljt)(t,"class","vc-table-row vc-left-border vc-small")},m:function(e,a){(0,s.$Tr)(e,t,a),(0,s.R3I)(t,n),(0,s.R3I)(t,r),(0,s.R3I)(t,i),(0,s.R3I)(i,o)},p:function(e,t){1024&t&&a!==(a=e[10].responseSizeText+"")&&(0,s.rTO)(o,a)},d:function(e){e&&(0,s.ogt)(t)}}}function pr(e){var t,n,r,i,o,a,c,l,d,u,p,h,g,m,f,v,y,_,I,T,S,E,M,b,C,A,O,R,N,w,P,k,L,x,V,D,U,$,B,F,j,q,G,H,W,z,K,Y,J,X,Q,Z,ee,te,ne,re,ie,oe,se,ae,le,de,ue,pe,he,ge,me,fe,ve=e[10].name+"",ye=e[10].method+"",_e=e[10].statusText+"",Ie=e[10].costTime+"",Te=e[10].url+"",Se=e[10].method+"",Ee=e[10].requestType+"",Me=e[10].status+"",be=e[10].startTimeText+"",Ce=(e[10].response||"")+"";function Ae(){return e[7](e[10])}_=new ce({props:{handler:e[3],content:e[10]}});var Oe=null!==e[10].requestHeader&&tr(e),Re=null!==e[10].getData&&rr(e),Ne=null!==e[10].postData&&or(e),we=null!==e[10].header&&lr(e);se=new ce({props:{content:e[10].response}});var Pe=e[10].responseSize>0&&ur(e);return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("dl"),r=(0,s.bGB)("dd"),i=(0,s.fLW)(ve),o=(0,s.bGB)("dd"),a=(0,s.fLW)(ye),c=(0,s.bGB)("dd"),l=(0,s.fLW)(_e),d=(0,s.bGB)("dd"),u=(0,s.fLW)(Ie),p=(0,s.DhX)(),h=(0,s.bGB)("div"),g=(0,s.bGB)("div"),m=(0,s.bGB)("dl"),f=(0,s.bGB)("dt"),v=(0,s.fLW)("General\n                "),y=(0,s.bGB)("i"),(0,s.YCL)(_.$$.fragment),I=(0,s.DhX)(),T=(0,s.bGB)("div"),(S=(0,s.bGB)("div")).textContent="URL",E=(0,s.DhX)(),M=(0,s.bGB)("div"),b=(0,s.fLW)(Te),C=(0,s.DhX)(),A=(0,s.bGB)("div"),(O=(0,s.bGB)("div")).textContent="Method",R=(0,s.DhX)(),N=(0,s.bGB)("div"),w=(0,s.fLW)(Se),P=(0,s.DhX)(),k=(0,s.bGB)("div"),(L=(0,s.bGB)("div")).textContent="Request Type",x=(0,s.DhX)(),V=(0,s.bGB)("div"),D=(0,s.fLW)(Ee),U=(0,s.DhX)(),$=(0,s.bGB)("div"),(B=(0,s.bGB)("div")).textContent="HTTP Status",F=(0,s.DhX)(),j=(0,s.bGB)("div"),q=(0,s.fLW)(Me),G=(0,s.DhX)(),H=(0,s.bGB)("div"),(W=(0,s.bGB)("div")).textContent="Start Time",z=(0,s.DhX)(),K=(0,s.bGB)("div"),Y=(0,s.fLW)(be),J=(0,s.DhX)(),Oe&&Oe.c(),X=(0,s.DhX)(),Re&&Re.c(),Q=(0,s.DhX)(),Ne&&Ne.c(),Z=(0,s.DhX)(),we&&we.c(),ee=(0,s.DhX)(),te=(0,s.bGB)("div"),ne=(0,s.bGB)("dl"),re=(0,s.bGB)("dt"),ie=(0,s.fLW)("Response\n                "),oe=(0,s.bGB)("i"),(0,s.YCL)(se.$$.fragment),ae=(0,s.DhX)(),Pe&&Pe.c(),le=(0,s.DhX)(),de=(0,s.bGB)("div"),ue=(0,s.bGB)("pre"),pe=(0,s.fLW)(Ce),(0,s.Ljt)(r,"class","vc-table-col vc-table-col-4"),(0,s.Ljt)(o,"class","vc-table-col"),(0,s.Ljt)(c,"class","vc-table-col"),(0,s.Ljt)(d,"class","vc-table-col"),(0,s.Ljt)(n,"class","vc-table-row vc-group-preview"),(0,s.VHj)(n,"vc-table-row-error",e[10].status>=400),(0,s.Ljt)(y,"class","vc-table-row-icon"),(0,s.Ljt)(f,"class","vc-table-col vc-table-col-title"),(0,s.Ljt)(m,"class","vc-table-row vc-left-border"),(0,s.Ljt)(S,"class","vc-table-col vc-table-col-2"),(0,s.Ljt)(M,"class","vc-table-col vc-table-col-4 vc-table-col-value vc-max-height-line"),(0,s.Ljt)(T,"class","vc-table-row vc-left-border vc-small"),(0,s.Ljt)(O,"class","vc-table-col vc-table-col-2"),(0,s.Ljt)(N,"class","vc-table-col vc-table-col-4 vc-table-col-value vc-max-height-line"),(0,s.Ljt)(A,"class","vc-table-row vc-left-border vc-small"),(0,s.Ljt)(L,"class","vc-table-col vc-table-col-2"),(0,s.Ljt)(V,"class","vc-table-col vc-table-col-4 vc-table-col-value vc-max-height-line"),(0,s.Ljt)(k,"class","vc-table-row vc-left-border vc-small"),(0,s.Ljt)(B,"class","vc-table-col vc-table-col-2"),(0,s.Ljt)(j,"class","vc-table-col vc-table-col-4 vc-table-col-value vc-max-height-line"),(0,s.Ljt)($,"class","vc-table-row vc-left-border vc-small"),(0,s.Ljt)(W,"class","vc-table-col vc-table-col-2"),(0,s.Ljt)(K,"class","vc-table-col vc-table-col-4 vc-table-col-value vc-max-height-line"),(0,s.Ljt)(H,"class","vc-table-row vc-left-border vc-small"),(0,s.Ljt)(oe,"class","vc-table-row-icon"),(0,s.Ljt)(re,"class","vc-table-col vc-table-col-title"),(0,s.Ljt)(ne,"class","vc-table-row vc-left-border"),(0,s.Ljt)(ue,"class","vc-table-col vc-max-height vc-min-height"),(0,s.Ljt)(ue,"data-scrollable","1"),(0,s.Ljt)(de,"class","vc-table-row vc-left-border vc-small"),(0,s.Ljt)(h,"class","vc-group-detail"),(0,s.Ljt)(t,"slot","item"),(0,s.Ljt)(t,"class","vc-group"),(0,s.Ljt)(t,"id",he=e[10].id),(0,s.VHj)(t,"vc-actived",e[10].actived)},m:function(e,ce){(0,s.$Tr)(e,t,ce),(0,s.R3I)(t,n),(0,s.R3I)(n,r),(0,s.R3I)(r,i),(0,s.R3I)(n,o),(0,s.R3I)(o,a),(0,s.R3I)(n,c),(0,s.R3I)(c,l),(0,s.R3I)(n,d),(0,s.R3I)(d,u),(0,s.R3I)(t,p),(0,s.R3I)(t,h),(0,s.R3I)(h,g),(0,s.R3I)(g,m),(0,s.R3I)(m,f),(0,s.R3I)(f,v),(0,s.R3I)(f,y),(0,s.yef)(_,y,null),(0,s.R3I)(g,I),(0,s.R3I)(g,T),(0,s.R3I)(T,S),(0,s.R3I)(T,E),(0,s.R3I)(T,M),(0,s.R3I)(M,b),(0,s.R3I)(g,C),(0,s.R3I)(g,A),(0,s.R3I)(A,O),(0,s.R3I)(A,R),(0,s.R3I)(A,N),(0,s.R3I)(N,w),(0,s.R3I)(g,P),(0,s.R3I)(g,k),(0,s.R3I)(k,L),(0,s.R3I)(k,x),(0,s.R3I)(k,V),(0,s.R3I)(V,D),(0,s.R3I)(g,U),(0,s.R3I)(g,$),(0,s.R3I)($,B),(0,s.R3I)($,F),(0,s.R3I)($,j),(0,s.R3I)(j,q),(0,s.R3I)(g,G),(0,s.R3I)(g,H),(0,s.R3I)(H,W),(0,s.R3I)(H,z),(0,s.R3I)(H,K),(0,s.R3I)(K,Y),(0,s.R3I)(h,J),Oe&&Oe.m(h,null),(0,s.R3I)(h,X),Re&&Re.m(h,null),(0,s.R3I)(h,Q),Ne&&Ne.m(h,null),(0,s.R3I)(h,Z),we&&we.m(h,null),(0,s.R3I)(h,ee),(0,s.R3I)(h,te),(0,s.R3I)(te,ne),(0,s.R3I)(ne,re),(0,s.R3I)(re,ie),(0,s.R3I)(re,oe),(0,s.yef)(se,oe,null),(0,s.R3I)(te,ae),Pe&&Pe.m(te,null),(0,s.R3I)(te,le),(0,s.R3I)(te,de),(0,s.R3I)(de,ue),(0,s.R3I)(ue,pe),ge=!0,me||(fe=(0,s.oLt)(n,"click",Ae),me=!0)},p:function(r,o){e=r,(!ge||1024&o)&&ve!==(ve=e[10].name+"")&&(0,s.rTO)(i,ve),(!ge||1024&o)&&ye!==(ye=e[10].method+"")&&(0,s.rTO)(a,ye),(!ge||1024&o)&&_e!==(_e=e[10].statusText+"")&&(0,s.rTO)(l,_e),(!ge||1024&o)&&Ie!==(Ie=e[10].costTime+"")&&(0,s.rTO)(u,Ie),1024&o&&(0,s.VHj)(n,"vc-table-row-error",e[10].status>=400);var c={};1024&o&&(c.content=e[10]),_.$set(c),(!ge||1024&o)&&Te!==(Te=e[10].url+"")&&(0,s.rTO)(b,Te),(!ge||1024&o)&&Se!==(Se=e[10].method+"")&&(0,s.rTO)(w,Se),(!ge||1024&o)&&Ee!==(Ee=e[10].requestType+"")&&(0,s.rTO)(D,Ee),(!ge||1024&o)&&Me!==(Me=e[10].status+"")&&(0,s.rTO)(q,Me),(!ge||1024&o)&&be!==(be=e[10].startTimeText+"")&&(0,s.rTO)(Y,be),null!==e[10].requestHeader?Oe?(Oe.p(e,o),1024&o&&(0,s.Ui)(Oe,1)):((Oe=tr(e)).c(),(0,s.Ui)(Oe,1),Oe.m(h,X)):Oe&&((0,s.dvw)(),(0,s.etI)(Oe,1,1,function(){Oe=null}),(0,s.gbL)()),null!==e[10].getData?Re?(Re.p(e,o),1024&o&&(0,s.Ui)(Re,1)):((Re=rr(e)).c(),(0,s.Ui)(Re,1),Re.m(h,Q)):Re&&((0,s.dvw)(),(0,s.etI)(Re,1,1,function(){Re=null}),(0,s.gbL)()),null!==e[10].postData?Ne?(Ne.p(e,o),1024&o&&(0,s.Ui)(Ne,1)):((Ne=or(e)).c(),(0,s.Ui)(Ne,1),Ne.m(h,Z)):Ne&&((0,s.dvw)(),(0,s.etI)(Ne,1,1,function(){Ne=null}),(0,s.gbL)()),null!==e[10].header?we?(we.p(e,o),1024&o&&(0,s.Ui)(we,1)):((we=lr(e)).c(),(0,s.Ui)(we,1),we.m(h,ee)):we&&((0,s.dvw)(),(0,s.etI)(we,1,1,function(){we=null}),(0,s.gbL)());var d={};1024&o&&(d.content=e[10].response),se.$set(d),e[10].responseSize>0?Pe?Pe.p(e,o):((Pe=ur(e)).c(),Pe.m(te,le)):Pe&&(Pe.d(1),Pe=null),(!ge||1024&o)&&Ce!==(Ce=(e[10].response||"")+"")&&(0,s.rTO)(pe,Ce),(!ge||1024&o&&he!==(he=e[10].id))&&(0,s.Ljt)(t,"id",he),1024&o&&(0,s.VHj)(t,"vc-actived",e[10].actived)},i:function(e){ge||((0,s.Ui)(_.$$.fragment,e),(0,s.Ui)(Oe),(0,s.Ui)(Re),(0,s.Ui)(Ne),(0,s.Ui)(we),(0,s.Ui)(se.$$.fragment,e),ge=!0)},o:function(e){(0,s.etI)(_.$$.fragment,e),(0,s.etI)(Oe),(0,s.etI)(Re),(0,s.etI)(Ne),(0,s.etI)(we),(0,s.etI)(se.$$.fragment,e),ge=!1},d:function(e){e&&(0,s.ogt)(t),(0,s.vpE)(_),Oe&&Oe.d(),Re&&Re.d(),Ne&&Ne.d(),we&&we.d(),(0,s.vpE)(se),Pe&&Pe.d(),me=!1,fe()}}}function hr(e){var t,n,r,i;return r=new on({props:{items:e[1],itemKey:"id",itemHeight:30,buffer:100,stickToBottom:!0,scrollbar:!0,$$slots:{item:[pr,function(e){return{10:e.item}},function(e){return e.item?1024:0}],empty:[er],header:[Zn]},$$scope:{ctx:e}}}),{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("div"),(0,s.YCL)(r.$$.fragment),(0,s.Ljt)(n,"class","vc-plugin-content"),(0,s.Ljt)(t,"class","vc-table")},m:function(e,o){(0,s.$Tr)(e,t,o),(0,s.R3I)(t,n),(0,s.yef)(r,n,null),i=!0},p:function(e,t){var n=t[0],i={};2&n&&(i.items=e[1]),2098177&n&&(i.$$scope={dirty:n,ctx:e}),r.$set(i)},i:function(e){i||((0,s.Ui)(r.$$.fragment,e),i=!0)},o:function(e){(0,s.etI)(r.$$.fragment,e),i=!1},d:function(e){e&&(0,s.ogt)(t),(0,s.vpE)(r)}}}function gr(e,n,r){var i;(0,s.FIv)(e,Bn,function(e){return r(6,i=e)});var o=0,c=function(e){r(0,o=Object.keys(e).length)},l=Bn.subscribe(c);c(i);var d=[],u=function(e){(0,s.fxP)(Bn,i[e].actived=!i[e].actived,i)};return(0,a.H3)(function(){zn.use()}),(0,a.ev)(function(){l(),zn.unuse()}),e.$$.update=function(){64&e.$$.dirty&&r(1,d=Object.values(i))},[o,d,u,function(e){var n="curl -X "+e.method;return"string"==typeof e.postData?n+=" -d '"+e.postData+"'":"object"==typeof e.postData&&null!==e.postData&&(n+=" -d '"+t.hZ(e.postData)+"'"),n+" '"+e.url+"'"},function(e){return t.Kn(e)||t.kJ(e)?t.hZ(e,{maxDepth:10,keyMaxLen:1e4,pretty:!0}):e},{fixedHeight:!0},i,function(e){return u(e.id)}]}var mr=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,gr,hr,s.N8,{options:5}),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"options",get:function(){return this.$$.ctx[5]}}]),n}(s.f_C),fr=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).model=Fn.getSingleton(Fn,"VConsoleNetworkModel"),t}(0,o.Z)(t,e);var n=t.prototype;return n.add=function(e){var t=new On(new An);for(var n in e)t[n]=e[n];return t.startTime=t.startTime||Date.now(),t.requestType=t.requestType||"custom",this.model.updateRequest(t.id,t),t},n.update=function(e,t){this.model.updateRequest(e,t)},n.clear=function(){this.model.clearLog()},t}(gn),vr=function(e){function t(t,n,r){var i;return void 0===r&&(r={}),(i=e.call(this,t,n,mr,r)||this).model=Fn.getSingleton(Fn,"VConsoleNetworkModel"),i.exporter=void 0,i.exporter=new fr(t),i}(0,o.Z)(t,e);var n=t.prototype;return n.onReady=function(){e.prototype.onReady.call(this),this.onUpdateOption()},n.onAddTool=function(e){var t=this;e([{name:"Clear",global:!1,onClick:function(e){t.model.clearLog()}}])},n.onRemove=function(){e.prototype.onRemove.call(this),this.model&&this.model.unMock()},n.onUpdateOption=function(){var e,t,n;(null==(e=this.vConsole.option.network)?void 0:e.maxNetworkNumber)!==this.model.maxNetworkNumber&&(this.model.maxNetworkNumber=Number(null==(n=this.vConsole.option.network)?void 0:n.maxNetworkNumber)||1e3),null!=(t=this.vConsole.option.network)&&t.ignoreUrlRegExp&&(this.model.ignoreUrlRegExp=this.vConsole.option.network.ignoreUrlRegExp)},t}(ne),yr=__webpack_require__(8679),_r=__webpack_require__.n(yr),Ir=(0,_n.fZ)(),Tr=(0,_n.fZ)(),Sr=__webpack_require__(5670),Er={};Sr.Z&&Sr.Z.locals&&(Er.locals=Sr.Z.locals);var Mr,br=0,Cr={};Cr.styleTagTransform=_(),Cr.setAttributes=m(),Cr.insert=h().bind(null,"head"),Cr.domAPI=u(),Cr.insertStyleElement=v(),Er.use=function(e){return Cr.options=e||{},br++||(Mr=l()(Sr.Z,Cr)),Er},Er.unuse=function(){br>0&&! --br&&(Mr(),Mr=null)};var Ar=Er;function Or(e,t,n){var r=e.slice();return r[8]=t[n],r}function Rr(e,t,n){var r=e.slice();return r[11]=t[n],r}function Nr(e){var t,n,r,i=e[0].nodeType===Node.ELEMENT_NODE&&wr(e),o=e[0].nodeType===Node.TEXT_NODE&&jr(e);return{c:function(){t=(0,s.bGB)("div"),i&&i.c(),n=(0,s.DhX)(),o&&o.c(),(0,s.Ljt)(t,"class","vcelm-l"),(0,s.VHj)(t,"vc-actived",e[0]._isActived),(0,s.VHj)(t,"vc-toggle",e[0]._isExpand),(0,s.VHj)(t,"vcelm-noc",e[0]._isSingleLine)},m:function(e,a){(0,s.$Tr)(e,t,a),i&&i.m(t,null),(0,s.R3I)(t,n),o&&o.m(t,null),r=!0},p:function(e,r){e[0].nodeType===Node.ELEMENT_NODE?i?(i.p(e,r),1&r&&(0,s.Ui)(i,1)):((i=wr(e)).c(),(0,s.Ui)(i,1),i.m(t,n)):i&&((0,s.dvw)(),(0,s.etI)(i,1,1,function(){i=null}),(0,s.gbL)()),e[0].nodeType===Node.TEXT_NODE?o?o.p(e,r):((o=jr(e)).c(),o.m(t,null)):o&&(o.d(1),o=null),1&r&&(0,s.VHj)(t,"vc-actived",e[0]._isActived),1&r&&(0,s.VHj)(t,"vc-toggle",e[0]._isExpand),1&r&&(0,s.VHj)(t,"vcelm-noc",e[0]._isSingleLine)},i:function(e){r||((0,s.Ui)(i),r=!0)},o:function(e){(0,s.etI)(i),r=!1},d:function(e){e&&(0,s.ogt)(t),i&&i.d(),o&&o.d()}}}function wr(e){var t,n,r,i,o,a,c,l,d,u,p=e[0].nodeName+"",h=(e[0].className||e[0].attributes.length)&&Pr(e),g=e[0]._isNullEndTag&&Vr(),m=e[0].childNodes.length>0&&Dr(e),f=!e[0]._isNullEndTag&&Fr(e);return{c:function(){t=(0,s.bGB)("span"),n=(0,s.fLW)("<"),r=(0,s.fLW)(p),h&&h.c(),i=(0,s.cSb)(),g&&g.c(),o=(0,s.fLW)(">"),m&&m.c(),a=(0,s.cSb)(),f&&f.c(),c=(0,s.cSb)(),(0,s.Ljt)(t,"class","vcelm-node")},m:function(p,v){(0,s.$Tr)(p,t,v),(0,s.R3I)(t,n),(0,s.R3I)(t,r),h&&h.m(t,null),(0,s.R3I)(t,i),g&&g.m(t,null),(0,s.R3I)(t,o),m&&m.m(p,v),(0,s.$Tr)(p,a,v),f&&f.m(p,v),(0,s.$Tr)(p,c,v),l=!0,d||(u=(0,s.oLt)(t,"click",e[2]),d=!0)},p:function(e,n){(!l||1&n)&&p!==(p=e[0].nodeName+"")&&(0,s.rTO)(r,p),e[0].className||e[0].attributes.length?h?h.p(e,n):((h=Pr(e)).c(),h.m(t,i)):h&&(h.d(1),h=null),e[0]._isNullEndTag?g||((g=Vr()).c(),g.m(t,o)):g&&(g.d(1),g=null),e[0].childNodes.length>0?m?(m.p(e,n),1&n&&(0,s.Ui)(m,1)):((m=Dr(e)).c(),(0,s.Ui)(m,1),m.m(a.parentNode,a)):m&&((0,s.dvw)(),(0,s.etI)(m,1,1,function(){m=null}),(0,s.gbL)()),e[0]._isNullEndTag?f&&(f.d(1),f=null):f?f.p(e,n):((f=Fr(e)).c(),f.m(c.parentNode,c))},i:function(e){l||((0,s.Ui)(m),l=!0)},o:function(e){(0,s.etI)(m),l=!1},d:function(e){e&&(0,s.ogt)(t),h&&h.d(),g&&g.d(),m&&m.d(e),e&&(0,s.ogt)(a),f&&f.d(e),e&&(0,s.ogt)(c),d=!1,u()}}}function Pr(e){for(var t,n=e[0].attributes,r=[],i=0;i<n.length;i+=1)r[i]=xr(Rr(e,n,i));return{c:function(){t=(0,s.bGB)("i");for(var e=0;e<r.length;e+=1)r[e].c();(0,s.Ljt)(t,"class","vcelm-k")},m:function(e,n){(0,s.$Tr)(e,t,n);for(var i=0;i<r.length;i+=1)r[i].m(t,null)},p:function(e,i){if(1&i){var o;for(n=e[0].attributes,o=0;o<n.length;o+=1){var s=Rr(e,n,o);r[o]?r[o].p(s,i):(r[o]=xr(s),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d:function(e){e&&(0,s.ogt)(t),(0,s.RMB)(r,e)}}}function kr(e){var t,n=e[11].name+"";return{c:function(){t=(0,s.fLW)(n)},m:function(e,n){(0,s.$Tr)(e,t,n)},p:function(e,r){1&r&&n!==(n=e[11].name+"")&&(0,s.rTO)(t,n)},d:function(e){e&&(0,s.ogt)(t)}}}function Lr(e){var t,n,r,i,o,a=e[11].name+"",c=e[11].value+"";return{c:function(){t=(0,s.fLW)(a),n=(0,s.fLW)('="'),r=(0,s.bGB)("i"),i=(0,s.fLW)(c),o=(0,s.fLW)('"'),(0,s.Ljt)(r,"class","vcelm-v")},m:function(e,a){(0,s.$Tr)(e,t,a),(0,s.$Tr)(e,n,a),(0,s.$Tr)(e,r,a),(0,s.R3I)(r,i),(0,s.$Tr)(e,o,a)},p:function(e,n){1&n&&a!==(a=e[11].name+"")&&(0,s.rTO)(t,a),1&n&&c!==(c=e[11].value+"")&&(0,s.rTO)(i,c)},d:function(e){e&&(0,s.ogt)(t),e&&(0,s.ogt)(n),e&&(0,s.ogt)(r),e&&(0,s.ogt)(o)}}}function xr(e){var t,n;function r(e,t){return""!==e[11].value?Lr:kr}var i=r(e),o=i(e);return{c:function(){t=(0,s.fLW)(" \n            "),o.c(),n=(0,s.cSb)()},m:function(e,r){(0,s.$Tr)(e,t,r),o.m(e,r),(0,s.$Tr)(e,n,r)},p:function(e,t){i===(i=r(e))&&o?o.p(e,t):(o.d(1),(o=i(e))&&(o.c(),o.m(n.parentNode,n)))},d:function(e){e&&(0,s.ogt)(t),o.d(e),e&&(0,s.ogt)(n)}}}function Vr(e){var t;return{c:function(){t=(0,s.fLW)("/")},m:function(e,n){(0,s.$Tr)(e,t,n)},d:function(e){e&&(0,s.ogt)(t)}}}function Dr(e){var t,n,r,i,o=[$r,Ur],a=[];function c(e,t){return e[0]._isExpand?1:0}return t=c(e),n=a[t]=o[t](e),{c:function(){n.c(),r=(0,s.cSb)()},m:function(e,n){a[t].m(e,n),(0,s.$Tr)(e,r,n),i=!0},p:function(e,i){var l=t;(t=c(e))===l?a[t].p(e,i):((0,s.dvw)(),(0,s.etI)(a[l],1,1,function(){a[l]=null}),(0,s.gbL)(),(n=a[t])?n.p(e,i):(n=a[t]=o[t](e)).c(),(0,s.Ui)(n,1),n.m(r.parentNode,r))},i:function(e){i||((0,s.Ui)(n),i=!0)},o:function(e){(0,s.etI)(n),i=!1},d:function(e){a[t].d(e),e&&(0,s.ogt)(r)}}}function Ur(e){for(var t,n,r=e[0].childNodes,i=[],o=0;o<r.length;o+=1)i[o]=Br(Or(e,r,o));var a=function(e){return(0,s.etI)(i[e],1,1,function(){i[e]=null})};return{c:function(){for(var e=0;e<i.length;e+=1)i[e].c();t=(0,s.cSb)()},m:function(e,r){for(var o=0;o<i.length;o+=1)i[o].m(e,r);(0,s.$Tr)(e,t,r),n=!0},p:function(e,n){if(1&n){var o;for(r=e[0].childNodes,o=0;o<r.length;o+=1){var c=Or(e,r,o);i[o]?(i[o].p(c,n),(0,s.Ui)(i[o],1)):(i[o]=Br(c),i[o].c(),(0,s.Ui)(i[o],1),i[o].m(t.parentNode,t))}for((0,s.dvw)(),o=r.length;o<i.length;o+=1)a(o);(0,s.gbL)()}},i:function(e){if(!n){for(var t=0;t<r.length;t+=1)(0,s.Ui)(i[t]);n=!0}},o:function(e){i=i.filter(Boolean);for(var t=0;t<i.length;t+=1)(0,s.etI)(i[t]);n=!1},d:function(e){(0,s.RMB)(i,e),e&&(0,s.ogt)(t)}}}function $r(e){var t;return{c:function(){t=(0,s.fLW)("...")},m:function(e,n){(0,s.$Tr)(e,t,n)},p:s.ZTd,i:s.ZTd,o:s.ZTd,d:function(e){e&&(0,s.ogt)(t)}}}function Br(e){var t,n,r;return(t=new Hr({props:{node:e[8]}})).$on("toggleNode",e[4]),{c:function(){(0,s.YCL)(t.$$.fragment),n=(0,s.DhX)()},m:function(e,i){(0,s.yef)(t,e,i),(0,s.$Tr)(e,n,i),r=!0},p:function(e,n){var r={};1&n&&(r.node=e[8]),t.$set(r)},i:function(e){r||((0,s.Ui)(t.$$.fragment,e),r=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),r=!1},d:function(e){(0,s.vpE)(t,e),e&&(0,s.ogt)(n)}}}function Fr(e){var t,n,r,i,o=e[0].nodeName+"";return{c:function(){t=(0,s.bGB)("span"),n=(0,s.fLW)("</"),r=(0,s.fLW)(o),i=(0,s.fLW)(">"),(0,s.Ljt)(t,"class","vcelm-node")},m:function(e,o){(0,s.$Tr)(e,t,o),(0,s.R3I)(t,n),(0,s.R3I)(t,r),(0,s.R3I)(t,i)},p:function(e,t){1&t&&o!==(o=e[0].nodeName+"")&&(0,s.rTO)(r,o)},d:function(e){e&&(0,s.ogt)(t)}}}function jr(e){var t,n,r=e[1](e[0].textContent)+"";return{c:function(){t=(0,s.bGB)("span"),n=(0,s.fLW)(r),(0,s.Ljt)(t,"class","vcelm-t vcelm-noc")},m:function(e,r){(0,s.$Tr)(e,t,r),(0,s.R3I)(t,n)},p:function(e,t){1&t&&r!==(r=e[1](e[0].textContent)+"")&&(0,s.rTO)(n,r)},d:function(e){e&&(0,s.ogt)(t)}}}function qr(e){var t,n,r=e[0]&&Nr(e);return{c:function(){r&&r.c(),t=(0,s.cSb)()},m:function(e,i){r&&r.m(e,i),(0,s.$Tr)(e,t,i),n=!0},p:function(e,n){var i=n[0];e[0]?r?(r.p(e,i),1&i&&(0,s.Ui)(r,1)):((r=Nr(e)).c(),(0,s.Ui)(r,1),r.m(t.parentNode,t)):r&&((0,s.dvw)(),(0,s.etI)(r,1,1,function(){r=null}),(0,s.gbL)())},i:function(e){n||((0,s.Ui)(r),n=!0)},o:function(e){(0,s.etI)(r),n=!1},d:function(e){r&&r.d(e),e&&(0,s.ogt)(t)}}}function Gr(e,t,n){var r;(0,s.FIv)(e,Tr,function(e){return n(3,r=e)});var i=t.node,o=(0,a.x)(),c=["br","hr","img","input","link","meta"];return(0,a.H3)(function(){Ar.use()}),(0,a.ev)(function(){Ar.unuse()}),e.$$set=function(e){"node"in e&&n(0,i=e.node)},e.$$.update=function(){var t;9&e.$$.dirty&&i&&(n(0,i._isActived=i===r,i),n(0,i._isNullEndTag=(t=i,c.indexOf(t.nodeName)>-1),i),n(0,i._isSingleLine=0===i.childNodes.length||i._isNullEndTag,i))},[i,function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},function(){i._isNullEndTag||(n(0,i._isExpand=!i._isExpand,i),o("toggleNode",{node:i}))},r,function(t){s.cKT.call(this,e,t)}]}var Hr=function(t){function n(e){var n;return n=t.call(this)||this,(0,s.S1n)((0,i.Z)(n),e,Gr,qr,s.N8,{node:0}),n}return(0,o.Z)(n,t),(0,e.Z)(n,[{key:"node",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({node:e}),(0,s.yl1)()}}]),n}(s.f_C),Wr=Hr;function zr(e){var t,n,r;return(n=new Wr({props:{node:e[0]}})).$on("toggleNode",e[1]),{c:function(){t=(0,s.bGB)("div"),(0,s.YCL)(n.$$.fragment),(0,s.Ljt)(t,"class","vc-plugin-content")},m:function(e,i){(0,s.$Tr)(e,t,i),(0,s.yef)(n,t,null),r=!0},p:function(e,t){var r={};1&t[0]&&(r.node=e[0]),n.$set(r)},i:function(e){r||((0,s.Ui)(n.$$.fragment,e),r=!0)},o:function(e){(0,s.etI)(n.$$.fragment,e),r=!1},d:function(e){e&&(0,s.ogt)(t),(0,s.vpE)(n)}}}function Kr(e,t,n){var r;return(0,s.FIv)(e,Ir,function(e){return n(0,r=e)}),[r,function(t){s.cKT.call(this,e,t)}]}var Yr=function(e){function t(t){var n;return n=e.call(this)||this,(0,s.S1n)((0,i.Z)(n),t,Kr,zr,s.N8,{}),n}return(0,o.Z)(t,e),t}(s.f_C),Jr=function(e){function t(t,n,r){var i;return void 0===r&&(r={}),(i=e.call(this,t,n,Yr,r)||this).isInited=!1,i.observer=void 0,i.nodeMap=void 0,i}(0,o.Z)(t,e);var n=t.prototype;return n.onShow=function(){this.isInited||this._init()},n.onRemove=function(){e.prototype.onRemove.call(this),this.isInited&&(this.observer.disconnect(),this.isInited=!1,this.nodeMap=void 0,Ir.set(void 0))},n.onAddTool=function(e){var t=this;e([{name:"Expand",global:!1,onClick:function(e){t._expandActivedNode()}},{name:"Collapse",global:!1,onClick:function(e){t._collapseActivedNode()}}])},n._init=function(){var e=this;this.isInited=!0,this.nodeMap=new WeakMap;var t=this._generateVNode(document.documentElement);t._isExpand=!0,Tr.set(t),Ir.set(t),this.compInstance.$on("toggleNode",function(e){Tr.set(e.detail.node)}),this.observer=new(_r())(function(t){for(var n=0;n<t.length;n++){var r=t[n];e._isInVConsole(r.target)||e._handleMutation(r)}}),this.observer.observe(document.documentElement,{attributes:!0,childList:!0,characterData:!0,subtree:!0})},n._handleMutation=function(e){switch(e.type){case"childList":e.removedNodes.length>0&&this._onChildRemove(e),e.addedNodes.length>0&&this._onChildAdd(e);break;case"attributes":this._onAttributesChange(e);break;case"characterData":this._onCharacterDataChange(e)}},n._onChildRemove=function(e){var t=this.nodeMap.get(e.target);if(t){for(var n=0;n<e.removedNodes.length;n++){var r=this.nodeMap.get(e.removedNodes[n]);if(r){for(var i=0;i<t.childNodes.length;i++)if(t.childNodes[i]===r){t.childNodes.splice(i,1);break}this.nodeMap.delete(e.removedNodes[n])}}this._refreshStore()}},n._onChildAdd=function(e){var t=this.nodeMap.get(e.target);if(t){for(var n=0;n<e.addedNodes.length;n++){var r=e.addedNodes[n],i=this._generateVNode(r);if(i){var o=void 0,s=r;do{if(null===s.nextSibling)break;s.nodeType===Node.ELEMENT_NODE&&(o=this.nodeMap.get(s.nextSibling)||void 0),s=s.nextSibling}while(void 0===o);if(void 0===o)t.childNodes.push(i);else for(var a=0;a<t.childNodes.length;a++)if(t.childNodes[a]===o){t.childNodes.splice(a,0,i);break}}}this._refreshStore()}},n._onAttributesChange=function(e){this._updateVNodeAttributes(e.target),this._refreshStore()},n._onCharacterDataChange=function(e){var t=this.nodeMap.get(e.target);t&&(t.textContent=e.target.textContent,this._refreshStore())},n._generateVNode=function(e){if(!this._isIgnoredNode(e)){var t={nodeType:e.nodeType,nodeName:e.nodeName.toLowerCase(),textContent:"",id:"",className:"",attributes:[],childNodes:[]};if(this.nodeMap.set(e,t),t.nodeType!=e.TEXT_NODE&&t.nodeType!=e.DOCUMENT_TYPE_NODE||(t.textContent=e.textContent),e.childNodes.length>0){t.childNodes=[];for(var n=0;n<e.childNodes.length;n++){var r=this._generateVNode(e.childNodes[n]);r&&t.childNodes.push(r)}}return this._updateVNodeAttributes(e),t}},n._updateVNodeAttributes=function(e){var t=this.nodeMap.get(e);if(t&&e instanceof Element&&(t.id=e.id||"",t.className=e.className||"",e.hasAttributes&&e.hasAttributes())){t.attributes=[];for(var n=0;n<e.attributes.length;n++)t.attributes.push({name:e.attributes[n].name,value:e.attributes[n].value||""})}},n._expandActivedNode=function(){var e=(0,_n.U2)(Tr);if(e._isExpand)for(var t=0;t<e.childNodes.length;t++)e.childNodes[t]._isExpand=!0;else e._isExpand=!0;this._refreshStore()},n._collapseActivedNode=function(){var e=(0,_n.U2)(Tr);if(e._isExpand){for(var t=!1,n=0;n<e.childNodes.length;n++)e.childNodes[n]._isExpand&&(t=!0,e.childNodes[n]._isExpand=!1);t||(e._isExpand=!1),this._refreshStore()}},n._isIgnoredNode=function(e){if(e.nodeType===e.TEXT_NODE){if(""===e.textContent.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$|\n+/g,""))return!0}else if(e.nodeType===e.COMMENT_NODE)return!0;return!1},n._isInVConsole=function(e){for(var t=e;void 0!==t;){if("__vconsole"==t.id)return!0;t=t.parentElement||void 0}return!1},n._refreshStore=function(){Ir.update(function(e){return e})},t}(ne);function Xr(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(l){return void n(l)}a.done?t(c):Promise.resolve(c).then(r,i)}function Qr(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){Xr(o,r,i,s,a,"next",e)}function a(e){Xr(o,r,i,s,a,"throw",e)}s(void 0)})}}var Zr=__webpack_require__(8270);function ei(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ti(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ei(Object(n),!0).forEach(function(t){(0,Zr.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ei(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ni=function(e){if(!e||0===e.length)return{};for(var t={},n=e.split(";"),r=0;r<n.length;r++){var i=n[r].indexOf("=");if(!(i<0)){var o=n[r].substring(0,i).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),s=n[r].substring(i+1,n[r].length);try{o=decodeURIComponent(o)}catch(a){}try{s=decodeURIComponent(s)}catch(a){}t[o]=s}}return t},ri=function(e,t,n){"undefined"!=typeof document&&void 0!==document.cookie&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+function(e){void 0===e&&(e={});var t=e,n=t.path,r=t.domain,i=t.expires,o=t.secure,s=t.sameSite,a=["none","lax","strict"].indexOf((s||"").toLowerCase())>-1?s:null;return[null==n?"":";path="+n,null==r?"":";domain="+r,null==i?"":";expires="+i.toUTCString(),void 0===o||!1===o?"":";secure",null===a?"":";SameSite="+a].join("")}(n))},ii=function(){return"undefined"==typeof document||void 0===document.cookie?"":document.cookie},oi=function(){function t(){}var n=t.prototype;return n.key=function(e){return e<this.keys.length?this.keys[e]:null},n.setItem=function(e,t,n){ri(e,t,n)},n.getItem=function(e){var t=ni(ii());return Object.prototype.hasOwnProperty.call(t,e)?t[e]:null},n.removeItem=function(e,t){for(var n,r,i=["","/"],o=(null==(n=location)||null==(r=n.hostname)?void 0:r.split("."))||[];o.length>1;)i.push(o.join(".")),o.shift();for(var s=0;s<i.length;s++)for(var a,c,l=(null==(a=location)||null==(c=a.pathname)?void 0:c.split("/"))||[],d="";l.length>0;){d+=("/"===d?"":"/")+l.shift();var u=ti(ti({},t),{},{path:d,domain:i[s],expires:new Date(0)});ri(e,"",u)}},n.clear=function(){for(var e=[].concat(this.keys),t=0;t<e.length;t++)this.removeItem(e[t])},(0,e.Z)(t,[{key:"length",get:function(){return this.keys.length}},{key:"keys",get:function(){var e=ni(ii());return Object.keys(e).sort()}}]),t}(),si=function(){function n(){this.keys=[],this.currentSize=0,this.limitSize=0}var r,i=n.prototype;return i.key=function(e){return e<this.keys.length?this.keys[e]:null},i.prepare=(r=Qr(mt().mark(function e(){var n=this;return mt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){(0,t.qt)("getStorageInfo",{success:function(t){n.keys=t?t.keys.sort():[],n.currentSize=t?t.currentSize:0,n.limitSize=t?t.limitSize:0,e(!0)},fail:function(){r(!1)}})}));case 1:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)}),i.getItem=function(e){return new Promise(function(n,r){(0,t.qt)("getStorage",{key:e,success:function(e){var t=e.data;if("object"==typeof e.data)try{t=JSON.stringify(e.data)}catch(r){}n(t)},fail:function(e){r(e)}})})},i.setItem=function(e,n){return new Promise(function(r,i){(0,t.qt)("setStorage",{key:e,data:n,success:function(e){r(e)},fail:function(e){i(e)}})})},i.removeItem=function(e){return new Promise(function(n,r){(0,t.qt)("removeStorage",{key:e,success:function(e){n(e)},fail:function(e){r(e)}})})},i.clear=function(){return new Promise(function(e,n){(0,t.qt)("clearStorage",{success:function(t){e(t)},fail:function(e){n(e)}})})},(0,e.Z)(n,[{key:"length",get:function(){return this.keys.length}}]),n}(),ai={updateTime:(0,_n.fZ)(0),activedName:(0,_n.fZ)(null),defaultStorages:(0,_n.fZ)(["cookies","localStorage","sessionStorage"])},ci=function(n){function r(){var e;return(e=n.call(this)||this).storage=new Map,ai.activedName.subscribe(function(e){var t=(0,_n.U2)(ai.defaultStorages);t.length>0&&-1===t.indexOf(e)&&ai.activedName.set(t[0])}),ai.defaultStorages.subscribe(function(t){-1===t.indexOf((0,_n.U2)(ai.activedName))&&ai.activedName.set(t[0]),e.updateEnabledStorages()}),e}(0,o.Z)(r,n);var i,s=r.prototype;return s.getItem=(i=Qr(mt().mark(function e(t){return mt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.activedStorage){e.next=2;break}return e.abrupt("return","");case 2:return e.next=4,this.promisify(this.activedStorage.getItem(t));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)}),s.setItem=function(){var e=Qr(mt().mark(function e(t,n){var r;return mt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.activedStorage){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.promisify(this.activedStorage.setItem(t,n));case 4:return r=e.sent,this.refresh(),e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),s.removeItem=function(){var e=Qr(mt().mark(function e(t){var n;return mt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.activedStorage){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.promisify(this.activedStorage.removeItem(t));case 4:return n=e.sent,this.refresh(),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),s.clear=function(){var e=Qr(mt().mark(function e(){var t;return mt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.activedStorage){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.promisify(this.activedStorage.clear());case 4:return t=e.sent,this.refresh(),e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),s.refresh=function(){ai.updateTime.set(Date.now())},s.getEntries=function(){var e=Qr(mt().mark(function e(){var t,n,r,i,o;return mt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.activedStorage){e.next=3;break}return e.abrupt("return",[]);case 3:if("function"!=typeof t.prepare){e.next=6;break}return e.next=6,t.prepare();case 6:n=[],r=0;case 8:if(!(r<t.length)){e.next=17;break}return i=t.key(r),e.next=12,this.getItem(i);case 12:o=e.sent,n.push([i,o]);case 14:r++,e.next=8;break;case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),s.updateEnabledStorages=function(){var e=(0,_n.U2)(ai.defaultStorages);e.indexOf("cookies")>-1?void 0!==document.cookie&&this.storage.set("cookies",new oi):this.deleteStorage("cookies"),e.indexOf("localStorage")>-1?window.localStorage&&this.storage.set("localStorage",window.localStorage):this.deleteStorage("localStorage"),e.indexOf("sessionStorage")>-1?window.sessionStorage&&this.storage.set("sessionStorage",window.sessionStorage):this.deleteStorage("sessionStorage"),e.indexOf("wxStorage")>-1?(0,t.H_)()&&this.storage.set("wxStorage",new si):this.deleteStorage("wxStorage")},s.promisify=function(e){return"string"==typeof e||null==e?Promise.resolve(e):e},s.deleteStorage=function(e){this.storage.has(e)&&this.storage.delete(e)},(0,e.Z)(r,[{key:"activedStorage",get:function(){return this.storage.get((0,_n.U2)(ai.activedName))}}]),r}(In.N);function li(e,t,n){var r=e.slice();return r[20]=t[n][0],r[21]=t[n][1],r[23]=n,r}function di(e){var t;return{c:function(){(t=(0,s.bGB)("div")).textContent="Empty",(0,s.Ljt)(t,"class","vc-plugin-empty")},m:function(e,n){(0,s.$Tr)(e,t,n)},p:s.ZTd,d:function(e){e&&(0,s.ogt)(t)}}}function ui(e){var t,n,r,i,o,a=e[20]+"",c=e[5](e[21])+"";return{c:function(){t=(0,s.bGB)("div"),n=(0,s.fLW)(a),r=(0,s.DhX)(),i=(0,s.bGB)("div"),o=(0,s.fLW)(c),(0,s.Ljt)(t,"class","vc-table-col"),(0,s.Ljt)(i,"class","vc-table-col vc-table-col-2")},m:function(e,a){(0,s.$Tr)(e,t,a),(0,s.R3I)(t,n),(0,s.$Tr)(e,r,a),(0,s.$Tr)(e,i,a),(0,s.R3I)(i,o)},p:function(e,t){1&t&&a!==(a=e[20]+"")&&(0,s.rTO)(n,a),1&t&&c!==(c=e[5](e[21])+"")&&(0,s.rTO)(o,c)},d:function(e){e&&(0,s.ogt)(t),e&&(0,s.ogt)(r),e&&(0,s.ogt)(i)}}}function pi(e){var t,n,r,i,o,a,c;return{c:function(){t=(0,s.bGB)("div"),n=(0,s.bGB)("textarea"),r=(0,s.DhX)(),i=(0,s.bGB)("div"),o=(0,s.bGB)("textarea"),(0,s.Ljt)(n,"class","vc-table-input"),(0,s.Ljt)(t,"class","vc-table-col"),(0,s.Ljt)(o,"class","vc-table-input"),(0,s.Ljt)(i,"class","vc-table-col vc-table-col-2")},m:function(l,d){(0,s.$Tr)(l,t,d),(0,s.R3I)(t,n),(0,s.BmG)(n,e[2]),(0,s.$Tr)(l,r,d),(0,s.$Tr)(l,i,d),(0,s.R3I)(i,o),(0,s.BmG)(o,e[3]),a||(c=[(0,s.oLt)(n,"input",e[11]),(0,s.oLt)(o,"input",e[12])],a=!0)},p:function(e,t){4&t&&(0,s.BmG)(n,e[2]),8&t&&(0,s.BmG)(o,e[3])},d:function(e){e&&(0,s.ogt)(t),e&&(0,s.ogt)(r),e&&(0,s.ogt)(i),a=!1,(0,s.j7q)(c)}}}function hi(e){var t,n,r,i,o,a;return(t=new oe.Z({props:{name:"delete"}})).$on("click",function(){return e[14](e[20])}),r=new ce({props:{content:[e[20],e[21]].join("=")}}),(o=new oe.Z({props:{name:"edit"}})).$on("click",function(){return e[15](e[20],e[21],e[23])}),{c:function(){(0,s.YCL)(t.$$.fragment),n=(0,s.DhX)(),(0,s.YCL)(r.$$.fragment),i=(0,s.DhX)(),(0,s.YCL)(o.$$.fragment)},m:function(e,c){(0,s.yef)(t,e,c),(0,s.$Tr)(e,n,c),(0,s.yef)(r,e,c),(0,s.$Tr)(e,i,c),(0,s.yef)(o,e,c),a=!0},p:function(t,n){e=t;var i={};1&n&&(i.content=[e[20],e[21]].join("=")),r.$set(i)},i:function(e){a||((0,s.Ui)(t.$$.fragment,e),(0,s.Ui)(r.$$.fragment,e),(0,s.Ui)(o.$$.fragment,e),a=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),(0,s.etI)(r.$$.fragment,e),(0,s.etI)(o.$$.fragment,e),a=!1},d:function(e){(0,s.vpE)(t,e),e&&(0,s.ogt)(n),(0,s.vpE)(r,e),e&&(0,s.ogt)(i),(0,s.vpE)(o,e)}}}function gi(e){var t,n,r,i;return(t=new oe.Z({props:{name:"cancel"}})).$on("click",e[9]),(r=new oe.Z({props:{name:"done"}})).$on("click",function(){return e[13](e[20])}),{c:function(){(0,s.YCL)(t.$$.fragment),n=(0,s.DhX)(),(0,s.YCL)(r.$$.fragment)},m:function(e,o){(0,s.yef)(t,e,o),(0,s.$Tr)(e,n,o),(0,s.yef)(r,e,o),i=!0},p:function(t,n){e=t},i:function(e){i||((0,s.Ui)(t.$$.fragment,e),(0,s.Ui)(r.$$.fragment,e),i=!0)},o:function(e){(0,s.etI)(t.$$.fragment,e),(0,s.etI)(r.$$.fragment,e),i=!1},d:function(e){(0,s.vpE)(t,e),e&&(0,s.ogt)(n),(0,s.vpE)(r,e)}}}function mi(e){var t,n,r,i,o,a,c;function l(e,t){return e[1]===e[23]?pi:ui}var d=l(e),u=d(e),p=[gi,hi],h=[];function g(e,t){return e[1]===e[23]?0:1}return i=g(e),o=h[i]=p[i](e),{c:function(){t=(0,s.bGB)("div"),u.c(),n=(0,s.DhX)(),r=(0,s.bGB)("div"),o.c(),a=(0,s.DhX)(),(0,s.Ljt)(r,"class","vc-table-col vc-table-col-1 vc-table-action"),(0,s.Ljt)(t,"class","vc-table-row")},m:function(e,o){(0,s.$Tr)(e,t,o),u.m(t,null),(0,s.R3I)(t,n),(0,s.R3I)(t,r),h[i].m(r,null),(0,s.R3I)(t,a),c=!0},p:function(e,a){d===(d=l(e))&&u?u.p(e,a):(u.d(1),(u=d(e))&&(u.c(),u.m(t,n)));var c=i;(i=g(e))===c?h[i].p(e,a):((0,s.dvw)(),(0,s.etI)(h[c],1,1,function(){h[c]=null}),(0,s.gbL)(),(o=h[i])?o.p(e,a):(o=h[i]=p[i](e)).c(),(0,s.Ui)(o,1),o.m(r,null))},i:function(e){c||((0,s.Ui)(o),c=!0)},o:function(e){(0,s.etI)(o),c=!1},d:function(e){e&&(0,s.ogt)(t),u.d(),h[i].d()}}}function fi(e){for(var t,n,r,i,o=e[0],a=[],c=0;c<o.length;c+=1)a[c]=mi(li(e,o,c));var l=function(e){return(0,s.etI)(a[e],1,1,function(){a[e]=null})},d=null;return o.length||(d=di()),{c:function(){t=(0,s.bGB)("div"),(n=(0,s.bGB)("div")).innerHTML='<div class="vc-table-col">Key</div> \n    <div class="vc-table-col vc-table-col-2">Value</div> \n    <div class="vc-table-col vc-table-col-1 vc-table-action"></div>',r=(0,s.DhX)();for(var e=0;e<a.length;e+=1)a[e].c();d&&d.c(),(0,s.Ljt)(n,"class","vc-table-row"),(0,s.Ljt)(t,"class","vc-table")},m:function(e,o){(0,s.$Tr)(e,t,o),(0,s.R3I)(t,n),(0,s.R3I)(t,r);for(var c=0;c<a.length;c+=1)a[c].m(t,null);d&&d.m(t,null),i=!0},p:function(e,n){var r=n[0];if(1007&r){var i;for(o=e[0],i=0;i<o.length;i+=1){var c=li(e,o,i);a[i]?(a[i].p(c,r),(0,s.Ui)(a[i],1)):(a[i]=mi(c),a[i].c(),(0,s.Ui)(a[i],1),a[i].m(t,null))}for((0,s.dvw)(),i=o.length;i<a.length;i+=1)l(i);(0,s.gbL)(),!o.length&&d?d.p(e,r):o.length?d&&(d.d(1),d=null):((d=di()).c(),d.m(t,null))}},i:function(e){if(!i){for(var t=0;t<o.length;t+=1)(0,s.Ui)(a[t]);i=!0}},o:function(e){a=a.filter(Boolean);for(var t=0;t<a.length;t+=1)(0,s.etI)(a[t]);i=!1},d:function(e){e&&(0,s.ogt)(t),(0,s.RMB)(a,e),d&&d.d()}}}function vi(e,n,r){var i,o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},a=ci.getSingleton(ci,"VConsoleStorageModel"),c=ai.updateTime;(0,s.FIv)(e,c,function(e){return r(10,i=e)});var l=[],d=-1,u="",p="",h=function(){r(1,d=-1),r(2,u=""),r(3,p="")},g=function(e){return o(void 0,void 0,void 0,mt().mark(function t(){return mt().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.removeItem(e);case 2:case"end":return t.stop()}},t)}))},m=function(e){return o(void 0,void 0,void 0,mt().mark(function t(){return mt().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u===e){t.next=3;break}return t.next=3,a.removeItem(e);case 3:a.setItem(u,p),h();case 5:case"end":return t.stop()}},t)}))},f=function(e,t,n){return o(void 0,void 0,void 0,mt().mark(function i(){return mt().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:r(2,u=e),r(3,p=t),r(1,d=n);case 3:case"end":return i.stop()}},i)}))};return e.$$.update=function(){1024&e.$$.dirty&&i&&o(void 0,void 0,void 0,mt().mark(function e(){return mt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h(),e.t0=r,e.next=4,a.getEntries();case 4:e.t1=l=e.sent,(0,e.t0)(0,e.t1);case 6:case"end":return e.stop()}},e)}))},[l,d,u,p,c,function(e){return(0,t.id)(e,1024)},g,m,f,function(){h()},i,function(){u=this.value,r(2,u)},function(){p=this.value,r(3,p)},function(e){return m(e)},function(e){return g(e)},function(e,t,n){return f(e,t,n)}]}var yi=function(e){function t(t){var n;return n=e.call(this)||this,(0,s.S1n)((0,i.Z)(n),t,vi,fi,s.N8,{}),n}return(0,o.Z)(t,e),t}(s.f_C),_i=function(e){function n(t,n,r){var i;return void 0===r&&(r={}),(i=e.call(this,t,n,yi,r)||this).model=ci.getSingleton(ci,"VConsoleStorageModel"),i.onAddTopBarCallback=void 0,i}(0,o.Z)(n,e);var r=n.prototype;return r.onReady=function(){e.prototype.onReady.call(this),this.onUpdateOption()},r.onShow=function(){this.model.refresh()},r.onAddTopBar=function(e){this.onAddTopBarCallback=e,this.updateTopBar()},r.onAddTool=function(e){var t=this;e([{name:"Add",global:!1,onClick:function(){t.model.setItem("new_"+Date.now(),"new_value")}},{name:"Refresh",global:!1,onClick:function(){t.model.refresh()}},{name:"Clear",global:!1,onClick:function(){t.model.clear()}}])},r.onUpdateOption=function(){var e,n=null==(e=this.vConsole.option.storage)?void 0:e.defaultStorages;(0,t.kJ)(n)&&(n=n.length>0?n:["cookies"])!==(0,_n.U2)(ai.defaultStorages)&&(ai.defaultStorages.set(n),ai.activedName.set(n[0]),this.updateTopBar())},r.updateTopBar=function(){var e=this;if("function"==typeof this.onAddTopBarCallback){for(var t=(0,_n.U2)(ai.defaultStorages),n=[],r=0;r<t.length;r++){var i=t[r];n.push({name:i[0].toUpperCase()+i.substring(1),data:{name:i},actived:i===(0,_n.U2)(ai.activedName),onClick:function(t,n){var r=(0,_n.U2)(ai.activedName);if(n.name===r)return!1;ai.activedName.set(n.name),e.model.refresh()}})}this.onAddTopBarCallback(n)}},n}(ne),Ii=function(){function n(e){var i=this;if(this.version="3.15.1",this.isInited=!1,this.option={},this.compInstance=void 0,this.pluginList={},this.log=void 0,this.system=void 0,this.network=void 0,n.instance&&n.instance instanceof n)return console.debug("[vConsole] vConsole is already exists."),n.instance;if(n.instance=this,this.isInited=!1,this.option={defaultPlugins:["system","network","element","storage"],log:{},network:{},storage:{}},t.Kn(e))for(var o in e)this.option[o]=e[o];void 0!==this.option.maxLogNumber&&(this.option.log.maxLogNumber=this.option.maxLogNumber,console.debug("[vConsole] Deprecated option: `maxLogNumber`, use `log.maxLogNumber` instead.")),void 0!==this.option.onClearLog&&console.debug("[vConsole] Deprecated option: `onClearLog`."),void 0!==this.option.maxNetworkNumber&&(this.option.network.maxNetworkNumber=this.option.maxNetworkNumber,console.debug("[vConsole] Deprecated option: `maxNetworkNumber`, use `network.maxNetworkNumber` instead.")),this._addBuiltInPlugins();var s,a=function(){i.isInited||(i._initComponent(),i._autoRun())};void 0!==document?"loading"===document.readyState?r.bind(window,"DOMContentLoaded",a):a():s=setTimeout(function e(){document&&"complete"==document.readyState?(s&&clearTimeout(s),a()):s=setTimeout(e,1)},1)}var i=n.prototype;return i._addBuiltInPlugins=function(){this.addPlugin(new vn("default","Log"));var e=this.option.defaultPlugins,n={system:{proto:yn,name:"System"}};if(n.network={proto:vr,name:"Network"},n.element={proto:Jr,name:"Element"},n.storage={proto:_i,name:"Storage"},e&&t.kJ(e))for(var r=0;r<e.length;r++){var i=n[e[r]];i?this.addPlugin(new i.proto(e[r],i.name)):console.debug("[vConsole] Unrecognized default plugin ID:",e[r])}},i._initComponent=function(){var e=this;if(!r.one("#__vconsole")){var n,i=1*t.cF("switch_x"),o=1*t.cF("switch_y");"string"==typeof this.option.target?n=document.querySelector(this.option.target):this.option.target instanceof HTMLElement&&(n=this.option.target),n instanceof HTMLElement||(n=document.documentElement),this.compInstance=new ee({target:n,props:{switchButtonPosition:{x:i,y:o}}}),this.compInstance.$on("show",function(t){t.detail.show?e.show():e.hide()}),this.compInstance.$on("changePanel",function(t){var n=t.detail.pluginId;e.showPlugin(n)})}this._updateComponentByOptions()},i._updateComponentByOptions=function(){if(this.compInstance){if(this.compInstance.theme!==this.option.theme){var e=this.option.theme;e="light"!==e&&"dark"!==e?"":e,this.compInstance.theme=e}this.compInstance.disableScrolling!==this.option.disableLogScrolling&&(this.compInstance.disableScrolling=!!this.option.disableLogScrolling)}},i.setSwitchPosition=function(e,t){this.compInstance.switchButtonPosition={x:e,y:t}},i._autoRun=function(){for(var e in this.isInited=!0,this.pluginList)this._initPlugin(this.pluginList[e]);this._showFirstPluginWhenEmpty(),this.triggerEvent("ready")},i._showFirstPluginWhenEmpty=function(){var e=Object.keys(this.pluginList);""===this.compInstance.activedPluginId&&e.length>0&&this.showPlugin(e[0])},i.triggerEvent=function(e,n){var r=this;e="on"+e.charAt(0).toUpperCase()+e.slice(1),t.mf(this.option[e])&&setTimeout(function(){r.option[e].apply(r,n)},0)},i._initPlugin=function(e){var t=this;e.vConsole=this,this.compInstance.pluginList[e.id]={id:e.id,name:e.name,hasTabPanel:!1,tabOptions:void 0,topbarList:[],toolbarList:[],content:void 0,contentContainer:void 0},this.compInstance.pluginList=this._reorderPluginList(this.compInstance.pluginList),e.trigger("init"),e.trigger("renderTab",function(n,r){void 0===r&&(r={});var i=t.compInstance.pluginList[e.id];i.hasTabPanel=!0,i.tabOptions=r,n&&(t.compInstance.pluginList[e.id].content=n),t.compInstance.pluginList=t.compInstance.pluginList}),e.trigger("addTopBar",function(n){if(n){for(var r=[],i=0;i<n.length;i++){var o=n[i];r.push({name:o.name||"Undefined",className:o.className||"",actived:!!o.actived,data:o.data,onClick:o.onClick})}t.compInstance.pluginList[e.id].topbarList=r,t.compInstance.pluginList=t.compInstance.pluginList}}),e.trigger("addTool",function(n){if(n){for(var r=[],i=0;i<n.length;i++){var o=n[i];r.push({name:o.name||"Undefined",global:!!o.global,data:o.data,onClick:o.onClick})}t.compInstance.pluginList[e.id].toolbarList=r,t.compInstance.pluginList=t.compInstance.pluginList}}),e.isReady=!0,e.trigger("ready")},i._triggerPluginsEvent=function(e){for(var t in this.pluginList)this.pluginList[t].isReady&&this.pluginList[t].trigger(e)},i._triggerPluginEvent=function(e,t){var n=this.pluginList[e];n&&n.isReady&&n.trigger(t)},i._reorderPluginList=function(e){var n=this;if(!t.kJ(this.option.pluginOrder))return e;for(var r=Object.keys(e).sort(function(e,t){var r=n.option.pluginOrder.indexOf(e),i=n.option.pluginOrder.indexOf(t);return r===i?0:-1===r?1:-1===i?-1:r-i}),i={},o=0;o<r.length;o++)i[r[o]]=e[r[o]];return i},i.addPlugin=function(e){return void 0!==this.pluginList[e.id]?(console.debug("[vConsole] Plugin `"+e.id+"` has already been added."),!1):(this.pluginList[e.id]=e,this.isInited&&(this._initPlugin(e),this._showFirstPluginWhenEmpty()),!0)},i.removePlugin=function(e){e=(e+"").toLowerCase();var t=this.pluginList[e];if(void 0===t)return console.debug("[vConsole] Plugin `"+e+"` does not exist."),!1;t.trigger("remove");try{delete this.pluginList[e],delete this.compInstance.pluginList[e]}catch(n){this.pluginList[e]=void 0,this.compInstance.pluginList[e]=void 0}return this.compInstance.pluginList=this.compInstance.pluginList,this.compInstance.activedPluginId==e&&(this.compInstance.activedPluginId="",this._showFirstPluginWhenEmpty()),!0},i.show=function(){this.isInited&&(this.compInstance.show=!0,this._triggerPluginsEvent("showConsole"))},i.hide=function(){this.isInited&&(this.compInstance.show=!1,this._triggerPluginsEvent("hideConsole"))},i.showSwitch=function(){this.isInited&&(this.compInstance.showSwitchButton=!0)},i.hideSwitch=function(){this.isInited&&(this.compInstance.showSwitchButton=!1)},i.showPlugin=function(e){this.isInited&&(this.pluginList[e]||console.debug("[vConsole] Plugin `"+e+"` does not exist."),this.compInstance.activedPluginId&&this._triggerPluginEvent(this.compInstance.activedPluginId,"hide"),this.compInstance.activedPluginId=e,this._triggerPluginEvent(this.compInstance.activedPluginId,"show"))},i.setOption=function(e,n){if("string"==typeof e){for(var r=e.split("."),i=this.option,o=0;o<r.length;o++){if("__proto__"===r[o]||"constructor"===r[o]||"prototype"===r[o])return void console.debug("[vConsole] Cannot set `"+r[o]+"` in `vConsole.setOption()`.");void 0===i[r[o]]&&(i[r[o]]={}),o===r.length-1&&(i[r[o]]=n),i=i[r[o]]}this._triggerPluginsEvent("updateOption"),this._updateComponentByOptions()}else if(t.Kn(e)){for(var s in e)"__proto__"!==s&&"constructor"!==s&&"prototype"!==s?this.option[s]=e[s]:console.debug("[vConsole] Cannot set `"+s+"` in `vConsole.setOption()`.");this._triggerPluginsEvent("updateOption"),this._updateComponentByOptions()}else console.debug("[vConsole] The first parameter of `vConsole.setOption()` must be a string or an object.")},i.destroy=function(){if(this.isInited){this.isInited=!1,n.instance=void 0;for(var e=Object.keys(this.pluginList),t=e.length-1;t>=0;t--)this.removePlugin(e[t]);this.compInstance.$destroy()}},(0,e.Z)(n,null,[{key:"instance",get:function(){return window.__VCONSOLE_INSTANCE},set:function(e){void 0===e||e instanceof n?window.__VCONSOLE_INSTANCE=e:console.debug("[vConsole] Cannot set `VConsole.instance` because the value is not the instance of VConsole.")}}]),n}();Ii.VConsolePlugin=void 0,Ii.VConsoleLogPlugin=void 0,Ii.VConsoleDefaultPlugin=void 0,Ii.VConsoleSystemPlugin=void 0,Ii.VConsoleNetworkPlugin=void 0,Ii.VConsoleElementPlugin=void 0,Ii.VConsoleStoragePlugin=void 0,Ii.VConsolePlugin=te,Ii.VConsoleLogPlugin=fn,Ii.VConsoleDefaultPlugin=vn,Ii.VConsoleSystemPlugin=yn,Ii.VConsoleNetworkPlugin=vr,Ii.VConsoleElementPlugin=Jr,Ii.VConsoleStoragePlugin=_i;var Ti=Ii}(),__webpack_exports__=__webpack_exports__.default,__webpack_exports__}()},module.exports=n()})(vconsole_min);var vconsole_minExports=vconsole_min.exports;const vConsole=getDefaultExportFromCjs(vconsole_minExports);function createApp(){return{app:createApp$1(_sfc_main)}}new vConsole({}),createApp().app.use(index$e).mount("#app");export{msgRecallTime as $,httpRequest as A,ScrollView as B,createTextVNode as C,reactive as D,Ee as E,Fragment as F,normalizeStyle as G,index$g as H,PickerView as I,index$n as J,getCurrentInstance as K,index$m as L,index$y as M,onBeforeMount as N,apiUrl as O,PickerViewColumn as P,renderSlot as Q,initNim as R,SwiperItem as S,index$x as T,STORAGE_KEY as U,withDirectives as V,vShow as W,Input as X,index$r as Y,withModifiers as Z,events as _,createElementBlock as a,index$i as a0,isHarmonyOs as a1,REPLY_MSG_TYPE_MAP as a2,stopAllAudio as a3,ALLOW_AT as a4,convertSecondsToTime as a5,g2StatusMap as a6,MSG_ID_FLAG as a7,AT_ALL_ACCOUNT$1 as a8,getUniPlatform as a9,createCallMessage as aA,debounce as aB,index$j as aC,onWindowResize as aD,isDiscussionFunc as aE,index$v as aF,isInSSRComponentSetup as aG,injectHook as aH,ON_SHOW as aI,ON_HIDE as aJ,ON_LOAD as aK,ON_READY as aL,ON_UNLOAD as aM,EventEmitter as aN,getFileType as aO,parseFileSize as aP,index$u as aQ,index$t as aR,index$7 as aS,logout as aT,updateImInfo as aU,isAndroidApp as aa,resolveComponent as ab,startCall as ac,isIosWeb as ad,replaceEmoji as ae,index$h as af,isAndroidOrIosApp as ag,isWeb as ah,customSwitchTab as ai,resolveDynamicComponent as aj,getCurrentPages$1 as ak,HISTORY_LIMIT$1 as al,index$d as am,commonjsGlobal$1 as an,getDefaultExportFromCjs as ao,getParamsValues as ap,index$c as aq,playMusic as ar,removeListeners as as,destoryAudio as at,randomNumbers as au,stopMusic as av,addCallListeners as aw,CallEventType as ax,formatterTime as ay,createTeamRoom as az,t as b,computed$2 as c,defineComponent as d,createVNode as e,createCommentVNode as f,ref as g,autorun as h,isWxApp as i,onUnmounted as j,createBaseVNode as k,createBlock as l,setContactTabUnread as m,normalizeClass as n,openBlock as o,customNavigateTo as p,onMounted as q,renderList as r,setTabUnread as s,toDisplayString as t,unref as u,withCtx as v,watch as w,customRedirectTo as x,index$q as y,Swiper as z};
