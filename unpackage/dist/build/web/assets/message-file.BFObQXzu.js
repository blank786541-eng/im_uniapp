import{e}from"./emoji.SrFHKbUG.js";import{o as t,a as i,Q as n,C as a,t as o,n as s,G as l,l as r,v as u,a0 as c,d,g as p,c as f,w as m,j as v,k as g,_ as y,a1 as h,aO as w,u as x,e as S,b as k,i as _,aP as A}from"./index-CA_4_S1o.js";import{I as C}from"./Icon.DO2Wg01x.js";import{a as b,c as z}from"./uni-app.es.f5Xd5cz1.js";import{_ as E}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U=E({name:"uniLink",props:{href:{type:String,default:""},text:{type:String,default:""},download:{type:String,default:""},showUnderLine:{type:[Boolean,String],default:!0},copyTips:{type:String,default:"已自动复制网址，请在手机浏览器里粘贴该网址"},color:{type:String,default:"#999999"},fontSize:{type:[Number,String],default:14}},computed:{isShowA(){return this._isH5=!0,!(!this.isMail()&&!this.isTel()||!0!==this._isH5)}},created(){this._isH5=null},methods:{isMail(){return this.href.startsWith("mailto:")},isTel(){return this.href.startsWith("tel:")},openURL(){window.open(this.href)},makePhoneCall(e){uni.makePhoneCall({phoneNumber:e})}}},[["render",function(e,d,p,f,m,v){const g=c;return v.isShowA?(t(),i("a",{key:0,class:s(["uni-link",{"uni-link--withline":!0===p.showUnderLine||"true"===p.showUnderLine}]),href:p.href,style:l({color:p.color,fontSize:p.fontSize+"px"}),download:p.download},[n(e.$slots,"default",{},()=>[a(o(p.text),1)],!0)],14,["href","download"])):(t(),r(g,{key:1,class:s(["uni-link",{"uni-link--withline":!0===p.showUnderLine||"true"===p.showUnderLine}]),style:l({color:p.color,fontSize:p.fontSize+"px"}),onClick:v.openURL},{default:u(()=>[n(e.$slots,"default",{},()=>[a(o(p.text),1)],!0)]),_:3},8,["class","style","onClick"]))}],["__scopeId","data-v-d599cace"]]);var T=function(e){return"string"==typeof e};function j(e,t,i){var n=0,a=0;if(""===e)return e;if(!e||!T(e))throw new TypeError("First argument to react-string-replace#replaceString must be a string");var o,s,l,r=t;(function(e){return e instanceof RegExp})(r)||(r=new RegExp("("+(o=r,s=/[\\^$.*+?()[\]{}|]/g,l=RegExp(s.source),(o&&l.test(o)?o.replace(s,"\\$&"):o)+")"),"gi"));for(var u=e.split(r),c=1,d=u.length;c<d;c+=2)void 0!==u[c]&&void 0!==u[c-1]?(a=u[c].length,n+=u[c-1].length,u[c]=i(u[c],c,n),n+=a):console.warn("reactStringReplace: Encountered undefined value during string replacement. Your RegExp may not be working the way you expect.");return u}function L(e,t,i){return Array.isArray(e)||(e=[e]),n=e.map(function(e){return T(e)?j(e,t,i):e}),a=[],n.forEach(function(e){Array.isArray(e)?a=a.concat(e):a.push(e)}),a;var n,a}function R(t,i){var n;if(!t)return[];const a=i?JSON.parse(i).yxAitMsg:null,o=L(t,e,e=>({type:"emoji",value:e}));let s=L(o,/(https?:\/\/\S+)/gi,e=>({type:"link",value:e}));a&&(null==(n=Object.keys(a))||n.forEach(e=>{const t=a[e];s=L(s,t.text,e=>({type:"Ait",value:e}))}));return s.map((e,t)=>"string"==typeof e?{type:"text",value:e,key:t+"text"}:{...e,key:t+e.type})}const I=E(d({__name:"message-audio",props:{msg:{},mode:{},broadcastNewAudioSrc:{}},emits:["getGlobalAudioContext"],setup(e,{emit:n}){const a=e,u=p("icon-yuyin3"),c=p(!1),d=p(!1),w=new Map,x=e=>{let t=e;return e<1e3&&(t=1e3*e),Math.round(t/1e3)||""},S=f(()=>{var e;const t=x(null==(e=a.msg.attachment)?void 0:e.duration);return 50+8*(t-1)>180?180:50+8*(t-1)}),k=f(()=>{var e;return x(null==(e=a.msg.attachment)?void 0:e.duration)}),_=()=>{var e,t;uni.$emit(y.AUDIO_URL_CHANGE,null==(t=null==(e=a.msg)?void 0:e.attachment)?void 0:t.url);if(!R()){const e=uni.createInnerAudioContext();w.set("audio",e),function(){var e,t;const i=R();if(!i)return;i.src=null==(t=null==(e=a.msg)?void 0:e.attachment)?void 0:t.url,d.value=!1,i.onPlay(U),i.onStop(T),i.onEnded(j),i.onError(L)}()}A()};m(()=>a.broadcastNewAudioSrc,e=>{var t,i;e!==(null==(i=null==(t=a.msg)?void 0:t.attachment)?void 0:i.url)&&d.value&&(E(),d.value=!1)});const A=()=>{d.value?E():function(){const e=R();if(console.log("audio played",e),!e)return;try{e.play()}catch(t){console.log("audio played error",t)}}()},E=()=>{const e=R();if(e)try{e.stop(),d.value=!1}catch{console.log("stop audio error")}};function U(){d.value=!0,I()}function T(){var e;if(c.value=!1,d.value=!1,h){const t=R();null==(e=null==t?void 0:t.destroy)||e.call(t),w.delete("audio")}}function j(){c.value=!1,d.value=!1}function L(e){c.value=!1,console.warn("audio played error",e)}const R=()=>w.get("audio"),I=()=>{try{c.value=!0;let e=["icon-yuyin1","icon-yuyin2","icon-yuyin3"];const t=()=>{const i=e.shift();i&&(u.value=i,!e.length&&c.value&&(e=["icon-yuyin1","icon-yuyin2","icon-yuyin3"]),e.length&&setTimeout(t,300))};t()}catch(e){console.log("playAudioAnimation error",e)}},M=()=>{var e;const t=R();d.value&&E(),null==(e=null==t?void 0:t.destroy)||e.call(t),c.value=!1,w.delete("audio")};return v(()=>{M()}),b(()=>{M()}),z(()=>{M()}),(e,n)=>(t(),i("div",{class:s(e.msg.isSelf&&"audio-in"!==e.mode?"audio-out":"audio-in"),style:l({width:S.value+"px"}),onClick:_},[g("div",{class:"audio-dur"},o(k.value?k.value+"s":""),1),g("div",{class:"audio-icon-wrapper"},[(t(),r(C,{size:24,key:u.value,type:u.value},null,8,["type"]))])],6))}}),[["__scopeId","data-v-576dab29"]]),M=E(d({__name:"message-file",props:{msg:{}},setup(e){const n=e,{name:a="",url:l="",ext:c="",size:d=0}=n.msg.attachment||{},p={pdf:"icon-PPT",word:"icon-Word",excel:"icon-Excel",ppt:"icon-PPT",zip:"icon-RAR1",txt:"icon-qita",img:"icon-tupian2",audio:"icon-yinle",video:"icon-shipin"}[w(c)]||"icon-weizhiwenjian",f=a.lastIndexOf(".")>-1?a.lastIndexOf("."):a.length,m=a.slice(0,Math.max(f-5,0)),v=a.slice(Math.max(f-5,0)),y=l+(l.includes("?")?"&":"?")+`download=${a}`,h=()=>{uni.setClipboardData({data:y}),uni.showModal({content:k("wxAppFileCopyText"),showCancel:!1})};return(e,n)=>x(_)?(t(),i("div",{key:1,onClick:h},[g("div",{class:s(e.msg.isSelf?"msg-file msg-file-out":"msg-file msg-file-in")},[S(C,{type:x(p),size:32},null,8,["type"]),g("div",{class:"msg-file-content"},[g("div",{class:"msg-file-title"},[g("div",{class:"msg-file-title-prefix"},o(x(m)),1),g("div",{class:"msg-file-title-suffix"},o(x(v)),1)]),g("div",{class:"msg-file-size"},o(x(A)(x(d))),1)])],2)])):(t(),r(U,{key:0,class:"msg-file-wrapper",href:y,download:x(a),showUnderLine:!1},{default:u(()=>[g("div",{class:s(e.msg.isSelf?"msg-file msg-file-out":"msg-file msg-file-in"),onClick:n[0]||(n[0]=()=>{return e=y,void uni.setClipboardData({data:e,showToast:!1,success:()=>{uni.showToast({title:k("openUrlText"),icon:"none"})}});var e})},[S(C,{type:x(p),size:32},null,8,["type"]),g("div",{class:"msg-file-content"},[g("div",{class:"msg-file-title"},[g("div",{class:"msg-file-title-prefix"},o(x(m)),1),g("div",{class:"msg-file-title-suffix"},o(x(v)),1)]),g("div",{class:"msg-file-size"},o(x(A)(x(d))),1)])],2)]),_:1},8,["download"]))}}),[["__scopeId","data-v-57cb0da9"]]);export{I as M,U,M as a,R as p};
