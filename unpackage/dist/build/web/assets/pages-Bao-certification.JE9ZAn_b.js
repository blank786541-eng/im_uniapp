import{d as e,g as a,q as l,A as t,o,a as i,e as n,k as s,v as u,F as r,r as d,t as c,f as p,G as v,l as m,O as g}from"./index-CA_4_S1o.js";import{D as h}from"./defaultHeader.BLoWIqPs.js";import{A as f}from"./AssetsImage.D01ldk7e.js";import{F as x}from"./form-input.CNku4d-1.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b=""+new URL("black4-DA4NpAok.png",import.meta.url).href,k=y(e({__name:"certification",setup(e){const y=a([{holder:"/static/black1.png",value:"",loading:!1},{holder:"/static/black2.png",value:"",loading:!1},{holder:"/static/black3.png",value:"",loading:!1}]);a(!1);const k=uni.$UIKitStore.userStore.myUserInfo.accountId,I=a(2),w=a(null),A=a(""),_=a(""),T={reg:/^[a-zA-Z0-9]{18}$/,message:"请输入18位数字加字母组合",trigger:"blur"};function U(){if(2!=I.value)return;if(!A.value)return void uni.showToast({title:"请输入姓名",icon:"none"});if(!_.value||!T.reg.test(_.value))return void uni.showToast({title:"请输入身份证",icon:"none"});let e="";for(let l=0;l<y.value.length;l++)if(!y.value[l].value){0==l?e="请上传身份证正面":1==l?e="请上传身份证背面":1==l&&(e="请上传手持身份证"),uni.showToast({title:e,icon:"none"});break}if(e)return;let a={account:k-0,headPortraitImg:y.value[0].value,nationalEmblemImg:y.value[1].value,handImg:y.value[2].value,name:A.value,idCard:_.value};t({url:"kyc/kycApply",method:"post",data:a}).then(e=>{uni.showToast({title:e,icon:"none",duration:1e3,success:()=>{uni.navigateBack()}})})}const C=["认证中","已认证","立即上传"];function F(e){_.value=e}function S(e){A.value=e}return l(()=>{t({url:`im/api/getUserKyc?account=${k}`,method:"get"}).then(e=>{y.value[0].value=e.headPortraitImg,y.value[1].value=e.nationalEmblemImg,y.value[2].value=e.handImg,I.value=e.state,w.value=e.message,console.log(e)}),t({url:"kyc/getByAccount",method:"GET",data:{account:uni.$UIKitStore.userStore.myUserInfo.accountId}}).then(e=>{A.value=e.name,_.value=e.idCard})}),(e,a)=>(o(),i("div",{class:"flex-box flex-direction-column",style:{height:"100%","padding-bottom":"140px"}},[n(h,{title:"实名认证"}),s("div",{class:"container-box",style:{padding:"0 16px"}},[s("div",null,[n(x,{value:A.value,onUpdateModelValue:S,placeholder:"请输入姓名"},{addonBefore:u(()=>[s("div",{style:{"margin-right":"24px"}},"姓名")]),_:1},8,["value"]),n(x,{value:_.value,onUpdateModelValue:F,placeholder:"请输入身份证号码",maxLength:18,rule:T},{addonBefore:u(()=>[s("div",{style:{"margin-right":"24px"}},"身份证")]),_:1},8,["value"])]),(o(!0),i(r,null,d(y.value,(e,a)=>(o(),i("div",{style:{"margin-top":"12px"},onClick:e=>function(e){2==I.value&&(y.value[e].loading=!0,uni.chooseImage({count:1,sizeType:["compressed"],success:a=>{const l=new FormData;l.append("file",a.tempFiles[0]),l.append("accountId",k),uni.uploadFile({url:`${g}im/group/upload`,formData:{accountId:k},file:a.tempFiles[0],fileType:"image",name:"file",headers:{"Content-Type":"multipart/form-data"},success:a=>{console.log(JSON.parse(a.data)),y.value[e].value=JSON.parse(a.data).data},fail:a=>{y.value[e].loading=!1},complete:a=>{y.value[e].loading=!1}})}}))}(a)},[e.value?(o(),i("div",{key:0,style:{width:"368px",height:"165px",border:"1px solid #efefef","border-radius":"12px",position:"relative","z-index":"10"}},[s("img",{src:e.value,style:{width:"100%",height:"100%","border-radius":"12px"}},null,8,["src"])])):(o(),i("div",{key:1,class:"flex-center",style:{width:"368px",height:"165px",border:"1px solid #efefef","border-radius":"8px",position:"relative","z-index":"10"}},[e.loading?(o(),m(f,{key:0,path:"/static/loading.png",width:"24px",height:"24px",class:"addAnimation"})):p("",!0),s("img",{src:e.holder,style:{width:"100%"}},null,8,["src"])]))],8,["onClick"]))),256)),s("img",{src:b,style:{width:"100%",margin:"24px 0"}})]),s("div",{class:"footer"},[w.value?(o(),i("div",{key:0,class:"error"},[s("span",null,"审核消息："+c(w.value),1)])):p("",!0),s("div",{class:"watch-btn2",onClick:U,style:v({opacity:2==I.value?1:.8})},c(C[I.value]),5)])]))}}),[["__scopeId","data-v-bfe1b0b0"]]);export{k as default};
