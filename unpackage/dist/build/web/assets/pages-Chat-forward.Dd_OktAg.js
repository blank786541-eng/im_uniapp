import{_ as e}from"./page-meta.phPE4ZZK.js";import{d as a,o,a as t,k as n,t as i,Q as r,f as l,g as s,c,l as u,v as d,u as v,e as m,X as f,E as p,b as T,h as I,j as g,aj as w,F as _,r as C}from"./index-CA_4_S1o.js";import{b as y,r as S}from"./uni-app.es.f5Xd5cz1.js";import{N}from"./NavBar.B_pGq4kd.js";import{A as M}from"./Avatar.cDMQ39ID.js";import{f as k}from"./friend.CuoyITGk.js";import{E as x}from"./Empty.DhhBt1kg.js";import{I as V}from"./Icon.DO2Wg01x.js";import{_ as E}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b=E(a({__name:"Modal",props:{title:{},confirmText:{},cancelText:{},visible:{type:Boolean}},emits:["confirm","cancel"],setup(e,{emit:a}){const s=a,c=()=>{s("cancel")},u=()=>{s("confirm")},d=()=>{s("cancel")};return(e,a)=>e.visible?(o(),t("div",{key:0,class:"modal"},[n("div",{class:"mask",onClick:c}),n("div",{class:"content"},[n("div",{class:"title"},i(e.title),1),r(e.$slots,"default",{},void 0,!0),n("div",{class:"buttons"},[n("div",{class:"button cancel",onClick:d},i(e.cancelText),1),n("div",{class:"button confirm",onClick:u},i(e.confirmText),1)])])])):l("",!0)}}),[["__scopeId","data-v-1a288569"]]),A=E(a({__name:"message-forward-modal",props:{forwardModalVisible:{type:Boolean},forwardTo:{},forwardMsg:{},forwardConversationType:{},forwardToTeamInfo:{}},emits:["confirm","cancel"],setup(e,{emit:a}){const r=e,l=a,I=s(""),g=e=>{I.value=e.detail.value},w=()=>{l("cancel")},_=()=>{l("confirm",I.value)},C=c(()=>uni.$UIKitStore.uiStore.getAppellation({account:r.forwardTo})),y=c(()=>{var e;return uni.$UIKitStore.uiStore.getAppellation({account:null==(e=r.forwardMsg)?void 0:e.senderId})});return(e,a)=>{const l=f;return o(),u(b,{title:v(T)("sendToText"),visible:e.forwardModalVisible,confirmText:v(T)("sendText"),cancelText:v(T)("cancelText"),onCancel:w,onConfirm:_},{default:d(()=>[r.forwardConversationType===v(p).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?(o(),t("div",{key:0,class:"avatar-wrapper"},[m(M,{account:r.forwardToTeamInfo&&r.forwardToTeamInfo.teamId||"",avatar:r.forwardToTeamInfo&&r.forwardToTeamInfo.avatar,size:"36"},null,8,["account","avatar"]),n("div",{class:"name"},i(r.forwardToTeamInfo&&r.forwardToTeamInfo.name||""),1)])):(o(),t("div",{key:1,class:"avatar-wrapper"},[m(M,{account:e.forwardTo,size:"36"},null,8,["account"]),n("div",{class:"name"},[n("span",null,i(C.value),1)])])),n("div",{class:"description"},i("["+v(T)("forwardText")+"]")+" "+i(y.value)+" "+i(v(T)("sessionRecordText")),1),m(l,{class:"forward-input",onInput:g,placeholder:v(T)("forwardComment")},null,8,["placeholder"])]),_:1},8,["title","visible","confirmText","cancelText"])}}}),[["__scopeId","data-v-c1a46905"]]),h=E(a({__name:"forward",setup(a){var r;const l=s([]),f=s(p.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P),E=s([]),b=null==(r=uni.$UIKitStore)?void 0:r.uiStore.selectedConversation;let h="",K="";const U=s(!1),$=s(""),j=s(),O=s(),P=c(()=>U.value),R=e=>{if(U.value=!1,!j.value)return uni.showToast({title:T("getForwardMessageFailed"),icon:"error"}),void setTimeout(()=>{B()},1e3);const a=uni.$UIKitNIM.V2NIMConversationIdUtil[f.value===p.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P?"p2pConversationId":"teamConversationId"]($.value);uni.$UIKitStore.msgStore.forwardMsgActive(j.value,a,e).then(()=>{uni.showToast({title:T("forwardSuccessText"),icon:"none",duration:1e3}),setTimeout(()=>{B()},1e3)}).catch(()=>{uni.showToast({title:T("forwardFailedText"),icon:"error",duration:1e3})})},Y=()=>{U.value=!1};y(e=>{f.value=Number(null==e?void 0:e.forwardConversationType),h=null==e?void 0:e.msgIdClient,K=null==e?void 0:e.origin});const z=I(()=>{E.value=uni.$UIKitStore.uiStore.teamList}),F=I(()=>{const e=uni.$UIKitStore.uiStore.friends.filter(e=>!uni.$UIKitStore.relationStore.blacklist.includes(e.accountId)).map(e=>({account:e.accountId,appellation:uni.$UIKitStore.uiStore.getAppellation({account:e.accountId,teamId:$.value})}));l.value=k(e,{firstKey:"appellation"},!1)}),B=()=>{uni.navigateBack({delta:1})},L=e=>{var a;if(e&&h){if($.value=e,j.value=null==(a=uni.$UIKitStore.msgStore.getMsg(b,[h]))?void 0:a[0],"pin"===K){const e=[...uni.$UIKitStore.msgStore.pinMsgs.get(b).values()].find(e=>!!e.message&&e.message.messageClientId===h);e&&(j.value=e.message)}else if("collection"===K){const e=uni.$UIKitStore.msgStore.collectionMsgs.get(h);e&&(j.value=e)}U.value=!0,f.value===p.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&(O.value=uni.$UIKitStore.teamStore.teams.get(e))}};return g(()=>{z(),F()}),(a,r)=>{const s=S(w("page-meta"),e);return o(),t(_,null,[m(s,{"page-style":"overflow:"+(P.value?"hidden":"visible")},null,8,["page-style"]),n("div",null,[m(N,{title:f.value===v(p).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?v(T)("teamChooseText"):v(T)("chooseText"),showLeft:!0},{left:d(()=>[n("div",{onClick:B},[m(V,{type:"icon-zuojiantou",size:22})])]),_:1},8,["title"]),f.value===v(p).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?(o(),t("div",{key:0},[n("div",{class:"group-list-content"},[0===E.value.length?(o(),u(x,{key:0,text:v(T)("TeamEmptyText")},null,8,["text"])):(o(),t("div",{key:1},[(o(!0),t(_,null,C(E.value,e=>(o(),t("div",{class:"group-item",key:e.teamId,onClick:()=>L(e.teamId)},[m(M,{account:e.teamId,avatar:e.avatar},null,8,["account","avatar"]),n("span",{class:"group-name"},i(e.name),1)],8,["onClick"]))),128))]))])])):(o(),t("div",{key:1},[l.value.length>0?(o(),t("div",{key:0,class:"friend-list-container"},[n("div",{class:"friend-group-list"},[(o(!0),t(_,null,C(l.value,e=>(o(),t("div",{class:"friend-group-item",key:e.key},[n("div",{class:"friend-group-title"},i(e.key),1),(o(!0),t(_,null,C(e.data,e=>(o(),t("div",{class:"friend-item",key:e.account,onClick:()=>L(e.account)},[m(M,{account:e.account,size:"36"},null,8,["account"]),n("div",{class:"friend-name"},i(e.appellation),1)],8,["onClick"]))),128))]))),128))])])):(o(),u(x,{key:1,text:v(T)("noFriendText")},null,8,["text"]))])),m(A,{"forward-modal-visible":U.value,"forward-to":$.value,"forward-msg":j.value,"forward-conversation-type":f.value,"forward-to-team-info":O.value,onConfirm:R,onCancel:Y},null,8,["forward-modal-visible","forward-to","forward-msg","forward-conversation-type","forward-to-team-info"])])],64)}}}),[["__scopeId","data-v-a5d8937f"]]);export{h as default};
