import{o as e,l as t,v as s,e as o,Z as a,Q as i,V as n,W as l,G as r,C as c,t as u,H as d,d as m,g,q as p,E as v,h as I,j as M,a as T,u as _,b as y,f as S,k as E,p as h,_ as N,$ as f,a0 as C,c as A,F as V,r as b,a1 as O,a2 as x,a3 as R,a4 as k,a5 as $,a6 as w,n as U,a7 as P,y as L,N as K,B as Y,D as G,a8 as D,i as B,a9 as F,aa as z,ab as j,ac as H,ad as W,ae as J,af as X,ag as q,ah as Q,K as Z,ai as ee,aj as te,ak as se,al as oe}from"./index-CA_4_S1o.js";import{_ as ae}from"./page-meta.phPE4ZZK.js";import{o as ie,b as ne,a as le,c as re,r as ce}from"./uni-app.es.f5Xd5cz1.js";import{t as ue}from"./reporter.BDLo06V-.js";import{A as de}from"./Avatar.cDMQ39ID.js";import{_ as me}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{I as ge,h as pe}from"./Icon.DO2Wg01x.js";import{E as ve,e as Ie,a as Me}from"./emoji.SrFHKbUG.js";import{M as Te}from"./message-text.6ab8ngmM.js";import{U as _e,M as ye,a as Se}from"./message-file.BFObQXzu.js";import{_ as Ee}from"./Appellation.vue_vue_type_script_setup_true_lang.Bn2FxhVA.js";import{c as he}from"./date.BkwCqfeE.js";import{U as Ne}from"./uni-popup.BNglwmFT.js";import{A as fe}from"./AssetsImage.D01ldk7e.js";import{h as Ce}from"./permission.DD8MzfWC.js";const Ae=me({name:"Tooltip",props:{visible:Boolean,align:Boolean,color:{type:String,default:"#303133"},content:{type:String,default:""},show:{type:Boolean,default:!1}},data(){return{isShow:this.visible,title:"Hello",arrowLeft:0,query:null,style:{},arrowStyle:{},placement:"top"}},onLoad(){},watch:{isShow:{handler(e){this.$emit("update:visible",e)},immediate:!0},visible:{handler(e){e&&this.$nextTick(()=>{this.getPosition()}),this.isShow=e},immediate:!0}},mounted(){window.addEventListener("click",()=>{this.isShow=!1}),this.getPosition()},methods:{close(){this.isShow=!1},fixedWrap(){this.isShow=!1},async handleClick(){if(this.isShow)return this.isShow=!1;await this.getPosition(),this.isShow=!0},getPosition(){return new Promise(e=>{uni.createSelectorQuery().in(this).selectAll(".zb_tooltip_content,.zb_tooltip__popper").boundingClientRect(async t=>{let{left:s,bottom:o,right:a,top:i,width:n,height:l}=t[0]||{};t[1];let r={};switch(this.placement=i<=300?"bottom":"top",this.placement){case"top":this.align?(r.left="-100px",n<90&&(r.left="-200px")):r.left="50px",r.bottom=`${l+8}px`;break;case"bottom":this.align?(r.left="-100px",n<100&&(r.left="-200px")):r.left="50px",r.top=`${l+8}px`}this.style=r,this.arrowStyle={},e()}).exec()})}}},[["render",function(m,g,p,v,I,M){const T=d;return e(),t(T,{class:"zb-tooltip",style:r({"--theme-bg-color":p.color})},{default:s(()=>[o(T,{class:"zb_tooltip_content",onLongpress:a(M.handleClick,["stop"])},{default:s(()=>[i(m.$slots,"default",{},void 0,!0),n(o(T,{class:"zb_tooltip__mask",onLongpress:g[0]||(g[0]=a(()=>{},["stop"])),onTouchstart:M.close},null,8,["onTouchstart"]),[[l,I.isShow]]),o(T,{class:"zb_tooltip__popper",onClick:a(()=>{},["stop"]),style:r([I.style,{visibility:I.isShow?"visible":"hidden",color:"white"===p.color?"":"#fff",boxShadow:"white"===p.color?"0 3px 6px -4px #0000001f, 0 6px 16px #00000014, 0 9px 28px 8px #0000000d":""}])},{default:s(()=>[i(m.$slots,"content",{},()=>[c(u(p.content),1)],!0)]),_:3},8,["style"])]),_:3},8,["onLongpress"])]),_:3},8,["style"])}],["__scopeId","data-v-a4c76a8c"]]),Ve=me(m({__name:"message-bubble",props:{msg:{},tooltipVisible:{type:Boolean},bgVisible:{type:Boolean},placement:{},manager:{type:Boolean}},setup(a){var n,l;const d=g(null),m=a,A=uni.$UIKitNIM.V2NIMConversationIdUtil.parseConversationType(m.msg.conversationId);p(()=>{console.log(m.msg),b.value=!(m.msg.messageType==v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT||m.msg.messageType==v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE||m.msg.messageType==v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE||m.msg.messageType==v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO||m.msg.messageType==v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO||m.msg.messageType==v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL)});const V=g(!0),b=g(!1),O=()=>{d.value.close()},x=()=>{uni.setClipboardData({data:m.msg.text||"",showToast:!1,success:()=>{uni.showToast({title:y("copySuccessText"),icon:"none"})},fail:()=>{uni.showToast({title:y("copyFailText"),icon:"none"})},complete(){O()}})},R=()=>{setTimeout(()=>{uni.$emit(N.ON_SCROLL_BOTTOM)},100)},k=async()=>{const e=m.msg;uni.$UIKitStore.msgStore.removeMsg(e.conversationId,[e.messageClientId]);try{if(e.threadReply){const t=await uni.$UIKitNIM.V2NIMMessageService.getMessageListByRefers([e.threadReply]);t.length>0&&uni.$UIKitStore.msgStore.replyMsgActive(t[0])}uni.$UIKitStore.msgStore.sendMessageActive({msg:e,conversationId:e.conversationId,progress:()=>!0,sendBefore:()=>{R()}}),R()}catch(t){console.log(t)}},$=()=>{uni.showActionSheet({itemList:[y("forwardToTeamText"),y("forwardToFriendText")],success(e){0===e.tapIndex?h({url:`/pages/Chat/forward?forwardConversationType=${v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM}&msgIdClient=${m.msg.messageClientId}`}):1===e.tapIndex&&h({url:`/pages/Chat/forward?forwardConversationType=${v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P}&msgIdClient=${m.msg.messageClientId}`})},complete(){O()}})},w=()=>{const e=m.msg;e.pinState?uni.$UIKitStore.msgStore.unpinMessageActive(e).catch(e=>{(null==e?void 0:e.code)&&void 0!==y(`${e.code}`)?uni.showToast({title:y(`${e.code}`),icon:"error",duration:1e3}):uni.showToast({title:y("unpinFailedText"),icon:"error",duration:1e3})}):uni.$UIKitStore.msgStore.pinMessageActive(e).catch(e=>{(null==e?void 0:e.code)&&void 0!==y(`${e.code}`)?uni.showToast({title:y(`${e.code}`),icon:"error",duration:1e3}):uni.showToast({title:y("pinFailedText"),icon:"error",duration:1e3})}),O()},U=null==(l=null==(n=uni.$UIKitStore)?void 0:n.sdkOptions)?void 0:l.enableV2CloudConversation,P=()=>{var e,t,s;const o=m.msg,a=U?null==(e=uni.$UIKitStore.conversationStore)?void 0:e.conversations.get(o.conversationId):null==(t=uni.$UIKitStore.localConversationStore)?void 0:t.conversations.get(o.conversationId),i={message:uni.$UIKitNIM.V2NIMMessageConverter.messageSerialization(o),avatar:null==(s=uni.$UIKitStore.userStore.users.get(o.senderId))?void 0:s.avatar,conversationName:null==a?void 0:a.name,senderName:uni.$UIKitStore.uiStore.getAppellation({account:o.senderId,teamId:A===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?o.receiverId:""})},n={collectionType:1e3+o.messageType,collectionData:JSON.stringify(i),uniqueId:o.messageServerId};uni.$UIKitStore.msgStore.addCollectionActive(n).then(()=>{uni.showToast({title:y("addCollectionSuccessText"),icon:"none"})}).catch(e=>{(null==e?void 0:e.code)&&void 0!==y(`${e.code}`)?uni.showToast({title:y(`${e.code}`),icon:"error",duration:1e3}):uni.showToast({title:y("addCollectionFailedText"),icon:"error",duration:1e3})}),O()},L=async()=>{const e=m.msg;try{O(),uni.$emit(N.REPLY_MSG,m.msg),uni.$UIKitStore.msgStore.replyMsgActive(e),console.log("handleReplyMsg","====")}catch(t){console.log(t,"e=======")}A!==v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM||m.msg.isSelf||uni.$emit(N.AIT_TEAM_MEMBER,{accountId:m.msg.senderId,appellation:uni.$UIKitStore.uiStore.getAppellation({account:m.msg.senderId,teamId:m.msg.receiverId,ignoreAlias:!0})})},K=()=>{if(Date.now()-m.msg.createTime>f)return uni.showToast({title:y("msgRecallTimeErrorText"),icon:"none"}),void O();uni.showModal({title:y("recallText"),content:y("recall3"),showCancel:!0,confirmText:y("recallText"),confirmColor:"#1861df",success(e){if(e.confirm){let e=Object.assign({},m.msg,{serverExtension:"teamRecall"});uni.$UIKitStore.msgStore.reCallMsgActive(e).catch(()=>{uni.showToast({title:y("recallMsgFailText"),icon:"error"})}),console.log(A==v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM,"conversationType==V2NIMConst.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM===="),A==v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&uni.$UIKitStore.msgStore.updateMsg(m.msg.conversationId,m.msg.messageClientId,{serverExtension:"teamRecall",isSelf:!1})}},complete(){O()}})},Y=()=>{const e=m.msg;uni.showModal({title:y("deleteText"),content:y("delete"),showCancel:!0,confirmText:y("deleteText"),confirmColor:"#1861df",success(t){t.confirm&&uni.$UIKitStore.msgStore.deleteMsgActive([e]).then(()=>{uni.showToast({title:y("deleteMsgSuccessText"),icon:"none"})}).catch(e=>{uni.showToast({title:y("deleteMsgFailText"),icon:"error"})})},complete(){O()}})},G=()=>{h({url:`/pages/User/friend/index?account=${m.msg.receiverId}`})},D=I(()=>{const e=uni.$UIKitStore.uiStore.friends.filter(e=>!uni.$UIKitStore.relationStore.blacklist.includes(e.accountId)).map(e=>e.accountId).some(e=>e.account===m.msg.receiverId);V.value=e});return M(()=>{D()}),(a,n)=>{const l=C;return m.msg.isSelf?m.msg.sendingState===_(v).V2NIMMessageSendingState.V2NIM_MESSAGE_SENDING_STATE_SENDING?(e(),T("div",{key:1,class:"msg-status-wrapper"},[o(ge,{size:21,color:"#337EFF",class:"msg-status-icon icon-loading",type:"icon-a-Frame8"}),o(Ae,{placement:a.placement,ref_key:"tooltipRef",ref:d,color:"white",align:m.msg.isSelf},{content:s(()=>[E("div",{class:"msg-action-groups"},[m.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(e(),T("div",{key:0,class:"msg-action-btn",onClick:x},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-fuzhi1"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("copyText")),1)]),_:1})])):S("",!0),E("div",{class:"msg-action-btn",onClick:Y},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("deleteText")),1)]),_:1})])])]),default:s(()=>[a.bgVisible?(e(),T("div",{key:0,class:"msg-bg msg-bg-out"},[i(a.$slots,"default",{},void 0,!0)])):i(a.$slots,"default",{key:1},void 0,!0)]),_:3},8,["placement","align"])])):m.msg.sendingState===_(v).V2NIMMessageSendingState.V2NIM_MESSAGE_SENDING_STATE_FAILED||102426===m.msg.messageStatus.errorCode||104404===m.msg.messageStatus.errorCode?(e(),T("div",{key:2,class:"msg-failed-wrapper"},[E("div",{class:"msg-failed"},[E("div",{class:"msg-status-wrapper",onClick:k},[E("div",{class:"icon-fail"},"!")]),o(Ae,{placement:a.placement,ref_key:"tooltipRef",ref:d,color:"white",align:m.msg.isSelf},{content:s(()=>[E("div",{class:"msg-action-groups",style:r({width:m.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?"112px":"56px"})},[m.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(e(),T("div",{key:0,class:"msg-action-btn",onClick:x},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-fuzhi1"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("copyText")),1)]),_:1})])):S("",!0),E("div",{class:"msg-action-btn",onClick:Y},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("deleteText")),1)]),_:1})])],4)]),default:s(()=>[a.bgVisible?(e(),T("div",{key:0,class:"msg-bg msg-bg-out"},[i(a.$slots,"default",{},void 0,!0)])):i(a.$slots,"default",{key:1},void 0,!0)]),_:3},8,["placement","align"])]),102426===m.msg.messageStatus.errorCode?(e(),T("div",{key:0,class:"in-blacklist"},u(_(y)("sendFailWithInBlackText")),1)):104404===m.msg.messageStatus.errorCode?(e(),T("div",{key:1,class:"friend-delete"},[c(u(_(y)("sendFailWithDeleteText"))+" ",1),E("span",{onClick:G,class:"friend-verification"},u(_(y)("friendVerificationText")),1)])):S("",!0)])):a.tooltipVisible?(e(),t(Ae,{key:3,placement:a.placement,ref_key:"tooltipRef",ref:d,color:"white",align:m.msg.isSelf},{content:s(()=>[b.value?(e(),T("div",{key:1,class:"msg-action-groups-unknown"},[E("div",{class:"msg-action-btn",onClick:Y},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("deleteText")),1)]),_:1})])])):(e(),T("div",{key:0,class:"msg-action-groups"},[m.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(e(),T("div",{key:0,class:"msg-action-btn",onClick:x},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-fuzhi1"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("copyText")),1)]),_:1})])):S("",!0),m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(e(),T("div",{key:1,class:"msg-action-btn",onClick:L},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-huifu"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("replyText")),1)]),_:1})])):S("",!0),m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO&&m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(e(),T("div",{key:2,class:"msg-action-btn",onClick:$},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-zhuanfa"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("forwardText")),1)]),_:1})])):S("",!0),m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(e(),T("div",{key:3,class:"msg-action-btn",onClick:w},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-pin"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(m.msg.pinState?_(y)("unpinText"):_(y)("pinText")),1)]),_:1})])):S("",!0),E("div",{class:"msg-action-btn",onClick:Y},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("deleteText")),1)]),_:1})]),m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(e(),T("div",{key:4,class:"msg-action-btn",onClick:K},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-chehui"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("recallText")),1)]),_:1})])):S("",!0),m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(e(),T("div",{key:5,class:"msg-action-btn",onClick:P},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-collection"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("collectionText")),1)]),_:1})])):S("",!0)]))]),default:s(()=>[a.bgVisible?(e(),T("div",{key:0,class:"msg-bg msg-bg-out"},[i(a.$slots,"default",{},void 0,!0)])):i(a.$slots,"default",{key:1},void 0,!0)]),_:3},8,["placement","align"])):a.bgVisible?(e(),T("div",{key:4,class:"msg-bg msg-bg-out"},[i(a.$slots,"default",{},void 0,!0)])):(e(),T("div",{key:5},[i(a.$slots,"default",{},void 0,!0)])):(e(),t(Ae,{key:0,placement:a.placement,ref_key:"tooltipRef",ref:d,color:"white"},{content:s(()=>[b.value?(e(),T("div",{key:1,class:"msg-action-groups-unknown"},[E("div",{class:"msg-action-btn",onClick:Y},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("deleteText")),1)]),_:1})])])):(e(),T("div",{key:0,class:"msg-action-groups"},[m.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(e(),T("div",{key:0,class:"msg-action-btn",onClick:x},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-fuzhi1"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("copyText")),1)]),_:1})])):S("",!0),m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(e(),T("div",{key:1,class:"msg-action-btn",onClick:L},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-huifu"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("replyText")),1)]),_:1})])):S("",!0),m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO&&m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(e(),T("div",{key:2,class:"msg-action-btn",onClick:$},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-zhuanfa"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("forwardText")),1)]),_:1})])):S("",!0),m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(e(),T("div",{key:3,class:"msg-action-btn",onClick:w},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-pin"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(m.msg.pinState?_(y)("unpinText"):_(y)("pinText")),1)]),_:1})])):S("",!0),E("div",{class:"msg-action-btn",onClick:Y},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("deleteText")),1)]),_:1})]),m.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(e(),T("div",{key:4,class:"msg-action-btn",onClick:P},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-collection"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("collectionText")),1)]),_:1})])):S("",!0),_(A)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&a.manager?(e(),T("div",{key:5,class:"msg-action-btn",onClick:K},[o(ge,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),o(l,{class:"msg-action-btn-text"},{default:s(()=>[c(u(_(y)("recallText")),1)]),_:1})])):S("",!0)]))]),default:s(()=>[a.bgVisible?(e(),T("div",{key:0,class:"msg-bg msg-bg-in"},[i(a.$slots,"default",{},void 0,!0)])):i(a.$slots,"default",{key:1},void 0,!0)]),_:3},8,["placement"]))}}}),[["__scopeId","data-v-f3e3c3c3"]]),be=me(m({__name:"MessageOneLine",props:{text:{}},setup(s){const o=s,a=A(()=>(e=>{if(!e)return[];const t=Ie,s=[];let o;for(;null!==(o=t.exec(e));){s.push({type:"emoji",value:o[0],index:o.index});const t=" ".repeat(o[0].length);e=e.replace(o[0],t)}return(e=e.replace(t," "))&&e.split(" ").filter(e=>e.trim()).map(t=>{const o=null==e?void 0:e.indexOf(t);s.push({type:"text",value:t,index:o});const a=" ".repeat(t.length);e=e.replace(t,a)}),s.sort((e,t)=>e.index-t.index).map((e,t)=>({...e,key:t+e.type}))})(o.text));return(s,o)=>(e(),T("div",{class:"wrapper"},[(e(!0),T(V,null,b(a.value,s=>(e(),T(V,{key:s.key},["text"===s.type?(e(),T(V,{key:0},[c(u(s.value),1)],64)):"emoji"===s.type?(e(),t(ge,{key:1,type:_(ve)[s.value],size:14,iconStyle:{margin:"3px",verticalAlign:"bottom",display:"inline-block"}},null,8,["type"])):S("",!0)],64))),128))]))}}),[["__scopeId","data-v-6e522674"]]),Oe=me(m({__name:"message-reply",props:{replyMsg:{}},setup(i){var n;const l=i,d=g(!1),m=g(""),{name:f="",url:C=""}=(null==(n=l.replyMsg)?void 0:n.attachment)||{},V=A(()=>{var e;const{name:t="",url:s=""}=(null==(e=l.replyMsg)?void 0:e.attachment)||{};return s+(s.includes("?")?"&":"?")+`download=${t}`}),b=A(()=>{var e;return"noFind"!==(null==(e=l.replyMsg)?void 0:e.messageClientId)}),k=I(()=>{var e,t;m.value=uni.$UIKitStore.uiStore.getAppellation({account:null==(e=l.replyMsg)?void 0:e.senderId,teamId:null==(t=l.replyMsg)?void 0:t.receiverId})}),$=()=>{var e,t,s,o,a,i,n,r;if((null==(e=l.replyMsg)?void 0:e.messageType)===v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE)uni.previewImage({urls:[null==(s=null==(t=l.replyMsg)?void 0:t.attachment)?void 0:s.url]});else if((null==(o=l.replyMsg)?void 0:o.messageType)===v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT)d.value=!0,uni.$emit(N.HANDLE_MOVE_THROUGH,!0);else if((null==(a=l.replyMsg)?void 0:a.messageType)===v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO){const e=null==(n=null==(i=l.replyMsg)?void 0:i.attachment)?void 0:n.url;R(),e&&h({url:`/pages/Chat/video-play?videoUrl=${encodeURIComponent(e)}`})}else(null==(r=l.replyMsg)?void 0:r.messageType)===v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO&&(d.value=!0)},w=()=>{d.value=!1,R(),uni.$emit(N.HANDLE_MOVE_THROUGH,!1)};return p(()=>{var e,t;m.value=uni.$UIKitStore.uiStore.getAppellation({account:null==(e=l.replyMsg)?void 0:e.senderId,teamId:null==(t=l.replyMsg)?void 0:t.receiverId})}),M(()=>{k()}),(i,n)=>{var m,g,p,I,M,h,N,C;return e(),T("div",null,[(null==(m=l.replyMsg)?void 0:m.messageClientId)?(e(),T("div",{key:0,class:"reply-msg-wrapper"},[b.value?(e(),T("div",{key:1,class:"reply-msg",onClick:$},[E("div",{class:"reply-msg-name-wrapper"},[E("div",{class:"reply-msg-name-line"},"|"),E("div",{class:"reply-msg-name-content"},[o(Ee,{account:null==(g=l.replyMsg)?void 0:g.senderId,teamId:null==(p=l.replyMsg)?void 0:p.receiverId,color:"#929299",fontSize:13},null,8,["account","teamId"])]),E("div",{class:"reply-msg-name-to"},":")]),l.replyMsg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(e(),t(be,{key:0,text:l.replyMsg.text},null,8,["text"])):l.replyMsg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE?(e(),T("div",{key:1,class:"other-msg-wrapper"},[_(O)?(e(),T("span",{key:1,class:"other-msg-wrapper",onClick:n[0]||(n[0]=()=>{return e=V.value,void uni.setClipboardData({data:e,showToast:!1,success:()=>{uni.showToast({title:y("openUrlText"),icon:"none"})}});var e})},u(_(y)("fileMsgTitleText")),1)):(e(),t(_e,{key:0,href:V.value,download:_(f),showUnderLine:!1},{default:s(()=>[c(u(_(y)("fileMsgTitleText")),1)]),_:1},8,["href","download"]))])):(e(),T("div",{key:2,class:"other-msg-wrapper"},u("["+_(x)[l.replyMsg.messageType]+"]"),1))])):(e(),T("div",{key:0},[E("span",null,u(_(y)("replyNotFindText")),1)]))])):S("",!0),d.value?(e(),T("div",{key:1,class:"reply-full-screen",onClick:w},[E("div",{class:"reply-message-close",onClick:w},[o(ge,{color:"#929299",iconStyle:{fontWeight:"200"},size:18,type:"icon-guanbi"})]),(null==(I=l.replyMsg)?void 0:I.messageType)==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(e(),T("div",{key:0,class:"reply-message-content"},[o(Te,{msg:i.replyMsg,fontSize:22},null,8,["msg"])])):(null==(M=l.replyMsg)?void 0:M.messageType)==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO?(e(),T("div",{key:1,class:"msg-common",style:r({flexDirection:(null==(h=l.replyMsg)?void 0:h.isSelf)?"row-reverse":"row",backgroundColor:(null==(N=l.replyMsg)?void 0:N.isSelf)?"#d6e5f6":"#e8eaed",borderRadius:(null==(C=l.replyMsg)?void 0:C.isSelf)?"8px 0px 8px 8px":"0 8px 8px"}),onClick:a(()=>{},["stop"])},[o(ye,{msg:i.replyMsg},null,8,["msg"])],4)):S("",!0)])):S("",!0)])}}}),[["__scopeId","data-v-d8a0e9b0"]]),xe=me(m({__name:"message-notification",props:{msg:{}},setup(t){const s=t,o=s.msg.conversationType===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?s.msg.receiverId:"",a=g(""),i=I(()=>{a.value=(()=>{const e=s.msg.attachment;switch(null==e?void 0:e.type){case v.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO:{const a=(null==e?void 0:e.updatedTeamInfo)||{},i=[];if(void 0!==a.avatar&&i.push(y("updateTeamAvatar")),void 0!==a.name&&i.push(`${y("updateTeamName")}“${a.name}”`),void 0!==a.intro&&i.push(y("updateTeamIntro")),void 0!==a.inviteMode&&i.push(`${y("updateTeamInviteMode")}“${a.inviteMode===v.V2NIMTeamInviteMode.V2NIM_TEAM_INVITE_MODE_ALL?y("teamAll"):y("teamOwnerAndManagerText")}”`),void 0!==a.updateInfoMode&&i.push(`${y("updateTeamUpdateTeamMode")}“${a.updateInfoMode===v.V2NIMTeamUpdateInfoMode.V2NIM_TEAM_UPDATE_INFO_MODE_ALL?y("teamAll"):y("teamOwnerAndManagerText")}”`),void 0!==a.chatBannedMode&&i.push(`${y("updateTeamMute")}${a.chatBannedMode===v.V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN?y("closeText"):y("openText")}`),a.serverExtension){let e={};try{e=JSON.parse(a.serverExtension)}catch(t){}void 0!==e[k]&&i.push(`${y("updateAllowAt")}“${"manager"===e[k]?y("teamOwnerAndManagerText"):y("teamAll")}”`)}return i.length?`${uni.$UIKitStore.uiStore.getAppellation({account:s.msg.senderId,teamId:o})} ${i.join("、")}`:""}case v.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS:case v.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT:return`${uni.$UIKitStore.uiStore.getAppellation({account:s.msg.senderId,teamId:o})} ${y("joinTeamText")}`;case v.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE:{const t=(null==e?void 0:e.targetIds)||[];t.map(async e=>{await uni.$UIKitStore.userStore.getUserActive(e)});return`${t.map(e=>uni.$UIKitStore.uiStore.getAppellation({account:e,teamId:o})).filter(e=>!!e).join("、")} ${y("joinTeamText")}`}case v.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK:{const t=(null==e?void 0:e.targetIds)||[];t.map(async e=>{await uni.$UIKitStore.userStore.getUserActive(e)});return`${t.map(e=>uni.$UIKitStore.uiStore.getAppellation({account:e,teamId:o})).filter(e=>!!e).join("、")} ${y("beRemoveTeamText")}`}case v.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER:{const t=(null==e?void 0:e.targetIds)||[];t.map(async e=>{await uni.$UIKitStore.userStore.getUserActive(e)});return`${t.map(e=>uni.$UIKitStore.uiStore.getAppellation({account:e,teamId:o})).filter(e=>!!e).join("、")} ${y("beAddTeamManagersText")}`}case v.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER:{const t=(null==e?void 0:e.targetIds)||[];t.map(async e=>{await uni.$UIKitStore.userStore.getUserActive(e)});return`${t.map(e=>uni.$UIKitStore.uiStore.getAppellation({account:e,teamId:o})).filter(e=>!!e).join("、")} ${y("beRemoveTeamManagersText")}`}case v.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE:return`${uni.$UIKitStore.uiStore.getAppellation({account:s.msg.senderId,teamId:o})} ${y("leaveTeamText")}`;case v.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER:return`${uni.$UIKitStore.uiStore.getAppellation({account:((null==e?void 0:e.targetIds)||[])[0],teamId:o})} ${y("newGroupOwnerText")}`;default:return""}})()});return M(()=>{i()}),(t,s)=>a.value?(e(),T("div",{key:0,class:"msg-noti"},u(a.value),1)):S("",!0)}}),[["__scopeId","data-v-20f22821"]]),Re=me(m({__name:"message-g2",props:{msg:{}},setup(t){var s,a,i,n;const l=t,r=$(null==(a=null==(s=l.msg.attachment)?void 0:s.durations[0])?void 0:a.duration),c=w[null==(i=l.msg.attachment)?void 0:i.status],d=1==(null==(n=l.msg.attachment)?void 0:n.type)?"icon-yuyin8":"icon-shipin8";return p(()=>{console.log(l.msg,"-------")}),(t,s)=>(e(),T("div",{class:"g2-message-wrapper"},[o(ge,{type:_(d),size:28},null,8,["type"]),E("div",{class:"g2-message-status"},u(_(c)),1),_(r)?(e(),T("div",{key:0,class:"g2-message-duration"},u(_(r)),1)):S("",!0)]))}}),[["__scopeId","data-v-9e7495bc"]]),ke=me(m({__name:"message-read",props:{msg:{}},setup(t){var s,o;const a=t;uni.$UIKitStore.localOptions.teamMsgReceiptVisible,uni.$UIKitStore.localOptions.p2pMsgReceiptVisible;const i=uni.$UIKitNIM.V2NIMConversationIdUtil.parseConversationType(a.msg.conversationId),n=g(0),l=null==(o=null==(s=uni.$UIKitStore)?void 0:s.sdkOptions)?void 0:o.enableV2CloudConversation,r=()=>{var e,t,s,o;if(i===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P){const i=l?null==(e=uni.$UIKitStore.conversationStore)?void 0:e.conversations.get(a.msg.conversationId):null==(t=uni.$UIKitStore.localConversationStore)?void 0:t.conversations.get(a.msg.conversationId);console.log((null==(s=null==a?void 0:a.msg)?void 0:s.createTime)<=((null==i?void 0:i.msgReceiptTime)||0)),console.log("conversation?.msgReceiptTime"),n.value=(null==(o=null==a?void 0:a.msg)?void 0:o.createTime)<=((null==i?void 0:i.msgReceiptTime)||0)?360:0}},c=I(()=>{r(),function(){if(i===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P)return;uni.$UIKitStore.msgStore.getTeamMessageReceiptDetailsActive(a.msg).then(e=>{u.value=e.readAccountList.length})}()}),u=g(0);return p(()=>{r()}),M(()=>{c()}),(t,s)=>(e(),T("div"))}}),[["__scopeId","data-v-afe3c4e3"]]),$e=me(m({__name:"message-item",props:{msg:{},index:{},replyMsgsMap:{},broadcastNewAudioSrc:{},manager:{type:Boolean}},setup(a){var i,n;const l=g({}),d=a;p(()=>{l.value=d.msg});const m=A(()=>d.replyMsgsMap&&d.replyMsgsMap[d.msg.messageClientId]),f=g(""),V=null==(n=null==(i=uni.$UIKitStore)?void 0:i.userStore)?void 0:n.myUserInfo.accountId,b=uni.$UIKitNIM.V2NIMConversationIdUtil.parseConversationType(d.msg.conversationId),O=uni.$UIKitNIM.V2NIMConversationIdUtil.parseConversationTargetId(d.msg.conversationId),x=A(()=>{var e;const t=null==(e=d.msg.attachment)?void 0:e.url;return t?`${t}${t.includes("?")?"&":"?"}vframe&offset=1`:""}),k=A(()=>{var e,t,s;return 102426==d.msg.messageStatus.errorCode||104404==d.msg.messageStatus.errorCode?"https://yx-web-nosdn.netease.im/common/c1f278b963b18667ecba4ee9a6e68047/img-fail.png":(null==(t=null==(e=d.msg)?void 0:e.attachment)?void 0:t.url)||(null==(s=d.msg.attachment)?void 0:s.file)}),$=I(()=>{f.value=uni.$UIKitStore.uiStore.getAppellation({account:d.msg.senderId,teamId:b===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?O:""})});function w(){console.log(d.msg),console.log(l.value.serverExtension)}return M(()=>{$()}),(a,i)=>{var n,g,p,I;const M=C,A=L;return e(),T("div",null,[_(b)!==_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM||"teamRecall"!=d.msg.serverExtension&&"teamRecall"!=l.value.serverExtension?_(b)!==_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM||d.msg.isSelf||"beReCallMsg"!==d.msg.recallType&&"beReCallMsg"!==l.value.recallType?(e(),T("div",{class:U("msg-item-wrapper "+(!d.msg.pinState||d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&void 0!==d.msg.timeValue||d.msg.recallType?"":"msg-pin")),id:_(P)+d.msg.messageClientId,key:d.msg.createTime},[d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&void 0!==d.msg.timeValue?(e(),T("div",{key:0,class:"msg-time"},u(d.msg.timeValue),1)):d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&"reCallMsg"===d.msg.recallType&&d.msg.canEdit?(e(),T("div",{key:1,class:"msg-common",style:r({flexDirection:d.msg.isSelf?"row-reverse":"row"})},[o(de,{account:d.msg.senderId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"","goto-user-card":!0,width:"35px",height:"35px"},null,8,["account","teamId"]),o(Ve,{msg:d.msg,"bg-visible":!0,manager:a.manager},{default:s(()=>[c(u(_(y)("recall2"))+" ",1),o(M,{class:"msg-recall-btn",onClick:i[0]||(i[0]=()=>{var e;e=d.msg,uni.$emit(N.ON_REEDIT_MSG,e)})},{default:s(()=>[c(u(_(y)("reeditText")),1)]),_:1})]),_:1},8,["msg","manager"])],4)):d.msg.messageType!==_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM||"reCallMsg"!==d.msg.recallType||d.msg.canEdit?d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&"beReCallMsg"===d.msg.recallType?(e(),T("div",{key:3,class:"msg-common",style:r({flexDirection:d.msg.isSelf?"row-reverse":"row"})},[o(de,{account:d.msg.senderId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"","goto-user-card":!0,width:"35px",height:"35px"},null,8,["account","teamId"]),E("div",{class:"msg-content"},[d.msg.isSelf?S("",!0):(e(),T("div",{key:0,class:"msg-name"},u(f.value),1)),E("div",{class:U(d.msg.isSelf?"self-msg-recall":"msg-recall"),onClick:w},[o(M,{class:"msg-recall2"},{default:s(()=>[c(u(d.msg.isSelf?`${_(y)("you")+_(y)("recall")}`:_(y)("recall2"))+" "+u(d.msg.serverExtension),1)]),_:1})],2)])],4)):d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(e(),T("div",{key:4,class:"msg-common",style:r({flexDirection:d.msg.isSelf?"row-reverse":"row"})},[o(de,{account:d.msg.senderId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"","goto-user-card":!0,width:"35px",height:"35px"},null,8,["account","teamId"]),E("div",{class:"msg-content"},[d.msg.isSelf?S("",!0):(e(),T("div",{key:0,class:"msg-name"},u(f.value),1)),o(Ve,{manager:a.manager,msg:d.msg,"tooltip-visible":!0,"bg-visible":!0},{default:s(()=>{var s;return[m.value?(e(),t(Oe,{key:0,replyMsg:m.value},null,8,["replyMsg"])):S("",!0),o(Te,{msg:d.msg},null,8,["msg"]),(null==(s=d.msg)?void 0:s.isSelf)?(e(),t(ke,{key:1,msg:d.msg},null,8,["msg"])):S("",!0)]}),_:1},8,["manager","msg"])])],4)):d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE?(e(),T("div",{key:5,class:"msg-common",style:r({flexDirection:d.msg.isSelf?"row-reverse":"row"})},[o(de,{account:d.msg.senderId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"","goto-user-card":!0,width:"35px",height:"35px"},null,8,["account","teamId"]),E("div",{style:{"text-align":"right"}},[E("div",{class:"msg-content"},[d.msg.isSelf?S("",!0):(e(),T("div",{key:0,class:"msg-name"},u(f.value),1)),o(Ve,{manager:a.manager,msg:d.msg,"tooltip-visible":!0,"bg-visible":!0,style:{cursor:"pointer"}},{default:s(()=>[E("div",{onClick:i[1]||(i[1]=()=>{var e,t;(t=null==(e=d.msg.attachment)?void 0:e.url)&&uni.previewImage({urls:[t]})})},[o(A,{class:"msg-image","lazy-load":!0,mode:"aspectFill",src:k.value},null,8,["src"])])]),_:1},8,["manager","msg"])]),(null==(n=d.msg)?void 0:n.isSelf)?(e(),t(ke,{key:0,msg:d.msg},null,8,["msg"])):S("",!0)])],4)):d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO?(e(),T("div",{key:6,class:"msg-common",style:r({flexDirection:d.msg.isSelf?"row-reverse":"row"})},[o(de,{account:d.msg.senderId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"","goto-user-card":!0,width:"35px",height:"35px"},null,8,["account","teamId"]),E("div",{style:{"text-align":"right"}},[E("div",{class:"msg-content"},[d.msg.isSelf?S("",!0):(e(),T("div",{key:0,class:"msg-name"},u(f.value),1)),o(Ve,{manager:a.manager,msg:d.msg,"tooltip-visible":!0,"bg-visible":!0,style:{cursor:"pointer"}},{default:s(()=>[E("div",{class:"video-msg-wrapper",onClick:i[2]||(i[2]=()=>(e=>{var t;R();const s=null==(t=e.attachment)?void 0:t.url;s&&h({url:`/pages/Chat/video-play?videoUrl=${encodeURIComponent(s)}`})})(d.msg))},[E("div",{class:"video-play-button"},[E("div",{class:"video-play-icon"})]),o(A,{class:"msg-image","lazy-load":!0,mode:"aspectFill",src:x.value},null,8,["src"])])]),_:1},8,["manager","msg"])]),(null==(g=d.msg)?void 0:g.isSelf)?(e(),t(ke,{key:0,msg:d.msg},null,8,["msg"])):S("",!0)])],4)):d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(e(),T("div",{key:7,class:"msg-common",style:r({flexDirection:d.msg.isSelf?"row-reverse":"row"})},[o(de,{account:d.msg.senderId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"","goto-user-card":!0,width:"35px",height:"35px"},null,8,["account","teamId"]),E("div",{class:"msg-content"},[d.msg.isSelf?S("",!0):(e(),T("div",{key:0,class:"msg-name"},u(f.value),1)),o(Ve,{manager:a.manager,msg:d.msg,"tooltip-visible":!0,"bg-visible":!0},{default:s(()=>[o(Re,{msg:d.msg},null,8,["msg"])]),_:1},8,["manager","msg"])])],4)):d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE?(e(),T("div",{key:8,class:"msg-common",style:r({flexDirection:d.msg.isSelf?"row-reverse":"row"})},[o(de,{account:d.msg.senderId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"","goto-user-card":!0,width:"35px",height:"35px"},null,8,["account","teamId"]),E("div",{style:{"text-align":"right"}},[E("div",{class:"msg-content"},[d.msg.isSelf?S("",!0):(e(),T("div",{key:0,class:"msg-name"},u(f.value),1)),o(Ve,{manager:a.manager,msg:d.msg,"tooltip-visible":!0,"bg-visible":!1},{default:s(()=>[o(Se,{msg:d.msg},null,8,["msg"])]),_:1},8,["manager","msg"])]),(null==(p=d.msg)?void 0:p.isSelf)?(e(),t(ke,{key:0,msg:d.msg},null,8,["msg"])):S("",!0)])],4)):d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO?(e(),T("div",{key:9,class:"msg-common",style:r({flexDirection:d.msg.isSelf?"row-reverse":"row"})},[o(de,{account:d.msg.senderId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"","goto-user-card":!0,width:"35px",height:"35px"},null,8,["account","teamId"]),E("div",{class:"msg-content"},[d.msg.isSelf?S("",!0):(e(),T("div",{key:0,class:"msg-name"},u(f.value),1)),o(Ve,{manager:a.manager,msg:d.msg,"tooltip-visible":!0,"bg-visible":!0,style:{cursor:"pointer"}},{default:s(()=>[o(ye,{msg:d.msg,broadcastNewAudioSrc:a.broadcastNewAudioSrc},null,8,["msg","broadcastNewAudioSrc"])]),_:1},8,["manager","msg"])]),(null==(I=d.msg)?void 0:I.isSelf)?(e(),t(ke,{key:0,msg:d.msg},null,8,["msg"])):S("",!0)],4)):d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_NOTIFICATION?(e(),t(xe,{key:10,msg:d.msg},null,8,["msg"])):(e(),T("div",{key:11,class:"msg-common",style:r({flexDirection:d.msg.isSelf?"row-reverse":"row"})},[o(de,{account:d.msg.senderId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"","goto-user-card":!0,width:"35px",height:"35px"},null,8,["account","teamId"]),E("div",{class:"msg-content"},[d.msg.isSelf?S("",!0):(e(),T("div",{key:0,class:"msg-name"},u(f.value),1)),o(Ve,{msg:d.msg,manager:a.manager,"tooltip-visible":!0,"bg-visible":!0},{default:s(()=>[c(u(d.msg.text),1)]),_:1},8,["msg","manager"])])],4)):(e(),T("div",{key:2,class:"msg-common",style:r({flexDirection:d.msg.isSelf?"row-reverse":"row"})},[o(de,{account:d.msg.senderId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"","goto-user-card":!0,width:"35px",height:"35px"},null,8,["account","teamId"]),o(Ve,{msg:d.msg,"bg-visible":!0,manager:a.manager},{default:s(()=>[E("div",{class:"recall-text"},u(_(y)("you")+_(y)("recall")),1)]),_:1},8,["msg","manager"])],4)),!d.msg.pinState||d.msg.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&void 0!==d.msg.timeValue||d.msg.recallType?S("",!0):(e(),T("div",{key:12,class:"msg-pin-tip",style:r({justifyContent:d.msg.isSelf?"flex-end":"flex-start"})},[o(ge,{size:11,type:"icon-green-pin"}),c(" "),d.msg.operatorId===_(V)?(e(),T("span",{key:0},u(`${_(y)("you")}`),1)):(e(),t(Ee,{key:1,account:d.msg.operatorId,teamId:_(b)===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?_(O):"",color:"#3EAF96",fontSize:"11"},null,8,["account","teamId"])),c(" "+u(`${_(y)("pinThisText")}`),1)],4))],10,["id"])):(e(),T("div",{key:1})):(e(),T("div",{key:0}))])}}}),[["__scopeId","data-v-0fa108ea"]]),we=me(m({__name:"message-list",props:{msgs:{},conversationType:{},to:{},loadingMore:{type:Boolean},noMore:{type:Boolean},replyMsgsMap:{}},setup(a){function i(e){console.log(e.detail.deltaY),e.detail.deltaY>5&&uni.$emit("closeMore")}const r=a;let m=()=>{};const p=g(!1);K(()=>{let e;m=I(()=>{e=uni.$UIKitStore.teamStore.teams.get(r.to);const t=uni.$UIKitStore.teamMemberStore.getTeamMember(e.teamId,[uni.$UIKitStore.userStore.myUserInfo.accountId])[0];t&&(p.value=t.memberRole==v.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER||t.memberRole==v.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_OWNER,console.log(p.value,"manager======"))}),r.conversationType===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&uni.$UIKitStore.teamMemberStore.getTeamMemberActive({teamId:r.to,queryOption:{limit:Math.max((null==e?void 0:e.memberLimit)||0,200),roleQueryType:0}}),uni.$on(N.AUDIO_URL_CHANGE,e=>{f.value=e}),uni.$on(N.ON_SCROLL_BOTTOM,()=>{C()}),uni.$on(N.ON_LOAD_MORE,()=>{const e=h.value.filter(e=>!(e.messageType===v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&["beReCallMsg","reCallMsg"].includes(e.recallType||"")))[0];e&&uni.$emit(N.GET_HISTORY_MSG,e)})});const S=g(99999),h=A(()=>{const e=[];return r.msgs.forEach((t,s)=>{s>0&&t.createTime-r.msgs[s-1].createTime>3e5&&e.push({...t,messageClientId:"time-"+t.createTime,messageType:v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM,sendingState:v.V2NIMMessageSendingState.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED,timeValue:he(t.createTime),renderKey:`${t.createTime+1}`}),e.push({...t,renderKey:`${t.createTime}`})}),e}),f=g(""),C=()=>{S.value+=9999999;const e=setTimeout(()=>{S.value+=1,clearTimeout(e)},300)},O=()=>{const e=h.value.filter(e=>!(e.messageType===v.V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&["beReCallMsg","reCallMsg"].includes(e.recallType||"")))[0];uni.$emit(N.GET_HISTORY_MSG,e)},x=()=>{uni.$emit(N.CLOSE_PANEL),setTimeout(()=>{uni.$emit(N.CLOSE_PANEL)},300)};return M(()=>{uni.$off(N.ON_SCROLL_BOTTOM),uni.$off(N.ON_LOAD_MORE),uni.$off(N.AUDIO_URL_CHANGE),m()}),(a,r)=>{const m=d,g=Y;return e(),T("div",{class:"msg-list-wrapper",onTouchstart:x},[o(g,{id:"message-scroll-list","scroll-y":"true","scroll-top":S.value,class:"message-scroll-list",onScroll:i},{default:s(()=>[n(E("div",{onClick:O,class:"view-more-text"},u(_(y)("viewMoreText")),513),[[l,!a.noMore]]),n(o(m,{class:"msg-tip"},{default:s(()=>[c(u(_(y)("noMoreText")),1)]),_:1},512),[[l,a.noMore]]),(e(!0),T(V,null,b(h.value,(s,o)=>(e(),T("div",{key:s.renderKey},[(e(),t($e,{msg:s,manager:p.value,index:o,key:s.renderKey,"reply-msgs-map":a.replyMsgsMap,broadcastNewAudioSrc:f.value},null,8,["msg","manager","index","reply-msgs-map","broadcastNewAudioSrc"]))]))),128))]),_:1},8,["scroll-top"])],32)}}}),[["__scopeId","data-v-0bafceb0"]]),Ue=me(m({__name:"face",emits:["emojiClick","emojiSend","emojiDelete"],setup(s,{emit:i}){const n=Object.keys(Me),l=((e,t)=>{if(t<1)throw Error("colNum cound not be smaller than 1");const s=e.length,o=Math.ceil(s/t);let a=0,i=0;const n=[];for(;a<=s&&i<o;)n[i]=e.slice(a,a+t),a+=t,i++;return n})(n,7),r=i,c=()=>{r("emojiDelete")},d=()=>{r("emojiSend")};return(s,i)=>(e(),T("div",{class:"msg-face-wrapper"},[E("div",{class:"msg-face"},[(e(!0),T(V,null,b(_(l),(s,i)=>(e(),T("div",{class:"msg-face-row"},[(e(!0),T(V,null,b(s,t=>(e(),T("div",{onClick:a(()=>{var e;e={key:t,type:_(Me)[t]},r("emojiClick",e)},["stop"]),key:t,class:"msg-face-item"},[o(ge,{size:27,type:_(Me)[t]},null,8,["type"])],8,["onClick"]))),128)),i+1===Math.ceil(_(n).length/7)?(e(),t(ge,{key:0,class:"msg-face-delete",size:27,type:"icon-tuigejian"})):S("",!0),i+1===Math.ceil(_(n).length/7)?(e(),t(ge,{key:1,class:"msg-face-delete",size:27,type:"icon-tuigejian"})):S("",!0),i+1===Math.ceil(_(n).length/7)?(e(),t(ge,{key:2,class:"msg-face-delete",size:27,type:"icon-tuigejian"})):S("",!0)]))),256))]),E("div",{class:"emoji-block"}),E("div",{class:"msg-face-control"},[E("div",{onClick:c,class:"msg-delete-btn"},[o(ge,{type:"icon-tuigejian",size:25,color:"#333"})]),E("div",{onClick:d,class:"msg-send-btn"},u(_(y)("sendText")),1)])]))}}),[["__scopeId","data-v-2be21f64"]]);class Pe{constructor(){this.mediaRecorder=null,this.audioContext=null,this.analyser=null,this.audioChunks=[],this.startTime=null,this.isPaused=!1,this.isRecording=!1,this.callbacks={onStart:[],onPause:[],onResume:[],onStop:[],onError:[],onFrameRecorded:[],onInterruptionBegin:[],onInterruptionEnd:[]},this.defaultOptions={duration:6e4,sampleRate:44100,numberOfChannels:1,encodeBitRate:192e3,format:"mp3",frameSize:null}}start(e={}){if(this.isRecording)return void this._triggerError("录音已在进行中");const t=Object.assign({},this.defaultOptions,e);if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return this._triggerError("当前浏览器不支持录音功能"),void console.warn("当前浏览器不支持录音功能");navigator.mediaDevices.getUserMedia({audio:{sampleRate:t.sampleRate,channelCount:t.numberOfChannels,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!1}}).then(e=>{console.warn("_initRecorder"),this._initRecorder(e,t)}).catch(e=>{console.error("获取麦克风权限失败:",e),console.error("获取麦克风权限失败:",e.message),this._triggerError("获取麦克风权限失败: "+e.message)})}_initRecorder(e,t){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext);const s=this._getMimeType(t.format);MediaRecorder.isTypeSupported(s)||console.warn(`不支持${t.format}格式，将使用默认格式`),this.mediaRecorder=new MediaRecorder(e,{mimeType:MediaRecorder.isTypeSupported(s)?s:void 0,audioBitsPerSecond:t.encodeBitRate}),this.audioChunks=[],this.startTime=Date.now(),this.isRecording=!0,this.isPaused=!1,this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&(this.audioChunks.push(e.data),t.frameSize&&this.callbacks.onFrameRecorded.length>0&&this._triggerFrameRecorded(e.data,!1))},this.mediaRecorder.onstop=()=>{this._handleRecordStop(t)},this.mediaRecorder.onerror=e=>{this._triggerError("录音过程中出现错误: "+e.error)},t.frameSize?this.mediaRecorder.start(1024*t.frameSize):this.mediaRecorder.start(),t.duration&&t.duration>0&&setTimeout(()=>{this.isRecording&&!this.isPaused&&this.stop()},t.duration),this._triggerStart()}catch(s){console.error("初始化录音器失败:",s),this._triggerError("初始化录音器失败: "+s.message)}}_getMimeType(e){return{mp3:"audio/mpeg",wav:"audio/wav",aac:"audio/aac",PCM:"audio/wav"}[e]||"audio/webm"}pause(){this.isRecording&&!this.isPaused&&this.mediaRecorder&&"recording"===this.mediaRecorder.state&&(this.mediaRecorder.pause(),this.isPaused=!0,this._triggerPause())}resume(){this.isRecording&&this.isPaused&&this.mediaRecorder&&"paused"===this.mediaRecorder.state&&(this.mediaRecorder.resume(),this.isPaused=!1,this._triggerResume())}stop(){this.isRecording&&(this.mediaRecorder&&"inactive"!==this.mediaRecorder.state&&this.mediaRecorder.stop(),this.mediaRecorder&&this.mediaRecorder.stream&&this.mediaRecorder.stream.getTracks().forEach(e=>e.stop()),this.isRecording=!1,this.isPaused=!1)}_handleRecordStop(e){if(0===this.audioChunks.length)return void this._triggerError("没有录制到音频数据");const t=new Blob(this.audioChunks,{type:this._getMimeType(e.format)}),s=URL.createObjectURL(t),o=this.startTime?(Date.now()-this.startTime)/1e3:0;this._triggerStop({tempFilePath:s,duration:o,fileSize:t.size}),this._cleanup()}_cleanup(){this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.mediaRecorder=null,this.audioChunks=[],this.startTime=null}onStart(e){"function"==typeof e&&this.callbacks.onStart.push(e)}onPause(e){"function"==typeof e&&this.callbacks.onPause.push(e)}onResume(e){"function"==typeof e&&this.callbacks.onResume.push(e)}onStop(e){"function"==typeof e&&this.callbacks.onStop.push(e)}onError(e){"function"==typeof e&&this.callbacks.onError.push(e)}onFrameRecorded(e){"function"==typeof e&&this.callbacks.onFrameRecorded.push(e)}onInterruptionBegin(e){"function"==typeof e&&this.callbacks.onInterruptionBegin.push(e)}onInterruptionEnd(e){"function"==typeof e&&this.callbacks.onInterruptionEnd.push(e)}offStart(e){this._removeCallback("onStart",e)}offPause(e){this._removeCallback("onPause",e)}offResume(e){this._removeCallback("onResume",e)}offStop(e){this._removeCallback("onStop",e)}offFrameRecorded(e){this._removeCallback("onFrameRecorded",e)}_removeCallback(e,t){if(t&&this.callbacks[e]){const s=this.callbacks[e].indexOf(t);s>-1&&this.callbacks[e].splice(s,1)}}_triggerStart(){this.callbacks.onStart.forEach(e=>{try{e()}catch(t){console.error("onStart callback error:",t)}})}_triggerPause(){this.callbacks.onPause.forEach(e=>{try{e()}catch(t){console.error("onPause callback error:",t)}})}_triggerResume(){this.callbacks.onResume.forEach(e=>{try{e()}catch(t){console.error("onResume callback error:",t)}})}_triggerStop(e){this.callbacks.onStop.forEach(t=>{try{t(e)}catch(s){console.error("onStop callback error:",s)}})}_triggerError(e){this.callbacks.onError.forEach(t=>{try{t({errMsg:e})}catch(s){console.error("onError callback error:",s)}})}_triggerFrameRecorded(e,t=!1){this.callbacks.onFrameRecorded.forEach(s=>{try{s({frameBuffer:e,isLastFrame:t})}catch(o){console.error("onFrameRecorded callback error:",o)}})}}let Le=null;const Ke=me(m({__name:"voice-panel",emits:["handleSendAudioMsg"],setup(t,{emit:s}){const a=s,i=g("stop"),n=g(!1);M(()=>{uni.$off("closeRecord")});const l=(Le||(Le=new Pe),Le),c=G({attachment:{duration:1,url:""},isSelf:!1});function d(){n.value=!1}function m(){a("handleSendAudioMsg",c.attachment.url,c.attachment.duration)}uni.$on("closeRecord",()=>{I()}),p(()=>{l.onStop(e=>{e.duration<1||(console.log(e,"rfes======"),c.attachment.duration=e.duration,c.attachment.url=e.tempFilePath,n.value=!0)})});const v=e=>{n.value=!1,i.value="recording",console.log("onStartRecord"),l.start({duration:6e4,sampleRate:44100,numberOfChannels:1,encodeBitRate:192e3,format:"mp3"}),pe(e)},I=e=>{i.value="stop",l.stop()};return(t,s)=>(e(),T("div",{class:"voice-panel-wrapper"},[n.value?(e(),T("div",{key:1},[E("div",{class:"flex-center",style:{"margin-top":"30px"}},[E("div",{class:"audio-box"},[o(ye,{msg:c,broadcastNewAudioSrc:t.broadcastNewAudioSrc},null,8,["msg","broadcastNewAudioSrc"])])]),E("div",{class:"btn-group"},[E("div",{class:"send",style:{"background-color":"#b3b7bc"},onClick:d},"重录"),E("div",{class:"send",style:{"background-color":"#337eff","margin-left":"19px"},onClick:m},"发送")])])):(e(),T("div",{key:0},[E("div",{class:"audio-remind-text"},u(_(y)("audioRemindText")),1),E("div",{class:"voice-panel"},[E("div",{class:"voice-panel-circel",onTouchstart:s[0]||(s[0]=(...e)=>_(pe)&&_(pe)(...e)),onLongpress:v,onTouchend:I,onContextmenu:s[1]||(s[1]=(...e)=>_(pe)&&_(pe)(...e))},[E("div",{class:"img-mask"}),o(ge,{width:24,height:30,type:"audio-btn"})],32),E("div",{style:r({display:"stop"==i.value?"none":"block"}),class:"big-circle"},null,4),E("div",{style:r({display:"stop"==i.value?"none":"block"}),class:"small-circle"},null,4)]),E("div",{class:"audio-btn-text"},u(_(y)("audioBtnText")),1)]))]))}}),[["__scopeId","data-v-3d9ce0dd"]]),Ye=me(m({__name:"mention-member-list",props:{teamId:{}},setup(t){const s=t,a=g(),i=g([]),n=g(""),l=A(()=>i.value.filter(e=>e.accountId!==uni.$UIKitStore.userStore.myUserInfo.accountId)),r=A(()=>{const e=uni.$UIKitStore.userStore.myUserInfo;return(a.value?a.value.ownerAccountId:"")===(e?e.accountId:"")}),c=A(()=>{const e=uni.$UIKitStore.userStore.myUserInfo;return i.value.filter(e=>e.memberRole===v.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER).some(t=>t.accountId===(e?e.accountId:""))}),d=A(()=>{let e={};try{e=JSON.parse(n.value||"{}")}catch(t){}return"manager"!==e[k]||(r.value||c.value)}),m=e=>{console.log(e,"=====");const t=e.accountId===D?e:{accountId:e.name,appellation:uni.$UIKitStore.uiStore.getAppellation({account:e.accountId,teamId:e.teamId,ignoreAlias:!0})};uni.$emit(N.HANDLE_AIT_MEMBER,t)},p=()=>{uni.$emit(N.CLOSE_AIT_POPUP)},h=I(()=>{if(s.teamId){i.value=(e=uni.$UIKitStore.teamMemberStore.getTeamMember(s.teamId),t=s.teamId,[...e.filter(e=>e.memberRole===v.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_OWNER),...e.filter(e=>e.memberRole===v.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER).sort((e,t)=>e.joinTime-t.joinTime),...e.filter(e=>![v.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_OWNER,v.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER].includes(e.memberRole)).sort((e,t)=>e.joinTime-t.joinTime)].map(e=>({...e,name:uni.$UIKitStore.uiStore.getAppellation({account:e.accountId,teamId:t})})));const o=uni.$UIKitStore.teamStore.teams.get(s.teamId);a&&(a.value=o,n.value=(null==o?void 0:o.serverExtension)||"")}var e,t});return M(()=>{h()}),(t,s)=>(e(),T("div",{class:"mention-member-list-wrapper"},[E("div",{class:"header"},[E("div",{onClick:p,class:"close"},[o(ge,{color:"#000",type:"icon-jiantou"})]),E("div",{class:"title"},u(_(y)("chooseMentionText")),1)]),E("div",{class:"member-list-content"},[E("div",{style:{display:"none"}},u(n.value),1),d.value?(e(),T("div",{key:0,class:"member-item",onClick:s[0]||(s[0]=()=>m({accountId:_(D),appellation:_(y)("teamAll")}))},[o(ge,{size:42,type:"icon-team2",color:"#fff"}),E("span",{class:"member-name"},u(_(y)("teamAll")),1)])):S("",!0),(e(!0),T(V,null,b(l.value,t=>(e(),T("div",{class:"member-item",key:t.accountId,onClick:()=>m(t)},[o(de,{account:t.accountId},null,8,["account"]),E("div",{class:"member-name"},[o(Ee,{account:t.accountId,teamId:t.teamId},null,8,["account","teamId"])]),t.memberRole===_(v).V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_OWNER?(e(),T("div",{key:0,class:"owner"},u(_(y)("teamOwner")),1)):t.memberRole===_(v).V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER?(e(),T("div",{key:1,class:"manager"},u(_(y)("teamManager")),1)):S("",!0)],8,["onClick"]))),128)),E("div",{class:"member-item-block"})])]))}}),[["__scopeId","data-v-daafe129"]]),Ge=me(m({__name:"Message-actions",props:{mute:{type:Boolean,default:!1},show:{type:Boolean,default:!1},conversationId:{},otherAccountId:{},conversationType:{}},setup(t){const s=t,a=[{img:"/static/photo.png",text:"照片",key:"photo"},{img:"/static/video.png",text:"视频",key:"video"},{img:"/static/video.png",text:"音频聊天",key:"voice-call"},{img:"/static/red.png",text:"红包",key:"red"},{img:"/static/file.png",text:"文件",key:"file"}];const i=()=>{s.mute||(R(),uni.chooseImage({count:1,mediaType:["image"],sourceType:["album"],sizeType:["compressed"],success:e=>{const t=uni.$UIKitNIM.V2NIMMessageCreator.createImageMessage(e.tempFilePaths[0]);uni.$UIKitStore.msgStore.sendMessageActive({msg:t,conversationId:s.conversationId,progress:()=>!0,sendBefore:()=>{uni.$emit(N.ON_SCROLL_BOTTOM)}}).then(()=>{uni.$emit(N.ON_SCROLL_BOTTOM)}).catch(()=>{uni.$emit(N.ON_SCROLL_BOTTOM),uni.showToast({icon:"error",title:y("sendImageFailedText")})})},fail:e=>{console.log("chooseImage",e)},complete:Ce}))},n=(e,t)=>{s.mute||(R(),B&&"blur"==(null==t?void 0:t.type)||uni.chooseVideo({sourceType:["album"],compressed:!0,maxDuration:60,success:e=>{const t=uni.$UIKitNIM.V2NIMMessageCreator.createVideoMessage(e.tempFilePath);uni.$UIKitStore.msgStore.sendMessageActive({msg:t,conversationId:s.conversationId,progress:()=>!0,sendBefore:()=>{uni.$emit(N.ON_SCROLL_BOTTOM)}}).then(()=>{uni.$emit(N.ON_SCROLL_BOTTOM)}).catch(()=>{uni.$emit(N.ON_SCROLL_BOTTOM),uni.showToast({icon:"error",title:y("sendVideoFailedText")})})},complete:Ce}))},l=()=>{uni.chooseFile({count:1,type:"file",sourceType:[],success:e=>{var t,o,a;const i=null==(t=null==e?void 0:e.tempFilePaths)?void 0:t[0],n=null==(a=null==(o=null==e?void 0:e.tempFiles)?void 0:o[0])?void 0:a.name;if(i&&n){const e=uni.$UIKitNIM.V2NIMMessageCreator.createFileMessage(i,n);uni.$UIKitStore.msgStore.sendMessageActive({msg:e,conversationId:s.conversationId,sendBefore:()=>{uni.$emit(N.ON_SCROLL_BOTTOM)}})}},fail:()=>{}})};function c(e){e.stopPropagation(),e.preventDefault()}return(t,d)=>(e(),T("div",{class:"message-action-box",style:r({height:t.show?"250px":"0px",paddingTop:t.show?"20px":"0"})},[(e(),T(V,null,b(a,(e,t)=>E("div",{key:t,onContextmenu:c,class:"action-name"},[E("div",{onClick:t=>async function(e,t){console.log(e,t),"photo"==e.key?i():"video"==e.key?n("",t):"file"==e.key?l():"red"==e.key?uni.showToast({title:"开发中",icon:"warning"}):(uni.setStorageSync("currentConversation",s.conversationId),s.conversationType==v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P?h({url:`/pages/Other/video-call?uid=${s.otherAccountId}&type=1`}):(uni.setStorageSync("currentConversation",s.conversationId),h({url:`/pages/Other/select-call-user?teamId=${s.otherAccountId}&conversationId=${s.conversationId}`})))}(e,t)},[o(fe,{path:e.img,width:"46px",height:"46px"},null,8,["path"]),E("div",{style:{"margin-top":"11px"}},u(e.text),1)],8,["onClick"])],32)),64))],4))}}),[["__scopeId","data-v-705b8db5"]]),De=me(m({__name:"message-input",props:{conversationType:{},to:{},replyMsgsMap:{},showMore:{type:Boolean}},emits:["changeState"],setup(i,{emit:r}){const c=i;uni.$on("closeMore",()=>{uni.hideKeyboard(),w.value=!1,f.value=!1,V.value=!1,uni.$emit("closeRecord")}),g(F());const d=c.conversationType===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P?uni.$UIKitNIM.V2NIMConversationIdUtil.p2pConversationId(c.to):uni.$UIKitNIM.V2NIMConversationIdUtil.teamConversationId(c.to),m=g(""),h=g(!1),f=g(!1),C=g(!1),V=g(!1),b=A(()=>!f.value&&!C.value),R=e=>{const t=uni.$UIKitStore.userStore.myUserInfo.accountId,s=uni.$UIKitStore.uiStore.getAppellation({account:c.to});t?H({remoteUserAccid:c.to,currentUserAccid:t,type:e,remoteShowName:s}):uni.showToast({title:y("callFailedText"),icon:"none"})},$=g(!1),w=g(!1),U=g(!1),P=g(!1),L=g(),K=Z(),Y=g(null),G=g([]),ee=g(),te=g([]),se=g(v.V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN),oe=g(!1),ae=g(!1),ie=g(!1),ne=r,le=A(()=>{let e={};try{e=JSON.parse((ee.value||{}).serverExtension||"{}")}catch(t){}return"manager"!==e[k]||(oe.value||ae.value)}),re=e=>{uni.$emit(N.HANDLE_MOVE_THROUGH,e.value)},ce=()=>{if($.value=!1,h.value=!1,V.value=!1,W)Ve();else if(!O){const e=setTimeout(()=>{Ve(),clearTimeout(e)},500)}};function ue(){de(),uni.hideKeyboard(),w.value=!w.value,ne("changeState",w.value),uni.$emit(N.ON_SCROLL_BOTTOM)}const de=()=>{P.value=!1},me=()=>{Q?uni.$emit(N.ON_SCROLL_BOTTOM):setTimeout(()=>{uni.$emit(N.ON_SCROLL_BOTTOM)},300)},pe=e=>{var t;const s=null==(t=null==e?void 0:e.detail)?void 0:t.value,o=s.endsWith("@")||s.endsWith("@\n");c.conversationType==v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&o&&(uni.hideKeyboard(),K.refs.popupRef.open("bottom"),P.value=!1,uni.$emit(N.HANDLE_MOVE_THROUGH,!0))},ve=()=>{if(""===m.value.trim())return;const e=Re();let t=J(m.value);const s=uni.$UIKitNIM.V2NIMMessageCreator.createTextMessage(t);uni.$UIKitStore.msgStore.sendMessageActive({msg:s,conversationId:d,serverExtension:G.value.length&&e,sendBefore:()=>{me()}}).catch(()=>{uni.showToast({icon:"error",title:y("sendMsgFailedText")})}).finally(()=>{me()}),m.value="",U.value=!1,L.value=void 0,G.value=[],uni.hideKeyboard()},Ie=()=>{var e;uni.$UIKitStore.msgStore.removeReplyMsgActive(null==(e=null==L?void 0:L.value)?void 0:e.conversationId),U.value=!1},Te=()=>{if(!ie.value){if(B||z||O){const e=setTimeout(()=>{V.value=!0,h.value=!0,uni.$emit(N.ON_SCROLL_BOTTOM),clearTimeout(e)},300)}else V.value=!0,h.value=!0;$.value=!0,f.value=!1,C.value=!1,uni.$emit(N.ON_SCROLL_BOTTOM)}},_e=e=>{m.value+=e.key},ye=()=>{let e="";const t=Object.keys(Me).reduce((t,s)=>{const o=m.value.endsWith(s);return o&&(e=s),t||o},!1);m.value=t&&e?m.value.replace(e,""):m.value.slice(0,-1)},Se=g(!1);g(),uni.getSystemInfoSync(),g(100),g(100);const he=e=>{f.value=!0,e.stopPropagation(),e.preventDefault(),Se.value=!0,ie.value||(V.value=!1,setTimeout(()=>{uni.$emit(N.ON_SCROLL_BOTTOM)},300))},Ce=(e,t)=>{f.value=!1;const s=uni.$UIKitNIM.V2NIMMessageCreator.createAudioMessage(e,`audio_${e}`,"",t);uni.$UIKitStore.msgStore.sendMessageActive({msg:s,conversationId:d,progress:()=>!0,sendBefore:e=>{me(),uni.$UIKitStore.msgStore.addMsg(e.conversationId,[{...e,attachment:{duration:t}}])}}).then(()=>{me()}).catch(()=>{uni.showToast({icon:"error",title:y("sendAudioFailedText")}),me()})};let Ae=()=>{};const Ve=()=>{P.value=!0},Oe=g(!1);function xe(){const e=uni.$UIKitStore.userStore.myUserInfo,t=uni.$UIKitStore.teamMemberStore.getTeamMember(c.to,[e.accountId]);t.length>0&&(Oe.value=t[0].chatBanned||!1)}uni.$UIKitNIM.V2NIMLocalConversationService.on("onConversationChanged",e=>{e.forEach(e=>{e.type==v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&xe()})}),uni.$on(N.REPLY_MSG,e=>{U.value=!0,L.value=e,console.log(`${N.REPLY_MSG} events.REPLY_MSG`),O||Ve()}),uni.$on(N.ON_REEDIT_MSG,e=>{var t;const s=null==(t=c.replyMsgsMap)?void 0:t[e.messageClientId];if(e.conversationId&&(uni.$UIKitStore.msgStore.removeReplyMsgActive(e.conversationId),U.value=!1),(null==s?void 0:s.messageClientId)&&(s&&uni.$UIKitStore.msgStore.replyMsgActive(s),L.value=s,U.value=!0),e.serverExtension){const t=JSON.parse(e.serverExtension).yxAitMsg;if(t){const e=[];Object.keys(t).forEach(t=>{t==D?e.push({accountId:t,appellation:"所有人"}):e.push({accountId:t,appellation:uni.$UIKitStore.uiStore.getAppellation({account:t,teamId:c.to,ignoreAlias:!0})})}),G.value=e}}m.value=(null==e?void 0:e.oldText)||"",O||Ve()}),uni.$on(N.AIT_TEAM_MEMBER,e=>{G.value=[...G.value.filter(t=>t.accountId!==e.accountId),e],console.log(e,"member====");const t=m.value+"@"+e.accountId+" ";m.value=t}),uni.$on(N.CLOSE_PANEL,()=>{V.value=!1,h.value=!1,f.value=!1,C.value=!1}),uni.$on(N.HANDLE_AIT_MEMBER,e=>{(e=>{K.refs.popupRef.close(),uni.$emit(N.HANDLE_MOVE_THROUGH,!1);const t=e.accountId;G.value=[...G.value.filter(t=>t.accountId!==e.accountId),e],console.log("HANDLE_AIT_MEMBER",e);const s=m.value+t+" ";m.value=s})(e)}),uni.$on(N.CLOSE_AIT_POPUP,()=>{K.refs.popupRef.close()}),uni.$on(N.EMOJI_CLICK,e=>{_e(e)}),uni.$on(N.EMOJI_DELETE,()=>{ye()}),uni.$on(N.EMOJI_SEND,()=>{V.value=!1,h.value=!1,ve()}),p(()=>{(c.conversationType===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM||v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_SUPER_TEAM)&&xe(),Ae=I(()=>{if(c.conversationType===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM){const e=uni.$UIKitStore.teamStore.teams.get(c.to);te.value=uni.$UIKitStore.teamMemberStore.getTeamMember(c.to);const t=uni.$UIKitStore.userStore.myUserInfo;oe.value=(null==e?void 0:e.ownerAccountId)==t.accountId,ae.value=te.value.filter(e=>e.memberRole===v.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER).some(e=>e.accountId===(t?t.accountId:"")),ee.value=e,e&&(se.value=e.chatBannedMode),se.value!==v.V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN?oe.value||ae.value?ie.value=!1:ie.value=!0:ie.value=!1}}),uni.onKeyboardHeightChange&&uni.onKeyboardHeightChange(e=>{const t="android"==uni.getSystemInfoSync().platform&&B;(0===e.height&&z||0===e.height&&t)&&(V.value=!1,h.value=!1)})});const Re=()=>{let e;return G.value.length&&G.value.filter(e=>!(!le.value&&e.accountId===D)).forEach(t=>{var s,o;const a=`@${t.accountId}`,i=[];let n=null==(s=m.value)?void 0:s.indexOf(a);for(;-1!==n;)i.push(n),n=null==(o=m.value)?void 0:o.indexOf(a,n+1);i.length&&(e?e.yxAitMsg[t.accountId]={text:a,segments:[]}:e={yxAitMsg:{[t.accountId]:{text:a,segments:[]}}},i.forEach(s=>{const o=s;(null==e?void 0:e.yxAitMsg)[t.accountId].segments.push({start:o,end:o+a.length,broken:!1})}))}),e};return M(()=>{uni.$off(N.REPLY_MSG),uni.$off(N.ON_REEDIT_MSG),uni.$off(N.REPLY_MSG),uni.$off(N.AIT_TEAM_MEMBER),uni.$off(N.CLOSE_PANEL),uni.$off(N.HANDLE_AIT_MEMBER),uni.$off(N.CLOSE_AIT_POPUP),uni.$off(N.EMOJI_CLICK),uni.$off(N.EMOJI_DELETE),uni.$off(N.EMOJI_SEND),uni.$off("closeMore"),uni.$UIKitNIM.V2NIMLocalConversationService.off("onConversationChanged",()=>{}),Ie(),Ae()}),g(),g(!1),(i,r)=>{const g=X,p=j("el-button");return e(),T("div",null,[Oe.value?(e(),T("div",{key:0,class:"input-root"},[E("div",{class:"banned"},[E("span",{class:"default-text font-14",style:{color:"#999"}},"您已被禁言")])])):(e(),T("div",{key:1,class:"input-root"},[E("div",{class:"msg-input-wrapper"},[U.value?(e(),T("div",{key:0,class:"reply-message-wrapper"},[E("div",{class:"reply-message-close",onClick:Ie},[o(ge,{color:"#929299",iconStyle:{fontWeight:"200"},size:13,type:"icon-guanbi1"})]),E("div",{class:"reply-line"},"｜"),E("div",{class:"reply-title"},u(_(y)("replyText")),1),E("div",{class:"reply-to"},[o(Ee,{account:L.value&&L.value.senderId,"team-id":c.conversationType===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?i.to:"",color:"#929299",fontSize:13},null,8,["account","team-id"])]),E("div",{class:"reply-to-colon"},":"),L.value&&"noFind"===L.value.messageClientId?(e(),T("div",{key:0,class:"reply-noFind"},u(_(y)("replyNotFindText")),1)):(e(),T("div",{key:1,class:"reply-message"},[L.value&&L.value.messageType===_(v).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(e(),t(be,{key:0,text:L.value&&L.value.text},null,8,["text"])):(e(),T("div",{key:1},u(L.value?"["+_(x)[L.value.messageType]+"]":""),1))]))])):S("",!0),b.value?(e(),T("div",{key:1,class:"msg-input"},[n(E("div",{onClick:ce,class:"input-emoji"},[m.value?(e(),T("div",{key:0,class:"input-text"},u(m.value),1)):(e(),T("div",{key:1,class:"input-placeholder"},u(ie.value?_(y)("teamMutePlaceholder"):_(y)("chatInputPlaceHolder")),1))],512),[[l,$.value]]),E("div",{class:"flex-box flex-y-center",style:{position:"relative"}},[E("div",{class:"flex-box flex-y-center",style:{width:"100%",position:"relative"}},[n(o(fe,{path:"/static/emoji.png",width:"30px",height:"30px",onClick:Te,style:{"margin-right":"4px"}},null,512),[[l,!$.value]]),E("div",{style:{"min-height":"40px",width:"100%"}},[n(o(g,{focus:P.value,maxlength:-1,placeholder:ie.value?_(y)("teamMutePlaceholder"):_(y)("chatInputPlaceHolder"),modelValue:m.value,"onUpdate:modelValue":r[0]||(r[0]=e=>m.value=e),type:"text",disabled:ie.value,"confirm-hold":!0,"cursor-spacing":"20","adjust-position":"true","confirm-type":"send",onConfirm:ve,"auto-height":!0,onBlur:de,onInput:pe},null,8,["focus","placeholder","modelValue","disabled"]),[[l,!$.value]])]),n(o(fe,{path:"/static/action.png",width:"30px",height:"30px ",onClick:ue},null,512),[[l,!$.value]])]),m.value||V.value?m.value&&!V.value?(e(),t(p,{key:1,size:"mini",style:{background:"#DBB077",padding:"4px 8px","border-radius":"8px","margin-left":"4px","flex-shrink":"0"}},{default:s(()=>[E("span",{style:{"font-size":"13px",color:"#fff"},onClick:ve}," 发送 ")]),_:1})):S("",!0):(e(),T("div",{key:0,class:"flex-center",style:{width:"40px"},onClick:he},[o(fe,{path:"/static/audio1.png",width:"26px",height:"26px"})]))])])):S("",!0),V.value?(e(),T("div",{key:2,class:"msg-emoji-panel",onClick:a(()=>{},["stop"])},[o(Ue,{onEmojiClick:_e,onEmojiDelete:ye,onEmojiSend:ve})])):S("",!0),f.value?(e(),T("div",{key:3,class:"msg-audio-panel",onClick:a(()=>{},["stop"])},[o(Ke,{onHandleSendAudioMsg:Ce})])):S("",!0),C.value?(e(),T("div",{key:4,class:"send-more-panel",onClick:a(()=>{},["stop"])},[E("div",{class:"send-more-panel-item-wrapper"},[E("div",{class:"send-more-panel-item",onClick:r[1]||(r[1]=e=>i.handleSendVideoMsg("camera",e))},[o(ge,{type:"icon-paishe",size:30})]),E("div",{class:"icon-text"},u(_(y)("shootText")),1)]),E("div",{class:"send-more-panel-item-wrapper"},[E("div",{class:"send-more-panel-item",onClick:r[2]||(r[2]=e=>i.handleSendVideoMsg("album",e))},[o(ge,{type:"icon-shipin2",size:30})]),E("div",{class:"icon-text"},u(_(y)("albumText")),1)]),_(q)&&c.conversationType!==_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?(e(),T("div",{key:0,class:"send-more-panel-item-wrapper"},[E("div",{class:"send-more-panel-item",onClick:r[3]||(r[3]=e=>R(1))},[o(ge,{type:"icon-audio-call",size:30})]),E("div",{class:"icon-text"},u(_(y)("voiceCallText")),1)])):S("",!0),_(q)&&c.conversationType!==_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?(e(),T("div",{key:1,class:"send-more-panel-item-wrapper"},[E("div",{class:"send-more-panel-item",onClick:r[4]||(r[4]=()=>R(2))},[o(ge,{type:"icon-video-call",size:30})]),E("div",{class:"icon-text"},u(_(y)("videoCallText")),1)])):S("",!0),_(Q)?(e(),T("div",{key:2,class:"send-more-panel-item-wrapper",onClick:r[5]||(r[5]=(...e)=>i.handleSendFileMsg&&i.handleSendFileMsg(...e))},[E("div",{class:"send-more-panel-item"},[o(ge,{type:"icon-file",size:30})]),E("div",{class:"icon-text"},u(_(y)("fileText")),1)])):S("",!0)])):S("",!0)]),o(Ge,{mute:ie.value,"other-account-id":i.to,"conversation-type":i.conversationType,conversationId:_(d),show:w.value},null,8,["mute","other-account-id","conversation-type","conversationId","show"]),o(Ne,{ref_key:"popupRef",ref:Y,"background-color":"#ffffff",type:"bottom","mask-background-color":"rgba(0,0,0,0.4)",onChange:re},{default:s(()=>[o(Ye,{"team-id":i.to},null,8,["team-id"])]),_:1},512)]))])}}}),[["__scopeId","data-v-4bb067f8"]]),Be=me(m({__name:"MessageHeader",props:{conversationType:{},title:{},to:{},hideMenu:{type:Boolean,default:!0}},setup(s){const a=s,i=g(0);K(()=>{}),M(()=>{l()});const n=g(!1),l=I(()=>{var e,t;if(a.conversationType===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P){const s=null==(e=uni.$UIKitStore)?void 0:e.subscriptionStore.stateMap;s.get(a.to)&&uni.$UIKitStore.localOptions.loginStateVisible?n.value=(null==(t=s.get(a.to))?void 0:t.statusType)===v.V2NIMUserStatusType.V2NIM_USER_STATUS_TYPE_LOGIN:n.value=!1}}),c=()=>{ee({url:"/pages/Conversation/index"})};function d(){uni.hideKeyboard(),console.log("asdfasdfasdf"),a.conversationType===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P?h({url:`/pages/Chat/message/p2p-set?id=${a.to}`}):a.conversationType===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&h({url:`/pages/Team/team-set/index?id=${a.to}`})}return(s,l)=>(e(),T("div",{class:"message-header"},[E("div",{style:r({height:i.value+"px"}),class:"status-bar"},null,4),E("div",{class:"row"},[o(fe,{path:"/static/back.png",width:"21px",height:"21px",onClick:c}),E("span",null,u(a.title),1),a.conversationType===_(v).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P?(e(),T("span",{key:0},u(n.value?"(在线)":"(离线)"),1)):S("",!0),s.hideMenu?(e(),t(fe,{key:1,path:"/static/more.png",width:"19px",height:"5px",onClick:d})):S("",!0)])]))}}),[["__scopeId","data-v-68e1f131"]]),Fe=me(m({__name:"index",setup(t){function s(){uni.$emit("closeMore")}ue("ChatUIKit");const i=g(""),n=g(""),l=uni.$UIKitStore.uiStore.selectedConversation,r=g(),c=uni.$UIKitNIM.V2NIMConversationIdUtil.parseConversationType(l),d=uni.$UIKitNIM.V2NIMConversationIdUtil.parseConversationTargetId(l),m="web"===F(),h=g(!1),f=()=>{ee({url:"/pages/Conversation/index"})},C=uni.$UIKitStore.localOptions.teamMsgReceiptVisible,A=uni.$UIKitStore.localOptions.p2pMsgReceiptVisible,b=uni.$UIKitStore.localOptions.loginStateVisible;let O=!1;const x=g(!1),R=g(!1),k=g([]),$=g(),w=e=>{e.teamId===d&&uni.showModal({content:y("onDismissTeamText"),showCancel:!1,success(e){e.confirm&&f()}})},P=e=>{uni.showToast({title:y("onRemoveTeamText"),icon:"none",duration:1e3}).then(()=>{f()})},L=e=>{var t;const s=se(),o=s[s.length-1].route;e.length&&!(null==(t=e[0])?void 0:t.isSelf)&&e[0].conversationId==l&&(null==o?void 0:o.includes("Chat/index"))&&K(e),uni.$emit(N.ON_SCROLL_BOTTOM,e)},K=e=>{e[0].conversationType===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P&&A?uni.$UIKitStore.msgStore.sendMsgReceiptActive(e[0]):e[0].conversationType===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&C&&uni.$UIKitStore.msgStore.sendTeamMsgReceiptActive(e)},Y=e=>{if(c===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P&&A){const t=uni.$UIKitNIM.V2NIMLoginService.getLoginUser(),s=e.filter(e=>!["beReCallMsg","reCallMsg"].includes(e.recallType||"")).filter(e=>e.senderId!==t);s.length>0&&uni.$UIKitStore.msgStore.sendMsgReceiptActive(null==s?void 0:s[0])}else if(c===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&C){const t=uni.$UIKitNIM.V2NIMLoginService.getLoginUser(),s=e.filter(e=>!["beReCallMsg","reCallMsg"].includes(e.recallType||"")).filter(e=>e.senderId===t);uni.$UIKitStore.msgStore.getTeamMsgReadsActive(s,l);const o=e.filter(e=>!["beReCallMsg","reCallMsg"].includes(e.recallType||"")).filter(e=>e.senderId!==t);o.length>0&&o.length<50&&uni.$UIKitStore.msgStore.sendTeamMsgReceiptActive(o)}},D=async(e,t)=>{try{if(R.value)return[];if(x.value)return[];if(x.value=!0,l){const s=await uni.$UIKitStore.msgStore.getHistoryMsgActive({conversationId:l,endTime:e,lastMsgId:t,limit:oe});return await uni.$UIKitStore.msgStore.getPinnedMessageListActive(l),x.value=!1,s.length<oe&&(R.value=!0),Y(s),s}}catch(s){throw 109404===s.code&&uni.showModal({content:y("onDismissTeamText"),showCancel:!1,success(e){e.confirm&&f()}}),x.value=!1,s}},B=g(!0),z=e=>{B.value=!1,s(),e?D(e.createTime,e.messageServerId):D(Date.now())},j=()=>{var e,t;if(c===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P)b&&(n.value=(null==(t=null==(e=uni.$UIKitStore)?void 0:e.subscriptionStore.stateMap.get(d))?void 0:t.statusType)===v.V2NIMUserStatusType.V2NIM_USER_STATUS_TYPE_LOGIN?`(${y("userOnlineText")})`:`(${y("userOfflineText")})`),i.value=uni.$UIKitStore.uiStore.getAppellation({account:d});else if(c===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM){const e=uni.$UIKitStore.teamStore.teams.get(d);n.value=`(${(null==e?void 0:e.memberCount)||0})`,i.value=(null==e?void 0:e.name)||""}},H=I(()=>{j()}),W=I(()=>{uni.$UIKitStore.connectStore.connectStatus===v.V2NIMConnectStatus.V2NIM_CONNECT_STATUS_CONNECTED&&uni.$UIKitStore.connectStore.loginStatus==v.V2NIMLoginStatus.V2NIM_LOGIN_STATUS_LOGINED&&D(Date.now()).then(()=>{O||(uni.$emit(N.ON_SCROLL_BOTTOM),O=!0)})}),J=I(()=>{const e=[...uni.$UIKitStore.msgStore.getMsg(l)];0!==e.length&&(k.value=e),(e=>{if(0!==e.length){const e={},t={},s=[],o=[],a={};k.value.forEach(i=>{if(i.serverExtension)try{const{yxReplyMsg:t}=JSON.parse(i.serverExtension);if(t){const o=k.value.find(e=>e.messageClientId===t.idClient);if(o)e[i.messageClientId]=o;else{e[i.messageClientId]={messageClientId:"noFind"};const{scene:o,from:n,to:l,idServer:r,messageClientId:c,time:u,receiverId:d}=t;o&&n&&l&&r&&c&&u&&d&&(s.push({scene:o,from:n,to:l,idServer:r,messageClientId:c,time:u,receiverId:d}),a[r]=i.messageClientId)}}}catch{}if(i.threadReply){const e=k.value.find(e=>{var t;return e.messageClientId===(null==(t=i.threadReply)?void 0:t.messageClientId)});e?t[i.messageClientId]=e:(t[i.messageClientId]={messageClientId:"noFind"},a[i.threadReply.messageServerId]=i.messageClientId,o.push(i.threadReply))}}),s.length>0&&uni.$UIKitNIM.V2NIMMessageService.getMessageListByRefers(s.map(e=>({senderId:e.from,receiverId:e.receiverId,messageClientId:e.messageClientId,messageServerId:e.idServer,createTime:e.time,conversationType:e.scene,conversationId:e.to}))).then(t=>{(null==t?void 0:t.length)>0&&t.forEach(t=>{t.messageServerId&&(e[a[t.messageServerId]]=t)}),$.value={...e}}).catch(()=>{$.value={...e}}),$.value={...$.value,...t},o.length>0&&uni.$UIKitNIM.V2NIMMessageService.getMessageListByRefers(o).then(e=>{(null==e?void 0:e.length)>0&&e.forEach(e=>{e.messageServerId&&(t[a[e.messageServerId]]=e)}),$.value={...$.value,...t}}).catch(e=>{$.value={...$.value,...t}})}})(e),e.length<6&&uni.hideKeyboard()}),X=I(()=>{var e,t;const s=null==(e=uni.$UIKitStore)?void 0:e.subscriptionStore.stateMap;uni.$UIKitStore.localOptions.loginStateVisible&&c===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P&&(n.value=(null==(t=s.get(d))?void 0:t.statusType)===v.V2NIMUserStatusType.V2NIM_USER_STATUS_TYPE_LOGIN?`(${y("userOnlineText")})`:`(${y("userOfflineText")})`)});ie(function(){if(j(),k.value.length){const e=[...k.value].reverse();Y(e)}}),ne(()=>{uni.$on(N.HANDLE_MOVE_THROUGH,e=>{h.value=e})});const q=I(()=>{d&&(r.value=uni.$UIKitStore.teamStore.teams.get(d),console.log(r.value,"team value===="))});return p(()=>{j(),(()=>{const e=setTimeout(()=>{uni.$emit(N.ON_SCROLL_BOTTOM),clearTimeout(e)},300)})(),b&&c===v.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P&&uni.$UIKitStore.subscriptionStore.subscribeUserStatusActive([d]),uni.$UIKitNIM.V2NIMMessageService.on("onReceiveMessages",L),uni.$UIKitNIM.V2NIMTeamService.on("onTeamDismissed",w),uni.$UIKitNIM.V2NIMTeamService.on("onTeamLeft",P),uni.$on(N.GET_HISTORY_MSG,z)}),M(()=>{q(),uni.$UIKitNIM.V2NIMTeamService.off("onTeamDismissed",w),uni.$UIKitNIM.V2NIMTeamService.off("onTeamLeft",P),uni.$UIKitNIM.V2NIMMessageService.off("onReceiveMessages",L),uni.$off(N.GET_HISTORY_MSG,z),uni.$off("open-team-call"),W(),J(),X(),H()}),G({isCurrentTeam:!1}),le(()=>{uni.hideKeyboard()}),re(()=>{uni.$off(N.CONFIRM_FORWARD_MSG),uni.$off(N.CANCEL_FORWARD_MSG)}),(t,n)=>{const l=ce(te("page-meta"),ae);return e(),T(V,null,[o(l,{"page-style":"overflow:"+(h.value?"hidden":"visible")},null,8,["page-style"]),E("div",{class:U(m?"msg-page-wrapper-h5":"msg-page-wrapper")},[o(Be,{title:i.value,"conversation-type":_(c),to:_(d),onClick:a(s,["stop"])},null,8,["title","conversation-type","to"]),r.value?(e(),T("div",{key:0,class:"announcement",onClick:a(s,["stop"])},[o(fe,{path:"/static/gonggao.png",width:"14px",height:"14px",style:{"margin-right":"4px"}}),E("span",{style:{flex:"1"}},u(r.value.announcement),1)])):S("",!0),E("div",{class:U(m?"msg-wrapper-h5":"msg-wrapper"),onClick:a(s,["stop"])},[o(we,{conversationType:_(c),to:_(d),msgs:k.value,"loading-more":x.value,"no-more":R.value,"reply-msgs-map":$.value},null,8,["conversationType","to","msgs","loading-more","no-more","reply-msgs-map"])],2),E("div",{style:{height:"'auto'"}},[o(De,{"reply-msgs-map":$.value,"conversation-type":_(c),to:_(d),onChangeState:t.changeState,"show-more":B.value},null,8,["reply-msgs-map","conversation-type","to","onChangeState","show-more"])])],2)],64)}}}),[["__scopeId","data-v-c96b50b9"]]);export{Fe as default};
