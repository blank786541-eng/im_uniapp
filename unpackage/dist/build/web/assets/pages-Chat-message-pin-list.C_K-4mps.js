import{d as e,c as s,o as a,a as t,k as n,e as i,u as o,E as r,t as l,f as m,x as p,b as d,p as g,a3 as c,y as u,g as I,h as T,j as v,v as M,l as _,F as y,r as E,n as N}from"./index-CA_4_S1o.js";import{b as f}from"./uni-app.es.f5Xd5cz1.js";import{N as C}from"./NavBar.B_pGq4kd.js";import{A as V}from"./Avatar.cDMQ39ID.js";import{I as h}from"./Icon.DO2Wg01x.js";import{_ as x}from"./Appellation.vue_vue_type_script_setup_true_lang.Bn2FxhVA.js";import{d as w}from"./dayjs.min.CwOgZug2.js";import{a as S,M as A}from"./message-file.BFObQXzu.js";import{M as P}from"./message-text.6ab8ngmM.js";import{_ as Y}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as $}from"./Empty.DhhBt1kg.js";import"./emoji.SrFHKbUG.js";const U=Y(e({__name:"message-pin-card",props:{msg:{},handleUnPinMsg:{}},setup(e){const I=e,T=uni.$UIKitNIM.V2NIMConversationIdUtil.parseConversationType(I.msg.conversationId),v=uni.$UIKitNIM.V2NIMConversationIdUtil.parseConversationTargetId(I.msg.conversationId),M=async()=>{await uni.$UIKitStore.uiStore.selectConversation(I.msg.conversationId),p({url:"/pages/Chat/index"})},_=()=>{let e=[d("unpinText")];I.msg.messageType===r.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?e=e.concat([d("copyText"),d("forwardToTeamText"),d("forwardToFriendText")]):I.msg.messageType!==r.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO&&(e=e.concat([d("forwardToTeamText"),d("forwardToFriendText")])),uni.showActionSheet({itemList:e,success(e){I.msg.messageType===r.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?0===e.tapIndex?I.handleUnPinMsg():1===e.tapIndex?uni.setClipboardData({data:I.msg.text||"",showToast:!1,success:()=>{uni.showToast({title:d("copySuccessText"),icon:"none"})},fail:()=>{uni.showToast({title:d("copyFailText"),icon:"none"})}}):2===e.tapIndex?g({url:`/pages/Chat/forward?forwardConversationType=${r.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM}&msgIdClient=${I.msg.messageClientId}&origin=pin`}):3===e.tapIndex&&g({url:`/pages/Chat/forward?forwardConversationType=${r.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P}&msgIdClient=${I.msg.messageClientId}&origin=pin`}):I.msg.messageType!==r.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO?0===e.tapIndex?I.handleUnPinMsg():1===e.tapIndex?g({url:`/pages/Chat/forward?forwardConversationType=${r.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM}&msgIdClient=${I.msg.messageClientId}&origin=pin`}):2===e.tapIndex&&g({url:`/pages/Chat/forward?forwardConversationType=${r.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P}&msgIdClient=${I.msg.messageClientId}&origin=pin`}):0===e.tapIndex&&I.handleUnPinMsg()},complete(){}})},y=s(()=>{var e,s,a;return(null==(s=null==(e=I.msg)?void 0:e.attachment)?void 0:s.url)||(null==(a=I.msg.attachment)?void 0:a.file)}),E=s(()=>{var e;const s=null==(e=I.msg.attachment)?void 0:e.url;return s?`${s}${s.includes("?")?"&":"?"}vframe&offset=1`:""}),N=()=>{const e=I.msg.createTime;return(e=>{const s=new Date(e),a=new Date;return s.getFullYear()===a.getFullYear()&&s.getMonth()===a.getMonth()&&s.getDate()===a.getDate()})(e)?w(e).format("HH:mm"):(e=>{const s=new Date(e),a=new Date;return s.getFullYear()===a.getFullYear()})(e)?w(e).format("MM月DD日 HH:mm"):w(e).format("YYYY年MM月DD日 HH:mm")};return(e,s)=>{const p=u;return a(),t("div",{class:"pincard-wrapper"},[n("div",{class:"info-wrapper"},[n("div",{class:"info",onClick:M},[n("div",{class:"info-left"},[i(V,{size:"32",account:I.msg.senderId},null,8,["account"])]),n("div",{class:"info-right"},[n("div",{class:"name"},[i(x,{account:I.msg.senderId,teamId:o(T)===o(r).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?o(v):""},null,8,["account","teamId"])]),n("div",{class:"createtime"},l(N()),1)])]),i(h,{type:"icon-More",onClick:_})]),n("div",{class:"content-wrapper"},[e.msg.messageType===o(r).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(a(),t("div",{key:0,class:"msg-text"},[i(P,{msg:I.msg},null,8,["msg"])])):m("",!0),n("div",{class:"file-wrapper"},[e.msg.messageType===o(r).V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE?(a(),t("div",{key:0},[n("div",{onClick:s[0]||(s[0]=()=>{var e;(e=I.msg.attachment.url)&&uni.previewImage({urls:[e]})})},[i(p,{class:"msg-image","lazy-load":!0,mode:"aspectFill",src:y.value},null,8,["src"])])])):I.msg.messageType===o(r).V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO?(a(),t("div",{key:1},[n("div",{class:"video-msg-wrapper",onClick:s[1]||(s[1]=()=>(e=>{var s;c();const a=null==(s=e.attachment)?void 0:s.url;a&&g({url:`/pages/Chat/video-play?videoUrl=${encodeURIComponent(a)}`})})(I.msg))},[n("div",{class:"video-play-button"},[n("div",{class:"video-play-icon"})]),i(p,{class:"msg-image","lazy-load":!0,mode:"aspectFill",src:E.value},null,8,["src"])])])):I.msg.messageType===o(r).V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE?(a(),t("div",{key:2,class:"extra"},[i(S,{msg:I.msg},null,8,["msg"])])):I.msg.messageType===o(r).V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO?(a(),t("div",{key:3},[n("div",{class:"audio-wrapper"},[i(A,{msg:I.msg,mode:"audio-in"},null,8,["msg"])])])):m("",!0)])])])}}}),[["__scopeId","data-v-4f8c01a1"]]),k=Y(e({__name:"pin-list",setup(e){let s="",r=I([]),m=()=>{};f(e=>{s=null==e?void 0:e.conversationId,m=T(()=>{const e=uni.$UIKitStore.msgStore.pinMsgs.map.get(s);r.value=[...e.values()].filter(e=>e.pinState>0&&e.message).sort((e,s)=>s.message.createTime-e.message.createTime)})});return v(()=>{m()}),(e,s)=>(a(),t("div",{class:N("wrapper "+(0===o(r).length?"bg-white":""))},[i(C,{title:o(d)("pinText")},{left:M(()=>[n("div",{class:"nav-bar-text",onClick:s[0]||(s[0]=(...s)=>e.back&&e.back(...s))},l(o(d)("pinText")),1)]),_:1},8,["title"]),n("div",{class:"pinCard-item-wrapper"},[0===o(r).length?(a(),_($,{key:0,text:o(d)("noPinListText")},null,8,["text"])):(a(!0),t(y,{key:1},E(o(r),(e,s)=>{return a(),t("div",{key:e.message.messageClientId},[(a(),_(U,{msg:e.message,index:s,key:e.message.messageClientId,handleUnPinMsg:(n=e.message,()=>uni.$UIKitStore.msgStore.unpinMessageActive(n).catch(e=>{(null==e?void 0:e.code)&&void 0!==d(`${e.code}`)?uni.showToast({title:d(`${e.code}`),icon:"error",duration:1e3}):uni.showToast({title:d("unpinFailedText"),icon:"error",duration:1e3})}))},null,8,["msg","index","handleUnPinMsg"]))]);var n}),128))])],2))}}),[["__scopeId","data-v-72bb7eb8"]]);export{k as default};
