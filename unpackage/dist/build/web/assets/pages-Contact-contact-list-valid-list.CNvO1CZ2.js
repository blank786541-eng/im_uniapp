import{d as t,g as a,h as e,j as i,q as n,o as s,a as c,e as l,u as o,k as d,l as u,F as r,r as v,b as p,E as I,t as m,f as A,s as S,m as y}from"./index-CA_4_S1o.js";import{E as g}from"./Empty.DhhBt1kg.js";import{A as T}from"./Avatar.cDMQ39ID.js";import{N as M}from"./NavBar.B_pGq4kd.js";import{I as _}from"./Icon.DO2Wg01x.js";import{_ as f}from"./Appellation.vue_vue_type_script_setup_true_lang.Bn2FxhVA.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=U(t({__name:"valid-list",setup(t){const U=a([]),x=a([]),k=a(!1),$=t=>t.applicantAccountId===uni.$UIKitStore.userStore.myUserInfo.accountId;function K(t){uni.$UIKitStore.sysMsgStore.setAllApplyMsgRead(),uni.$UIKitStore.sysMsgStore.updateFriendApplyMsg([{operatorAccountId:uni.$UIKitStore.userStore.myUserInfo.accountId,applicantAccountId:t,recipientAccountId:uni.$UIKitStore.userStore.myUserInfo.accountId,timestamp:Date.now(),status:1,isRead:!0,read:!0}])}const j=e(()=>{var t,a,e,i,n,s;U.value=null==(t=uni.$UIKitStore)?void 0:t.sysMsgStore.friendApplyMsgs,x.value=null==(a=uni.$UIKitStore)?void 0:a.sysMsgStore.teamJoinActionMsgs,console.log(U.value),console.log("validMsg.value"),console.log(x.value),null==(i=null==(e=uni.$UIKitStore)?void 0:e.sysMsgStore.friendApplyMsgs)||i.map(t=>{var a;null==(a=uni.$UIKitStore)||a.userStore.getUserActive(t.applicantAccountId)}),null==(s=null==(n=uni.$UIKitStore)?void 0:n.sysMsgStore.teamJoinActionMsgs)||s.map(t=>{var a;null==(a=uni.$UIKitStore)||a.teamStore.getTeamActive(t.teamId)})});return i(()=>{j()}),n(()=>{uni.$UIKitStore.sysMsgStore.setAllApplyMsgRead()}),(t,a)=>(s(),c("div",{class:"valid-list-container"},[l(M,{title:o(p)("validMsgText")},null,8,["title"]),d("div",{class:"valid-list-content"},[0===U.value.length&&0==x.value.length?(s(),u(g,{key:0,text:o(p)("validEmptyText")},null,8,["text"])):(s(),c(r,{key:1},[(s(!0),c(r,null,v(U.value,t=>(s(),c("div",{class:"valid-item",key:t.timestamp},[t.status===o(I).V2NIMFriendAddApplicationStatus.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED?(s(),c(r,{key:0},[d("div",{class:"valid-item-left"},[l(T,{account:t.applicantAccountId},null,8,["account"]),d("div",{class:"valid-name-container"},[d("div",{class:"valid-name"},[l(f,{account:t.applicantAccountId},null,8,["account"])]),d("div",{class:"valid-action"},m(o(p)("applyFriendText")),1)])]),d("div",{class:"valid-state"},[l(_,{type:"icon-yidu"}),d("span",{class:"valid-state-text"},m(o(p)("acceptResultText")),1)])],64)):t.status===o(I).V2NIMFriendAddApplicationStatus.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED?(s(),c(r,{key:1},[$(t)?(s(),c("div",{key:0,class:"valid-item-left"},[l(T,{account:t.recipientAccountId},null,8,["account"]),d("div",{class:"valid-name-container"},[d("div",{class:"valid-name"},[l(f,{account:t.recipientAccountId},null,8,["account"])]),d("div",{class:"valid-action"},m(o(p)("beRejectResultText")),1)])])):(s(),c(r,{key:1},[d("div",{class:"valid-item-left"},[l(T,{account:t.applicantAccountId},null,8,["account"]),d("div",{class:"valid-name-container"},[d("div",{class:"valid-name"},[l(f,{account:t.applicantAccountId},null,8,["account"])]),d("div",{class:"valid-action"},m(o(p)("applyFriendText")),1)])]),d("div",{class:"valid-state"},[l(_,{type:"icon-shandiao"}),d("span",{class:"valid-state-text"},m(o(p)("rejectResultText")),1)])],64))],64)):t.status===o(I).V2NIMFriendAddApplicationStatus.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT?(s(),c(r,{key:2},[$(t)?A("",!0):(s(),c(r,{key:0},[d("div",{class:"valid-item-left"},[l(T,{account:t.applicantAccountId},null,8,["account"]),d("div",{class:"valid-name-container"},[d("div",{class:"valid-name"},[l(f,{account:t.applicantAccountId},null,8,["account"])]),d("div",{class:"valid-action"},m(o(p)("applyFriendText")),1)])]),d("div",{class:"valid-buttons"},[d("div",{class:"valid-button button-reject",onClick:a=>(async t=>{k.value=!0,K(t.applicantAccountId);try{await uni.$UIKitStore.friendStore.rejectAddApplicationActive(t),uni.showToast({title:p("rejectedText"),icon:"none"})}catch(a){uni.showToast({title:p("rejectFailedText"),icon:"error"})}finally{uni.$UIKitStore.sysMsgStore.setAllApplyMsgRead(),k.value=!1}})(t),loading:k.value},m(o(p)("rejectText")),9,["onClick","loading"]),d("div",{class:"valid-button button-accept",onClick:a=>(async t=>{k.value=!0,K(t.applicantAccountId);try{try{await uni.$UIKitStore.friendStore.acceptAddApplicationActive(t),uni.showToast({title:p("acceptedText"),icon:"none"})}catch(a){uni.showToast({title:p("acceptFailedText"),icon:"error"})}const e=uni.$UIKitNIM.V2NIMMessageCreator.createTextMessage(p("passFriendAskText"));await uni.$UIKitStore.msgStore.sendMessageActive({msg:e,conversationId:uni.$UIKitNIM.V2NIMConversationIdUtil.p2pConversationId(t.operatorAccountId)})}catch(a){console.log("error",a)}finally{k.value=!1}})(t),loading:k.value},m(o(p)("acceptText")),9,["onClick","loading"])])],64))],64)):A("",!0)]))),128)),(s(!0),c(r,null,v(x.value,t=>(s(),c("div",{class:"valid-item",key:t.timestamp},[l(T,{account:t.teamId},null,8,["account"]),d("div",{class:"valid-name-container"},[d("div",{class:"valid-name"},[l(f,{"team-id":t.teamId,account:t.teamId},null,8,["team-id","account"]),d("span",{style:{color:"red"}},"(群聊)")]),d("div",{class:"valid-action"},m(t.postscript),1)]),0==t.actionStatus?(s(),c("div",{key:0,class:"valid-buttons"},[d("div",{class:"valid-button button-reject",onClick:a=>async function(t){S(),y(),uni.showModal({title:"提示",content:"拒绝加入群聊吗",showCancel:!0,success:async function(a){a.confirm?(t.read=!0,t.actionStatus=2,await uni.$UIKitStore.teamStore.rejectTeamInviteActive(t)):a.cancel&&console.log("用户点击取消")}})}(t),loading:k.value},m(o(p)("rejectText")),9,["onClick","loading"]),d("div",{class:"valid-button button-accept",onClick:a=>async function(t){t.read=!0,t.actionStatus=1,S(),y(),await uni.$UIKitStore.teamStore.acceptTeamInviteActive(t),await uni.$UIKitStore.teamStore.updateTeamActive(t),uni.showToast({title:"已加入群聊"})}(t),loading:k.value},m(o(p)("acceptText")),9,["onClick","loading"])])):(s(),c("div",{key:1,class:"valid-buttons"},[d("div",{class:"valid-button button-reject"},m(1==t.actionStatus?"已同意":2==t.actionStatus?"已拒绝":"已过期"),1)]))]))),128))],64))])]))}}),[["__scopeId","data-v-1faf19a6"]]);export{x as default};
