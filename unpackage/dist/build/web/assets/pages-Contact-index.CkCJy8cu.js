import{d as t,c as e,o as s,a,G as i,t as n,f as o,k as l,g as c,h as r,E as u,j as d,e as p,u as v,w as f,l as g,b as m,F as I,r as S,x,p as y,s as U,m as h}from"./index-CA_4_S1o.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{o as C,a as K}from"./uni-app.es.f5Xd5cz1.js";import{f as M}from"./friend.CuoyITGk.js";import{E as $}from"./Empty.DhhBt1kg.js";import{A as k}from"./Avatar.cDMQ39ID.js";import{t as A}from"./reporter.BDLo06V-.js";import{H as b}from"./HeaderInput.NhHrJsao.js";import{A as N}from"./AssetsImage.D01ldk7e.js";import"./Icon.DO2Wg01x.js";const T=_(t({__name:"Badge",props:{num:{},max:{default:99},dot:{type:Boolean,default:!1},customStyle:{}},setup(t){const c=t,r=c.max||99,u=e(()=>c.num>0?c.num>r?`${r}+`:c.num+"":"");return(t,e)=>(s(),a("div",null,[t.dot?(s(),a("div",{key:0,class:"dot",style:i(t.customStyle)},null,4)):u.value?(s(),a("div",{key:1,class:"badge",style:i(t.customStyle)},n(u.value),5)):o("",!0),l("div",{class:"hidden"},n(c.num),1)]))}}),[["__scopeId","data-v-5f6ef273"]]),j=_(t({__name:"friend-item",props:{friend:{}},emits:["click"],setup(t,{emit:e}){const i=t,f=e,g=c(!1),m=()=>{f("click")},I=uni.$UIKitStore.localOptions.loginStateVisible,S=r(()=>{var t,e;const s=null==(t=uni.$UIKitStore)?void 0:t.subscriptionStore.stateMap;uni.$UIKitStore.localOptions.loginStateVisible&&(g.value=(null==(e=s.get(i.friend.accountId))?void 0:e.statusType)===u.V2NIMUserStatusType.V2NIM_USER_STATUS_TYPE_LOGIN)});return d(()=>{S()}),(t,e)=>(s(),a("div",{class:"friend-item-container",onClick:m},[l("div",{class:"friend-avatar",style:{position:"relative"}},[p(k,{account:t.friend.accountId},null,8,["account"]),v(I)&&g.value?(s(),a("div",{key:0,class:"login-state-icon"})):o("",!0),v(I)&&!g.value?(s(),a("div",{key:1,class:"unlogin-state-icon"})):o("",!0)]),l("div",{class:"default-text font-15",style:{"margin-left":"21px"}},n(t.friend.appellation),1)]))}}),[["__scopeId","data-v-e4ff26f7"]]),V=_(t({__name:"index",setup(t){const e=c([]),i=c([]),y=uni.$UIKitStore.localOptions.loginStateVisible;const U=r(()=>{const t=uni.$UIKitStore.uiStore.friends.filter(t=>!uni.$UIKitStore.relationStore.blacklist.includes(t.accountId)).map(t=>({accountId:t.accountId,appellation:uni.$UIKitStore.uiStore.getAppellation({account:t.accountId})}));i.value=t.map(t=>t.accountId),e.value=M(t,{firstKey:"appellation"},!1)}),h=r(()=>{var t;(null==(t=uni.$UIKitStore)?void 0:t.connectStore.connectStatus)===u.V2NIMConnectStatus.V2NIM_CONNECT_STATUS_CONNECTED&&_(i.value)}),_=t=>{var e;if(y){const s=100,a=t.length;for(let i=0;i<a;i+=s){const a=t.slice(i,i+s);a.length>0&&(null==(e=uni.$UIKitStore)||e.subscriptionStore.subscribeUserStatusActive(a))}}};return f(()=>i.value.length,()=>{_(i.value)}),C(()=>{i.value.length&&_(i.value)}),d(()=>{U(),h()}),(t,i)=>(s(),a("div",{class:"friend-list-container"},[l("div",{class:"friend-group-list"},[0===e.value.length?(s(),g($,{key:0,text:v(m)("noFriendText")},null,8,["text"])):o("",!0),(s(!0),a(I,null,S(e.value,t=>(s(),a("div",{class:"friend-group-item",key:t.key},[l("div",{class:"friend-group-title"},n(t.key),1),(s(!0),a(I,null,S(t.data,t=>(s(),a("div",{class:"friend-item",key:t.accountId},[p(j,{friend:t,onClick:e=>async function(t){const e=uni.$UIKitNIM.V2NIMConversationIdUtil.p2pConversationId(t.accountId||"");await uni.$UIKitStore.uiStore.selectConversation(e),x({url:"/pages/Chat/index"})}(t)},null,8,["friend","onClick"])]))),128))]))),128))])]))}}),[["__scopeId","data-v-eadf1cb8"]]),w=_(t({__name:"index",setup(t){const e=c([]),i=c(!1),n=c(0),o=c();r(()=>{o.value=uni.$UIKitStore.userStore.myUserInfo});let u=()=>{};const v=()=>{var t;null==(t=uni.$UIKitStore)||t.sysMsgStore.setAllApplyMsgRead(),y({url:"/pages/Contact/contact-list/valid-list"})},f=()=>{y({url:"/pages/Contact/contact-list/black-list"})},g=t=>{y({url:`/pages/Contact/contact-list/group-list?type=${t}`})};A("ContactUIKit"),C(()=>{u=r(()=>{var t;n.value=null==(t=uni.$UIKitStore)?void 0:t.sysMsgStore.getTotalUnreadMsgsCount()})});return r(()=>{var t,s,a,i;const n="on"===uni.getStorageSync((null==(t=o.value)?void 0:t.accountId)+"autoAddFriends");e.value=null==(s=uni.$UIKitStore)?void 0:s.sysMsgStore.friendApplyMsgs,n?e.value.forEach(t=>{(async t=>{try{await uni.$UIKitStore.friendStore.acceptAddApplicationActive(t);const e=uni.$UIKitNIM.V2NIMMessageCreator.createTextMessage(m("passFriendAskText"));await uni.$UIKitStore.msgStore.sendMessageActive({msg:e,conversationId:uni.$UIKitNIM.V2NIMConversationIdUtil.p2pConversationId(t.operatorAccountId)}),uni.$UIKitStore.sysMsgStore.setAllApplyMsgRead()}catch(e){console.log("error",e)}})(t)}):null==(i=null==(a=uni.$UIKitStore)?void 0:a.sysMsgStore.friendApplyMsgs)||i.map(t=>{var e;null==(e=uni.$UIKitStore)||e.userStore.getUserActive(t.applicantAccountId)})}),d(()=>{u()}),K(()=>{i.value=!1,u()}),(t,e)=>(s(),a("div",{class:"contact-list-container"},[p(b,{label:"通讯录"}),l("div",{class:"contact-list"},[l("div",{class:"contact-item-content"},[l("div",{class:"contact-item",onClick:v},[l("div",{class:"flex-box flex-y-center"},[p(N,{path:"/static/new.png",width:"46px",height:"46px",style:{"margin-right":"21px"}}),p(T,{num:n.value,style:{position:"absolute",top:"5px",left:"45px"}},null,8,["num"]),l("span",{class:"default-text font-15"}," 新朋友")])]),l("div",{class:"contact-item",onClick:e[0]||(e[0]=t=>g(1))},[l("div",{class:"flex-box flex-y-center"},[p(N,{path:"/static/group.png",width:"46px",height:"46px",style:{"margin-right":"21px"}}),l("span",{class:"default-text font-15"}," 我的群聊")])]),l("div",{class:"contact-item",onClick:e[1]||(e[1]=t=>g(2))},[l("div",{class:"flex-box flex-y-center"},[p(N,{path:"/static/super.png",width:"46px",height:"46px",style:{"margin-right":"21px"}}),l("span",{class:"default-text font-15"}," 我的超级群聊")])]),l("div",{class:"contact-item",onClick:e[2]||(e[2]=(...t)=>f&&f(...t))},[l("div",{class:"flex-box flex-y-center"},[p(N,{path:"/static/black.png",width:"46px",height:"46px",style:{"margin-right":"21px"}}),l("span",{class:"default-text font-15"}," 黑名单")])])]),p(V)])]))}}),[["__scopeId","data-v-729df540"]]),E=_(t({__name:"index",setup:t=>(C(()=>{U(),h()}),(t,e)=>(s(),g(w)))}),[["__scopeId","data-v-7c1e2ec8"]]);export{E as default};
