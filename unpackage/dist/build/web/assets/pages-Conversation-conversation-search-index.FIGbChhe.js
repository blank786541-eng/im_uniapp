import{d as e,c as t,o as i,a,k as s,e as l,t as r,E as n,p as o,b as u,g as d,h as c,q as v,j as m,u as p,F as f,r as I,f as h}from"./index-CA_4_S1o.js";import{A as g}from"./Avatar.cDMQ39ID.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as S}from"./Empty.DhhBt1kg.js";import{D as _}from"./defaultHeader.BLoWIqPs.js";import{S as x}from"./search-input.CZNuPT7x.js";import"./AssetsImage.D01ldk7e.js";const T=y(e({__name:"search-result-item",props:{item:{}},setup(e){var d,c;const v=e,m=t(()=>{if(v.item.teamId)return v.item.avatar}),p=null==(c=null==(d=uni.$UIKitStore)?void 0:d.sdkOptions)?void 0:c.enableV2CloudConversation,f=t(()=>v.item.teamId?v.item.teamId:v.item.accountId),I=t(()=>!!v.item.teamId),h=t(()=>v.item.teamId?v.item.name:"");let y=!1;const S=async()=>{var e,t;if(!y)try{let i,a;y=!0;let s=v.item;if(s.accountId)i=n.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P,a=s.accountId;else{if(!s.teamId)throw Error("unknow scene");i=n.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM,a=s.teamId}p?await(null==(e=uni.$UIKitStore.conversationStore)?void 0:e.insertConversationActive(i,a)):await(null==(t=uni.$UIKitStore.localConversationStore)?void 0:t.insertConversationActive(i,a)),o({url:"/pages/Chat/index"})}catch{uni.showToast({title:u("selectSessionFailText"),icon:"error"})}finally{y=!1}};return(e,t)=>(i(),a("div",{class:"search-result-list-item",onClick:S},[s("div",{class:"result-item-avatar"},[l(g,{account:f.value,avatar:m.value},null,8,["account","avatar"])]),s("div",{class:"result-item-title"},[s("div",null,r(I.value?h.value:f.value),1),s("div",{class:"result-item-account"},r(f.value),1)])]))}}),[["__scopeId","data-v-1c60db5d"]]),C=y(e({__name:"index",setup(e){const t=d(!1),n=d(""),o=d([]),g=c(()=>{});function y(e){const t=uni.$UIKitStore.uiStore.friends.filter(e=>!uni.$UIKitStore.relationStore.blacklist.includes(e.accountId)).map(e=>{const t=uni.$UIKitStore.userStore.users.get(e.accountId)||{accountId:"",name:"",createTime:Date.now()};return{...e,...t}})||[],i=uni.$UIKitStore.uiStore.teamList.filter(t=>t.teamId.indexOf(e)>-1||t.name.indexOf(e)>-1||t.ownerAccountId.indexOf(e)>-1)||[];o.value=[{id:"friends",list:t},{id:"groups",list:i}].filter(e=>!!e.list.length),console.log(o.value),C.value=function(e){const t=[],i=o.value.map(t=>{var i,a,s;return"friends"===t.id?{...t,list:null==(i=t.list)?void 0:i.filter(t=>{var i,a,s;return(null==(i=t.alias)?void 0:i.includes(e))||(null==(a=t.name)?void 0:a.includes(e))||(null==(s=t.accountId)?void 0:s.includes(e))})}:"groups"===t.id?{...t,list:null==(a=t.list)?void 0:a.filter(t=>(t.name||t.teamId).includes(e))}:"discussions"===t.id?{...t,list:null==(s=t.list)?void 0:s.filter(t=>(t.name||t.teamId).includes(e))}:{...t}}).filter(e=>{var t;return!!(null==(t=e.list)?void 0:t.length)});return i.forEach(e=>{"friends"===e.id?(t.push({title:"friends",renderKey:"friends"}),e.list.forEach(e=>{t.push({...e,renderKey:e.accountId})})):"groups"===e.id&&(t.push({title:"groups",renderKey:"groups"}),e.list.forEach(e=>{t.push({...e,renderKey:e.teamId})}))}),t}(e)}const C=d([]);const E=e=>{n.value=e,0==e.length&&(C.value=[])};return v(()=>{t.value=!0}),m(()=>{g()}),(e,t)=>(i(),a("div",null,[l(_,{title:p(u)("searchTitleText")},null,8,["title"]),s("div",{style:{padding:"0 16px"}},[l(x,{onChange:E,onSearch:y,placeholder:"输入账号或者名称"})]),C.value.length>0?(i(),a("div",{key:0,class:"search-result-wrapper"},[s("div",{class:"search-result-list"},[(i(!0),a(f,null,I(C.value,e=>(i(),a("div",{key:e.renderKey},["friends"==e.title?(i(),a("div",{key:0,class:"result-title"},r(p(u)("friendText")),1)):"groups"==e.title?(i(),a("div",{key:1,class:"result-title"},r(p(u)("teamText")),1)):(i(),a("div",{key:2},[l(T,{item:e},null,8,["item"])]))]))),128))])])):h("",!0),0==C.value.length&&n.value?(i(),a("div",{key:1},[l(S,{text:p(u)("searchResultNullText")},null,8,["text"])])):h("",!0)]))}}),[["__scopeId","data-v-15e62030"]]);export{C as default};
