import{d as e,g as t,c as o,A as n,o as a,a as i,e as s,u as r,b as u,E as c,x as l}from"./index-CA_4_S1o.js";import{P as d}from"./PersonSelect.cBJMe6Rx.js";import{N as m}from"./NavBar.B_pGq4kd.js";import{b as p}from"./uni-app.es.f5Xd5cz1.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./Avatar.cDMQ39ID.js";import"./Appellation.vue_vue_type_script_setup_true_lang.Bn2FxhVA.js";import"./Empty.DhhBt1kg.js";import"./Icon.DO2Wg01x.js";const v=I(e({__name:"index",setup(e){let I="",v=!1;const _=t([]),T=o(()=>_.value.filter(e=>e.checked).map(e=>e.accountId)),M=e=>{_.value=_.value.map(t=>({accountId:t.accountId,checked:e.includes(t.accountId)})),e.length>=200&&uni.showToast({title:u("maxSelectedText"),icon:"none"})},h=e=>{if(1===g.groupPermissions)return void uni.showToast({title:"创建失败,请联系管理员",icon:"none"});const t=[];e.map(e=>{t.push(uni.$UIKitStore.uiStore.getAppellation({account:e}))});return((uni.$UIKitStore.userStore.myUserInfo.name||uni.$UIKitStore.userStore.myUserInfo.accountId)+"、"+t.join("、")).slice(0,30)},f=()=>["https://yx-web-nosdn.netease.im/common/2425b4cc058e5788867d63c322feb7ac/groupAvatar1.png","https://yx-web-nosdn.netease.im/common/62c45692c9771ab388d43fea1c9d2758/groupAvatar2.png","https://yx-web-nosdn.netease.im/common/d1ed3c21d3f87a41568d17197760e663/groupAvatar3.png","https://yx-web-nosdn.netease.im/common/e677d8551deb96723af2b40b821c766a/groupAvatar4.png","https://yx-web-nosdn.netease.im/common/fd6c75bb6abca9c810d1292e66d5d87e/groupAvatar5.png"][Math.floor(5*Math.random())];let A=!1;const E=async()=>{var e,t,o,n;if(1!==g.groupPermissions)try{if(A)return;if(0==(null==(e=null==T?void 0:T.value)?void 0:e.length))return void uni.showToast({title:u("friendSelect"),icon:"none"});if((null==(t=null==T?void 0:T.value)?void 0:t.length)>200)return void uni.showToast({title:u("maxSelectedText"),icon:"none"});A=!0;let a={};a=v?await(null==(o=uni.$UIKitStore)?void 0:o.teamStore.createTeamActive({type:c.V2NIMTeamType.V2NIM_TEAM_TYPE_ADVANCED,accounts:[...T.value],avatar:f(),name:h(T.value),joinMode:c.V2NIMTeamJoinMode.V2NIM_TEAM_JOIN_MODE_FREE,agreeMode:c.V2NIMTeamAgreeMode.V2NIM_TEAM_AGREE_MODE_NO_AUTH,inviteMode:c.V2NIMTeamInviteMode.V2NIM_TEAM_INVITE_MODE_ALL,updateInfoMode:c.V2NIMTeamUpdateInfoMode.V2NIM_TEAM_UPDATE_INFO_MODE_ALL,updateExtensionMode:c.V2NIMTeamUpdateExtensionMode.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL,serverExtension:JSON.stringify({im_ui_kit_group:!0})})):await(null==(n=uni.$UIKitStore)?void 0:n.teamStore.createTeamActive({accounts:I?[...T.value,I]:[...T.value],avatar:f(),name:h(T.value)})),uni.$UIKitStore.uiStore.selectConversation(uni.$UIKitNIM.V2NIMConversationIdUtil.teamConversationId(a.teamId)),l({url:"/pages/Chat/index"}),uni.showToast({title:u(v?"createDiscussionSuccessText":"createTeamSuccessText"),icon:"none"})}catch(a){uni.showToast({title:u(v?"createDiscussionFailedText":"createTeamFailedText"),icon:"error"})}finally{A=!1}else uni.showToast({title:"创建失败,请联系管理员",icon:"none"})};let g={};return p(e=>{I=null==e?void 0:e.p2pConversationId,v=null==e?void 0:e.createDiscussion;const t=uni.$UIKitStore.uiStore.friends.filter(e=>!uni.$UIKitStore.relationStore.blacklist.includes(e.accountId));_.value=t.map(e=>({accountId:e.accountId})).filter(e=>e.accountId!==I),n({method:"GET",url:"im/api/getUserByAccount?account="+uni.$UIKitStore.userStore.myUserInfo.accountId}).then(e=>{g=e})}),(e,t)=>(a(),i("div",null,[s(m,{title:r(u)("chooseText")},null,8,["title"]),s(d,{personList:_.value,onCheckboxChange:M,onOnBtnClick:E,showBtn:!0,btnText:r(u)("createButtonText")+"("+T.value.length+")"},null,8,["personList","btnText"])]))}}),[["__scopeId","data-v-8819a214"]]);export{v as default};
