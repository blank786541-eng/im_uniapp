import{d as e,g as t,c as a,h as i,j as o,o as n,a as s,e as l,u as c,k as u,t as m,F as r,r as v,f as d,p as T,b as M,E as I,aC as _,l as N,aE as x,ai as C}from"./index-CA_4_S1o.js";import{N as E}from"./NavBar.B_pGq4kd.js";import{A as S}from"./Avatar.cDMQ39ID.js";import{I as f}from"./Icon.DO2Wg01x.js";import{b as h}from"./uni-app.es.f5Xd5cz1.js";import{_ as p}from"./_plugin-vue_export-helper.BCo6x5W8.js";const A=p(e({__name:"index",setup(e){var p,A;let U="";const k=t([]),g=t(),$=t(),y=t(),V=null==(A=null==(p=uni.$UIKitStore)?void 0:p.sdkOptions)?void 0:A.enableV2CloudConversation,w=a(()=>{const e=uni.$UIKitStore.userStore.myUserInfo;return($.value?$.value.ownerAccountId:"")===(e?e.accountId:"")}),D=a(()=>{var e;let t=null==(e=$.value)?void 0:e.serverExtension;return x(t)}),K=a(()=>{const e=uni.$UIKitStore.userStore.myUserInfo;return k.value.filter(e=>e.memberRole===I.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER).some(t=>t.accountId===(e?e.accountId:""))}),b=a(()=>{var e;return(null==(e=$.value)?void 0:e.inviteMode)===I.V2NIMTeamInviteMode.V2NIM_TEAM_INVITE_MODE_ALL||(w.value||K.value)}),O=()=>{T({url:`/pages/Team/team-set/team-info-edit?id=${U}`})},j=()=>{C({url:"/pages/Conversation/index"})},B=()=>{T({url:`/pages/Team/team-set/team-manage?id=${U}`})},F=()=>{T({url:`/pages/Team/team-set/nick-in-team?id=${U}`})},G=(e,t)=>{T({url:`/pages/Team/team-set/change-intro?id=${U}&type=${e}&content=${t}`})},R=()=>{const e=uni.$UIKitNIM.V2NIMConversationIdUtil.teamConversationId(U);T({url:`/pages/Chat/message/pin-list?conversationId=${e}`})};function P(){T({url:`/pages/Team/team-set/team-qrcode?conversationId=${U}`})}const L=()=>{b.value?T({url:`/pages/Team/team-add/index?teamId=${U}`}):uni.showToast({title:M("noPermission"),icon:"error"})},H=()=>{T({url:`/pages/Team/team-member/index?teamId=${U}`})},Y=()=>{uni.showModal({title:M("leaveDiscussionTitle"),content:M("leaveDiscussionConfirmText"),cancelText:M("cancelText"),confirmText:M("okText"),showCancel:!0,success:async function(e){var t;try{if(e.confirm&&(null==(t=$.value)?void 0:t.teamId)){if(w.value){const e=uni.$UIKitStore.userStore.myUserInfo,t=k.value.filter(e=>!uni.$UIKitStore.aiUserStore.aiUsers.has(e.accountId)).filter(t=>t.accountId!==(null==e?void 0:e.accountId));0===t.length?await uni.$UIKitStore.teamStore.dismissTeamActive($.value.teamId):await uni.$UIKitStore.teamStore.transferTeamActive({teamId:$.value.teamId,account:t[0].accountId,leave:!0,type:I.V2NIMTeamType.V2NIM_TEAM_TYPE_ADVANCED})}else await uni.$UIKitStore.teamStore.leaveTeamActive($.value.teamId);uni.showToast({title:M("leaveDiscussionSuccessText"),icon:"none"}),j()}}catch(a){uni.showToast({title:M("leaveDiscussionFailedText"),icon:"error"})}},cancel:function(){}})},z=()=>{D.value?Y():uni.showModal({title:M("dismissTeamText"),content:M("dismissTeamConfirmText"),cancelText:M("cancelText"),confirmText:M("okText"),showCancel:!0,success:function(e){e.confirm&&uni.$UIKitStore.teamStore.dismissTeamActive(U).then(()=>{uni.showToast({title:M("dismissTeamSuccessText"),icon:"none"})}).catch(()=>{uni.showToast({title:M("dismissTeamFailedText"),icon:"error"})})}})},q=()=>{D.value?Y():uni.showModal({title:M("leaveTeamTitle"),content:M("leaveTeamConfirmText"),cancelText:M("cancelText"),confirmText:M("okText"),showCancel:!0,success:function(e){e.confirm&&uni.$UIKitStore.teamStore.leaveTeamActive(U).then(()=>{uni.showToast({title:M("leaveTeamSuccessText"),icon:"none"}),j()}).catch(()=>{uni.showToast({title:M("leaveTeamFailedText"),icon:"error"})})}})};let J=()=>{},Q=()=>{};const W=async e=>{var t,a;const i=e.detail.value,o=uni.$UIKitNIM.V2NIMConversationIdUtil.teamConversationId(U);try{V?await(null==(t=uni.$UIKitStore.conversationStore)?void 0:t.stickTopConversationActive(o,i)):await(null==(a=uni.$UIKitStore.localConversationStore)?void 0:a.stickTopConversationActive(o,i))}catch(n){uni.showToast({title:M(i?"addStickTopFailText":"deleteStickTopFailText"),icon:"error"})}},X=e=>{const t=e.detail.value;uni.$UIKitStore.teamStore.setTeamMessageMuteModeActive(U,I.V2NIMTeamType.V2NIM_TEAM_TYPE_ADVANCED,t?I.V2NIMTeamMessageMuteMode.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF:I.V2NIMTeamMessageMuteMode.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON).then(()=>{y.value=t?I.V2NIMTeamMessageMuteMode.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF:I.V2NIMTeamMessageMuteMode.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON}).catch(e=>{if(109432===(null==e?void 0:e.code))uni.showToast({title:M("noPermission"),icon:"none"});else uni.showToast({title:M(t?"sessionMuteFailText":"sessionUnMuteFailText"),icon:"none"})})},Z=async e=>{const t=e.detail.value;try{await uni.$UIKitStore.teamStore.setTeamChatBannedActive({teamId:U,chatBannedMode:t?I.V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL:I.V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN})}catch(a){if(109432===(null==a?void 0:a.code))uni.showToast({title:M("noPermission"),icon:"error"});else uni.showToast({title:M(t?"muteAllTeamFailedText":"sessionUnMuteFailText"),icon:"error"})}};return h(e=>{U=e?e.id:"";const t=uni.$UIKitNIM.V2NIMConversationIdUtil.teamConversationId(U);uni.$UIKitStore.teamStore.getTeamMessageMuteModeActive(U,1).then(e=>{y.value=e}),J=i(()=>{U&&($.value=uni.$UIKitStore.teamStore.teams.get(U),k.value=uni.$UIKitStore.teamMemberStore.getTeamMember(U))}),Q=i(()=>{var e,a;g.value=V?null==(e=uni.$UIKitStore.conversationStore)?void 0:e.conversations.get(t):null==(a=uni.$UIKitStore.localConversationStore)?void 0:a.conversations.get(t)})}),o(()=>{J(),Q()}),(e,t)=>{const a=_;return n(),s("div",null,[l(E,{title:c(M)("setText")},null,8,["title"]),$.value?(n(),s("div",{key:0,class:"team-set-container"},[u("div",{class:"team-set-card"},[u("div",{class:"team-set-item"},[u("div",{class:"team-info-item",onClick:O},[l(S,{account:$.value&&$.value.teamId,avatar:$.value&&$.value.avatar},null,8,["account","avatar"]),u("div",{class:"team-info-title"},m($.value&&$.value.name),1),l(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})])]),u("div",{class:"team-set-item"},[u("div",{class:"team-members-item"},[u("div",{class:"team-members-info-item",onClick:H},[u("div",{class:"team-members-info"},[u("div",{class:"team-info-title"},m(D.value?c(M)("discussionMemberText"):c(M)("teamMemberText")),1),u("div",{class:"group-info-subtitle"},m($.value&&$.value.memberCount),1)]),l(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})]),u("div",{class:"member-list"},[u("div",{class:"member-add"},[u("div",{onClick:L,style:{display:"flex"}},[l(f,{type:"icon-tianjiaanniu"})])]),(n(!0),s(r,null,v(k.value,e=>(n(),s("div",{class:"member-item",key:e.accountId},[(n(),N(S,{account:e.accountId,size:"32",key:e.accountId,"font-size":"10"},null,8,["account"]))]))),128))])])])]),u("div",{class:"team-set-item"},[u("div",{class:"team-set-item-flex",onClick:P},[u("div",null,"群二维码"),l(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})]),u("div",{class:"team-set-item-flex",onClick:R},[u("div",null,m(c(M)("pinText")),1),l(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})]),u("div",{class:"team-set-item-flex",onClick:t[0]||(t[0]=e=>G(1,$.value.intro))},[u("div",null,"群介绍"),l(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})]),u("div",{class:"team-set-item-flex",onClick:t[1]||(t[1]=e=>G(2,$.value.announcement))},[u("div",null,"群公告"),l(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})]),u("div",{class:"team-set-item-flex"},[u("div",null,m(c(M)("stickTopText")),1),l(a,{checked:g.value&&!!g.value.stickTop,onChange:W},null,8,["checked"])]),u("div",{class:"team-set-item-flex"},[u("div",null,m(c(M)("sessionMuteText")),1),l(a,{checked:$.value&&y.value!==c(I).V2NIMTeamMessageMuteMode.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON,onChange:X},null,8,["checked"])]),D.value?d("",!0):(n(),s("div",{key:0,class:"team-set-item-flex",onClick:F},[u("div",null,m(c(M)("nickInTeam")),1),l(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})])),u("div",{class:"team-set-item-flex"},[u("div",null,m(c(M)("teamBannedText")),1),l(a,{checked:$.value&&$.value.chatBannedMode!==c(I).V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN,onChange:Z},null,8,["checked"])]),D.value||!w.value&&!K.value?d("",!0):(n(),s("div",{key:1},[u("div",{class:"team-set-item-flex",onClick:B},[u("div",null,m(c(M)("teamManagerText")),1),l(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})])]))]),w.value?(n(),s("div",{key:0,class:"team-set-button",onClick:z},m(D.value?c(M)("leaveDiscussionTitle"):c(M)("dismissTeamText")),1)):(n(),s("div",{key:1,class:"team-set-button",onClick:q},m(D.value?c(M)("leaveDiscussionTitle"):c(M)("leaveTeamTitle")),1))])):d("",!0)])}}}),[["__scopeId","data-v-9e1656d6"]]);export{A as default};
