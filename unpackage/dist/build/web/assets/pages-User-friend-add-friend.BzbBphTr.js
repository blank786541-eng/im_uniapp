import{d as e,g as t,q as a,A as o,h as s,j as r,o as i,a as n,e as u,u as l,k as c,l as d,t as v,v as p,C as h,f as I,F as m,b as y,E as S,x as f,T as g}from"./index-CA_4_S1o.js";import{A as x}from"./Avatar.cDMQ39ID.js";import{E as U}from"./Empty.DhhBt1kg.js";import{D as T}from"./defaultHeader.BLoWIqPs.js";import{S as _}from"./search-input.CZNuPT7x.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./AssetsImage.D01ldk7e.js";const A=F(e({__name:"add-friend",setup(e){const F=t("beginSearch"),A=t(),E=t("stranger");let k={};a(()=>{o({method:"GET",url:"im/api/getUserByAccount?account="+uni.$UIKitStore.userStore.myUserInfo.accountId}).then(e=>{k=e})});const w=s(()=>{var e,t;console.log("friends: ",uni.$UIKitStore.uiStore.friends),(null==(e=A.value)?void 0:e.accountId)&&(E.value=uni.$UIKitStore.uiStore.getRelation(null==(t=A.value)?void 0:t.accountId).relation)}),C=async e=>{if(1!==k.addFriend)try{const t=await uni.$UIKitStore.userStore.getUserActive(e);t?(A.value=t,E.value=uni.$UIKitStore.uiStore.getRelation(t.accountId).relation,F.value="searchResult"):F.value="searchEmpty"}catch(t){F.value="searchEmpty",uni.showToast({title:y("searchFailText"),icon:"error"})}},K=async()=>{var e;const t=null==(e=A.value)?void 0:e.accountId;if(t)try{await uni.$UIKitStore.friendStore.addFriendActive(t,{addMode:S.V2NIMFriendAddMode.V2NIM_FRIEND_MODE_TYPE_APPLY,postscript:""}),await uni.$UIKitStore.relationStore.removeUserFromBlockListActive(t),uni.showToast({title:y("applyFriendSuccessText"),icon:"none"})}catch(a){uni.showToast({title:y("applyFriendFailText"),icon:"error"})}},$=async()=>{var e;const t=null==(e=A.value)?void 0:e.accountId;if(t)try{const e=uni.$UIKitNIM.V2NIMConversationIdUtil.p2pConversationId(t);await uni.$UIKitStore.uiStore.selectConversation(e),f({url:"/pages/Chat/index"})}catch(a){uni.showToast({title:y("gotoChatFailText"),icon:"error"})}},j=e=>{""===e&&(F.value="beginSearch")};return r(()=>{w()}),(e,t)=>{const a=g;return i(),n(m,null,[u(T,{title:l(y)("addFriendText")},null,8,["title"]),c("div",{style:{padding:"0 15px"}},[u(_,{placeholder:l(y)("enterAccount"),onSearch:C,onChange:j},null,8,["placeholder"]),"searchEmpty"==F.value?(i(),d(U,{key:0,text:l(y)("noExistUser")},null,8,["text"])):"searchResult"===F.value?(i(),n("div",{key:1,class:"user-wrapper"},[u(x,{class:"user-avatar",account:A.value&&A.value.accountId||""},null,8,["account"]),c("div",{class:"user-info"},[c("div",{class:"user-nick"},v(A.value&&A.value.name||A.value&&A.value.accountId),1),c("div",{class:"user-id"},v(A.value&&A.value.accountId),1)]),"stranger"!==E.value?(i(),d(a,{key:0,class:"go-chat-button",type:"primary",onClick:$},{default:p(()=>[h(v(l(y)("chatButtonText")),1)]),_:1})):(i(),d(a,{key:1,class:"go-chat-button",onClick:K},{default:p(()=>[h(v(l(y)("addText")),1)]),_:1}))])):I("",!0)])],64)}}}),[["__scopeId","data-v-30c725d9"]]);export{A as default};
