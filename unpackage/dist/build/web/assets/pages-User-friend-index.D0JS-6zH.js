import{d as e,g as a,h as t,j as o,o as s,a as i,e as n,u as l,k as r,t as c,f as u,E as v,b as d,p,x as m,aC as I}from"./index-CA_4_S1o.js";import{b as h}from"./uni-app.es.f5Xd5cz1.js";import{U as x}from"./UserCard.Crym-xlU.js";import{A as b}from"./AssetsImage.D01ldk7e.js";import{D as g}from"./defaultHeader.BLoWIqPs.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./Avatar.cDMQ39ID.js";import"./permission.DD8MzfWC.js";const w=S(e({__name:"index",setup(e){var S,w;const C=null==(w=null==(S=uni.$UIKitStore)?void 0:S.sdkOptions)?void 0:w.enableV2CloudConversation,T=a(),f=a(!1),k=a(!1);let U="",M=a(""),_=()=>{},F=()=>{};const $=a(!1);h(e=>{U=e?e.account:"",uni.$UIKitStore.userStore.getUserListFromCloudActive([U]),e.conversationId&&(M.value=e.conversationId),_=t(()=>{T.value=uni.$UIKitStore.uiStore.getFriendWithUserNameCard(U),console.log(T.value,"value======")}),F=t(()=>{const{relation:e,isInBlacklist:a}=uni.$UIKitStore.uiStore.getRelation(U);if(f.value="friend"==e,M.value){const e=uni.$UIKitStore.teamMemberStore.getTeamMember(M.value,[U])[0];$.value=e.memberRole==v.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER||e.memberRole==v.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_OWNER}k.value=a})});const A=async e=>{const a=e.detail.value;try{a?await uni.$UIKitStore.relationStore.addUserToBlockListActive(U):await uni.$UIKitStore.relationStore.removeUserFromBlockListActive(U)}catch(t){uni.showToast({title:d(a?"setBlackFailText":"removeBlackFailText"),icon:"error"})}},K=()=>{uni.showModal({title:d("deleteFriendText"),content:d("deleteFriendConfirmText")+"“"+uni.$UIKitStore.uiStore.getAppellation({account:U})+"”?",success:e=>{e.confirm?uni.$UIKitStore.friendStore.deleteFriendActive(U).then(()=>{uni.showToast({title:d("deleteFriendSuccessText"),icon:"none"})}).then(()=>{var e,a;const t=uni.$UIKitNIM.V2NIMConversationIdUtil.p2pConversationId(U);return C?null==(e=uni.$UIKitStore.conversationStore)?void 0:e.deleteConversationActive(t):null==(a=uni.$UIKitStore.localConversationStore)?void 0:a.deleteConversationActive(t)}).catch(()=>{uni.showToast({title:d("deleteFriendFailText"),icon:"error"})}):e.cancel&&console.log("用户点击取消")}})};function y(){var e;p({url:`/pages/Chat/message/add-note?conversationId=${null==(e=T.value)?void 0:e.accountId}`})}const E=async()=>{var e;const a=uni.$UIKitNIM.V2NIMConversationIdUtil.p2pConversationId((null==(e=T.value)?void 0:e.accountId)||"");await uni.$UIKitStore.uiStore.selectConversation(a),m({url:"/pages/Chat/index"})},N=()=>{var e;uni.setClipboardData({data:null==(e=T.value)?void 0:e.accountId,showToast:!1,success:()=>{uni.showToast({title:d("copySuccessText"),icon:"none"})},fail:()=>{uni.showToast({title:d("copyFailText"),icon:"none"})}})};return o(()=>{_(),F()}),(e,a)=>{const t=I;return s(),i("div",{class:"wrapper"},[n(g,{title:l(d)("FriendPageText")},null,8,["title"]),r("div",{class:"flex-box",style:{"margin-top":"20px"}},[n(x,{account:T.value&&T.value.accountId,nick:T.value&&T.value.name},null,8,["account","nick"])]),r("div",{class:"default-wrapper",style:{"margin-top":"12px"}},[r("div",{class:"row"},[r("span",{class:"label"},"昵称"),r("div",{class:"container-box"}),r("span",{class:"value"},c(T.value.name||T.value.accountId),1)]),r("div",{class:"row",onClick:y},[r("span",{class:"label"},"备注"),r("div",{class:"container-box"}),r("span",{class:"value"},c(T.value.alias),1)]),r("div",{class:"row"},[r("span",{class:"label"},"性别"),r("div",{class:"container-box"}),r("div",{class:"value"},c(T.value&&0===T.value.gender?l(d)("unknow"):T.value&&1===T.value.gender?l(d)("男"):l(d)("女")),1),n(b,{path:"/static/right.png",width:"6px",height:"12px"})]),f.value||$.value?(s(),i("div",{key:0,class:"row",onClick:N},[r("span",{class:"label"},"账号"),r("div",{class:"container-box"}),r("span",{class:"value"},c(T.value.accountId),1),n(b,{path:"/static/copy.png",width:"16px",height:"16px"})])):u("",!0),r("div",{class:"row"},[r("span",{class:"label"},"个性签名"),r("div",{class:"container-box"}),r("div",{class:"value"},c(T.value.sign),1)])]),r("div",null,[f.value||$.value?(s(),i("div",{key:0,class:"userInfo-item-wrapper default-wrapper"},[r("div",{class:"userInfo-item"},[r("div",{class:"item-left"},c(l(d)("addBlacklist")),1),n(t,{checked:k.value,onChange:A},null,8,["checked"])])])):u("",!0),f.value||$.value?(s(),i("div",{key:1,class:"button",onClick:E},c(l(d)("chatWithFriendText")),1)):u("",!0),r("div",{class:"box-shadow"}),f.value||$.value?(s(),i("div",{key:2,class:"button button-red",onClick:K},c(l(d)("deleteFriendText")),1)):u("",!0)])])}}}),[["__scopeId","data-v-6040701d"]]);export{w as default};
