import{d as e,c as a,o as s,a as t,k as o,u as l,l as n,f as i,t as r,e as p,F as c,r as d,b as m,E as T,p as g,a3 as v,y as u,C as I}from"./index-CA_4_S1o.js";import{p as M,a as y,M as _}from"./message-file.BFObQXzu.js";import{I as E}from"./Icon.DO2Wg01x.js";import{E as f}from"./emoji.SrFHKbUG.js";import{d as N}from"./dayjs.min.CwOgZug2.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-app.es.f5Xd5cz1.js";const w=C(e({__name:"collection-card",props:{data:{},handleRemoveCollection:{}},setup(e){const C=e,w=JSON.parse(C.data.collectionData);w.message=uni.$UIKitNIM.V2NIMMessageConverter.messageDeserialization(w.message);const V=w.message,x=M((null==V?void 0:V.text)||""),S=a(()=>{var e,a;return(null==(e=null==V?void 0:V.attachment)?void 0:e.url)||(null==(a=V.attachment)?void 0:a.file)}),h=a(()=>{var e;const a=null==(e=V.attachment)?void 0:e.url;return a?`${a}${a.includes("?")?"&":"?"}vframe&offset=1`:""}),Y=()=>{let e=[m("deleteCollectionText")];V.messageType===T.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?e=e.concat([m("copyText"),m("forwardToTeamText"),m("forwardToFriendText")]):V.messageType!==T.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO&&(e=e.concat([m("forwardToTeamText"),m("forwardToFriendText")])),uni.showActionSheet({itemList:e,success(e){V.messageType===T.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?0===e.tapIndex?C.handleRemoveCollection():1===e.tapIndex?uni.setClipboardData({data:V.text,showToast:!1,success:()=>{uni.showToast({title:m("copySuccessText"),icon:"none"})},fail:()=>{uni.showToast({title:m("copyFailText"),icon:"none"})}}):2===e.tapIndex?g({url:`/pages/Chat/forward?forwardConversationType=${T.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM}&msgIdClient=${V.messageClientId}&origin=collection`}):3===e.tapIndex&&g({url:`/pages/Chat/forward?forwardConversationType=${T.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P}&msgIdClient=${V.messageClientId}&origin=collection`}):V.messageType!==T.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO?0===e.tapIndex?C.handleRemoveCollection():1===e.tapIndex?g({url:`/pages/Chat/forward?forwardConversationType=${T.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM}&msgIdClient=${V.messageClientId}&origin=collection`}):2===e.tapIndex&&g({url:`/pages/Chat/forward?forwardConversationType=${T.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P}&msgIdClient=${V.messageClientId}&origin=collection`}):0===e.tapIndex&&C.handleRemoveCollection()},complete(){}})},A=()=>{const e=C.data.updateTime;return(e=>{const a=new Date(e),s=new Date;return a.getFullYear()===s.getFullYear()&&a.getMonth()===s.getMonth()&&a.getDate()===s.getDate()})(e)?N(e).format("HH:mm"):(e=>{const a=new Date(e),s=new Date;return a.getFullYear()===s.getFullYear()})(e)?N(e).format("MM月DD日 HH:mm"):N(e).format("YYYY年MM月DD日 HH:mm")};return(e,a)=>{const M=u;return s(),t("div",{class:"collection-card-wrapper"},[o("div",{class:"info-wrapper"},[o("div",{class:"info"},[o("div",{class:"info-left"},[l(w).avatar?(s(),n(M,{key:0,"lazy-load":!0,class:"avatar-img",src:l(w).avatar,mode:"aspectFill"},null,8,["src"])):i("",!0)]),o("div",{class:"info-right"},[o("div",{class:"name"},r(l(w).senderName),1),o("div",{class:"conversation"},r(l(m)("collectionFromText"))+" "+r(l(w).conversationName),1)])]),o("div",{class:"info-icon"},[p(E,{type:"icon-More",onClick:Y})])]),o("div",{class:"content-wrapper"},[l(V).messageType===l(T).V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE?(s(),t("div",{key:0,class:"file-wrapper"},[o("div",{onClick:a[0]||(a[0]=()=>{var e;(e=l(V).attachment.url)&&uni.previewImage({urls:[e]})})},[p(M,{class:"msg-image","lazy-load":!0,mode:"aspectFill",src:S.value},null,8,["src"])])])):l(V).messageType===l(T).V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO?(s(),t("div",{key:1,class:"file-wrapper"},[o("div",{class:"video-msg-wrapper",onClick:a[1]||(a[1]=()=>(e=>{var a;v();const s=null==(a=e.attachment)?void 0:a.url;s&&g({url:`/pages/Chat/video-play?videoUrl=${encodeURIComponent(s)}`})})(l(V)))},[o("div",{class:"video-play-button"},[o("div",{class:"video-play-icon"})]),p(M,{class:"msg-image","lazy-load":!0,mode:"aspectFill",src:h.value},null,8,["src"])])])):l(V).messageType===l(T).V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE?(s(),t("div",{key:2,class:"file-wrapper extra"},[p(y,{msg:l(V)},null,8,["msg"])])):l(V).messageType===l(T).V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO?(s(),t("div",{key:3,class:"file-wrapper"},[o("div",{class:"audio-wrapper"},[p(_,{msg:l(V),mode:"audio-in"},null,8,["msg"])])])):l(V).messageType===l(T).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(s(),t("div",{key:4,class:"text-wrapper"},[(s(!0),t(c,null,d(l(x),a=>(s(),t(c,{key:a.key},["text"===a.type?(s(),t(c,{key:0},[I(r(a.value),1)],64)):"emoji"===a.type?(s(),n(E,{key:1,type:l(f)[a.value],size:e.fontSize||22,style:{margin:"0 2px 2px 2px",verticalAlign:"bottom"}},null,8,["type","size"])):i("",!0)],64))),128))])):(s(),t("div",{key:5},"["+r(l(m)("unknowMsgText"))+"]",1))]),o("div",{class:"updatetime"},r(A()),1)])}}}),[["__scopeId","data-v-c86e9fb0"]]);export{w as default};
